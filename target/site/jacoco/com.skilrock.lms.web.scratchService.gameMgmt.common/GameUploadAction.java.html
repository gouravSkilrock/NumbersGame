<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GameUploadAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.web.scratchService.gameMgmt.common</a> &gt; <span class="el_source">GameUploadAction.java</span></div><h1>GameUploadAction.java</h1><pre class="source lang-java linenums">/***
 *  * ï¿½ copyright 2007, SkilRock Technologies, A division of Sugal &amp; Damani Lottery Agency Pvt. Ltd.
 * All Rights Reserved
 * The contents of this file are the property of Sugal &amp; Damani Lottery Agency Pvt. Ltd.
 * and are subject to a License agreement with Sugal &amp; Damani Lottery Agency Pvt. Ltd.; you may
 * not use this file except in compliance with that License.  You may obtain a
 * copy of that license from:
 * Legal Department
 * Sugal &amp; Damani Lottery Agency Pvt. Ltd.
 * 6/35,WEA, Karol Bagh,
 * New Delhi
 * India - 110005
 * This software is distributed under the License and is provided on an ï¿½AS ISï¿½
 * basis, without warranty of any kind, either express or implied, unless
 * otherwise provided in the License.  See the License for governing rights and
 * limitations under the License.
 * 
 */
package com.skilrock.lms.web.scratchService.gameMgmt.common;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.io.PrintWriter;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.struts2.ServletActionContext;
import org.apache.struts2.interceptor.ServletRequestAware;
import org.apache.struts2.interceptor.ServletResponseAware;

import com.opensymphony.xwork2.ActionSupport;
import com.skilrock.lms.beans.GameBean;
import com.skilrock.lms.beans.GameTicketFormatBean;
import com.skilrock.lms.beans.PackNumberSeriesBean;
import com.skilrock.lms.beans.PackSeriesFlagBean;
import com.skilrock.lms.beans.SupplierBean;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.utility.MD5Encoder;
import com.skilrock.lms.coreEngine.scratchService.pwtMgmt.common.CommonFunctionsHelper;
import com.skilrock.lms.coreEngine.scratchService.gameMgmt.common.GameuploadHelper;
import com.skilrock.lms.coreEngine.scratchService.inventoryMgmt.common.Unzip;

/**
 * This class is used to upload the game details.
 * 
 * @author Skilrock Technologies
 * 
 */
<span class="nc" id="L66">public class GameUploadAction extends ActionSupport implements</span>
		ServletRequestAware, ServletResponseAware {
<span class="nc" id="L68">	static Log logger = LogFactory.getLog(GameUploadAction.class);</span>
	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;

	public static int findDigit(int k) {
<span class="nc" id="L75">		int count = 0;</span>
<span class="nc bnc" id="L76" title="All 2 branches missed.">		while (k != 0) {</span>
<span class="nc" id="L77">			k = k / 10;</span>
<span class="nc" id="L78">			count++;</span>
		}
<span class="nc" id="L80">		return count;</span>
	}

<span class="nc" id="L83">	private String agent_pwt_comm_rate = null;</span>
<span class="nc" id="L84">	private String agent_sale_comm_rate = null;</span>
	private double agentPWTCommRate;
	private double agentSaleCommRate;
	private int booksperPack;
	private String callFlag;
	private Connection conn;
	private String details;
	private int digitsofBook;
	private int digitsofPack;
	private int digitsofTicket;
<span class="nc" id="L94">	private String end = null;</span>
	private String filePath;
	private int gameId;
<span class="nc" id="L97">	private String gameName = null;</span>
	private int gameNumber;
	private String gameType;
	private int gameVirnDigits;
	int govt_commrate;
	int govt_pwt_commrate;
<span class="nc" id="L103">	private Double govtCommRate = null;</span>
	private String govtCommRule;
<span class="nc" id="L105">	private String govtPWTCommRate = null;</span>
	private double minAssProfit;
<span class="nc" id="L107">	private Boolean newGameAvailable = false;</span>
	private String packNFrom;
	private String packNTo;
	private String[] packNumberFrom;
	private String[] packNumberTo;
	private List&lt;PackSeriesFlagBean&gt; packSeriesFlagList;
	private List&lt;PackNumberSeriesBean&gt; packSeriesList;
	private double priceperTicket;
	private double prizePayOutRatio;
	private String pwtendDate;
	private String rankupload;
<span class="nc" id="L118">	private HttpServletRequest request = null;</span>
	private HttpServletResponse response;
<span class="nc" id="L120">	private String retailer_pwt_comm_rate = null;</span>
<span class="nc" id="L121">	private String retailer_sale_comm_rate = null;</span>
	private double retailerPWTCommRate;
	private double retailerSaleCommRate;
	private String saleendDate;
<span class="nc" id="L125">	HttpSession session = null;</span>
<span class="nc" id="L126">	int start = 0;</span>
	private String startDate;
	private List&lt;SupplierBean&gt; supplier_list;
	private String supplier_Name;
	private Map&lt;Integer, String&gt; warehouseMap;
	private int warehouseId;
	/**
	 * This method is used to insert Game book and pack details into the
	 * database
	 * 
	 * @return String
	 * @throws LMSException
	 */
	private int supplierId;

	private List&lt;GameBean&gt; ticket_game_list;
	private int ticketpetBook;
	private long ticketsInScheme;

	private int[] totalpack;

	/*
	 * public List&lt;RankDetailBean&gt; readRank(int gameId)throws Exception{ List&lt;RankDetailBean&gt;
	 * list= new ArrayList&lt;RankDetailBean&gt;(); File file =new
	 * File(getRankupload()); FileReader fstream = new FileReader(file);
	 * BufferedReader br = new BufferedReader(fstream); String strLine;
	 * RankDetailBean rank = null;
	 * 
	 * System.out.println(&quot;game id is &quot; + gameId);
	 * 
	 * String a = &quot;&quot;; //Rank1=Rank String b = &quot;&quot;; //1|30|0|H|N String c = &quot;&quot;;
	 * //30 String d = &quot;&quot;; //H String e = &quot;&quot;; //10N String f = &quot;&quot;; //1 String
	 * status = null; StringTokenizer st = null; StringTokenizer st1 = null; int
	 * rank_id = 0; int prize_amount = 0; while ((strLine = br.readLine()) !=
	 * null){ System.out.println (&quot;vvv----- &quot;+ strLine); rank=new
	 * RankDetailBean(); rank.setGameId(gameId); a=&quot;&quot;; //Rank1=Rank b=&quot;&quot;;
	 * //1|30|0|H|N c=&quot;&quot;; //30 d=&quot;&quot;; //H e=&quot;&quot;; //10N f=&quot;&quot;; //1 rank_id=0;
	 * prize_amount=0; status=null; st=new StringTokenizer(strLine); for(int
	 * i=0;i&lt;3;i++){ if(st.hasMoreTokens()){ if(i&lt;2) a=a+st.nextToken();
	 * 
	 * else b=b+st.nextToken();
	 * 
	 * }System.out.println(&quot;first token &quot;+ a); System.out.println(&quot;second token
	 * &quot;+b); } st1=new StringTokenizer(b,&quot;|&quot;); for(int i=0;i&lt;5;i++){
	 * if(st1.hasMoreTokens()){ if(i==0){ f=f+st1.nextToken();
	 * rank_id=Integer.parseInt(f); rank.setRank(rank_id); } else if(i==1){
	 * c=c+st1.nextToken(); prize_amount=Integer.parseInt(c);
	 * rank.setPrize_amount(prize_amount); } else if(i==3){ d=d+st1.nextToken();
	 * if(d.equals(&quot;H&quot;)) status=&quot;HIGH&quot;; else if(d.equals(&quot;L&quot;)) status=&quot;LOW&quot;;
	 * else status=&quot;&quot;; rank.setStatus(status); } else e=e+st1.nextToken(); } }
	 * list.add(rank); } //Close the input stream br.close(); return list; }
	 */

	/*
	 * public String initialUploadBasicDetails() { ServletContext
	 * sc=ServletActionContext.getServletContext();
	 * agent_sale_comm_rate=(String)sc.getAttribute(&quot;AGT_SALE_COMM_RATE&quot;);
	 * retailer_sale_comm_rate=(String)sc.getAttribute(&quot;RET_SALE_COMM_RATE&quot;);
	 * agent_pwt_comm_rate=(String)sc.getAttribute(&quot;AGT_PWT_COMM_RATE&quot;);
	 * retailer_pwt_comm_rate=(String)sc.getAttribute(&quot;RET_PWT_COMM_RATE&quot;);
	 * 
	 * govtCommRule=(String)sc.getAttribute(&quot;GOVT_COMM_RULE&quot;);
	 * System.out.println(&quot;govt rule is &quot; + govtCommRule); session =
	 * getRequest().getSession();
	 * 
	 * //this.setAgent_sale_comm_rate(agent_sale_comm_rate);
	 * session.setAttribute(&quot;x&quot;, this); return SUCCESS; }
	 * 
	 * 
	 */

	private String totalPackStr;

	private double vatPercentage;

	/**
	 * This method is used to validate pack series ,
	 * 
	 * @param packnbrf
	 *            is the first pack number
	 * @param packnbrt
	 *            is the last pack number
	 * @return Bean of PackSeriesFlagBean type
	 * @throws LMSException
	 */

	public PackSeriesFlagBean checkPackSeriesValidity(String packnbrf,
			String packnbrt, int totpk) throws LMSException {

<span class="nc" id="L215">		PackSeriesFlagBean flagbean = null;</span>
<span class="nc" id="L216">		System.out.println(&quot;game name is = &quot; + getGameName());</span>
<span class="nc" id="L217">		String gameNameArr[] = getGameName().split(&quot;-&quot;);</span>
<span class="nc" id="L218">		GameuploadHelper gameuploadHelper = new GameuploadHelper();</span>

		// here we check the validity of pack series enter by user
<span class="nc" id="L221">		flagbean = gameuploadHelper.checkPackValidity(packnbrf, packnbrt,</span>
				gameNameArr[1], Integer.parseInt(gameNameArr[0]));
<span class="nc" id="L223">		flagbean.setPackfrn(packnbrf);</span>
<span class="nc" id="L224">		flagbean.setPackton(packnbrt);</span>
<span class="nc" id="L225">		flagbean.setTotpk(totpk);</span>

		// set the error message to display user
<span class="nc" id="L228">		String html = &quot;&quot;;</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">		if (!flagbean.isGamenbrflag()) {</span>
<span class="nc" id="L230">			flagbean.setFinalflag(false);</span>
<span class="nc" id="L231">			html = &quot; *Pack Series Is Invalid&quot;;</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">		} else if (!flagbean.isGamenbrformatflag()) {</span>
<span class="nc" id="L233">			flagbean.setFinalflag(false);</span>
<span class="nc" id="L234">			html = &quot; *Pack Series Is Invalid&quot;;</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">		} else if (!flagbean.isPackdigitformatflag()) {</span>
<span class="nc" id="L236">			flagbean.setFinalflag(false);</span>
<span class="nc" id="L237">			html = &quot; *Pack Series Is Invalid&quot;;</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">		} else if (!flagbean.isPackseriespresenceflag()) {</span>
<span class="nc" id="L239">			flagbean.setFinalflag(false);</span>
<span class="nc" id="L240">			html = html + &quot; *Packs In DB&quot;;</span>
		}

		// set this flag message into bean
<span class="nc bnc" id="L244" title="All 2 branches missed.">		if (html == &quot;&quot;) {</span>
<span class="nc" id="L245">			html = html + &quot;Pack Series Is Valid&quot;;</span>
<span class="nc" id="L246">			flagbean.setStatus(html);</span>
		} else {
<span class="nc" id="L248">			flagbean.setStatus(html);</span>
		}
<span class="nc" id="L250">		System.out.println(&quot;Hello -&gt;  &quot; + html);</span>
<span class="nc" id="L251">		return flagbean;</span>

	}

	public void checkPackSeriesValidityAjax() throws LMSException {
<span class="nc" id="L256">		List&lt;PackSeriesFlagBean&gt; list = new ArrayList&lt;PackSeriesFlagBean&gt;();</span>
<span class="nc" id="L257">		System.out.println(&quot;from = &quot; + packNumberFrom + &quot;  To = &quot;</span>
				+ packNumberTo + &quot;  totalpack = &quot; + totalPackStr);
<span class="nc" id="L259">		packNumberFrom = packNumberFrom[0].split(&quot;,&quot;);</span>
<span class="nc" id="L260">		packNumberTo = packNumberTo[0].split(&quot;,&quot;);</span>
<span class="nc" id="L261">		String tpStr[] = totalPackStr.split(&quot;,&quot;);</span>
<span class="nc" id="L262">		int[] arr = new int[tpStr.length];</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">		for (int i = 0; i &lt; tpStr.length; i++) {</span>
<span class="nc" id="L264">			arr[i] = Integer.parseInt(tpStr[i].trim());</span>
		}
<span class="nc" id="L266">		totalpack = arr;</span>
<span class="nc" id="L267">		PackSeriesFlagBean flagBean = null;</span>
<span class="nc" id="L268">		int packfromsize = getPackNumberFrom().length;</span>
		// int totPk = getTotalpack().length;
		// int packto = getPackNumberTo().length;
<span class="nc" id="L271">		System.out.println(&quot;fromLength = &quot; + packNumberFrom.length</span>
				+ &quot;  ToLength = &quot; + packNumberTo.length
				+ &quot;  totalpackLength = &quot; + totalpack.length);

<span class="nc bnc" id="L275" title="All 2 branches missed.">		for (int i = 0; i &lt; packfromsize; i++) {</span>
<span class="nc" id="L276">			String pnf = packNumberFrom[i];</span>
<span class="nc" id="L277">			int totpack = totalpack[i];</span>
<span class="nc" id="L278">			String pnt = packNumberTo[i];</span>
<span class="nc" id="L279">			System.out.println(&quot;packnumber Series Start From(pnf) &quot; + pnf</span>
					+ &quot;   End At(pnt) &quot; + pnt);
			// check the pack series validity
<span class="nc bnc" id="L282" title="All 8 branches missed.">			if (pnf != null &amp;&amp; pnf != null &amp;&amp; pnt != null &amp;&amp; pnt != null) {</span>
<span class="nc" id="L283">				flagBean = checkPackSeriesValidity(pnf, pnt, totpack);</span>
<span class="nc" id="L284">				list.add(flagBean);</span>
			}
		}
<span class="nc" id="L287">		setPackSeriesFlagList(list);</span>

<span class="nc" id="L289">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L290">		session.setAttribute(&quot;VERIFIED_PACKSERIES_FLAGBEAN_LIST&quot;,</span>
				getPackSeriesFlagList());
<span class="nc" id="L292">		System.out.println(&quot;VERIFIED_PACKSERIES_FLAGBEAN_LIST&quot; + list);</span>

		PrintWriter out;
		try {
<span class="nc" id="L296">			out = getResponse().getWriter();</span>
<span class="nc" id="L297">			response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L298">			StringBuilder responseStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">			for (PackSeriesFlagBean bean : list) {</span>
<span class="nc" id="L300">				responseStr.append(&quot;,&quot; + bean.getStatus());</span>
<span class="nc" id="L301">			}</span>
<span class="nc" id="L302">			out.print(responseStr.delete(0, 1).toString());</span>
<span class="nc" id="L303">		} catch (Exception e) {</span>
<span class="nc" id="L304">			e.printStackTrace();</span>
<span class="nc" id="L305">		}</span>

<span class="nc" id="L307">	}</span>

	public String displayGameUploadInventory() {
<span class="nc" id="L310">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L311">		GameuploadHelper gameuploadHelper = new GameuploadHelper();</span>
<span class="nc" id="L312">		ticket_game_list = gameuploadHelper.fatchVirnGameList(&quot;NEW&quot;);</span>
<span class="nc" id="L313">		session.setAttribute(&quot;NEW_GAME_LIST&quot;, ticket_game_list);</span>
<span class="nc" id="L314">		System.out.println(&quot;New game list is == &quot; + ticket_game_list);</span>
<span class="nc" id="L315">		return SUCCESS;</span>
	}

	public String displayTicketsUploadInventory() {
<span class="nc" id="L319">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L320">		session.removeAttribute(&quot;VERIFIED_PACKSERIES_FLAGBEAN_LIST&quot;);</span>
		try {
<span class="nc" id="L322">			warehouseMap = new CommonFunctionsHelper().fetchWarehouseMap();</span>
<span class="nc" id="L323">		} catch (Exception e) {</span>
			// TODO: handle exception
<span class="nc" id="L325">		}</span>
<span class="nc" id="L326">		return SUCCESS;</span>
	}

	public void displayTicketsUploadInventoryAjax() {
<span class="nc" id="L330">		System.out.println(&quot;displayTicketsUploadInventoryAjax == &quot;</span>
				+ getGameType() + &quot; ,callFlag = &quot; + callFlag);
		PrintWriter out;
		try {
<span class="nc" id="L334">			out = getResponse().getWriter();</span>
<span class="nc" id="L335">			response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L336">			GameuploadHelper gameuploadHelper = new GameuploadHelper();</span>
<span class="nc" id="L337">			ArrayList&lt;GameBean&gt; gameList = gameuploadHelper</span>
					.fatchGameList(getGameType());
<span class="nc" id="L339">			StringBuilder gameString = new StringBuilder();</span>
			;
<span class="nc bnc" id="L341" title="All 2 branches missed.">			for (GameBean gameBean : gameList) {</span>
<span class="nc" id="L342">				gameString.append(&quot;,&quot; + gameBean.getGameName());</span>
<span class="nc" id="L343">			}</span>
<span class="nc" id="L344">			gameString.delete(0, 1);</span>
			// get the supplier list first time
<span class="nc bnc" id="L346" title="All 4 branches missed.">			if (callFlag != null &amp;&amp; &quot;FIRST&quot;.equalsIgnoreCase(callFlag.trim())) {</span>
<span class="nc" id="L347">				Map&lt;Integer, String&gt; supplierList = gameuploadHelper</span>
						.fatchSupplierList();
<span class="nc" id="L349">				String supplierString = supplierList.toString()</span>
						.replace(&quot;{&quot;, &quot;&quot;).replace(&quot;}&quot;, &quot;&quot;);
<span class="nc" id="L351">				gameString = gameString.append(&quot;||&quot; + supplierString);</span>
			}
<span class="nc" id="L353">			out.print(gameString.toString());</span>
<span class="nc" id="L354">			System.out.println(&quot;commited data == &quot; + gameString);</span>

<span class="nc" id="L356">		} catch (IOException e) {</span>
<span class="nc" id="L357">			e.printStackTrace();</span>
<span class="nc" id="L358">		} catch (Exception e) {</span>
<span class="nc" id="L359">			e.printStackTrace();</span>
<span class="nc" id="L360">		}</span>
<span class="nc" id="L361">	}</span>

	/**
	 * This method is used to check for duplicate VIRN file
	 * 
	 * @return void
	 */

	public void fileStatusCheckAjax() throws Exception {
		// System.out.println(&quot;gggggggggggggggggggggggg&quot;);
<span class="nc" id="L371">		boolean virnFlag = true;</span>
		PrintWriter out;
<span class="nc" id="L373">		out = getResponse().getWriter();</span>
<span class="nc" id="L374">		GameuploadHelper gameHelper = new GameuploadHelper();</span>
<span class="nc" id="L375">		StringBuilder vclist = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L376">		System.out.println(getGameName());</span>
<span class="nc" id="L377">		System.out.println(&quot;function called readrank&quot;);</span>
<span class="nc" id="L378">		System.out.println(&quot;file path is &quot; + getFilePath());</span>
<span class="nc" id="L379">		File file = new File(getFilePath());</span>
<span class="nc" id="L380">		FileReader fstream = null;</span>
		try {
<span class="nc" id="L382">			System.out.println(&quot;11111111111111111111111&quot;);</span>
<span class="nc" id="L383">			fstream = new FileReader(file);</span>
<span class="nc" id="L384">			BufferedReader br = new BufferedReader(fstream);</span>
<span class="nc" id="L385">			System.out.println(&quot;6666666666666666666666&quot;);</span>
<span class="nc" id="L386">			String strLine = null;</span>
			// String a = &quot;&quot;;
			// String b = &quot;&quot;;
<span class="nc" id="L389">			String c = &quot;&quot;;</span>
<span class="nc" id="L390">			boolean flag = true;</span>
<span class="nc" id="L391">			System.out.println(&quot;22222222222222==== gameName = &quot; + gameName);</span>
<span class="nc" id="L392">			String gameNameArr[] = getGameName().split(&quot;-&quot;);</span>
<span class="nc" id="L393">			int game_id = gameHelper.getGameId(gameNameArr[0], gameNameArr[1]);</span>
<span class="nc" id="L394">			GameTicketFormatBean ticketFmtBean = gameHelper</span>
					.getGameNbrDigitsByGameId(game_id);
<span class="nc" id="L396">			int gameNbrDigits = ticketFmtBean.getGameNbrDigits();</span>
<span class="nc" id="L397">			int maxRankDigits = ticketFmtBean.getMaxRankDigits();</span>
<span class="nc bnc" id="L398" title="All 6 branches missed.">			if (gameNbrDigits == 0 || game_id == 0 || maxRankDigits == 0) {</span>
<span class="nc" id="L399">				System.out</span>
						.println(&quot;***************ERROR TYPE BLOCKER************&quot;);
			}
<span class="nc" id="L402">			String virn_code = null;</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">			while ((strLine = br.readLine()) != null) {</span>
<span class="nc" id="L404">				int lineLength = strLine.length();</span>
				// a = &quot;&quot;;
				// b = &quot;&quot;;
<span class="nc" id="L407">				c = &quot;&quot;;</span>
<span class="nc bnc" id="L408" title="All 2 branches missed.">				for (int i = 0; i &lt; lineLength; i++) {</span>
					// if (i &lt; gameNbrDigits)
					// a = a + strLine.charAt(i);
					// if (i &gt;= gameNbrDigits &amp;&amp; i &lt;
					// (gameNbrDigits+maxRankDigits))
					// b = b + strLine.charAt(i);
<span class="nc bnc" id="L414" title="All 4 branches missed.">					if (i &gt;= gameNbrDigits + maxRankDigits &amp;&amp; i &lt; lineLength) {</span>
<span class="nc" id="L415">						c = c + strLine.charAt(i);</span>
					}
				}
<span class="nc bnc" id="L418" title="All 2 branches missed.">				if (c != &quot;&quot;) {</span>
<span class="nc" id="L419">					virn_code = MD5Encoder.encode(c);</span>
<span class="nc bnc" id="L420" title="All 2 branches missed.">					if (flag) {</span>
<span class="nc" id="L421">						vclist.append(&quot;'&quot;);</span>
<span class="nc" id="L422">						vclist.append(virn_code);</span>
<span class="nc" id="L423">						vclist.append(&quot;'&quot;);</span>
<span class="nc" id="L424">						flag = false;</span>
					} else {
						// vclist = vclist + &quot;,'&quot; + virn_code + &quot;'&quot;;
<span class="nc" id="L427">						vclist.append(&quot;,'&quot;);</span>
<span class="nc" id="L428">						vclist.append(virn_code);</span>
<span class="nc" id="L429">						vclist.append(&quot;'&quot;);</span>
					}
				}
<span class="nc" id="L432">			}</span>
<span class="nc" id="L433">			System.out.println(&quot;game id on action is&quot; + game_id);</span>
<span class="nc" id="L434">			System.out.println(&quot;game name is &quot; + getGameName());</span>

<span class="nc" id="L436">			virnFlag = gameHelper.fileStatusCheck(vclist.toString(), game_id,</span>
					gameNameArr[0]);
<span class="nc" id="L438">			System.out.println(&quot;flag is &quot; + virnFlag);</span>
<span class="nc" id="L439">			out.println(virnFlag);</span>

			// return SUCCESS;
<span class="nc" id="L442">		} catch (NumberFormatException e) {</span>
<span class="nc" id="L443">			e.printStackTrace();</span>
<span class="nc" id="L444">		} catch (FileNotFoundException e) {</span>
<span class="nc" id="L445">			e.printStackTrace();</span>
<span class="nc" id="L446">		} catch (IOException e) {</span>
<span class="nc" id="L447">			e.printStackTrace();</span>
<span class="nc" id="L448">		}</span>
		// return SUCCESS;
<span class="nc" id="L450">	}</span>

	public String getAgent_pwt_comm_rate() {
<span class="nc" id="L453">		return agent_pwt_comm_rate;</span>
	}

	public String getAgent_sale_comm_rate() {
<span class="nc" id="L457">		return agent_sale_comm_rate;</span>
	}

	public double getAgentPWTCommRate() {
<span class="nc" id="L461">		return agentPWTCommRate;</span>
	}

	public double getAgentSaleCommRate() {
<span class="nc" id="L465">		return agentSaleCommRate;</span>
	}

	public int getBooksperPack() {
<span class="nc" id="L469">		return booksperPack;</span>
	}

	public String getCallFlag() {
<span class="nc" id="L473">		return callFlag;</span>
	}

	public Connection getConn() {
<span class="nc" id="L477">		return conn;</span>
	}

	public String getDetails() {
<span class="nc" id="L481">		return details;</span>
	}

	public int getDigitsofBook() {
<span class="nc" id="L485">		return digitsofBook;</span>
	}

	public int getDigitsofPack() {
<span class="nc" id="L489">		return digitsofPack;</span>
	}

	public int getDigitsofTicket() {
<span class="nc" id="L493">		return digitsofTicket;</span>
	}

	public String getEnd() {
<span class="nc" id="L497">		return end;</span>
	}

	public String getFilePath() {
<span class="nc" id="L501">		return filePath;</span>
	}

	/**
	 * This method is used to get the game dates by the name
	 * 
	 * @return Void
	 * @throws LMSException
	 */
	public void getGameDates() throws LMSException {
		PrintWriter out;
		try {
<span class="nc" id="L513">			out = getResponse().getWriter();</span>
<span class="nc" id="L514">			GameuploadHelper gameuploadHelper = new GameuploadHelper();</span>
<span class="nc" id="L515">			String allDatesString = gameuploadHelper.getInitialDates(</span>
					getGameName(), getGameType());
			// String arr[]=new String[3];
			// arr[0]=allDatesString.s
<span class="nc" id="L519">			out.print(allDatesString);</span>
<span class="nc" id="L520">			System.out.println(&quot;success return&quot;);</span>
<span class="nc" id="L521">		} catch (IOException e) {</span>

<span class="nc" id="L523">			e.printStackTrace();</span>

<span class="nc" id="L525">		}</span>

<span class="nc" id="L527">	}</span>

	public int getGameId() {
<span class="nc" id="L530">		return gameId;</span>
	}

	public String getGameName() {
<span class="nc" id="L534">		return gameName;</span>
	}

	public int getGameNumber() {
<span class="nc" id="L538">		return gameNumber;</span>
	}

	public String getGameType() {
<span class="nc" id="L542">		return gameType;</span>
	}

	public int getGameVirnDigits() {
<span class="nc" id="L546">		return gameVirnDigits;</span>
	}

	public int getGovt_commrate() {
<span class="nc" id="L550">		return govt_commrate;</span>
	}

	public int getGovt_pwt_commrate() {
<span class="nc" id="L554">		return govt_pwt_commrate;</span>
	}

	public Double getGovtCommRate() {
<span class="nc" id="L558">		return govtCommRate;</span>
	}

	public String getGovtCommRule() {
<span class="nc" id="L562">		return govtCommRule;</span>
	}

	public String getGovtPWTCommRate() {
<span class="nc" id="L566">		return govtPWTCommRate;</span>
	}

	public double getMinAssProfit() {
<span class="nc" id="L570">		return minAssProfit;</span>
	}

	public Boolean getNewGameAvailable() {
<span class="nc" id="L574">		return newGameAvailable;</span>
	}

	public String getPackNFrom() {
<span class="nc" id="L578">		return packNFrom;</span>
	}

	public String getPackNTo() {
<span class="nc" id="L582">		return packNTo;</span>
	}

	public String[] getPackNumberFrom() {
<span class="nc" id="L586">		return packNumberFrom;</span>
	}

	public String[] getPackNumberTo() {
<span class="nc" id="L590">		return packNumberTo;</span>
	}

	public List&lt;PackSeriesFlagBean&gt; getPackSeriesFlagList() {
<span class="nc" id="L594">		return packSeriesFlagList;</span>
	}

	public List&lt;PackNumberSeriesBean&gt; getPackSeriesList() {
<span class="nc" id="L598">		return packSeriesList;</span>
	}

	public double getPriceperTicket() {
<span class="nc" id="L602">		return priceperTicket;</span>
	}

	public double getPrizePayOutRatio() {
<span class="nc" id="L606">		return prizePayOutRatio;</span>
	}

	public String getPwtendDate() {
<span class="nc" id="L610">		return pwtendDate;</span>
	}

	public String getRankupload() {
<span class="nc" id="L614">		return rankupload;</span>
	}

	public HttpServletRequest getRequest() {
<span class="nc" id="L618">		return request;</span>
	}

	public HttpServletResponse getResponse() {
<span class="nc" id="L622">		return response;</span>
	}

	public String getRetailer_pwt_comm_rate() {
<span class="nc" id="L626">		return retailer_pwt_comm_rate;</span>
	}

	public String getRetailer_sale_comm_rate() {
<span class="nc" id="L630">		return retailer_sale_comm_rate;</span>
	}

	public double getRetailerPWTCommRate() {
<span class="nc" id="L634">		return retailerPWTCommRate;</span>
	}

	public double getRetailerSaleCommRate() {
<span class="nc" id="L638">		return retailerSaleCommRate;</span>
	}

	public String getSaleendDate() {
<span class="nc" id="L642">		return saleendDate;</span>
	}

	public int getStart() {
<span class="nc" id="L646">		return start;</span>
	}

	public String getStartDate() {
<span class="nc" id="L650">		return startDate;</span>
	}

	public List&lt;SupplierBean&gt; getSupplier_list() {
<span class="nc" id="L654">		return supplier_list;</span>
	}

	public String getSupplier_Name() {
<span class="nc" id="L658">		return supplier_Name;</span>
	}

	public int getSupplierId() {
<span class="nc" id="L662">		return supplierId;</span>
	}

	public List&lt;GameBean&gt; getTicket_game_list() {
<span class="nc" id="L666">		return ticket_game_list;</span>
	}

	public int getTicketpetBook() {
<span class="nc" id="L670">		return ticketpetBook;</span>
	}

	public long getTicketsInScheme() {
<span class="nc" id="L674">		return ticketsInScheme;</span>
	}

	public int[] getTotalpack() {
<span class="nc" id="L678">		return totalpack;</span>
	}

	public String getTotalPackStr() {
<span class="nc" id="L682">		return totalPackStr;</span>
	}

	public double getVatPercentage() {
<span class="nc" id="L686">		return vatPercentage;</span>
	}
	
	public Map&lt;Integer, String&gt; getWarehouseMap() {
<span class="nc" id="L690">		return warehouseMap;</span>
	}

	public void setWarehouseMap(Map&lt;Integer, String&gt; warehouseMap) {
<span class="nc" id="L694">		this.warehouseMap = warehouseMap;</span>
<span class="nc" id="L695">	}</span>
	
	public int getWarehouseId() {
<span class="nc" id="L698">		return warehouseId;</span>
	}

	public void setWarehouseId(int warehouseId) {
<span class="nc" id="L702">		this.warehouseId = warehouseId;</span>
<span class="nc" id="L703">	}</span>

	public String insertTicketsUploadInventoryInDb() throws LMSException {
<span class="nc" id="L706">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L707">		UserInfoBean userBean = new UserInfoBean();</span>
<span class="nc" id="L708">		userBean = (UserInfoBean) session.getAttribute(&quot;USER_INFO&quot;);</span>

<span class="nc" id="L710">		List&lt;PackNumberSeriesBean&gt; seriesList = new ArrayList&lt;PackNumberSeriesBean&gt;();</span>
<span class="nc" id="L711">		PackNumberSeriesBean seriesBean = null;</span>
<span class="nc" id="L712">		int packfromsize = getPackNumberFrom().length;</span>
		// int totalpck = getTotalpack().length;
		// int packto = getPackNumberTo().length;

<span class="nc" id="L716">		System.out.println(&quot;packseries list size: &quot; + packfromsize);</span>
		// get the total rows details of packs
<span class="nc bnc" id="L718" title="All 2 branches missed.">		for (int i = 0; i &lt; packfromsize; i++) {</span>
<span class="nc" id="L719">			String pnf = packNumberFrom[i];</span>
<span class="nc" id="L720">			int totpac = totalpack[i];</span>
<span class="nc" id="L721">			String pnt = packNumberTo[i];</span>
<span class="nc" id="L722">			System.out.println(&quot;packnumber Series Start From(pnf) &quot; + pnf);</span>
<span class="nc" id="L723">			System.out.println(&quot;packnumber Series End At(pnt) &quot; + pnt);</span>
<span class="nc bnc" id="L724" title="All 8 branches missed.">			if (pnf != null &amp;&amp; pnf != null &amp;&amp; pnt != null &amp;&amp; pnt != null) {</span>
<span class="nc" id="L725">				seriesBean = new PackNumberSeriesBean();</span>
<span class="nc" id="L726">				seriesBean.setPackNumberFrom(pnf);// by yogesh</span>
<span class="nc" id="L727">				seriesBean.setTotalpack(totpac);// by Mukul</span>
<span class="nc" id="L728">				seriesBean.setPackNumberTo(pnt); // by yogesh</span>
<span class="nc" id="L729">				seriesList.add(seriesBean);</span>
			}
		}
		// gameNameArr[1] = gameName and gameNameArr[0] = gameNbr
<span class="nc" id="L733">		String gameNameArr[] = this.gameName.split(&quot;-&quot;);</span>
<span class="nc" id="L734">		System.out.println(&quot;gameName of ticket uploaded = &quot; + gameName);</span>
<span class="nc" id="L735">		GameuploadHelper helper = new GameuploadHelper();</span>
<span class="nc" id="L736">		System.out.println(&quot;Pack Series List :&quot; + seriesList);</span>
<span class="nc" id="L737">		helper.insertTicketsInDB(seriesList, gameNameArr[1], Integer</span>
				.parseInt(gameNameArr[0]), getSupplierId(), userBean
				.getUserOrgId(), userBean.getUserId(), warehouseId);

<span class="nc" id="L741">		return SUCCESS;</span>
	}

	public String insertVirnZipFile() {
<span class="nc bnc" id="L745" title="All 2 branches missed.">		if (Unzip.insertVirnInDB(gameId)) {</span>
<span class="nc" id="L746">			return SUCCESS;</span>
		}
<span class="nc" id="L748">		System.out.println(&quot;********gameId::&quot; + gameId);</span>
<span class="nc" id="L749">		return SUCCESS;</span>
	}

	/**
	 * This method is used to display new games
	 * 
	 * @return String
	 * @author Skilrock Technologies
	 */

	public String newGamestoStart() {
<span class="nc" id="L760">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L761">		List&lt;GameBean&gt; newGameList = null;</span>
<span class="nc" id="L762">		GameuploadHelper gameuploadHelper = new GameuploadHelper();</span>
<span class="nc" id="L763">		newGameList = gameuploadHelper.getNewGames();</span>
<span class="nc" id="L764">		session.setAttribute(&quot;NEW_GAME_START_LIST&quot;, newGameList);</span>
<span class="nc" id="L765">		session.setAttribute(&quot;NEW_GAME_START_LIST1&quot;, newGameList);</span>
<span class="nc" id="L766">		session.setAttribute(&quot;startValueGameSearch&quot;, new Integer(0));</span>
<span class="nc bnc" id="L767" title="All 4 branches missed.">		if (newGameList != null &amp;&amp; newGameList.size() &gt; 0) {</span>
<span class="nc" id="L768">			startGameAjax();</span>
		}

<span class="nc" id="L771">		return SUCCESS;</span>

	}

	public void setAgent_pwt_comm_rate(String agent_pwt_comm_rate) {
<span class="nc" id="L776">		this.agent_pwt_comm_rate = agent_pwt_comm_rate;</span>
<span class="nc" id="L777">	}</span>

	public void setAgent_sale_comm_rate(String agent_sale_comm_rate) {
<span class="nc" id="L780">		this.agent_sale_comm_rate = agent_sale_comm_rate;</span>
<span class="nc" id="L781">	}</span>

	public void setAgentPWTCommRate(double agentPWTCommRate) {
<span class="nc" id="L784">		this.agentPWTCommRate = agentPWTCommRate;</span>
<span class="nc" id="L785">	}</span>

	public void setAgentSaleCommRate(double agentSaleCommRate) {
<span class="nc" id="L788">		this.agentSaleCommRate = agentSaleCommRate;</span>
<span class="nc" id="L789">	}</span>

	public void setBooksperPack(int booksperPack) {
<span class="nc" id="L792">		this.booksperPack = booksperPack;</span>
<span class="nc" id="L793">	}</span>

	public void setCallFlag(String callFlag) {
<span class="nc" id="L796">		this.callFlag = callFlag;</span>
<span class="nc" id="L797">	}</span>

	public void setConn(Connection conn) {
<span class="nc" id="L800">		this.conn = conn;</span>
<span class="nc" id="L801">	}</span>

	public void setDetails(String details) {
<span class="nc" id="L804">		this.details = details;</span>
<span class="nc" id="L805">	}</span>

	public void setDigitsofBook(int digitsofBook) {
<span class="nc" id="L808">		this.digitsofBook = digitsofBook;</span>
<span class="nc" id="L809">	}</span>

	public void setDigitsofPack(int digitsofPack) {
<span class="nc" id="L812">		this.digitsofPack = digitsofPack;</span>
<span class="nc" id="L813">	}</span>

	public void setDigitsofTicket(int digitsofTicket) {
<span class="nc" id="L816">		this.digitsofTicket = digitsofTicket;</span>
<span class="nc" id="L817">	}</span>

	public void setEnd(String end) {
<span class="nc" id="L820">		this.end = end;</span>
<span class="nc" id="L821">	}</span>

	public void setFilePath(String filePath) {
<span class="nc" id="L824">		this.filePath = filePath;</span>
<span class="nc" id="L825">	}</span>

	public void setGameId(int gameId) {
<span class="nc" id="L828">		this.gameId = gameId;</span>
<span class="nc" id="L829">	}</span>

	public void setGameName(String gameName) {
<span class="nc" id="L832">		this.gameName = gameName;</span>
<span class="nc" id="L833">	}</span>

	public void setGameNameInSession() throws Exception {

<span class="nc" id="L837">		int game_id = 0;</span>
<span class="nc" id="L838">		int game_nbr = 0;</span>
<span class="nc" id="L839">		int finalGameDigit = 0;</span>

		 
<span class="nc" id="L842">		Connection conn = null;</span>
<span class="nc" id="L843">		conn = DBConnect.getConnection();</span>

		try {

			// Getting Game Details using game id
<span class="nc" id="L848">			String query1 = QueryManager.getST4GameDetailsUsingGameName();</span>
<span class="nc" id="L849">			PreparedStatement stmt1 = conn.prepareStatement(query1);</span>
<span class="nc" id="L850">			ResultSet resultSet = null;</span>
<span class="nc" id="L851">			stmt1.setString(1, gameName);</span>
<span class="nc" id="L852">			resultSet = stmt1.executeQuery();</span>
<span class="nc bnc" id="L853" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L854">				game_id = resultSet.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L855">				game_nbr = resultSet.getInt(&quot;game_nbr&quot;);</span>
			}
<span class="nc" id="L857">			int game_nbr_digit = 0;</span>
<span class="nc" id="L858">			game_nbr_digit = findDigit(game_nbr);</span>
<span class="nc" id="L859">			System.out.println(&quot;game_id &quot; + game_id);</span>
<span class="nc" id="L860">			String query2 = &quot;select * from st_se_game_ticket_nbr_format where game_id = ?&quot;; // QueryManager.getST4GameDetailsUsingGameName();</span>
<span class="nc" id="L861">			PreparedStatement stmt2 = conn.prepareStatement(query2);</span>
<span class="nc" id="L862">			stmt2.setInt(1, game_id);</span>
<span class="nc" id="L863">			ResultSet resultSet2 = stmt2.executeQuery();</span>
<span class="nc bnc" id="L864" title="All 2 branches missed.">			while (resultSet2.next()) {</span>

<span class="nc" id="L866">				finalGameDigit = resultSet2.getInt(&quot;game_nbr_digits&quot;);</span>
			}

<span class="nc" id="L869">			System.out</span>
					.println(&quot;Ticket Formate is :-------------game digit------&quot;
							+ finalGameDigit);

			PrintWriter out;
<span class="nc" id="L874">			out = getResponse().getWriter();</span>
<span class="nc" id="L875">			String html = &quot;&lt;input type=\&quot;hidden\&quot; value=\&quot;&quot; + finalGameDigit</span>
					+ &quot;\&quot; id=\&quot;hidd\&quot;/&gt;&quot;;
<span class="nc" id="L877">			response.setContentType(&quot;text/html&quot;);</span>

<span class="nc" id="L879">			out.print(html);</span>

<span class="nc" id="L881">			HttpSession session = getRequest().getSession();</span>

<span class="nc" id="L883">			session.setAttribute(&quot;GAME_DIGITS&quot;, finalGameDigit);</span>

<span class="nc" id="L885">			System.out.println(&quot;printwriter out  ----&quot; + html);</span>

		} finally {
<span class="nc bnc" id="L888" title="All 4 branches missed.">			if (conn != null) {</span>
<span class="nc" id="L889">				conn.close();</span>
			}
		}
<span class="nc" id="L892">	}</span>

	public void setGameNumber(int gameNumber) {
<span class="nc" id="L895">		this.gameNumber = gameNumber;</span>
<span class="nc" id="L896">	}</span>

	public void setGameType(String gameType) {
<span class="nc" id="L899">		this.gameType = gameType;</span>
<span class="nc" id="L900">	}</span>

	public void setGameVirnDigits(int gameVirnDigits) {
<span class="nc" id="L903">		this.gameVirnDigits = gameVirnDigits;</span>
<span class="nc" id="L904">	}</span>

	public void setGovt_commrate(int govt_commrate) {
<span class="nc" id="L907">		this.govt_commrate = govt_commrate;</span>
<span class="nc" id="L908">	}</span>

	public void setGovt_pwt_commrate(int govt_pwt_commrate) {
<span class="nc" id="L911">		this.govt_pwt_commrate = govt_pwt_commrate;</span>
<span class="nc" id="L912">	}</span>

	public void setGovtCommRate(Double govtCommRate) {
<span class="nc" id="L915">		this.govtCommRate = govtCommRate;</span>
<span class="nc" id="L916">	}</span>

	public void setGovtCommRule(String govtCommRule) {
<span class="nc" id="L919">		this.govtCommRule = govtCommRule;</span>
<span class="nc" id="L920">	}</span>

	public void setGovtPWTCommRate(String govtPWTCommRate) {
<span class="nc" id="L923">		this.govtPWTCommRate = govtPWTCommRate;</span>
<span class="nc" id="L924">	}</span>

	public void setMinAssProfit(double minAssProfit) {
<span class="nc" id="L927">		this.minAssProfit = minAssProfit;</span>
<span class="nc" id="L928">	}</span>

	public void setNewGameAvailable(Boolean newGameAvailable) {
<span class="nc" id="L931">		this.newGameAvailable = newGameAvailable;</span>
<span class="nc" id="L932">	}</span>

	public void setPackNFrom(String packNFrom) {
<span class="nc" id="L935">		this.packNFrom = packNFrom;</span>
<span class="nc" id="L936">	}</span>

	public void setPackNTo(String packNTo) {
<span class="nc" id="L939">		this.packNTo = packNTo;</span>
<span class="nc" id="L940">	}</span>

	public void setPackNumberFrom(String[] packNumberFrom) {
<span class="nc" id="L943">		this.packNumberFrom = packNumberFrom;</span>
<span class="nc" id="L944">	}</span>

	public void setPackNumberTo(String[] packNumberTo) {
<span class="nc" id="L947">		this.packNumberTo = packNumberTo;</span>
<span class="nc" id="L948">	}</span>

	public void setPackSeriesFlagList(
			List&lt;PackSeriesFlagBean&gt; packSeriesFlagList) {
<span class="nc" id="L952">		this.packSeriesFlagList = packSeriesFlagList;</span>
<span class="nc" id="L953">	}</span>

	public void setPackSeriesList(List&lt;PackNumberSeriesBean&gt; packSeriesList) {
<span class="nc" id="L956">		this.packSeriesList = packSeriesList;</span>
<span class="nc" id="L957">	}</span>

	public void setPriceperTicket(double priceperTicket) {
<span class="nc" id="L960">		this.priceperTicket = priceperTicket;</span>
<span class="nc" id="L961">	}</span>

	public void setPrizePayOutRatio(double prizePayOutRatio) {
<span class="nc" id="L964">		this.prizePayOutRatio = prizePayOutRatio;</span>
<span class="nc" id="L965">	}</span>

	public void setPwtendDate(String pwtendDate) {
<span class="nc" id="L968">		this.pwtendDate = pwtendDate;</span>
<span class="nc" id="L969">	}</span>

	public void setRankupload(String rankupload) {
<span class="nc" id="L972">		this.rankupload = rankupload;</span>
<span class="nc" id="L973">	}</span>

	public void setRequest(HttpServletRequest request) {
<span class="nc" id="L976">		this.request = request;</span>
<span class="nc" id="L977">	}</span>

	public void setResponse(HttpServletResponse response) {
<span class="nc" id="L980">		this.response = response;</span>
<span class="nc" id="L981">	}</span>

	public void setRetailer_pwt_comm_rate(String retailer_pwt_comm_rate) {
<span class="nc" id="L984">		this.retailer_pwt_comm_rate = retailer_pwt_comm_rate;</span>
<span class="nc" id="L985">	}</span>

	public void setRetailer_sale_comm_rate(String retailer_sale_comm_rate) {
<span class="nc" id="L988">		this.retailer_sale_comm_rate = retailer_sale_comm_rate;</span>
<span class="nc" id="L989">	}</span>

	public void setRetailerPWTCommRate(double retailerPWTCommRate) {
<span class="nc" id="L992">		this.retailerPWTCommRate = retailerPWTCommRate;</span>
<span class="nc" id="L993">	}</span>

	public void setRetailerSaleCommRate(double retailerSaleCommRate) {
<span class="nc" id="L996">		this.retailerSaleCommRate = retailerSaleCommRate;</span>
<span class="nc" id="L997">	}</span>

	public void setSaleendDate(String saleendDate) {
<span class="nc" id="L1000">		this.saleendDate = saleendDate;</span>
<span class="nc" id="L1001">	}</span>

	public void setServletRequest(HttpServletRequest request) {
<span class="nc" id="L1004">		this.request = request;</span>

<span class="nc" id="L1006">	}</span>

	public void setServletResponse(HttpServletResponse response) {
<span class="nc" id="L1009">		this.response = response;</span>
		// TODO Auto-generated method stub

<span class="nc" id="L1012">	}</span>

	public void setStart(int start) {
<span class="nc" id="L1015">		this.start = start;</span>
<span class="nc" id="L1016">	}</span>

	public void setStartDate(String startDate) {
<span class="nc" id="L1019">		this.startDate = startDate;</span>
<span class="nc" id="L1020">	}</span>

	public void setSupplier_list(List&lt;SupplierBean&gt; supplier_list) {
<span class="nc" id="L1023">		this.supplier_list = supplier_list;</span>
<span class="nc" id="L1024">	}</span>

	public void setSupplier_Name(String supplier_Name) {
<span class="nc" id="L1027">		this.supplier_Name = supplier_Name;</span>
<span class="nc" id="L1028">	}</span>

	public void setSupplierId(int supplierId) {
<span class="nc" id="L1031">		this.supplierId = supplierId;</span>
<span class="nc" id="L1032">	}</span>

	public void setTicket_game_list(List&lt;GameBean&gt; ticket_game_list) {
<span class="nc" id="L1035">		this.ticket_game_list = ticket_game_list;</span>
<span class="nc" id="L1036">	}</span>

	public void setTicketpetBook(int ticketpetBook) {
<span class="nc" id="L1039">		this.ticketpetBook = ticketpetBook;</span>
<span class="nc" id="L1040">	}</span>

	public void setTicketsInScheme(long ticketsInScheme) {
<span class="nc" id="L1043">		this.ticketsInScheme = ticketsInScheme;</span>
<span class="nc" id="L1044">	}</span>

	public void setTotalpack(int[] totalpack) {
<span class="nc" id="L1047">		this.totalpack = totalpack;</span>
<span class="nc" id="L1048">	}</span>

	public void setTotalPackStr(String totalPackStr) {
<span class="nc" id="L1051">		this.totalPackStr = totalPackStr;</span>
<span class="nc" id="L1052">	}</span>

	public void setVatPercentage(double vatPercentage) {
<span class="nc" id="L1055">		this.vatPercentage = vatPercentage;</span>
<span class="nc" id="L1056">	}</span>

	/**
	 * This method is used to start new games
	 * 
	 * @return String
	 * @author Skilrock Technologies
	 */

	public String startGame() {

<span class="nc" id="L1067">		GameuploadHelper gameuploadHelper = new GameuploadHelper();</span>
<span class="nc" id="L1068">		gameuploadHelper.startGame(getGameId());</span>
<span class="nc" id="L1069">		return SUCCESS;</span>

	}

	/**
	 * This method is used for pagination of Company(Org) search Results .
	 * 
	 * @return SUCCESS
	 */
	public String startGameAjax() {
<span class="nc" id="L1079">		int endValue = 0;</span>
<span class="nc" id="L1080">		int startValue = 0;</span>
		// PrintWriter out = getResponse().getWriter();
<span class="nc" id="L1082">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L1083">		List&lt;GameBean&gt; ajaxList = (List) session</span>
				.getAttribute(&quot;NEW_GAME_START_LIST1&quot;);
<span class="nc" id="L1085">		List&lt;GameBean&gt; ajaxSearchList = new ArrayList();</span>
<span class="nc" id="L1086">		System.out.println(&quot;end &quot; + ajaxList);</span>
<span class="nc bnc" id="L1087" title="All 2 branches missed.">		if (ajaxList != null) {</span>
<span class="nc bnc" id="L1088" title="All 2 branches missed.">			if (getEnd() != null) {</span>
<span class="nc" id="L1089">				end = getEnd();</span>
			} else {
<span class="nc" id="L1091">				end = &quot;first&quot;;</span>
			}
			// System.out.println(&quot;end &quot;+end);
<span class="nc" id="L1094">			startValue = (Integer) session.getAttribute(&quot;startValueGameSearch&quot;);</span>
<span class="nc bnc" id="L1095" title="All 2 branches missed.">			if (end.equals(&quot;first&quot;)) {</span>
<span class="nc" id="L1096">				System.out.println(&quot;i m in first&quot;);</span>
<span class="nc" id="L1097">				startValue = 0;</span>
<span class="nc" id="L1098">				endValue = startValue + 5;</span>

<span class="nc bnc" id="L1100" title="All 2 branches missed.">				if (endValue &gt; ajaxList.size()) {</span>
<span class="nc" id="L1101">					endValue = ajaxList.size();</span>
				}
<span class="nc bnc" id="L1103" title="All 2 branches missed.">			} else if (end.equals(&quot;Previous&quot;)) {</span>
<span class="nc" id="L1104">				System.out.println(&quot;i m in Previous&quot;);</span>
<span class="nc" id="L1105">				startValue = startValue - 5;</span>
<span class="nc bnc" id="L1106" title="All 2 branches missed.">				if (startValue &lt; 5) {</span>
<span class="nc" id="L1107">					startValue = 0;</span>
				}
<span class="nc" id="L1109">				endValue = startValue + 5;</span>
<span class="nc bnc" id="L1110" title="All 2 branches missed.">				if (endValue &gt; ajaxList.size()) {</span>
<span class="nc" id="L1111">					endValue = ajaxList.size();</span>
				}
<span class="nc bnc" id="L1113" title="All 2 branches missed.">			} else if (end.equals(&quot;Next&quot;)) {</span>
<span class="nc" id="L1114">				System.out.println(&quot;i m in Next&quot;);</span>
<span class="nc" id="L1115">				startValue = startValue + 5;</span>
<span class="nc" id="L1116">				endValue = startValue + 5;</span>
<span class="nc bnc" id="L1117" title="All 2 branches missed.">				if (endValue &gt; ajaxList.size()) {</span>
<span class="nc" id="L1118">					endValue = ajaxList.size();</span>
				}
<span class="nc bnc" id="L1120" title="All 2 branches missed.">				if (startValue &gt; ajaxList.size()) {</span>
<span class="nc" id="L1121">					startValue = ajaxList.size() - ajaxList.size() % 5;</span>
				}
<span class="nc bnc" id="L1123" title="All 2 branches missed.">			} else if (end.equals(&quot;last&quot;)) {</span>
<span class="nc" id="L1124">				endValue = ajaxList.size();</span>
<span class="nc" id="L1125">				startValue = endValue - endValue % 5;</span>

			}
<span class="nc bnc" id="L1128" title="All 2 branches missed.">			if (startValue == endValue) {</span>
<span class="nc" id="L1129">				startValue = endValue - 5;</span>
			}
			// System.out.println(&quot;End value&quot;+endValue);
			// System.out.println(&quot;Start Value&quot;+startValue);
<span class="nc bnc" id="L1133" title="All 2 branches missed.">			for (int i = startValue; i &lt; endValue; i++) {</span>
<span class="nc" id="L1134">				ajaxSearchList.add(ajaxList.get(i));</span>
<span class="nc" id="L1135">				System.out.println(&quot;for loop &quot; + i + &quot;times&quot;);</span>
			}
<span class="nc" id="L1137">			session.setAttribute(&quot;NEW_GAME_START_LIST&quot;, ajaxSearchList);</span>
<span class="nc" id="L1138">			session.setAttribute(&quot;startValueGameSearch&quot;, startValue);</span>
		}
<span class="nc" id="L1140">		return SUCCESS;</span>
	}

	// when radio button clicked
	public void TicketsUploadGameNameAjax() {
<span class="nc" id="L1145">		System.out.println(&quot;Hello&quot; + getGameType());</span>
		PrintWriter out;
		try {
<span class="nc" id="L1148">			out = getResponse().getWriter();</span>
<span class="nc" id="L1149">			String game_type = getGameType();</span>
<span class="nc" id="L1150">			System.out.println(&quot;&quot; + game_type);</span>
<span class="nc bnc" id="L1151" title="All 2 branches missed.">			if (game_type == null) {</span>
<span class="nc" id="L1152">				game_type = &quot;&quot;;</span>
			}
<span class="nc" id="L1154">			GameuploadHelper gameuploadHelper = new GameuploadHelper();</span>
<span class="nc" id="L1155">			ArrayList&lt;GameBean&gt; game = gameuploadHelper</span>
					.fatchGameList(game_type);
<span class="nc" id="L1157">			System.out.println(&quot;Game List is: &quot; + game);</span>
<span class="nc" id="L1158">			StringBuilder html = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L1159">			html</span>
					.append(&quot;&lt;select name=\&quot;gameName\&quot; class=\&quot;option\&quot; id=\&quot;gameNameId\&quot; onblur=\&quot;check()\&quot; onchange=\&quot;disableSubmit(),setGameDigit()\&quot;&gt;&lt;option class=\&quot;option\&quot; value=\&quot;Please Select\&quot;&gt;Please Select&lt;/option&gt;&quot;);
<span class="nc" id="L1161">			int i = 0;</span>
<span class="nc" id="L1162">			GameBean bean = null;</span>
<span class="nc bnc" id="L1163" title="All 2 branches missed.">			for (Iterator&lt;GameBean&gt; it = game.iterator(); it.hasNext();) {</span>
<span class="nc" id="L1164">				bean = it.next();</span>
<span class="nc" id="L1165">				String name = bean.getGameName();</span>
<span class="nc" id="L1166">				i++;</span>
<span class="nc" id="L1167">				html.append(&quot;&lt;option class=\&quot;option\&quot; value=\&quot;&quot; + name + &quot;\&quot;&gt;&quot;</span>
						+ name + &quot;&lt;/option&gt;&quot;);
<span class="nc" id="L1169">			}</span>
<span class="nc" id="L1170">			html.append(&quot;&lt;/select&gt;&quot;);</span>
<span class="nc" id="L1171">			response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L1172">			out.print(html.toString());</span>
<span class="nc" id="L1173">			System.out.println(&quot;Hello&quot; + html);</span>

<span class="nc" id="L1175">		} catch (IOException e) {</span>
<span class="nc" id="L1176">			e.printStackTrace();</span>
<span class="nc" id="L1177">		} catch (Exception e) {</span>
<span class="nc" id="L1178">			e.printStackTrace();</span>
<span class="nc" id="L1179">		}</span>
<span class="nc" id="L1180">	}</span>

	/**
	 * This method is used to Upload games basic details and rank file. throws
	 * LMSException
	 * 
	 * @return SUCCESS
	 */
	public String uploadBasicDetails() throws Exception {

<span class="nc" id="L1190">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L1191">		String govt_comm_type = null;</span>
<span class="nc" id="L1192">		System.out.println(&quot;rule is &quot; + getGovtCommRule());</span>
<span class="nc bnc" id="L1193" title="All 2 branches missed.">		if (govtCommRule.equals(&quot;fixedper&quot;)) {</span>
<span class="nc" id="L1194">			System.out.println(&quot;inside this&quot;);</span>
<span class="nc" id="L1195">			govt_comm_type = &quot;FIXED_PER&quot;;</span>

<span class="nc bnc" id="L1197" title="All 2 branches missed.">		} else if (govtCommRule.equals(&quot;minprofit&quot;)) {</span>
<span class="nc" id="L1198">			govt_comm_type = &quot;MIN_PROFIT&quot;;</span>
<span class="nc bnc" id="L1199" title="All 2 branches missed.">		} else if (govtCommRule.equals(&quot;notapplicable&quot;)) {</span>
<span class="nc" id="L1200">			govt_comm_type = &quot;NOT_APP&quot;;</span>
		}

<span class="nc" id="L1203">		String defaultInvoiceMethod = (String) ServletActionContext.getServletContext().getAttribute(&quot;SCRATCH_INVOICING_METHOD_DEFAULT&quot;);</span>
<span class="nc" id="L1204">		logger.info(&quot;DEFAULT INVOICING METHOD : &quot; +  defaultInvoiceMethod);</span>
		
<span class="nc" id="L1206">		GameuploadHelper gameHelper = new GameuploadHelper();</span>
<span class="nc" id="L1207">		String returnType = gameHelper.uploadBasicDetails(govt_comm_type,</span>
				priceperTicket, gameNumber, gameName, ticketpetBook,
				booksperPack, agentSaleCommRate, agentPWTCommRate,
				retailerSaleCommRate, retailerPWTCommRate, govtCommRate,
				minAssProfit, getDigitsofPack(), getDigitsofBook(),
				getDigitsofTicket(), getRankupload(), getPrizePayOutRatio(),
				getVatPercentage(), getTicketsInScheme(), getGameVirnDigits(), defaultInvoiceMethod);
<span class="nc bnc" id="L1214" title="All 2 branches missed.">		if (returnType.equals(&quot;ERROR&quot;)) {</span>
<span class="nc" id="L1215">			addActionError(getText(&quot;msg.this.game.uploaded.previously&quot;));</span>
<span class="nc" id="L1216">			return ERROR;</span>

		} else { // remove session attributes
<span class="nc" id="L1219">			session.removeAttribute(&quot;x&quot;);</span>
<span class="nc" id="L1220">			return SUCCESS;</span>
		}

	}

	// public String uploadVirnFile() throws LMSException {
	public String uploadVirn() throws LMSException {

<span class="nc" id="L1228">		GameuploadHelper helper = new GameuploadHelper();</span>
<span class="nc" id="L1229">		String type = SUCCESS;</span>
<span class="nc" id="L1230">		String gameNameArr[] = gameName.split(&quot;-&quot;);</span>
<span class="nc" id="L1231">		final String ENC_SCHEME_TYPE = &quot;1W_ENC_OF_ALL&quot;;</span>
<span class="nc" id="L1232">		System.out.println(&quot;**********details**********\n&quot; + details);</span>
		// type = helper.uploadVirnFile(Integer.parseInt(gameNameArr[0]),
		// gameNameArr[1], details, startDate, saleendDate, pwtendDate,
		// ENC_SCHEME_TYPE);
<span class="nc" id="L1236">		Unzip unzip = new Unzip();</span>
<span class="nc" id="L1237">		unzip.virnFileUpload(Integer.parseInt(gameNameArr[0]), gameNameArr[1],</span>
				details, startDate, saleendDate, pwtendDate, ENC_SCHEME_TYPE);
<span class="nc bnc" id="L1239" title="All 2 branches missed.">		if (&quot;ERROR&quot;.equalsIgnoreCase(type)) {</span>
<span class="nc" id="L1240">			addActionError(getText(&quot;msg.this.file.uploaded.priviously&quot;));</span>
		}
<span class="nc" id="L1242">		return type;</span>
	}

	public void VirnUploadGameNameAjax() {
		PrintWriter out;

		try {
<span class="nc" id="L1249">			out = getResponse().getWriter();</span>

<span class="nc" id="L1251">			String game_type = getGameType();</span>
<span class="nc" id="L1252">			System.out.println(&quot;&quot; + game_type);</span>
<span class="nc bnc" id="L1253" title="All 2 branches missed.">			if (game_type == null) {</span>
<span class="nc" id="L1254">				game_type = &quot;&quot;;</span>
			}
<span class="nc" id="L1256">			GameuploadHelper gameuploadHelper = new GameuploadHelper();</span>
<span class="nc" id="L1257">			ArrayList&lt;GameBean&gt; game = gameuploadHelper</span>
					.fatchVirnGameList(game_type);

<span class="nc" id="L1260">			String html = &quot;&quot;;</span>
<span class="nc" id="L1261">			html = &quot;&lt;select class=\&quot;option\&quot; name=\&quot;gameName\&quot; id=\&quot;game_Name\&quot; onchange=\&quot;gameDatesfromDB()\&quot;&gt;&lt;option class=\&quot;option\&quot; value=\&quot;Please Select\&quot;&gt;Please Select&lt;/option&gt;&quot;;</span>
<span class="nc" id="L1262">			int i = 0;</span>
<span class="nc" id="L1263">			GameBean bean = null;</span>
<span class="nc bnc" id="L1264" title="All 2 branches missed.">			for (Iterator&lt;GameBean&gt; it = game.iterator(); it.hasNext();) {</span>
<span class="nc" id="L1265">				bean = it.next();</span>
<span class="nc" id="L1266">				String name = bean.getGameName();</span>
<span class="nc" id="L1267">				i++;</span>
<span class="nc" id="L1268">				html += &quot;&lt;option class=\&quot;option\&quot; value=\&quot;&quot; + name + &quot;\&quot;&gt;&quot;</span>
						+ name + &quot;&lt;/option&gt;&quot;;
<span class="nc" id="L1270">			}</span>
<span class="nc" id="L1271">			html += &quot;&lt;/select&gt;&quot;;</span>
<span class="nc" id="L1272">			response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L1273">			out.print(html);</span>
<span class="nc" id="L1274">			System.out.println(html);</span>

<span class="nc" id="L1276">		} catch (IOException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L1278">			e.printStackTrace();</span>
<span class="nc" id="L1279">		} catch (Exception e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L1281">			e.printStackTrace();</span>
<span class="nc" id="L1282">		}</span>

<span class="nc" id="L1284">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>