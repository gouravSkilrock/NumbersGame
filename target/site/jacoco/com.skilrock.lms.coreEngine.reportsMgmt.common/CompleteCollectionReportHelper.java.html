<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CompleteCollectionReportHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.reportsMgmt.common</a> &gt; <span class="el_source">CompleteCollectionReportHelper.java</span></div><h1>CompleteCollectionReportHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.reportsMgmt.common;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Timestamp;
import java.util.Calendar;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.Map;
import java.util.TreeMap;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.beans.CompleteCollectionBean;
import com.skilrock.lms.beans.ReportStatusBean;
import com.skilrock.lms.common.Utility;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.DBConnectReplica;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.filter.LMSFilterDispatcher;
import com.skilrock.lms.web.reportsMgmt.common.ReportUtility;

<span class="nc" id="L27">public class CompleteCollectionReportHelper implements</span>
		ICompleteCollectionReportHelper {
<span class="nc" id="L29">	static Log logger = LogFactory.getLog(CompleteCollectionReportHelper.class);</span>
<span class="nc" id="L30">	StringBuilder dates = null;</span>

	public Map&lt;String, Double&gt; agentDirectPlayerPwt(Timestamp startDate,
			Timestamp endDate, int agtOrgId, ReportStatusBean reportStatusBean) {
<span class="nc" id="L34">		Connection con = null;</span>
<span class="nc" id="L35">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L36">		ResultSet rs = null;</span>
<span class="nc" id="L37">		String dirPwtQry = null;</span>
<span class="nc" id="L38">		Map&lt;String, Double&gt; dirPlrPwtMap = new LinkedHashMap&lt;String, Double&gt;();</span>
		// Draw Direct Player Qry
		try {
<span class="nc bnc" id="L41" title="All 4 branches missed.">			if(&quot;NO&quot;.equals(Utility.getPropertyValue(&quot;IS_DATA_FROM_REPLICA&quot;)) || &quot;MAIN_DB&quot;.equals(reportStatusBean.getReportingFrom()))</span>
<span class="nc" id="L42">				con = DBConnect.getConnection();</span>
			else
<span class="nc" id="L44">				con = DBConnectReplica.getConnection();</span>

<span class="nc" id="L46">			dirPwtQry = &quot;select agent_org_id,sum(pwt_amt+agt_claim_comm) pwtDir from st_dg_agt_direct_plr_pwt where transaction_date&gt;=? and transaction_date&lt;=? and agent_org_id=? group by agent_org_id&quot;;</span>
<span class="nc" id="L47">			pstmt = con.prepareStatement(dirPwtQry);</span>
<span class="nc" id="L48">			pstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L49">			pstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L50">			pstmt.setInt(3, agtOrgId);</span>
<span class="nc" id="L51">			logger.info(&quot;-------Draw Direct Player Qry------\n&quot; + pstmt);</span>
<span class="nc" id="L52">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L54">				dirPlrPwtMap.put(&quot;DG&quot;, rs.getDouble(&quot;pwtDir&quot;));</span>
			} else {
<span class="nc" id="L56">				dirPlrPwtMap.put(&quot;DG&quot;, 0.0);</span>
			}
			// Scratch Direct Player Qry

<span class="nc" id="L60">			dirPwtQry = &quot;select agent_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwtDir from st_se_agt_direct_player_pwt where transaction_date&gt;=? and transaction_date&lt;=? and agent_org_id=? group by agent_org_id&quot;;</span>
<span class="nc" id="L61">			pstmt = con.prepareStatement(dirPwtQry);</span>
<span class="nc" id="L62">			pstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L63">			pstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L64">			pstmt.setInt(3, agtOrgId);</span>
<span class="nc" id="L65">			logger.info(&quot;-------Scratch Direct Player Qry------\n&quot;</span>
					+ pstmt);
<span class="nc" id="L67">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L68" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L69">				dirPlrPwtMap.put(&quot;SE&quot;, rs.getDouble(&quot;pwtDir&quot;));</span>
			} else {
<span class="nc" id="L71">				dirPlrPwtMap.put(&quot;SE&quot;, 0.0);</span>
			}
<span class="nc" id="L73">			DBConnect.closeCon(con);</span>
<span class="nc" id="L74">		} catch (Exception e) {</span>

<span class="nc" id="L76">		}</span>
<span class="nc" id="L77">		return dirPlrPwtMap;</span>
	}



	public Map&lt;String, CompleteCollectionBean&gt; collectionAgentWise(
			Timestamp startDate, Timestamp endDate, Connection con) {
<span class="nc" id="L84">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L85">		ResultSet rsGame = null;</span>
<span class="nc" id="L86">		ResultSet rs = null;</span>
<span class="nc" id="L87">		ResultSet rsRetOrg = null;</span>
<span class="nc" id="L88">		Map&lt;String, CompleteCollectionBean&gt; agtMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L89">		CompleteCollectionBean collBean = null;</span>
		// for Draw Game
<span class="nc" id="L91">		String saleTranDG = null;</span>
<span class="nc" id="L92">		String cancelTranDG = null;</span>
<span class="nc" id="L93">		String pwtTranDG = null;</span>
		
		//for CS Products
<span class="nc" id="L96">		String saleTranCS = null;</span>
<span class="nc" id="L97">		String cancelTranCS = null;</span>
		
		//for OLA
		
<span class="nc" id="L101">		String depositTranOLA = null;</span>
<span class="nc" id="L102">		String cancelTranOLA = null;</span>
<span class="nc" id="L103">		String withdrawalOLA = null;</span>

<span class="nc bnc" id="L105" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L106">			return agtMap;</span>
		}

		// for scratch game
		try {

			// Get All Agent
			
			
<span class="nc" id="L115">			String agtOrgQry = QueryManager.getOrgQry(&quot;AGENT&quot;);</span>
			
<span class="nc" id="L117">			pstmt = con.prepareStatement(agtOrgQry);</span>
<span class="nc" id="L118">			rsRetOrg = pstmt.executeQuery();</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">			while (rsRetOrg.next()) {</span>
<span class="nc" id="L120">				collBean = new CompleteCollectionBean();</span>
<span class="nc" id="L121">				collBean.setOrgName(rsRetOrg.getString(&quot;orgCode&quot;));</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">				if (ReportUtility.isDG) {</span>
<span class="nc" id="L123">					collBean.setDrawSale(0.0);</span>
<span class="nc" id="L124">					collBean.setDrawPwt(0.0);</span>
<span class="nc" id="L125">					collBean.setDrawCancel(0.0);</span>
<span class="nc" id="L126">					collBean.setDrawDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L128" title="All 2 branches missed.">				if (ReportUtility.isSE) {</span>
<span class="nc" id="L129">					collBean.setScratchSale(0.0);</span>
<span class="nc" id="L130">					collBean.setScratchPwt(0.0);</span>
<span class="nc" id="L131">					collBean.setScratchDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L133" title="All 2 branches missed.">				if(ReportUtility.isCS) {</span>
<span class="nc" id="L134">					collBean.setCSSale(0.0);</span>
<span class="nc" id="L135">					collBean.setCSCancel(0.0);</span>
				}
<span class="nc bnc" id="L137" title="All 2 branches missed.">				if(ReportUtility.isOLA)</span>
				{
<span class="nc" id="L139">					collBean.setOlaDepositAmt(0.0);</span>
<span class="nc" id="L140">					collBean.setOlaWithdrawalAmt(0.0);</span>
<span class="nc" id="L141">					collBean.setOlaDepositCancelAmt(0.0);</span>
<span class="nc" id="L142">					collBean.setOlaNetGaming(0.0);</span>
				}
<span class="nc" id="L144">				agtMap.put(rsRetOrg.getString(&quot;organization_id&quot;), collBean);</span>
			}
<span class="nc bnc" id="L146" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L147">				saleTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_SALE','DG_SALE_OFFLINE') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where organization_type='RETAILER')&quot;;
<span class="nc" id="L152">				cancelTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where organization_type='RETAILER')&quot;;
<span class="nc" id="L157">				pwtTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where organization_type='RETAILER')&quot;;

				// Game Master Query
<span class="nc" id="L164">				String gameQry = ReportUtility.getDrawGameMapQuery(startDate);</span>
<span class="nc" id="L165">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L166">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L167">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select parent_id,sum(sale) as sale from (&quot;);
<span class="nc" id="L169">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select parent_id,sum(cancel) as cancel from (&quot;);
<span class="nc" id="L171">				StringBuilder pwtQry = new StringBuilder(</span>
						&quot;select parent_id,sum(pwt) as pwt from (&quot;);
<span class="nc bnc" id="L173" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L174">					saleQry</span>
							.append(&quot;(select bb.parent_id,sum(sale) as sale from (select drs.retailer_org_id,sum(agent_net_amt) as sale from st_dg_ret_sale_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; drs where transaction_id in (&quot;
									+ saleTranDG
									+ &quot;) group by drs.retailer_org_id) aa,st_lms_organization_master bb where retailer_org_id=organization_id group by parent_id) union all&quot;);

<span class="nc" id="L181">					cancelQry</span>
							.append(&quot;(select bb.parent_id,sum(cancel) as cancel from (select drs.retailer_org_id,sum(agent_net_amt) as cancel from st_dg_ret_sale_refund_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; drs where transaction_id in (&quot;
									+ cancelTranDG
									+ &quot;) group by drs.retailer_org_id) aa,st_lms_organization_master bb where retailer_org_id=organization_id group by parent_id) union all&quot;);

<span class="nc" id="L188">					pwtQry</span>
							.append(&quot;(select bb.parent_id,sum(pwt) as pwt from (select drs.retailer_org_id,sum(pwt_amt+agt_claim_comm) as pwt from st_dg_ret_pwt_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; drs where transaction_id in (&quot;
									+ pwtTranDG
									+ &quot;) group by drs.retailer_org_id) aa,st_lms_organization_master bb where retailer_org_id=organization_id group by parent_id) union all&quot;);

				}

<span class="nc" id="L197">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;), saleQry</span>
						.length());
<span class="nc" id="L199">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;), cancelQry</span>
						.length());
<span class="nc" id="L201">				pwtQry.delete(pwtQry.lastIndexOf(&quot;union all&quot;), pwtQry.length());</span>

<span class="nc" id="L203">				saleQry.append(&quot;) saleTlb group by parent_id&quot;);</span>
<span class="nc" id="L204">				cancelQry.append(&quot;) cancelTlb group by parent_id&quot;);</span>
<span class="nc" id="L205">				pwtQry.append(&quot;) pwtTlb group by parent_id&quot;);</span>
<span class="nc" id="L206">				logger.info(&quot;-------Draw Sale Qurey------\n&quot; + saleQry);</span>
<span class="nc" id="L207">				logger.info(&quot;-------Draw Cancel Qurey------\n&quot;</span>
						+ cancelQry);
<span class="nc" id="L209">				logger.info(&quot;-------Draw Pwt Qurey------\n&quot; + pwtQry);</span>

				// Draw Sale Query
<span class="nc" id="L212">				pstmt = con.prepareStatement(saleQry.toString());</span>
<span class="nc" id="L213">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L215">					agtMap.get(rs.getString(&quot;parent_id&quot;)).setDrawSale(</span>
							rs.getDouble(&quot;sale&quot;));
				}
				// Draw Cancel Query
<span class="nc" id="L219">				pstmt = con.prepareStatement(cancelQry.toString());</span>
<span class="nc" id="L220">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L222">					agtMap.get(rs.getString(&quot;parent_id&quot;)).setDrawCancel(</span>
							rs.getDouble(&quot;cancel&quot;));
				}
				// Draw Pwt Query
<span class="nc" id="L226">				pstmt = con.prepareStatement(pwtQry.toString());</span>
<span class="nc" id="L227">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L229">					agtMap.get(rs.getString(&quot;parent_id&quot;)).setDrawPwt(</span>
							rs.getDouble(&quot;pwt&quot;));
				}

				// Draw Direct Player Qry

<span class="nc" id="L235">				String dirPwtQry = &quot;select agent_org_id,sum(pwt_amt+agt_claim_comm) pwtDir from st_dg_agt_direct_plr_pwt where transaction_date&gt;=? and transaction_date&lt;=? group by agent_org_id&quot;;</span>
<span class="nc" id="L236">				pstmt = con.prepareStatement(dirPwtQry);</span>
<span class="nc" id="L237">				pstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L238">				pstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L239">				System.out.println(&quot;-------Draw Direct Player Qry------\n&quot;</span>
						+ pstmt);
<span class="nc" id="L241">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L242" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L243">					agtMap.get(rs.getString(&quot;agent_org_id&quot;)).setDrawDirPlyPwt(</span>
							rs.getDouble(&quot;pwtDir&quot;));
				}
			}
<span class="nc bnc" id="L247" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
				// Calculate Scratch Sale
<span class="nc" id="L249">				String saleQry = &quot;&quot;;</span>
				
<span class="nc bnc" id="L251" title="All 2 branches missed.">				if (&quot;BOOK_WISE&quot;.equals(LMSFilterDispatcher.seSaleReportType)) {</span>
<span class="nc" id="L252">					saleQry = &quot;select organization_id,name,ifnull(mrpAmt,0.0) mrpAmt,ifnull(netAmt,0.0) netAmt from st_lms_organization_master left outer join (select sale.agent_org_id,(ifnull(mrpAmt,0.0)-ifnull(mrpAmtRet,0.0)) mrpAmt,(ifnull(netAmt,0.0)-ifnull(netAmtRet,0.0)) netAmt from (select agent_org_id,sum(mrpAmt) mrpAmt,sum(netAmt) netAmt from (select agent_org_id,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_bo_agent_transaction where transaction_id in (select transaction_id from st_lms_bo_transaction_master where transaction_type='SALE' and transaction_date&gt;='&quot;</span>
							+ startDate
							+ &quot;'  and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' ) group by agent_org_id union all select agent_org_id,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from  st_se_bo_agent_loose_book_transaction where transaction_id in (select transaction_id from st_lms_bo_transaction_master where transaction_type='LOOSE_SALE' and transaction_date&gt;='&quot;
							+ startDate
							+ &quot;'  and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' ) group by agent_org_id) sale group by agent_org_id) sale left outer join (select agent_org_id,sum(mrpAmtRet) mrpAmtRet,sum(netAmtRet) netAmtRet from (select agent_org_id,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_bo_agent_transaction where transaction_id in (select transaction_id from st_lms_bo_transaction_master where transaction_type='SALE_RET' and transaction_date&gt;='&quot;
							+ startDate
							+ &quot;'  and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' ) group by agent_org_id union all select agent_org_id,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_bo_agent_loose_book_transaction where transaction_id in (select transaction_id from st_lms_bo_transaction_master where transaction_type='LOOSE_SALE_RET' and transaction_date&gt;='&quot;
							+ startDate
							+ &quot;'  and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' ) group by agent_org_id)saleRet group by agent_org_id ) saleRet on sale.agent_org_id=saleRet.agent_org_id) saleTlb on organization_id=agent_org_id where organization_type='AGENT'&quot;;
<span class="nc bnc" id="L269" title="All 2 branches missed.">				} else if (&quot;TICKET_WISE&quot;</span>
						.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L271">					saleQry = &quot;select organization_id,name,ifnull(mrpAmt,0.0) mrpAmt,ifnull(netAmt,0.0) netAmt from st_lms_organization_master left outer join (select current_owner_id,sum(soldTkt*ticket_price) mrpAmt,sum((soldTkt*ticket_price)-(soldTkt*ticket_price*transacrion_sale_comm_rate*0.01)) netAmt from st_se_game_master gm,st_se_game_inv_detail gid,(select game_id,book_nbr,sum(sold_tickets) soldTkt from st_se_game_ticket_inv_history where date&gt;='&quot;</span>
							+ startDate
							+ &quot;' and date&lt;='&quot;
							+ endDate
							+ &quot;' and current_owner='RETAILER' group by book_nbr) TktTlb where gm.game_id=TktTlb.game_id and TktTlb.book_nbr=gid.book_nbr and gid.current_owner='AGENT' group by current_owner_id) saleTlb on organization_id=current_owner_id where organization_type='AGENT'&quot;;
				}

<span class="nc" id="L278">				pstmt = con.prepareStatement(saleQry);</span>
<span class="nc" id="L279">				logger.info(&quot;***Scratch Sale Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L280">				rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L282" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L283">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setScratchSale(</span>
							rs.getDouble(&quot;netAmt&quot;));
				}

				// Calculate Scratch Pwt
<span class="nc" id="L288">				String pwtQry = &quot;select bb.parent_id,sum(pwt) as pwt from (select retailer_org_id,sum(pwt_amt+(pwt_amt*agt_claim_comm*0.01)) pwt from st_se_retailer_pwt where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date&gt;=? and transaction_date&lt;=? and transaction_type='PWT' and retailer_org_id in (select organization_id from st_lms_organization_master where organization_type='RETAILER')) group by retailer_org_id union all select retailer_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwt from st_se_agent_pwt where transaction_id in (select transaction_id from st_lms_agent_transaction_master where transaction_date&gt;=? and transaction_date&lt;=? and transaction_type='PWT' and retailer_org_id in (select organization_id from st_lms_organization_master where organization_type='RETAILER')) group by retailer_org_id) aa,st_lms_organization_master bb where retailer_org_id=organization_id group by parent_id&quot;;</span>
<span class="nc" id="L289">				pstmt = con.prepareStatement(pwtQry);</span>
<span class="nc" id="L290">				pstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L291">				pstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L292">				pstmt.setTimestamp(3, startDate);</span>
<span class="nc" id="L293">				pstmt.setTimestamp(4, endDate);</span>
<span class="nc" id="L294">				logger.info(&quot;***Scratch Pwt Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L295">				rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L297" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L298">					agtMap.get(rs.getString(&quot;parent_id&quot;)).setScratchPwt(</span>
							rs.getDouble(&quot;pwt&quot;));
				}

				// Scratch Direct Player Qry

<span class="nc" id="L304">				String dirPwtQry = &quot;select agent_org_id,sum(pwtDir) pwtDir from (select agent_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwtDir from st_se_agt_direct_player_pwt where transaction_date&gt;=? and transaction_date&lt;=? group by agent_org_id union all select agent_org_id,sum(pwt_amt+comm_amt) pwt from st_se_bo_pwt where transaction_id in (select transaction_id from st_lms_bo_transaction_master where transaction_date&gt;=? and transaction_date&lt;=? and transaction_type='PWT' and agent_org_id in (select organization_id from st_lms_organization_master where organization_type='AGENT')) group by agent_org_id) pwt group by agent_org_id&quot;;</span>
<span class="nc" id="L305">				pstmt = con.prepareStatement(dirPwtQry);</span>
<span class="nc" id="L306">				pstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L307">				pstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L308">				pstmt.setTimestamp(3, startDate);</span>
<span class="nc" id="L309">				pstmt.setTimestamp(4, endDate);</span>
<span class="nc" id="L310">				logger.info(&quot;-------Scratch Direct Player Qry------\n&quot;</span>
						+ pstmt);
<span class="nc" id="L312">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L314">					agtMap.get(rs.getString(&quot;agent_org_id&quot;))</span>
							.setScratchDirPlyPwt(rs.getDouble(&quot;pwtDir&quot;));
				}
			}
<span class="nc bnc" id="L318" title="All 2 branches missed.">			if(ReportUtility.isCS){</span>

<span class="nc" id="L320">				saleTranCS = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type ='CS_SALE' and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where organization_type='RETAILER')&quot;;
<span class="nc" id="L325">				cancelTranCS = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('CS_CANCEL_SERVER','CS_CANCEL_RET') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where organization_type='RETAILER')&quot;;

				// Category Master Query
<span class="nc" id="L332">				String catQry = &quot;select category_id from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L333">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L334">				rsGame = prodPstmt.executeQuery();</span>
<span class="nc" id="L335">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select parent_id,sum(sale) as sale from (&quot;);
<span class="nc" id="L337">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select parent_id,sum(cancel) as cancel from (&quot;);
<span class="nc bnc" id="L339" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L340">					saleQry</span>
							.append(&quot;(select bb.parent_id,sum(sale) as sale from (select cs.retailer_org_id,sum(agent_net_amt) as sale from st_cs_sale_&quot;
									+ rsGame.getInt(&quot;category_id&quot;)
									+ &quot; cs where transaction_id in (&quot;
									+ saleTranCS
									+ &quot;) group by cs.retailer_org_id) aa,st_lms_organization_master bb where retailer_org_id=organization_id group by parent_id) union all&quot;);

<span class="nc" id="L347">					cancelQry</span>
							.append(&quot;(select bb.parent_id,sum(cancel) as cancel from (select cs.retailer_org_id,sum(agent_net_amt) as cancel from st_cs_refund_&quot;
									+ rsGame.getInt(&quot;category_id&quot;)
									+ &quot; cs where transaction_id in (&quot;
									+ cancelTranCS
									+ &quot;) group by cs.retailer_org_id) aa,st_lms_organization_master bb where retailer_org_id=organization_id group by parent_id) union all&quot;);

				}

<span class="nc" id="L356">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;), saleQry</span>
						.length());
<span class="nc" id="L358">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;), cancelQry</span>
						.length());

<span class="nc" id="L361">				saleQry.append(&quot;) saleTlb group by parent_id&quot;);</span>
<span class="nc" id="L362">				cancelQry.append(&quot;) cancelTlb group by parent_id&quot;);</span>

<span class="nc" id="L364">				logger.info(&quot;-------CS Sale Query------\n&quot; + saleQry);</span>
<span class="nc" id="L365">				logger.info(&quot;-------CS Cancel Query------\n&quot;</span>
						+ cancelQry);

				// CS Sale Query
<span class="nc" id="L369">				pstmt = con.prepareStatement(saleQry.toString());</span>
<span class="nc" id="L370">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L371" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L372">					agtMap.get(rs.getString(&quot;parent_id&quot;)).setCSSale(</span>
							rs.getDouble(&quot;sale&quot;));
				}
				// CS Cancel Query
<span class="nc" id="L376">				pstmt = con.prepareStatement(cancelQry.toString());</span>
<span class="nc" id="L377">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L379">					agtMap.get(rs.getString(&quot;parent_id&quot;)).setCSCancel(</span>
							rs.getDouble(&quot;cancel&quot;));
				}
			}
<span class="nc bnc" id="L383" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>
<span class="nc" id="L384">				depositTranOLA = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_DEPOSIT') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where organization_type='RETAILER')&quot;;
<span class="nc" id="L389">				cancelTranOLA = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_DEPOSIT_REFUND') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where organization_type='RETAILER')&quot;;
<span class="nc" id="L394">				withdrawalOLA = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_WITHDRAWL') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where organization_type='RETAILER')&quot;;

<span class="nc" id="L400">				StringBuilder depositQry = new StringBuilder(</span>
						&quot;select parent_id,sum(deposit_amt) as deposit_amt from (&quot;);
<span class="nc" id="L402">				StringBuilder depositcancelQry = new StringBuilder(</span>
						&quot;select parent_id,sum(deposit_amt) as deposit_amt_refund from (&quot;);
<span class="nc" id="L404">				StringBuilder withdrawalQry = new StringBuilder(</span>
						&quot;select parent_id,sum(withdrawl_amt) as withdrawl_amt from (&quot;);
				
<span class="nc" id="L407">				depositQry.append(&quot;(select bb.parent_id,sum(deposit_amt) as deposit_amt from (select drs.retailer_org_id,sum(agent_net_amt) as deposit_amt from st_ola_ret_deposit drs where transaction_id in (&quot;</span>
									+ depositTranOLA
									+ &quot;) group by drs.retailer_org_id) aa,st_lms_organization_master bb where retailer_org_id=organization_id group by parent_id)&quot;);

<span class="nc" id="L411">				depositcancelQry</span>
							.append(&quot;(select bb.parent_id,sum(deposit_amt) as deposit_amt from (select drs.retailer_org_id,sum(agent_net_amt) as deposit_amt from st_ola_ret_deposit_refund drs where transaction_id in (&quot;
									+ cancelTranOLA
									+ &quot;) group by drs.retailer_org_id) aa,st_lms_organization_master bb where retailer_org_id=organization_id group by parent_id)&quot;);

<span class="nc" id="L416">				withdrawalQry</span>
							.append(&quot;(select bb.parent_id,sum(withdrawl_amt) as withdrawl_amt from (select drs.retailer_org_id,sum(agent_net_amt) as withdrawl_amt from st_ola_ret_withdrawl drs where transaction_id in (&quot;
									+ withdrawalOLA
									+ &quot;) group by drs.retailer_org_id) aa,st_lms_organization_master bb where retailer_org_id=organization_id group by parent_id)&quot;);

<span class="nc" id="L421">				String netGamingQry = &quot;select om.organization_id agtOrgId, ifnull(sum(commission_calculated),0.0) netAmt from (select agt_org_id, net_gaming, commission_calculated from st_ola_bo_agt_commission where transaction_id in (select transaction_id from st_lms_bo_transaction_master where transaction_type = 'OLA_COMMISSION' and transaction_date &gt;= '&quot;</span>
								+ startDate
								+ &quot;' and transaction_date &lt;= '&quot;
								+ endDate
								+ &quot;')) bac right outer join (select organization_id from st_lms_organization_master where organization_type = 'AGENT')om on bac.agt_org_id = om.organization_id group by om.organization_id&quot;;
				
				
<span class="nc" id="L428">				depositQry.append(&quot;) depositTlb group by parent_id&quot;);</span>
<span class="nc" id="L429">				depositcancelQry.append(&quot;) cancelTlb group by parent_id&quot;);</span>
<span class="nc" id="L430">				withdrawalQry.append(&quot;) withdrawalTlb group by parent_id&quot;);</span>
<span class="nc" id="L431">				System.out.println(&quot;-------OLA Deposit Qurey------\n&quot; + depositQry);</span>
<span class="nc" id="L432">				System.out.println(&quot;-------OLA Deposit Cancel Qurey------\n&quot;+ depositcancelQry);</span>
<span class="nc" id="L433">				System.out.println(&quot;-------OLA Withdrawal Qurey------\n&quot; + withdrawalQry);</span>

				// OLA Deposit Query
<span class="nc" id="L436">				pstmt = con.prepareStatement(depositQry.toString());</span>
<span class="nc" id="L437">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L439">					agtMap.get(rs.getString(&quot;parent_id&quot;)).setOlaDepositAmt(</span>
							rs.getDouble(&quot;deposit_amt&quot;));
				}
				// OLA Deposit Cancel Query
<span class="nc" id="L443">				pstmt = con.prepareStatement(depositcancelQry.toString());</span>
<span class="nc" id="L444">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L445" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L446">					agtMap.get(rs.getString(&quot;parent_id&quot;)).setOlaDepositCancelAmt(</span>
							rs.getDouble(&quot;deposit_amt_refund&quot;));
				}
				// OLA Withdrawal Query
<span class="nc" id="L450">				pstmt = con.prepareStatement(withdrawalQry.toString());</span>
<span class="nc" id="L451">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L452" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L453">					agtMap.get(rs.getString(&quot;parent_id&quot;)).setOlaWithdrawalAmt(</span>
							rs.getDouble(&quot;withdrawl_amt&quot;));
				}
				// OLA Net Gaming Query
<span class="nc" id="L457">				pstmt = con.prepareStatement(netGamingQry);</span>
<span class="nc" id="L458">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L460">					agtMap.get(rs.getString(&quot;agtOrgId&quot;)).setOlaNetGaming(</span>
							rs.getDouble(&quot;netAmt&quot;));
				}
			
			}
<span class="nc" id="L465">		} catch (Exception e) {</span>
<span class="nc" id="L466">			e.printStackTrace();</span>
<span class="nc" id="L467">		}</span>
<span class="nc" id="L468">		return agtMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionAgentWiseExpand(
			Timestamp startDate, Timestamp endDate, Connection con) {
<span class="nc" id="L473">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L474">		ResultSet rsGame = null;</span>
<span class="nc" id="L475">		ResultSet rs = null;</span>
<span class="nc" id="L476">		ResultSet rsRetOrg = null;</span>
<span class="nc" id="L477">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; serGameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;();</span>
<span class="nc" id="L478">		Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt; gameAgtMap = null;</span>
		// for Draw Game
<span class="nc" id="L480">		String saleTranDG = null;</span>
<span class="nc" id="L481">		String cancelTranDG = null;</span>
<span class="nc" id="L482">		String pwtTranDG = null;</span>
<span class="nc" id="L483">		String dirPlrPwt = null;</span>
<span class="nc" id="L484">		StringBuilder drawQry = null;</span>
		// for scratch game
<span class="nc" id="L486">		StringBuilder scratchQry = null;</span>
		//for CS
<span class="nc" id="L488">		StringBuilder CSQry = null;</span>
<span class="nc" id="L489">		String saleTranCS = null;</span>
<span class="nc" id="L490">		String cancelTranCS = null;</span>
		//for OLA
<span class="nc" id="L492">		StringBuilder OLAQry = null;</span>
<span class="nc" id="L493">		String depositTranOLA = null;</span>
<span class="nc" id="L494">		String cancelTranOLA = null;</span>
<span class="nc" id="L495">		String withdrawalTranOLA = null;</span>
		
<span class="nc bnc" id="L497" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L498">			return serGameAgtMap;</span>
		}
		try {

			// Get All Agent
		
<span class="nc" id="L504">			String agtOrgQry = QueryManager.getOrgQry(&quot;AGENT&quot;);</span>
					
			
<span class="nc" id="L507">			pstmt = con.prepareStatement(agtOrgQry);</span>
<span class="nc" id="L508">			rsRetOrg = pstmt.executeQuery();</span>

<span class="nc bnc" id="L510" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L511">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L512">				drawQry = new StringBuilder(</span>
						&quot;select organization_id,ifnull(sale,0.0) sale,ifnull(cancel,0.0) cancel,ifnull(pwt,0.0)  pwt from (select sale.parent_id,sale,cancel,pwt from &quot;);
<span class="nc" id="L514">				saleTranDG = &quot;(select bb.parent_id,sum(sale) as sale from (select drs.retailer_org_id,sum(agent_net_amt) as sale from st_dg_ret_sale_? drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_SALE','DG_SALE_OFFLINE') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id,parent_id from st_lms_organization_master where organization_type='RETAILER')bb on retailer_org_id=organization_id group by parent_id) sale,&quot;;
<span class="nc" id="L519">				cancelTranDG = &quot;(select bb.parent_id,sum(cancel) as cancel from (select drs.retailer_org_id,sum(agent_net_amt) as cancel from st_dg_ret_sale_refund_? drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id,parent_id from st_lms_organization_master where organization_type='RETAILER') bb on retailer_org_id=organization_id group by parent_id) cancel,&quot;;
<span class="nc" id="L524">				pwtTranDG = &quot;(select bb.parent_id,sum(pwt) as pwt from (select drs.retailer_org_id,sum(pwt_amt+agt_claim_comm) as pwt from st_dg_ret_pwt_? drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id,parent_id from st_lms_organization_master where organization_type='RETAILER') bb on retailer_org_id=organization_id group by parent_id) pwt&quot;;
<span class="nc" id="L529">				drawQry.append(saleTranDG);</span>
<span class="nc" id="L530">				drawQry.append(cancelTranDG);</span>
<span class="nc" id="L531">				drawQry.append(pwtTranDG);</span>
<span class="nc" id="L532">				drawQry</span>
						.append(&quot; where sale.parent_id=cancel.parent_id and sale.parent_id=pwt.parent_id and cancel.parent_id=pwt.parent_id) gameTlb right outer join (select organization_id from st_lms_organization_master where organization_type='AGENT') agtTlb on gameTlb.parent_id=agtTlb.organization_id&quot;);
<span class="nc" id="L534">				System.out.println(&quot;For Expand draw game Qry:: &quot; + drawQry);</span>

<span class="nc" id="L536">				dirPlrPwt = &quot;select organization_id,ifnull(pwtDir,0.0) pwtDir from (select agent_org_id,sum(pwt_amt+agt_claim_comm) pwtDir from st_dg_agt_direct_plr_pwt where transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and game_id=? group by agent_org_id) aa right outer join (select organization_id from st_lms_organization_master where organization_type='AGENT') bb on agent_org_id=organization_id&quot;;

<span class="nc" id="L542">				System.out.println(&quot;For Expand draw game Qry Direct Ply:: &quot;</span>
						+ dirPlrPwt);
				// Game Master Query
<span class="nc" id="L545">				String gameQry = &quot;select game_id,game_name from st_dg_game_master&quot;;</span>
<span class="nc" id="L546">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L547">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L548" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L549">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L550">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L551">					gameMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L552">					pstmt = con.prepareStatement(drawQry.toString());</span>
<span class="nc" id="L553">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L554">					pstmt.setInt(2, gameId);</span>
<span class="nc" id="L555">					pstmt.setInt(3, gameId);</span>
<span class="nc" id="L556">					System.out.println(&quot;-------Indivisual Game Qry-------\n&quot;</span>
							+ pstmt);
<span class="nc" id="L558">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L559" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L560">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L561">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L562">						gameMap.get(agtId)</span>
								.setDrawCancel(rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L564">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>

<span class="nc" id="L566">					}</span>

					// Direct Player Pwt
<span class="nc" id="L569">					pstmt = con.prepareStatement(dirPlrPwt);</span>
<span class="nc" id="L570">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L571">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L573">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L574">						gameMap.get(agtId).setDrawDirPlyPwt(</span>
								rs.getDouble(&quot;pwtDir&quot;));
<span class="nc" id="L576">					}</span>
<span class="nc" id="L577">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L578">				}</span>

<span class="nc" id="L580">				serGameAgtMap.put(&quot;DG&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L582" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
<span class="nc" id="L583">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L584">				scratchQry = new StringBuilder(</span>
						&quot;select organization_id,ifnull(sale,0.0) sale,ifnull(pwt,0.0) pwt from (select sale.parent_id,sale,pwt from&quot;);
<span class="nc" id="L586">				logger.info(&quot;----Type Select ---&quot;</span>
						+ LMSFilterDispatcher.seSaleReportType);
<span class="nc bnc" id="L588" title="All 2 branches missed.">				if (&quot;BOOK_WISE&quot;.equals(LMSFilterDispatcher.seSaleReportType)) {</span>
<span class="nc" id="L589">					saleTranDG = &quot;(select organization_id parent_id,name,ifnull(mrpAmt,0.0) mrpAmt,ifnull(netAmt,0.0) sale from st_lms_organization_master left outer join (select sale.agent_org_id,(ifnull(mrpAmt,0.0)-ifnull(mrpAmtRet,0.0)) mrpAmt,(ifnull(netAmt,0.0)-ifnull(netAmtRet,0.0)) netAmt from (select agent_org_id,sum(mrpAmt) mrpAmt,sum(netAmt) netAmt from(select agent_org_id,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_bo_agent_transaction where game_id=?  and transaction_id in (select transaction_id from st_lms_bo_transaction_master where transaction_type='SALE' and transaction_date&gt;='&quot;</span>
							+ startDate
							+ &quot;'  and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' ) group by agent_org_id union all select agent_org_id,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_bo_agent_loose_book_transaction where game_id=?  and transaction_id in (select transaction_id from st_lms_bo_transaction_master where transaction_type='LOOSE_SALE' and transaction_date&gt;='&quot;
							+ startDate
							+ &quot;'  and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' ) group by agent_org_id) sale group by agent_org_id ) sale left outer join (select agent_org_id,sum(mrpAmtRet) mrpAmtRet,sum(netAmtRet) netAmtRet from (select agent_org_id,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_bo_agent_transaction where game_id=?  and transaction_id in (select transaction_id from st_lms_bo_transaction_master where transaction_type='SALE_RET' and transaction_date&gt;='&quot;
							+ startDate
							+ &quot;'  and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' ) group by agent_org_id union all select agent_org_id,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_bo_agent_loose_book_transaction where game_id=?  and transaction_id in (select transaction_id from st_lms_bo_transaction_master where transaction_type='LOOSE_SALE_RET' and transaction_date&gt;='&quot;
							+ startDate
							+ &quot;'  and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' ) group by agent_org_id) saleRet  group by agent_org_id) saleRet on sale.agent_org_id=saleRet.agent_org_id) saleTlb on organization_id=agent_org_id where organization_type='AGENT') sale,&quot;;
<span class="nc bnc" id="L606" title="All 2 branches missed.">				} else if (&quot;TICKET_WISE&quot;</span>
						.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L608">					saleTranDG = &quot;(select organization_id parent_id,name,ifnull(mrpAmt,0.0) mrpAmt,ifnull(netAmt,0.0) sale from st_lms_organization_master left outer join (select current_owner_id,sum(soldTkt*ticket_price) mrpAmt,sum((soldTkt*ticket_price)-(soldTkt*ticket_price*transacrion_sale_comm_rate*0.01)) netAmt from st_se_game_master gm,st_se_game_inv_detail gid,(select game_id,book_nbr,sum(sold_tickets) soldTkt from st_se_game_ticket_inv_history where date&gt;='&quot;</span>
							+ startDate
							+ &quot;' and date&lt;='&quot;
							+ endDate
							+ &quot;' and current_owner='RETAILER' and game_id=? group by book_nbr) TktTlb where gm.game_id=? and gm.game_id=TktTlb.game_id and TktTlb.book_nbr=gid.book_nbr and gid.current_owner='AGENT' group by current_owner_id) saleTlb on organization_id=current_owner_id where organization_type='AGENT') sale,&quot;;
				}

<span class="nc" id="L615">				pwtTranDG = &quot;(select bb.parent_id,sum(pwt) as pwt from (select retailer_org_id,sum(pwt_amt+(pwt_amt*agt_claim_comm*0.01)) pwt from st_se_retailer_pwt where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and transaction_type='PWT') and game_id=? group by retailer_org_id) aa right outer join (select organization_id,parent_id from st_lms_organization_master where organization_type='RETAILER') bb on retailer_org_id=organization_id group by parent_id) pwt&quot;;
<span class="nc" id="L620">				scratchQry.append(saleTranDG);</span>
<span class="nc" id="L621">				scratchQry.append(pwtTranDG);</span>
<span class="nc" id="L622">				scratchQry</span>
						.append(&quot; where sale.parent_id=pwt.parent_id) gameTlb right outer join (select organization_id from st_lms_organization_master where organization_type='AGENT') agtTlb on gameTlb.parent_id=agtTlb.organization_id&quot;);
<span class="nc" id="L624">				System.out.println(&quot;For Expand scratch game Qry:: &quot;</span>
						+ scratchQry);

<span class="nc" id="L627">				dirPlrPwt = &quot;select organization_id,ifnull(pwtDir,0.0) pwtDir from (select agent_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwtDir from st_se_agt_direct_player_pwt where transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and game_id=? group by agent_org_id) aa right outer join (select organization_id from st_lms_organization_master where organization_type='AGENT') bb on agent_org_id=organization_id&quot;;

<span class="nc" id="L633">				System.out.println(&quot;For Expand scratch game Qry Direct Ply:: &quot;</span>
						+ dirPlrPwt);
				// Game Master Query
<span class="nc" id="L636">				String gameQry = &quot;select game_id,game_name from st_se_game_master&quot;;</span>
<span class="nc" id="L637">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L638">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L639" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L640">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L641">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L642">					gameMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L643">					pstmt = con.prepareStatement(scratchQry.toString());</span>
<span class="nc" id="L644">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L645">					pstmt.setInt(2, gameId);</span>
<span class="nc" id="L646">					pstmt.setInt(3, gameId);</span>
<span class="nc" id="L647">					pstmt.setInt(4, gameId);</span>
<span class="nc" id="L648">					pstmt.setInt(5, gameId);</span>

<span class="nc" id="L650">					System.out.println(&quot;-------Indivisual Game Qry-------\n&quot;</span>
							+ pstmt);
<span class="nc" id="L652">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L653" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L654">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L655">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L656">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>
<span class="nc" id="L657">					}</span>

					// Direct Player Pwt
<span class="nc" id="L660">					pstmt = con.prepareStatement(dirPlrPwt);</span>
<span class="nc" id="L661">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L662">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L663" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L664">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L665">						gameMap.get(agtId).setScratchDirPlyPwt(</span>
								rs.getDouble(&quot;pwtDir&quot;));
<span class="nc" id="L667">					}</span>

<span class="nc" id="L669">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L670">				}</span>
<span class="nc" id="L671">				serGameAgtMap.put(&quot;SE&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L673" title="All 2 branches missed.">			if(ReportUtility.isCS){</span>

<span class="nc" id="L675">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L676">				CSQry = new StringBuilder(</span>
						&quot;select organization_id,ifnull(sale,0.0) sale,ifnull(cancel,0.0) cancel from (select sale.parent_id,sale,cancel from &quot;);
<span class="nc" id="L678">				saleTranCS = &quot;(select bb.parent_id,sum(sale) as sale from (select cs.retailer_org_id,sum(agent_net_amt) as sale from st_cs_sale_? cs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type = 'CS_SALE' and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by cs.retailer_org_id) aa right outer join (select organization_id,parent_id from st_lms_organization_master where organization_type='RETAILER')bb on retailer_org_id=organization_id group by parent_id) sale,&quot;;
<span class="nc" id="L683">				cancelTranCS = &quot;(select bb.parent_id,sum(cancel) as cancel from (select cs.retailer_org_id,sum(agent_net_amt) as cancel from st_cs_refund_? cs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('CS_CANCEL_SERVER','CS_CANCEL_RET') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by cs.retailer_org_id) aa right outer join (select organization_id,parent_id from st_lms_organization_master where organization_type='RETAILER') bb on retailer_org_id=organization_id group by parent_id) cancel &quot;;
<span class="nc" id="L688">				CSQry.append(saleTranCS);</span>
<span class="nc" id="L689">				CSQry.append(cancelTranCS);</span>
<span class="nc" id="L690">				CSQry</span>
						.append(&quot; where sale.parent_id=cancel.parent_id) gameTlb right outer join (select organization_id from st_lms_organization_master where organization_type='AGENT') agtTlb on gameTlb.parent_id=agtTlb.organization_id&quot;);
<span class="nc" id="L692">				logger.debug(&quot;For Expand draw game Qry:: &quot; + CSQry);</span>

				// Category Master Query
<span class="nc" id="L695">				String catQry = &quot;select category_id,category_code from st_cs_product_category_master&quot;;</span>
<span class="nc" id="L696">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L697">				rsGame = prodPstmt.executeQuery();</span>
<span class="nc bnc" id="L698" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L699">					int catId = rsGame.getInt(&quot;category_id&quot;);</span>
<span class="nc" id="L700">					Map&lt;String, CompleteCollectionBean&gt; prodMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L701">					prodMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L702">					pstmt = con.prepareStatement(CSQry.toString());</span>
<span class="nc" id="L703">					pstmt.setInt(1, catId);</span>
<span class="nc" id="L704">					pstmt.setInt(2, catId);</span>
<span class="nc" id="L705">					logger.debug(&quot;-------Indivisual Game Qry-------\n&quot;</span>
							+ pstmt);
<span class="nc" id="L707">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L708" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L709">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L710">						prodMap.get(agtId).setCSSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L711">						prodMap.get(agtId).setCSCancel(rs.getDouble(&quot;cancel&quot;));</span>
<span class="nc" id="L712">					}</span>
<span class="nc" id="L713">					gameAgtMap.put(rsGame.getString(&quot;category_code&quot;), prodMap);</span>
<span class="nc" id="L714">				}</span>

<span class="nc" id="L716">				serGameAgtMap.put(&quot;CS&quot;, gameAgtMap);</span>
			
			}
<span class="nc bnc" id="L719" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>
<span class="nc" id="L720">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L721">				OLAQry = new StringBuilder(</span>
						&quot;select organization_id,deposit_amt,deposit_refund_amt,withdrawl_amt,total_amt from(select organization_id,ifnull(deposit_amt,0.0) deposit_amt,ifnull(deposit_refund_amt,0.0) deposit_refund_amt,ifnull(withdrawl_amt,0.0)  withdrawl_amt from (select deposit.parent_id,deposit_amt,deposit_refund_amt,withdrawl_amt from &quot;);
<span class="nc" id="L723">				depositTranOLA = &quot;(select bb.parent_id,sum(deposit_amt) as deposit_amt from (select drs.retailer_org_id,sum(agent_net_amt) as deposit_amt from st_ola_ret_deposit drs where wallet_id=? and transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_DEPOSIT') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id,parent_id from st_lms_organization_master where organization_type='RETAILER')bb on retailer_org_id=organization_id group by parent_id) deposit,&quot;;
<span class="nc" id="L728">				cancelTranOLA = &quot;(select bb.parent_id,sum(deposit_refund_amt) as deposit_refund_amt from (select drs.retailer_org_id,sum(agent_net_amt) as deposit_refund_amt from st_ola_ret_deposit_refund drs where wallet_id=? and transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_DEPOSIT_REFUND') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id,parent_id from st_lms_organization_master where organization_type='RETAILER') bb on retailer_org_id=organization_id group by parent_id) cancel,&quot;;
<span class="nc" id="L733">				withdrawalTranOLA = &quot;(select bb.parent_id,sum(withdrawl_amt) as withdrawl_amt from (select drs.retailer_org_id,sum(agent_net_amt) as withdrawl_amt from st_ola_ret_withdrawl drs where wallet_id=? and transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_WITHDRAWL') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id,parent_id from st_lms_organization_master where organization_type='RETAILER') bb on retailer_org_id=organization_id group by parent_id) withdrawal&quot;;
<span class="nc" id="L738">				OLAQry.append(depositTranOLA);</span>
<span class="nc" id="L739">				OLAQry.append(cancelTranOLA);</span>
<span class="nc" id="L740">				OLAQry.append(withdrawalTranOLA);</span>
<span class="nc" id="L741">				OLAQry</span>
						.append(&quot; where deposit.parent_id=cancel.parent_id and deposit.parent_id=withdrawal.parent_id and cancel.parent_id=withdrawal.parent_id) depositTlb right outer join (select organization_id from st_lms_organization_master where organization_type='AGENT') agtTlb on depositTlb.parent_id=agtTlb.organization_id&quot;);
<span class="nc" id="L743">				OLAQry.append(&quot;)totalTab,(select bb.organization_id agtOrgId,sum(total_amt) as total_amt from (select agt_org_id,sum(commission_calculated) as total_amt from st_ola_bo_agt_commission drs where wallet_id=? and transaction_id in (select transaction_id from st_lms_bo_transaction_master where transaction_type in('OLA_COMMISSION') and transaction_date&gt;='&quot;+startDate+&quot;' and transaction_date&lt;='&quot;+endDate+&quot;') group by agt_org_id) aa right outer join (select organization_id from st_lms_organization_master where organization_type='AGENT')bb on aa.agt_org_id=bb.organization_id group by organization_id)netGaming where totalTab.organization_id=netGaming.agtOrgId&quot;);</span>
<span class="nc" id="L744">				System.out.println(&quot;OLA Deposit Qry:: &quot; + OLAQry);</span>

				// Wallet Master Query
<span class="nc" id="L747">				String catQry = &quot;select wallet_id,wallet_display_name from st_ola_wallet_master&quot;;</span>
<span class="nc" id="L748">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L749">				rsGame = prodPstmt.executeQuery();</span>
<span class="nc bnc" id="L750" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L751">					int walletIdId = rsGame.getInt(&quot;wallet_id&quot;);</span>
<span class="nc" id="L752">					Map&lt;String, CompleteCollectionBean&gt; walletMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L753">					walletMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L754">					pstmt = con.prepareStatement(OLAQry.toString());</span>
<span class="nc" id="L755">					pstmt.setInt(1, walletIdId);</span>
<span class="nc" id="L756">					pstmt.setInt(2, walletIdId);</span>
<span class="nc" id="L757">					pstmt.setInt(3, walletIdId);</span>
<span class="nc" id="L758">					pstmt.setInt(4, walletIdId);</span>
<span class="nc" id="L759">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L760" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L761">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L762">						walletMap.get(agtId).setOlaDepositAmt(rs.getDouble(&quot;deposit_amt&quot;));</span>
<span class="nc" id="L763">						walletMap.get(agtId)</span>
								.setOlaDepositCancelAmt(rs.getDouble(&quot;deposit_refund_amt&quot;));
<span class="nc" id="L765">						walletMap.get(agtId).setOlaWithdrawalAmt(rs.getDouble(&quot;withdrawl_amt&quot;));</span>
<span class="nc" id="L766">						walletMap.get(agtId).setOlaNetGaming(rs.getDouble(&quot;total_amt&quot;));</span>
<span class="nc" id="L767">					}</span>

<span class="nc" id="L769">					gameAgtMap.put(rsGame.getString(&quot;wallet_display_name&quot;), walletMap);</span>
<span class="nc" id="L770">				}</span>
<span class="nc" id="L771">					serGameAgtMap.put(&quot;OLA&quot;, gameAgtMap);</span>
				
			}
			
<span class="nc" id="L775">		} catch (Exception e) {</span>
<span class="nc" id="L776">			e.printStackTrace();</span>
<span class="nc" id="L777">		}</span>
<span class="nc" id="L778">		return serGameAgtMap;</span>
	}

	public Map&lt;String, CompleteCollectionBean&gt; collectionDayWise(
			Timestamp startDate, Timestamp endDate, Connection con, String viewBy, int orgId) {
<span class="nc" id="L783">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L784">		ResultSet rsGame = null;</span>
<span class="nc" id="L785">		ResultSet rs = null;</span>
<span class="nc" id="L786">		Map&lt;String, CompleteCollectionBean&gt; dateMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L787">		CompleteCollectionBean collBean = null;</span>
<span class="nc" id="L788">		String date = null;</span>
		// for Draw Game
<span class="nc" id="L790">		String saleTranDG = null;</span>
<span class="nc" id="L791">		String cancelTranDG = null;</span>
<span class="nc" id="L792">		String pwtTranDG = null;</span>
		//for CS
<span class="nc" id="L794">		String saleTranCS = null;</span>
<span class="nc" id="L795">		String cancelTranCS = null;</span>
		
		//for OLA
<span class="nc" id="L798">		String depositTranOLA = null;</span>
<span class="nc" id="L799">		String depositCancelTranOLA = null;</span>
<span class="nc" id="L800">		String withdrawalTranOLA = null;</span>
		
<span class="nc bnc" id="L802" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L803">			return dateMap;</span>
		}

<span class="nc" id="L806">		String addDrawQry = &quot;&quot;;</span>
<span class="nc" id="L807">		String addOlaQry = &quot;&quot;;</span>
<span class="nc" id="L808">		String addDirPlrQry = &quot;&quot;;</span>
<span class="nc" id="L809">		String addScratchPwtQry = &quot;&quot;;</span>
<span class="nc" id="L810">		String addCSQry = &quot;&quot;;</span>

		// For Column which is used

<span class="nc" id="L814">		String dgSaleCol = &quot;agent_net_amt&quot;;</span>
<span class="nc" id="L815">		String csSaleCol = &quot;agent_net_amt&quot;;</span>
<span class="nc" id="L816">		String olaDepositCol = &quot;agent_net_amt&quot;;</span>
<span class="nc" id="L817">		String olaWithdrawalCol = &quot;agent_net_amt&quot;;</span>
<span class="nc" id="L818">		String dgPwtCol = &quot;pwt_amt+agt_claim_comm&quot;;</span>
	
<span class="nc" id="L820">		String sePwtCol = &quot;pwt_amt+(pwt_amt*agt_claim_comm*0.01)&quot;;</span>
<span class="nc" id="L821">		boolean viewByAgt = false;</span>
<span class="nc bnc" id="L822" title="All 4 branches missed.">		if (&quot;AGENT&quot;.equals(viewBy) &amp;&amp; orgId != 0) {</span>
<span class="nc" id="L823">			viewByAgt = true;</span>
<span class="nc" id="L824">			dgSaleCol = &quot;net_amt&quot;;</span>
<span class="nc" id="L825">			csSaleCol = &quot;net_amt&quot;;</span>
<span class="nc" id="L826">			olaDepositCol = &quot;net_amt&quot;;</span>
<span class="nc" id="L827">			olaWithdrawalCol = &quot;net_amt&quot;;</span>
<span class="nc" id="L828">			dgPwtCol = &quot;pwt_amt+retailer_claim_comm&quot;;</span>
<span class="nc" id="L829">			sePwtCol = &quot;pwt_amt+(pwt_amt*claim_comm*0.01)&quot;;</span>
<span class="nc" id="L830">			addDrawQry = &quot; and drs.retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;</span>
					+ orgId + &quot;)&quot;;
<span class="nc" id="L832">			addOlaQry = &quot; and drs.retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;</span>
				+ orgId + &quot;)&quot;;
<span class="nc" id="L834">			addDirPlrQry = &quot; and agent_org_id=&quot; + orgId;</span>
<span class="nc" id="L835">			addScratchPwtQry = &quot; and rp.retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;</span>
					+ orgId + &quot;)&quot;;
<span class="nc" id="L837">			addCSQry = &quot;and cs.retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;;</span>
		}

		// for scratch game
		try {

			// Get All Agent
<span class="nc" id="L844">			Calendar startCal = Calendar.getInstance();</span>
<span class="nc" id="L845">			startCal.setTime(startDate);</span>

<span class="nc" id="L847">			Calendar endCal = Calendar.getInstance();</span>
<span class="nc" id="L848">			endCal.setTime(endDate);</span>
<span class="nc bnc" id="L849" title="All 2 branches missed.">			while (startCal.getTime().before(endCal.getTime())) {</span>
<span class="nc" id="L850">				date = new java.sql.Date(startCal.getTimeInMillis()).toString();</span>
<span class="nc" id="L851">				collBean = new CompleteCollectionBean();</span>
<span class="nc" id="L852">				collBean.setOrgName(date);</span>
<span class="nc" id="L853">				dateMap.put(date, collBean);</span>
<span class="nc" id="L854">				startCal.setTimeInMillis(startCal.getTimeInMillis() + 24 * 60</span>
						* 60 * 1000);
<span class="nc bnc" id="L856" title="All 2 branches missed.">				if (ReportUtility.isDG) {</span>
<span class="nc" id="L857">					collBean.setDrawSale(0.0);</span>
<span class="nc" id="L858">					collBean.setDrawPwt(0.0);</span>
<span class="nc" id="L859">					collBean.setDrawCancel(0.0);</span>
<span class="nc" id="L860">					collBean.setDrawDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L862" title="All 2 branches missed.">				if (ReportUtility.isSE) {</span>
<span class="nc" id="L863">					collBean.setScratchSale(0.0);</span>
<span class="nc" id="L864">					collBean.setScratchPwt(0.0);</span>
<span class="nc" id="L865">					collBean.setScratchDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L867" title="All 2 branches missed.">				if (ReportUtility.isCS) {</span>
<span class="nc" id="L868">					collBean.setCSSale(0.0);</span>
<span class="nc" id="L869">					collBean.setCSCancel(0.0);</span>
				}
<span class="nc bnc" id="L871" title="All 2 branches missed.">				if(ReportUtility.isOLA)</span>
				{
<span class="nc" id="L873">					collBean.setOlaDepositAmt(0.0);</span>
<span class="nc" id="L874">					collBean.setOlaWithdrawalAmt(0.0);</span>
<span class="nc" id="L875">					collBean.setOlaDepositCancelAmt(0.0);</span>
<span class="nc" id="L876">					collBean.setOlaNetGaming(0.0);</span>
				}
			}
			

<span class="nc bnc" id="L881" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L882">				saleTranDG = &quot;drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and transaction_type in('DG_SALE','DG_SALE_OFFLINE') &quot;
						+ addDrawQry + &quot; group by tx_date&quot;;
<span class="nc" id="L888">				cancelTranDG = &quot;drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') &quot;
						+ addDrawQry + &quot; group by tx_date&quot;;
<span class="nc" id="L894">				pwtTranDG = &quot;drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') &quot;
						+ addDrawQry + &quot; group by tx_date&quot;;

				// Game Master Query
<span class="nc" id="L902">				String gameQry = ReportUtility.getDrawGameMapQuery(startDate);</span>
<span class="nc" id="L903">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L904">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L905">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select tx_date,sum(sale) sale from (&quot;);
<span class="nc" id="L907">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select tx_date,sum(cancel) cancel from (&quot;);
<span class="nc" id="L909">				StringBuilder pwtQry = new StringBuilder(</span>
						&quot;select tx_date,sum(pwt) pwt from (&quot;);
<span class="nc bnc" id="L911" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L912">					saleQry</span>
							.append(&quot;(select SUBSTRING_INDEX(transaction_date,' ',1) tx_date,sum(&quot;
									+ dgSaleCol
									+ &quot;) sale from st_dg_ret_sale_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; &quot;
									+ saleTranDG + &quot;) union all&quot;);

<span class="nc" id="L920">					cancelQry</span>
							.append(&quot;(select SUBSTRING_INDEX(transaction_date,' ',1) tx_date,sum(&quot;
									+ dgSaleCol
									+ &quot;) cancel from st_dg_ret_sale_refund_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; &quot;
									+ cancelTranDG + &quot;) union all&quot;);

<span class="nc" id="L928">					pwtQry</span>
							.append(&quot;(select SUBSTRING_INDEX(transaction_date,' ',1) tx_date,sum(&quot;
									+ dgPwtCol
									+ &quot;) pwt from st_dg_ret_pwt_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; &quot;
									+ pwtTranDG + &quot;) union all&quot;);

				}

<span class="nc" id="L938">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;), saleQry</span>
						.length());
<span class="nc" id="L940">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;), cancelQry</span>
						.length());
<span class="nc" id="L942">				pwtQry.delete(pwtQry.lastIndexOf(&quot;union all&quot;), pwtQry.length());</span>

<span class="nc" id="L944">				saleQry.append(&quot;) saleTlb group by tx_date&quot;);</span>
<span class="nc" id="L945">				cancelQry.append(&quot;) cancelTlb group by tx_date&quot;);</span>
<span class="nc" id="L946">				pwtQry.append(&quot;) pwtTlb group by tx_date&quot;);</span>
<span class="nc" id="L947">				System.out.println(&quot;-------Draw Sale Qurey------\n&quot; + saleQry);</span>
<span class="nc" id="L948">				System.out.println(&quot;-------Draw Cancel Qurey------\n&quot;</span>
						+ cancelQry);
<span class="nc" id="L950">				System.out.println(&quot;-------Draw Pwt Qurey------\n&quot; + pwtQry);</span>

				// Draw Sale Query
<span class="nc" id="L953">				pstmt = con.prepareStatement(saleQry.toString());</span>
<span class="nc" id="L954">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L955" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L956">					dateMap.get(rs.getString(&quot;tx_date&quot;)).setDrawSale(</span>
							rs.getDouble(&quot;sale&quot;));
				}
				// Draw Cancel Query
<span class="nc" id="L960">				pstmt = con.prepareStatement(cancelQry.toString());</span>
<span class="nc" id="L961">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L962" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L963">					dateMap.get(rs.getString(&quot;tx_date&quot;)).setDrawCancel(</span>
							rs.getDouble(&quot;cancel&quot;));
				}
				// Draw Pwt Query
<span class="nc" id="L967">				pstmt = con.prepareStatement(pwtQry.toString());</span>
<span class="nc" id="L968">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L969" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L970">					dateMap.get(rs.getString(&quot;tx_date&quot;)).setDrawPwt(</span>
							rs.getDouble(&quot;pwt&quot;));
				}

				// Draw Direct Player Qry
<span class="nc" id="L975">				String dirPwtQry = &quot;select tx_date,sum(net_amt) pwtDir from (select SUBSTRING_INDEX(transaction_date,' ',1) tx_date ,(pwt_amt+agt_claim_comm) net_amt from st_dg_agt_direct_plr_pwt where transaction_date&gt;=? and transaction_date&lt;=? &quot;</span>
						+ addDirPlrQry + &quot;) aa group by tx_date&quot;;
<span class="nc" id="L977">				pstmt = con.prepareStatement(dirPwtQry);</span>
<span class="nc" id="L978">				pstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L979">				pstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L980">				System.out.println(&quot;-------Draw Direct Player Qry------\n&quot;</span>
						+ pstmt);
<span class="nc" id="L982">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L983" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L984">					dateMap.get(rs.getString(&quot;tx_date&quot;)).setDrawDirPlyPwt(</span>
							rs.getDouble(&quot;pwtDir&quot;));
				}
			}
<span class="nc bnc" id="L988" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
<span class="nc" id="L989">				String saleQry = &quot;&quot;;</span>
<span class="nc" id="L990">				logger.info(&quot;----Type Select ---&quot;</span>
						+ LMSFilterDispatcher.seSaleReportType);
<span class="nc bnc" id="L992" title="All 2 branches missed.">				if (&quot;BOOK_WISE&quot;.equals(LMSFilterDispatcher.seSaleReportType)) {</span>
<span class="nc bnc" id="L993" title="All 2 branches missed.">					if (viewByAgt) {</span>
<span class="nc" id="L994">						saleQry = &quot;select transaction_date date,mrpAmt, netAmt sale from( select sale.transaction_date, mrpAmt-mrpAmtRet mrpAmt,netAmt-netAmtRet netAmt from (select transaction_date,sum(mrpAmt) mrpAmt,sum(netAmt) netAmt from (select transaction_date,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_bo_agent_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='SALE' and  transaction_date&gt;='&quot;</span>
								+ startDate
								+ &quot;'  and  transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' ) tranTlb where sale.transaction_id=tranTlb.transaction_id  and agent_org_id=&quot;
								+ orgId
								+ &quot;   group by transaction_date union all select transaction_date,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_bo_agent_loose_book_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='LOOSE_SALE' and  transaction_date&gt;='&quot;
								+ startDate
								+ &quot;'  and  transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' ) tranTlb where sale.transaction_id=tranTlb.transaction_id  and agent_org_id=&quot;
								+ orgId
								+ &quot;   group by transaction_date) sale group by transaction_date) sale left join (select transaction_date,sum(mrpAmtRet) mrpAmtRet,sum(netAmtRet) netAmtRet from (select transaction_date,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_bo_agent_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='SALE_RET' and  transaction_date&gt;='&quot;
								+ startDate
								+ &quot;'  and  transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' ) tranTlb where sale.transaction_id=tranTlb.transaction_id  and agent_org_id=&quot;
								+ orgId
								+ &quot;   group by transaction_date union all select transaction_date,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_bo_agent_loose_book_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='LOOSE_SALE_RET' and   transaction_date&gt;='&quot;
								+ startDate
								+ &quot;'  and  transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' ) tranTlb where sale.transaction_id=tranTlb.transaction_id  and agent_org_id=&quot;
								+ orgId
								+ &quot;   group by transaction_date) saleRet group by transaction_date ) saleRet on   sale.transaction_date=saleRet.transaction_date 	union select saleRet.transaction_date, ifnull(mrpAmt,0)-ifnull(mrpAmtRet,0) mrpAmt,ifnull(netAmt,0)-ifnull(netAmtRet,0) netAmt from (select transaction_date,ifnull(sum(mrpAmt),0) mrpAmt,ifnull(sum(netAmt),0) netAmt from (select transaction_date,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_bo_agent_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='SALE' and  transaction_date&gt;='&quot;
								+ startDate
								+ &quot;'  and  transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' ) tranTlb where sale.transaction_id=tranTlb.transaction_id  and agent_org_id=&quot;
								+ orgId
								+ &quot;   group by transaction_date union all select transaction_date,ifnull(sum(mrp_amt),0) mrpAmt,ifnull(sum(net_amt),0) netAmt from st_se_bo_agent_loose_book_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='LOOSE_SALE' and  transaction_date&gt;='&quot;
								+ startDate
								+ &quot;'  and  transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' ) tranTlb where sale.transaction_id=tranTlb.transaction_id  and agent_org_id=&quot;
								+ orgId
								+ &quot;   group by transaction_date) sale group by transaction_date) sale right join (select transaction_date,ifnull(sum(mrpAmtRet),0) mrpAmtRet,ifnull(sum(netAmtRet),0) netAmtRet from (select transaction_date,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_bo_agent_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='SALE_RET' and  transaction_date&gt;='&quot;
								+ startDate
								+ &quot;'  and  transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' ) tranTlb where sale.transaction_id=tranTlb.transaction_id  and agent_org_id=&quot;
								+ orgId
								+ &quot;   group by transaction_date union all select transaction_date,ifnull(sum(mrp_amt),0) mrpAmtRet,ifnull(sum(net_amt),0) netAmtRet from  st_se_bo_agent_loose_book_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='LOOSE_SALE_RET' and   transaction_date&gt;='&quot;
								+ startDate
								+ &quot;'  and  transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' ) tranTlb where sale.transaction_id=tranTlb.transaction_id  and agent_org_id=&quot;
								+ orgId
								+ &quot;   group by transaction_date) saleRet group by transaction_date ) saleRet on   sale.transaction_date=saleRet.transaction_date) SALE&quot;;
					} else {
<span class="nc" id="L1044">						saleQry = &quot;select transaction_date date,mrpAmt, netAmt sale from( select sale.transaction_date, mrpAmt-mrpAmtRet mrpAmt,netAmt-netAmtRet netAmt from (select transaction_date,sum(mrpAmt) mrpAmt,sum(netAmt) netAmt from (select transaction_date,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_bo_agent_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='SALE' and  transaction_date&gt;='&quot;</span>
								+ startDate
								+ &quot;'  and  transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' ) tranTlb where sale.transaction_id=tranTlb.transaction_id group by transaction_date union all select transaction_date,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_bo_agent_loose_book_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='LOOSE_SALE' and  transaction_date&gt;='&quot;
								+ startDate
								+ &quot;'  and  transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' ) tranTlb where sale.transaction_id=tranTlb.transaction_id group by transaction_date) sale group by transaction_date) sale left join (select transaction_date,sum(mrpAmtRet) mrpAmtRet,sum(netAmtRet) netAmtRet from (select transaction_date,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_bo_agent_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='SALE_RET' and  transaction_date&gt;='&quot;
								+ startDate
								+ &quot;'  and  transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' ) tranTlb where sale.transaction_id=tranTlb.transaction_id group by transaction_date union all select transaction_date,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_bo_agent_loose_book_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='LOOSE_SALE_RET' and   transaction_date&gt;='&quot;
								+ startDate
								+ &quot;'  and  transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' ) tranTlb where sale.transaction_id=tranTlb.transaction_id group by transaction_date) saleRet group by transaction_date) saleRet on   sale.transaction_date=saleRet.transaction_date 	union  select saleRet.transaction_date, ifnull(mrpAmt,0)-ifnull(mrpAmtRet,0) mrpAmt,ifnull(netAmt,0)-ifnull(netAmtRet,0) netAmt from (select transaction_date,ifnull(sum(mrpAmt),0) mrpAmt,ifnull(sum(netAmt),0) netAmt from (select transaction_date,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_bo_agent_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='SALE' and  transaction_date&gt;='&quot;
								+ startDate
								+ &quot;'  and  transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' ) tranTlb where sale.transaction_id=tranTlb.transaction_id group by transaction_date union all select transaction_date,ifnull(sum(mrp_amt),0) mrpAmt,ifnull(sum(net_amt),0) netAmt from st_se_bo_agent_loose_book_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='LOOSE_SALE' and  transaction_date&gt;='&quot;
								+ startDate
								+ &quot;'  and  transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' ) tranTlb where sale.transaction_id=tranTlb.transaction_id group by transaction_date) sale group by transaction_date) sale right join (select transaction_date,ifnull(sum(mrpAmtRet),0) mrpAmtRet,ifnull(sum(netAmtRet),0) netAmtRet from (select transaction_date,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_bo_agent_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='SALE_RET' and  transaction_date&gt;='&quot;
								+ startDate
								+ &quot;'  and  transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' ) tranTlb where sale.transaction_id=tranTlb.transaction_id group by transaction_date union all select transaction_date,ifnull(sum(mrp_amt),0) mrpAmtRet,ifnull(sum(net_amt),0) netAmtRet from  st_se_bo_agent_loose_book_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='LOOSE_SALE_RET' and   transaction_date&gt;='&quot;
								+ startDate
								+ &quot;'  and  transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' ) tranTlb where sale.transaction_id=tranTlb.transaction_id group by transaction_date) saleRet group by transaction_date) saleRet on   sale.transaction_date=saleRet.transaction_date) SALE&quot;;
					}
<span class="nc bnc" id="L1078" title="All 2 branches missed.">				} else if (&quot;TICKET_WISE&quot;</span>
						.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L1080">					saleQry = &quot;select date,sum(soldTkt*ticket_price) mrpAmt,sum((soldTkt*ticket_price)-(soldTkt*ticket_price*transacrion_sale_comm_rate*0.01)) sale from st_se_game_master gm,st_se_game_inv_detail gid,(select SUBSTRING_INDEX(date,' ',1) date,game_id,book_nbr,sum(sold_tickets) soldTkt from st_se_game_ticket_inv_history where date&gt;='&quot;</span>
							+ startDate
							+ &quot;' and date&lt;='&quot;
							+ endDate
							+ &quot;' and current_owner='RETAILER' group by book_nbr,SUBSTRING_INDEX(date,' ',1)) TktTlb where gm.game_id=TktTlb.game_id and TktTlb.book_nbr=gid.book_nbr and gid.current_owner=&quot;;
<span class="nc bnc" id="L1085" title="All 2 branches missed.">					if (viewByAgt) {</span>
<span class="nc" id="L1086">						saleQry += &quot;'RETAILER' and gid.current_owner_id in(select organization_id from st_lms_organization_master where parent_id=&quot;</span>
								+ orgId + &quot;) group by date&quot;;
					} else {
<span class="nc" id="L1089">						saleQry += &quot;'AGENT' group by date&quot;;</span>
					}
				}

<span class="nc" id="L1093">				pstmt = con.prepareStatement(saleQry);</span>

<span class="nc" id="L1095">				System.out.println(&quot;***Scratch Sale Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L1096">				rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L1098" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1099">					dateMap.get(rs.getString(&quot;date&quot;)).setScratchSale(</span>
							rs.getDouble(&quot;sale&quot;));
				}

				// Calculate Scratch Pwt
<span class="nc" id="L1104">				String pwtQry = &quot;select SUBSTRING_INDEX(rtm.transaction_date,' ',1) tx_date,sum(&quot;</span>
						+ sePwtCol
						+ &quot;) pwt from st_se_retailer_pwt rp,st_lms_retailer_transaction_master rtm where rp.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;=? and rtm.transaction_date&lt;=? and rtm.transaction_type='PWT' &quot;
						+ addScratchPwtQry + &quot; group by tx_date&quot;;
<span class="nc" id="L1108">				pstmt = con.prepareStatement(pwtQry);</span>
<span class="nc" id="L1109">				pstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L1110">				pstmt.setTimestamp(2, endDate);</span>

<span class="nc" id="L1112">				logger.info(&quot;***Scratch Pwt Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L1113">				rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L1115" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1116">					dateMap.get(rs.getString(&quot;tx_date&quot;)).setScratchPwt(</span>
							rs.getDouble(&quot;pwt&quot;));
				}

				// Scratch Direct Player Qry

<span class="nc" id="L1122">				String dirPwtQry = &quot;select tx_date,sum(net_amt) pwtDir from (select SUBSTRING_INDEX(transaction_date,' ',1) tx_date ,(pwt_amt+(pwt_amt*claim_comm*0.01)) net_amt from st_se_agt_direct_player_pwt where transaction_date&gt;=? and transaction_date&lt;=? &quot;</span>
						+ addDirPlrQry + &quot;) aa group by tx_date&quot;;
<span class="nc" id="L1124">				pstmt = con.prepareStatement(dirPwtQry);</span>
<span class="nc" id="L1125">				pstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L1126">				pstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L1127">				System.out.println(&quot;-------Scratch Direct Player Qry------\n&quot;</span>
						+ pstmt);
<span class="nc" id="L1129">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1130" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1131">					dateMap.get(rs.getString(&quot;tx_date&quot;)).setScratchDirPlyPwt(</span>
							rs.getDouble(&quot;pwtDir&quot;));
				}
			}
<span class="nc bnc" id="L1135" title="All 2 branches missed.">			if(ReportUtility.isCS){</span>

<span class="nc" id="L1137">				saleTranCS = &quot;cs,st_lms_retailer_transaction_master rtm where cs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and transaction_type = 'CS_SALE' &quot;
						+ addCSQry + &quot; group by tx_date&quot;;
<span class="nc" id="L1143">				cancelTranCS = &quot;cs,st_lms_retailer_transaction_master rtm where cs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and transaction_type in('CS_CANCEL_SERVER','CS_CANCEL_RET') &quot;
						+ addCSQry + &quot; group by tx_date&quot;;

				// Game Master Query
<span class="nc" id="L1151">				String CSQry = &quot;select category_id from st_cs_product_category_master&quot;;</span>
<span class="nc" id="L1152">				PreparedStatement prodPstmt = con.prepareStatement(CSQry);</span>
<span class="nc" id="L1153">				rsGame = prodPstmt.executeQuery();</span>
<span class="nc" id="L1154">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select tx_date,sum(sale) sale from (&quot;);
<span class="nc" id="L1156">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select tx_date,sum(cancel) cancel from (&quot;);
<span class="nc bnc" id="L1158" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1159">					saleQry</span>
							.append(&quot;(select SUBSTRING_INDEX(transaction_date,' ',1) tx_date,sum(&quot;
									+ csSaleCol
									+ &quot;) sale from st_cs_sale_&quot;
									+ rsGame.getInt(&quot;category_id&quot;)
									+ &quot; &quot;
									+ saleTranCS + &quot;) union all&quot;);

<span class="nc" id="L1167">					cancelQry</span>
							.append(&quot;(select SUBSTRING_INDEX(transaction_date,' ',1) tx_date,sum(&quot;
									+ csSaleCol
									+ &quot;) cancel from st_cs_refund_&quot;
									+ rsGame.getInt(&quot;category_id&quot;)
									+ &quot; &quot;
									+ cancelTranCS + &quot;) union all&quot;);

				}

<span class="nc" id="L1177">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;), saleQry</span>
						.length());
<span class="nc" id="L1179">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;), cancelQry</span>
						.length());
				
<span class="nc" id="L1182">				saleQry.append(&quot;) saleTlb group by tx_date&quot;);</span>
<span class="nc" id="L1183">				cancelQry.append(&quot;) cancelTlb group by tx_date&quot;);</span>

<span class="nc" id="L1185">				logger.debug(&quot;-------CS Sale Query------\n&quot; + saleQry);</span>
<span class="nc" id="L1186">				logger.debug(&quot;-------CS Cancel Query------\n&quot;</span>
						+ cancelQry);

				// CS Sale Query
<span class="nc" id="L1190">				pstmt = con.prepareStatement(saleQry.toString());</span>
<span class="nc" id="L1191">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1192" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1193">					dateMap.get(rs.getString(&quot;tx_date&quot;)).setCSSale(</span>
							rs.getDouble(&quot;sale&quot;));
				}
				// CS Cancel Query
<span class="nc" id="L1197">				pstmt = con.prepareStatement(cancelQry.toString());</span>
<span class="nc" id="L1198">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1199" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1200">					dateMap.get(rs.getString(&quot;tx_date&quot;)).setCSCancel(</span>
							rs.getDouble(&quot;cancel&quot;));
				}
			}
			

<span class="nc bnc" id="L1206" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>
<span class="nc" id="L1207">				depositTranOLA = &quot; drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and transaction_type in('OLA_DEPOSIT') &quot;
						+ addOlaQry + &quot; group by tx_date&quot;;
<span class="nc" id="L1213">				depositCancelTranOLA = &quot; drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and transaction_type in('OLA_DEPOSIT_REFUND') &quot;
						+ addOlaQry + &quot; group by tx_date&quot;;
<span class="nc" id="L1219">				withdrawalTranOLA = &quot; drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and transaction_type in('OLA_WITHDRAWL') &quot;
						+ addOlaQry + &quot; group by tx_date&quot;;

			
<span class="nc" id="L1227">				StringBuilder depositQry = new StringBuilder(</span>
						&quot;select tx_date,sum(deposit_amount) deposit_amount from (&quot;);
<span class="nc" id="L1229">				StringBuilder depositCancelQry = new StringBuilder(</span>
						&quot;select tx_date,sum(deposit_refund_amt) deposit_refund_amt from (&quot;);
<span class="nc" id="L1231">				StringBuilder withdrawalQry = new StringBuilder(</span>
						&quot;select tx_date,sum(withdrawal_amt) withdrawal_amt from (&quot;);
				
<span class="nc" id="L1234">				depositQry</span>
							.append(&quot;(select SUBSTRING_INDEX(transaction_date,' ',1) tx_date,sum(&quot;
									+ olaDepositCol
									+ &quot;) deposit_amount from st_ola_ret_deposit&quot;
									+ depositTranOLA + &quot;)&quot;);

<span class="nc" id="L1240">				depositCancelQry</span>
							.append(&quot;(select SUBSTRING_INDEX(transaction_date,' ',1) tx_date,sum(&quot;
									+ olaDepositCol
									+ &quot;) deposit_refund_amt from st_ola_ret_deposit_refund&quot;
									+ depositCancelTranOLA + &quot;)&quot;);

<span class="nc" id="L1246">				withdrawalQry</span>
							.append(&quot;(select SUBSTRING_INDEX(transaction_date,' ',1) tx_date,sum(&quot;
									+ olaWithdrawalCol
									+ &quot;) withdrawal_amt from st_ola_ret_withdrawl&quot;
									+ withdrawalTranOLA + &quot;)&quot;);

<span class="nc" id="L1252">				String netGamingQuery = &quot;select tx_date,sum(netGaming_amt) total_amt from ((select SUBSTRING_INDEX(transaction_date,' ',1) tx_date,sum(commission_calculated) netGaming_amt from st_ola_agt_ret_commission drs,st_lms_agent_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;+startDate+&quot;' and rtm.transaction_date&lt;='&quot;+endDate+&quot;' and transaction_type in('OLA_COMMISSION')  group by tx_date)) netGamingTlb group by tx_date&quot;;</span>
				
<span class="nc" id="L1254">				depositQry.append(&quot;) depositTlb group by tx_date&quot;);</span>
<span class="nc" id="L1255">				depositCancelQry.append(&quot;) cancelTlb group by tx_date&quot;);</span>
<span class="nc" id="L1256">				withdrawalQry.append(&quot;) withdrawalTlb group by tx_date&quot;);</span>
<span class="nc" id="L1257">				System.out.println(&quot;-------depositQry------\n&quot; + depositQry);</span>
<span class="nc" id="L1258">				System.out.println(&quot;-------depositCancelQry------\n&quot;</span>
						+ depositCancelQry);
<span class="nc" id="L1260">				System.out.println(&quot;-------withdrawalQry------\n&quot; + withdrawalQry);</span>
<span class="nc" id="L1261">				System.out.println(&quot;-------netGaming Qry------\n&quot; + netGamingQuery);</span>

				// OLA deposit Query
<span class="nc" id="L1264">				pstmt = con.prepareStatement(depositQry.toString());</span>
<span class="nc" id="L1265">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1266" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1267">					dateMap.get(rs.getString(&quot;tx_date&quot;)).setOlaDepositAmt(</span>
							rs.getDouble(&quot;deposit_amount&quot;));
				}
				// OLA Deposit Cancel Query
<span class="nc" id="L1271">				pstmt = con.prepareStatement(depositCancelQry.toString());</span>
<span class="nc" id="L1272">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1273" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1274">					dateMap.get(rs.getString(&quot;tx_date&quot;)).setOlaDepositCancelAmt(</span>
							rs.getDouble(&quot;deposit_refund_amt&quot;));
				}
				// OLA Withdrawal Query
<span class="nc" id="L1278">				pstmt = con.prepareStatement(withdrawalQry.toString());</span>
<span class="nc" id="L1279">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1280" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1281">					dateMap.get(rs.getString(&quot;tx_date&quot;)).setOlaWithdrawalAmt(</span>
							rs.getDouble(&quot;withdrawal_amt&quot;));
				}
				// OLA Net Gaming Query
<span class="nc" id="L1285">				pstmt = con.prepareStatement(netGamingQuery.toString());</span>
<span class="nc" id="L1286">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1287" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1288">					dateMap.get(rs.getString(&quot;tx_date&quot;)).setOlaNetGaming(</span>
							rs.getDouble(&quot;total_amt&quot;));
				}
				}

<span class="nc" id="L1293">		} catch (Exception e) {</span>
<span class="nc" id="L1294">			e.printStackTrace();</span>
<span class="nc" id="L1295">		}</span>
<span class="nc" id="L1296">		return dateMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionDayWiseExpand(
			Timestamp startDate, Timestamp endDate, Connection con, String viewBy, int orgId) {
<span class="nc" id="L1301">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1302">		ResultSet rsGame = null;</span>
<span class="nc" id="L1303">		ResultSet rs = null;</span>
<span class="nc" id="L1304">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; serGameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;();</span>
<span class="nc" id="L1305">		Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt; gameAgtMap = null;</span>
		// for Draw Game
<span class="nc" id="L1307">		String saleTranDG = null;</span>
<span class="nc" id="L1308">		String cancelTranDG = null;</span>
<span class="nc" id="L1309">		String pwtTranDG = null;</span>
<span class="nc" id="L1310">		String dirPlrPwt = null;</span>
<span class="nc" id="L1311">		StringBuilder drawQry = null;</span>
		//for CS
<span class="nc" id="L1313">		String saleTranCS = null;</span>
<span class="nc" id="L1314">		String cancelTranCS = null;</span>
<span class="nc" id="L1315">		StringBuilder CSQry = null;</span>
		// for scratch game
<span class="nc" id="L1317">		StringBuilder scratchQry = null;</span>
		
		//for OLA
<span class="nc" id="L1320">		String depositTranOLA = null;</span>
<span class="nc" id="L1321">		String depositCancelTranOLA = null;</span>
<span class="nc" id="L1322">		String withdrawalTranOLA = null;</span>
<span class="nc" id="L1323">		String netGamingTranOLA = null;</span>
<span class="nc" id="L1324">		StringBuilder olaQuery = null;</span>

<span class="nc bnc" id="L1326" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L1327">			return serGameAgtMap;</span>
		}

<span class="nc" id="L1330">		String addDrawQry = &quot;&quot;;</span>
<span class="nc" id="L1331">		String addOlaQry = &quot;&quot;;</span>
<span class="nc" id="L1332">		String addCSQry = &quot;&quot;;</span>
<span class="nc" id="L1333">		String addDirPlrQry = &quot;&quot;;</span>
<span class="nc" id="L1334">		String addScratchPwtQry = &quot;&quot;;</span>

		// For Column which is used

<span class="nc" id="L1338">		String dgSaleCol = &quot;agent_net_amt&quot;;</span>
<span class="nc" id="L1339">		String csSaleCol = &quot;agent_net_amt&quot;;</span>
<span class="nc" id="L1340">		String olaDepositCol = &quot;agent_net_amt&quot;;</span>
<span class="nc" id="L1341">		String olaWithdrawalCol = &quot;agent_net_amt&quot;;</span>
<span class="nc" id="L1342">		String dgPwtCol = &quot;pwt_amt+agt_claim_comm&quot;;</span>
<span class="nc" id="L1343">		String sePwtCol = &quot;pwt_amt+(pwt_amt*agt_claim_comm*0.01)&quot;;</span>
<span class="nc" id="L1344">		boolean viewByAgt = false;</span>
<span class="nc bnc" id="L1345" title="All 4 branches missed.">		if (&quot;AGENT&quot;.equals(viewBy) &amp;&amp; orgId != 0) {</span>
<span class="nc" id="L1346">			viewByAgt = true;</span>
<span class="nc" id="L1347">			dgSaleCol = &quot;net_amt&quot;;</span>
<span class="nc" id="L1348">			csSaleCol = &quot;net_amt&quot;;</span>
<span class="nc" id="L1349">			olaDepositCol = &quot;net_amt&quot;;</span>
<span class="nc" id="L1350">			olaWithdrawalCol = &quot;net_amt&quot;;</span>
<span class="nc" id="L1351">			dgPwtCol = &quot;pwt_amt+retailer_claim_comm&quot;;</span>
<span class="nc" id="L1352">			sePwtCol = &quot;pwt_amt+(pwt_amt*claim_comm*0.01)&quot;;</span>
<span class="nc" id="L1353">			addDrawQry = &quot; and drs.retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;</span>
					+ orgId + &quot;)&quot;;
<span class="nc" id="L1355">			addOlaQry = &quot; and drs.retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;</span>
				+ orgId + &quot;)&quot;;
<span class="nc" id="L1357">			addDirPlrQry = &quot; and agent_org_id=&quot; + orgId;</span>
<span class="nc" id="L1358">			addScratchPwtQry = &quot; and rp.retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;</span>
					+ orgId + &quot;)&quot;;
		}
		try {
<span class="nc" id="L1362">			PreparedStatement datePstmt = con</span>
					.prepareStatement(&quot;CREATE TABLE if not exists `tempdate` ( `alldate` timestamp)&quot;);
<span class="nc" id="L1364">			datePstmt.execute();</span>
<span class="nc" id="L1365">			datePstmt = con.prepareStatement(&quot;truncate table tempdate&quot;);</span>
<span class="nc" id="L1366">			datePstmt.execute();</span>

<span class="nc" id="L1368">			Calendar startCal = Calendar.getInstance();</span>
<span class="nc" id="L1369">			startCal.setTime(startDate);</span>

<span class="nc" id="L1371">			Calendar endCal = Calendar.getInstance();</span>
<span class="nc" id="L1372">			endCal.setTime(endDate);</span>
<span class="nc" id="L1373">			StringBuilder date = new StringBuilder(&quot;&quot;);</span>
<span class="nc bnc" id="L1374" title="All 2 branches missed.">			while (startCal.getTime().before(endCal.getTime())) {</span>
<span class="nc" id="L1375">				date.append(&quot;('&quot;</span>
						+ new java.sql.Date(startCal.getTimeInMillis())
								.toString() + &quot;'),&quot;);
<span class="nc" id="L1378">				startCal.setTimeInMillis(startCal.getTimeInMillis() + 24 * 60</span>
						* 60 * 1000);
			}
<span class="nc" id="L1381">			date.deleteCharAt(date.length() - 1);</span>
<span class="nc" id="L1382">			datePstmt = con.prepareStatement(&quot;insert tempdate values&quot; + date);</span>
<span class="nc" id="L1383">			logger.info(datePstmt);</span>
<span class="nc" id="L1384">			datePstmt.execute();</span>
<span class="nc bnc" id="L1385" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L1386">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L1387">				drawQry = new StringBuilder(</span>
						&quot;select sale.alldate,ifnull(sale,0.0) sale,ifnull(cancel,0.0) cancel,ifnull(pwt,0.0)  pwt from &quot;);
<span class="nc" id="L1389">				saleTranDG = &quot;(select alldate,sum(sale) as sale from (select SUBSTRING_INDEX(rtm.transaction_date,' ',1) trx_date,sum(&quot;</span>
						+ dgSaleCol
						+ &quot;) as sale from st_dg_ret_sale_? drs,st_lms_retailer_transaction_master rtm where transaction_type in('DG_SALE','DG_SALE_OFFLINE') and drs.transaction_id=rtm.transaction_id and transaction_date&gt;='&quot;
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' &quot;
						+ addDrawQry
						+ &quot; group by trx_date) aa right outer join (select SUBSTRING_INDEX(alldate,' ',1) alldate from tempdate ) bb on trx_date=alldate group by alldate) sale,&quot;;
<span class="nc" id="L1398">				cancelTranDG = &quot;(select alldate,sum(cancel) as cancel from (select SUBSTRING_INDEX(rtm.transaction_date,' ',1) trx_date,sum(&quot;</span>
						+ dgSaleCol
						+ &quot;) as cancel from st_dg_ret_sale_refund_? drs,st_lms_retailer_transaction_master rtm where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and drs.transaction_id=rtm.transaction_id and transaction_date&gt;='&quot;
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' &quot;
						+ addDrawQry
						+ &quot; group by trx_date) aa right outer join (select SUBSTRING_INDEX(alldate,' ',1) alldate from tempdate ) bb on trx_date=alldate group by alldate) cancel,&quot;;
<span class="nc" id="L1407">				pwtTranDG = &quot;(select alldate,sum(pwt) as pwt from (select SUBSTRING_INDEX(rtm.transaction_date,' ',1) trx_date,sum(&quot;</span>
						+ dgPwtCol
						+ &quot;) as pwt from st_dg_ret_pwt_? drs,st_lms_retailer_transaction_master rtm  where transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and drs.transaction_id=rtm.transaction_id and transaction_date&gt;='&quot;
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' &quot;
						+ addDrawQry
						+ &quot; group by trx_date) aa right outer join (select SUBSTRING_INDEX(alldate,' ',1) alldate from tempdate ) bb on trx_date=alldate group by alldate) pwt&quot;;
<span class="nc" id="L1416">				drawQry.append(saleTranDG);</span>
<span class="nc" id="L1417">				drawQry.append(cancelTranDG);</span>
<span class="nc" id="L1418">				drawQry.append(pwtTranDG);</span>
<span class="nc" id="L1419">				drawQry</span>
						.append(&quot; where sale.alldate=cancel.alldate and sale.alldate=pwt.alldate and cancel.alldate=pwt.alldate&quot;);
<span class="nc" id="L1421">				System.out.println(&quot;For Expand draw game Qry:: &quot; + drawQry);</span>

<span class="nc" id="L1423">				dirPlrPwt = &quot;select alldate,ifnull(pwtDir,0.0) pwtDir from (select SUBSTRING_INDEX(transaction_date,' ',1) trx_date,sum(pwt_amt+agt_claim_comm) pwtDir from st_dg_agt_direct_plr_pwt where transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and game_id=? &quot;
						+ addDirPlrQry
						+ &quot; group by trx_date) aa right outer join (select SUBSTRING_INDEX(alldate,' ',1) alldate from tempdate) bb on alldate=trx_date&quot;;

<span class="nc" id="L1431">				System.out.println(&quot;For Expand draw game Qry Direct Ply:: &quot;</span>
						+ dirPlrPwt);

				// Game Master Query
<span class="nc" id="L1435">				String gameQry =ReportUtility.getDrawGameMapQuery(startDate);</span>
<span class="nc" id="L1436">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1437">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L1438" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1439">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1440">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1441">					gameMap.putAll(getDayMap(startDate, endDate));</span>
<span class="nc" id="L1442">					pstmt = con.prepareStatement(drawQry.toString());</span>
<span class="nc" id="L1443">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L1444">					pstmt.setInt(2, gameId);</span>
<span class="nc" id="L1445">					pstmt.setInt(3, gameId);</span>
					
<span class="nc" id="L1447">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1448" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1449">						String agtId = rs.getString(&quot;alldate&quot;);</span>
<span class="nc" id="L1450">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L1451">						gameMap.get(agtId)</span>
								.setDrawCancel(rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L1453">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>

<span class="nc" id="L1455">					}</span>

					// Direct Player Pwt
<span class="nc" id="L1458">					pstmt = con.prepareStatement(dirPlrPwt);</span>
<span class="nc" id="L1459">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L1460">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1461" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1462">						String agtId = rs.getString(&quot;alldate&quot;);</span>
<span class="nc" id="L1463">						gameMap.get(agtId).setDrawDirPlyPwt(</span>
								rs.getDouble(&quot;pwtDir&quot;));
<span class="nc" id="L1465">					}</span>
<span class="nc" id="L1466">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L1467">				}</span>

<span class="nc" id="L1469">				serGameAgtMap.put(&quot;DG&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L1471" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
<span class="nc" id="L1472">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L1473">				scratchQry = new StringBuilder(</span>
						&quot;select sale.alldate,ifnull(sale,0.0) sale,ifnull(pwt,0.0) pwt from &quot;);
<span class="nc" id="L1475">				logger.info(&quot;----Type Select ---&quot;</span>
						+ LMSFilterDispatcher.seSaleReportType);
<span class="nc bnc" id="L1477" title="All 2 branches missed.">				if (&quot;BOOK_WISE&quot;.equals(LMSFilterDispatcher.seSaleReportType)) {</span>
<span class="nc bnc" id="L1478" title="All 2 branches missed.">					if (viewByAgt) {</span>
<span class="nc" id="L1479">						saleTranDG = &quot;(select bb.alldate,sum(sale) as sale from (select sale.transaction_date trx_date,(ifnull(mrpAmt,0.0)-ifnull(mrpAmtRet,0.0)) mrpAmt,(ifnull(netAmt,0.0)-ifnull(netAmtRet,0.0)) sale from (select transaction_date,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_agent_retailer_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_agent_transaction_master where transaction_type='SALE' and transaction_date&gt;='&quot;</span>
								+ startDate
								+ &quot;' and transaction_date&lt;='&quot;
								+ endDate
								+ &quot;') tranTlb where sale.transaction_id=tranTlb.transaction_id and game_id=? and agent_org_id=&quot;
								+ orgId
								+ &quot; group by transaction_date) sale left outer join (select transaction_date,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_agent_retailer_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_agent_transaction_master where transaction_type='SALE_RET' and transaction_date&gt;='&quot;
								+ startDate
								+ &quot;' and transaction_date&lt;='&quot;
								+ endDate
								+ &quot;') tranTlb where sale.transaction_id=tranTlb.transaction_id and game_id=? and agent_org_id=&quot;
								+ orgId
								+ &quot; group by transaction_date) saleRet on sale.transaction_date=saleRet.transaction_date) aa right outer join (select SUBSTRING_INDEX(alldate,' ',1) alldate from tempdate ) bb on trx_date=alldate group by alldate) sale,&quot;;
					} else {
<span class="nc" id="L1493">						saleTranDG = &quot;(select bb.alldate,sum(sale) as sale from (select sale.transaction_date trx_date,(ifnull(mrpAmt,0.0)-ifnull(mrpAmtRet,0.0)) mrpAmt,(ifnull(netAmt,0.0)-ifnull(netAmtRet,0.0)) sale from (select transaction_date,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_bo_agent_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='SALE' and transaction_date&gt;='&quot;</span>
								+ startDate
								+ &quot;' and transaction_date&lt;='&quot;
								+ endDate
								+ &quot;') tranTlb where sale.transaction_id=tranTlb.transaction_id and game_id=? group by transaction_date) sale left outer join (select transaction_date,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_bo_agent_transaction sale,(select transaction_id,SUBSTRING_INDEX(transaction_date,' ',1) transaction_date from st_lms_bo_transaction_master where transaction_type='SALE_RET' and transaction_date&gt;='&quot;
								+ startDate
								+ &quot;' and transaction_date&lt;='&quot;
								+ endDate
								+ &quot;') tranTlb where sale.transaction_id=tranTlb.transaction_id and game_id=? group by transaction_date) saleRet on sale.transaction_date=saleRet.transaction_date) aa right outer join (select SUBSTRING_INDEX(alldate,' ',1) alldate from tempdate ) bb on trx_date=alldate group by alldate) sale,&quot;;
					}
<span class="nc bnc" id="L1503" title="All 2 branches missed.">				} else if (&quot;TICKET_WISE&quot;</span>
						.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L1505">					String addQry = null;</span>
<span class="nc bnc" id="L1506" title="All 2 branches missed.">					if (viewByAgt) {</span>
<span class="nc" id="L1507">						addQry = &quot;'RETAILER' and gid.current_owner_id in(select organization_id from st_lms_organization_master where parent_id=&quot;</span>
								+ orgId + &quot;)&quot;;
					} else {
<span class="nc" id="L1510">						addQry = &quot;'AGENT'&quot;;</span>
					}

<span class="nc" id="L1513">					saleTranDG = &quot;(select bb.alldate,sum(sale) as sale from (select date,sum(soldTkt*ticket_price) mrpAmt,sum((soldTkt*ticket_price)-(soldTkt*ticket_price*transacrion_sale_comm_rate*0.01)) sale from st_se_game_master gm,st_se_game_inv_detail gid,(select SUBSTRING_INDEX(date,' ',1) date,game_id,book_nbr,sum(sold_tickets) soldTkt from st_se_game_ticket_inv_history where date&gt;='&quot;</span>
							+ startDate
							+ &quot;' and date&lt;='&quot;
							+ endDate
							+ &quot;' and current_owner='RETAILER' and game_id=? group by book_nbr,SUBSTRING_INDEX(date,' ',1)) TktTlb where gm.game_id=TktTlb.game_id and gm.game_id=? and TktTlb.book_nbr=gid.book_nbr and gid.current_owner=&quot;
							+ addQry
							+ &quot; group by date) aa right outer join (select SUBSTRING_INDEX(alldate,' ',1) alldate from tempdate ) bb on date=alldate group by alldate) sale, &quot;;

				}

<span class="nc" id="L1523">				pwtTranDG = &quot;(select bb.alldate,sum(pwt) as pwt from (select trx_date,sum(&quot;</span>
						+ sePwtCol
						+ &quot;) as pwt from (select SUBSTRING_INDEX(transaction_date,' ',1) trx_date,pwt_amt,claim_comm,agt_claim_comm,rp.game_id from st_se_retailer_pwt rp,st_lms_retailer_transaction_master rtm where rp.transaction_id=rtm.transaction_id and transaction_date&gt;='&quot;
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and transaction_type='PWT' &quot;
						+ addScratchPwtQry
						+ &quot;) aa where game_id=? group by trx_date) aa right outer join (select SUBSTRING_INDEX(alldate,' ',1) alldate from tempdate ) bb on trx_date=alldate group by alldate) pwt&quot;;
<span class="nc" id="L1532">				scratchQry.append(saleTranDG);</span>
<span class="nc" id="L1533">				scratchQry.append(pwtTranDG);</span>
<span class="nc" id="L1534">				scratchQry.append(&quot; where sale.alldate=pwt.alldate&quot;);</span>
<span class="nc" id="L1535">				System.out.println(&quot;For Expand scratch game Qry:: &quot;</span>
						+ scratchQry);

<span class="nc" id="L1538">				dirPlrPwt = &quot;select alldate,ifnull(pwtDir,0.0) pwtDir from (select SUBSTRING_INDEX(transaction_date,' ',1) trx_date,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwtDir from st_se_agt_direct_player_pwt where transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and game_id=? &quot;
						+ addDirPlrQry
						+ &quot; group by trx_date) aa right outer join (select SUBSTRING_INDEX(alldate,' ',1) alldate from tempdate) bb on alldate=trx_date&quot;;

<span class="nc" id="L1546">				System.out.println(&quot;For Expand draw game Qry Direct Ply:: &quot;</span>
						+ dirPlrPwt);
				// Game Master Query
<span class="nc" id="L1549">				String gameQry = &quot;select game_id,game_name from st_se_game_master&quot;;</span>
<span class="nc" id="L1550">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1551">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L1552" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1553">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1554">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1555">					gameMap.putAll(getDayMap(startDate, endDate));</span>
<span class="nc" id="L1556">					pstmt = con.prepareStatement(scratchQry.toString());</span>
<span class="nc" id="L1557">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L1558">					pstmt.setInt(2, gameId);</span>
<span class="nc" id="L1559">					pstmt.setInt(3, gameId);</span>
<span class="nc" id="L1560">					System.out.println(&quot;-------Indivisual Game Qry-------\n&quot;</span>
							+ pstmt);
<span class="nc" id="L1562">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1563" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1564">						String agtId = rs.getString(&quot;alldate&quot;);</span>
<span class="nc" id="L1565">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L1566">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>
<span class="nc" id="L1567">					}</span>

					// Direct Player Pwt
<span class="nc" id="L1570">					pstmt = con.prepareStatement(dirPlrPwt);</span>
<span class="nc" id="L1571">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L1572">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1573" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1574">						String agtId = rs.getString(&quot;alldate&quot;);</span>
<span class="nc" id="L1575">						gameMap.get(agtId).setScratchDirPlyPwt(</span>
								rs.getDouble(&quot;pwtDir&quot;));
<span class="nc" id="L1577">					}</span>
<span class="nc" id="L1578">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L1579">				}</span>

<span class="nc" id="L1581">				serGameAgtMap.put(&quot;SE&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L1583" title="All 2 branches missed.">			if(ReportUtility.isCS){</span>

<span class="nc" id="L1585">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L1586">				CSQry = new StringBuilder(</span>
						&quot;select sale.alldate,ifnull(sale,0.0) sale,ifnull(cancel,0.0) cancel from &quot;);
<span class="nc" id="L1588">				saleTranCS = &quot;(select alldate,sum(sale) as sale from (select SUBSTRING_INDEX(rtm.transaction_date,' ',1) trx_date,sum(&quot;</span>
						+ csSaleCol
						+ &quot;) as sale from st_cs_sale_? cs,st_lms_retailer_transaction_master rtm where transaction_type = 'CS_SALE' and cs.transaction_id=rtm.transaction_id and transaction_date&gt;='&quot;
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' &quot;
						+ addCSQry
						+ &quot; group by trx_date) aa right outer join (select SUBSTRING_INDEX(alldate,' ',1) alldate from tempdate ) bb on trx_date=alldate group by alldate) sale,&quot;;
<span class="nc" id="L1597">				cancelTranCS = &quot;(select alldate,sum(cancel) as cancel from (select SUBSTRING_INDEX(rtm.transaction_date,' ',1) trx_date,sum(&quot;</span>
						+ csSaleCol
						+ &quot;) as cancel from st_cs_refund_? cs,st_lms_retailer_transaction_master rtm where transaction_type in('CS_CANCEL_SERVER','CS_CANCEL_RET') and cs.transaction_id=rtm.transaction_id and transaction_date&gt;='&quot;
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' &quot;
						+ addCSQry
						+ &quot; group by trx_date) aa right outer join (select SUBSTRING_INDEX(alldate,' ',1) alldate from tempdate ) bb on trx_date=alldate group by alldate) cancel &quot;;
<span class="nc" id="L1606">				CSQry.append(saleTranCS);</span>
<span class="nc" id="L1607">				CSQry.append(cancelTranCS);</span>
<span class="nc" id="L1608">				CSQry</span>
						.append(&quot; where sale.alldate=cancel.alldate&quot;);
<span class="nc" id="L1610">				logger.debug(&quot;For Expand CS Qry:: &quot; + CSQry);</span>

				// Game Master Query
<span class="nc" id="L1613">				String catQry = &quot;select category_id,category_code from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L1614">				PreparedStatement gamePstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L1615">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L1616" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1617">					int catId = rsGame.getInt(&quot;category_id&quot;);</span>
<span class="nc" id="L1618">					Map&lt;String, CompleteCollectionBean&gt; prodMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1619">					prodMap.putAll(getDayMap(startDate, endDate));</span>
<span class="nc" id="L1620">					pstmt = con.prepareStatement(CSQry.toString());</span>
<span class="nc" id="L1621">					pstmt.setInt(1, catId);</span>
<span class="nc" id="L1622">					pstmt.setInt(2, catId);</span>
<span class="nc" id="L1623">					logger.debug(&quot;-------Indivisual category Qry-------\n&quot;</span>
							+ pstmt);
<span class="nc" id="L1625">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1626" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1627">						String agtId = rs.getString(&quot;alldate&quot;);</span>
<span class="nc" id="L1628">						prodMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L1629">						prodMap.get(agtId).setDrawCancel(rs.getDouble(&quot;cancel&quot;));</span>
<span class="nc" id="L1630">					}</span>
<span class="nc" id="L1631">					gameAgtMap.put(rsGame.getString(&quot;category_code&quot;), prodMap);</span>
<span class="nc" id="L1632">				}</span>

<span class="nc" id="L1634">				serGameAgtMap.put(&quot;CS&quot;, gameAgtMap);</span>
			
			}
			
<span class="nc bnc" id="L1638" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>

<span class="nc" id="L1640">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L1641">				olaQuery = new StringBuilder(</span>
						&quot;select deposit.alldate, ifnull(deposit_amount,0.0) deposit_amt, ifnull(deposit_refund_amt,0.0) deposit_refund_amt, ifnull(withdrawal_amt,0.0) withdrawal_amt, ifnull(total_amt,0.0) netGaming_amt from &quot;);
<span class="nc" id="L1643">				depositTranOLA = &quot;(select alldate,sum(deposit_amount) deposit_amount from (select SUBSTRING_INDEX(transaction_date,' ',1) tx_date,sum(&quot;</span>
						+ olaDepositCol
						+ &quot;) deposit_amount from st_ola_ret_deposit drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;
						+ startDate
						+ &quot;' and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' &quot;
						+ addOlaQry
						+ &quot; and transaction_type in('OLA_DEPOSIT') and wallet_id=?  group by tx_date) depositTlb right outer join (select SUBSTRING_INDEX(alldate,' ',1) alldate from tempdate ) temp on tx_date=alldate group by alldate) deposit,&quot;;
<span class="nc" id="L1652">				depositCancelTranOLA = &quot;(select alldate,sum(deposit_refund_amt) deposit_refund_amt from (select SUBSTRING_INDEX(transaction_date,' ',1) tx_date,sum(&quot;</span>
						+ olaDepositCol
						+ &quot;) deposit_refund_amt from st_ola_ret_deposit_refund drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;
						+ startDate
						+ &quot;' and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' &quot;
						+ addOlaQry
						+ &quot; and transaction_type in('OLA_DEPOSIT_REFUND') and wallet_id=? group by tx_date) cancelTlb right outer join (select SUBSTRING_INDEX(alldate,' ',1) alldate from tempdate ) temp on tx_date=alldate group by alldate) cancel,&quot;;
<span class="nc" id="L1661">				withdrawalTranOLA = &quot;(select alldate,sum(withdrawal_amt) withdrawal_amt from (select SUBSTRING_INDEX(transaction_date,' ',1) tx_date,sum(&quot;</span>
						+ olaWithdrawalCol
						+ &quot;) withdrawal_amt from st_ola_ret_withdrawl drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;
						+ startDate
						+ &quot;' and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' &quot;
						+ addOlaQry
						+ &quot; and transaction_type in('OLA_WITHDRAWL') and wallet_id=? group by tx_date) withdrawalTlb right outer join (select SUBSTRING_INDEX(alldate,' ',1) alldate from tempdate ) temp on tx_date=alldate group by alldate) withdraw,&quot;;
<span class="nc" id="L1670">				netGamingTranOLA = &quot;(select alldate,sum(netGaming_amt) total_amt from (select SUBSTRING_INDEX(transaction_date,' ',1) tx_date,sum(commission_calculated) netGaming_amt from st_ola_agt_ret_commission drs,st_lms_agent_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;</span>
					+ startDate
					+ &quot;' and rtm.transaction_date&lt;='&quot;
					+ endDate
					+ &quot;' &quot;
					+ addOlaQry
					+ &quot; and transaction_type in('OLA_COMMISSION') and wallet_id=? group by tx_date) netGamingTlb right outer join (select SUBSTRING_INDEX(alldate,' ',1) alldate from tempdate ) temp on tx_date=alldate group by alldate) netgaming&quot;;
<span class="nc" id="L1677">				olaQuery.append(depositTranOLA);</span>
<span class="nc" id="L1678">				olaQuery.append(depositCancelTranOLA);</span>
<span class="nc" id="L1679">				olaQuery.append(withdrawalTranOLA);</span>
<span class="nc" id="L1680">				olaQuery.append(netGamingTranOLA);</span>
<span class="nc" id="L1681">				olaQuery</span>
						.append(&quot; where deposit.alldate = cancel.alldate and cancel.alldate = withdraw.alldate and withdraw.alldate = netgaming.alldate&quot;);
<span class="nc" id="L1683">				System.out.println(&quot;For Expand OLA Qry:: &quot; + olaQuery);</span>

				// Wallet Master Query
<span class="nc" id="L1686">				String catQry = &quot;select wallet_id,wallet_display_name from st_ola_wallet_master&quot;;</span>
<span class="nc" id="L1687">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L1688">				rsGame = prodPstmt.executeQuery();</span>
<span class="nc bnc" id="L1689" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1690">					int walletIdId = rsGame.getInt(&quot;wallet_id&quot;);</span>
<span class="nc" id="L1691">					Map&lt;String, CompleteCollectionBean&gt; walletMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1692">					walletMap.putAll(getDayMap(startDate, endDate));</span>
<span class="nc" id="L1693">					pstmt = con.prepareStatement(olaQuery.toString());</span>
<span class="nc" id="L1694">					pstmt.setInt(1, walletIdId);</span>
<span class="nc" id="L1695">					pstmt.setInt(2, walletIdId);</span>
<span class="nc" id="L1696">					pstmt.setInt(3, walletIdId);</span>
<span class="nc" id="L1697">					pstmt.setInt(4, walletIdId);</span>
<span class="nc" id="L1698">					logger.debug(&quot;-------Indivisual Wallet Qry-------\n&quot;</span>
							+ pstmt);
<span class="nc" id="L1700">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1701" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1702">						String agtId = rs.getString(&quot;alldate&quot;);</span>
<span class="nc" id="L1703">						walletMap.get(agtId).setOlaDepositAmt(rs.getDouble(&quot;deposit_amt&quot;));</span>
<span class="nc" id="L1704">						walletMap.get(agtId)</span>
								.setOlaDepositCancelAmt(rs.getDouble(&quot;deposit_refund_amt&quot;));
<span class="nc" id="L1706">						walletMap.get(agtId).setOlaWithdrawalAmt(rs.getDouble(&quot;withdrawal_amt&quot;));</span>
<span class="nc" id="L1707">						walletMap.get(agtId).setOlaNetGaming(rs.getDouble(&quot;netGaming_amt&quot;));</span>
<span class="nc" id="L1708">					}</span>

<span class="nc" id="L1710">					gameAgtMap.put(rsGame.getString(&quot;wallet_display_name&quot;), walletMap);</span>
<span class="nc" id="L1711">				}</span>
<span class="nc" id="L1712">					serGameAgtMap.put(&quot;OLA&quot;, gameAgtMap);</span>
			}
<span class="nc" id="L1714">		} catch (Exception e) {</span>
<span class="nc" id="L1715">			e.printStackTrace();</span>
<span class="nc" id="L1716">		}</span>
<span class="nc" id="L1717">		return serGameAgtMap;</span>
	}

	public Map&lt;String, CompleteCollectionBean&gt; collectionReport(
			Timestamp startDate, Timestamp endDate, String reportType) {
		
<span class="nc" id="L1723">		Connection con = null;</span>
<span class="nc" id="L1724">		Map&lt;String, CompleteCollectionBean&gt; agtMap = null;</span>
		
		try {
<span class="nc" id="L1727">			con = DBConnect.getConnection();</span>
			
<span class="nc bnc" id="L1729" title="All 2 branches missed.">			if (&quot;Agent Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1730">				agtMap = collectionAgentWise(startDate, endDate, con);</span>
<span class="nc bnc" id="L1731" title="All 2 branches missed.">			} else if (&quot;Day Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1732">				agtMap = collectionDayWise(startDate, endDate, con,</span>
						&quot;BO&quot;, 0);
			}
<span class="nc" id="L1735">		} catch (Exception e) {</span>
<span class="nc" id="L1736">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1738">			try {</span>
<span class="nc" id="L1739">				con.close();</span>
<span class="nc" id="L1740">			} catch (SQLException e) {</span>
<span class="nc" id="L1741">				e.printStackTrace();</span>
<span class="nc" id="L1742">			}</span>
<span class="nc" id="L1743">		}</span>
<span class="nc" id="L1744">		return agtMap;</span>
	}

	public Map&lt;String, CompleteCollectionBean&gt; collectionReport(
			Timestamp startDate, Timestamp endDate, String reportType, ReportStatusBean reportStatusBean) {
		
<span class="nc" id="L1750">		Connection con = null;</span>
<span class="nc" id="L1751">		Map&lt;String, CompleteCollectionBean&gt; agtMap = null;</span>
		
		try {
<span class="nc bnc" id="L1754" title="All 4 branches missed.">			if(&quot;NO&quot;.equals(Utility.getPropertyValue(&quot;IS_DATA_FROM_REPLICA&quot;)) || &quot;MAIN_DB&quot;.equals(reportStatusBean.getReportingFrom()))</span>
<span class="nc" id="L1755">				con = DBConnect.getConnection();</span>
			else
<span class="nc" id="L1757">				con = DBConnectReplica.getConnection();</span>

<span class="nc bnc" id="L1759" title="All 2 branches missed.">			if (&quot;Agent Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1760">				agtMap = collectionAgentWise(startDate, endDate, con);</span>
<span class="nc bnc" id="L1761" title="All 2 branches missed.">			} else if (&quot;Day Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1762">				agtMap = collectionDayWise(startDate, endDate, con,</span>
						&quot;BO&quot;, 0);
			}
<span class="nc" id="L1765">		} catch (Exception e) {</span>
<span class="nc" id="L1766">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1768">			try {</span>
<span class="nc" id="L1769">				con.close();</span>
<span class="nc" id="L1770">			} catch (SQLException e) {</span>
<span class="nc" id="L1771">				e.printStackTrace();</span>
<span class="nc" id="L1772">			}</span>
<span class="nc" id="L1773">		}</span>
<span class="nc" id="L1774">		return agtMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionReportExpand(
			Timestamp startDate, Timestamp endDate, String reportType, ReportStatusBean reportStatusBean) {
		
<span class="nc" id="L1780">		Connection con = null;</span>
<span class="nc" id="L1781">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; agtMap = null;</span>
		
		try {
<span class="nc bnc" id="L1784" title="All 4 branches missed.">			if(&quot;NO&quot;.equals(Utility.getPropertyValue(&quot;IS_DATA_FROM_REPLICA&quot;)) || &quot;MAIN_DB&quot;.equals(reportStatusBean.getReportingFrom()))</span>
<span class="nc" id="L1785">				con = DBConnect.getConnection();</span>
			else
<span class="nc" id="L1787">				con = DBConnectReplica.getConnection();</span>
			
<span class="nc bnc" id="L1789" title="All 2 branches missed.">			if (&quot;Agent Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L1790">				agtMap = collectionAgentWiseExpand(startDate, endDate, con);</span>
<span class="nc bnc" id="L1791" title="All 2 branches missed.">			} else if (&quot;Day Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L1792">				agtMap = collectionDayWiseExpand(startDate, endDate, con, &quot;BO&quot;, 0);</span>
			}
<span class="nc" id="L1794">		} catch (Exception e) {</span>
<span class="nc" id="L1795">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1797">			try {</span>
<span class="nc" id="L1798">				con.close();</span>
<span class="nc" id="L1799">			} catch (SQLException e) {</span>
<span class="nc" id="L1800">				e.printStackTrace();</span>
<span class="nc" id="L1801">			}</span>
<span class="nc" id="L1802">		}</span>
<span class="nc" id="L1803">		return agtMap;</span>
	}

	public Map&lt;String, CompleteCollectionBean&gt; collectionReportForAgent(
			Timestamp startDate, Timestamp endDate, int agtOrgId,
			String reportType) {
		
<span class="nc" id="L1810">		Connection con = null;</span>
<span class="nc" id="L1811">		Map&lt;String, CompleteCollectionBean&gt; agtMap = null;</span>
		
		try {
<span class="nc" id="L1814">			con = DBConnect.getConnection();</span>
			
<span class="nc bnc" id="L1816" title="All 2 branches missed.">			if (&quot;Retailer Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1817">				agtMap = collectionRetailerWise(startDate, endDate, con,agtOrgId);</span>
<span class="nc bnc" id="L1818" title="All 2 branches missed.">			} else if (&quot;Agent Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1819">				agtMap = collectionAgentWise(startDate, endDate, con);</span>
<span class="nc bnc" id="L1820" title="All 2 branches missed.">			} else if (&quot;Day Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1821">				agtMap = collectionDayWise(startDate, endDate, con,</span>
						&quot;AGENT&quot;, agtOrgId);
			}
<span class="nc" id="L1824">		} catch (Exception e) {</span>
<span class="nc" id="L1825">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1827">			try {</span>
<span class="nc" id="L1828">				con.close();</span>
<span class="nc" id="L1829">			} catch (SQLException e) {</span>
<span class="nc" id="L1830">				e.printStackTrace();</span>
<span class="nc" id="L1831">			}</span>
<span class="nc" id="L1832">		}</span>
<span class="nc" id="L1833">		return agtMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionReportForAgentExpand(
			Timestamp startDate, Timestamp endDate, String reportType,
			int agtOrgId) {
<span class="nc" id="L1839">		System.out</span>
				.println(&quot;----------collectionReport----------reportType-----&quot;
						+ reportType);
<span class="nc" id="L1842">		Connection con = null;</span>
<span class="nc" id="L1843">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; agtMap = null;</span>
		
		try {
<span class="nc" id="L1846">			con = DBConnect.getConnection();</span>
			
<span class="nc bnc" id="L1848" title="All 2 branches missed.">			if (&quot;Retailer Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L1849">				agtMap = collectionRetailerWiseExpand(startDate, endDate, con, agtOrgId);</span>
<span class="nc bnc" id="L1850" title="All 2 branches missed.">			} else if (&quot;Day Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L1851">				agtMap = collectionDayWiseExpand(startDate, endDate, con, &quot;AGENT&quot;, agtOrgId);</span>
			}
<span class="nc" id="L1853">		} catch (Exception e) {</span>
<span class="nc" id="L1854">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1856">			try {</span>
<span class="nc" id="L1857">				con.close();</span>
<span class="nc" id="L1858">			} catch (SQLException e) {</span>
<span class="nc" id="L1859">				e.printStackTrace();</span>
<span class="nc" id="L1860">			}</span>
<span class="nc" id="L1861">		}</span>
<span class="nc" id="L1862">		return agtMap;</span>
	}

	public Map&lt;String, CompleteCollectionBean&gt; collectionRetailerWise(
			Timestamp startDate, Timestamp endDate, Connection con, int agtOrgId) {
<span class="nc" id="L1867">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1868">		ResultSet rsGame = null;</span>
<span class="nc" id="L1869">		ResultSet rs = null;</span>
<span class="nc" id="L1870">		ResultSet rsRetOrg = null;</span>
<span class="nc" id="L1871">		Map&lt;String, CompleteCollectionBean&gt; agtMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1872">		CompleteCollectionBean collBean = null;</span>
		// for Draw Game
<span class="nc" id="L1874">		String saleTranDG = null;</span>
<span class="nc" id="L1875">		String cancelTranDG = null;</span>
<span class="nc" id="L1876">		String pwtTranDG = null;</span>
		//for CS
<span class="nc" id="L1878">		String saleTranCS = null;</span>
<span class="nc" id="L1879">		String cancelTranCS = null;</span>

		
		//for OLA
<span class="nc" id="L1883">		String depositTranOLA = null;</span>
<span class="nc" id="L1884">		String cancelTranOLA = null;</span>
<span class="nc" id="L1885">		String withdrawalTranOLA = null;</span>

<span class="nc bnc" id="L1887" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L1888">			return agtMap;</span>
		}

		// for scratch game
		try {
			
		
<span class="nc" id="L1895">			String agtOrgQry =&quot; &quot;;</span>
				
<span class="nc bnc" id="L1897" title="All 2 branches missed.">			if (agtOrgId == 0) {</span>
<span class="nc" id="L1898">					agtOrgQry = QueryManager.getOrgQry(&quot;RETAILER&quot;);</span>
			} else {

<span class="nc" id="L1901">				String appendOrder = QueryManager.getAppendOrgOrder();</span>
<span class="nc" id="L1902">				agtOrgQry = &quot;select name orgCode,organization_id from st_lms_organization_master where  parent_id=&quot;</span>
						+ agtOrgId + &quot;  order by &quot; + appendOrder;
<span class="nc bnc" id="L1904" title="All 2 branches missed.">				if ((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;CODE&quot;)) {</span>

<span class="nc" id="L1906">					agtOrgQry = &quot;select org_code orgCode,organization_id from st_lms_organization_master where  parent_id=&quot;</span>
							+ agtOrgId + &quot;  order by &quot; + appendOrder;

<span class="nc bnc" id="L1909" title="All 2 branches missed.">				} else if ((LMSFilterDispatcher.orgFieldType)</span>
						.equalsIgnoreCase(&quot;CODE_NAME&quot;)) {

<span class="nc" id="L1912">					agtOrgQry = &quot;select concat(org_code,'_',name) orgCode,organization_id from st_lms_organization_master where  parent_id=&quot;</span>
							+ agtOrgId + &quot;  order by &quot; + appendOrder;

<span class="nc bnc" id="L1915" title="All 2 branches missed.">				} else if ((LMSFilterDispatcher.orgFieldType)</span>
						.equalsIgnoreCase(&quot;NAME_CODE&quot;)) {
<span class="nc" id="L1917">					agtOrgQry = &quot;select concat(name,'_',org_code) orgCode,organization_id from st_lms_organization_master where  parent_id=&quot;</span>
							+ agtOrgId + &quot;  order by &quot; + appendOrder;

				}

			}
				
			
		
<span class="nc" id="L1926">			pstmt = con.prepareStatement(agtOrgQry);</span>
<span class="nc" id="L1927">			rsRetOrg = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1928" title="All 2 branches missed.">			while (rsRetOrg.next()) {</span>
<span class="nc" id="L1929">				collBean = new CompleteCollectionBean();</span>
<span class="nc" id="L1930">				collBean.setOrgName(rsRetOrg.getString(&quot;orgCode&quot;));</span>
<span class="nc bnc" id="L1931" title="All 2 branches missed.">				if (ReportUtility.isDG) {</span>
<span class="nc" id="L1932">					collBean.setDrawSale(0.0);</span>
<span class="nc" id="L1933">					collBean.setDrawPwt(0.0);</span>
<span class="nc" id="L1934">					collBean.setDrawCancel(0.0);</span>
<span class="nc" id="L1935">					collBean.setDrawDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L1937" title="All 2 branches missed.">				if (ReportUtility.isSE) {</span>
<span class="nc" id="L1938">					collBean.setScratchSale(0.0);</span>
<span class="nc" id="L1939">					collBean.setScratchPwt(0.0);</span>
<span class="nc" id="L1940">					collBean.setScratchDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L1942" title="All 2 branches missed.">				if (ReportUtility.isCS) {</span>
<span class="nc" id="L1943">					collBean.setCSSale(0.0);</span>
<span class="nc" id="L1944">					collBean.setCSCancel(0.0);</span>
				}
<span class="nc bnc" id="L1946" title="All 2 branches missed.">				if(ReportUtility.isOLA){</span>
<span class="nc" id="L1947">					collBean.setOlaDepositAmt(0.0);</span>
<span class="nc" id="L1948">					collBean.setOlaDepositCancelAmt(0.0);</span>
<span class="nc" id="L1949">					collBean.setOlaWithdrawalAmt(0.0);</span>
<span class="nc" id="L1950">					collBean.setOlaNetGaming(0.0);</span>
				}
<span class="nc" id="L1952">				agtMap.put(rsRetOrg.getString(&quot;organization_id&quot;), collBean);</span>
			}
<span class="nc" id="L1954">			agtOrgQry = agtOrgQry.replace(&quot;name,&quot;, &quot;&quot;);</span>
<span class="nc bnc" id="L1955" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L1956">				saleTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_SALE','DG_SALE_OFFLINE') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (&quot; + agtOrgQry + &quot;)&quot;;
<span class="nc" id="L1961">				cancelTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (&quot; + agtOrgQry + &quot;)&quot;;
<span class="nc" id="L1966">				pwtTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (&quot; + agtOrgQry + &quot;)&quot;;

				// Game Master Query
<span class="nc" id="L1973">				String gameQry = ReportUtility.getDrawGameMapQuery(startDate);</span>
<span class="nc" id="L1974">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1975">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L1976">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select retailer_org_id,sum(sale) as sale from (&quot;);
<span class="nc" id="L1978">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select retailer_org_id,sum(cancel) as cancel from (&quot;);
<span class="nc" id="L1980">				StringBuilder pwtQry = new StringBuilder(</span>
						&quot;select retailer_org_id,sum(pwt) as pwt from (&quot;);
<span class="nc bnc" id="L1982" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1983">					saleQry</span>
							.append(&quot;(select drs.retailer_org_id,sum(net_amt) as sale from st_dg_ret_sale_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; drs where transaction_id in (&quot;
									+ saleTranDG
									+ &quot;) group by drs.retailer_org_id) union all&quot;);

<span class="nc" id="L1990">					cancelQry</span>
							.append(&quot;(select drs.retailer_org_id,sum(net_amt) as cancel from st_dg_ret_sale_refund_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; drs where transaction_id in (&quot;
									+ cancelTranDG
									+ &quot;) group by drs.retailer_org_id) union all&quot;);

<span class="nc" id="L1997">					pwtQry</span>
							.append(&quot;(select drs.retailer_org_id,sum(pwt_amt+retailer_claim_comm) as pwt from st_dg_ret_pwt_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; drs where transaction_id in (&quot;
									+ pwtTranDG
									+ &quot;) group by drs.retailer_org_id) union all&quot;);

				}

<span class="nc" id="L2006">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;), saleQry</span>
						.length());
<span class="nc" id="L2008">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;), cancelQry</span>
						.length());
<span class="nc" id="L2010">				pwtQry.delete(pwtQry.lastIndexOf(&quot;union all&quot;), pwtQry.length());</span>

<span class="nc" id="L2012">				saleQry.append(&quot;) saleTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L2013">				cancelQry.append(&quot;) cancelTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L2014">				pwtQry.append(&quot;) pwtTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L2015">				System.out.println(&quot;-------Draw Sale Qurey------\n&quot; + saleQry);</span>
<span class="nc" id="L2016">				System.out.println(&quot;-------Draw Cancel Qurey------\n&quot;</span>
						+ cancelQry);
<span class="nc" id="L2018">				System.out.println(&quot;-------Draw Pwt Qurey------\n&quot; + pwtQry);</span>

				// Draw Sale Query
<span class="nc" id="L2021">				pstmt = con.prepareStatement(saleQry.toString());</span>
<span class="nc" id="L2022">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2023" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2024">					agtMap.get(rs.getString(&quot;retailer_org_id&quot;)).setDrawSale(</span>
							rs.getDouble(&quot;sale&quot;));
				}
				// Draw Cancel Query
<span class="nc" id="L2028">				pstmt = con.prepareStatement(cancelQry.toString());</span>
<span class="nc" id="L2029">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2030" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2031">					agtMap.get(rs.getString(&quot;retailer_org_id&quot;)).setDrawCancel(</span>
							rs.getDouble(&quot;cancel&quot;));
				}
				// Draw Pwt Query
<span class="nc" id="L2035">				pstmt = con.prepareStatement(pwtQry.toString());</span>
<span class="nc" id="L2036">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2037" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2038">					agtMap.get(rs.getString(&quot;retailer_org_id&quot;)).setDrawPwt(</span>
							rs.getDouble(&quot;pwt&quot;));
				}
			}
<span class="nc bnc" id="L2042" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
<span class="nc" id="L2043">				String saleQry = &quot;&quot;;</span>
<span class="nc" id="L2044">				logger.info(&quot;----Type Select ---&quot;</span>
						+ LMSFilterDispatcher.seSaleReportType);
<span class="nc bnc" id="L2046" title="All 2 branches missed.">				if (&quot;BOOK_WISE&quot;.equals(LMSFilterDispatcher.seSaleReportType)) {</span>
<span class="nc" id="L2047">					saleQry = &quot;select organization_id,name,ifnull(mrpAmt,0.0) mrpAmt,ifnull(netAmt,0.0) netAmt from st_lms_organization_master left outer join (select sale.retailer_org_id,(ifnull(mrpAmt,0.0)-ifnull(mrpAmtRet,0.0)) mrpAmt,(ifnull(netAmt,0.0)-ifnull(netAmtRet,0.0)) netAmt from (select retailer_org_id,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_agent_retailer_transaction where transaction_id in (select transaction_id from st_lms_agent_transaction_master where transaction_type='SALE' and transaction_date&gt;='&quot;</span>
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;') and agent_org_id=&quot;
							+ agtOrgId
							+ &quot; group by retailer_org_id) sale left outer join (select retailer_org_id,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_agent_retailer_transaction where transaction_id in (select transaction_id from st_lms_agent_transaction_master where transaction_type='SALE_RET' and transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;') and agent_org_id=&quot;
							+ agtOrgId
							+ &quot; group by retailer_org_id) saleRet on sale.retailer_org_id=saleRet.retailer_org_id) saleTlb on organization_id=retailer_org_id where parent_id=&quot;
							+ agtOrgId;
<span class="nc bnc" id="L2061" title="All 2 branches missed.">				} else if (&quot;TICKET_WISE&quot;</span>
						.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L2063">					saleQry = &quot;select organization_id,name,ifnull(mrpAmt,0.0) mrpAmt,ifnull(netAmt,0.0) netAmt from st_lms_organization_master left outer join (select current_owner_id,sum(soldTkt*ticket_price) mrpAmt,sum((soldTkt*ticket_price)-(soldTkt*ticket_price*transacrion_sale_comm_rate*0.01)) netAmt from st_se_game_master gm,st_se_game_inv_detail gid,(select game_id,book_nbr,sum(sold_tickets) soldTkt from st_se_game_ticket_inv_history where date&gt;='&quot;</span>
							+ startDate
							+ &quot;' and date&lt;='&quot;
							+ endDate
							+ &quot;' and current_owner='RETAILER' group by book_nbr) TktTlb where gm.game_id=TktTlb.game_id and TktTlb.book_nbr=gid.book_nbr and gid.current_owner='RETAILER' group by current_owner_id) saleTlb on organization_id=current_owner_id where organization_type='RETAILER' and parent_id=&quot;
							+ agtOrgId;
				}
<span class="nc" id="L2070">				pstmt = con.prepareStatement(saleQry);</span>

<span class="nc" id="L2072">				System.out.println(&quot;***Scratch Sale Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L2073">				rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L2075" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2076">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setScratchSale(</span>
							rs.getDouble(&quot;netAmt&quot;));
				}

				// Calculate Scratch Pwt
<span class="nc" id="L2081">				String pwtQry = &quot;select retailer_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwt from st_se_retailer_pwt where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date&gt;=? and transaction_date&lt;=? and transaction_type='PWT' and retailer_org_id in (&quot;</span>
						+ agtOrgQry + &quot;)) group by retailer_org_id&quot;;
<span class="nc" id="L2083">				pstmt = con.prepareStatement(pwtQry);</span>
<span class="nc" id="L2084">				pstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L2085">				pstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L2086">				logger.info(&quot;***Scratch Pwt Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L2087">				rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L2089" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2090">					agtMap.get(rs.getString(&quot;retailer_org_id&quot;)).setScratchPwt(</span>
							rs.getDouble(&quot;pwt&quot;));
				}
			}
<span class="nc bnc" id="L2094" title="All 2 branches missed.">			if (ReportUtility.isCS) {</span>

<span class="nc" id="L2096">				saleTranCS = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type = 'CS_SALE' and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (&quot; + agtOrgQry + &quot;)&quot;;
<span class="nc" id="L2101">				cancelTranCS = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('CS_CANCEL_SERVER','CS_CANCEL_RET') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (&quot; + agtOrgQry + &quot;)&quot;;
				
				// Category Master Query
<span class="nc" id="L2108">				String catQry = &quot;select category_id from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L2109">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L2110">				rsGame = prodPstmt.executeQuery();</span>
<span class="nc" id="L2111">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select retailer_org_id,sum(sale) as sale from (&quot;);
<span class="nc" id="L2113">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select retailer_org_id,sum(cancel) as cancel from (&quot;);
<span class="nc bnc" id="L2115" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L2116">					saleQry</span>
							.append(&quot;(select cs.retailer_org_id,sum(net_amt) as sale from st_cs_sale_&quot;
									+ rsGame.getInt(&quot;category_id&quot;)
									+ &quot; cs where transaction_id in (&quot;
									+ saleTranCS
									+ &quot;) group by cs.retailer_org_id) union all&quot;);

<span class="nc" id="L2123">					cancelQry</span>
							.append(&quot;(select cs.retailer_org_id,sum(net_amt) as cancel from st_cs_refund_&quot;
									+ rsGame.getInt(&quot;category_id&quot;)
									+ &quot; cs where transaction_id in (&quot;
									+ cancelTranCS
									+ &quot;) group by cs.retailer_org_id) union all&quot;);
				}

<span class="nc" id="L2131">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;), saleQry</span>
						.length());
<span class="nc" id="L2133">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;), cancelQry</span>
						.length());
				
<span class="nc" id="L2136">				saleQry.append(&quot;) saleTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L2137">				cancelQry.append(&quot;) cancelTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L2138">				logger.debug(&quot;-------CS Sale Query------\n&quot; + saleQry);</span>
<span class="nc" id="L2139">				logger.debug(&quot;-------CS Cancel Query------\n&quot;</span>
						+ cancelQry);
				// CS Sale Query
<span class="nc" id="L2142">				pstmt = con.prepareStatement(saleQry.toString());</span>
<span class="nc" id="L2143">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2144" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2145">					agtMap.get(rs.getString(&quot;retailer_org_id&quot;)).setCSSale(</span>
							rs.getDouble(&quot;sale&quot;));
				}
				// CS Cancel Query
<span class="nc" id="L2149">				pstmt = con.prepareStatement(cancelQry.toString());</span>
<span class="nc" id="L2150">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2151" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2152">					agtMap.get(rs.getString(&quot;retailer_org_id&quot;)).setCSCancel(</span>
							rs.getDouble(&quot;cancel&quot;));
				}
			}
<span class="nc bnc" id="L2156" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>
<span class="nc" id="L2157">				depositTranOLA = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_DEPOSIT') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (&quot; + agtOrgQry + &quot;)&quot;;
<span class="nc" id="L2162">				cancelTranOLA = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_DEPOSIT_REFUND') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (&quot; + agtOrgQry + &quot;)&quot;;
<span class="nc" id="L2167">				withdrawalTranOLA = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_WITHDRAWL') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (&quot; + agtOrgQry + &quot;)&quot;;

				
<span class="nc" id="L2174">				StringBuilder depositQry = new StringBuilder(</span>
						&quot;select retailer_org_id,sum(deposit_amt) as deposit_amt from (&quot;);
<span class="nc" id="L2176">				StringBuilder depositCancelQry = new StringBuilder(</span>
						&quot;select retailer_org_id,sum(depositRefund) as depositRefund from (&quot;);
<span class="nc" id="L2178">				StringBuilder withdrawalQry = new StringBuilder(</span>
						&quot;select retailer_org_id,sum(withdrawl_amt) as withdrawl_amt from (&quot;);
				
<span class="nc" id="L2181">				depositQry</span>
							.append(&quot;(select drs.retailer_org_id,sum(net_amt) as deposit_amt from st_ola_ret_deposit drs where transaction_id in (&quot;
									+ depositTranOLA
									+ &quot;) group by drs.retailer_org_id)&quot;);

<span class="nc" id="L2186">				depositCancelQry</span>
							.append(&quot;(select drs.retailer_org_id,sum(net_amt) as depositRefund from st_ola_ret_deposit_refund drs where transaction_id in (&quot;
									+ cancelTranOLA
									+ &quot;) group by drs.retailer_org_id)&quot;);

<span class="nc" id="L2191">				withdrawalQry</span>
							.append(&quot;(select drs.retailer_org_id,sum(net_amt) as withdrawl_amt from st_ola_ret_withdrawl drs where transaction_id in (&quot;
									+ withdrawalTranOLA
									+ &quot;) group by drs.retailer_org_id)&quot;);

<span class="nc" id="L2196">				String netGamingQry = &quot;select netGaming.retailer_org_id,sum(netGaming.netAmt) as total_amt from (select drs.ret_org_id retailer_org_id,sum(commission_calculated) as netAmt from st_ola_agt_ret_commission drs where transaction_id in (select transaction_id from st_lms_agent_transaction_master where transaction_type in('OLA_COMMISSION') and transaction_date&gt;='&quot;+startDate+&quot;' and transaction_date&lt;='&quot;+endDate+&quot;' and party_id in (select organization_id from st_lms_organization_master where parent_id=&quot;+agtOrgId+&quot; order by name)) group by drs.ret_org_id) netGaming group by netGaming.retailer_org_id&quot;;</span>

<span class="nc" id="L2198">				depositQry.append(&quot;) depositTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L2199">				depositCancelQry.append(&quot;) cancelTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L2200">				withdrawalQry.append(&quot;) withdrawalTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L2201">				System.out.println(&quot;------OLA Deposit Qurey------\n&quot; + depositQry);</span>
<span class="nc" id="L2202">				System.out.println(&quot;-------OLA Deposit Refund Qurey------\n&quot;</span>
						+ depositCancelQry);
<span class="nc" id="L2204">				System.out.println(&quot;-------OLA Withdrawal Qurey------\n&quot; + withdrawalQry);</span>

				// OLA Deposit Query
<span class="nc" id="L2207">				pstmt = con.prepareStatement(depositQry.toString());</span>
<span class="nc" id="L2208">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2209" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2210">					agtMap.get(rs.getString(&quot;retailer_org_id&quot;)).setOlaDepositAmt(</span>
							rs.getDouble(&quot;deposit_amt&quot;));
				}
				// OLA Deposit Refund Query
<span class="nc" id="L2214">				pstmt = con.prepareStatement(depositCancelQry.toString());</span>
<span class="nc" id="L2215">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2216" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2217">					agtMap.get(rs.getString(&quot;retailer_org_id&quot;)).setOlaDepositCancelAmt(</span>
							rs.getDouble(&quot;depositRefund&quot;));
				}
				// OLA Withdrawal Query
<span class="nc" id="L2221">				pstmt = con.prepareStatement(withdrawalQry.toString());</span>
<span class="nc" id="L2222">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2223" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2224">					agtMap.get(rs.getString(&quot;retailer_org_id&quot;)).setOlaWithdrawalAmt(</span>
							rs.getDouble(&quot;withdrawl_amt&quot;));
				}
				// OLA Net Gaming Query
<span class="nc" id="L2228">				pstmt = con.prepareStatement(netGamingQry);</span>
<span class="nc" id="L2229">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2230" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2231">					agtMap.get(rs.getString(&quot;retailer_org_id&quot;)).setOlaNetGaming(</span>
							rs.getDouble(&quot;total_amt&quot;));
				}
			}
<span class="nc" id="L2235">		} catch (Exception e) {</span>
<span class="nc" id="L2236">			e.printStackTrace();</span>
<span class="nc" id="L2237">		}</span>
<span class="nc" id="L2238">		return agtMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionRetailerWiseExpand(
			Timestamp startDate, Timestamp endDate, Connection con, int agtOrgId) {
<span class="nc" id="L2243">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L2244">		ResultSet rsGame = null;</span>
<span class="nc" id="L2245">		ResultSet rs = null;</span>
<span class="nc" id="L2246">		ResultSet rsRetOrg = null;</span>
<span class="nc" id="L2247">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; serGameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;();</span>
<span class="nc" id="L2248">		Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt; gameAgtMap = null;</span>
		// for Draw Game
<span class="nc" id="L2250">		String saleTranDG = null;</span>
<span class="nc" id="L2251">		String cancelTranDG = null;</span>
<span class="nc" id="L2252">		String pwtTranDG = null;</span>
<span class="nc" id="L2253">		StringBuilder drawQry = null;</span>
		// for scratch game
<span class="nc" id="L2255">		StringBuilder scratchQry = null;</span>
<span class="nc bnc" id="L2256" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L2257">			return serGameAgtMap;</span>
		}
		try {
			
			// Get All Agent
<span class="nc" id="L2262">			String orgCodeQry = &quot; name orgCode &quot;;</span>

			
<span class="nc bnc" id="L2265" title="All 2 branches missed.">			if ((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;CODE&quot;)) {</span>
<span class="nc" id="L2266">				orgCodeQry = &quot;org_code orgCode &quot;;</span>
	

<span class="nc bnc" id="L2269" title="All 2 branches missed.">			} else if ((LMSFilterDispatcher.orgFieldType)</span>
					.equalsIgnoreCase(&quot;CODE_NAME&quot;)) {
<span class="nc" id="L2271">				orgCodeQry = &quot; concat(org_code,'_',name)  orgCode  &quot;;</span>
			

<span class="nc bnc" id="L2274" title="All 2 branches missed.">			} else if ((LMSFilterDispatcher.orgFieldType)</span>
					.equalsIgnoreCase(&quot;NAME_CODE&quot;)) {
<span class="nc" id="L2276">				orgCodeQry = &quot; concat(name,'_',org_code)  orgCode &quot;;</span>
			

			}
<span class="nc" id="L2280">			String agtOrgQry = &quot;select &quot;+orgCodeQry+&quot;,organization_id from st_lms_organization_master where parent_id=&quot;</span>
					+ agtOrgId + &quot; order by &quot;+QueryManager.getAppendOrgOrder();
<span class="nc" id="L2282">			pstmt = con.prepareStatement(agtOrgQry);</span>
<span class="nc" id="L2283">			rsRetOrg = pstmt.executeQuery();</span>

<span class="nc bnc" id="L2285" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L2286">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L2287">				drawQry = new StringBuilder(</span>
						&quot;select agtTlb.organization_id,ifnull(sale,0.0) sale,ifnull(cancel,0.0) cancel,ifnull(pwt,0.0)  pwt from (select sale.organization_id,sale,cancel,pwt from &quot;);
<span class="nc" id="L2289">				saleTranDG = &quot;(select bb.organization_id,sum(sale) as sale from (select drs.retailer_org_id,sum(net_amt) as sale from st_dg_ret_sale_? drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_SALE','DG_SALE_OFFLINE') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;)bb on retailer_org_id=organization_id group by organization_id) sale,&quot;;
<span class="nc" id="L2296">				cancelTranDG = &quot;(select bb.organization_id,sum(cancel) as cancel from (select drs.retailer_org_id,sum(net_amt) as cancel from st_dg_ret_sale_refund_? drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on retailer_org_id=organization_id group by organization_id) cancel,&quot;;
<span class="nc" id="L2303">				pwtTranDG = &quot;(select bb.organization_id,sum(pwt) as pwt from (select drs.retailer_org_id,sum(pwt_amt+retailer_claim_comm) as pwt from st_dg_ret_pwt_? drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on retailer_org_id=organization_id group by organization_id) pwt &quot;;
<span class="nc" id="L2310">				drawQry.append(saleTranDG);</span>
<span class="nc" id="L2311">				drawQry.append(cancelTranDG);</span>
<span class="nc" id="L2312">				drawQry.append(pwtTranDG);</span>
<span class="nc" id="L2313">				drawQry</span>
						.append(&quot; where sale.organization_id=cancel.organization_id and sale.organization_id=pwt.organization_id and cancel.organization_id=pwt.organization_id) gameTlb right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
								+ agtOrgId
								+ &quot;) agtTlb on gameTlb.organization_id=agtTlb.organization_id&quot;);
<span class="nc" id="L2317">				System.out.println(&quot;For Expand draw game Qry:: &quot; + drawQry);</span>

				// Game Master Query
<span class="nc" id="L2320">				String gameQry =ReportUtility.getDrawGameMapQuery(startDate);</span>
<span class="nc" id="L2321">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L2322">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L2323" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L2324">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L2325">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L2326">					gameMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L2327">					pstmt = con.prepareStatement(drawQry.toString());</span>
<span class="nc" id="L2328">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L2329">					pstmt.setInt(2, gameId);</span>
<span class="nc" id="L2330">					pstmt.setInt(3, gameId);</span>
<span class="nc" id="L2331">					System.out.println(&quot;-------Indivisual Game Qry-------\n&quot;</span>
							+ pstmt);
<span class="nc" id="L2333">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2334" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L2335">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L2336">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L2337">						gameMap.get(agtId)</span>
								.setDrawCancel(rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L2339">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>

<span class="nc" id="L2341">					}</span>
<span class="nc" id="L2342">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L2343">				}</span>

<span class="nc" id="L2345">				serGameAgtMap.put(&quot;DG&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L2347" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
<span class="nc" id="L2348">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L2349">				scratchQry = new StringBuilder(</span>
						&quot;select agtTlb.organization_id,ifnull(sale,0.0) sale,ifnull(pwt,0.0) pwt from (select sale.organization_id,sale,pwt from&quot;);

<span class="nc" id="L2352">				logger.info(&quot;----Type Select ---&quot;</span>
						+ LMSFilterDispatcher.seSaleReportType);
<span class="nc bnc" id="L2354" title="All 2 branches missed.">				if (&quot;BOOK_WISE&quot;.equals(LMSFilterDispatcher.seSaleReportType)) {</span>
<span class="nc" id="L2355">					saleTranDG = &quot;(select organization_id,name,ifnull(mrpAmt,0.0) mrpAmt,ifnull(netAmt,0.0) sale from st_lms_organization_master left outer join (select sale.retailer_org_id,(ifnull(mrpAmt,0.0)-ifnull(mrpAmtRet,0.0)) mrpAmt,(ifnull(netAmt,0.0)-ifnull(netAmtRet,0.0)) netAmt from (select retailer_org_id,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_agent_retailer_transaction where transaction_id in (select transaction_id from st_lms_agent_transaction_master where transaction_type='SALE' and transaction_date&gt;='&quot;</span>
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;') and game_id=? and agent_org_id=&quot;
							+ agtOrgId
							+ &quot; group by retailer_org_id) sale left outer join (select retailer_org_id,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_agent_retailer_transaction where transaction_id in (select transaction_id from st_lms_agent_transaction_master where transaction_type='SALE_RET' and transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;') and game_id=? and agent_org_id=&quot;
							+ agtOrgId
							+ &quot; group by retailer_org_id) saleRet on sale.retailer_org_id=saleRet.retailer_org_id) saleTlb on organization_id=retailer_org_id where parent_id=&quot;
							+ agtOrgId + &quot;) sale,&quot;;
<span class="nc bnc" id="L2369" title="All 2 branches missed.">				} else if (&quot;TICKET_WISE&quot;</span>
						.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L2371">					saleTranDG = &quot;(select organization_id,name,ifnull(mrpAmt,0.0) mrpAmt,ifnull(netAmt,0.0) sale from st_lms_organization_master left outer join (select current_owner_id,sum(soldTkt*ticket_price) mrpAmt,sum((soldTkt*ticket_price)-(soldTkt*ticket_price*transacrion_sale_comm_rate*0.01)) netAmt from st_se_game_master gm,st_se_game_inv_detail gid,(select game_id,book_nbr,sum(sold_tickets) soldTkt from st_se_game_ticket_inv_history where date&gt;='&quot;</span>
							+ startDate
							+ &quot;' and date&lt;='&quot;
							+ endDate
							+ &quot;' and current_owner='RETAILER' and game_id=? group by book_nbr) TktTlb where gm.game_id=TktTlb.game_id and gm.game_id=? and TktTlb.book_nbr=gid.book_nbr and gid.current_owner='RETAILER' group by current_owner_id) saleTlb on organization_id=current_owner_id where organization_type='RETAILER' and parent_id=&quot;
							+ agtOrgId + &quot;) sale,&quot;;
				}

<span class="nc" id="L2379">				pwtTranDG = &quot;(select bb.organization_id,sum(pwt) as pwt from (select retailer_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwt from st_se_retailer_pwt where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and transaction_type='PWT') and game_id=? group by retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on retailer_org_id=organization_id group by organization_id) pwt &quot;;
<span class="nc" id="L2386">				scratchQry.append(saleTranDG);</span>
<span class="nc" id="L2387">				scratchQry.append(pwtTranDG);</span>
<span class="nc" id="L2388">				scratchQry</span>
						.append(&quot; where sale.organization_id=pwt.organization_id) gameTlb right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
								+ agtOrgId
								+ &quot;) agtTlb on gameTlb.organization_id=agtTlb.organization_id&quot;);
<span class="nc" id="L2392">				System.out.println(&quot;For Expand scratch game Qry:: &quot;</span>
						+ scratchQry);

				// Game Master Query
<span class="nc" id="L2396">				String gameQry = &quot;select game_id,game_name from st_se_game_master&quot;;</span>
<span class="nc" id="L2397">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L2398">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L2399" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L2400">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L2401">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L2402">					gameMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L2403">					pstmt = con.prepareStatement(scratchQry.toString());</span>
<span class="nc" id="L2404">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L2405">					pstmt.setInt(2, gameId);</span>
<span class="nc" id="L2406">					pstmt.setInt(3, gameId);</span>
<span class="nc" id="L2407">					System.out.println(&quot;-------Indivisual Game Qry-------\n&quot;</span>
							+ pstmt);
<span class="nc" id="L2409">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2410" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L2411">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L2412">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L2413">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>
<span class="nc" id="L2414">					}</span>

<span class="nc" id="L2416">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L2417">				}</span>
<span class="nc" id="L2418">				serGameAgtMap.put(&quot;SE&quot;, gameAgtMap);</span>
			}
<span class="nc" id="L2420">			System.out.println(serGameAgtMap);</span>
<span class="nc" id="L2421">		} catch (Exception e) {</span>
<span class="nc" id="L2422">			e.printStackTrace();</span>
<span class="nc" id="L2423">		}</span>
<span class="nc" id="L2424">		return serGameAgtMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionRetailerWiseExpandMrpWise(
			Timestamp startDate, Timestamp endDate, Connection con, int agtOrgId) {
<span class="nc" id="L2429">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L2430">		ResultSet rsGame = null;</span>
<span class="nc" id="L2431">		ResultSet rs = null;</span>
<span class="nc" id="L2432">		ResultSet rsRetOrg = null;</span>
<span class="nc" id="L2433">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; serGameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;();</span>
<span class="nc" id="L2434">		Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt; gameAgtMap = null;</span>
		// for Draw Game
<span class="nc" id="L2436">		String saleTranDG = null;</span>
<span class="nc" id="L2437">		String cancelTranDG = null;</span>
<span class="nc" id="L2438">		String pwtTranDG = null;</span>
<span class="nc" id="L2439">		StringBuilder drawQry = null;</span>
		// for scratch game
<span class="nc" id="L2441">		StringBuilder scratchQry = null;</span>
<span class="nc bnc" id="L2442" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L2443">			return serGameAgtMap;</span>
		}
		try {

			// Get All Agent
<span class="nc" id="L2448">			String agtOrgQry = &quot;select name,organization_id from st_lms_organization_master where parent_id=&quot;</span>
					+ agtOrgId + &quot; order by name&quot;;
<span class="nc" id="L2450">			pstmt = con.prepareStatement(agtOrgQry);</span>
<span class="nc" id="L2451">			rsRetOrg = pstmt.executeQuery();</span>

<span class="nc bnc" id="L2453" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L2454">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L2455">				drawQry = new StringBuilder(</span>
						&quot;select agtTlb.organization_id,ifnull(sale,0.0) sale,ifnull(cancel,0.0) cancel,ifnull(pwt,0.0)  pwt from (select sale.organization_id,sale,cancel,pwt from &quot;);
<span class="nc" id="L2457">				saleTranDG = &quot;(select bb.organization_id,sum(sale) as sale from (select drs.retailer_org_id,sum(mrp_amt) as sale from st_dg_ret_sale_? drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_SALE','DG_SALE_OFFLINE') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;)bb on retailer_org_id=organization_id group by organization_id) sale,&quot;;
<span class="nc" id="L2464">				cancelTranDG = &quot;(select bb.organization_id,sum(cancel) as cancel from (select drs.retailer_org_id,sum(mrp_amt) as cancel from st_dg_ret_sale_refund_? drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on retailer_org_id=organization_id group by organization_id) cancel,&quot;;
<span class="nc" id="L2471">				pwtTranDG = &quot;(select bb.organization_id,sum(pwt) as pwt from (select drs.retailer_org_id,sum(pwt_amt) as pwt from st_dg_ret_pwt_? drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on retailer_org_id=organization_id group by organization_id) pwt &quot;;
<span class="nc" id="L2478">				drawQry.append(saleTranDG);</span>
<span class="nc" id="L2479">				drawQry.append(cancelTranDG);</span>
<span class="nc" id="L2480">				drawQry.append(pwtTranDG);</span>
<span class="nc" id="L2481">				drawQry</span>
						.append(&quot; where sale.organization_id=cancel.organization_id and sale.organization_id=pwt.organization_id and cancel.organization_id=pwt.organization_id) gameTlb right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
								+ agtOrgId
								+ &quot;) agtTlb on gameTlb.organization_id=agtTlb.organization_id&quot;);
<span class="nc" id="L2485">				System.out.println(&quot;For Expand draw game Qry:: &quot; + drawQry);</span>

				// Game Master Query
<span class="nc" id="L2488">				String gameQry = &quot;select game_id,game_name from st_dg_game_master&quot;;</span>
<span class="nc" id="L2489">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L2490">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L2491" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L2492">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L2493">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L2494">					gameMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L2495">					pstmt = con.prepareStatement(drawQry.toString());</span>
<span class="nc" id="L2496">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L2497">					pstmt.setInt(2, gameId);</span>
<span class="nc" id="L2498">					pstmt.setInt(3, gameId);</span>
<span class="nc" id="L2499">					System.out.println(&quot;-------Indivisual Game Qry-------\n&quot;</span>
							+ pstmt);
<span class="nc" id="L2501">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2502" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L2503">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L2504">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L2505">						gameMap.get(agtId)</span>
								.setDrawCancel(rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L2507">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>

<span class="nc" id="L2509">					}</span>
<span class="nc" id="L2510">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L2511">				}</span>

<span class="nc" id="L2513">				serGameAgtMap.put(&quot;DG&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L2515" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
<span class="nc" id="L2516">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L2517">				scratchQry = new StringBuilder(</span>
						&quot;select agtTlb.organization_id,ifnull(sale,0.0) sale,ifnull(pwt,0.0) pwt from (select sale.organization_id,sale,pwt from&quot;);
<span class="nc" id="L2519">				saleTranDG = &quot;(select bb.organization_id,sum(sale) as sale from (select current_owner_id,sum(sale) sale from (select gmti.game_id,gmti.current_owner_id, (gmti.sold_tickets*ticket_price) sale from st_se_game_ticket_inv_history gmti ,st_se_game_master gm where gmti.current_owner='RETAILER'and gmti.date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and gmti.date&lt;='&quot;
						+ endDate
						+ &quot;' and gmti.game_id=gm.game_id and gm.game_id=?) aa group by current_owner_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on current_owner_id=organization_id group by organization_id) sale, &quot;;
<span class="nc" id="L2526">				pwtTranDG = &quot;(select bb.organization_id,sum(pwt) as pwt from (select retailer_org_id,sum(pwt_amt) pwt from st_se_retailer_pwt where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and transaction_type='PWT') and game_id=? group by retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on retailer_org_id=organization_id group by organization_id) pwt &quot;;
<span class="nc" id="L2533">				scratchQry.append(saleTranDG);</span>
<span class="nc" id="L2534">				scratchQry.append(pwtTranDG);</span>
<span class="nc" id="L2535">				scratchQry</span>
						.append(&quot; where sale.organization_id=pwt.organization_id) gameTlb right outer join (select organization_id from st_lms_organization_master where parent_id=4) agtTlb on gameTlb.organization_id=agtTlb.organization_id&quot;);
<span class="nc" id="L2537">				System.out.println(&quot;For Expand scratch game Qry:: &quot;</span>
						+ scratchQry);

				// Game Master Query
<span class="nc" id="L2541">				String gameQry = &quot;select game_id,game_name from st_se_game_master&quot;;</span>
<span class="nc" id="L2542">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L2543">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L2544" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L2545">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L2546">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L2547">					gameMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L2548">					pstmt = con.prepareStatement(scratchQry.toString());</span>
<span class="nc" id="L2549">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L2550">					pstmt.setInt(2, gameId);</span>
<span class="nc" id="L2551">					System.out.println(&quot;-------Indivisual Game Qry-------\n&quot;</span>
							+ pstmt);
<span class="nc" id="L2553">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2554" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L2555">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L2556">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L2557">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>
<span class="nc" id="L2558">					}</span>

<span class="nc" id="L2560">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L2561">				}</span>
<span class="nc" id="L2562">				serGameAgtMap.put(&quot;SE&quot;, gameAgtMap);</span>
			}
<span class="nc" id="L2564">			System.out.println(serGameAgtMap);</span>
<span class="nc" id="L2565">		} catch (Exception e) {</span>
<span class="nc" id="L2566">			e.printStackTrace();</span>
<span class="nc" id="L2567">		}</span>
<span class="nc" id="L2568">		return serGameAgtMap;</span>
	}

	private Map&lt;String, CompleteCollectionBean&gt; getAgentMap(ResultSet rsRetOrg) throws SQLException {
<span class="nc" id="L2572">		Map&lt;String, CompleteCollectionBean&gt; agtMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L2573">		CompleteCollectionBean collBean = null;</span>

<span class="nc bnc" id="L2575" title="All 2 branches missed.">		while (rsRetOrg.next()) {</span>
<span class="nc" id="L2576">			collBean = new CompleteCollectionBean();</span>
<span class="nc" id="L2577">			collBean.setOrgName(rsRetOrg.getString(&quot;orgCode&quot;));</span>
<span class="nc bnc" id="L2578" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L2579">				collBean.setDrawSale(0.0);</span>
<span class="nc" id="L2580">				collBean.setDrawPwt(0.0);</span>
<span class="nc" id="L2581">				collBean.setDrawCancel(0.0);</span>
			}
<span class="nc bnc" id="L2583" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
<span class="nc" id="L2584">				collBean.setScratchSale(0.0);</span>
<span class="nc" id="L2585">				collBean.setScratchPwt(0.0);</span>
			}
<span class="nc bnc" id="L2587" title="All 2 branches missed.">			if(ReportUtility.isCS){</span>
<span class="nc" id="L2588">				collBean.setCSSale(0.0);</span>
<span class="nc" id="L2589">				collBean.setCSCancel(0.0);</span>
			}
<span class="nc bnc" id="L2591" title="All 2 branches missed.">			if(ReportUtility.isOLA)</span>
			{
<span class="nc" id="L2593">				collBean.setOlaDepositAmt(0.0);</span>
<span class="nc" id="L2594">				collBean.setOlaDepositCancelAmt(0.0);</span>
<span class="nc" id="L2595">				collBean.setOlaWithdrawalAmt(0.0);</span>
<span class="nc" id="L2596">				collBean.setOlaNetGaming(0.0);</span>
			}
<span class="nc" id="L2598">			agtMap.put(rsRetOrg.getString(&quot;organization_id&quot;), collBean);</span>
		}
<span class="nc" id="L2600">		rsRetOrg.beforeFirst();</span>
<span class="nc" id="L2601">		return agtMap;</span>
	}

	private Map&lt;String, CompleteCollectionBean&gt; getDayMap(Timestamp startDate,
			Timestamp endDate) throws SQLException {
<span class="nc" id="L2606">		Map&lt;String, CompleteCollectionBean&gt; dateMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L2607">		CompleteCollectionBean collBean = null;</span>
<span class="nc" id="L2608">		String date = null;</span>
		// Get All Day
<span class="nc" id="L2610">		Calendar startCal = Calendar.getInstance();</span>
<span class="nc" id="L2611">		startCal.setTime(startDate);</span>

<span class="nc" id="L2613">		Calendar endCal = Calendar.getInstance();</span>
<span class="nc" id="L2614">		endCal.setTime(endDate);</span>
<span class="nc bnc" id="L2615" title="All 2 branches missed.">		while (startCal.getTime().before(endCal.getTime())) {</span>
<span class="nc" id="L2616">			date = new java.sql.Date(startCal.getTimeInMillis()).toString();</span>
<span class="nc" id="L2617">			collBean = new CompleteCollectionBean();</span>
<span class="nc" id="L2618">			collBean.setOrgName(date);</span>
<span class="nc" id="L2619">			dateMap.put(date, collBean);</span>
<span class="nc" id="L2620">			startCal.setTimeInMillis(startCal.getTimeInMillis() + 24 * 60 * 60</span>
					* 1000);
<span class="nc bnc" id="L2622" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L2623">				collBean.setDrawSale(0.0);</span>
<span class="nc" id="L2624">				collBean.setDrawPwt(0.0);</span>
<span class="nc" id="L2625">				collBean.setDrawCancel(0.0);</span>
<span class="nc" id="L2626">				collBean.setDrawDirPlyPwt(0.0);</span>
			}
<span class="nc bnc" id="L2628" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
<span class="nc" id="L2629">				collBean.setScratchSale(0.0);</span>
<span class="nc" id="L2630">				collBean.setScratchPwt(0.0);</span>
<span class="nc" id="L2631">				collBean.setScratchDirPlyPwt(0.0);</span>
			}
<span class="nc bnc" id="L2633" title="All 2 branches missed.">			if (ReportUtility.isCS) {</span>
<span class="nc" id="L2634">				collBean.setCSSale(0.0);</span>
<span class="nc" id="L2635">				collBean.setCSCancel(0.0);</span>
			}
<span class="nc bnc" id="L2637" title="All 2 branches missed.">			if(ReportUtility.isOLA)</span>
			{
<span class="nc" id="L2639">				collBean.setOlaDepositAmt(0.0);</span>
<span class="nc" id="L2640">				collBean.setOlaDepositCancelAmt(0.0);</span>
<span class="nc" id="L2641">				collBean.setOlaWithdrawalAmt(0.0);</span>
<span class="nc" id="L2642">				collBean.setOlaNetGaming(0.0);</span>
			}
		}
<span class="nc" id="L2645">		return dateMap;</span>
	}

	

	public Map&lt;Integer, String&gt; getOrgAddMap(String orgType, int parentId)
			throws LMSException {
<span class="nc" id="L2652">		Map&lt;Integer, String&gt; orgAddMap = new TreeMap&lt;Integer, String&gt;();</span>
<span class="nc" id="L2653">		Connection con = null;</span>
<span class="nc" id="L2654">		con = DBConnect.getConnection();</span>
<span class="nc" id="L2655">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L2656">		ResultSet rs = null;</span>
		try {
<span class="nc bnc" id="L2658" title="All 2 branches missed.">			if (orgType.equalsIgnoreCase(&quot;AGENT&quot;)) {</span>
<span class="nc" id="L2659">				pstmt = con</span>
						.prepareStatement(&quot;select addr_line1, addr_line2, city, organization_id from st_lms_organization_master where organization_type='AGENT'&quot;);

<span class="nc bnc" id="L2662" title="All 2 branches missed.">			} else if (orgType.equalsIgnoreCase(&quot;RETAILER&quot;)) {</span>
<span class="nc" id="L2663">				pstmt = con</span>
						.prepareStatement(&quot;select addr_line1, addr_line2, city, organization_id from st_lms_organization_master where organization_type='RETAILER' and parent_id = ?&quot;);
<span class="nc" id="L2665">				pstmt.setInt(1, parentId);</span>
			}
<span class="nc" id="L2667">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2668" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L2669">				orgAddMap.put(rs.getInt(&quot;organization_id&quot;), rs</span>
						.getString(&quot;addr_line1&quot;)
						+ &quot;,&quot;
						+ rs.getString(&quot;addr_line2&quot;)
						+ &quot;,&quot;
						+ rs.getString(&quot;city&quot;));
			}
<span class="nc" id="L2676">		} catch (SQLException e) {</span>
<span class="nc" id="L2677">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L2678">			e.printStackTrace();</span>
<span class="nc" id="L2679">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L2681">			try {</span>
<span class="nc bnc" id="L2682" title="All 8 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L2683">					con.close();</span>
				}
<span class="nc" id="L2685">			} catch (SQLException e) {</span>
<span class="nc" id="L2686">				logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L2687">				e.printStackTrace();</span>
<span class="nc" id="L2688">				throw new LMSException(e);</span>
<span class="nc" id="L2689">			}</span>
		}
<span class="nc" id="L2691">		return orgAddMap;</span>
	}

	

	public Map&lt;String, Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;&gt; transactionReportForAgent(
			Timestamp startDate, Timestamp endDate, String reportType,
			int agtOrgId) {
		
<span class="nc" id="L2700">		Connection con = null;</span>
<span class="nc" id="L2701">		Map&lt;String, Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;&gt; resultMap = new HashMap&lt;String, Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;&gt;();</span>
<span class="nc" id="L2702">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; agtMap = null;</span>
		
		try {
<span class="nc" id="L2705">			con = DBConnect.getConnection();</span>
			
<span class="nc bnc" id="L2707" title="All 2 branches missed.">			if (&quot;Retailer Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L2708">				agtMap = collectionRetailerWiseExpand(startDate, endDate, con, agtOrgId);</span>
<span class="nc" id="L2709">				resultMap.put(&quot;NetAmt&quot;, agtMap);</span>
<span class="nc" id="L2710">				agtMap = collectionRetailerWiseExpandMrpWise(startDate,</span>
						endDate, con, agtOrgId);
<span class="nc" id="L2712">				resultMap.put(&quot;MrpAmt&quot;, agtMap);</span>
			}
<span class="nc" id="L2714">		} catch (Exception e) {</span>
<span class="nc" id="L2715">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L2717">			try {</span>
<span class="nc" id="L2718">				con.close();</span>
<span class="nc" id="L2719">			} catch (SQLException e) {</span>
<span class="nc" id="L2720">				e.printStackTrace();</span>
<span class="nc" id="L2721">			}</span>
<span class="nc" id="L2722">		}</span>
<span class="nc" id="L2723">		return resultMap;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>