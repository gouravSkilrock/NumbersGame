<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PaymentLedgerRetailerWiseReportHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.reportsMgmt.common</a> &gt; <span class="el_source">PaymentLedgerRetailerWiseReportHelper.java</span></div><h1>PaymentLedgerRetailerWiseReportHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.reportsMgmt.common;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Timestamp;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Iterator;
import java.util.LinkedHashMap;
import java.util.Map;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.beans.CollectionReportOverAllBean;
import com.skilrock.lms.beans.ReportStatusBean;
import com.skilrock.lms.common.Utility;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.DBConnectReplica;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.filter.LMSFilterDispatcher;
import com.skilrock.lms.web.accMgmt.common.RetailerOpeningBalanceHelper;
import com.skilrock.lms.web.instantWin.reportsMgmt.beans.IWOrgReportRequestBean;
import com.skilrock.lms.web.instantWin.reportsMgmt.beans.IWOrgReportResponseBean;
import com.skilrock.lms.web.instantWin.reportsMgmt.controller.IWRetailerReportsControllerImpl;
import com.skilrock.lms.web.reportsMgmt.common.ReportUtility;
import com.skilrock.lms.web.sportsLottery.reportsMgmt.beans.SLEOrgReportRequestBean;
import com.skilrock.lms.web.sportsLottery.reportsMgmt.beans.SLEOrgReportResponseBean;
import com.skilrock.lms.web.sportsLottery.reportsMgmt.controller.SLERetailerReportsControllerImpl;
import com.skilrock.lms.web.virtualSports.reportsMgmt.beans.VSOrgReportRequestBean;
import com.skilrock.lms.web.virtualSports.reportsMgmt.beans.VSOrgReportResponseBean;
import com.skilrock.lms.web.virtualSports.reportsMgmt.controller.VSRetailerReportsControllerImpl;

<span class="nc" id="L36">public class PaymentLedgerRetailerWiseReportHelper {</span>
<span class="nc" id="L37">	Log logger = LogFactory.getLog(PaymentLedgerRetailerWiseReportHelper.class);</span>

	
	
	public void collectionDateWise(Timestamp startDate, Timestamp endDate,
			Connection con,Map&lt;String, CollectionReportOverAllBean&gt; agtMap, int agtOrgId,int retOrgId)
			throws LMSException {

<span class="nc" id="L45">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L46">		PreparedStatement pstmt1 = null;</span>
<span class="nc" id="L47">		ResultSet rs = null;</span>
<span class="nc" id="L48">		ResultSet rs1 = null;</span>
<span class="nc bnc" id="L49" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L50">			return;</span>
		}

		try {
			// Get Account Details

			//String addOrgQry = &quot;right outer join (select organization_id from st_lms_organization_master where organization_type='AGENT' and organization_id=&quot;+agtOrgId+&quot; ) om on agent_org_id=organization_id&quot;;
<span class="nc" id="L57">			String cashQry = &quot;(select party_id,sum(amount) cash,date(transaction_date) date from st_lms_agent_cash_transaction cash,st_lms_agent_transaction_master atm where cash.transaction_id=atm.transaction_id and transaction_date&gt;='&quot;</span>
					+ startDate
					+ &quot;' and transaction_date&lt;='&quot;
					+ endDate
					+ &quot;' and party_id= &quot;+retOrgId+ &quot; group by date(transaction_date)) cash&quot;;
<span class="nc" id="L62">			String chqQry = &quot;(select party_id,sum(cheque_amt) chq,date(transaction_date) date from st_lms_agent_sale_chq chq,st_lms_agent_transaction_master atm where chq.transaction_id=atm.transaction_id and chq.transaction_type IN ('CHEQUE','CLOSED') and transaction_date&gt;='&quot;</span>
					+ startDate
					+ &quot;' and transaction_date&lt;='&quot;
					+ endDate
					+ &quot;'and party_id= &quot;+retOrgId+ &quot; group by date(transaction_date)) chq &quot;;
<span class="nc" id="L67">			String chqRetQry = &quot;select sum(cheque_amt) chq_ret,date(transaction_date) date from st_lms_agent_sale_chq chq,st_lms_agent_transaction_master atm where chq.transaction_id=atm.transaction_id and chq.transaction_type IN ('CHQ_BOUNCE') and transaction_date&gt;='&quot;</span>
					+ startDate
					+ &quot;' and transaction_date&lt;='&quot;
					+ endDate
					+ &quot;' and party_id= &quot;+retOrgId+ &quot; group by date(transaction_date)  &quot;;
					
					
<span class="nc" id="L74">			String debitQry = &quot;(select party_id,sum(amount) debit,date(transaction_date) date from st_lms_agent_debit_note debit,st_lms_agent_transaction_master atm where debit.transaction_id=atm.transaction_id and debit.transaction_type IN ('DR_NOTE_CASH','DR_NOTE') and transaction_date&gt;='&quot;</span>
					+ startDate
					+ &quot;' and transaction_date&lt;='&quot;
					+ endDate
					+ &quot;' and party_id= &quot;+retOrgId+ &quot; group by date(transaction_date))  debit&quot;;
<span class="nc" id="L79">			String creditQry = &quot;(select party_id,sum(amount) credit,date(transaction_date) date from st_lms_agent_credit_note credit,st_lms_agent_transaction_master atm where credit.transaction_id=atm.transaction_id and credit.transaction_type IN ('CR_NOTE_CASH','CR_NOTE') and transaction_date&gt;='&quot;</span>
					+ startDate
					+ &quot;' and transaction_date&lt;='&quot;
					+ endDate
					+ &quot;'and party_id= &quot;+retOrgId+ &quot; group by date(transaction_date)) credit&quot;;
<span class="nc" id="L84">			String bankQry = &quot;select sum(amount) bank,date(transaction_date) date from st_lms_agent_bank_deposit_transaction bank,st_lms_agent_transaction_master atm where bank.transaction_id=atm.transaction_id and transaction_date&gt;='&quot;</span>
					+ startDate
					+ &quot;' and transaction_date&lt;='&quot;
					+ endDate
					+ &quot;'and retailer_org_id= &quot;+retOrgId+ &quot; group by date(transaction_date) &quot;;
			
			
<span class="nc" id="L91">			String acc1Qry = &quot;select ifnull(chq.date,cash.date) date,ifnull(cash,0.0) cash,ifnull(chq,0.0) chq from (&quot;</span>
					+ cashQry
					+ &quot; left join &quot;
					+ chqQry
					+&quot; on cash.date=chq.date ) union&quot;
					
					+&quot; select ifnull(chq.date,cash.date) date,ifnull(cash,0.0) cash,ifnull(chq,0.0) chq from (&quot;
					+ cashQry
					+ &quot; right join &quot;
					+ chqQry
					+&quot; on cash.date=chq.date )&quot;;
					
					
<span class="nc" id="L104">			String acc2Qry = &quot;select ifnull(credit.date,debit.date) date,ifnull(debit,0.0) debit,ifnull(credit,0.0) credit from (&quot;</span>
				+ debitQry
				+ &quot; left join &quot;
				+ creditQry
				+&quot; on debit.date=credit.date ) union&quot;
							
				+&quot; select ifnull(credit.date,debit.date) date,ifnull(debit,0.0) debit,ifnull(credit,0.0) credit from (&quot;
				+ debitQry
				+ &quot; right join &quot;
				+ creditQry
				+&quot; on debit.date=credit.date )&quot;;
			
<span class="nc" id="L116">			String acc3Qry=chqRetQry;</span>

<span class="nc" id="L118">			String acc4Qry=bankQry;</span>

<span class="nc bnc" id="L120" title="All 2 branches missed.">			if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L121">				String cashChqArchQry=&quot;union all select finaldate,sum(cash_amt) as cash ,sum(cheque_amt) as chq from st_rep_agent_payments where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and retailer_org_id=&quot;+retOrgId+&quot; group by finaldate&quot;;</span>
<span class="nc" id="L122">				String creditDebitArchQry=&quot;union all select finaldate,sum(debit_note) as debit ,sum(credit_note) as credit from st_rep_agent_payments where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and retailer_org_id=&quot;+retOrgId+&quot; group by finaldate&quot;;</span>
<span class="nc" id="L123">				String chqRetArchQry=&quot;union all select sum(cheque_bounce_amt) as chq_ret,finaldate  from st_rep_agent_payments where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and retailer_org_id=&quot;+retOrgId+&quot; group by finaldate&quot;;</span>
<span class="nc" id="L124">				String bankDepositArchQry=&quot;union all select sum(bank_deposit) as bank, finaldate from st_rep_agent_payments where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and retailer_org_id=&quot;+retOrgId+&quot; group by finaldate&quot;;</span>

<span class="nc" id="L126">				acc1Qry=acc1Qry+cashChqArchQry;</span>
<span class="nc" id="L127">				acc2Qry=acc2Qry+creditDebitArchQry;</span>
<span class="nc" id="L128">				acc3Qry=acc3Qry+chqRetArchQry;</span>
<span class="nc" id="L129">				acc4Qry=acc4Qry+bankDepositArchQry;</span>
			}
			
			
<span class="nc" id="L133">			pstmt = con.prepareStatement(acc1Qry);</span>
<span class="nc" id="L134">			logger.debug(&quot;---Account Detail Query---&quot; + pstmt);</span>
<span class="nc" id="L135">			rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L137" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L138">				SimpleDateFormat dateformat = new SimpleDateFormat(</span>
				&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L140">				String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));</span>
				//String agtOrgId = rs.getString(&quot;organization_id&quot;);
			
<span class="nc" id="L143">				agtMap.get(dateFrDtParse).setCash(agtMap.get(dateFrDtParse).getCash()+ rs.getDouble(&quot;cash&quot;));</span>
<span class="nc" id="L144">				agtMap.get(dateFrDtParse).setCheque(agtMap.get(dateFrDtParse).getCheque()+ rs.getDouble(&quot;chq&quot;));</span>
				
				
<span class="nc" id="L147">			}</span>
<span class="nc" id="L148">			pstmt1 = con.prepareStatement(acc2Qry);</span>
<span class="nc" id="L149">			logger.debug(&quot;---Account Detail Query---&quot; + pstmt1);</span>
<span class="nc" id="L150">			rs1 = pstmt1.executeQuery();</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">			while (rs1.next()) {</span>
<span class="nc" id="L152">				SimpleDateFormat dateformat = new SimpleDateFormat(</span>
				&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L154">				String dateFrDtParse =dateformat.format(rs1.getDate(&quot;date&quot;));</span>
				//String agtOrgId = rs.getString(&quot;organization_id&quot;);
			
<span class="nc" id="L157">				agtMap.get(dateFrDtParse).setCredit(agtMap.get(dateFrDtParse).getCredit()+ rs1.getDouble(&quot;credit&quot;));</span>
<span class="nc" id="L158">				agtMap.get(dateFrDtParse).setDebit(agtMap.get(dateFrDtParse).getDebit()+ rs1.getDouble(&quot;debit&quot;));</span>
				
<span class="nc" id="L160">			}</span>
			
<span class="nc" id="L162">			pstmt = con.prepareStatement(acc3Qry);</span>
<span class="nc" id="L163">			logger.debug(&quot;---Account Detail Query---&quot; + pstmt);</span>
<span class="nc" id="L164">			rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L166" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L167">				SimpleDateFormat dateformat = new SimpleDateFormat(</span>
				&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L169">				String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));</span>
<span class="nc" id="L170">				agtMap.get(dateFrDtParse).setChequeReturn(agtMap.get(dateFrDtParse).getChequeReturn()+ rs.getDouble(&quot;chq_ret&quot;));</span>
<span class="nc" id="L171">			}</span>

<span class="nc" id="L173">			pstmt = con.prepareStatement(acc4Qry);</span>
<span class="nc" id="L174">			logger.debug(&quot;---Account Detail Bank Deposit Query---&quot; + pstmt);</span>
<span class="nc" id="L175">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L177">				SimpleDateFormat dateformat = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L178">				String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));</span>
<span class="nc" id="L179">				agtMap.get(dateFrDtParse).setBankDep(agtMap.get(dateFrDtParse).getBankDep()+ rs.getDouble(&quot;bank&quot;));</span>
<span class="nc" id="L180">			}</span>

<span class="nc bnc" id="L182" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
				/*saleTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_SALE','DG_SALE_OFFLINE') and transaction_date&gt;='&quot;
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where organization_type='RETAILER')&quot;;
				cancelTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;='&quot;
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where organization_type='RETAILER')&quot;;
				pwtTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and transaction_date&gt;='&quot;
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where organization_type='RETAILER')&quot;;
*/
				// Game Master Query
<span class="nc" id="L200">				String gameQry = &quot;select game_id from st_dg_game_master&quot;;</span>
<span class="nc" id="L201">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L202">				ResultSet rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L203">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select date(transaction_date) date,retailer_org_id,sum(sale) as sale from (&quot;);
<span class="nc" id="L205">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select date(transaction_date) date,retailer_org_id,sum(cancel) as cancel from (&quot;);
<span class="nc" id="L207">				StringBuilder pwtQry = new StringBuilder(</span>
						&quot;select date(transaction_date) date,retailer_org_id,sum(pwt) as pwt from (&quot;);
<span class="nc bnc" id="L209" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L210">					saleQry.append(&quot;(select drs.retailer_org_id,sum(net_amt) as sale,rtm.transaction_date from st_dg_ret_sale_&quot; </span>
							+ rsGame.getInt(&quot;game_id&quot;)
					+&quot; drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_type in('DG_SALE','DG_SALE_OFFLINE') and transaction_date&gt;='&quot; +
					 startDate 		
					+&quot;'and transaction_date&lt;='&quot; 
					+ endDate
						+	&quot;' and drs.retailer_org_id =&quot;+retOrgId+&quot; group by date(transaction_date)) union all &quot;);
					
					
<span class="nc" id="L219">					cancelQry.append(&quot;(select drs.retailer_org_id,sum(net_amt) as cancel,rtm.transaction_date from st_dg_ret_sale_refund_&quot; </span>
							+ rsGame.getInt(&quot;game_id&quot;)
					+&quot; drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;='&quot; +
					 startDate 		
					+&quot;'and transaction_date&lt;='&quot; 
					+ endDate
						+	&quot;' and drs.retailer_org_id =&quot;+retOrgId+&quot; group by date(transaction_date)) union all &quot;);
					
<span class="nc" id="L227">				pwtQry.append(&quot;(select drs.retailer_org_id,sum(pwt_amt+retailer_claim_comm-govt_claim_comm) as pwt,rtm.transaction_date from st_dg_ret_pwt_&quot; </span>
							+ rsGame.getInt(&quot;game_id&quot;)
					+&quot; drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and transaction_date&gt;='&quot; +
					 startDate 		
					+&quot;'and transaction_date&lt;='&quot; 
					+ endDate
						+	&quot;' and drs.retailer_org_id =&quot;+retOrgId+&quot; group by date(transaction_date)) union all&quot;);

			

				}

<span class="nc" id="L239">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;), saleQry</span>
						.length());
<span class="nc" id="L241">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;), cancelQry</span>
						.length());
<span class="nc" id="L243">				pwtQry.delete(pwtQry.lastIndexOf(&quot;union all&quot;), pwtQry.length());</span>

<span class="nc" id="L245">				saleQry</span>
						.append(&quot;) saletable group by date(transaction_date)&quot;);
<span class="nc" id="L247">				cancelQry</span>
						.append(&quot;) cancelTlb group by date(transaction_date)&quot;);
<span class="nc" id="L249">				pwtQry</span>
						.append(&quot;) pwtTlb group by date(transaction_date)&quot;);
<span class="nc" id="L251">				logger.debug(&quot;-------Draw Sale Qurey------\n&quot; + saleQry);</span>
<span class="nc" id="L252">				logger.debug(&quot;-------Draw Cancel Qurey------\n&quot; + cancelQry);</span>
<span class="nc" id="L253">				logger.debug(&quot;-------Draw Pwt Qurey------\n&quot; + pwtQry);</span>

				
<span class="nc bnc" id="L256" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L257">					String saleArchQry=&quot;union all select finaldate,organization_id,sum(sale_net) as sale from st_rep_dg_retailer where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by finaldate&quot;;</span>
<span class="nc" id="L258">					String cancelDebitArchQry=&quot;union all select finaldate,organization_id,sum(ref_net_amt) as cancel from st_rep_dg_retailer where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by finaldate&quot;;</span>
<span class="nc" id="L259">					String pwtArchQry=&quot;union all select finaldate,organization_id,sum(pwt_net_amt) as pwt  from st_rep_dg_retailer where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by finaldate&quot;;</span>
<span class="nc" id="L260">				 saleQry.append(saleArchQry);</span>
<span class="nc" id="L261">				 cancelQry.append(cancelDebitArchQry);</span>
<span class="nc" id="L262">				 pwtQry.append(pwtArchQry);</span>
				 
				
				
				}
				
				
				// Draw Sale Query
<span class="nc" id="L270">				pstmt = con.prepareStatement(saleQry.toString());</span>
<span class="nc" id="L271">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L273">					SimpleDateFormat dateformat = new SimpleDateFormat(</span>
					&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L275">					String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));</span>
					//String agtOrgId = rs.getString(&quot;organization_id&quot;);
				
<span class="nc" id="L278">				agtMap.get(dateFrDtParse).setDgSale(agtMap.get(dateFrDtParse).getDgSale()+ rs.getDouble(&quot;sale&quot;));</span>
					
<span class="nc" id="L280">				}</span>
				// Draw Cancel Query
<span class="nc" id="L282">				pstmt = con.prepareStatement(cancelQry.toString());</span>
<span class="nc" id="L283">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L285">					SimpleDateFormat dateformat = new SimpleDateFormat(</span>
					&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L287">					String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));</span>
					//String agtOrgId = rs.getString(&quot;organization_id&quot;);
				
<span class="nc" id="L290">				agtMap.get(dateFrDtParse).setDgCancel(agtMap.get(dateFrDtParse).getDgCancel()+ </span>
						rs.getDouble(&quot;cancel&quot;));
					
<span class="nc" id="L293">				}</span>
				// Draw Pwt Query
<span class="nc" id="L295">				pstmt = con.prepareStatement(pwtQry.toString());</span>
<span class="nc" id="L296">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L298">					SimpleDateFormat dateformat = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L299">					String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));</span>
									
<span class="nc" id="L301">				agtMap.get(dateFrDtParse).setDgPwt(agtMap.get(dateFrDtParse).getDgPwt()+ rs.getDouble(&quot;pwt&quot;));</span>
					
<span class="nc" id="L303">				}</span>

				/*// Draw Direct Player Qry

				String dirPwtQry = &quot;select date(transaction_date) date,agent_org_id,sum(pwt_amt+agt_claim_comm) pwtDir from st_dg_agt_direct_plr_pwt where transaction_date&gt;=? and transaction_date&lt;=? and agent_org_id=&quot;+agtOrgId+&quot; group by date(transaction_date) &quot;;
				pstmt = con.prepareStatement(dirPwtQry);
				pstmt.setTimestamp(1, startDate);
				pstmt.setTimestamp(2, endDate);
				logger.debug(&quot;-------Draw Direct Player Qry------\n&quot; + pstmt);
				rs = pstmt.executeQuery();
				while (rs.next()) {
					SimpleDateFormat dateformat = new SimpleDateFormat(
					&quot;yyyy-MM-dd&quot;);
					String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));
					//String agtOrgId = rs.getString(&quot;organization_id&quot;);
				
				agtMap.get(dateFrDtParse).setDgDirPlyPwt(
								rs.getDouble(&quot;pwtDir&quot;));
			
				}*/
			}
<span class="nc bnc" id="L324" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
				// Calculate Scratch Sale
<span class="nc" id="L326">				String saleQry = &quot;&quot;;</span>
<span class="nc" id="L327">				String cancelQry=&quot;&quot;;</span>
<span class="nc" id="L328">				logger.info(&quot;----Type Select ---&quot;</span>
						+ LMSFilterDispatcher.seSaleReportType);
<span class="nc bnc" id="L330" title="All 2 branches missed.">				if (&quot;BOOK_WISE&quot;.equals(LMSFilterDispatcher.seSaleReportType)) {</span>
<span class="nc" id="L331">					saleQry=&quot;select retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(netAmt),0.0) netAmt, date from ((select srt.retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(net_amt),0.0) netAmt,date(atm.transaction_date) date from st_se_agent_retailer_transaction srt,st_lms_agent_transaction_master atm where srt.transaction_id=atm.transaction_id and atm.transaction_type ='SALE' and transaction_date&gt;='&quot; </span>
						+ startDate
					    +&quot;' and transaction_date&lt;='&quot; 
					    + endDate
					    +&quot;' and srt.retailer_org_id=&quot;+retOrgId +&quot; group by date(transaction_date))  &quot;
					    +&quot;union all (select srt.retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(net_amt),0.0) netAmt,date(atm.transaction_date) date from st_se_agent_ret_loose_book_transaction srt,st_lms_agent_transaction_master atm where srt.transaction_id=atm.transaction_id and atm.transaction_type ='LOOSE_SALE' and transaction_date&gt;='&quot; 
						+ startDate
					    +&quot;' and transaction_date&lt;='&quot; 
					    + endDate
					    +&quot;' and srt.retailer_org_id=&quot;+retOrgId +&quot; group by date(transaction_date)))saleTlb group by date&quot;;
					
					
<span class="nc" id="L343">				 cancelQry=&quot;select retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(netAmt),0.0) netAmt, date from ((select srt.retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(net_amt),0.0) netAmt,date(atm.transaction_date) date from st_se_agent_retailer_transaction srt,st_lms_agent_transaction_master atm where srt.transaction_id=atm.transaction_id and atm.transaction_type ='SALE_RET' and transaction_date&gt;='&quot; </span>
						+ startDate
					    +&quot;' and transaction_date&lt;='&quot; 
					    + endDate
					    +&quot;' and srt.retailer_org_id=&quot;+retOrgId +&quot; group by date(transaction_date)) union all&quot;
					    +&quot;(select srt.retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(net_amt),0.0) netAmt,date(atm.transaction_date) date from st_se_agent_ret_loose_book_transaction srt,st_lms_agent_transaction_master atm where srt.transaction_id=atm.transaction_id and atm.transaction_type ='LOOSE_SALE_RET' and transaction_date&gt;='&quot; 
						+ startDate
					    +&quot;' and transaction_date&lt;='&quot; 
					    + endDate
					    +&quot;' and srt.retailer_org_id=&quot;+retOrgId +&quot; group by date(transaction_date)))cancelTlb group by date&quot;;
				
<span class="nc bnc" id="L354" title="All 2 branches missed.">				} else if (&quot;TICKET_WISE&quot;</span>
						.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L356">					saleQry = &quot;select gid.current_owner_id,sum(soldTkt*ticket_price) mrpAmt,sum((soldTkt*ticket_price)-(soldTkt*ticket_price*transacrion_sale_comm_rate*0.01)) netAmt,date(transaction_date) date from &quot;</span>
                              +&quot;st_se_game_master gm,st_se_game_inv_detail gid,(select game_id,book_nbr,sum(sold_tickets) soldTkt from st_se_game_ticket_inv_history where date&gt;='&quot; 
                              + startDate
                              +&quot;' and date&lt;='&quot; 
                              + endDate
                              +&quot;' and current_owner='RETAILER' group by book_nbr) TktTlb where gm.game_id=TktTlb.game_id and TktTlb.book_nbr=gid.book_nbr and gid.current_owner='AGENT' and gid.current_owner_id=&quot;+ agtOrgId +&quot; group by date(transaction_date) &quot;;
				}
<span class="nc bnc" id="L363" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L364">					String saleArchQry=&quot; union all select organization_id,sum(sale_book_mrp),sum(sale_book_net),finaldate as sale from st_rep_se_retailer where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by finaldate&quot;;</span>
<span class="nc" id="L365">					String cancelDebitArchQry=&quot; union all select organization_id,sum(ref_sale_mrp),sum(ref_net_amt) as cancel,finaldate from st_rep_se_retailer where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by finaldate&quot;;</span>
					//String cancelDebitArchQry=&quot;union all select finaldate,sum(pwt_net_amt) as pwt from st_rep_se_retailer where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by finaldate&quot;;
<span class="nc" id="L367">				 saleQry=saleQry+saleArchQry;</span>
<span class="nc" id="L368">				 cancelQry=cancelQry+cancelDebitArchQry;</span>
				}
				
				
				
<span class="nc" id="L373">				pstmt = con.prepareStatement(saleQry);</span>
<span class="nc" id="L374">				logger.debug(&quot;***Scratch Sale Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L375">				rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L377" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L378">					SimpleDateFormat dateformat = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L379">					String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));</span>
									
<span class="nc" id="L381">				agtMap.get(dateFrDtParse).setSeSale(agtMap.get(dateFrDtParse).getSeSale()+ rs.getDouble(&quot;netAmt&quot;));</span>
					
<span class="nc" id="L383">				}</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">				if (&quot;BOOK_WISE&quot;.equals(LMSFilterDispatcher.seSaleReportType)) {</span>
<span class="nc" id="L385">				pstmt = con.prepareStatement(cancelQry);</span>
<span class="nc" id="L386">				logger.debug(&quot;***Scratch Cancel Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L387">				rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L389" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L390">					SimpleDateFormat dateformat = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L391">					String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));</span>
									
<span class="nc" id="L393">				agtMap.get(dateFrDtParse).setSeCancel(agtMap.get(dateFrDtParse).getSeCancel()+ rs.getDouble(&quot;netAmt&quot;));</span>
					
<span class="nc" id="L395">				}</span>
				}
				
				// Calculate Scratch Pwt
<span class="nc" id="L399">				String pwtQry = &quot;select srp.retailer_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwt,transaction_date as date from  st_se_retailer_pwt srp inner join st_lms_retailer_transaction_master rtm on srp.transaction_id=rtm.transaction_id and transaction_date&gt;= ? and transaction_date&lt;= ? and transaction_type='PWT' and srp.retailer_org_id =&quot;+retOrgId+&quot;  group by date(transaction_date) &quot; </span>
				              + &quot;union all select srp.retailer_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwt,transaction_date from st_se_agent_pwt srp inner join st_lms_agent_transaction_master rtm on srp.transaction_id=rtm.transaction_id and transaction_date&gt;= ? and transaction_date&lt;= ?  and transaction_type='PWT' and srp.retailer_org_id =&quot;+retOrgId+&quot; group by date(transaction_date) &quot;;
<span class="nc bnc" id="L401" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L402">					String pwtArchQry=&quot;union all select organization_id,sum(pwt_net_amt) as pwt,finaldate from st_rep_se_retailer where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by finaldate&quot;;</span>
<span class="nc" id="L403">					pwtQry=pwtQry+pwtArchQry;</span>
				 
				}
				
<span class="nc" id="L407">				pstmt = con.prepareStatement(pwtQry);</span>
<span class="nc" id="L408">				pstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L409">				pstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L410">				pstmt.setTimestamp(3, startDate);</span>
<span class="nc" id="L411">				pstmt.setTimestamp(4, endDate);</span>
				
				
				
				
				
<span class="nc" id="L417">				logger.debug(&quot;***Scratch Pwt Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L418">				rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L420" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L421">					SimpleDateFormat dateformat = new SimpleDateFormat(</span>
					&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L423">					String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));</span>
<span class="nc" id="L424">					agtMap.get(dateFrDtParse).setSePwt(agtMap.get(dateFrDtParse).getSePwt()+ rs.getDouble(&quot;pwt&quot;));</span>
<span class="nc" id="L425">					}</span>

				/*// Scratch Direct Player Qry
				String dirPwtQry = &quot;select date(transaction_date) date,agent_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwtDir from st_se_agt_direct_player_pwt where transaction_date&gt;=? and transaction_date&lt;=? and agent_org_id=&quot;+agtOrgId+&quot; group by date(transaction_date) &quot;;
				
					
			
				
				//String dirPwtQry = &quot;select organization_id,ifnull(pwtDir,0.0) pwtDir from (select agent_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwtDir from st_se_agt_direct_player_pwt where transaction_date&gt;=? and transaction_date&lt;=? group by agent_org_id) pwtDirPly right outer join (select organization_id from st_lms_organization_master where organization_type='AGENT' and organization_id=&quot;+agtOrgId+&quot;) om on agent_org_id=organization_id&quot;;
				pstmt = con.prepareStatement(dirPwtQry);
				pstmt.setTimestamp(1, startDate);
				pstmt.setTimestamp(2, endDate);
				logger
						.debug(&quot;-------Scratch Direct Player Qry------\n&quot;
								+ pstmt);
				rs = pstmt.executeQuery();
				while (rs.next()) {
					SimpleDateFormat dateformat = new SimpleDateFormat(
					&quot;yyyy-MM-dd&quot;);
					String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));
					agtMap.get(dateFrDtParse).setSeDirPlyPwt(rs.getDouble(&quot;pwtDir&quot;));
				}*/
			}
<span class="nc bnc" id="L448" title="All 2 branches missed.">			if (ReportUtility.isCS) {</span>

				
<span class="nc" id="L451">				String catQry = &quot;select category_id from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L452">				PreparedStatement gamePstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L453">				ResultSet rsProduct = gamePstmt.executeQuery();</span>
				
<span class="nc" id="L455">				StringBuilder saleQry = new StringBuilder(</span>
				&quot;select date(transaction_date) date,retailer_org_id,sum(sale) as sale from (&quot;);
<span class="nc" id="L457">				StringBuilder cancelQry = new StringBuilder(</span>
				&quot;select date(transaction_date) date,retailer_org_id,sum(cancel) as cancel from (&quot;);
		
<span class="nc bnc" id="L460" title="All 2 branches missed.">				while (rsProduct.next()) {</span>
<span class="nc" id="L461">					saleQry.append(&quot;(select drs.retailer_org_id,sum(net_amt) as sale,rtm.transaction_date from st_cs_sale_&quot; </span>
							+ rsProduct.getInt(&quot;category_id&quot;)
					+&quot; drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_type in('CS_SALE') and transaction_date&gt;='&quot; +
					 startDate 		
					+&quot;'and transaction_date&lt;='&quot; 
					+ endDate
						+	&quot;' and drs.retailer_org_id =&quot;+retOrgId+&quot; group by date(transaction_date)) union all &quot;);
					
					
<span class="nc" id="L470">					cancelQry.append(&quot;(select drs.retailer_org_id,sum(net_amt) as cancel,rtm.transaction_date from st_cs_refund_&quot; </span>
							+ rsProduct.getInt(&quot;category_id&quot;)
					+&quot; drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_type in('CS_CANCEL_SERVER','CS_CANCEL_RET') and transaction_date&gt;='&quot; +
					 startDate 		
					+&quot;'and transaction_date&lt;='&quot; 
					+ endDate
						+	&quot;' and drs.retailer_org_id =&quot;+retOrgId+&quot; group by date(transaction_date)) union all &quot;);
					
				
				}

<span class="nc" id="L481">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;), saleQry</span>
						.length());
<span class="nc" id="L483">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;), cancelQry</span>
						.length());

<span class="nc" id="L486">				saleQry</span>
						.append(&quot;) saleTlb group by date(transaction_date)&quot;);
<span class="nc" id="L488">				cancelQry</span>
						.append(&quot;) cancelTlb group by date(transaction_date)&quot;);

<span class="nc" id="L491">				logger.debug(&quot;-------CS Sale Query------\n&quot; + saleQry);</span>
<span class="nc" id="L492">				logger.debug(&quot;-------CS Cancel Query------\n&quot; + cancelQry);</span>

				
<span class="nc bnc" id="L495" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L496">					String saleArchQry=&quot; union all select finaldate,organization_id,sum(sale_net) as sale from st_rep_cs_retailer where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by finaldate&quot;;</span>
<span class="nc" id="L497">					String cancelDebitArchQry=&quot; union all select finaldate,organization_id,sum(ref_net_amt) as cancel from st_rep_cs_retailer where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by finaldate&quot;;</span>
					
<span class="nc" id="L499">				 saleQry.append(saleArchQry);</span>
<span class="nc" id="L500">				 cancelQry.append(cancelDebitArchQry);</span>
				}
				
				
				
				// CS Sale Query
<span class="nc" id="L506">				pstmt = con.prepareStatement(saleQry.toString());</span>
<span class="nc" id="L507">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L508" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L509">					SimpleDateFormat dateformat = new SimpleDateFormat(</span>
					&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L511">					String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));</span>
					//String agtOrgId = rs.getString(&quot;organization_id&quot;);
				
<span class="nc" id="L514">				agtMap.get(dateFrDtParse).setCSSale(agtMap.get(dateFrDtParse).getCSSale()+ rs.getDouble(&quot;sale&quot;));</span>
					
					
<span class="nc" id="L517">				}</span>
				// CS Cancel Query
<span class="nc" id="L519">				pstmt = con.prepareStatement(cancelQry.toString());</span>
<span class="nc" id="L520">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L521" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L522">					SimpleDateFormat dateformat = new SimpleDateFormat(</span>
					&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L524">					String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));</span>
					//String agtOrgId = rs.getString(&quot;organization_id&quot;);
				
<span class="nc" id="L527">				agtMap.get(dateFrDtParse).setCSCancel(agtMap.get(dateFrDtParse).getCSCancel()+</span>
						rs.getDouble(&quot;cancel&quot;));
					
<span class="nc" id="L530">				}</span>
			}
<span class="nc bnc" id="L532" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>
<span class="nc" id="L533">				SimpleDateFormat dateformat = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L534">			StringBuilder wdQry = new StringBuilder(</span>
					&quot;select drs.retailer_org_id,sum(net_amt) as withAmt,rtm.transaction_date date &quot;);
<span class="nc" id="L536">			StringBuilder wdRefQry = new StringBuilder(</span>
					&quot;select drs.retailer_org_id,sum(net_amt) as withRefAmt,rtm.transaction_date date from &quot;);
<span class="nc" id="L538">			StringBuilder depQry = new StringBuilder(</span>
					&quot;select drs.retailer_org_id,sum(net_amt) as depoAmt,rtm.transaction_date date from &quot;);
<span class="nc" id="L540">			StringBuilder depRefQry = new StringBuilder(</span>
					&quot;select drs.retailer_org_id,sum(net_amt) as depoRefAmt,rtm.transaction_date date from &quot;);

<span class="nc" id="L543">			wdQry</span>
					.append(&quot;from st_ola_ret_withdrawl drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_type in('OLA_WITHDRAWL') and transaction_date&gt;='&quot;+startDate+&quot;'and transaction_date&lt;='&quot;+endDate+&quot;' and drs.retailer_org_id =&quot;+retOrgId+&quot; group by date(transaction_date)&quot;);

<span class="nc" id="L546">			wdRefQry</span>
					.append(&quot;st_ola_ret_withdrawl_refund drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_type in('OLA_WITHDRAWL_REFUND') and transaction_date&gt;='&quot;+startDate+&quot;'and transaction_date&lt;='&quot;+endDate+&quot;' and drs.retailer_org_id =&quot;+retOrgId+&quot; group by date(transaction_date)&quot;);
<span class="nc" id="L548">			depQry</span>
					.append(&quot;st_ola_ret_deposit drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_type in('OLA_DEPOSIT') and transaction_date&gt;='&quot;+startDate+&quot;'and transaction_date&lt;='&quot;+endDate+&quot;' and drs.retailer_org_id =&quot;+retOrgId+&quot; group by date(transaction_date)&quot;);

<span class="nc" id="L551">			depRefQry</span>
					.append(&quot;st_ola_ret_deposit_refund drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_type in('OLA_DEPOSIT_REFUND') and transaction_date&gt;='&quot;+startDate+&quot;'and transaction_date&lt;='&quot;+endDate+&quot;' and drs.retailer_org_id =&quot;+retOrgId+&quot; group by date(transaction_date)&quot;);

<span class="nc" id="L554">			String netGamingQry = &quot;select drs.retailer_org_id,sum(retailer_net_claim_comm) as netAmt,rtm.transaction_date date from st_ola_ret_comm drs inner join st_lms_retailer_transaction_master rtm on drs.transaction_id=rtm.transaction_id where transaction_type in('OLA_COMMISSION') and transaction_date&gt;='&quot;+startDate+&quot;' and transaction_date&lt;='&quot;+endDate+&quot;' and drs.retailer_org_id =&quot;+retOrgId+&quot; group by date(transaction_date)&quot;;</span>
			
<span class="nc" id="L556">			StringBuilder mainQuery=null;</span>
<span class="nc" id="L557">			StringBuilder unionQuery=null;</span>
			
<span class="nc bnc" id="L559" title="All 2 branches missed.">			if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L560">				mainQuery=new StringBuilder(&quot;select retailer_org_id,sum(withAmt) withAmt ,date from(&quot;);</span>
<span class="nc" id="L561">				unionQuery=new StringBuilder(&quot; union all select organization_id retailer_org_id,sum(withdrawal_net_amt) withAmt,finaldate from st_rep_ola_retailer  where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id =&quot;+retOrgId+&quot; group by finaldate) wthtable group by date&quot;);</span>
<span class="nc" id="L562">				mainQuery.append(wdQry.toString()).append(unionQuery.toString());</span>
<span class="nc" id="L563">				pstmt = con.prepareStatement(mainQuery.toString());</span>
			} else{
<span class="nc" id="L565">				pstmt = con.prepareStatement(wdQry.toString());</span>
			}
			
<span class="nc" id="L568">			logger.debug(&quot;-------Withdrawal Query------\n&quot; + pstmt);</span>
			
			// OLA Withdrawal Query
<span class="nc" id="L571">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L573">				String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));</span>
<span class="nc" id="L574">				agtMap.get(dateFrDtParse).setWithdrawal(agtMap.get(dateFrDtParse).getWithdrawal()+</span>
						rs.getDouble(&quot;withAmt&quot;));
<span class="nc" id="L576">			}</span>
			
<span class="nc bnc" id="L578" title="All 2 branches missed.">			if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L579">				mainQuery=new StringBuilder(&quot;select retailer_org_id,sum(withRefAmt) withRefAmt,date from(&quot;);</span>
<span class="nc" id="L580">				unionQuery=new StringBuilder(&quot; union all select organization_id retailer_org_id,sum(ref_withdrawal_net_amt) withRefAmt,finaldate from st_rep_ola_retailer  where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id =&quot;+retOrgId+&quot; group by finaldate) wthtable group by date&quot;);</span>
<span class="nc" id="L581">				mainQuery.append(wdRefQry.toString()).append(unionQuery.toString());</span>
<span class="nc" id="L582">				pstmt = con.prepareStatement(mainQuery.toString());</span>
			} else{
<span class="nc" id="L584">				pstmt = con.prepareStatement(wdRefQry.toString());</span>
			}
			
<span class="nc" id="L587">			logger.debug(&quot;-------WithDrawal Refund Query------\n&quot; + pstmt);</span>
			// OLA Withdrawal Refund Query
<span class="nc" id="L589">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L591">				String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));</span>
<span class="nc" id="L592">				agtMap.get(dateFrDtParse).setWithdrawalRefund(agtMap.get(dateFrDtParse).getWithdrawalRefund()+</span>
						rs.getDouble(&quot;withRefAmt&quot;));
<span class="nc" id="L594">			}</span>

<span class="nc bnc" id="L596" title="All 2 branches missed.">			if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L597">				mainQuery=new StringBuilder(&quot;select retailer_org_id,sum(depoAmt) depoAmt ,date from(&quot;);</span>
<span class="nc" id="L598">				unionQuery=new StringBuilder(&quot; union all select organization_id retailer_org_id,sum(deposit_net) depoAmt,finaldate from st_rep_ola_retailer  where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id =&quot;+retOrgId+&quot; group by finaldate) deptbl group by date&quot;);</span>
<span class="nc" id="L599">				mainQuery.append(depQry.toString()).append(unionQuery.toString());</span>
<span class="nc" id="L600">				pstmt = con.prepareStatement(mainQuery.toString());</span>
			} else{
<span class="nc" id="L602">				pstmt = con.prepareStatement(depQry.toString());</span>
			}
			
<span class="nc" id="L605">			logger.debug(&quot;-------Deposit Query------\n&quot; + pstmt);</span>
			
			// OLA Deposit Query
<span class="nc" id="L608">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L609" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L610">				String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));</span>
<span class="nc" id="L611">			agtMap.get(dateFrDtParse).setDeposit(agtMap.get(dateFrDtParse).getDeposit()+</span>
					rs.getDouble(&quot;depoAmt&quot;));
<span class="nc" id="L613">			}</span>
			
<span class="nc bnc" id="L615" title="All 2 branches missed.">			if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L616">				mainQuery=new StringBuilder(&quot;select retailer_org_id,sum(depoRefAmt) depoRefAmt ,date from(&quot;);</span>
<span class="nc" id="L617">				unionQuery=new StringBuilder(&quot; union all select organization_id retailer_org_id,sum(ref_deposit_net_amt) depoRefAmt,finaldate from st_rep_ola_retailer  where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id =&quot;+retOrgId+&quot; group by finaldate) deptbl group by date&quot;);</span>
<span class="nc" id="L618">				mainQuery.append(depRefQry.toString()).append(unionQuery.toString());</span>
<span class="nc" id="L619">				pstmt = con.prepareStatement(mainQuery.toString());</span>
			} else{
<span class="nc" id="L621">				pstmt = con.prepareStatement(depRefQry.toString());</span>
			}
			
			
<span class="nc" id="L625">			logger.debug(&quot;-------Deposit Refund Query------\n&quot; + pstmt);</span>
			// OLA Deposit Refund Query

<span class="nc" id="L628">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L629" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L630">				String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));</span>
<span class="nc" id="L631">				agtMap.get(dateFrDtParse).setDepositRefund(agtMap.get(dateFrDtParse).getDepositRefund()+</span>
						rs.getDouble(&quot;depoRefAmt&quot;));
<span class="nc" id="L633">			}</span>
		
<span class="nc bnc" id="L635" title="All 2 branches missed.">			if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L636">				mainQuery=new StringBuilder(&quot;select retailer_org_id,sum(netAmt) netAmt,date from(&quot;);</span>
<span class="nc" id="L637">				unionQuery=new StringBuilder(&quot; union all select organization_id retailer_org_id,sum(net_gaming_net_comm) netAmt,finaldate from st_rep_ola_retailer  where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id =&quot;+retOrgId+&quot; group by finaldate) comtbl group by date&quot;);</span>
<span class="nc" id="L638">				mainQuery.append(netGamingQry.toString()).append(unionQuery.toString());</span>
<span class="nc" id="L639">				pstmt = con.prepareStatement(mainQuery.toString());</span>
			} else{
<span class="nc" id="L641">				pstmt = con.prepareStatement(netGamingQry.toString());</span>
			}
			
<span class="nc" id="L644">			logger.debug(&quot;-------Net Gaming Query------\n&quot; + pstmt);</span>

			// OLA Net Gaming Query
<span class="nc" id="L647">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L649">				String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));</span>
<span class="nc" id="L650">				agtMap.get(dateFrDtParse).setNetGamingComm(agtMap.get(dateFrDtParse).getNetGamingComm()+</span>
						rs.getDouble(&quot;netAmt&quot;));
<span class="nc" id="L652">			}</span>
				
			}

<span class="nc bnc" id="L656" title="All 2 branches missed.">			if (ReportUtility.isSLE) { </span>
<span class="nc" id="L657">				SLEOrgReportRequestBean requestBean = new SLEOrgReportRequestBean();</span>
<span class="nc" id="L658">				requestBean.setFromDate(startDate);</span>
<span class="nc" id="L659">				requestBean.setToDate(endDate);</span>
<span class="nc" id="L660">				requestBean.setOrgId(retOrgId);</span>
				
<span class="nc" id="L662">				Map&lt;String, SLEOrgReportResponseBean&gt; map = SLERetailerReportsControllerImpl.fetchSaleCancelPwtDateWiseSingleRetailerAllGame(requestBean, con);</span>
<span class="nc bnc" id="L663" title="All 2 branches missed.">				for (Map.Entry&lt;String, SLEOrgReportResponseBean&gt; entry : map.entrySet()) {</span>
<span class="nc" id="L664">					SLEOrgReportResponseBean bean = entry.getValue();</span>
<span class="nc" id="L665">					agtMap.get(entry.getKey()).setSleSale(agtMap.get(entry.getKey()).getSleSale()+ bean.getSaleAmt());</span>
<span class="nc" id="L666">					agtMap.get(entry.getKey()).setSleCancel(agtMap.get(entry.getKey()).getSleCancel()+ bean.getCancelAmt());</span>
<span class="nc" id="L667">					agtMap.get(entry.getKey()).setSlePwt(agtMap.get(entry.getKey()).getSlePwt()+ bean.getPwtAmt());</span>
<span class="nc" id="L668">				}</span>
			}
<span class="nc bnc" id="L670" title="All 2 branches missed.">			if (ReportUtility.isIW) { </span>
<span class="nc" id="L671">				IWOrgReportRequestBean requestBean = new IWOrgReportRequestBean();</span>
<span class="nc" id="L672">				requestBean.setFromDate(startDate);</span>
<span class="nc" id="L673">				requestBean.setToDate(endDate);</span>
<span class="nc" id="L674">				requestBean.setOrgId(retOrgId);</span>
				
<span class="nc" id="L676">				Map&lt;String, IWOrgReportResponseBean&gt; map = IWRetailerReportsControllerImpl.fetchSaleCancelPwtDateWiseSingleRetailerAllGame(requestBean, con);</span>
<span class="nc bnc" id="L677" title="All 2 branches missed.">				for (Map.Entry&lt;String, IWOrgReportResponseBean&gt; entry : map.entrySet()) {</span>
<span class="nc" id="L678">					IWOrgReportResponseBean bean = entry.getValue();</span>
<span class="nc" id="L679">					agtMap.get(entry.getKey()).setIwSale(agtMap.get(entry.getKey()).getIwSale()+ bean.getSaleAmt());</span>
<span class="nc" id="L680">					agtMap.get(entry.getKey()).setIwCancel(agtMap.get(entry.getKey()).getIwCancel()+ bean.getCancelAmt());</span>
<span class="nc" id="L681">					agtMap.get(entry.getKey()).setIwPwt(agtMap.get(entry.getKey()).getIwPwt()+ bean.getPwtAmt());</span>
<span class="nc" id="L682">				}</span>
			}
<span class="nc bnc" id="L684" title="All 2 branches missed.">			if (ReportUtility.isVS) { </span>
<span class="nc" id="L685">				VSOrgReportRequestBean requestBean = new VSOrgReportRequestBean();</span>
<span class="nc" id="L686">				requestBean.setFromDate(startDate);</span>
<span class="nc" id="L687">				requestBean.setToDate(endDate);</span>
<span class="nc" id="L688">				requestBean.setOrgId(retOrgId);</span>
				
<span class="nc" id="L690">				Map&lt;String, VSOrgReportResponseBean&gt; map = VSRetailerReportsControllerImpl.fetchSaleCancelPwtDateWiseSingleRetailerAllGame(requestBean, con);</span>
<span class="nc bnc" id="L691" title="All 2 branches missed.">				for (Map.Entry&lt;String, VSOrgReportResponseBean&gt; entry : map.entrySet()) {</span>
<span class="nc" id="L692">					VSOrgReportResponseBean bean = entry.getValue();</span>
<span class="nc" id="L693">					agtMap.get(entry.getKey()).setVsSale(agtMap.get(entry.getKey()).getVsSale()+ bean.getSaleAmt());</span>
<span class="nc" id="L694">					agtMap.get(entry.getKey()).setVsCancel(agtMap.get(entry.getKey()).getVsCancel()+ bean.getCancelAmt());</span>
<span class="nc" id="L695">					agtMap.get(entry.getKey()).setVsPwt(agtMap.get(entry.getKey()).getVsPwt()+ bean.getPwtAmt());</span>
<span class="nc" id="L696">				}</span>
			}
<span class="nc" id="L698">		} catch (Exception e) {</span>
<span class="nc" id="L699">			e.printStackTrace();</span>
<span class="nc" id="L700">			throw new LMSException(&quot;Error in report collectionAgentWise&quot;);</span>
<span class="nc" id="L701">		} finally {</span>
			
<span class="nc" id="L703">		}</span>
<span class="nc" id="L704">	}</span>
	
	

	public Map&lt;String, CollectionReportOverAllBean&gt; collectionRetailerWiseWithOpeningBal(
			Timestamp deployDate, Timestamp startDate, Timestamp endDate,int agtOrgId,int retOrgId, ReportStatusBean reportStatusBean) throws LMSException {
		
<span class="nc" id="L711">		Connection con = null;</span>
<span class="nc bnc" id="L712" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L713">			return null;</span>
		}
<span class="nc" id="L715">		Map&lt;String, CollectionReportOverAllBean&gt; agtMapOpenningBalance = new LinkedHashMap&lt;String, CollectionReportOverAllBean&gt;();</span>
<span class="nc" id="L716">		Map&lt;String, CollectionReportOverAllBean&gt; agtMap = new LinkedHashMap&lt;String, CollectionReportOverAllBean&gt;();</span>
		//Map&lt;String, CollectionReportOverAllBean&gt; resultMap = new LinkedHashMap&lt;String, CollectionReportOverAllBean&gt;();
<span class="nc" id="L718">		CollectionReportOverAllBean collBean = null;</span>
<span class="nc" id="L719">         Double openingBalance=0.0;</span>
		try {
<span class="nc bnc" id="L721" title="All 4 branches missed.">			if (&quot;NO&quot;.equals(Utility.getPropertyValue(&quot;IS_DATA_FROM_REPLICA&quot;)) || &quot;MAIN_DB&quot;.equals(reportStatusBean.getReportingFrom()))</span>
<span class="nc" id="L722">				con = DBConnect.getConnection();</span>
			else
<span class="nc" id="L724">				con = DBConnectReplica.getConnection();</span>
			//String agtOrgQry = &quot;select name,organization_id from st_lms_organization_master where organization_type='AGENT' and organization_id=&quot;+agtOrgId;
			//pstmt = con.prepareStatement(agtOrgQry);
			//rsRetOrg = pstmt.executeQuery();
			
<span class="nc" id="L729">			Calendar startCal = Calendar.getInstance();</span>
<span class="nc" id="L730">			Calendar endCal = Calendar.getInstance();</span>
<span class="nc" id="L731">			Calendar nextCal = Calendar.getInstance();</span>
<span class="nc" id="L732">			startCal.setTimeInMillis(startDate.getTime());</span>
<span class="nc" id="L733">			endCal.setTimeInMillis(endDate.getTime());</span>
<span class="nc" id="L734">			nextCal.setTimeInMillis(startDate.getTime());</span>
<span class="nc" id="L735">			SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
			//nextCal.add(Calendar.DAY_OF_MONTH, 1);
		//	startDate = new Timestamp(sdf.parse(sdf.format(startCal.getTime())).getTime());
		//	endDate = new Timestamp(sdf.parse(sdf.format(endCal.getTime())).getTime());
<span class="nc" id="L739">			collBean = new CollectionReportOverAllBean();</span>
<span class="nc" id="L740">			collBean.setAgentName(new Timestamp(nextCal.getTimeInMillis()).toString().split(&quot; &quot;)[0]);//its date for this report</span>
<span class="nc" id="L741">			collBean.setOpeningBal(0.0);</span>
<span class="nc" id="L742">			collBean.setCash(0.0);</span>
<span class="nc" id="L743">			collBean.setCheque(0.0);</span>
<span class="nc" id="L744">			collBean.setChequeReturn(0.0);</span>
<span class="nc" id="L745">			collBean.setCredit(0.0);</span>
<span class="nc" id="L746">			collBean.setDebit(0.0);</span>
<span class="nc" id="L747">			collBean.setBankDep(0.0);</span>
<span class="nc bnc" id="L748" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L749">				collBean.setDgSale(0.0);</span>
<span class="nc" id="L750">				collBean.setDgPwt(0.0);</span>
<span class="nc" id="L751">				collBean.setDgCancel(0.0);</span>
<span class="nc" id="L752">				collBean.setDgDirPlyPwt(0.0);</span>
			}
<span class="nc bnc" id="L754" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
<span class="nc" id="L755">				collBean.setSeSale(0.0);</span>
<span class="nc" id="L756">				collBean.setSePwt(0.0);</span>
<span class="nc" id="L757">				collBean.setSeDirPlyPwt(0.0);</span>
			}
<span class="nc bnc" id="L759" title="All 2 branches missed.">			if (ReportUtility.isCS) {</span>
<span class="nc" id="L760">				collBean.setCSSale(0.0);</span>
<span class="nc" id="L761">				collBean.setCSCancel(0.0);</span>
			}
<span class="nc bnc" id="L763" title="All 2 branches missed.">			if(ReportUtility.isOLA){</span>
<span class="nc" id="L764">				collBean.setDeposit(0.0);</span>
<span class="nc" id="L765">				collBean.setDepositRefund(0.0);</span>
<span class="nc" id="L766">				collBean.setWithdrawal(0.0);</span>
<span class="nc" id="L767">				collBean.setWithdrawalRefund(0.0);</span>
<span class="nc" id="L768">				collBean.setNetGamingComm(0.0);</span>
			}
<span class="nc bnc" id="L770" title="All 2 branches missed.">			if (ReportUtility.isIW) {</span>
<span class="nc" id="L771">				collBean.setIwSale(0.0);</span>
<span class="nc" id="L772">				collBean.setIwPwt(0.0);</span>
<span class="nc" id="L773">				collBean.setIwCancel(0.0);</span>
<span class="nc" id="L774">				collBean.setIwDirPlyPwt(0.0);</span>
			}
<span class="nc bnc" id="L776" title="All 2 branches missed.">			if (ReportUtility.isVS) {</span>
<span class="nc" id="L777">				collBean.setVsSale(0.0);</span>
<span class="nc" id="L778">				collBean.setVsPwt(0.0);</span>
<span class="nc" id="L779">				collBean.setVsCancel(0.0);</span>
<span class="nc" id="L780">				collBean.setVsDirPlyPwt(0.0);</span>
			}
<span class="nc" id="L782">			agtMapOpenningBalance.put(agtOrgId+&quot;&quot;, collBean);</span>
<span class="nc" id="L783">			RetailerOpeningBalanceHelper openingHelper=new RetailerOpeningBalanceHelper();</span>
<span class="nc" id="L784">			openingBalance=openingHelper.getRetailerOpeningBal(deployDate, startDate, retOrgId, agtOrgId, con);</span>
			
<span class="nc bnc" id="L786" title="All 2 branches missed.">			if (endCal.after(startCal)) {</span>
<span class="nc bnc" id="L787" title="All 2 branches missed.">				while(nextCal.compareTo(endCal)&lt;=0){</span>
					
<span class="nc" id="L789">				collBean = new CollectionReportOverAllBean();</span>
<span class="nc" id="L790">				String AgentName=new Timestamp(nextCal.getTimeInMillis()).toString().split(&quot; &quot;)[0];//its date for this report</span>
<span class="nc" id="L791">				collBean.setAgtId(agtOrgId);</span>
<span class="nc" id="L792">				collBean.setOpeningBal(0.0);</span>
<span class="nc" id="L793">				collBean.setCash(0.0);</span>
<span class="nc" id="L794">				collBean.setCheque(0.0);</span>
<span class="nc" id="L795">				collBean.setChequeReturn(0.0);</span>
<span class="nc" id="L796">				collBean.setCredit(0.0);</span>
<span class="nc" id="L797">				collBean.setDebit(0.0);</span>
<span class="nc" id="L798">				collBean.setBankDep(0.0);</span>
<span class="nc bnc" id="L799" title="All 2 branches missed.">				if (ReportUtility.isDG) {</span>
<span class="nc" id="L800">					collBean.setDgSale(0.0);</span>
<span class="nc" id="L801">					collBean.setDgPwt(0.0);</span>
<span class="nc" id="L802">					collBean.setDgCancel(0.0);</span>
<span class="nc" id="L803">					collBean.setDgDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L805" title="All 2 branches missed.">				if (ReportUtility.isSE) {</span>
<span class="nc" id="L806">					collBean.setSeSale(0.0);</span>
<span class="nc" id="L807">					collBean.setSePwt(0.0);</span>
<span class="nc" id="L808">					collBean.setSeDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L810" title="All 2 branches missed.">				if (ReportUtility.isCS) {</span>
<span class="nc" id="L811">					collBean.setCSSale(0.0);</span>
<span class="nc" id="L812">					collBean.setCSCancel(0.0);</span>
				}
<span class="nc bnc" id="L814" title="All 2 branches missed.">				if(ReportUtility.isOLA){</span>
<span class="nc" id="L815">					collBean.setDeposit(0.0);</span>
<span class="nc" id="L816">					collBean.setDepositRefund(0.0);</span>
<span class="nc" id="L817">					collBean.setWithdrawal(0.0);</span>
<span class="nc" id="L818">					collBean.setWithdrawalRefund(0.0);</span>
<span class="nc" id="L819">					collBean.setNetGamingComm(0.0);</span>
				}
<span class="nc bnc" id="L821" title="All 2 branches missed.">				if (ReportUtility.isIW) {</span>
<span class="nc" id="L822">					collBean.setIwSale(0.0);</span>
<span class="nc" id="L823">					collBean.setIwPwt(0.0);</span>
<span class="nc" id="L824">					collBean.setIwCancel(0.0);</span>
<span class="nc" id="L825">					collBean.setIwDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L827" title="All 2 branches missed.">				if (ReportUtility.isVS) {</span>
<span class="nc" id="L828">					collBean.setVsSale(0.0);</span>
<span class="nc" id="L829">					collBean.setVsPwt(0.0);</span>
<span class="nc" id="L830">					collBean.setVsCancel(0.0);</span>
<span class="nc" id="L831">					collBean.setVsDirPlyPwt(0.0);</span>
				}
<span class="nc" id="L833">				agtMap.put(AgentName, collBean);</span>
				
<span class="nc" id="L835">				nextCal.add(Calendar.DAY_OF_MONTH, 1);//increment the date</span>
				
<span class="nc" id="L837">				}</span>
			}
<span class="nc" id="L839">			System.out.println(&quot;***agentMap***&quot;+agtMap);</span>
			
<span class="nc" id="L841">			collectionDateWise(startDate, endDate, con,</span>
					agtMap,agtOrgId,retOrgId);
			
<span class="nc" id="L844">			Iterator&lt;Map.Entry&lt;String, CollectionReportOverAllBean&gt;&gt; itr1 = agtMap</span>
			.entrySet().iterator();
<span class="nc bnc" id="L846" title="All 2 branches missed.">			while (itr1.hasNext()) {</span>
<span class="nc" id="L847">					Map.Entry&lt;String, CollectionReportOverAllBean&gt; pair = itr1.next();</span>
<span class="nc" id="L848">					CollectionReportOverAllBean bean = pair.getValue();</span>
<span class="nc" id="L849">					double openingBal = bean.getDgSale()</span>
					- bean.getDgCancel()
					- bean.getDgPwt()
					- bean.getDgDirPlyPwt()
					+ bean.getSeSale()
					- bean.getSeCancel()
					- bean.getSePwt()
					- bean.getSeDirPlyPwt()
					+ bean.getIwSale()
					- bean.getIwCancel()
					- bean.getIwDirPlyPwt()
					- bean.getIwPwt()
					+ bean.getVsSale()
					- bean.getVsCancel()
					- bean.getVsDirPlyPwt()
					- bean.getVsPwt()
					+ bean.getCSSale()
					- bean.getCSCancel()
					+bean.getSleSale()
					-bean.getSleCancel()
					-bean.getSlePwt()
					-bean.getSleDirPlyPwt()
					+ bean.getDeposit()
					- bean.getDepositRefund()
					- bean.getWithdrawal()
					- bean.getNetGamingComm()
					- (bean.getCash() + bean.getCheque() + bean.getCredit()
						+ bean.getBankDep() - bean.getDebit() - bean
						.getChequeReturn())
						+openingBalance;
<span class="nc" id="L879">		bean.setOpeningBal(openingBalance);</span>
<span class="nc" id="L880">		openingBalance=openingBal;</span>
<span class="nc" id="L881">	}</span>
			

<span class="nc" id="L884">		} catch (Exception e) {</span>
<span class="nc" id="L885">			e.printStackTrace();</span>
<span class="nc" id="L886">			throw new LMSException(</span>
					&quot;Error in report collectionAgentWiseWithOpeningBal&quot;);
		} finally {
<span class="nc" id="L889">			try {</span>
<span class="nc" id="L890">				con.close();</span>
<span class="nc" id="L891">			} catch (SQLException e) {</span>
<span class="nc" id="L892">				e.printStackTrace();</span>
<span class="nc" id="L893">			}</span>
<span class="nc" id="L894">		}</span>
<span class="nc" id="L895">		return agtMap;</span>
	}

	

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>