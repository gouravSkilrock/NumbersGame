<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CustomTransactionReportHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.reportsMgmt.common</a> &gt; <span class="el_source">CustomTransactionReportHelper.java</span></div><h1>CustomTransactionReportHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.reportsMgmt.common;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.Timestamp;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.HashMap;
import java.util.Iterator;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import java.util.TreeMap;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.beans.CollectionReportBean;
import com.skilrock.lms.beans.CollectionReportOverAllBean;
import com.skilrock.lms.beans.CustomTransactionReportBean;
import com.skilrock.lms.beans.ReportStatusBean;
import com.skilrock.lms.common.Utility;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.DBConnectReplica;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.utility.FormatNumber;
import com.skilrock.lms.web.accMgmt.common.RetailerOpeningBalanceHelper;
import com.skilrock.lms.web.reportsMgmt.common.ReportUtility;

<span class="nc" id="L35">public class CustomTransactionReportHelper {</span>
<span class="nc" id="L36">	Log logger = LogFactory.getLog(CustomTransactionReportHelper.class);</span>
<span class="nc" id="L37">	private PreparedStatement pstmt = null;</span>
<span class="nc" id="L38">	private double openningBalance = 0.0;</span>

	public Map&lt;String, String&gt; allGameMap() throws LMSException {
<span class="nc" id="L41">		Map&lt;String, String&gt; gameMap = new LinkedHashMap&lt;String, String&gt;();</span>
<span class="nc" id="L42">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L43">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L44">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L46">			String gameQry = &quot;select game_name,'DG' as game_type from st_dg_game_master union all select game_name,'SE' as game_type from st_se_game_master union all select category_code,'CS' from st_cs_product_category_master where status = 'ACTIVE' order by game_type&quot;;</span>
<span class="nc" id="L47">			pstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L48">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L49" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L50">				gameMap.put(rs.getString(&quot;game_name&quot;), rs</span>
						.getString(&quot;game_type&quot;));
			}
<span class="nc" id="L53">		} catch (Exception e) {</span>
<span class="nc" id="L54">			e.printStackTrace();</span>
<span class="nc" id="L55">			throw new LMSException(&quot;Error in fetch Game List&quot;);</span>
		} finally {
<span class="nc" id="L57">			try {</span>
<span class="nc" id="L58">				con.close();</span>
<span class="nc" id="L59">			} catch (SQLException e) {</span>
<span class="nc" id="L60">				e.printStackTrace();</span>
<span class="nc" id="L61">			}</span>
<span class="nc" id="L62">		}</span>
<span class="nc" id="L63">		return gameMap;</span>
	}

	public Map&lt;String, String&gt; allCatMap() throws LMSException {
<span class="nc" id="L67">		Map&lt;String, String&gt; gameMap = new LinkedHashMap&lt;String, String&gt;();</span>
<span class="nc" id="L68">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L69">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L70">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L72">			String gameQry = &quot;select category_code,'CS' as cat_type from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L73">			pstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L74">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L76">				gameMap.put(rs.getString(&quot;category_code&quot;), rs</span>
						.getString(&quot;cat_type&quot;));
			}
<span class="nc" id="L79">		} catch (Exception e) {</span>
<span class="nc" id="L80">			e.printStackTrace();</span>
<span class="nc" id="L81">			throw new LMSException(&quot;Error in fetch Cat List&quot;);</span>
		} finally {
<span class="nc" id="L83">			try {</span>
<span class="nc" id="L84">				con.close();</span>
<span class="nc" id="L85">			} catch (SQLException e) {</span>
<span class="nc" id="L86">				e.printStackTrace();</span>
<span class="nc" id="L87">			}</span>
<span class="nc" id="L88">		}</span>
<span class="nc" id="L89">		return gameMap;</span>
	}

	public Map&lt;String, Boolean&gt; checkAvailableService() {
<span class="nc" id="L93">		Connection con = null;</span>
<span class="nc" id="L94">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L95">		Map&lt;String, Boolean&gt; serMap = new HashMap&lt;String, Boolean&gt;();</span>
		try {
<span class="nc" id="L97">			con = DBConnect.getConnection();</span>
<span class="nc" id="L98">			String chkService = &quot;select service_code,status from st_lms_service_master where service_code!='MGMT'&quot;;</span>
<span class="nc" id="L99">			pstmt = con.prepareStatement(chkService);</span>
<span class="nc" id="L100">			ResultSet rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L102">				serMap.put(rs.getString(&quot;service_code&quot;),</span>
						&quot;ACTIVE&quot;.equals(rs.getString(&quot;status&quot;)));
			}
<span class="nc" id="L105">		} catch (Exception e) {</span>
<span class="nc" id="L106">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L108">			try {</span>
<span class="nc" id="L109">				con.close();</span>
<span class="nc" id="L110">			} catch (SQLException e) {</span>
<span class="nc" id="L111">				e.printStackTrace();</span>
<span class="nc" id="L112">			}</span>
<span class="nc" id="L113">		}</span>
<span class="nc" id="L114">		return serMap;</span>
	}

	public void collectionTransactionWise(Timestamp startDate, Timestamp endDate, Connection con, boolean isDG, boolean isSE, boolean isCS, boolean isSLE, boolean isIW, boolean isVS, Map&lt;String, CustomTransactionReportBean&gt; retailerMap, int retOrgId) throws LMSException {
<span class="nc" id="L118">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L119">		PreparedStatement pstmt1 = null;</span>
<span class="nc" id="L120">		ResultSet rs = null;</span>
<span class="nc" id="L121">		Statement stmt = null;</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L123">			return;</span>
		}
<span class="nc" id="L125">		String csString = &quot;&quot;;</span>
<span class="nc" id="L126">		String seString = &quot;&quot;;</span>
<span class="nc" id="L127">		String olaString = &quot;&quot;;</span>
<span class="nc" id="L128">		String sleString = &quot;&quot;;</span>
<span class="nc" id="L129">		String iwString = &quot;&quot;;</span>
<span class="nc" id="L130">		String vsString = &quot;&quot;;</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">		if (isCS) {</span>
<span class="nc" id="L132">			csString = &quot; union all select transaction_id,transaction_date,transaction_type,description as game_name,'GAME' as amount from st_lms_retailer_transaction_master rtm inner join st_cs_product_master scm on scm.product_id=rtm.game_id and date(transaction_date)&gt;='&quot;</span>
					+ startDate
					+ &quot;' and date(transaction_date) &lt;= '&quot;
					+ endDate
					+ &quot;' and rtm.transaction_type in('CS_CANCEL_SERVER','CS_CANCEL_RET','CS_SALE') and retailer_org_id=&quot;
					+ retOrgId;
		}
<span class="nc bnc" id="L139" title="All 2 branches missed.">		if (isSE) {</span>
<span class="nc" id="L140">			seString = &quot;union all select atm.transaction_id,transaction_date,atm.transaction_type,(select game_name from st_se_game_master gm where gm.game_id=art.game_id) as game_name,net_amt as amount from st_se_agent_retailer_transaction art,st_lms_agent_transaction_master atm where art.transaction_id=atm.transaction_id and  date(transaction_date)&gt;='&quot;</span>
					+ startDate
					+ &quot;' and date(transaction_date) &lt;= '&quot;
					+ endDate
					+ &quot;' and atm.transaction_type in('SALE','SALE_RET') and retailer_org_id=&quot;
					+ retOrgId
					+ &quot; union all &quot;
					+ &quot; select rtm.transaction_id,transaction_date,rtm.transaction_type,(select game_name from st_se_game_master gm where gm.game_id=srp.game_id) as game_name,(pwt_amt+(pwt_amt*claim_comm*0.01))  as amount from st_se_retailer_pwt srp,st_lms_retailer_transaction_master rtm where srp.transaction_id=rtm.transaction_id and  date(transaction_date)&gt;='&quot;
					+ startDate
					+ &quot;' and date(transaction_date) &lt;= '&quot;
					+ endDate
					+ &quot;' and rtm.transaction_type in('PWT') and srp.retailer_org_id= &quot;
					+ retOrgId;
		}
<span class="nc bnc" id="L154" title="All 2 branches missed.">		if (ReportUtility.isOLA) {</span>
<span class="nc" id="L155">			olaString = &quot;union all select mTbl.transaction_id,transaction_date,transaction_type,game_name,net_amt amount from(select transaction_id,retailer_org_id,'OLA Deposit' game_name,net_amt from st_ola_ret_deposit where retailer_org_id=? union all select transaction_id,retailer_org_id,'OLA Deposit Refund' game_name,net_amt from st_ola_ret_deposit_refund where retailer_org_id=? union all select transaction_id,retailer_org_id,'OLA Withdrawl' game_name,net_amt from st_ola_ret_withdrawl where retailer_org_id=? union all select transaction_id,retailer_org_id,'OLA Commission' game_name,retailer_net_claim_comm net_amt from st_ola_ret_comm where retailer_org_id=?)mTbl inner join  st_lms_retailer_transaction_master rtm on mTbl.transaction_id=rtm.transaction_id where date(transaction_date)&gt;='&quot;</span>
					+ startDate
					+ &quot;' and date(transaction_date) &lt;= '&quot;
					+ endDate
					+ &quot;'&quot;;
		}
<span class="nc bnc" id="L161" title="All 2 branches missed.">		if (isSLE) {</span>
<span class="nc" id="L162">			sleString = &quot;union all select transaction_id,transaction_date,transaction_type,type_disp_name game_name,'GAME' as amount from &quot;</span>
					+ &quot;st_lms_retailer_transaction_master rtm inner join st_sle_game_type_master sdg on sdg.game_type_id=rtm.game_id and date(transaction_date)&gt;='&quot;
					+ startDate
					+ &quot;' and date(transaction_date) &lt;= '&quot;
					+ endDate
					+ &quot;' and rtm.transaction_type in('SLE_REFUND_CANCEL','SLE_REFUND_FAILED','SLE_SALE','SLE_PWT_AUTO','SLE_PWT_PLR','SLE_PWT') and retailer_org_id=&quot;
					+ retOrgId + &quot;&quot;;
		}
<span class="nc bnc" id="L170" title="All 2 branches missed.">		if (isIW) {</span>
<span class="nc" id="L171">			iwString = &quot;union all select transaction_id,transaction_date,transaction_type,game_disp_name game_name,'GAME' as amount from &quot;</span>
					+ &quot;st_lms_retailer_transaction_master rtm inner join st_iw_game_master sdg on sdg.game_id=rtm.game_id and date(transaction_date)&gt;='&quot;
					+ startDate
					+ &quot;' and date(transaction_date) &lt;= '&quot;
					+ endDate
					+ &quot;' and rtm.transaction_type in('IW_SALE','IW_REFUND_CANCEL','IW_PWT') and retailer_org_id=&quot;
					+ retOrgId + &quot;&quot;;
		}
<span class="nc bnc" id="L179" title="All 2 branches missed.">		if (isVS) {</span>
<span class="nc" id="L180">			vsString = &quot;union all select transaction_id,transaction_date,transaction_type,game_disp_name game_name,'GAME' as amount from &quot;</span>
					+ &quot;st_lms_retailer_transaction_master rtm inner join st_vs_game_master sdg on sdg.game_id=rtm.game_id and date(transaction_date)&gt;='&quot;
					+ startDate
					+ &quot;' and date(transaction_date) &lt;= '&quot;
					+ endDate
					+ &quot;' and rtm.transaction_type in('VS_SALE','VS_REFUND_CANCEL','VS_PWT') and retailer_org_id=&quot;
					+ retOrgId + &quot;&quot;;
		}
		try {
<span class="nc" id="L189">			stmt = con.createStatement();</span>
<span class="nc" id="L190">			String transactionQuery=&quot;select transaction_id,transaction_date,transaction_type,game_name,amount from(select transaction_id,transaction_date,transaction_type,game_name,'GAME' as amount from &quot;</span>
				+	&quot;st_lms_retailer_transaction_master rtm inner join st_dg_game_master sdg on sdg.game_id=rtm.game_id and date(transaction_date)&gt;='&quot;+startDate+&quot;' and date(transaction_date) &lt;= '&quot;+endDate+&quot;' and rtm.transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED','DG_SALE','DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and retailer_org_id=&quot;+retOrgId +&quot; union all select concat(auto_id,type),date_time,type,concat(type,'  UPDATE'),amount from st_lms_cl_xcl_update_history where date(date_time)&gt;='&quot;+startDate+&quot;' and date(date_time) &lt;= '&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId +&quot; union all &quot; 
				+ &quot; select atm.transaction_id,transaction_date,atm.transaction_type,'Debit Note' as game_name, amount from st_lms_agent_transaction_master atm,st_lms_agent_debit_note sad where atm.transaction_id=sad.transaction_id and date(transaction_date)&gt;='&quot;+startDate+&quot;' and date(transaction_date) &lt;= '&quot;+endDate+&quot;' and party_id=&quot;+retOrgId+&quot;	union&quot;
				+&quot;	select atm.transaction_id,transaction_date,atm.transaction_type,'Credit Note' as game_name, amount from st_lms_agent_transaction_master atm,st_lms_agent_credit_note sac where atm.transaction_id=sac.transaction_id and date(transaction_date)&gt;='&quot;+startDate+&quot;' and date(transaction_date) &lt;= '&quot;+endDate+&quot;' and party_id=&quot;+retOrgId+&quot;	union&quot; 
				+&quot;	select atm.transaction_id,transaction_date,atm.transaction_type,'Cash Deposit' as game_name, amount from st_lms_agent_transaction_master atm,st_lms_agent_cash_transaction sct where atm.transaction_id=sct.transaction_id and date(transaction_date)&gt;='&quot;+startDate+&quot;' and date(transaction_date) &lt;= '&quot;+endDate+&quot;' and party_id=&quot;+retOrgId+&quot;	union&quot;
				+&quot;	select atm.transaction_id,transaction_date,atm.transaction_type,'Cheque Update' as game_name,cheque_amt amount from st_lms_agent_transaction_master atm,st_lms_agent_sale_chq sas where atm.transaction_id=sas.transaction_id and date(transaction_date)&gt;='&quot;+startDate+&quot;' and date(transaction_date) &lt;= '&quot;+endDate+&quot;' and party_id=&quot;+retOrgId+&quot; union select atm.transaction_id,transaction_date,atm.transaction_type,'Bank Deposit' as game_name, amount from st_lms_agent_transaction_master atm,st_lms_agent_bank_deposit_transaction bdt where atm.transaction_id=bdt.transaction_id and date(transaction_date)&gt;='&quot;+startDate+&quot;' and date(transaction_date) &lt;= '&quot;+endDate+&quot;' and party_id=&quot;+retOrgId+&quot; &quot;
				 +csString
				+&quot;  &quot; +seString+ &quot;  &quot;+olaString+&quot;  &quot;+sleString+&quot;  &quot;+iwString+&quot;  &quot;+vsString+&quot;) xyz order by transaction_date asc&quot;;
<span class="nc" id="L198">			pstmt = con.prepareStatement(transactionQuery);</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>
<span class="nc" id="L200">				pstmt.setInt(1, retOrgId);</span>
<span class="nc" id="L201">				pstmt.setInt(2, retOrgId);</span>
<span class="nc" id="L202">				pstmt.setInt(3, retOrgId);</span>
<span class="nc" id="L203">				pstmt.setInt(4, retOrgId);</span>
			}
<span class="nc" id="L205">			System.out.println(&quot;transaction Query::&quot; + transactionQuery);</span>
<span class="nc" id="L206">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L208">				String transactionType = rs.getString(&quot;transaction_type&quot;);</span>
<span class="nc" id="L209">				CustomTransactionReportBean transactionBean = new CustomTransactionReportBean();</span>
<span class="nc" id="L210">				transactionBean.setDate(rs.getString(&quot;transaction_date&quot;)</span>
						.substring(0,
								rs.getString(&quot;transaction_date&quot;).length() - 2));
<span class="nc" id="L213">				transactionBean.setTransactionType(transactionType);</span>
<span class="nc" id="L214">				transactionBean.setGameName(rs.getString(&quot;game_name&quot;));</span>
<span class="nc bnc" id="L215" title="All 4 branches missed.">				if (&quot;CL&quot;.equalsIgnoreCase(transactionType)</span>
						|| &quot;XCL&quot;.equalsIgnoreCase(transactionType)) {
<span class="nc" id="L217">					transactionBean.setAmount(rs.getDouble(&quot;amount&quot;));</span>
<span class="nc" id="L218">					transactionBean.setService(&quot;Home&quot;);</span>
<span class="nc bnc" id="L219" title="All 8 branches missed.">				} else if (&quot;CHEQUE&quot;.equalsIgnoreCase(transactionType)</span>
						|| &quot;CR_NOTE_CASH&quot;.equalsIgnoreCase(transactionType)
						|| &quot;CASH&quot;.equalsIgnoreCase(transactionType)
						|| &quot;CR_NOTE&quot;.equalsIgnoreCase(transactionType)) {
<span class="nc" id="L223">					transactionBean.setAmount(rs.getDouble(&quot;amount&quot;));</span>
<span class="nc" id="L224">					transactionBean.setService(&quot;Home&quot;);</span>
<span class="nc bnc" id="L225" title="All 6 branches missed.">				} else if (&quot;CHQ_BOUNCE&quot;.equalsIgnoreCase(transactionType)</span>
						|| &quot;DR_NOTE&quot;.equalsIgnoreCase(transactionType)
						|| &quot;DR_NOTE_CASH&quot;.equalsIgnoreCase(transactionType)) {
<span class="nc" id="L228">					transactionBean.setAmount(-(rs.getDouble(&quot;amount&quot;)));</span>
<span class="nc" id="L229">					transactionBean.setService(&quot;Home&quot;);</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">				} else if (&quot;SALE&quot;.equalsIgnoreCase(transactionType)) {</span>
<span class="nc" id="L231">					transactionBean.setAmount(-(rs.getDouble(&quot;amount&quot;)));</span>
<span class="nc" id="L232">					transactionBean.setService(&quot;Scratch Service&quot;);</span>
<span class="nc" id="L233">					transactionBean.setGameName(&quot;Sale : &quot;</span>
							+ rs.getString(&quot;game_name&quot;));
<span class="nc bnc" id="L235" title="All 2 branches missed.">				} else if (&quot;SALE_RET&quot;.equalsIgnoreCase(transactionType)) {</span>
<span class="nc" id="L236">					transactionBean.setAmount(rs.getDouble(&quot;amount&quot;));</span>
<span class="nc" id="L237">					transactionBean.setService(&quot;Scratch Service&quot;);</span>
<span class="nc" id="L238">					transactionBean.setGameName(&quot;Cancel : &quot;</span>
							+ rs.getString(&quot;game_name&quot;));
<span class="nc bnc" id="L240" title="All 2 branches missed.">				} else if (&quot;PWT&quot;.equalsIgnoreCase(transactionType)) {</span>
<span class="nc" id="L241">					transactionBean.setAmount(rs.getDouble(&quot;amount&quot;));</span>
<span class="nc" id="L242">					transactionBean.setService(&quot;Scratch Service&quot;);</span>
<span class="nc" id="L243">					transactionBean.setGameName(&quot;PWT : &quot;</span>
							+ rs.getString(&quot;game_name&quot;));
<span class="nc bnc" id="L245" title="All 2 branches missed.">				} else if (&quot;OLA_DEPOSIT&quot;.equalsIgnoreCase(transactionType)) {</span>
<span class="nc" id="L246">					transactionBean.setAmount(-(rs.getDouble(&quot;amount&quot;)));</span>
<span class="nc" id="L247">					transactionBean.setService(&quot;Home&quot;);</span>
<span class="nc" id="L248">					transactionBean.setGameName(rs.getString(&quot;game_name&quot;));</span>
<span class="nc bnc" id="L249" title="All 6 branches missed.">				} else if (&quot;OLA_DEPOSIT_REFUND&quot;</span>
						.equalsIgnoreCase(transactionType)
						|| &quot;OLA_WITHDRAWL&quot;.equalsIgnoreCase(transactionType)
						|| &quot;OLA_COMMISSION&quot;.equalsIgnoreCase(transactionType)) {
<span class="nc" id="L253">					transactionBean.setAmount(rs.getDouble(&quot;amount&quot;));</span>
<span class="nc" id="L254">					transactionBean.setService(&quot;Home&quot;);</span>
<span class="nc" id="L255">					transactionBean.setGameName(rs.getString(&quot;game_name&quot;));</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">				} else if (&quot;BANK_DEPOSIT&quot;.equalsIgnoreCase(transactionType)) {</span>
<span class="nc" id="L257">					transactionBean.setAmount(rs.getDouble(&quot;amount&quot;));</span>
<span class="nc" id="L258">					transactionBean.setService(&quot;Home&quot;);</span>
				} else {
<span class="nc" id="L260">					transactionBean.setAmount(0.0);</span>
				}
<span class="nc bnc" id="L262" title="All 2 branches missed.">				if (&quot;CHEQUE&quot;.equalsIgnoreCase(transactionType)) {</span>
<span class="nc" id="L263">					transactionBean.setGameName(&quot;CHEQUE&quot;);</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">				} else if (&quot;CHQ_BOUNCE&quot;.equalsIgnoreCase(transactionType)) {</span>
<span class="nc" id="L265">					transactionBean.setGameName(&quot;CHEQUE BOUNCE&quot;);</span>
				}

<span class="nc" id="L268">				retailerMap</span>
						.put(rs.getString(&quot;transaction_id&quot;), transactionBean);
<span class="nc" id="L270">			}</span>
<span class="nc" id="L271">			System.out.println(&quot;retailerMap:::&quot; + retailerMap);</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">			if (isSLE) {</span>
				// String gameQry = &quot;select game_id from st_sle_game_master&quot;;
				// PreparedStatement gamePstmt = con.prepareStatement(gameQry);
				// ResultSet rsGame = gamePstmt.executeQuery();
<span class="nc" id="L276">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select transaction_id,retailer_net_amt from (&quot;);
<span class="nc" id="L278">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select transaction_id,retailer_net_amt from (&quot;);
<span class="nc" id="L280">				StringBuilder pwtQry = new StringBuilder(</span>
						&quot;select transaction_id,pwt_amt from (&quot;);
				
				// while (rsGame.next()) {
<span class="nc" id="L284">				saleQry.append(&quot;(select rtm.transaction_id,retailer_net_amt from st_lms_retailer_transaction_master rtm inner join st_sle_ret_sale drs on rtm.transaction_id=drs.transaction_id and  date(rtm.transaction_date)&gt;='&quot;</span>
						+ startDate
						+ &quot;' and date(rtm.transaction_date) &lt;= '&quot;
						+ endDate
						+ &quot;' and rtm.transaction_type ='SLE_SALE' and rtm.retailer_org_id=&quot;
						+ retOrgId + &quot; ) union all &quot;);

<span class="nc" id="L291">				cancelQry</span>
						.append(&quot;(select rtm.transaction_id,retailer_net_amt from st_lms_retailer_transaction_master rtm inner join st_sle_ret_sale_refund drs on rtm.transaction_id=drs.transaction_id and  date(rtm.transaction_date)&gt;='&quot;
								+ startDate
								+ &quot;' and date(rtm.transaction_date) &lt;= '&quot;
								+ endDate
								+ &quot;' and rtm.transaction_type in ('SLE_REFUND_CANCEL','SLE_REFUND_FAILED') and rtm.retailer_org_id=&quot;
								+ retOrgId + &quot; ) union all  &quot;);

<span class="nc" id="L299">				pwtQry.append(&quot;(select rtm.transaction_id,pwt_amt from st_lms_retailer_transaction_master rtm inner join st_sle_ret_pwt drs on rtm.transaction_id=drs.transaction_id and  date(rtm.transaction_date)&gt;='&quot;</span>
						+ startDate
						+ &quot;' and date(rtm.transaction_date) &lt;= '&quot;
						+ endDate
						+ &quot;' and rtm.transaction_type in('SLE_PWT_AUTO','SLE_PWT_PLR','SLE_PWT') and rtm.retailer_org_id=&quot;
						+ retOrgId + &quot; ) union all&quot;);
				// }

<span class="nc" id="L307">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;),</span>
						saleQry.length());
<span class="nc" id="L309">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;),</span>
						cancelQry.length());
<span class="nc" id="L311">				pwtQry.delete(pwtQry.lastIndexOf(&quot;union all&quot;), pwtQry.length());</span>

<span class="nc" id="L313">				saleQry.append(&quot;) saletable order by transaction_id asc&quot;);</span>
<span class="nc" id="L314">				cancelQry.append(&quot;) cancelTlb order by transaction_id asc&quot;);</span>
<span class="nc" id="L315">				pwtQry.append(&quot;) pwtTlb order by transaction_id asc&quot;);</span>
<span class="nc" id="L316">				logger.debug(&quot;-------SLE Sale Qurey------\n&quot; + saleQry);</span>
<span class="nc" id="L317">				logger.debug(&quot;-------SLE Cancel Qurey------\n&quot; + cancelQry);</span>
<span class="nc" id="L318">				logger.debug(&quot;-------SLE Pwt Qurey------\n&quot; + pwtQry);</span>

<span class="nc" id="L320">				rs = stmt.executeQuery(saleQry.toString());</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">				while (rs.next()) {</span>

<span class="nc" id="L323">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setAmount(</span>
							-(rs.getDouble(&quot;retailer_net_amt&quot;)));
<span class="nc" id="L325">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setService(</span>
							&quot;Sports Lottery&quot;);
<span class="nc" id="L327">					String gameName = retailerMap.get(</span>
							rs.getString(&quot;transaction_id&quot;)).getGameName();
<span class="nc" id="L329">					retailerMap.get(rs.getString(&quot;transaction_id&quot;))</span>
							.setGameName(&quot;Sale : &quot; + gameName);
<span class="nc" id="L331">				}</span>
				// Draw Cancel Query
				/*
				 * pstmt = con.prepareStatement(cancelQry.toString()); rs =
				 * pstmt.executeQuery();
				 */

<span class="nc" id="L338">				rs = stmt.executeQuery(cancelQry.toString());</span>

<span class="nc bnc" id="L340" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L341">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setAmount(</span>
							rs.getDouble(&quot;retailer_net_amt&quot;));
<span class="nc" id="L343">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setService(</span>
							&quot;Sports Lottery&quot;);
<span class="nc" id="L345">					String gameName = retailerMap.get(</span>
							rs.getString(&quot;transaction_id&quot;)).getGameName();
<span class="nc" id="L347">					retailerMap.get(rs.getString(&quot;transaction_id&quot;))</span>
							.setGameName(&quot;Cancel : &quot; + gameName);

<span class="nc" id="L350">				}</span>
				// Draw Pwt Query
				/*
				 * pstmt = con.prepareStatement(pwtQry.toString()); rs =
				 * pstmt.executeQuery();
				 */

<span class="nc" id="L357">				rs = stmt.executeQuery(pwtQry.toString());</span>

<span class="nc bnc" id="L359" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L360">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setAmount(</span>
							rs.getDouble(&quot;pwt_amt&quot;));
<span class="nc" id="L362">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setService(</span>
							&quot;Sports Lottery&quot;);
<span class="nc" id="L364">					String gameName = retailerMap.get(</span>
							rs.getString(&quot;transaction_id&quot;)).getGameName();
<span class="nc" id="L366">					retailerMap.get(rs.getString(&quot;transaction_id&quot;))</span>
							.setGameName(&quot;Pwt : &quot; + gameName);
<span class="nc" id="L368">				}</span>

<span class="nc" id="L370">				System.out.println(&quot;retailerMap::&quot; + retailerMap);</span>

			}
<span class="nc bnc" id="L373" title="All 2 branches missed.">			if (isIW) {</span>
				// String gameQry = &quot;select game_id from st_sle_game_master&quot;;
				// PreparedStatement gamePstmt = con.prepareStatement(gameQry);
				// ResultSet rsGame = gamePstmt.executeQuery();
<span class="nc" id="L377">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select transaction_id,retailer_net_amt from (&quot;);
<span class="nc" id="L379">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select transaction_id,retailer_net_amt from (&quot;);
<span class="nc" id="L381">				StringBuilder pwtQry = new StringBuilder(</span>
						&quot;select transaction_id,pwt_amt from (&quot;);

				// while (rsGame.next()) {
<span class="nc" id="L385">				saleQry.append(&quot;(select rtm.transaction_id,retailer_net_amt from st_lms_retailer_transaction_master rtm inner join st_iw_ret_sale drs on rtm.transaction_id=drs.transaction_id and  date(rtm.transaction_date)&gt;='&quot;</span>
						+ startDate
						+ &quot;' and date(rtm.transaction_date) &lt;= '&quot;
						+ endDate
						+ &quot;' and rtm.transaction_type ='IW_SALE' and rtm.retailer_org_id=&quot;
						+ retOrgId + &quot; ) union all &quot;);

<span class="nc" id="L392">				cancelQry</span>
						.append(&quot;(select rtm.transaction_id,retailer_net_amt from st_lms_retailer_transaction_master rtm inner join st_iw_ret_sale_refund drs on rtm.transaction_id=drs.transaction_id and  date(rtm.transaction_date)&gt;='&quot;
								+ startDate
								+ &quot;' and date(rtm.transaction_date) &lt;= '&quot;
								+ endDate
								+ &quot;' and rtm.transaction_type in ('IW_REFUND_CANCEL') and rtm.retailer_org_id=&quot;
								+ retOrgId + &quot; ) union all  &quot;);

<span class="nc" id="L400">				pwtQry.append(&quot;(select rtm.transaction_id,(pwt_amt+retailer_claim_comm) pwt_amt from st_lms_retailer_transaction_master rtm inner join st_iw_ret_pwt drs on rtm.transaction_id=drs.transaction_id and  date(rtm.transaction_date)&gt;='&quot;</span>
						+ startDate
						+ &quot;' and date(rtm.transaction_date) &lt;= '&quot;
						+ endDate
						+ &quot;' and rtm.transaction_type in('IW_PWT') and rtm.retailer_org_id=&quot;
						+ retOrgId + &quot; ) union all&quot;);
				// }

<span class="nc" id="L408">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;),</span>
						saleQry.length());
<span class="nc" id="L410">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;),</span>
						cancelQry.length());
<span class="nc" id="L412">				pwtQry.delete(pwtQry.lastIndexOf(&quot;union all&quot;), pwtQry.length());</span>

<span class="nc" id="L414">				saleQry.append(&quot;) saletable order by transaction_id asc&quot;);</span>
<span class="nc" id="L415">				cancelQry.append(&quot;) cancelTlb order by transaction_id asc&quot;);</span>
<span class="nc" id="L416">				pwtQry.append(&quot;) pwtTlb order by transaction_id asc&quot;);</span>
<span class="nc" id="L417">				logger.debug(&quot;-------IW Sale Qurey------\n&quot; + saleQry);</span>
<span class="nc" id="L418">				logger.debug(&quot;-------IW Cancel Qurey------\n&quot; + cancelQry);</span>
<span class="nc" id="L419">				logger.debug(&quot;-------IW Pwt Qurey------\n&quot; + pwtQry);</span>

<span class="nc" id="L421">				rs = stmt.executeQuery(saleQry.toString());</span>
<span class="nc bnc" id="L422" title="All 2 branches missed.">				while (rs.next()) {</span>

<span class="nc" id="L424">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setAmount(</span>
							-(rs.getDouble(&quot;retailer_net_amt&quot;)));
<span class="nc" id="L426">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setService(</span>
							&quot;Instant Win&quot;);
<span class="nc" id="L428">					String gameName = retailerMap.get(</span>
							rs.getString(&quot;transaction_id&quot;)).getGameName();
<span class="nc" id="L430">					retailerMap.get(rs.getString(&quot;transaction_id&quot;))</span>
							.setGameName(&quot;Sale : &quot; + gameName);
<span class="nc" id="L432">				}</span>
				// Draw Cancel Query
				/*
				 * pstmt = con.prepareStatement(cancelQry.toString()); rs =
				 * pstmt.executeQuery();
				 */

<span class="nc" id="L439">				rs = stmt.executeQuery(cancelQry.toString());</span>

<span class="nc bnc" id="L441" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L442">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setAmount(</span>
							rs.getDouble(&quot;retailer_net_amt&quot;));
<span class="nc" id="L444">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setService(</span>
							&quot;Instant Win&quot;);
<span class="nc" id="L446">					String gameName = retailerMap.get(</span>
							rs.getString(&quot;transaction_id&quot;)).getGameName();
<span class="nc" id="L448">					retailerMap.get(rs.getString(&quot;transaction_id&quot;))</span>
							.setGameName(&quot;Cancel : &quot; + gameName);

<span class="nc" id="L451">				}</span>
				// Draw Pwt Query
				/*
				 * pstmt = con.prepareStatement(pwtQry.toString()); rs =
				 * pstmt.executeQuery();
				 */

<span class="nc" id="L458">				rs = stmt.executeQuery(pwtQry.toString());</span>

<span class="nc bnc" id="L460" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L461">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setAmount(</span>
							rs.getDouble(&quot;pwt_amt&quot;));
<span class="nc" id="L463">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setService(</span>
							&quot;Instant Win&quot;);
<span class="nc" id="L465">					String gameName = retailerMap.get(</span>
							rs.getString(&quot;transaction_id&quot;)).getGameName();
<span class="nc" id="L467">					retailerMap.get(rs.getString(&quot;transaction_id&quot;))</span>
							.setGameName(&quot;Pwt : &quot; + gameName);
<span class="nc" id="L469">				}</span>

<span class="nc" id="L471">				System.out.println(&quot;retailerMap::&quot; + retailerMap);</span>

			}
<span class="nc bnc" id="L474" title="All 2 branches missed.">			if (isDG) {</span>

				// Game Master Query
<span class="nc" id="L477">				String gameQry = &quot;select game_id from st_dg_game_master&quot;;</span>
<span class="nc" id="L478">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L479">				ResultSet rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L480">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select transaction_id,net_amt from (&quot;);
<span class="nc" id="L482">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select transaction_id,net_amt,ref_transaction_id from (&quot;);
<span class="nc" id="L484">				StringBuilder pwtQry = new StringBuilder(</span>
						&quot;select transaction_id,pwt_amt from (&quot;);
<span class="nc bnc" id="L486" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L487">					saleQry.append(&quot;(select rtm.transaction_id,net_amt from st_lms_retailer_transaction_master rtm inner join st_dg_ret_sale_&quot;+ rsGame.getInt(&quot;game_id&quot;)</span>
							+ &quot; drs on rtm.transaction_id=drs.transaction_id and  date(transaction_date)&gt;='&quot;
							+ startDate
							+ &quot;' and date(transaction_date) &lt;= '&quot;
							+ endDate
							+ &quot;' and rtm.transaction_type ='DG_SALE' and rtm.retailer_org_id=&quot;
							+ retOrgId + &quot; ) union all &quot;);

<span class="nc" id="L495">					cancelQry</span>
							.append(&quot;(select rtm.transaction_id,net_amt,ref_transaction_id from st_lms_retailer_transaction_master rtm inner join st_dg_ret_sale_refund_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; drs on rtm.transaction_id=drs.transaction_id and  date(transaction_date)&gt;='&quot;
									+ startDate
									+ &quot;' and date(transaction_date) &lt;= '&quot;
									+ endDate
									+ &quot;' and rtm.transaction_type in ('DG_REFUND_CANCEL','DG_REFUND_FAILED') and rtm.retailer_org_id=&quot;
									+ retOrgId + &quot; ) union all  &quot;);

<span class="nc" id="L505">					pwtQry.append(&quot;(select rtm.transaction_id,(pwt_amt+retailer_claim_comm-govt_claim_comm) pwt_amt from st_lms_retailer_transaction_master rtm inner join st_dg_ret_pwt_&quot;</span>
							+ rsGame.getInt(&quot;game_id&quot;)
							+ &quot; drs on rtm.transaction_id=drs.transaction_id and  date(transaction_date)&gt;='&quot;
							+ startDate
							+ &quot;' and date(transaction_date) &lt;= '&quot;
							+ endDate
							+ &quot;' and rtm.transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and rtm.retailer_org_id=&quot;
							+ retOrgId + &quot; ) union all&quot;);

				}

<span class="nc" id="L516">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;),</span>
						saleQry.length());
<span class="nc" id="L518">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;),</span>
						cancelQry.length());
<span class="nc" id="L520">				pwtQry.delete(pwtQry.lastIndexOf(&quot;union all&quot;), pwtQry.length());</span>

<span class="nc" id="L522">				saleQry.append(&quot;) saletable order by transaction_id asc&quot;);</span>
<span class="nc" id="L523">				cancelQry.append(&quot;) cancelTlb order by transaction_id asc&quot;);</span>
<span class="nc" id="L524">				pwtQry.append(&quot;) pwtTlb order by transaction_id asc&quot;);</span>
<span class="nc" id="L525">				logger.debug(&quot;-------Draw Sale Qurey------\n&quot; + saleQry);</span>
<span class="nc" id="L526">				logger.debug(&quot;-------Draw Cancel Qurey------\n&quot; + cancelQry);</span>
<span class="nc" id="L527">				logger.debug(&quot;-------Draw Pwt Qurey------\n&quot; + pwtQry);</span>

				// Draw Sale Query
				/*
				 * pstmt = con.prepareStatement(saleQry.toString()); rs =
				 * pstmt.executeQuery();
				 */

<span class="nc" id="L535">				rs = stmt.executeQuery(saleQry.toString());</span>
<span class="nc bnc" id="L536" title="All 2 branches missed.">				while (rs.next()) {</span>

<span class="nc" id="L538">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setAmount(</span>
							-(rs.getDouble(&quot;net_amt&quot;)));
<span class="nc" id="L540">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setService(</span>
							&quot;Draw Games&quot;);
<span class="nc" id="L542">					String gameName = retailerMap.get(</span>
							rs.getString(&quot;transaction_id&quot;)).getGameName();
<span class="nc" id="L544">					retailerMap.get(rs.getString(&quot;transaction_id&quot;))</span>
							.setGameName(&quot;Sale : &quot; + gameName);
<span class="nc" id="L546">				}</span>
				// Draw Cancel Query
				/*
				 * pstmt = con.prepareStatement(cancelQry.toString()); rs =
				 * pstmt.executeQuery();
				 */

<span class="nc" id="L553">				rs = stmt.executeQuery(cancelQry.toString());</span>

<span class="nc bnc" id="L555" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L556">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setAmount(</span>
							rs.getDouble(&quot;net_amt&quot;));
<span class="nc" id="L558">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setService(</span>
							&quot;Draw Games&quot;);
<span class="nc" id="L560">					String gameName = retailerMap.get(</span>
							rs.getString(&quot;transaction_id&quot;)).getGameName();
<span class="nc" id="L562">					retailerMap.get(rs.getString(&quot;transaction_id&quot;))</span>
							.setGameName(&quot;Cancel : &quot; + gameName);

<span class="nc" id="L565">				}</span>
				// Draw Pwt Query
				/*
				 * pstmt = con.prepareStatement(pwtQry.toString()); rs =
				 * pstmt.executeQuery();
				 */

<span class="nc" id="L572">				rs = stmt.executeQuery(pwtQry.toString());</span>

<span class="nc bnc" id="L574" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L575">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setAmount(</span>
							rs.getDouble(&quot;pwt_amt&quot;));
<span class="nc" id="L577">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setService(</span>
							&quot;Draw Games&quot;);
<span class="nc" id="L579">					String gameName = retailerMap.get(</span>
							rs.getString(&quot;transaction_id&quot;)).getGameName();
<span class="nc" id="L581">					retailerMap.get(rs.getString(&quot;transaction_id&quot;))</span>
							.setGameName(&quot;Pwt : &quot; + gameName);
<span class="nc" id="L583">				}</span>

<span class="nc" id="L585">				System.out.println(&quot;retailerMap::&quot; + retailerMap);</span>
			}
			/*		if (isSE) {
				// Calculate Scratch Sale
				String saleQry = &quot;&quot;;
				String cancelQry=&quot;&quot;;
				logger.info(&quot;----Type Select ---&quot;
						+ LMSFilterDispatcher.seSaleReportType);
				if (&quot;BOOK_WISE&quot;.equals(LMSFilterDispatcher.seSaleReportType)) {
					saleQry=&quot;select sbt.agent_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(net_amt),0.0) netAmt,date(btm.transaction_date) date from st_se_bo_agent_transaction sbt,st_lms_bo_transaction_master btm where sbt.transaction_id=btm.transaction_id and btm.transaction_type ='SALE' and transaction_date&gt;='&quot; 
						+ startDate
					    +&quot;' and transaction_date&lt;='&quot; 
					    + endDate
					    +&quot;' and sbt.agent_org_id=&quot;+agtOrgId +&quot; group by date(transaction_date)&quot;;
					
					
				 cancelQry=&quot;select sbt.agent_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(net_amt),0.0) netAmt,date(btm.transaction_date) date from st_se_bo_agent_transaction sbt,st_lms_bo_transaction_master btm where sbt.transaction_id=btm.transaction_id and btm.transaction_type ='SALE_RET' and transaction_date&gt;='&quot; 
						+ startDate
					    +&quot;' and transaction_date&lt;='&quot; 
					    + endDate
					    +&quot;' and sbt.agent_org_id=&quot;+agtOrgId +&quot; group by date(transaction_date)&quot;;
				
				} else if (&quot;TICKET_WISE&quot;
						.equals(LMSFilterDispatcher.seSaleReportType)) {
					saleQry = &quot;select gid.current_owner_id,sum(soldTkt*ticket_price) mrpAmt,sum((soldTkt*ticket_price)-(soldTkt*ticket_price*transacrion_sale_comm_rate*0.01)) netAmt,date(transaction_date) date from &quot;
                              +&quot;st_se_game_master gm,st_se_game_inv_detail gid,(select game_id,book_nbr,sum(sold_tickets) soldTkt from st_se_game_ticket_inv_history where date&gt;='&quot; 
                              + startDate
                              +&quot;' and date&lt;='&quot; 
                              + endDate
                              +&quot;' and current_owner='RETAILER' group by book_nbr) TktTlb where gm.game_id=TktTlb.game_id and TktTlb.book_nbr=gid.book_nbr and gid.current_owner='AGENT' and gid.current_owner_id=&quot;+ agtOrgId +&quot; group by date(transaction_date) &quot;;
				}
				pstmt = con.prepareStatement(saleQry);
				logger.debug(&quot;***Scratch Sale Query*** \n&quot; + pstmt);
				rs = pstmt.executeQuery();

				while (rs.next()) {
					SimpleDateFormat dateformat = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);
					String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));
									
				agtMap.get(dateFrDtParse).setSeSale(rs.getDouble(&quot;netAmt&quot;));
					
				}
				if (&quot;BOOK_WISE&quot;.equals(LMSFilterDispatcher.seSaleReportType)) {
				pstmt = con.prepareStatement(cancelQry);
				logger.debug(&quot;***Scratch Cancel Query*** \n&quot; + pstmt);
				rs = pstmt.executeQuery();

				while (rs.next()) {
					SimpleDateFormat dateformat = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);
					String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));
									
				agtMap.get(dateFrDtParse).setSeCancel(rs.getDouble(&quot;netAmt&quot;));
					
				}
				}
				
				// Calculate Scratch Pwt
				String pwtQry = &quot;select date(transaction_date) date,parent_id,sum(pwt) as pwt from (select bb.parent_id,sum(pwt) as pwt,transaction_date from(select srp.retailer_org_id,sum(pwt_amt+(pwt_amt*agt_claim_comm*0.01)) pwt,transaction_date from &quot; 
					+&quot; st_se_retailer_pwt srp inner join st_lms_retailer_transaction_master rtm on srp.transaction_id=rtm.transaction_id and transaction_date&gt;= ? and transaction_date&lt;= ? and transaction_type='PWT' and srp.retailer_org_id in &quot;
					+&quot;(select organization_id from st_lms_organization_master where organization_type='RETAILER')group by date(transaction_date),retailer_org_id)aa,st_lms_organization_master bb where retailer_org_id=organization_id and parent_id=&quot;+ agtOrgId+&quot; group by date(transaction_date) union all select bb.parent_id,sum(pwt) as pwt,transaction_date from(select srp.retailer_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwt,transaction_date from st_se_agent_pwt srp &quot;
					+&quot;inner join st_lms_retailer_transaction_master rtm on srp.transaction_id=rtm.transaction_id and transaction_date&gt;= ? and transaction_date&lt;= ?  and transaction_type='PWT' and srp.retailer_org_id in (select organization_id from st_lms_organization_master where organization_type='RETAILER')group by date(transaction_date),retailer_org_id)aa,st_lms_organization_master bb where retailer_org_id=organization_id and parent_id=&quot;+agtOrgId+&quot; group by date(transaction_date)&quot;
					+&quot;union all select agent_org_id,sum(pwt_amt+comm_amt) Pwt,transaction_date  from st_se_bo_pwt sbp inner join st_lms_bo_transaction_master btm on sbp.transaction_id=btm.transaction_id and transaction_date&gt;= ? and transaction_date&lt;= ? and transaction_type='PWT' and agent_org_id in (select organization_id from st_lms_organization_master where organization_type='AGENT' and organization_id= &quot;+ agtOrgId +&quot;) group by date(transaction_date))pwtTlb group by date(transaction_date) &quot;;
				pstmt = con.prepareStatement(pwtQry);
				pstmt.setTimestamp(1, startDate);
				pstmt.setTimestamp(2, endDate);
				pstmt.setTimestamp(3, startDate);
				pstmt.setTimestamp(4, endDate);
				pstmt.setTimestamp(5, startDate);
				pstmt.setTimestamp(6, endDate);
				logger.debug(&quot;***Scratch Pwt Query*** \n&quot; + pstmt);
				rs = pstmt.executeQuery();

				while (rs.next()) {
					SimpleDateFormat dateformat = new SimpleDateFormat(
					&quot;yyyy-MM-dd&quot;);
					String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));
					agtMap.get(dateFrDtParse).setSePwt(rs.getDouble(&quot;pwt&quot;));
					}

				// Scratch Direct Player Qry
				String dirPwtQry = &quot;select date(transaction_date) date,agent_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwtDir from st_se_agt_direct_player_pwt where transaction_date&gt;=? and transaction_date&lt;=? and agent_org_id=&quot;+agtOrgId+&quot; group by date(transaction_date) &quot;;
				
					
			
				
				//String dirPwtQry = &quot;select organization_id,ifnull(pwtDir,0.0) pwtDir from (select agent_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwtDir from st_se_agt_direct_player_pwt where transaction_date&gt;=? and transaction_date&lt;=? group by agent_org_id) pwtDirPly right outer join (select organization_id from st_lms_organization_master where organization_type='AGENT' and organization_id=&quot;+agtOrgId+&quot;) om on agent_org_id=organization_id&quot;;
				pstmt = con.prepareStatement(dirPwtQry);
				pstmt.setTimestamp(1, startDate);
				pstmt.setTimestamp(2, endDate);
				logger
						.debug(&quot;-------Scratch Direct Player Qry------\n&quot;
								+ pstmt);
				rs = pstmt.executeQuery();
				while (rs.next()) {
					SimpleDateFormat dateformat = new SimpleDateFormat(
					&quot;yyyy-MM-dd&quot;);
					String dateFrDtParse =dateformat.format(rs.getDate(&quot;date&quot;));
					agtMap.get(dateFrDtParse).setSeDirPlyPwt(rs.getDouble(&quot;pwtDir&quot;));
				}
			}*/
<span class="nc bnc" id="L685" title="All 2 branches missed.">			if (isCS) {</span>
<span class="nc" id="L686">				System.out.println(&quot;retailerMap::&quot; + retailerMap);</span>

				// Category Master Query
<span class="nc" id="L689">				String catQry = &quot;select category_id from st_cs_product_category_master&quot;;</span>
<span class="nc" id="L690">				PreparedStatement gamePstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L691">				ResultSet rsProduct = gamePstmt.executeQuery();</span>
<span class="nc" id="L692">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select transaction_id,net_amt from (&quot;);
<span class="nc" id="L694">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select transaction_id,net_amt,cs_ref_transaction_id from (&quot;);

<span class="nc bnc" id="L697" title="All 2 branches missed.">				while (rsProduct.next()) {</span>
<span class="nc" id="L698">					saleQry.append(&quot;(select rtm.transaction_id,net_amt from st_lms_retailer_transaction_master rtm inner join st_cs_sale_&quot;</span>
							+ rsProduct.getInt(&quot;category_id&quot;)
							+ &quot; drs on rtm.transaction_id=drs.transaction_id and  date(transaction_date)&gt;='&quot;
							+ startDate
							+ &quot;' and date(transaction_date) &lt;= '&quot;
							+ endDate
							+ &quot;' and rtm.transaction_type ='CS_SALE' and rtm.retailer_org_id=&quot;
							+ retOrgId + &quot; ) union all &quot;);

<span class="nc" id="L707">					cancelQry</span>
							.append(&quot;(select rtm.transaction_id,net_amt,cs_ref_transaction_id from st_lms_retailer_transaction_master rtm inner join st_cs_refund_&quot;
									+ rsProduct.getInt(&quot;category_id&quot;)
									+ &quot; drs on rtm.transaction_id=drs.transaction_id and  date(transaction_date)&gt;='&quot;
									+ startDate
									+ &quot;' and date(transaction_date) &lt;='&quot;
									+ endDate
									+ &quot;' and rtm.transaction_type in ('CS_CANCEL_SERVER','CS_CANCEL_RET') and rtm.retailer_org_id=&quot;
									+ retOrgId + &quot; ) union all  &quot;);

				}

<span class="nc" id="L719">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;),</span>
						saleQry.length());
<span class="nc" id="L721">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;),</span>
						cancelQry.length());

<span class="nc" id="L724">				saleQry.append(&quot;) saletable order by transaction_id asc&quot;);</span>
<span class="nc" id="L725">				cancelQry.append(&quot;) cancelTlb order by transaction_id asc&quot;);</span>

<span class="nc" id="L727">				logger.debug(&quot;-------CS Sale Query------\n&quot; + saleQry);</span>
<span class="nc" id="L728">				logger.debug(&quot;-------CS Cancel Query------\n&quot; + cancelQry);</span>

				// CS Sale Query
<span class="nc" id="L731">				pstmt = con.prepareStatement(saleQry.toString());</span>
<span class="nc" id="L732">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L733" title="All 2 branches missed.">				while (rs.next()) {</span>

<span class="nc" id="L735">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setAmount(-(rs.getDouble(&quot;net_amt&quot;)));</span>
<span class="nc" id="L736">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setService(&quot;Commercial Service&quot;);</span>
<span class="nc" id="L737">					String gameName=retailerMap.get(rs.getString(&quot;transaction_id&quot;)).getGameName();</span>
<span class="nc" id="L738">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setGameName(&quot;Sale : &quot;+gameName);</span>

<span class="nc" id="L740">				}</span>
				// CS Cancel Query
<span class="nc" id="L742">				pstmt = con.prepareStatement(cancelQry.toString());</span>
<span class="nc" id="L743">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L744" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L745">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setAmount(rs.getDouble(&quot;net_amt&quot;));</span>
<span class="nc" id="L746">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setService(&quot;Commercial Service&quot;);</span>
<span class="nc" id="L747">					String gameName=retailerMap.get(rs.getString(&quot;transaction_id&quot;)).getGameName();</span>
<span class="nc" id="L748">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setGameName(&quot;Cancel : &quot;+gameName);</span>

<span class="nc" id="L750">				}</span>
			}
<span class="nc bnc" id="L752" title="All 2 branches missed.">			if (isVS) {</span>
<span class="nc" id="L753">				StringBuilder saleQry = new StringBuilder(&quot;select transaction_id,retailer_net_amt from (&quot;);</span>
<span class="nc" id="L754">				StringBuilder cancelQry = new StringBuilder(&quot;select transaction_id,retailer_net_amt from (&quot;);</span>
<span class="nc" id="L755">				StringBuilder pwtQry = new StringBuilder(&quot;select transaction_id,pwt_amt from (&quot;);</span>

<span class="nc" id="L757">				saleQry.append(&quot;(select rtm.transaction_id,retailer_net_amt from st_lms_retailer_transaction_master rtm inner join st_vs_ret_sale drs on rtm.transaction_id=drs.transaction_id and date(rtm.transaction_date)&gt;='&quot;</span>
						+ startDate
						+ &quot;' and date(rtm.transaction_date) &lt;= '&quot;
						+ endDate
						+ &quot;' and rtm.transaction_type ='VS_SALE' and rtm.retailer_org_id=&quot;
						+ retOrgId + &quot; ) union all &quot;);
<span class="nc" id="L763">				cancelQry</span>
						.append(&quot;(select rtm.transaction_id,retailer_net_amt from st_lms_retailer_transaction_master rtm inner join st_vs_ret_sale_refund drs on rtm.transaction_id=drs.transaction_id and date(rtm.transaction_date)&gt;='&quot;
								+ startDate
								+ &quot;' and date(rtm.transaction_date) &lt;= '&quot;
								+ endDate
								+ &quot;' and rtm.transaction_type in ('VS_REFUND_CANCEL') and rtm.retailer_org_id=&quot;
								+ retOrgId + &quot; ) union all  &quot;);

<span class="nc" id="L771">				pwtQry.append(&quot;(select rtm.transaction_id,(pwt_amt+retailer_claim_comm) pwt_amt from st_lms_retailer_transaction_master rtm inner join st_vs_ret_pwt drs on rtm.transaction_id=drs.transaction_id and date(rtm.transaction_date)&gt;='&quot;</span>
						+ startDate
						+ &quot;' and date(rtm.transaction_date) &lt;= '&quot;
						+ endDate
						+ &quot;' and rtm.transaction_type in('VS_PWT') and rtm.retailer_org_id=&quot;
						+ retOrgId + &quot; ) union all&quot;);

<span class="nc" id="L778">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;), saleQry.length());</span>
<span class="nc" id="L779">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;), cancelQry.length());</span>
<span class="nc" id="L780">				pwtQry.delete(pwtQry.lastIndexOf(&quot;union all&quot;), pwtQry.length());</span>

<span class="nc" id="L782">				saleQry.append(&quot;) saletable order by transaction_id asc&quot;);</span>
<span class="nc" id="L783">				cancelQry.append(&quot;) cancelTlb order by transaction_id asc&quot;);</span>
<span class="nc" id="L784">				pwtQry.append(&quot;) pwtTlb order by transaction_id asc&quot;);</span>
<span class="nc" id="L785">				logger.debug(&quot;-------VS Sale Qurey------\n&quot; + saleQry);</span>
<span class="nc" id="L786">				logger.debug(&quot;-------VS Cancel Qurey------\n&quot; + cancelQry);</span>
<span class="nc" id="L787">				logger.debug(&quot;-------VS Pwt Qurey------\n&quot; + pwtQry);</span>

<span class="nc" id="L789">				rs = stmt.executeQuery(saleQry.toString());</span>
<span class="nc bnc" id="L790" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L791">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setAmount(-(rs.getDouble(&quot;retailer_net_amt&quot;)));</span>
<span class="nc" id="L792">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setService(&quot;Virtual Sport&quot;);</span>
<span class="nc" id="L793">					String gameName = retailerMap.get(rs.getString(&quot;transaction_id&quot;)).getGameName();</span>
<span class="nc" id="L794">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setGameName(&quot;Sale : &quot; + gameName);</span>
<span class="nc" id="L795">				}</span>
<span class="nc" id="L796">				rs = stmt.executeQuery(cancelQry.toString());</span>

<span class="nc bnc" id="L798" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L799">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setAmount(rs.getDouble(&quot;retailer_net_amt&quot;));</span>
<span class="nc" id="L800">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setService(&quot;Virtual Sport&quot;);</span>
<span class="nc" id="L801">					String gameName = retailerMap.get(rs.getString(&quot;transaction_id&quot;)).getGameName();</span>
<span class="nc" id="L802">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setGameName(&quot;Cancel : &quot; + gameName);</span>
<span class="nc" id="L803">				}</span>
<span class="nc" id="L804">				rs = stmt.executeQuery(pwtQry.toString());</span>

<span class="nc bnc" id="L806" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L807">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setAmount(rs.getDouble(&quot;pwt_amt&quot;));</span>
<span class="nc" id="L808">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setService(&quot;Virtual Sport&quot;);</span>
<span class="nc" id="L809">					String gameName = retailerMap.get(rs.getString(&quot;transaction_id&quot;)).getGameName();</span>
<span class="nc" id="L810">					retailerMap.get(rs.getString(&quot;transaction_id&quot;)).setGameName(&quot;Pwt : &quot; + gameName);</span>
<span class="nc" id="L811">				}</span>
<span class="nc" id="L812">				System.out.println(&quot;retailerMap::&quot; + retailerMap);</span>
			}
<span class="nc" id="L814">		} catch (Exception e) {</span>
<span class="nc" id="L815">			e.printStackTrace();</span>
<span class="nc" id="L816">			throw new LMSException(&quot;Error in report collectionAgentWise&quot;);</span>
<span class="nc" id="L817">		}</span>
<span class="nc" id="L818">	}</span>

	public List&lt;CollectionReportBean&gt; getRetailerCollectionDetail(
			Timestamp startDate, Timestamp endDate, int retOrgId,
			int agentOrgId, boolean isDraw, boolean isScratch, boolean isCS) {
<span class="nc" id="L823">		List&lt;CollectionReportBean&gt; list = new ArrayList&lt;CollectionReportBean&gt;();</span>
<span class="nc" id="L824">		CollectionReportBean collectionBean = null;</span>
<span class="nc" id="L825">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L826">		ResultSet rs = null, rs1 = null, rs2 = null, rs3 = null;</span>
<span class="nc" id="L827">		System.out.println(con + &quot;size of report list &quot; + retOrgId);</span>
<span class="nc" id="L828">		java.sql.Date start = new java.sql.Date(startDate.getTime());</span>
<span class="nc" id="L829">		java.sql.Date end = new java.sql.Date(endDate.getTime());</span>

		try {
			// double totalSale=0.0;
<span class="nc" id="L833">			double totalSaleRet = 0.0;</span>
			// double TotalSaleNRetTotal=0.0;
<span class="nc" id="L835">			double totalCash = 0.0;</span>
<span class="nc" id="L836">			double totalChq = 0.0;</span>
<span class="nc" id="L837">			double totalChqRet = 0.0;</span>
<span class="nc" id="L838">			double totalCredit = 0.0;</span>
<span class="nc" id="L839">			double totalDebit = 0.0;</span>
<span class="nc" id="L840">			double totalDrawSale = 0.0;</span>
<span class="nc" id="L841">			double totalDrawSaleRefund = 0.0;</span>
<span class="nc" id="L842">			double totalDrawPwt = 0.0;</span>
<span class="nc" id="L843">			double totalScratchSale = 0.0;</span>
<span class="nc" id="L844">			double totalScratchPwt = 0.0;</span>
<span class="nc" id="L845">			double totalRecTotal = 0.0;</span>
<span class="nc" id="L846">			double totalScratchTotal = 0.0;</span>
<span class="nc" id="L847">			double totalDrawTotal = 0.0;</span>
<span class="nc" id="L848">			double totalGrandTotal = 0.0;</span>
<span class="nc" id="L849">			int count = 1;</span>

<span class="nc" id="L851">			int partyid = retOrgId;</span>
<span class="nc" id="L852">			pstmt = con.prepareStatement(QueryManager</span>
					.getST_COLLECTION_DETAILS_FOR_AGENT());
<span class="nc" id="L854">			pstmt.setInt(1, agentOrgId);</span>
<span class="nc" id="L855">			pstmt.setInt(2, partyid);</span>
<span class="nc" id="L856">			pstmt.setDate(3, start);</span>
<span class="nc" id="L857">			pstmt.setDate(4, end);</span>

<span class="nc" id="L859">			pstmt.setInt(5, agentOrgId);</span>
<span class="nc" id="L860">			pstmt.setInt(6, partyid);</span>
<span class="nc" id="L861">			pstmt.setDate(7, start);</span>
<span class="nc" id="L862">			pstmt.setDate(8, end);</span>

<span class="nc" id="L864">			pstmt.setInt(9, agentOrgId);</span>
<span class="nc" id="L865">			pstmt.setInt(10, partyid);</span>
<span class="nc" id="L866">			pstmt.setDate(11, start);</span>
<span class="nc" id="L867">			pstmt.setDate(12, end);</span>

<span class="nc" id="L869">			pstmt.setInt(13, agentOrgId);</span>
<span class="nc" id="L870">			pstmt.setInt(14, partyid);</span>
<span class="nc" id="L871">			pstmt.setDate(15, start);</span>
<span class="nc" id="L872">			pstmt.setDate(16, end);</span>

<span class="nc" id="L874">			pstmt.setInt(17, agentOrgId);</span>
<span class="nc" id="L875">			pstmt.setInt(18, partyid);</span>
<span class="nc" id="L876">			pstmt.setDate(19, start);</span>
<span class="nc" id="L877">			pstmt.setDate(20, end);</span>

<span class="nc" id="L879">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L880">			logger.debug(&quot;get Agent accounts collections details query- ==== -&quot;</span>
					+ pstmt);

<span class="nc" id="L883">			String clXclamt = &quot;select ifnull(sum(amount),0.0) as amount from st_lms_cl_xcl_update_history where organization_id=? and date_time&gt;=? and date_time&lt; ? &quot;;</span>
<span class="nc" id="L884">			pstmt = con.prepareStatement(clXclamt);</span>
<span class="nc" id="L885">			pstmt.setInt(1, partyid);</span>
<span class="nc" id="L886">			pstmt.setDate(2, start);</span>
<span class="nc" id="L887">			pstmt.setDate(3, end);</span>
<span class="nc" id="L888">			rs3 = pstmt.executeQuery();</span>

<span class="nc bnc" id="L890" title="All 2 branches missed.">			if (isScratch) {</span>
<span class="nc" id="L891">				pstmt = con.prepareStatement(QueryManager</span>
						.getST_COLLECTION_DETAILS_FOR_AGENT_SE());
<span class="nc" id="L893">				pstmt.setInt(1, agentOrgId);</span>
<span class="nc" id="L894">				pstmt.setInt(2, partyid);</span>
<span class="nc" id="L895">				pstmt.setDate(3, start);</span>
<span class="nc" id="L896">				pstmt.setDate(4, end);</span>

<span class="nc" id="L898">				pstmt.setInt(5, agentOrgId);</span>
<span class="nc" id="L899">				pstmt.setInt(6, partyid);</span>
<span class="nc" id="L900">				pstmt.setDate(7, start);</span>
<span class="nc" id="L901">				pstmt.setDate(8, end);</span>

<span class="nc" id="L903">				pstmt.setInt(9, agentOrgId);</span>
<span class="nc" id="L904">				pstmt.setInt(10, partyid);</span>
<span class="nc" id="L905">				pstmt.setDate(11, start);</span>
<span class="nc" id="L906">				pstmt.setDate(12, end);</span>
<span class="nc" id="L907">				logger.debug(&quot;get Agent scratch collections details query- ==== -&quot;</span>
						+ pstmt);
<span class="nc" id="L909">				rs1 = pstmt.executeQuery();</span>
			}
<span class="nc bnc" id="L911" title="All 2 branches missed.">			if (isDraw) {</span>
<span class="nc" id="L912">				pstmt = con.prepareStatement(QueryManager</span>
						.getST_COLLECTION_DETAILS_FOR_AGENT_DG());
<span class="nc" id="L914">				pstmt.setInt(1, agentOrgId);</span>
<span class="nc" id="L915">				pstmt.setInt(2, partyid);</span>
<span class="nc" id="L916">				pstmt.setDate(3, start);</span>
<span class="nc" id="L917">				pstmt.setDate(4, end);</span>

<span class="nc" id="L919">				pstmt.setInt(5, agentOrgId);</span>
<span class="nc" id="L920">				pstmt.setInt(6, partyid);</span>
<span class="nc" id="L921">				pstmt.setDate(7, start);</span>
<span class="nc" id="L922">				pstmt.setDate(8, end);</span>

<span class="nc" id="L924">				pstmt.setInt(9, agentOrgId);</span>
<span class="nc" id="L925">				pstmt.setInt(10, partyid);</span>
<span class="nc" id="L926">				pstmt.setDate(11, start);</span>
<span class="nc" id="L927">				pstmt.setDate(12, end);</span>
<span class="nc" id="L928">				logger.debug(&quot; get Agent draw collections details query- ==== -&quot;</span>
						+ pstmt);
<span class="nc" id="L930">				rs2 = pstmt.executeQuery();</span>
			}
<span class="nc" id="L932">			double recTotal = 0.0;</span>
<span class="nc bnc" id="L933" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L934">				collectionBean = new CollectionReportBean();</span>
<span class="nc" id="L935">				collectionBean.setSrNo(count);</span>

<span class="nc" id="L937">				collectionBean.setOrgId(partyid);</span>

<span class="nc" id="L939">				double cash = rs.getDouble(&quot;cash&quot;);</span>
<span class="nc" id="L940">				collectionBean.setCash(FormatNumber.formatNumber(cash));</span>
<span class="nc" id="L941">				double cheque = rs.getDouble(&quot;cheque&quot;);</span>
<span class="nc" id="L942">				collectionBean.setChq(FormatNumber.formatNumber(cheque));</span>
<span class="nc" id="L943">				double credit = rs.getDouble(&quot;credit&quot;);</span>
<span class="nc" id="L944">				collectionBean.setCredit(FormatNumber.formatNumber(credit));</span>
<span class="nc" id="L945">				double debit = rs.getDouble(&quot;debit&quot;);</span>
<span class="nc" id="L946">				collectionBean.setDebit(FormatNumber.formatNumber(debit));</span>
<span class="nc" id="L947">				double chqRet = rs.getDouble(&quot;cheque_ret&quot;);</span>
<span class="nc" id="L948">				collectionBean.setChqRet(FormatNumber.formatNumber(chqRet));</span>

<span class="nc" id="L950">				recTotal = cash + cheque + credit - debit - chqRet;</span>
<span class="nc" id="L951">				collectionBean.setRecTotal(FormatNumber.formatNumber(recTotal));</span>
<span class="nc" id="L952">				totalCash += cash;</span>
<span class="nc" id="L953">				totalChq += cheque;</span>
<span class="nc" id="L954">				totalCredit += credit;</span>
<span class="nc" id="L955">				totalDebit += debit;</span>
<span class="nc" id="L956">				totalChqRet += chqRet;</span>
<span class="nc" id="L957">				totalRecTotal += recTotal;</span>
			}
<span class="nc" id="L959">			double scratchTotal = 0.0;</span>
<span class="nc" id="L960">			double drawTotal = 0.0;</span>
<span class="nc" id="L961">			double clXclTotal = 0.0;</span>
<span class="nc bnc" id="L962" title="All 2 branches missed.">			if (rs3 != null) {</span>
<span class="nc bnc" id="L963" title="All 2 branches missed.">				if (rs3.next()) {</span>
<span class="nc" id="L964">					clXclTotal = rs3.getDouble(&quot;amount&quot;);</span>
				}
			}
<span class="nc bnc" id="L967" title="All 2 branches missed.">			if (rs2 != null) {</span>
<span class="nc bnc" id="L968" title="All 2 branches missed.">				if (rs2.next()) {</span>
<span class="nc" id="L969">					collectionBean.setIsDraw(true);</span>
<span class="nc" id="L970">					double dgSale = rs2.getDouble(&quot;dg_sale&quot;);</span>
<span class="nc" id="L971">					collectionBean.setDrawSale(FormatNumber</span>
							.formatNumber(dgSale));
<span class="nc" id="L973">					double dgSaleRefund = rs2.getDouble(&quot;dg_sale_refund&quot;);</span>
<span class="nc" id="L974">					collectionBean.setDrawSaleRefund(FormatNumber</span>
							.formatNumber(dgSaleRefund));
<span class="nc" id="L976">					double dgPwt = rs2.getDouble(&quot;dg_pwt&quot;);</span>
<span class="nc" id="L977">					collectionBean.setDrawPwt(FormatNumber.formatNumber(dgPwt));</span>
<span class="nc" id="L978">					totalDrawSale += dgSale;</span>
<span class="nc" id="L979">					totalDrawSaleRefund += dgSaleRefund;</span>
<span class="nc" id="L980">					totalDrawPwt += dgPwt;</span>
<span class="nc" id="L981">					drawTotal = dgSale - dgSaleRefund - dgPwt;</span>
<span class="nc" id="L982">					totalDrawTotal += drawTotal;</span>
<span class="nc" id="L983">					collectionBean.setDrawTotal(FormatNumber</span>
							.formatNumber(drawTotal));
				}
			}
<span class="nc bnc" id="L987" title="All 2 branches missed.">			if (rs1 != null) {</span>
<span class="nc bnc" id="L988" title="All 2 branches missed.">				if (rs1.next()) {</span>
<span class="nc" id="L989">					collectionBean.setIsScratch(true);</span>
<span class="nc" id="L990">					double seSale = rs1.getDouble(&quot;se_sale&quot;);</span>
<span class="nc" id="L991">					collectionBean.setScratchSale(FormatNumber</span>
							.formatNumber(seSale));
<span class="nc" id="L993">					double sePwt = rs1.getDouble(&quot;se_pwt&quot;);</span>
<span class="nc" id="L994">					collectionBean.setScratchPwt(FormatNumber</span>
							.formatNumber(sePwt));
<span class="nc" id="L996">					double seSaleRet = rs1.getDouble(&quot;se_sale_ret&quot;);</span>
<span class="nc" id="L997">					collectionBean.setSaleRet(FormatNumber</span>
							.formatNumber(seSaleRet));
<span class="nc" id="L999">					totalScratchSale += seSale;</span>
<span class="nc" id="L1000">					totalSaleRet += seSaleRet;</span>
<span class="nc" id="L1001">					totalScratchPwt += sePwt;</span>
<span class="nc" id="L1002">					scratchTotal = seSale - seSaleRet - sePwt;</span>
<span class="nc" id="L1003">					totalScratchTotal += scratchTotal;</span>
<span class="nc" id="L1004">					collectionBean.setScratchTotal(FormatNumber</span>
							.formatNumber(scratchTotal));
				}
			}

<span class="nc" id="L1009">			double grandTotal = drawTotal + scratchTotal - recTotal</span>
					+ clXclTotal;

<span class="nc" id="L1012">			collectionBean.setOpenBal(FormatNumber.formatNumber(grandTotal));</span>

<span class="nc" id="L1014">			collectionBean.setGrandTotal(FormatNumber.formatNumber(grandTotal));</span>

<span class="nc" id="L1016">			totalGrandTotal += grandTotal;</span>
<span class="nc" id="L1017">			logger.debug(&quot;this is a shit: &quot; + totalGrandTotal);</span>
<span class="nc" id="L1018">			logger.debug(&quot;this is a shit2: &quot; + grandTotal);</span>
<span class="nc" id="L1019">			list.add(collectionBean);</span>
<span class="nc" id="L1020">			count += 1;</span>

			/*
			 * if (totalOpenBal != null) { totalGrandTotal +=
			 * Double.parseDouble(totalOpenBal); }
			 */

<span class="nc" id="L1027">		} catch (SQLException e) {</span>
<span class="nc" id="L1028">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1030">			try {</span>
<span class="nc bnc" id="L1031" title="All 6 branches missed.">				if (pstmt != null) {</span>
<span class="nc" id="L1032">					pstmt.close();</span>
				}
<span class="nc bnc" id="L1034" title="All 12 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L1035">					con.close();</span>
				}
<span class="nc" id="L1037">			} catch (SQLException e) {</span>
<span class="nc" id="L1038">				e.printStackTrace();</span>
<span class="nc" id="L1039">			}</span>
<span class="nc" id="L1040">		}</span>

<span class="nc" id="L1042">		return list;</span>
	}

	public Map&lt;Integer, Double&gt; getRetailerOpeningBalance(Timestamp startDate,
			Timestamp endDate, Connection con, boolean isDG, boolean isSE,
			boolean isCS, int retOrgId, int agentOrgId) throws LMSException {
<span class="nc" id="L1048">		Map&lt;Integer, Double&gt; myMap = new TreeMap&lt;Integer, Double&gt;();</span>

<span class="nc" id="L1050">		List&lt;CollectionReportBean&gt; tempBeanList = getRetailerCollectionDetail(</span>
				startDate, endDate, retOrgId, agentOrgId, isDG, isSE, isCS);
<span class="nc" id="L1052">		double tempOpenBalTot = 0.0;</span>
<span class="nc" id="L1053">		Iterator&lt;CollectionReportBean&gt; it = tempBeanList.iterator();</span>
<span class="nc bnc" id="L1054" title="All 2 branches missed.">		while (it.hasNext()) {</span>
<span class="nc" id="L1055">			CollectionReportBean tempBean = it.next();</span>
<span class="nc" id="L1056">			myMap.put(new Integer(tempBean.getOrgId()),</span>
					Double.parseDouble(tempBean.getOpenBal()));
<span class="nc" id="L1058">			tempOpenBalTot += Double.parseDouble(tempBean.getOpenBal());</span>
<span class="nc" id="L1059">		}</span>

<span class="nc" id="L1061">		return myMap;</span>
	}

	public Map&lt;String, CustomTransactionReportBean&gt; collectionTransactionWiseWithOpeningBal(
			Timestamp deployDate, Timestamp startDate, Timestamp endDate,
			int retOrgId, int agentOrgId, boolean isDG, boolean isSE,
			boolean isCS, boolean isSLE, boolean isIW, boolean isVS,
			ReportStatusBean reportStatusBean) throws LMSException {
<span class="nc" id="L1069">		Connection con = null;</span>
<span class="nc bnc" id="L1070" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L1071">			return null;</span>
		}
<span class="nc" id="L1073">		Map&lt;String, CollectionReportOverAllBean&gt; retMapOpenningBalance = new LinkedHashMap&lt;String, CollectionReportOverAllBean&gt;();</span>
<span class="nc" id="L1074">		Map&lt;String, CustomTransactionReportBean&gt; retailerMap = new LinkedHashMap&lt;String, CustomTransactionReportBean&gt;();</span>
<span class="nc" id="L1075">		Map&lt;Integer, Double&gt; mapForOpenBal = null;</span>
		// Map&lt;String, CollectionReportOverAllBean&gt; resultMap = new
		// LinkedHashMap&lt;String, CollectionReportOverAllBean&gt;();
<span class="nc" id="L1078">		CollectionReportOverAllBean collBean = null;</span>
<span class="nc" id="L1079">		Double openingBalance = 0.0;</span>
		try {
<span class="nc" id="L1081">			double openBal = 0.0;</span>

<span class="nc bnc" id="L1083" title="All 4 branches missed.">			if (&quot;NO&quot;.equals(Utility.getPropertyValue(&quot;IS_DATA_FROM_REPLICA&quot;))</span>
					|| &quot;MAIN_DB&quot;.equals(reportStatusBean.getReportingFrom()))
<span class="nc" id="L1085">				con = DBConnect.getConnection();</span>
			else
<span class="nc" id="L1087">				con = DBConnectReplica.getConnection();</span>

			//String agtOrgQry = &quot;select name,organization_id from st_lms_organization_master where organization_type='AGENT' and organization_id=&quot;+agtOrgId;
			//pstmt = con.prepareStatement(agtOrgQry);
			//rsRetOrg = pstmt.executeQuery();

<span class="nc" id="L1093">			Calendar startCal = Calendar.getInstance();</span>
<span class="nc" id="L1094">			Calendar endCal = Calendar.getInstance();</span>
<span class="nc" id="L1095">			Calendar nextCal = Calendar.getInstance();</span>
<span class="nc" id="L1096">			startCal.setTimeInMillis(startDate.getTime());</span>
<span class="nc" id="L1097">			endCal.setTimeInMillis(endDate.getTime());</span>
<span class="nc" id="L1098">			nextCal.setTimeInMillis(startDate.getTime());</span>
<span class="nc" id="L1099">			SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
			//nextCal.add(Calendar.DAY_OF_MONTH, 1);
		//	startDate = new Timestamp(sdf.parse(sdf.format(startCal.getTime())).getTime());
		//	endDate = new Timestamp(sdf.parse(sdf.format(endCal.getTime())).getTime());
			
			
			
			/*mapForOpenBal = getRetailerOpeningBalance(deployDate, startDate, con, isDG, isSE, isCS,
					retOrgId,agentOrgId);*/
			
			/*System.out.println(&quot;mapForOpenBal**&quot;+mapForOpenBal);*/
<span class="nc" id="L1110">			System.out.println(&quot;***agentMap***&quot; + retailerMap);</span>
<span class="nc" id="L1111">			RetailerOpeningBalanceHelper opehelper = new RetailerOpeningBalanceHelper();</span>
<span class="nc" id="L1112">			openBal = opehelper.getRetailerOpeningBalIncludingCLXCL(deployDate,startDate, retOrgId,</span>
					agentOrgId, con);

			/*
			 * System.out.println(&quot;opening Balance::&quot;);
			 * openBal=mapForOpenBal.get(retOrgId);
			 */

<span class="nc" id="L1120">			CustomTransactionReportBean bean1 = new CustomTransactionReportBean();</span>
<span class="nc" id="L1121">			bean1.setCurrentBalance(openBal);</span>
<span class="nc" id="L1122">			bean1.setGameName(&quot;Opening Balance(including CL/XCL) :&quot;);</span>

<span class="nc" id="L1124">			retailerMap.put(&quot;openBalance&quot;, bean1);</span>
<span class="nc" id="L1125">			collectionTransactionWise(startDate, endDate, con, isDG, isSE, isCS, isSLE, isIW, isVS, retailerMap, retOrgId);</span>

<span class="nc" id="L1127">			Iterator&lt;Map.Entry&lt;String, CustomTransactionReportBean&gt;&gt; itr1 = retailerMap</span>
					.entrySet().iterator();
<span class="nc bnc" id="L1129" title="All 2 branches missed.">			while (itr1.hasNext()) {</span>
<span class="nc" id="L1130">				Map.Entry&lt;String, CustomTransactionReportBean&gt; pair = itr1</span>
						.next();
<span class="nc" id="L1132">				CustomTransactionReportBean bean = pair.getValue();</span>
<span class="nc" id="L1133">				openBal = openBal + bean.getAmount();</span>

<span class="nc" id="L1135">				bean.setCurrentBalance(openBal);</span>

				/*
				 * if(&quot;CL&quot;.equalsIgnoreCase(bean.getTransactionType()) ||
				 * &quot;XCL&quot;.equalsIgnoreCase(bean.getTransactionType())){
				 * openBal=openBal+bean.getAmount();
				 * 
				 * bean.setCurrentBalance(openBal); }
				 * 
				 * 
				 * if(&quot;CS_SALE&quot;.equalsIgnoreCase(bean.getTransactionType())){
				 * openBal=openBal+bean.getAmount();
				 * 
				 * bean.setCurrentBalance(openBal); }
				 * if(&quot;CS_CANCEL_SERVER&quot;.equalsIgnoreCase
				 * (bean.getTransactionType()) ||
				 * &quot;CS_CANCEL_RET&quot;.equalsIgnoreCase(bean.getTransactionType())){
				 * openBal=openBal + bean.getAmount();
				 * bean.setCurrentBalance(openBal); }
				 * 
				 * if(&quot;SALE&quot;.equalsIgnoreCase(bean.getTransactionType())){
				 * openBal=openBal+bean.getAmount();
				 * 
				 * bean.setCurrentBalance(openBal); }else
				 * if(&quot;SALE_RET&quot;.equalsIgnoreCase(bean.getTransactionType())){
				 * openBal=openBal + bean.getAmount();
				 * bean.setCurrentBalance(openBal); }else
				 * if(&quot;PWT&quot;.equalsIgnoreCase(bean.getTransactionType())){
				 * openBal=openBal + bean.getAmount();
				 * bean.setCurrentBalance(openBal); }
				 * if(&quot;CHEQUE&quot;.equalsIgnoreCase(bean.getTransactionType()) ||
				 * &quot;CR_NOTE_CASH&quot;.equalsIgnoreCase(bean.getTransactionType()) ||
				 * &quot;CASH&quot;.equalsIgnoreCase(bean.getTransactionType())
				 * ||&quot;CR_NOTE&quot;.equalsIgnoreCase(bean.getTransactionType())){
				 * openBal=openBal+bean.getAmount();
				 * bean.setCurrentBalance(openBal); } if(
				 * &quot;CHQ_BOUNCE&quot;.equalsIgnoreCase(bean.getTransactionType()) ||
				 * &quot;DR_NOTE&quot;.equalsIgnoreCase(bean.getTransactionType())
				 * ||&quot;DR_NOTE_CASH&quot;.equalsIgnoreCase(bean.getTransactionType())
				 * ){ openBal=openBal + bean.getAmount();
				 * 
				 * bean.setCurrentBalance(openBal); }
				 * if(&quot;DG_SALE&quot;.equalsIgnoreCase(bean.getTransactionType())){
				 * openBal=openBal+bean.getAmount();
				 * 
				 * bean.setCurrentBalance(openBal); }
				 * if(&quot;DG_REFUND_CANCEL&quot;.equalsIgnoreCase
				 * (bean.getTransactionType()) ||
				 * &quot;DG_REFUND_FAILED&quot;.equalsIgnoreCase
				 * (bean.getTransactionType())){
				 * openBal=openBal+bean.getAmount();
				 * bean.setCurrentBalance(openBal); }
				 * if(&quot;DG_PWT_AUTO&quot;.equalsIgnoreCase(bean.getTransactionType())
				 * || &quot;DG_PWT&quot;.equalsIgnoreCase(bean.getTransactionType()) ||
				 * &quot;DG_PWT_PLR&quot;.equalsIgnoreCase(bean.getTransactionType())){
				 * openBal=openBal+bean.getAmount();
				 * bean.setCurrentBalance(openBal); }
				 */

<span class="nc" id="L1194">			}</span>

<span class="nc" id="L1196">		} catch (Exception e) {</span>
<span class="nc" id="L1197">			e.printStackTrace();</span>
<span class="nc" id="L1198">			throw new LMSException(</span>
					&quot;Error in report collectionAgentWiseWithOpeningBal&quot;);
		} finally {
<span class="nc" id="L1201">			try {</span>
<span class="nc" id="L1202">				con.close();</span>
<span class="nc" id="L1203">			} catch (SQLException e) {</span>
<span class="nc" id="L1204">				e.printStackTrace();</span>
<span class="nc" id="L1205">			}</span>
<span class="nc" id="L1206">		}</span>
<span class="nc" id="L1207">		return retailerMap;</span>
	}

	public Map&lt;String, String&gt; getOrgMap(String orgType) {
<span class="nc" id="L1211">		Connection con = null;</span>
<span class="nc" id="L1212">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1213">		Map&lt;String, String&gt; orgMap = new LinkedHashMap&lt;String, String&gt;();</span>
		try {
<span class="nc" id="L1215">			con = DBConnect.getConnection();</span>
<span class="nc" id="L1216">			String chkService = &quot;select name,organization_id from st_lms_organization_master where organization_type=? order by name&quot;;</span>
<span class="nc" id="L1217">			pstmt = con.prepareStatement(chkService);</span>
<span class="nc" id="L1218">			pstmt.setString(1, orgType);</span>
<span class="nc" id="L1219">			ResultSet rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1220" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1221">				orgMap.put(rs.getString(&quot;organization_id&quot;),</span>
						rs.getString(&quot;name&quot;));
			}
<span class="nc" id="L1224">		} catch (Exception e) {</span>
<span class="nc" id="L1225">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1227">			try {</span>
<span class="nc" id="L1228">				con.close();</span>
<span class="nc" id="L1229">			} catch (SQLException e) {</span>
<span class="nc" id="L1230">				e.printStackTrace();</span>
<span class="nc" id="L1231">			}</span>
<span class="nc" id="L1232">		}</span>
<span class="nc" id="L1233">		return orgMap;</span>
	}

	public String getOrgAdd(int orgId, ReportStatusBean reportStatusBean) throws LMSException {
<span class="nc" id="L1237">		String orgAdd = &quot;&quot;;</span>
<span class="nc" id="L1238">		Connection con = null;</span>

<span class="nc bnc" id="L1240" title="All 4 branches missed.">		if(&quot;NO&quot;.equals(Utility.getPropertyValue(&quot;IS_DATA_FROM_REPLICA&quot;))</span>
				|| &quot;MAIN_DB&quot;.equals(reportStatusBean.getReportingFrom()))
<span class="nc" id="L1242">			con = DBConnect.getConnection();</span>
		else
<span class="nc" id="L1244">			con = DBConnectReplica.getConnection();</span>

<span class="nc" id="L1246">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1247">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L1249">			pstmt = con</span>
					.prepareStatement(&quot;select addr_line1, addr_line2, city from st_lms_organization_master where organization_id = ?&quot;);
<span class="nc" id="L1251">			pstmt.setInt(1, orgId);</span>
<span class="nc" id="L1252">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L1253">			System.out.println(pstmt);</span>
<span class="nc bnc" id="L1254" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1255">				orgAdd = rs.getString(&quot;addr_line1&quot;) + &quot;, &quot;</span>
						+ rs.getString(&quot;addr_line2&quot;) + &quot;, &quot;
						+ rs.getString(&quot;city&quot;);
			}
<span class="nc" id="L1259">		} catch (SQLException e) {</span>
<span class="nc" id="L1260">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L1261">			e.printStackTrace();</span>
<span class="nc" id="L1262">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L1264">			try {</span>
<span class="nc bnc" id="L1265" title="All 8 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L1266">					con.close();</span>
				}
<span class="nc" id="L1268">			} catch (SQLException e) {</span>
<span class="nc" id="L1269">				logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L1270">				e.printStackTrace();</span>
<span class="nc" id="L1271">				throw new LMSException(e);</span>
<span class="nc" id="L1272">			}</span>
		}
<span class="nc" id="L1274">		return orgAdd;</span>
	}

	public double getOpenBal() {
<span class="nc" id="L1278">		return openningBalance;</span>
	}

	public int getOrgId(int userId) throws LMSException {
<span class="nc" id="L1282">		int orgId = 0;</span>
<span class="nc" id="L1283">		Connection con = null;</span>
<span class="nc" id="L1284">		con = DBConnect.getConnection();</span>
<span class="nc" id="L1285">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1286">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L1288">			pstmt = con</span>
					.prepareStatement(&quot;select organization_id from st_lms_user_master where user_id=?&quot;);
<span class="nc" id="L1290">			pstmt.setInt(1, userId);</span>
<span class="nc" id="L1291">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L1292">			System.out.println(pstmt);</span>
<span class="nc bnc" id="L1293" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1294">				orgId = rs.getInt(&quot;organization_id&quot;);</span>

			}
<span class="nc" id="L1297">		} catch (SQLException e) {</span>
<span class="nc" id="L1298">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L1299">			e.printStackTrace();</span>
<span class="nc" id="L1300">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L1302">			try {</span>
<span class="nc bnc" id="L1303" title="All 8 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L1304">					con.close();</span>
				}
<span class="nc" id="L1306">			} catch (SQLException e) {</span>
<span class="nc" id="L1307">				logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L1308">				e.printStackTrace();</span>
<span class="nc" id="L1309">				throw new LMSException(e);</span>
<span class="nc" id="L1310">			}</span>
		}
<span class="nc" id="L1312">		return orgId;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>