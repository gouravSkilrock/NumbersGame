<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CompleteCollectionReportMRPHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.reportsMgmt.common</a> &gt; <span class="el_source">CompleteCollectionReportMRPHelper.java</span></div><h1>CompleteCollectionReportMRPHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.reportsMgmt.common;

import java.sql.CallableStatement;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Timestamp;
import java.util.Calendar;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.Map;
import java.util.TreeMap;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.beans.CompleteCollectionBean;
import com.skilrock.lms.beans.ReportStatusBean;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.filter.LMSFilterDispatcher;

<span class="nc" id="L24">public class CompleteCollectionReportMRPHelper implements</span>
		ICompleteCollectionReportHelper {
<span class="nc" id="L26">	static Log logger = LogFactory</span>
			.getLog(CompleteCollectionReportMRPHelper.class);
<span class="nc" id="L28">	StringBuilder dates = null;</span>

	public Map&lt;String, Double&gt; agentDirectPlayerPwt(Timestamp startDate,
			Timestamp endDate, int agtOrgId) {
<span class="nc" id="L32">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L33">		ResultSet rs = null;</span>
<span class="nc" id="L34">		Map&lt;String, Double&gt; dirPlrPwtMap = new LinkedHashMap&lt;String, Double&gt;();</span>
		// Draw Direct Player Qry
		try {
<span class="nc" id="L37">			CallableStatement cstmt = con</span>
					.prepareCall(&quot;{call fetchDrawDirectPlyPwtofAgent(?,?,?)}&quot;);
<span class="nc" id="L39">			cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L40">			cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L41">			cstmt.setInt(3, agtOrgId);</span>
<span class="nc" id="L42">			rs = cstmt.executeQuery();</span>
<span class="nc bnc" id="L43" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L44">				dirPlrPwtMap.put(&quot;DG&quot;, rs.getDouble(&quot;pwtDir&quot;));</span>
			} else {
<span class="nc" id="L46">				dirPlrPwtMap.put(&quot;DG&quot;, 0.0);</span>
			}
			// Scratch Direct Player Qry

<span class="nc" id="L50">			cstmt = con</span>
					.prepareCall(&quot;{call fetchScratchDirectPlyPwtofAgent(?,?,?)}&quot;);
<span class="nc" id="L52">			cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L53">			cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L54">			cstmt.setInt(3, agtOrgId);</span>
<span class="nc" id="L55">			rs = cstmt.executeQuery();</span>
<span class="nc bnc" id="L56" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L57">				dirPlrPwtMap.put(&quot;SE&quot;, rs.getDouble(&quot;pwtDir&quot;));</span>
			} else {
<span class="nc" id="L59">				dirPlrPwtMap.put(&quot;SE&quot;, 0.0);</span>
			}
<span class="nc" id="L61">			DBConnect.closeCon(con);</span>
<span class="nc" id="L62">		} catch (Exception e) {</span>
<span class="nc" id="L63">			e.printStackTrace();</span>
<span class="nc" id="L64">		}</span>
<span class="nc" id="L65">		return dirPlrPwtMap;</span>
	}

	public Map&lt;String, Boolean&gt; checkAvailableService() {
<span class="nc" id="L69">		Connection con = null;</span>
<span class="nc" id="L70">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L71">		Map&lt;String, Boolean&gt; serMap = new HashMap&lt;String, Boolean&gt;();</span>
		try {
<span class="nc" id="L73">			con = DBConnect.getConnection();</span>
<span class="nc" id="L74">			String chkService = &quot;select service_code,status from st_lms_service_master where service_code!='MGMT'&quot;;</span>
<span class="nc" id="L75">			pstmt = con.prepareStatement(chkService);</span>
<span class="nc" id="L76">			ResultSet rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L78">				serMap.put(rs.getString(&quot;service_code&quot;), &quot;ACTIVE&quot;.equals(rs</span>
						.getString(&quot;status&quot;)));
			}
<span class="nc" id="L81">		} catch (Exception e) {</span>
<span class="nc" id="L82">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L84">			try {</span>
<span class="nc" id="L85">				con.close();</span>
<span class="nc" id="L86">			} catch (SQLException e) {</span>
<span class="nc" id="L87">				e.printStackTrace();</span>
<span class="nc" id="L88">			}</span>
<span class="nc" id="L89">		}</span>
<span class="nc" id="L90">		return serMap;</span>
	}

	public Map&lt;String, CompleteCollectionBean&gt; collectionAgentWise(
			Timestamp startDate, Timestamp endDate, Connection con,
			boolean isDG, boolean isSE, boolean isCS, boolean isOLA) {
<span class="nc" id="L96">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L97">		ResultSet rsGame = null;</span>
<span class="nc" id="L98">		ResultSet rs = null;</span>
<span class="nc" id="L99">		ResultSet rsRetOrg = null;</span>
<span class="nc" id="L100">		Map&lt;String, CompleteCollectionBean&gt; agtMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L101">		CompleteCollectionBean collBean = null;</span>
		// for Draw Game

<span class="nc bnc" id="L104" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L105">			return agtMap;</span>
		}

		// for scratch game
		try {

			// Get All Agent
<span class="nc" id="L112">			String agtOrgQry = &quot;select name,organization_id from st_lms_organization_master where organization_type='AGENT' order by name&quot;;</span>
<span class="nc" id="L113">			pstmt = con.prepareStatement(agtOrgQry);</span>
<span class="nc" id="L114">			rsRetOrg = pstmt.executeQuery();</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">			while (rsRetOrg.next()) {</span>
<span class="nc" id="L116">				collBean = new CompleteCollectionBean();</span>
<span class="nc" id="L117">				collBean.setOrgName(rsRetOrg.getString(&quot;name&quot;));</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">				if (isDG) {</span>
<span class="nc" id="L119">					collBean.setDrawSale(0.0);</span>
<span class="nc" id="L120">					collBean.setDrawPwt(0.0);</span>
<span class="nc" id="L121">					collBean.setDrawCancel(0.0);</span>
<span class="nc" id="L122">					collBean.setDrawDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L124" title="All 2 branches missed.">				if (isSE) {</span>
<span class="nc" id="L125">					collBean.setScratchSale(0.0);</span>
<span class="nc" id="L126">					collBean.setScratchPwt(0.0);</span>
<span class="nc" id="L127">					collBean.setScratchDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L129" title="All 2 branches missed.">				if (isCS) {</span>
<span class="nc" id="L130">					collBean.setCSSale(0.0);</span>
<span class="nc" id="L131">					collBean.setCSCancel(0.0);</span>
				}
<span class="nc" id="L133">				agtMap.put(rsRetOrg.getString(&quot;organization_id&quot;), collBean);</span>
			}
<span class="nc bnc" id="L135" title="All 2 branches missed.">			if (isDG) {</span>
				// Game Master Query
<span class="nc" id="L137">				String gameQry = &quot;select game_id from st_dg_game_master&quot;;</span>
<span class="nc" id="L138">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L139">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L141">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L142">					CallableStatement cstmt = con</span>
							.prepareCall(&quot;{call drawCollectionAgentWisePerGame(?,?,?)}&quot;);
<span class="nc" id="L144">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L145">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L146">					cstmt.setInt(3, gameNo);</span>
<span class="nc" id="L147">					rs = cstmt.executeQuery();</span>
<span class="nc" id="L148">					String agtOrgId = null;</span>
<span class="nc" id="L149">					double sale = 0, cancel = 0, pwt = 0;</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L151">						agtOrgId = rs.getString(&quot;parent_id&quot;);</span>
<span class="nc" id="L152">						sale = rs.getDouble(&quot;sale&quot;);</span>
<span class="nc" id="L153">						cancel = rs.getDouble(&quot;cancel&quot;);</span>
<span class="nc" id="L154">						pwt = rs.getDouble(&quot;pwt&quot;);</span>
<span class="nc" id="L155">						agtMap.get(agtOrgId).setDrawSale(</span>
								agtMap.get(agtOrgId).getDrawSale() + sale);
<span class="nc" id="L157">						agtMap.get(agtOrgId).setDrawCancel(</span>
								agtMap.get(agtOrgId).getDrawCancel() + cancel);
<span class="nc" id="L159">						agtMap.get(agtOrgId).setDrawPwt(</span>
								agtMap.get(agtOrgId).getDrawPwt() + pwt);
<span class="nc" id="L161">						agtMap.get(agtOrgId).setDrawDirPlyPwt(</span>
								agtMap.get(agtOrgId).getDrawDirPlyPwt()
										+ rs.getDouble(&quot;pwtDir&quot;));
					}
<span class="nc" id="L165">				}</span>
			}
<span class="nc bnc" id="L167" title="All 2 branches missed.">			if (isSE) {</span>
				// Game Master Query
<span class="nc" id="L169">				String gameQry = &quot;select game_id from st_se_game_master&quot;;</span>
<span class="nc" id="L170">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L171">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L173">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L174">					CallableStatement cstmt = con</span>
							.prepareCall(&quot;{call scratchCollectionAgentWisePerGame(?,?,?)}&quot;);
<span class="nc" id="L176">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L177">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L178">					cstmt.setInt(3, gameNo);</span>
<span class="nc" id="L179">					rs = cstmt.executeQuery();</span>
<span class="nc" id="L180">					String agtOrgId = null;</span>
<span class="nc" id="L181">					double sale = 0, cancel = 0, pwt = 0;</span>
<span class="nc bnc" id="L182" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L183">						agtOrgId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L184">						sale = rs.getDouble(&quot;sale&quot;);</span>
<span class="nc" id="L185">						cancel = rs.getDouble(&quot;cancel&quot;);</span>
<span class="nc" id="L186">						pwt = rs.getDouble(&quot;pwt&quot;);</span>
<span class="nc" id="L187">						agtMap.get(agtOrgId).setScratchSale(</span>
								agtMap.get(agtOrgId).getScratchSale()
										+ (sale - cancel));
<span class="nc" id="L190">						agtMap.get(agtOrgId).setScratchPwt(</span>
								agtMap.get(agtOrgId).getScratchPwt() + pwt);
<span class="nc" id="L192">						agtMap.get(agtOrgId).setScratchDirPlyPwt(</span>
								agtMap.get(agtOrgId).getScratchDirPlyPwt()
										+ rs.getDouble(&quot;pwtDir&quot;));
					}
<span class="nc" id="L196">				}</span>
			}
<span class="nc bnc" id="L198" title="All 2 branches missed.">			if (isCS) {</span>

				// category Master Query
<span class="nc" id="L201">				String catQry = &quot;select category_id from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L202">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L203">				rsGame = prodPstmt.executeQuery();</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L205">					int catId = rsGame.getInt(&quot;category_id&quot;);</span>
<span class="nc" id="L206">					CallableStatement cstmt = con</span>
							.prepareCall(&quot;{call csCollectionAgentWisePerCategory(?,?,?)}&quot;);
<span class="nc" id="L208">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L209">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L210">					cstmt.setInt(3, catId);</span>
<span class="nc" id="L211">					rs = cstmt.executeQuery();</span>
<span class="nc" id="L212">					String agtOrgId = null;</span>
<span class="nc" id="L213">					double sale = 0, cancel = 0;</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L215">						agtOrgId = rs.getString(&quot;parent_id&quot;);</span>
<span class="nc" id="L216">						sale = rs.getDouble(&quot;sale&quot;);</span>
<span class="nc" id="L217">						cancel = rs.getDouble(&quot;cancel&quot;);</span>
<span class="nc" id="L218">						agtMap.get(agtOrgId).setCSSale(</span>
								agtMap.get(agtOrgId).getCSSale() + sale);
<span class="nc" id="L220">						agtMap.get(agtOrgId).setCSCancel(</span>
								agtMap.get(agtOrgId).getCSCancel() + cancel);
					}
<span class="nc" id="L223">				}</span>

			}
<span class="nc" id="L226">		} catch (Exception e) {</span>
<span class="nc" id="L227">			e.printStackTrace();</span>
<span class="nc" id="L228">		}</span>
<span class="nc" id="L229">		return agtMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionAgentWiseExpand(
			Timestamp startDate, Timestamp endDate, Connection con,
			boolean isDG, boolean isSE, boolean isCS, boolean isOLA) {
<span class="nc" id="L235">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L236">		ResultSet rsGame = null;</span>
<span class="nc" id="L237">		ResultSet rs = null;</span>
<span class="nc" id="L238">		ResultSet rsRetOrg = null;</span>
<span class="nc" id="L239">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; serGameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;();</span>
<span class="nc" id="L240">		Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt; gameAgtMap = null;</span>
		// for Draw Game
<span class="nc bnc" id="L242" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L243">			return serGameAgtMap;</span>
		}
		try {

			// Get All Agent
<span class="nc" id="L248">			String agtOrgQry = &quot;select name,organization_id from st_lms_organization_master where organization_type='AGENT' order by name&quot;;</span>
<span class="nc" id="L249">			pstmt = con.prepareStatement(agtOrgQry);</span>
<span class="nc" id="L250">			rsRetOrg = pstmt.executeQuery();</span>

<span class="nc bnc" id="L252" title="All 2 branches missed.">			if (isDG) {</span>
<span class="nc" id="L253">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>

				// Game Master Query
<span class="nc" id="L256">				String gameQry = &quot;select game_id,game_name from st_dg_game_master&quot;;</span>
<span class="nc" id="L257">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L258">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L259" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L260">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L261">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L262">					gameMap.putAll(getAgentMap(rsRetOrg, isDG, isSE, isCS,</span>
							isOLA));
<span class="nc" id="L264">					CallableStatement cstmt = con</span>
							.prepareCall(&quot;{call drawCollectionAgentWisePerGame(?,?,?)}&quot;);
<span class="nc" id="L266">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L267">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L268">					cstmt.setInt(3, gameId);</span>
<span class="nc" id="L269">					rs = cstmt.executeQuery();</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L271">						String agtId = rs.getString(&quot;parent_id&quot;);</span>
<span class="nc" id="L272">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L273">						gameMap.get(agtId)</span>
								.setDrawCancel(rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L275">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>
<span class="nc" id="L276">						gameMap.get(agtId).setDrawDirPlyPwt(</span>
								rs.getDouble(&quot;pwtDir&quot;));

<span class="nc" id="L279">					}</span>
<span class="nc" id="L280">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L281">				}</span>

<span class="nc" id="L283">				serGameAgtMap.put(&quot;DG&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L285" title="All 2 branches missed.">			if (isSE) {</span>
<span class="nc" id="L286">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
				// Game Master Query
<span class="nc" id="L288">				String gameQry = &quot;select game_id,game_name from st_se_game_master&quot;;</span>
<span class="nc" id="L289">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L290">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L292">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L293">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L294">					gameMap.putAll(getAgentMap(rsRetOrg, isDG, isSE, isCS,</span>
							isOLA));
<span class="nc" id="L296">					CallableStatement cstmt = con</span>
							.prepareCall(&quot;{call scratchCollectionAgentWisePerGame(?,?,?)}&quot;);
<span class="nc" id="L298">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L299">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L300">					cstmt.setInt(3, gameNo);</span>
<span class="nc" id="L301">					rs = cstmt.executeQuery();</span>
<span class="nc" id="L302">					double sale = 0, cancel = 0, pwt = 0;</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L304">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L305">						sale = rs.getDouble(&quot;sale&quot;);</span>
<span class="nc" id="L306">						cancel = rs.getDouble(&quot;cancel&quot;);</span>
<span class="nc" id="L307">						pwt = rs.getDouble(&quot;pwt&quot;);</span>
<span class="nc" id="L308">						gameMap.get(agtId).setDrawSale(sale - cancel);</span>
<span class="nc" id="L309">						gameMap.get(agtId).setDrawPwt(pwt);</span>
<span class="nc" id="L310">						gameMap.get(agtId).setScratchDirPlyPwt(</span>
								rs.getDouble(&quot;pwtDir&quot;));
<span class="nc" id="L312">					}</span>
<span class="nc" id="L313">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L314">				}</span>
<span class="nc" id="L315">				serGameAgtMap.put(&quot;SE&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L317" title="All 2 branches missed.">			if (isCS) {</span>

<span class="nc" id="L319">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>

				// Game Master Query
<span class="nc" id="L322">				String catQry = &quot;select category_id,category_code from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L323">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L324">				rsGame = prodPstmt.executeQuery();</span>
<span class="nc bnc" id="L325" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L326">					int catId = rsGame.getInt(&quot;category_id&quot;);</span>
<span class="nc" id="L327">					Map&lt;String, CompleteCollectionBean&gt; prodMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L328">					prodMap.putAll(getAgentMap(rsRetOrg, isDG, isSE, isCS,</span>
							isOLA));
<span class="nc" id="L330">					CallableStatement cstmt = con</span>
							.prepareCall(&quot;{call csCollectionAgentWisePerCategory(?,?,?)}&quot;);
<span class="nc" id="L332">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L333">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L334">					cstmt.setInt(3, catId);</span>
<span class="nc" id="L335">					rs = cstmt.executeQuery();</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L337">						String agtId = rs.getString(&quot;parent_id&quot;);</span>
<span class="nc" id="L338">						prodMap.get(agtId).setCSSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L339">						prodMap.get(agtId).setCSCancel(rs.getDouble(&quot;cancel&quot;));</span>
<span class="nc" id="L340">					}</span>
<span class="nc" id="L341">					gameAgtMap.put(rsGame.getString(&quot;category_code&quot;), prodMap);</span>
<span class="nc" id="L342">				}</span>

<span class="nc" id="L344">				serGameAgtMap.put(&quot;CS&quot;, gameAgtMap);</span>

			}
<span class="nc" id="L347">			System.out.println(serGameAgtMap);</span>
<span class="nc" id="L348">		} catch (Exception e) {</span>
<span class="nc" id="L349">			e.printStackTrace();</span>
<span class="nc" id="L350">		}</span>
<span class="nc" id="L351">		return serGameAgtMap;</span>
	}

	public Map&lt;String, CompleteCollectionBean&gt; collectionDayWise(
			Timestamp startDate, Timestamp endDate, Connection con,
			boolean isDG, boolean isSE, boolean isCS, boolean isOLA,
			String viewBy, int orgId) {
<span class="nc" id="L358">		ResultSet rsGame = null;</span>
<span class="nc" id="L359">		ResultSet rs = null;</span>
<span class="nc" id="L360">		Map&lt;String, CompleteCollectionBean&gt; dateMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L361">		CompleteCollectionBean collBean = null;</span>
<span class="nc" id="L362">		String date = null;</span>
<span class="nc" id="L363">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L364">		StringBuilder unionQuery = null;</span>
<span class="nc" id="L365">		StringBuilder mainQuery = null;</span>

<span class="nc bnc" id="L367" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L368">			return dateMap;</span>
		}

		try {

			// Get All Agent
<span class="nc" id="L374">			Calendar startCal = Calendar.getInstance();</span>
<span class="nc" id="L375">			startCal.setTime(startDate);</span>

<span class="nc" id="L377">			Calendar endCal = Calendar.getInstance();</span>
<span class="nc" id="L378">			endCal.setTime(endDate);</span>
<span class="nc bnc" id="L379" title="All 2 branches missed.">			while (startCal.getTime().before(endCal.getTime())) {</span>
<span class="nc" id="L380">				date = new java.sql.Date(startCal.getTimeInMillis()).toString();</span>
<span class="nc" id="L381">				collBean = new CompleteCollectionBean();</span>
<span class="nc" id="L382">				collBean.setOrgName(date);</span>
<span class="nc" id="L383">				dateMap.put(date, collBean);</span>
<span class="nc" id="L384">				startCal.setTimeInMillis(startCal.getTimeInMillis() + 24 * 60</span>
						* 60 * 1000);
<span class="nc bnc" id="L386" title="All 2 branches missed.">				if (isDG) {</span>
<span class="nc" id="L387">					collBean.setDrawSale(0.0);</span>
<span class="nc" id="L388">					collBean.setDrawPwt(0.0);</span>
<span class="nc" id="L389">					collBean.setDrawCancel(0.0);</span>
<span class="nc" id="L390">					collBean.setDrawDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L392" title="All 2 branches missed.">				if (isSE) {</span>
<span class="nc" id="L393">					collBean.setScratchSale(0.0);</span>
<span class="nc" id="L394">					collBean.setScratchPwt(0.0);</span>
<span class="nc" id="L395">					collBean.setScratchDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L397" title="All 2 branches missed.">				if (isCS) {</span>
<span class="nc" id="L398">					collBean.setCSSale(0.0);</span>
<span class="nc" id="L399">					collBean.setCSCancel(0.0);</span>
				}
			}
<span class="nc" id="L402">			CallableStatement cstmt = con</span>
					.prepareCall(&quot;{call fillDateTable(?,?)}&quot;);
<span class="nc" id="L404">			cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L405">			cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L406">			cstmt.executeQuery();</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">			if (isDG) {</span>
				// Game Master Query
<span class="nc" id="L409">				String gameQry = &quot;select game_id from st_dg_game_master&quot;;</span>
<span class="nc" id="L410">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L411">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L412">				String dgSaleCol = &quot;&quot;;</span>
<span class="nc" id="L413">				String dgPwtCol = &quot;&quot;;</span>
<span class="nc" id="L414">				String addDrawQry = &quot;&quot;;</span>
<span class="nc" id="L415">				String addDirPlrQry = &quot;&quot;;</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L417">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>

<span class="nc bnc" id="L419" title="All 4 branches missed.">					if (viewBy.equalsIgnoreCase(&quot;Agent&quot;) &amp;&amp; orgId != 0) {</span>
<span class="nc" id="L420">						dgSaleCol = &quot;mrp_amt&quot;;</span>
<span class="nc" id="L421">						dgPwtCol = &quot;pwt_amt&quot;;</span>
<span class="nc" id="L422">						addDrawQry = &quot; and drs.retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;</span>
								+ orgId + &quot;)&quot;;
<span class="nc" id="L424">						addDirPlrQry = &quot; and agent_org_id=&quot; + orgId;</span>
					} else {
<span class="nc" id="L426">						dgSaleCol = &quot;mrp_amt&quot;;</span>
<span class="nc" id="L427">						dgPwtCol = &quot;pwt_amt&quot;;</span>
<span class="nc" id="L428">						addDrawQry = &quot;&quot;;</span>
<span class="nc" id="L429">						addDirPlrQry = &quot;&quot;;</span>
					}
<span class="nc" id="L431">					String dgQuery = &quot;select date(alldate) alldate,sale,cancel,pwt,ifnull(pwtDir,0.0) pwtDir from (select sale.alldate,ifnull(sale,0.0) sale,ifnull(cancel,0.0) cancel,ifnull(pwt,0.0) pwt from (select alldate,sale from tempdate left outer join (select date(transaction_date) tx_date,sum(&quot;</span>
							+ dgSaleCol
							+ &quot;) sale from st_dg_ret_sale_&quot;
							+ gameNo
							+ &quot; drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and rtm.transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and transaction_type in('DG_SALE','DG_SALE_OFFLINE') &quot;
							+ addDrawQry
							+ &quot; group by tx_date) sale on alldate=sale.tx_date) sale inner join (select alldate,cancel from tempdate left outer join (select date(transaction_date) tx_date,sum(&quot;
							+ dgSaleCol
							+ &quot;) cancel from st_dg_ret_sale_refund_&quot;
							+ gameNo
							+ &quot; drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and rtm.transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') &quot;
							+ addDrawQry
							+ &quot; group by tx_date) cancel on alldate=cancel.tx_date) cancel inner join (select alldate,pwt from tempdate left outer join (select date(transaction_date) tx_date,sum(&quot;
							+ dgPwtCol
							+ &quot;) pwt from st_dg_ret_pwt_&quot;
							+ gameNo
							+ &quot; drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and rtm.transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') &quot;
							+ addDrawQry
							+ &quot; group by tx_date) pwt on alldate=pwt.tx_date) pwt on sale.alldate=cancel.alldate and sale.alldate=pwt.alldate and cancel.alldate=pwt.alldate) a left outer join (select date(transaction_date) tx_date ,sum(pwt_amt) pwtDir from st_dg_agt_direct_plr_pwt where transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and game_id=&quot;
							+ gameNo
							+ &quot; &quot;
							+ addDirPlrQry
							+ &quot; group by tx_date) b on alldate=tx_date  &quot;;

<span class="nc bnc" id="L471" title="All 2 branches missed.">					if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L472">						mainQuery = new StringBuilder(</span>
								&quot;select main.alldate,sum(main.sale)as sale,sum(main.cancel)as cancel,sum(main.pwt)as pwt,sum(main.pwtDir)as pwtDir from (&quot;);
<span class="nc bnc" id="L474" title="All 4 branches missed.">						if (viewBy.equalsIgnoreCase(&quot;Agent&quot;) &amp;&amp; orgId != 0) {</span>
<span class="nc" id="L475">							unionQuery = new StringBuilder(</span>
									&quot;union all select dgr.finaldate as alldate,sum(dgr.sale_mrp) as sale ,sum(dgr.ref_sale_mrp) cancel, sum(dgr.pwt_mrp) pwt,sum(ifnull(dga.direct_pwt_amt,0.00))as pwtDir  from st_rep_dg_retailer as dgr left outer join  st_rep_dg_agent as dga on dgr.finaldate=dga.finaldate and dgr.parent_id=dga.parent_id where dgr.parent_id=&quot;
											+ orgId
											+ &quot; and dgr.game_id=&quot;
											+ gameNo
											+ &quot; and dgr.finaldate&gt;=date('&quot;
											+ startDate
											+ &quot;') and dgr.finaldate&lt;=date('&quot;
											+ endDate
											+ &quot;') group by dgr.finaldate)as main group by main.alldate &quot;);
						} else {
<span class="nc" id="L486">							unionQuery = new StringBuilder(</span>
									&quot; union all select finaldate as alldate,sum(sale_mrp) as sale,sum(ref_sale_mrp) as cancel, sum(pwt_mrp) as pwt, sum(direct_pwt_amt) as pwtDir from st_rep_dg_agent where game_id=&quot;
											+ gameNo
											+ &quot; and finaldate&gt;=date('&quot;
											+ startDate
											+ &quot;') and finaldate&lt;=date('&quot;
											+ endDate
											+ &quot;') group by finaldate)as main group by main.alldate  &quot;);
						}
<span class="nc" id="L495">						pstmt = con.prepareStatement(mainQuery.append(dgQuery)</span>
								.append(unionQuery.toString()).toString());
					} else {
<span class="nc" id="L498">						pstmt = con.prepareStatement(dgQuery);</span>
					}
<span class="nc" id="L500">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L501" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L502">						String tempDate = rs.getString(&quot;alldate&quot;);</span>
<span class="nc" id="L503">						dateMap.get(tempDate).setDrawSale(</span>
								dateMap.get(tempDate).getDrawSale()
										+ rs.getDouble(&quot;sale&quot;));
<span class="nc" id="L506">						dateMap.get(tempDate).setDrawCancel(</span>
								dateMap.get(tempDate).getDrawCancel()
										+ rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L509">						dateMap.get(tempDate).setDrawPwt(</span>
								dateMap.get(tempDate).getDrawPwt()
										+ rs.getDouble(&quot;pwt&quot;));
<span class="nc" id="L512">						dateMap.get(tempDate).setDrawDirPlyPwt(</span>
								dateMap.get(tempDate).getDrawDirPlyPwt()
										+ rs.getDouble(&quot;pwtDir&quot;));
<span class="nc" id="L515">					}</span>
<span class="nc" id="L516">				}</span>
			}
<span class="nc bnc" id="L518" title="All 2 branches missed.">			if (isSE) {</span>
				// Game Master Query
<span class="nc" id="L520">				String gameQry = &quot;select game_id from st_se_game_master&quot;;</span>
<span class="nc" id="L521">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L522">				rsGame = gamePstmt.executeQuery();</span>

<span class="nc" id="L524">				String sePwtCol = &quot;&quot;;</span>
<span class="nc" id="L525">				String addScratchPwtQry = &quot;&quot;;</span>
<span class="nc" id="L526">				String addDirPlrQry = &quot;&quot;;</span>
<span class="nc" id="L527">				String addSaleQry = &quot;&quot;;</span>
<span class="nc" id="L528">				String saleQry = &quot;&quot;;</span>
<span class="nc" id="L529">				String cancelQry = &quot;&quot;;</span>
<span class="nc" id="L530">				String pwtQry = &quot;&quot;;</span>
<span class="nc" id="L531">				String dirPwtQry = &quot;&quot;;</span>
<span class="nc" id="L532">				String seQuery = &quot;&quot;;</span>

<span class="nc bnc" id="L534" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L535">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc bnc" id="L536" title="All 4 branches missed.">					if (viewBy.equalsIgnoreCase(&quot;Agent&quot;) &amp;&amp; orgId != 0) {</span>
<span class="nc" id="L537">						sePwtCol = &quot; pwt_amt&quot;;</span>
<span class="nc" id="L538">						addScratchPwtQry = &quot; and rp.retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;</span>
								+ orgId + &quot;)&quot;;
<span class="nc" id="L540">						addDirPlrQry = &quot; and agent_org_id=&quot; + orgId;</span>
<span class="nc" id="L541">						addSaleQry = &quot;'RETAILER' and gid.current_owner_id in(select organization_id from st_lms_organization_master where parent_id=&quot;</span>
								+ orgId + &quot;) group by date&quot;;
					} else {
<span class="nc" id="L544">						sePwtCol = &quot;pwt_amt&quot;;</span>
<span class="nc" id="L545">						addScratchPwtQry = &quot;&quot;;</span>
<span class="nc" id="L546">						addDirPlrQry = &quot;&quot;;</span>
<span class="nc" id="L547">						addSaleQry = &quot;'AGENT'  group by date&quot;;</span>
					}

<span class="nc bnc" id="L550" title="All 2 branches missed.">					if (&quot;BOOK_WISE&quot;</span>
							.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc bnc" id="L552" title="All 4 branches missed.">						if (viewBy.equalsIgnoreCase(&quot;Agent&quot;) &amp;&amp; orgId != 0) {</span>
<span class="nc" id="L553">							saleQry = &quot;select date(alldate) tx_date,ifnull(sale,0.0) sale from tempdate left outer join (select transaction_date,sum(mrp_amt) mrpAmt,sum(mrp_amt) sale from st_se_agent_retailer_transaction sale,(select transaction_id,date(transaction_date) transaction_date from st_lms_agent_transaction_master where transaction_type='SALE' and transaction_date&gt;='&quot;</span>
									+ startDate
									+ &quot;' and transaction_date&lt;='&quot;
									+ endDate
									+ &quot;') tranTlb where sale.transaction_id=tranTlb.transaction_id and agent_org_id=&quot;
									+ orgId
									+ &quot; and game_id=&quot;
									+ gameNo
									+ &quot; group by transaction_date) sale on date(alldate)=transaction_date&quot;;
<span class="nc" id="L562">							cancelQry = &quot;select date(alldate) tx_date,ifnull(cancel,0.0) cancel from tempdate left outer join (select transaction_date,sum(mrp_amt) mrpAmt,sum(mrp_amt) cancel from st_se_agent_retailer_transaction sale,(select transaction_id,date(transaction_date) transaction_date from st_lms_agent_transaction_master where transaction_type='SALE_RET' and transaction_date&gt;='&quot;</span>
									+ startDate
									+ &quot;' and transaction_date&lt;='&quot;
									+ endDate
									+ &quot;') tranTlb where sale.transaction_id=tranTlb.transaction_id and agent_org_id=&quot;
									+ orgId
									+ &quot; and game_id=&quot;
									+ gameNo
									+ &quot; group by transaction_date) cancel on date(alldate)=transaction_date&quot;;
						} else {
<span class="nc" id="L572">							saleQry = &quot;select date(alldate) tx_date,ifnull(sale,0.0) sale from tempdate left outer join (select transaction_date,sum(mrp_amt) mrpAmt,sum(mrp_amt) sale from st_se_bo_agent_transaction sale,(select transaction_id,date(transaction_date) transaction_date from st_lms_bo_transaction_master where transaction_type='SALE' and transaction_date&gt;='&quot;</span>
									+ startDate
									+ &quot;' and transaction_date&lt;='&quot;
									+ endDate
									+ &quot;') tranTlb where sale.transaction_id=tranTlb.transaction_id and game_id=&quot;
									+ gameNo
									+ &quot; group by transaction_date) sale on date(alldate)=transaction_date&quot;;
<span class="nc" id="L579">							cancelQry = &quot;select date(alldate) tx_date,ifnull(cancel,0.0) cancel from tempdate left outer join (select transaction_date,sum(mrp_amt) mrpAmt,sum(mrp_amt) cancel from st_se_bo_agent_transaction sale,(select transaction_id,date(transaction_date) transaction_date from st_lms_bo_transaction_master where transaction_type='SALE_RET' and transaction_date&gt;='&quot;</span>
									+ startDate
									+ &quot;' and transaction_date&lt;='&quot;
									+ endDate
									+ &quot;') tranTlb where sale.transaction_id=tranTlb.transaction_id and game_id=&quot;
									+ gameNo
									+ &quot; group by transaction_date) cancel on date(alldate)=transaction_date&quot;;
						}
<span class="nc bnc" id="L587" title="All 2 branches missed.">					} else if (&quot;TICKET_WISE&quot;</span>
							.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L589">						saleQry = &quot;select date(alldate) tx_date,ifnull(sale,0.0) sale from tempdate left outer join (select date, sum(soldTkt*ticket_price) sale from st_se_game_master gm inner join st_se_game_inv_detail gid inner join (select date(date) date,game_id,book_nbr,sum(sold_tickets) soldTkt from st_se_game_ticket_inv_history where date&gt;='&quot;</span>
								+ startDate
								+ &quot;' and date&lt;='&quot;
								+ endDate
								+ &quot;' and current_owner='RETAILER' group by book_nbr,date(date)) TktTlb on gm.game_id=TktTlb.game_id and TktTlb.book_nbr=gid.book_nbr where gm.game_id=&quot;
								+ gameNo
								+ &quot; and gid.current_owner=&quot;
								+ addSaleQry + &quot;) sale on date(alldate)=date&quot;;
<span class="nc" id="L597">						cancelQry = &quot;select date(alldate) tx_date,0.0 cancel from tempdate&quot;;</span>
					}

<span class="nc" id="L600">					pwtQry = &quot;select date(alldate) tx_date,ifnull(pwt,0.0) pwt from tempdate left outer join (select date(rtm.transaction_date) tx_date,sum(&quot;</span>
							+ sePwtCol
							+ &quot;) pwt from st_se_retailer_pwt rp,st_lms_retailer_transaction_master rtm where rp.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and rtm.transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and rtm.transaction_type='PWT' and rp.game_id=&quot;
							+ gameNo
							+ &quot; &quot;
							+ addScratchPwtQry
							+ &quot; group by tx_date) pwt on date(alldate)=tx_date&quot;;
<span class="nc" id="L611">					dirPwtQry = &quot;select tx_date,sum(net_amt) pwtDir from (select date(transaction_date) tx_date ,pwt_amt net_amt from st_se_agt_direct_player_pwt where transaction_date&gt;='&quot;</span>
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and game_id=&quot;
							+ gameNo
							+ &quot; &quot;
							+ addDirPlrQry
							+ &quot;) aa group by tx_date&quot;;
<span class="nc" id="L620">					seQuery = &quot;select a.tx_date as alldate,sale,cancel,pwt,ifnull(pwtDir,0.0) pwtDir from (select sale.tx_date,sale,cancel,pwt from (&quot;</span>
							+ saleQry
							+ &quot;) sale inner join (&quot;
							+ cancelQry
							+ &quot;) cancel inner join (&quot;
							+ pwtQry
							+ &quot;) pwt on sale.tx_date=cancel.tx_date and sale.tx_date=pwt.tx_date and cancel.tx_date=pwt.tx_date) a left outer join (&quot;
							+ dirPwtQry + &quot;)pwtDir on a.tx_date=pwtDir.tx_date&quot;;

<span class="nc bnc" id="L629" title="All 2 branches missed.">					if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L630">						mainQuery = new StringBuilder(</span>
								&quot;select main.alldate,sum(main.sale) sale,sum(main.cancel) cancel,sum(main.pwt) pwt,sum(main.pwtDir) pwtdir from(&quot;);
<span class="nc bnc" id="L632" title="All 2 branches missed.">						if (&quot;BOOK_WISE&quot;</span>
								.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc bnc" id="L634" title="All 4 branches missed.">							if (viewBy.equalsIgnoreCase(&quot;Agent&quot;) &amp;&amp; orgId != 0)</span>
<span class="nc" id="L635">								unionQuery = new StringBuilder(</span>
										&quot; union all select finaldate as alldate,sum(sale_book_mrp)as sale,sum(ref_sale_mrp)as cancel,sum(pwt_mrp)as pwt,sum(direct_pwt_amt)as pwtDir from st_rep_se_agent where game_id=&quot;
												+ gameNo
												+ &quot; and finaldate&gt;=date('&quot;
												+ startDate
												+ &quot;') and finaldate&lt;=date('&quot;
												+ endDate
												+ &quot;') group by finaldate)as main group by main.alldate&quot;);
							else
<span class="nc" id="L644">								unionQuery = new StringBuilder(</span>
										&quot; union all select finaldate as alldate,sum(sale_book_mrp)as sale,sum(ref_sale_mrp)as cancel, sum(pwt_net_amt)as pwt ,sum(direct_pwt_amt)as pwtDir  from st_rep_se_bo where game_id=&quot;
												+ gameNo
												+ &quot; and    finaldate&gt;=date('&quot;
												+ startDate
												+ &quot;') and finaldate&lt;=date('&quot;
												+ endDate
												+ &quot;') group by finaldate)as main group by main.alldate&quot;);
						} else {
<span class="nc bnc" id="L653" title="All 4 branches missed.">							if (viewBy.equalsIgnoreCase(&quot;Agent&quot;) &amp;&amp; orgId != 0)</span>
<span class="nc" id="L654">								unionQuery = new StringBuilder(</span>
										&quot; union all select finaldate as alldate,sum(sale_ticket_mrp) as sale,0.0 as cancel,sum(pwt_mrp)as pwt,sum(direct_pwt_amt)as pwtDir from st_rep_se_agent where  game_id=&quot;
												+ gameNo
												+ &quot; and finaldate&gt;=date('&quot;
												+ startDate
												+ &quot;') and finaldate&lt;=date('&quot;
												+ endDate
												+ &quot;') group by finaldate)as main group by main.alldate&quot;);
							else
<span class="nc" id="L663">								unionQuery = new StringBuilder(</span>
										&quot; union all select finaldate as alldate,sum(sale_ticket_mrp) as sale,0.0 as cancel,sum(pwt_mrp)as pwt,sum(direct_pwt_amt)as pwtDir from st_rep_se_bo where game_id=&quot;
												+ gameNo
												+ &quot; and  finaldate&gt;=date('&quot;
												+ startDate
												+ &quot;') and finaldate&lt;=date('&quot;
												+ endDate
												+ &quot;') group by finaldate )as main group by main.alldate&quot;);
						}

<span class="nc" id="L673">						pstmt = con.prepareStatement(mainQuery.append(seQuery)</span>
								.append(unionQuery.toString()).toString());
					} else {
<span class="nc" id="L676">						pstmt = con.prepareStatement(seQuery);</span>
					}
<span class="nc" id="L678">					rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L680" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L681">						String tempDate = rs.getString(&quot;alldate&quot;);</span>
<span class="nc" id="L682">						double sale = rs.getDouble(&quot;sale&quot;)</span>
								- rs.getDouble(&quot;cancel&quot;);
<span class="nc" id="L684">						dateMap.get(tempDate).setScratchSale(</span>
								dateMap.get(tempDate).getScratchSale() + sale);
<span class="nc" id="L686">						dateMap.get(tempDate).setScratchPwt(</span>
								dateMap.get(tempDate).getScratchPwt()
										+ rs.getDouble(&quot;pwt&quot;));
<span class="nc" id="L689">						dateMap.get(tempDate).setScratchDirPlyPwt(</span>
								dateMap.get(tempDate).getScratchDirPlyPwt()
										+ rs.getDouble(&quot;pwtDir&quot;));
<span class="nc" id="L692">					}</span>
<span class="nc" id="L693">				}</span>
			}

<span class="nc bnc" id="L696" title="All 2 branches missed.">			if (isCS) {</span>

<span class="nc" id="L698">				String csSaleCol = &quot;&quot;;</span>
<span class="nc" id="L699">				String addCSQry = &quot;&quot;;</span>
<span class="nc" id="L700">				String csQuery = &quot;&quot;;</span>

				// Category Master Query
<span class="nc" id="L703">				String catQry = &quot;select category_id from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L704">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L705">				rsGame = prodPstmt.executeQuery();</span>
<span class="nc bnc" id="L706" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L707">					int catId = rsGame.getInt(&quot;category_id&quot;);</span>
<span class="nc bnc" id="L708" title="All 4 branches missed.">					if (viewBy.equalsIgnoreCase(&quot;Agent&quot;) &amp;&amp; orgId != 0) {</span>
<span class="nc" id="L709">						csSaleCol = &quot;mrp_amt&quot;;</span>
<span class="nc" id="L710">						addCSQry = &quot; and cs.retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;</span>
								+ orgId + &quot;)&quot;;
					} else {
<span class="nc" id="L713">						csSaleCol = &quot;mrp_amt&quot;;</span>
<span class="nc" id="L714">						addCSQry = &quot;&quot;;</span>
					}

<span class="nc" id="L717">					csQuery = &quot;select sale.alldate,ifnull(sale,0.0) sale,ifnull(cancel,0.0) cancel from (select alldate,sale from tempdate left outer join (select date(transaction_date) tx_date,sum(&quot;</span>
							+ csSaleCol
							+ &quot;) sale from st_cs_sale_&quot;
							+ catId
							+ &quot; cs,st_lms_retailer_transaction_master rtm where cs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and rtm.transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and transaction_type ='CS_SALE' &quot;
							+ addCSQry
							+ &quot; group by tx_date) sale on alldate=sale.tx_date) sale inner join (select alldate,cancel from tempdate left outer join (select date(transaction_date) tx_date,sum(&quot;
							+ csSaleCol
							+ &quot;) cancel from st_cs_refund_&quot;
							+ catId
							+ &quot; cs,st_lms_retailer_transaction_master rtm where cs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and rtm.transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and transaction_type in('CS_CANCEL_SERVER','CS_CANCEL_RET') &quot;
							+ addCSQry
							+ &quot; group by tx_date) cancel on alldate=cancel.tx_date) cancel on sale.alldate=cancel.alldate &quot;;

<span class="nc bnc" id="L739" title="All 2 branches missed.">					if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L740">						mainQuery = new StringBuilder(</span>
								&quot;select main.alldate,sum(main.sale)as sale,sum(main.cancel)as cancel from (&quot;);
<span class="nc bnc" id="L742" title="All 4 branches missed.">						if (viewBy.equalsIgnoreCase(&quot;Agent&quot;) &amp;&amp; orgId != 0)</span>
<span class="nc" id="L743">							unionQuery = new StringBuilder(</span>
									&quot; union all select csr.finaldate as alldate,sum(csr.sale_mrp) as sale ,sum(csr.ref_sale_mrp) cancel  from st_rep_cs_retailer as csr, st_rep_cs_agent as csa where csr.finaldate=csa.finaldate and csr.parent_id=csa.parent_id and csr.parent_id=&quot;
											+ orgId
											+ &quot; and csr.category_id=&quot;
											+ catId
											+ &quot; and csr.finaldate&gt;=date('&quot;
											+ startDate
											+ &quot;') and csr.finaldate&lt;=date('&quot;
											+ endDate
											+ &quot;') group by csr.finaldate)as main group by main.alldate &quot;);
						else
<span class="nc" id="L754">							unionQuery = new StringBuilder(</span>
									&quot; union all select finaldate as alldate,sum(sale_mrp) as sale,sum(ref_sale_mrp) as cancel from st_rep_cs_agent where category_id=&quot;
											+ catId
											+ &quot; and finaldate&gt;=date('&quot;
											+ startDate
											+ &quot;') and finaldate&lt;=date('&quot;
											+ endDate
											+ &quot;') group by finaldate)as main group by main.alldate  &quot;);

<span class="nc" id="L763">						pstmt = con.prepareStatement(mainQuery.append(csQuery)</span>
								.append(unionQuery.toString()).toString());

					} else {
<span class="nc" id="L767">						pstmt = con.prepareStatement(csQuery);</span>
					}

<span class="nc" id="L770">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L771" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L772">						String tempDate = rs.getString(&quot;alldate&quot;);</span>
<span class="nc" id="L773">						dateMap.get(tempDate).setCSSale(</span>
								dateMap.get(tempDate).getCSSale()
										+ rs.getDouble(&quot;sale&quot;));
<span class="nc" id="L776">						dateMap.get(tempDate).setCSCancel(</span>
								dateMap.get(tempDate).getCSCancel()
										+ rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L779">					}</span>
<span class="nc" id="L780">				}</span>

			}

<span class="nc" id="L784">		} catch (Exception e) {</span>
<span class="nc" id="L785">			e.printStackTrace();</span>
<span class="nc" id="L786">		}</span>
<span class="nc" id="L787">		return dateMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionDayWiseExpand(
			Timestamp startDate, Timestamp endDate, Connection con,
			boolean isDG, boolean isSE, boolean isCS, boolean isOLA,
			String viewBy, int orgId) {
<span class="nc" id="L794">		ResultSet rsGame = null;</span>
<span class="nc" id="L795">		ResultSet rs = null;</span>
<span class="nc" id="L796">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L797">		StringBuilder unionQuery = null;</span>
<span class="nc" id="L798">		StringBuilder mainQuery = null;</span>
<span class="nc" id="L799">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; serGameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;();</span>
<span class="nc" id="L800">		Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt; gameAgtMap = null;</span>

<span class="nc bnc" id="L802" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L803">			return serGameAgtMap;</span>
		}

		try {
<span class="nc" id="L807">			CallableStatement cstmt = con</span>
					.prepareCall(&quot;{call fillDateTable(?,?)}&quot;);
<span class="nc" id="L809">			cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L810">			cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L811">			cstmt.executeQuery();</span>
<span class="nc bnc" id="L812" title="All 2 branches missed.">			if (isDG) {</span>
<span class="nc" id="L813">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>

				// Game Master Query
<span class="nc" id="L816">				String gameQry = &quot;select game_id,game_name from st_dg_game_master&quot;;</span>
<span class="nc" id="L817">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L818">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L819" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L820">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L821">					gameMap.putAll(getDayMap(startDate, endDate, isDG, isSE,</span>
							isCS));
<span class="nc" id="L823">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L824">					String dgSaleCol = &quot;&quot;;</span>
<span class="nc" id="L825">					String dgPwtCol = &quot;&quot;;</span>
<span class="nc" id="L826">					String addDrawQry = &quot;&quot;;</span>
<span class="nc" id="L827">					String addDirPlrQry = &quot;&quot;;</span>

<span class="nc bnc" id="L829" title="All 4 branches missed.">					if (viewBy.equalsIgnoreCase(&quot;Agent&quot;) &amp;&amp; orgId != 0) {</span>
<span class="nc" id="L830">						dgSaleCol = &quot;mrp_amt&quot;;</span>
<span class="nc" id="L831">						dgPwtCol = &quot;pwt_amt&quot;;</span>
<span class="nc" id="L832">						addDrawQry = &quot; and drs.retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;</span>
								+ orgId + &quot;)&quot;;
<span class="nc" id="L834">						addDirPlrQry = &quot; and agent_org_id=&quot; + orgId;</span>
					} else {
<span class="nc" id="L836">						dgSaleCol = &quot;mrp_amt&quot;;</span>
<span class="nc" id="L837">						dgPwtCol = &quot;pwt_amt&quot;;</span>
<span class="nc" id="L838">						addDrawQry = &quot;&quot;;</span>
<span class="nc" id="L839">						addDirPlrQry = &quot;&quot;;</span>
					}
<span class="nc" id="L841">					String dgQuery = &quot;select date(alldate) alldate,sale,cancel,pwt,ifnull(pwtDir,0.0) pwtDir from (select sale.alldate,ifnull(sale,0.0) sale,ifnull(cancel,0.0) cancel,ifnull(pwt,0.0) pwt from (select alldate,sale from tempdate left outer join (select date(transaction_date) tx_date,sum(&quot;</span>
							+ dgSaleCol
							+ &quot;) sale from st_dg_ret_sale_&quot;
							+ gameNo
							+ &quot; drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and rtm.transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and transaction_type in('DG_SALE','DG_SALE_OFFLINE') &quot;
							+ addDrawQry
							+ &quot; group by tx_date) sale on alldate=sale.tx_date) sale inner join (select alldate,cancel from tempdate left outer join (select date(transaction_date) tx_date,sum(&quot;
							+ dgSaleCol
							+ &quot;) cancel from st_dg_ret_sale_refund_&quot;
							+ gameNo
							+ &quot; drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and rtm.transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') &quot;
							+ addDrawQry
							+ &quot; group by tx_date) cancel on alldate=cancel.tx_date) cancel inner join (select alldate,pwt from tempdate left outer join (select date(transaction_date) tx_date,sum(&quot;
							+ dgPwtCol
							+ &quot;) pwt from st_dg_ret_pwt_&quot;
							+ gameNo
							+ &quot; drs,st_lms_retailer_transaction_master rtm where drs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and rtm.transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') &quot;
							+ addDrawQry
							+ &quot; group by tx_date) pwt on alldate=pwt.tx_date) pwt on sale.alldate=cancel.alldate and sale.alldate=pwt.alldate and cancel.alldate=pwt.alldate) a left outer join (select date(transaction_date) tx_date ,sum(pwt_amt) pwtDir from st_dg_agt_direct_plr_pwt where transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and game_id=&quot;
							+ gameNo
							+ &quot; &quot;
							+ addDirPlrQry
							+ &quot; group by tx_date) b on alldate=tx_date  &quot;;

<span class="nc bnc" id="L881" title="All 2 branches missed.">					if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L882">						mainQuery = new StringBuilder(</span>
								&quot;select main.alldate,sum(main.sale)as sale,sum(main.cancel)as cancel,sum(main.pwt)as pwt,sum(main.pwtDir)as pwtDir from (&quot;);
<span class="nc bnc" id="L884" title="All 4 branches missed.">						if (viewBy.equalsIgnoreCase(&quot;Agent&quot;) &amp;&amp; orgId != 0) {</span>
<span class="nc" id="L885">							unionQuery = new StringBuilder(</span>
									&quot;union all select dgr.finaldate as alldate,sum(dgr.sale_mrp) as sale ,sum(dgr.ref_sale_mrp) cancel, sum(dgr.pwt_mrp) pwt,sum(ifnull(dga.direct_pwt_amt,0.00))as pwtDir  from st_rep_dg_retailer as dgr left outer join  st_rep_dg_agent as dga on dgr.finaldate=dga.finaldate and dgr.parent_id=dga.parent_id where dgr.parent_id=&quot;
											+ orgId
											+ &quot; and dgr.game_id=&quot;
											+ gameNo
											+ &quot; and dgr.finaldate&gt;=date('&quot;
											+ startDate
											+ &quot;') and dgr.finaldate&lt;=date('&quot;
											+ endDate
											+ &quot;') group by dgr.finaldate)as main group by main.alldate &quot;);
						} else {
<span class="nc" id="L896">							unionQuery = new StringBuilder(</span>
									&quot; union all select finaldate as alldate,sum(sale_mrp) as sale,sum(ref_sale_mrp) as cancel, sum(pwt_mrp) as pwt, sum(direct_pwt_amt) as pwtDir from st_rep_dg_agent where game_id=&quot;
											+ gameNo
											+ &quot; and finaldate&gt;=date('&quot;
											+ startDate
											+ &quot;') and finaldate&lt;=date('&quot;
											+ endDate
											+ &quot;') group by finaldate)as main group by main.alldate  &quot;);
						}
<span class="nc" id="L905">						pstmt = con.prepareStatement(mainQuery.append(dgQuery)</span>
								.append(unionQuery.toString()).toString());
					} else {
<span class="nc" id="L908">						pstmt = con.prepareStatement(dgQuery);</span>
					}
<span class="nc" id="L910">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L911" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L912">						String agtId = rs.getString(&quot;alldate&quot;);</span>
<span class="nc" id="L913">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L914">						gameMap.get(agtId)</span>
								.setDrawCancel(rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L916">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>
<span class="nc" id="L917">						gameMap.get(agtId).setDrawDirPlyPwt(</span>
								rs.getDouble(&quot;pwtDir&quot;));
<span class="nc" id="L919">					}</span>

<span class="nc" id="L921">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L922">				}</span>

<span class="nc" id="L924">				serGameAgtMap.put(&quot;DG&quot;, gameAgtMap);</span>
			}

<span class="nc bnc" id="L927" title="All 2 branches missed.">			if (isSE) {</span>
<span class="nc" id="L928">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>

				// Game Master Query
<span class="nc" id="L931">				String gameQry = &quot;select game_id,game_name from st_se_game_master&quot;;</span>
<span class="nc" id="L932">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L933">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L934">				String sePwtCol = &quot;&quot;;</span>
<span class="nc" id="L935">				String addScratchPwtQry = &quot;&quot;;</span>
<span class="nc" id="L936">				String addDirPlrQry = &quot;&quot;;</span>
<span class="nc" id="L937">				String addSaleQry = &quot;&quot;;</span>
<span class="nc" id="L938">				String saleQry = &quot;&quot;;</span>
<span class="nc" id="L939">				String cancelQry = &quot;&quot;;</span>
<span class="nc" id="L940">				String pwtQry = &quot;&quot;;</span>
<span class="nc" id="L941">				String dirPwtQry = &quot;&quot;;</span>
<span class="nc" id="L942">				String seQuery = &quot;&quot;;</span>

<span class="nc bnc" id="L944" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L945">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L946">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L947">					gameMap.putAll(getDayMap(startDate, endDate, isDG, isSE,</span>
							isCS));
<span class="nc bnc" id="L949" title="All 4 branches missed.">					if (viewBy.equalsIgnoreCase(&quot;Agent&quot;) &amp;&amp; orgId != 0) {</span>
<span class="nc" id="L950">						sePwtCol = &quot; pwt_amt&quot;;</span>
<span class="nc" id="L951">						addScratchPwtQry = &quot; and rp.retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;</span>
								+ orgId + &quot;)&quot;;
<span class="nc" id="L953">						addDirPlrQry = &quot; and agent_org_id=&quot; + orgId;</span>
<span class="nc" id="L954">						addSaleQry = &quot;'RETAILER' and gid.current_owner_id in(select organization_id from st_lms_organization_master where parent_id=&quot;</span>
								+ orgId + &quot;) group by date&quot;;
					} else {
<span class="nc" id="L957">						sePwtCol = &quot;pwt_amt&quot;;</span>
<span class="nc" id="L958">						addScratchPwtQry = &quot;&quot;;</span>
<span class="nc" id="L959">						addDirPlrQry = &quot;&quot;;</span>
<span class="nc" id="L960">						addSaleQry = &quot;'AGENT'  group by date&quot;;</span>
					}

<span class="nc bnc" id="L963" title="All 2 branches missed.">					if (&quot;BOOK_WISE&quot;</span>
							.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc bnc" id="L965" title="All 4 branches missed.">						if (viewBy.equalsIgnoreCase(&quot;Agent&quot;) &amp;&amp; orgId != 0) {</span>
<span class="nc" id="L966">							saleQry = &quot;select date(alldate) tx_date,ifnull(sale,0.0) sale from tempdate left outer join (select transaction_date,sum(mrp_amt) mrpAmt,sum(mrp_amt) sale from st_se_agent_retailer_transaction sale,(select transaction_id,date(transaction_date) transaction_date from st_lms_agent_transaction_master where transaction_type='SALE' and transaction_date&gt;='&quot;</span>
									+ startDate
									+ &quot;' and transaction_date&lt;='&quot;
									+ endDate
									+ &quot;') tranTlb where sale.transaction_id=tranTlb.transaction_id and agent_org_id=&quot;
									+ orgId
									+ &quot; and game_id=&quot;
									+ gameNo
									+ &quot; group by transaction_date) sale on date(alldate)=transaction_date&quot;;
<span class="nc" id="L975">							cancelQry = &quot;select date(alldate) tx_date,ifnull(cancel,0.0) cancel from tempdate left outer join (select transaction_date,sum(mrp_amt) mrpAmt,sum(mrp_amt) cancel from st_se_agent_retailer_transaction sale,(select transaction_id,date(transaction_date) transaction_date from st_lms_agent_transaction_master where transaction_type='SALE_RET' and transaction_date&gt;='&quot;</span>
									+ startDate
									+ &quot;' and transaction_date&lt;='&quot;
									+ endDate
									+ &quot;') tranTlb where sale.transaction_id=tranTlb.transaction_id and agent_org_id=&quot;
									+ orgId
									+ &quot; and game_id=&quot;
									+ gameNo
									+ &quot; group by transaction_date) cancel on date(alldate)=transaction_date&quot;;
						} else {
<span class="nc" id="L985">							saleQry = &quot;select date(alldate) tx_date,ifnull(sale,0.0) sale from tempdate left outer join (select transaction_date,sum(mrp_amt) mrpAmt,sum(mrp_amt) sale from st_se_bo_agent_transaction sale,(select transaction_id,date(transaction_date) transaction_date from st_lms_bo_transaction_master where transaction_type='SALE' and transaction_date&gt;='&quot;</span>
									+ startDate
									+ &quot;' and transaction_date&lt;='&quot;
									+ endDate
									+ &quot;') tranTlb where sale.transaction_id=tranTlb.transaction_id and game_id=&quot;
									+ gameNo
									+ &quot; group by transaction_date) sale on date(alldate)=transaction_date&quot;;
<span class="nc" id="L992">							cancelQry = &quot;select date(alldate) tx_date,ifnull(cancel,0.0) cancel from tempdate left outer join (select transaction_date,sum(mrp_amt) mrpAmt,sum(mrp_amt) cancel from st_se_bo_agent_transaction sale,(select transaction_id,date(transaction_date) transaction_date from st_lms_bo_transaction_master where transaction_type='SALE_RET' and transaction_date&gt;='&quot;</span>
									+ startDate
									+ &quot;' and transaction_date&lt;='&quot;
									+ endDate
									+ &quot;') tranTlb where sale.transaction_id=tranTlb.transaction_id and game_id=&quot;
									+ gameNo
									+ &quot; group by transaction_date) cancel on date(alldate)=transaction_date&quot;;
						}
<span class="nc bnc" id="L1000" title="All 2 branches missed.">					} else if (&quot;TICKET_WISE&quot;</span>
							.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L1002">						saleQry = &quot;select date(alldate) tx_date,ifnull(sale,0.0) sale from tempdate left outer join (select date, sum(soldTkt*ticket_price) sale from st_se_game_master gm inner join st_se_game_inv_detail gid inner join (select date(date) date,game_id,book_nbr,sum(sold_tickets) soldTkt from st_se_game_ticket_inv_history where date&gt;='&quot;</span>
								+ startDate
								+ &quot;' and date&lt;='&quot;
								+ endDate
								+ &quot;' and current_owner='RETAILER' group by book_nbr,date(date)) TktTlb on gm.game_id=TktTlb.game_id and TktTlb.book_nbr=gid.book_nbr where gm.game_id=&quot;
								+ gameNo
								+ &quot; and gid.current_owner=&quot;
								+ addSaleQry + &quot;) sale on date(alldate)=date&quot;;
<span class="nc" id="L1010">						cancelQry = &quot;select date(alldate) tx_date,0.0 cancel from tempdate&quot;;</span>
					}

<span class="nc" id="L1013">					pwtQry = &quot;select date(alldate) tx_date,ifnull(pwt,0.0) pwt from tempdate left outer join (select date(rtm.transaction_date) tx_date,sum(&quot;</span>
							+ sePwtCol
							+ &quot;) pwt from st_se_retailer_pwt rp,st_lms_retailer_transaction_master rtm where rp.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and rtm.transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and rtm.transaction_type='PWT' and rp.game_id=&quot;
							+ gameNo
							+ &quot; &quot;
							+ addScratchPwtQry
							+ &quot; group by tx_date) pwt on date(alldate)=tx_date&quot;;
<span class="nc" id="L1024">					dirPwtQry = &quot;select tx_date,sum(net_amt) pwtDir from (select date(transaction_date) tx_date ,pwt_amt net_amt from st_se_agt_direct_player_pwt where transaction_date&gt;='&quot;</span>
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and game_id=&quot;
							+ gameNo
							+ &quot; &quot;
							+ addDirPlrQry
							+ &quot;) aa group by tx_date&quot;;
<span class="nc" id="L1033">					seQuery = &quot;select a.tx_date as alldate,sale,cancel,pwt,ifnull(pwtDir,0.0) pwtDir from (select sale.tx_date,sale,cancel,pwt from (&quot;</span>
							+ saleQry
							+ &quot;) sale inner join (&quot;
							+ cancelQry
							+ &quot;) cancel inner join (&quot;
							+ pwtQry
							+ &quot;) pwt on sale.tx_date=cancel.tx_date and sale.tx_date=pwt.tx_date and cancel.tx_date=pwt.tx_date) a left outer join (&quot;
							+ dirPwtQry + &quot;)pwtDir on a.tx_date=pwtDir.tx_date&quot;;

<span class="nc bnc" id="L1042" title="All 2 branches missed.">					if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1043">						mainQuery = new StringBuilder(</span>
								&quot;select main.alldate,sum(main.sale) sale,sum(main.cancel) cancel,sum(main.pwt) pwt,sum(main.pwtDir) pwtdir from(&quot;);
<span class="nc bnc" id="L1045" title="All 2 branches missed.">						if (&quot;BOOK_WISE&quot;</span>
								.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc bnc" id="L1047" title="All 4 branches missed.">							if (viewBy.equalsIgnoreCase(&quot;Agent&quot;) &amp;&amp; orgId != 0)</span>
<span class="nc" id="L1048">								unionQuery = new StringBuilder(</span>
										&quot; union all select finaldate as alldate,sum(sale_book_mrp)as sale,sum(ref_sale_mrp)as cancel,sum(pwt_mrp)as pwt,sum(direct_pwt_amt)as pwtDir from st_rep_se_agent where game_id=&quot;
												+ gameNo
												+ &quot; and finaldate&gt;=date('&quot;
												+ startDate
												+ &quot;') and finaldate&lt;=date('&quot;
												+ endDate
												+ &quot;') group by finaldate)as main group by main.alldate&quot;);
							else
<span class="nc" id="L1057">								unionQuery = new StringBuilder(</span>
										&quot; union all select finaldate as alldate,sum(sale_book_mrp)as sale,sum(ref_sale_mrp)as cancel, sum(pwt_net_amt)as pwt ,sum(direct_pwt_amt)as pwtDir  from st_rep_se_bo where game_id=&quot;
												+ gameNo
												+ &quot; and    finaldate&gt;=date('&quot;
												+ startDate
												+ &quot;') and finaldate&lt;=date('&quot;
												+ endDate
												+ &quot;') group by finaldate)as main group by main.alldate&quot;);
						} else {
<span class="nc bnc" id="L1066" title="All 4 branches missed.">							if (viewBy.equalsIgnoreCase(&quot;Agent&quot;) &amp;&amp; orgId != 0)</span>
<span class="nc" id="L1067">								unionQuery = new StringBuilder(</span>
										&quot; union all select finaldate as alldate,sum(sale_ticket_mrp) as sale,0.0 as cancel,sum(pwt_mrp)as pwt,sum(direct_pwt_amt)as pwtDir from st_rep_se_agent where  game_id=&quot;
												+ gameNo
												+ &quot; and finaldate&gt;=date('&quot;
												+ startDate
												+ &quot;') and finaldate&lt;=date('&quot;
												+ endDate
												+ &quot;') group by finaldate)as main group by main.alldate&quot;);
							else
<span class="nc" id="L1076">								unionQuery = new StringBuilder(</span>
										&quot; union all select finaldate as alldate,sum(sale_ticket_mrp) as sale,0.0 as cancel,sum(pwt_mrp)as pwt,sum(direct_pwt_amt)as pwtDir from st_rep_se_bo where game_id=&quot;
												+ gameNo
												+ &quot; and  finaldate&gt;=date('&quot;
												+ startDate
												+ &quot;') and finaldate&lt;=date('&quot;
												+ endDate
												+ &quot;') group by finaldate )as main group by main.alldate&quot;);
						}

<span class="nc" id="L1086">						pstmt = con.prepareStatement(mainQuery.append(seQuery)</span>
								.append(unionQuery.toString()).toString());
					} else {
<span class="nc" id="L1089">						pstmt = con.prepareStatement(seQuery);</span>
					}
<span class="nc" id="L1091">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1092" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1093">						String tempDate = rs.getString(&quot;alldate&quot;);</span>
<span class="nc" id="L1094">						double sale = rs.getDouble(&quot;sale&quot;)</span>
								- rs.getDouble(&quot;cancel&quot;);
<span class="nc" id="L1096">						gameMap.get(tempDate).setDrawSale(sale);</span>
<span class="nc" id="L1097">						gameMap.get(tempDate).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>
<span class="nc" id="L1098">						gameMap.get(tempDate).setScratchDirPlyPwt(</span>
								rs.getDouble(&quot;pwtDir&quot;));
<span class="nc" id="L1100">					}</span>
<span class="nc" id="L1101">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L1102">				}</span>

<span class="nc" id="L1104">				serGameAgtMap.put(&quot;SE&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L1106" title="All 2 branches missed.">			if (isCS) {</span>

<span class="nc" id="L1108">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>

<span class="nc" id="L1110">				String csSaleCol = &quot;&quot;;</span>
<span class="nc" id="L1111">				String addCSQry = &quot;&quot;;</span>
<span class="nc" id="L1112">				String csQuery = &quot;&quot;;</span>

				// Category Master Query
<span class="nc" id="L1115">				String catQry = &quot;select category_id from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L1116">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L1117">				rsGame = prodPstmt.executeQuery();</span>
<span class="nc bnc" id="L1118" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1119">					Map&lt;String, CompleteCollectionBean&gt; prodMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1120">					prodMap.putAll(getDayMap(startDate, endDate, isDG, isSE,</span>
							isCS));
<span class="nc" id="L1122">					int catId = rsGame.getInt(&quot;category_id&quot;);</span>
<span class="nc bnc" id="L1123" title="All 4 branches missed.">					if (viewBy.equalsIgnoreCase(&quot;Agent&quot;) &amp;&amp; orgId != 0) {</span>
<span class="nc" id="L1124">						csSaleCol = &quot;mrp_amt&quot;;</span>
<span class="nc" id="L1125">						addCSQry = &quot; and cs.retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;</span>
								+ orgId + &quot;)&quot;;
					} else {
<span class="nc" id="L1128">						csSaleCol = &quot;mrp_amt&quot;;</span>
<span class="nc" id="L1129">						addCSQry = &quot;&quot;;</span>
					}

<span class="nc" id="L1132">					csQuery = &quot;select sale.alldate,ifnull(sale,0.0) sale,ifnull(cancel,0.0) cancel from (select alldate,sale from tempdate left outer join (select date(transaction_date) tx_date,sum(&quot;</span>
							+ csSaleCol
							+ &quot;) sale from st_cs_sale_&quot;
							+ catId
							+ &quot; cs,st_lms_retailer_transaction_master rtm where cs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and rtm.transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and transaction_type ='CS_SALE' &quot;
							+ addCSQry
							+ &quot; group by tx_date) sale on alldate=sale.tx_date) sale inner join (select alldate,cancel from tempdate left outer join (select date(transaction_date) tx_date,sum(&quot;
							+ csSaleCol
							+ &quot;) cancel from st_cs_refund_&quot;
							+ catId
							+ &quot; cs,st_lms_retailer_transaction_master rtm where cs.transaction_id=rtm.transaction_id and rtm.transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and rtm.transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and transaction_type in('CS_CANCEL_SERVER','CS_CANCEL_RET') &quot;
							+ addCSQry
							+ &quot; group by tx_date) cancel on alldate=cancel.tx_date) cancel on sale.alldate=cancel.alldate &quot;;

<span class="nc bnc" id="L1154" title="All 2 branches missed.">					if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1155">						mainQuery = new StringBuilder(</span>
								&quot;select main.alldate,sum(main.sale)as sale,sum(main.cancel)as cancel from (&quot;);
<span class="nc bnc" id="L1157" title="All 4 branches missed.">						if (viewBy.equalsIgnoreCase(&quot;Agent&quot;) &amp;&amp; orgId != 0)</span>
<span class="nc" id="L1158">							unionQuery = new StringBuilder(</span>
									&quot; union all select csr.finaldate as alldate,sum(csr.sale_mrp) as sale ,sum(csr.ref_sale_mrp) cancel  from st_rep_cs_retailer as csr, st_rep_cs_agent as csa where csr.finaldate=csa.finaldate and csr.parent_id=csa.parent_id and csr.parent_id=&quot;
											+ orgId
											+ &quot; and csr.category_id=&quot;
											+ catId
											+ &quot; and csr.finaldate&gt;=date('&quot;
											+ startDate
											+ &quot;') and csr.finaldate&lt;=date('&quot;
											+ endDate
											+ &quot;') group by csr.finaldate)as main group by main.alldate &quot;);
						else
<span class="nc" id="L1169">							unionQuery = new StringBuilder(</span>
									&quot; union all select finaldate as alldate,sum(sale_mrp) as sale,sum(ref_sale_mrp) as cancel from st_rep_cs_agent where category_id=&quot;
											+ catId
											+ &quot; and finaldate&gt;=date('&quot;
											+ startDate
											+ &quot;') and finaldate&lt;=date('&quot;
											+ endDate
											+ &quot;') group by finaldate)as main group by main.alldate  &quot;);

<span class="nc" id="L1178">						pstmt = con.prepareStatement(mainQuery.append(csQuery)</span>
								.append(unionQuery.toString()).toString());

					} else {
<span class="nc" id="L1182">						pstmt = con.prepareStatement(csQuery);</span>
					}

<span class="nc" id="L1185">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1186" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1187">						String agtId = rs.getString(&quot;alldate&quot;);</span>
<span class="nc" id="L1188">						prodMap.get(agtId).setCSSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L1189">						prodMap.get(agtId).setCSCancel(rs.getDouble(&quot;cancel&quot;));</span>
<span class="nc" id="L1190">					}</span>

<span class="nc" id="L1192">					gameAgtMap.put(rsGame.getString(&quot;category_code&quot;), prodMap);</span>
<span class="nc" id="L1193">				}</span>

<span class="nc" id="L1195">				serGameAgtMap.put(&quot;CS&quot;, gameAgtMap);</span>

			}
<span class="nc" id="L1198">			logger.debug(serGameAgtMap);</span>
<span class="nc" id="L1199">		} catch (Exception e) {</span>
<span class="nc" id="L1200">			e.printStackTrace();</span>
<span class="nc" id="L1201">		}</span>
<span class="nc" id="L1202">		return serGameAgtMap;</span>
	}

	public Map&lt;String, CompleteCollectionBean&gt; collectionReport(
			Timestamp startDate, Timestamp endDate, String reportType) {
<span class="nc" id="L1207">		System.out</span>
				.println(&quot;----------collectionReport----------reportType-----&quot;
						+ reportType);
<span class="nc" id="L1210">		Connection con = null;</span>
<span class="nc" id="L1211">		Map&lt;String, CompleteCollectionBean&gt; agtMap = null;</span>
<span class="nc" id="L1212">		boolean isSE = false;</span>
<span class="nc" id="L1213">		boolean isDG = false;</span>
<span class="nc" id="L1214">		boolean isCS = false;</span>
<span class="nc" id="L1215">		boolean isOLA = false;</span>
		try {
<span class="nc" id="L1217">			con = DBConnect.getConnection();</span>
<span class="nc" id="L1218">			Map&lt;String, Boolean&gt; serMap = checkAvailableService();</span>
<span class="nc" id="L1219">			isSE = serMap.get(&quot;SE&quot;);</span>
<span class="nc" id="L1220">			isDG = serMap.get(&quot;DG&quot;);</span>
<span class="nc" id="L1221">			isCS = serMap.get(&quot;CS&quot;);</span>
<span class="nc" id="L1222">			isOLA = serMap.get(&quot;OLA&quot;);</span>
<span class="nc bnc" id="L1223" title="All 2 branches missed.">			if (&quot;Agent Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1224">				agtMap = collectionAgentWise(startDate, endDate, con, isDG,</span>
						isSE, isCS, isOLA);
<span class="nc bnc" id="L1226" title="All 2 branches missed.">			} else if (&quot;Day Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1227">				agtMap = collectionDayWise(startDate, endDate, con, isDG, isSE,</span>
						isCS, isOLA, &quot;BO&quot;, 0);
			}
<span class="nc" id="L1230">		} catch (Exception e) {</span>
<span class="nc" id="L1231">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1233">			try {</span>
<span class="nc" id="L1234">				con.close();</span>
<span class="nc" id="L1235">			} catch (SQLException e) {</span>
<span class="nc" id="L1236">				e.printStackTrace();</span>
<span class="nc" id="L1237">			}</span>
<span class="nc" id="L1238">		}</span>
<span class="nc" id="L1239">		return agtMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionReportExpand(
			Timestamp startDate, Timestamp endDate, String reportType) {
<span class="nc" id="L1244">		System.out</span>
				.println(&quot;----------collectionReport----------reportType-----&quot;
						+ reportType);
<span class="nc" id="L1247">		Connection con = null;</span>
<span class="nc" id="L1248">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; agtMap = null;</span>
<span class="nc" id="L1249">		boolean isSE = false;</span>
<span class="nc" id="L1250">		boolean isDG = false;</span>
<span class="nc" id="L1251">		boolean isCS = false;</span>
<span class="nc" id="L1252">		boolean isOLA = false;</span>
		try {
<span class="nc" id="L1254">			con = DBConnect.getConnection();</span>
<span class="nc" id="L1255">			Map&lt;String, Boolean&gt; serMap = checkAvailableService();</span>
<span class="nc" id="L1256">			isSE = serMap.get(&quot;SE&quot;);</span>
<span class="nc" id="L1257">			isDG = serMap.get(&quot;DG&quot;);</span>
<span class="nc" id="L1258">			isCS = serMap.get(&quot;CS&quot;);</span>
<span class="nc" id="L1259">			isOLA = serMap.get(&quot;OLA&quot;);</span>
<span class="nc bnc" id="L1260" title="All 2 branches missed.">			if (&quot;Agent Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L1261">				agtMap = collectionAgentWiseExpand(startDate, endDate, con,</span>
						isDG, isSE, isCS, isOLA);
<span class="nc bnc" id="L1263" title="All 2 branches missed.">			} else if (&quot;Day Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L1264">				agtMap = collectionDayWiseExpand(startDate, endDate, con, isDG,</span>
						isSE, isCS, isOLA, &quot;BO&quot;, 0);
			}
<span class="nc" id="L1267">		} catch (Exception e) {</span>
<span class="nc" id="L1268">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1270">			try {</span>
<span class="nc" id="L1271">				con.close();</span>
<span class="nc" id="L1272">			} catch (SQLException e) {</span>
<span class="nc" id="L1273">				e.printStackTrace();</span>
<span class="nc" id="L1274">			}</span>
<span class="nc" id="L1275">		}</span>
<span class="nc" id="L1276">		return agtMap;</span>
	}

	public Map&lt;String, CompleteCollectionBean&gt; collectionReportForAgent(
			Timestamp startDate, Timestamp endDate, int agtOrgId,
			String reportType) {
<span class="nc" id="L1282">		System.out</span>
				.println(&quot;----------collectionReport----------reportType-----&quot;
						+ reportType);
<span class="nc" id="L1285">		Connection con = null;</span>
<span class="nc" id="L1286">		Map&lt;String, CompleteCollectionBean&gt; agtMap = null;</span>
<span class="nc" id="L1287">		boolean isSE = false;</span>
<span class="nc" id="L1288">		boolean isDG = false;</span>
<span class="nc" id="L1289">		boolean isCS = false;</span>
<span class="nc" id="L1290">		boolean isOLA = false;</span>
		try {
<span class="nc" id="L1292">			con = DBConnect.getConnection();</span>
<span class="nc" id="L1293">			Map&lt;String, Boolean&gt; serMap = checkAvailableService();</span>
<span class="nc" id="L1294">			isSE = serMap.get(&quot;SE&quot;);</span>
<span class="nc" id="L1295">			isDG = serMap.get(&quot;DG&quot;);</span>
<span class="nc" id="L1296">			isCS = serMap.get(&quot;CS&quot;);</span>
<span class="nc" id="L1297">			isOLA = serMap.get(&quot;OLA&quot;);</span>
<span class="nc bnc" id="L1298" title="All 2 branches missed.">			if (&quot;Retailer Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1299">				agtMap = collectionRetailerWise(startDate, endDate, con, isDG,</span>
						isSE, isCS, isOLA, agtOrgId);
<span class="nc bnc" id="L1301" title="All 2 branches missed.">			} else if (&quot;Agent Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1302">				agtMap = collectionAgentWise(startDate, endDate, con, isDG,</span>
						isSE, isCS, isOLA);
<span class="nc bnc" id="L1304" title="All 2 branches missed.">			} else if (&quot;Day Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1305">				agtMap = collectionDayWise(startDate, endDate, con, isDG, isSE,</span>
						isCS, isOLA, &quot;AGENT&quot;, agtOrgId);
			}
<span class="nc" id="L1308">		} catch (Exception e) {</span>
<span class="nc" id="L1309">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1311">			try {</span>
<span class="nc" id="L1312">				con.close();</span>
<span class="nc" id="L1313">			} catch (SQLException e) {</span>
<span class="nc" id="L1314">				e.printStackTrace();</span>
<span class="nc" id="L1315">			}</span>
<span class="nc" id="L1316">		}</span>
<span class="nc" id="L1317">		return agtMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionReportForAgentExpand(
			Timestamp startDate, Timestamp endDate, String reportType,
			int agtOrgId) {
<span class="nc" id="L1323">		System.out</span>
				.println(&quot;----------collectionReport----------reportType-----&quot;
						+ reportType);
<span class="nc" id="L1326">		Connection con = null;</span>
<span class="nc" id="L1327">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; agtMap = null;</span>
<span class="nc" id="L1328">		boolean isSE = false;</span>
<span class="nc" id="L1329">		boolean isDG = false;</span>
<span class="nc" id="L1330">		boolean isCS = false;</span>
<span class="nc" id="L1331">		boolean isOLA = false;</span>
		try {
<span class="nc" id="L1333">			con = DBConnect.getConnection();</span>
<span class="nc" id="L1334">			Map&lt;String, Boolean&gt; serMap = checkAvailableService();</span>
<span class="nc" id="L1335">			isSE = serMap.get(&quot;SE&quot;);</span>
<span class="nc" id="L1336">			isDG = serMap.get(&quot;DG&quot;);</span>
<span class="nc" id="L1337">			isCS = serMap.get(&quot;CS&quot;);</span>
<span class="nc" id="L1338">			isOLA = serMap.get(&quot;OLA&quot;);</span>
<span class="nc bnc" id="L1339" title="All 2 branches missed.">			if (&quot;Retailer Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L1340">				agtMap = collectionRetailerWiseExpand(startDate, endDate, con,</span>
						isDG, isSE, isCS, isOLA, agtOrgId);
<span class="nc bnc" id="L1342" title="All 2 branches missed.">			} else if (&quot;Day Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L1343">				agtMap = collectionDayWiseExpand(startDate, endDate, con, isDG,</span>
						isSE, isCS, isOLA, &quot;AGENT&quot;, agtOrgId);
			}
<span class="nc" id="L1346">		} catch (Exception e) {</span>
<span class="nc" id="L1347">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1349">			try {</span>
<span class="nc" id="L1350">				con.close();</span>
<span class="nc" id="L1351">			} catch (SQLException e) {</span>
<span class="nc" id="L1352">				e.printStackTrace();</span>
<span class="nc" id="L1353">			}</span>
<span class="nc" id="L1354">		}</span>
<span class="nc" id="L1355">		return agtMap;</span>
	}

	public Map&lt;String, CompleteCollectionBean&gt; collectionRetailerWise(
			Timestamp startDate, Timestamp endDate, Connection con,
			boolean isDG, boolean isSE, boolean isCS, boolean isOLA,
			int agtOrgId) {
<span class="nc" id="L1362">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1363">		ResultSet rsGame = null;</span>
<span class="nc" id="L1364">		ResultSet rs = null;</span>
<span class="nc" id="L1365">		ResultSet rsRetOrg = null;</span>
<span class="nc" id="L1366">		Map&lt;String, CompleteCollectionBean&gt; agtMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1367">		CompleteCollectionBean collBean = null;</span>

<span class="nc" id="L1369">		String agtOrgQry = null;</span>

<span class="nc bnc" id="L1371" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L1372">			return agtMap;</span>
		}

		// for scratch game
		try {

<span class="nc bnc" id="L1378" title="All 2 branches missed.">			if (agtOrgId == 0) {</span>
<span class="nc" id="L1379">				agtOrgQry = &quot;select name,organization_id from st_lms_organization_master where organization_type='RETAILER' order by name&quot;;</span>
			} else {
<span class="nc" id="L1381">				agtOrgQry = &quot;select name,organization_id from st_lms_organization_master where parent_id=&quot;</span>
						+ agtOrgId + &quot; order by name&quot;;

			}
<span class="nc" id="L1385">			pstmt = con.prepareStatement(agtOrgQry);</span>
<span class="nc" id="L1386">			rsRetOrg = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1387" title="All 2 branches missed.">			while (rsRetOrg.next()) {</span>
<span class="nc" id="L1388">				collBean = new CompleteCollectionBean();</span>
<span class="nc" id="L1389">				collBean.setOrgName(rsRetOrg.getString(&quot;name&quot;));</span>
<span class="nc bnc" id="L1390" title="All 2 branches missed.">				if (isDG) {</span>
<span class="nc" id="L1391">					collBean.setDrawSale(0.0);</span>
<span class="nc" id="L1392">					collBean.setDrawPwt(0.0);</span>
<span class="nc" id="L1393">					collBean.setDrawCancel(0.0);</span>
<span class="nc" id="L1394">					collBean.setDrawDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L1396" title="All 2 branches missed.">				if (isSE) {</span>
<span class="nc" id="L1397">					collBean.setScratchSale(0.0);</span>
<span class="nc" id="L1398">					collBean.setScratchPwt(0.0);</span>
<span class="nc" id="L1399">					collBean.setScratchDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L1401" title="All 2 branches missed.">				if (isSE) {</span>
<span class="nc" id="L1402">					collBean.setCSSale(0.0);</span>
<span class="nc" id="L1403">					collBean.setCSCancel(0.0);</span>
				}
<span class="nc" id="L1405">				agtMap.put(rsRetOrg.getString(&quot;organization_id&quot;), collBean);</span>
			}
<span class="nc" id="L1407">			agtOrgQry = agtOrgQry.replace(&quot;name,&quot;, &quot;&quot;);</span>
<span class="nc" id="L1408">			StringBuilder unionQuery = null;</span>
<span class="nc" id="L1409">			StringBuilder mainQuery = null;</span>
<span class="nc bnc" id="L1410" title="All 2 branches missed.">			if (isDG) {</span>
				// Game Master Query
<span class="nc" id="L1412">				String addQry = &quot;&quot;;</span>
<span class="nc bnc" id="L1413" title="All 2 branches missed.">				if (agtOrgId != 0)</span>
<span class="nc" id="L1414">					addQry = &quot;and om.parent_id=&quot; + agtOrgId;</span>

<span class="nc" id="L1416">				String gameQry = &quot;select game_id from st_dg_game_master&quot;;</span>
<span class="nc" id="L1417">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1418">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L1419" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1420">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1421">					String dgQuery = &quot;select sale.organization_id,sale,cancel,pwt from (select organization_id,ifnull(sale,0.0) sale from st_lms_organization_master om left outer join (select drs.retailer_org_id,sum(mrp_amt) as sale from st_dg_ret_sale_&quot;</span>
							+ gameNo
							+ &quot; drs inner join st_lms_retailer_transaction_master rtm on drs.transaction_id=rtm.transaction_id where rtm.transaction_type in('DG_SALE','DG_SALE_OFFLINE') and rtm.transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and rtm.transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' group by drs.retailer_org_id) sale on om.organization_id=retailer_org_id where om.organization_type='RETAILER' &quot;
							+ addQry
							+ &quot;) sale inner join (select organization_id,ifnull(cancel,0.0) cancel from st_lms_organization_master om left outer join (select drs.retailer_org_id,sum(mrp_amt) as cancel from st_dg_ret_sale_refund_&quot;
							+ gameNo
							+ &quot; drs inner join st_lms_retailer_transaction_master rtm on drs.transaction_id=rtm.transaction_id where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' group by drs.retailer_org_id) cancel on om.organization_id=retailer_org_id where om.organization_type='RETAILER'  &quot;
							+ addQry
							+ &quot;) cancel inner join (select organization_id,ifnull(pwt,0.0) pwt from st_lms_organization_master om left outer join (select drs.retailer_org_id,sum(pwt_amt+retailer_claim_comm) as pwt from st_dg_ret_pwt_&quot;
							+ gameNo
							+ &quot; drs inner join st_lms_retailer_transaction_master rtm on drs.transaction_id=rtm.transaction_id where transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' group by drs.retailer_org_id) pwt on om.organization_id=retailer_org_id where om.organization_type='RETAILER'  &quot;
							+ addQry
							+ &quot;) pwt on  sale.organization_id=cancel.organization_id and sale.organization_id=pwt.organization_id and pwt.organization_id=cancel.organization_id &quot;;

<span class="nc bnc" id="L1447" title="All 2 branches missed.">					if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1448">						mainQuery = new StringBuilder(</span>
								&quot;select main.organization_id,sum(main.sale)as sale,sum(main.cancel)as cancel,sum(main.pwt)as pwt from (&quot;);
<span class="nc" id="L1450">						unionQuery = new StringBuilder(</span>
								&quot;union all select dgr.organization_id as organization_id,sum(dgr.sale_mrp) as sale ,sum(dgr.ref_sale_mrp) cancel, sum(dgr.pwt_mrp) pwt  from  st_rep_dg_retailer as dgr  where  dgr.game_id=&quot;
										+ gameNo
										+ &quot; and dgr.parent_id=&quot;
										+ agtOrgId
										+ &quot; and dgr.finaldate&gt;=date('&quot;
										+ startDate
										+ &quot;') and dgr.finaldate&lt;=date('&quot;
										+ endDate
										+ &quot;') group by dgr.organization_id)as main group by main.organization_id &quot;);

<span class="nc" id="L1461">						pstmt = con.prepareStatement(mainQuery.append(dgQuery)</span>
								.append(unionQuery.toString()).toString());
					} else {
<span class="nc" id="L1464">						pstmt = con.prepareStatement(dgQuery.toString());</span>
					}

<span class="nc" id="L1467">					logger.debug(&quot;-------Draw Game Query------\n&quot; + pstmt);</span>
<span class="nc" id="L1468">					rs = pstmt.executeQuery();</span>
<span class="nc" id="L1469">					String retOrgId = null;</span>
<span class="nc bnc" id="L1470" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1471">						retOrgId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L1472">						double sale = agtMap.get(retOrgId).getDrawSale()</span>
								+ rs.getDouble(&quot;sale&quot;);
<span class="nc" id="L1474">						agtMap.get(retOrgId).setDrawSale(sale);</span>
<span class="nc" id="L1475">						agtMap.get(retOrgId).setDrawCancel(</span>
								agtMap.get(retOrgId).getDrawCancel()
										+ rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L1478">						agtMap.get(retOrgId).setDrawPwt(</span>
								agtMap.get(retOrgId).getDrawPwt()
										+ rs.getDouble(&quot;pwt&quot;));
<span class="nc" id="L1481">					}</span>
<span class="nc" id="L1482">				}</span>

			}

<span class="nc bnc" id="L1486" title="All 2 branches missed.">			if (isSE) {</span>
				// Game Master Query
<span class="nc" id="L1488">				String gameQry = &quot;select game_id from st_se_game_master&quot;;</span>
<span class="nc" id="L1489">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1490">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L1491">				String saleQry = &quot;&quot;;</span>
<span class="nc" id="L1492">				String cancelQry = &quot;&quot;;</span>
<span class="nc" id="L1493">				String seQuery = &quot;&quot;;</span>
<span class="nc bnc" id="L1494" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1495">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>

<span class="nc bnc" id="L1497" title="All 2 branches missed.">					if (&quot;BOOK_WISE&quot;</span>
							.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L1499">						saleQry = &quot;select organization_id,ifnull(sale,0.0) sale from st_lms_organization_master om left outer join (select retailer_org_id,parent_id,sum(mrp_amt) sale from st_se_agent_retailer_transaction at inner join st_lms_agent_transaction_master tm inner join st_lms_organization_master om on at.transaction_id=tm.transaction_id and retailer_org_id=organization_id where  tm.transaction_type='SALE' and transaction_date&gt;='&quot;</span>
								+ startDate
								+ &quot;' and transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' and game_id=&quot;
								+ gameNo
								+ &quot; and parent_id=&quot;
								+ agtOrgId
								+ &quot; group by retailer_org_id) sale on retailer_org_id=organization_id where organization_type='RETAILER' and om.parent_id=&quot;
								+ agtOrgId;
<span class="nc" id="L1509">						cancelQry = &quot;select organization_id,ifnull(cancel,0.0) cancel from st_lms_organization_master left outer join (select retailer_org_id,sum(mrp_amt) mrpAmtRet,sum(mrp_amt) cancel from st_se_agent_retailer_transaction at inner join st_lms_agent_transaction_master tm on at.transaction_id=tm.transaction_id where  tm.transaction_type='SALE_RET' and transaction_date&gt;='&quot;</span>
								+ startDate
								+ &quot;' and transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' and game_id=1 group by retailer_org_id) cancel on organization_id=retailer_org_id where organization_type='RETAILER' and parent_id=&quot;
								+ agtOrgId;
<span class="nc bnc" id="L1515" title="All 2 branches missed.">					} else if (&quot;TICKET_WISE&quot;</span>
							.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L1517">						saleQry = &quot;select organization_id,ifnull(sale,0.0) sale from st_lms_organization_master left outer join (select current_owner_id , sum(soldTkt*ticket_price)  mrpAmt,sum(soldTkt*ticket_price) sale from st_se_game_master gm,st_se_game_inv_detail gid,(select game_id,book_nbr,sum(sold_tickets) soldTkt from st_se_game_ticket_inv_history where date&gt;='&quot;</span>
								+ startDate
								+ &quot;' and date&lt;='&quot;
								+ endDate
								+ &quot;' and current_owner='RETAILER' and game_id=&quot;
								+ gameNo
								+ &quot; group by book_nbr) TktTlb where gm.game_id=TktTlb.game_id and TktTlb.book_nbr=gid.book_nbr and gid.current_owner='RETAILER' group by current_owner_id) saleTlb on organization_id=current_owner_id where organization_type='RETAILER' and parent_id=&quot;
								+ agtOrgId;
<span class="nc" id="L1525">						cancelQry = &quot;select organization_id,0.00 cancel from st_lms_organization_master where organization_type='RETAILER' and parent_id=&quot;</span>
								+ agtOrgId;
					}
<span class="nc" id="L1528">					seQuery = &quot;select sale.organization_id,sale,cancel,pwt from (&quot;</span>
							+ saleQry
							+ &quot;) sale inner join (&quot;
							+ cancelQry
							+ &quot;) cancel inner join (select organization_id,ifnull(pwt,0.0) pwt from st_lms_organization_master left outer join (select rp.retailer_org_id ,sum(pwt_amt) pwt from st_se_retailer_pwt rp inner join st_lms_retailer_transaction_master tm on rp.transaction_id=tm.transaction_id where transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and transaction_type='PWT' and rp.game_id=&quot;
							+ gameNo
							+ &quot; group by rp.retailer_org_id union all select retailer_org_id,sum(pwt_amt) pwt from st_se_agent_pwt ap inner join st_lms_agent_transaction_master tm on ap.transaction_id=tm.transaction_id where transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and transaction_type='PWT' and ap.game_id=&quot;
							+ gameNo
							+ &quot; group by retailer_org_id) pwt on organization_id=retailer_org_id where organization_type='RETAILER' and parent_id=&quot;
							+ agtOrgId
							+ &quot;)  pwt on sale.organization_id=cancel.organization_id and sale.organization_id=pwt.organization_id and cancel.organization_id=pwt.organization_id&quot;;

<span class="nc bnc" id="L1548" title="All 2 branches missed.">					if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1549">						mainQuery = new StringBuilder(</span>
								&quot;select main.organization_id,sum(main.sale) as sale ,sum(main.cancel) as cancel,sum(main.pwt) as pwt from (&quot;);
<span class="nc bnc" id="L1551" title="All 2 branches missed.">						if (&quot;BOOK_WISE&quot;</span>
								.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L1553">							unionQuery = new StringBuilder(</span>
									&quot; union all select organization_id,sum(sale_book_mrp) as sale,sum(ref_sale_mrp) as cancel,sum(pwt_mrp)as pwt from st_rep_se_retailer where game_id=&quot;
											+ gameNo
											+ &quot; and parent_id=&quot;
											+ agtOrgId
											+ &quot; and finaldate&gt;=date('&quot;
											+ startDate
											+ &quot;') and finaldate&lt;=date('&quot;
											+ endDate
											+ &quot;') group by organization_id)as main group by main.organization_id &quot;);
<span class="nc bnc" id="L1563" title="All 2 branches missed.">						} else if (&quot;TICKET_WISE&quot;</span>
								.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L1565">							unionQuery = new StringBuilder(</span>
									&quot; union all select organization_id,sum(sale_ticket_mrp) as sale,0.0 as cancel,sum(pwt_mrp)as pwt from st_rep_se_retailer where game_id=&quot;
											+ gameNo
											+ &quot; and parent_id=&quot;
											+ agtOrgId
											+ &quot; and finaldate&gt;=date('&quot;
											+ startDate
											+ &quot;') and finaldate&lt;=date('&quot;
											+ endDate
											+ &quot;') group by organization_id)as main group by main.organization_id&quot;);
						}

<span class="nc" id="L1577">						pstmt = con.prepareStatement(mainQuery.append(seQuery)</span>
								.append(unionQuery).toString());
					} else {
<span class="nc" id="L1580">						pstmt = con.prepareStatement(seQuery);</span>
					}

<span class="nc" id="L1583">					logger.debug(&quot;-------Scratch Game Query------\n&quot; + pstmt);</span>
<span class="nc" id="L1584">					rs = pstmt.executeQuery();</span>
<span class="nc" id="L1585">					String retOrgId = null;</span>
<span class="nc bnc" id="L1586" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1587">						retOrgId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L1588">						double sale = agtMap.get(retOrgId).getScratchSale()</span>
								+ (rs.getDouble(&quot;sale&quot;) - rs
										.getDouble(&quot;cancel&quot;));
<span class="nc" id="L1591">						agtMap.get(retOrgId).setScratchSale(sale);</span>
<span class="nc" id="L1592">						agtMap.get(retOrgId).setScratchPwt(</span>
								agtMap.get(retOrgId).getScratchPwt()
										+ rs.getDouble(&quot;pwt&quot;));
<span class="nc" id="L1595">					}</span>
<span class="nc" id="L1596">				}</span>
			}
<span class="nc bnc" id="L1598" title="All 2 branches missed.">			if (isCS) {</span>
				// Category Master Query
<span class="nc" id="L1600">				String catQry = &quot;select category_id from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L1601">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L1602">				rsGame = prodPstmt.executeQuery();</span>

<span class="nc bnc" id="L1604" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1605">					int catId = rsGame.getInt(&quot;category_id&quot;);</span>
<span class="nc" id="L1606">					String addQry = &quot;&quot;;</span>
<span class="nc bnc" id="L1607" title="All 2 branches missed.">					if (agtOrgId != 0)</span>
<span class="nc" id="L1608">						addQry = &quot;and om.parent_id=&quot; + agtOrgId;</span>

<span class="nc" id="L1610">					String csQuery = &quot;select sale.organization_id,sale,cancel from (select organization_id,ifnull(sale,0.0) sale from st_lms_organization_master om left outer join (select cs.retailer_org_id,sum(mrp_amt) as sale from st_cs_sale_&quot;</span>
							+ catId
							+ &quot; cs inner join st_lms_retailer_transaction_master rtm on cs.transaction_id=rtm.transaction_id where rtm.transaction_type ='CS_SALE' and rtm.transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and rtm.transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' group by cs.retailer_org_id) sale on om.organization_id=retailer_org_id where om.organization_type='RETAILER' &quot;
							+ addQry
							+ &quot;) sale inner join (select organization_id,ifnull(cancel,0.0) cancel from st_lms_organization_master om left outer join (select cs.retailer_org_id,sum(mrp_amt) as cancel from st_cs_refund_&quot;
							+ catId
							+ &quot; cs inner join st_lms_retailer_transaction_master rtm on cs.transaction_id=rtm.transaction_id where transaction_type in('CS_CANCEL_SERVER','CS_CANCEL_RET') and transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' group by cs.retailer_org_id) cancel on om.organization_id=retailer_org_id where om.organization_type='RETAILER'  &quot;
							+ addQry
							+ &quot;) cancel on sale.organization_id=cancel.organization_id&quot;;

<span class="nc bnc" id="L1628" title="All 2 branches missed.">					if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1629">						mainQuery = new StringBuilder(</span>
								&quot;select main.organization_id,sum(main.sale)as sale,sum(main.cancel)as cancel from (&quot;);
<span class="nc" id="L1631">						unionQuery = new StringBuilder(</span>
								&quot; union all select organization_id,sum(sale_mrp) as sale ,sum(ref_sale_mrp) cancel  from  st_rep_cs_retailer where  category_id=&quot;
										+ catId
										+ &quot; and parent_id=&quot;
										+ agtOrgId
										+ &quot; and finaldate&gt;=date('&quot;
										+ startDate
										+ &quot;') and finaldate&lt;=date('&quot;
										+ endDate
										+ &quot;') group by organization_id)as main group by main.organization_id &quot;);
<span class="nc" id="L1641">						pstmt = con.prepareStatement(mainQuery.append(csQuery)</span>
								.append(unionQuery.toString()).toString());
					}

<span class="nc" id="L1645">					logger.debug(&quot;-------Comm Service Query------\n&quot; + pstmt);</span>
<span class="nc" id="L1646">					rs = pstmt.executeQuery();</span>
<span class="nc" id="L1647">					String retOrgId = null;</span>
<span class="nc bnc" id="L1648" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1649">						retOrgId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L1650">						agtMap.get(retOrgId).setCSSale(</span>
								agtMap.get(retOrgId).getCSSale()
										+ rs.getDouble(&quot;sale&quot;));
<span class="nc" id="L1653">						agtMap.get(retOrgId).setCSCancel(</span>
								agtMap.get(retOrgId).getCSCancel()
										+ rs.getDouble(&quot;cancel&quot;));
					}
<span class="nc" id="L1657">				}</span>

			}
<span class="nc" id="L1660">		} catch (Exception e) {</span>
<span class="nc" id="L1661">			e.printStackTrace();</span>
<span class="nc" id="L1662">		}</span>
<span class="nc" id="L1663">		return agtMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionRetailerWiseExpand(
			Timestamp startDate, Timestamp endDate, Connection con,
			boolean isDG, boolean isSE, boolean isCS, boolean isOLA,
			int agtOrgId) {
<span class="nc" id="L1670">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1671">		ResultSet rsGame = null;</span>
<span class="nc" id="L1672">		ResultSet rs = null;</span>
<span class="nc" id="L1673">		ResultSet rsRetOrg = null;</span>
<span class="nc" id="L1674">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; serGameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;();</span>
<span class="nc" id="L1675">		Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt; gameAgtMap = null;</span>
<span class="nc bnc" id="L1676" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L1677">			return serGameAgtMap;</span>
		}
		try {

			// Get All Agent
<span class="nc" id="L1682">			String agtOrgQry = &quot;select name,organization_id from st_lms_organization_master where parent_id=&quot;</span>
					+ agtOrgId + &quot; order by name&quot;;
<span class="nc" id="L1684">			pstmt = con.prepareStatement(agtOrgQry);</span>
<span class="nc" id="L1685">			rsRetOrg = pstmt.executeQuery();</span>
<span class="nc" id="L1686">			StringBuilder unionQuery = null;</span>
<span class="nc" id="L1687">			StringBuilder mainQuery = null;</span>
<span class="nc bnc" id="L1688" title="All 2 branches missed.">			if (isDG) {</span>
<span class="nc" id="L1689">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
				// Game Master Query

				// Game Master Query
<span class="nc" id="L1693">				String addQry = &quot;&quot;;</span>
<span class="nc bnc" id="L1694" title="All 2 branches missed.">				if (agtOrgId != 0)</span>
<span class="nc" id="L1695">					addQry = &quot;and om.parent_id=&quot; + agtOrgId;</span>

<span class="nc" id="L1697">				String gameQry = &quot;select game_id,game_name from st_dg_game_master&quot;;</span>
<span class="nc" id="L1698">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1699">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L1700" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1701">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1702">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1703">					gameMap.putAll(getAgentMap(rsRetOrg, isDG, isSE, isCS,</span>
							isOLA));
<span class="nc" id="L1705">					String dgQuery = &quot;select sale.organization_id,sale,cancel,pwt from (select organization_id,ifnull(sale,0.0) sale from st_lms_organization_master om left outer join (select drs.retailer_org_id,sum(mrp_amt) as sale from st_dg_ret_sale_&quot;</span>
							+ gameNo
							+ &quot; drs inner join st_lms_retailer_transaction_master rtm on drs.transaction_id=rtm.transaction_id where rtm.transaction_type in('DG_SALE','DG_SALE_OFFLINE') and rtm.transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and rtm.transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' group by drs.retailer_org_id) sale on om.organization_id=retailer_org_id where om.organization_type='RETAILER' &quot;
							+ addQry
							+ &quot;) sale inner join (select organization_id,ifnull(cancel,0.0) cancel from st_lms_organization_master om left outer join (select drs.retailer_org_id,sum(mrp_amt) as cancel from st_dg_ret_sale_refund_&quot;
							+ gameNo
							+ &quot; drs inner join st_lms_retailer_transaction_master rtm on drs.transaction_id=rtm.transaction_id where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' group by drs.retailer_org_id) cancel on om.organization_id=retailer_org_id where om.organization_type='RETAILER'  &quot;
							+ addQry
							+ &quot;) cancel inner join (select organization_id,ifnull(pwt,0.0) pwt from st_lms_organization_master om left outer join (select drs.retailer_org_id,sum(pwt_amt+retailer_claim_comm) as pwt from st_dg_ret_pwt_&quot;
							+ gameNo
							+ &quot; drs inner join st_lms_retailer_transaction_master rtm on drs.transaction_id=rtm.transaction_id where transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' group by drs.retailer_org_id) pwt on om.organization_id=retailer_org_id where om.organization_type='RETAILER'  &quot;
							+ addQry
							+ &quot;) pwt on  sale.organization_id=cancel.organization_id and sale.organization_id=pwt.organization_id and pwt.organization_id=cancel.organization_id &quot;;

<span class="nc bnc" id="L1731" title="All 2 branches missed.">					if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1732">						mainQuery = new StringBuilder(</span>
								&quot;select main.organization_id,sum(main.sale)as sale,sum(main.cancel)as cancel,sum(main.pwt)as pwt from (&quot;);
<span class="nc" id="L1734">						unionQuery = new StringBuilder(</span>
								&quot;union all select dgr.organization_id as organization_id,sum(dgr.sale_mrp) as sale ,sum(dgr.ref_sale_mrp) cancel, sum(dgr.pwt_mrp) pwt  from  st_rep_dg_retailer as dgr  where  dgr.game_id=&quot;
										+ gameNo
										+ &quot; and dgr.parent_id=&quot;
										+ agtOrgId
										+ &quot; and dgr.finaldate&gt;=date('&quot;
										+ startDate
										+ &quot;') and dgr.finaldate&lt;=date('&quot;
										+ endDate
										+ &quot;') group by dgr.organization_id)as main group by main.organization_id &quot;);

<span class="nc" id="L1745">						pstmt = con.prepareStatement(mainQuery.append(dgQuery)</span>
								.append(unionQuery.toString()).toString());
					} else {
<span class="nc" id="L1748">						pstmt = con.prepareStatement(dgQuery.toString());</span>
					}

<span class="nc" id="L1751">					logger.debug(&quot;-------Draw Game Query------\n&quot; + pstmt);</span>
<span class="nc" id="L1752">					rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L1754" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1755">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L1756">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L1757">						gameMap.get(agtId)</span>
								.setDrawCancel(rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L1759">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>

<span class="nc" id="L1761">					}</span>
<span class="nc" id="L1762">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L1763">				}</span>

<span class="nc" id="L1765">				serGameAgtMap.put(&quot;DG&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L1767" title="All 2 branches missed.">			if (isSE) {</span>
<span class="nc" id="L1768">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
				// Game Master Query

				// Game Master Query
<span class="nc" id="L1772">				String gameQry = &quot;select game_id,game_name from st_se_game_master&quot;;</span>
<span class="nc" id="L1773">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1774">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L1775">				String saleQry = &quot;&quot;;</span>
<span class="nc" id="L1776">				String cancelQry = &quot;&quot;;</span>
<span class="nc" id="L1777">				String seQuery = &quot;&quot;;</span>
<span class="nc bnc" id="L1778" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1779">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1780">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1781">					gameMap.putAll(getAgentMap(rsRetOrg, isDG, isSE, isCS,</span>
							isOLA));

<span class="nc bnc" id="L1784" title="All 2 branches missed.">					if (&quot;BOOK_WISE&quot;</span>
							.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L1786">						saleQry = &quot;select organization_id,ifnull(sale,0.0) sale from st_lms_organization_master om left outer join (select retailer_org_id,parent_id,sum(mrp_amt) sale from st_se_agent_retailer_transaction at inner join st_lms_agent_transaction_master tm inner join st_lms_organization_master om on at.transaction_id=tm.transaction_id and retailer_org_id=organization_id where  tm.transaction_type='SALE' and transaction_date&gt;='&quot;</span>
								+ startDate
								+ &quot;' and transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' and game_id=&quot;
								+ gameNo
								+ &quot; and parent_id=&quot;
								+ agtOrgId
								+ &quot; group by retailer_org_id) sale on retailer_org_id=organization_id where organization_type='RETAILER' and om.parent_id=&quot;
								+ agtOrgId;
<span class="nc" id="L1796">						cancelQry = &quot;select organization_id,ifnull(cancel,0.0) cancel from st_lms_organization_master left outer join (select retailer_org_id,sum(mrp_amt) mrpAmtRet,sum(mrp_amt) cancel from st_se_agent_retailer_transaction at inner join st_lms_agent_transaction_master tm on at.transaction_id=tm.transaction_id where  tm.transaction_type='SALE_RET' and transaction_date&gt;='&quot;</span>
								+ startDate
								+ &quot;' and transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' and game_id=1 group by retailer_org_id) cancel on organization_id=retailer_org_id where organization_type='RETAILER' and parent_id=&quot;
								+ agtOrgId;
<span class="nc bnc" id="L1802" title="All 2 branches missed.">					} else if (&quot;TICKET_WISE&quot;</span>
							.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L1804">						saleQry = &quot;select organization_id,ifnull(sale,0.0) sale from st_lms_organization_master left outer join (select current_owner_id , sum(soldTkt*ticket_price)  mrpAmt,sum(soldTkt*ticket_price) sale from st_se_game_master gm,st_se_game_inv_detail gid,(select game_id,book_nbr,sum(sold_tickets) soldTkt from st_se_game_ticket_inv_history where date&gt;='&quot;</span>
								+ startDate
								+ &quot;' and date&lt;='&quot;
								+ endDate
								+ &quot;' and current_owner='RETAILER' and game_id=&quot;
								+ gameNo
								+ &quot; group by book_nbr) TktTlb where gm.game_id=TktTlb.game_id and TktTlb.book_nbr=gid.book_nbr and gid.current_owner='RETAILER' group by current_owner_id) saleTlb on organization_id=current_owner_id where organization_type='RETAILER' and parent_id=&quot;
								+ agtOrgId;
<span class="nc" id="L1812">						cancelQry = &quot;select organization_id,0.00 cancel from st_lms_organization_master where organization_type='RETAILER' and parent_id=&quot;</span>
								+ agtOrgId;
					}
<span class="nc" id="L1815">					seQuery = &quot;select sale.organization_id,sale,cancel,pwt from (&quot;</span>
							+ saleQry
							+ &quot;) sale inner join (&quot;
							+ cancelQry
							+ &quot;) cancel inner join (select organization_id,ifnull(pwt,0.0) pwt from st_lms_organization_master left outer join (select rp.retailer_org_id ,sum(pwt_amt) pwt from st_se_retailer_pwt rp inner join st_lms_retailer_transaction_master tm on rp.transaction_id=tm.transaction_id where transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and transaction_type='PWT' and rp.game_id=&quot;
							+ gameNo
							+ &quot; group by rp.retailer_org_id union all select retailer_org_id,sum(pwt_amt) pwt from st_se_agent_pwt ap inner join st_lms_agent_transaction_master tm on ap.transaction_id=tm.transaction_id where transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and transaction_type='PWT' and ap.game_id=&quot;
							+ gameNo
							+ &quot; group by retailer_org_id) pwt on organization_id=retailer_org_id where organization_type='RETAILER' and parent_id=&quot;
							+ agtOrgId
							+ &quot;)  pwt on sale.organization_id=cancel.organization_id and sale.organization_id=pwt.organization_id and cancel.organization_id=pwt.organization_id&quot;;

<span class="nc bnc" id="L1835" title="All 2 branches missed.">					if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1836">						mainQuery = new StringBuilder(</span>
								&quot;select main.organization_id,sum(main.sale) as sale ,sum(main.cancel) as cancel,sum(main.pwt) as pwt from (&quot;);
<span class="nc bnc" id="L1838" title="All 2 branches missed.">						if (&quot;BOOK_WISE&quot;</span>
								.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L1840">							unionQuery = new StringBuilder(</span>
									&quot; union all select organization_id,sum(sale_book_mrp) as sale,sum(ref_sale_mrp) as cancel,sum(pwt_mrp)as pwt from st_rep_se_retailer where game_id=&quot;
											+ gameNo
											+ &quot; and parent_id=&quot;
											+ agtOrgId
											+ &quot; and finaldate&gt;=date('&quot;
											+ startDate
											+ &quot;') and finaldate&lt;=date('&quot;
											+ endDate
											+ &quot;') group by organization_id)as main group by main.organization_id &quot;);
<span class="nc bnc" id="L1850" title="All 2 branches missed.">						} else if (&quot;TICKET_WISE&quot;</span>
								.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L1852">							unionQuery = new StringBuilder(</span>
									&quot; union all select organization_id,sum(sale_ticket_mrp) as sale,0.0 as cancel,sum(pwt_mrp)as pwt from st_rep_se_retailer where game_id=&quot;
											+ gameNo
											+ &quot; and parent_id=&quot;
											+ agtOrgId
											+ &quot; and finaldate&gt;=date('&quot;
											+ startDate
											+ &quot;') and finaldate&lt;=date('&quot;
											+ endDate
											+ &quot;') group by organization_id)as main group by main.organization_id&quot;);
						}

<span class="nc" id="L1864">						pstmt = con.prepareStatement(mainQuery.append(seQuery)</span>
								.append(unionQuery).toString());
					} else {
<span class="nc" id="L1867">						pstmt = con.prepareStatement(seQuery);</span>
					}

<span class="nc" id="L1870">					logger.debug(&quot;-------Scratch Game Query------\n&quot; + pstmt);</span>
<span class="nc" id="L1871">					rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L1873" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1874">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L1875">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L1876">						gameMap.get(agtId)</span>
								.setDrawCancel(rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L1878">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>

<span class="nc" id="L1880">					}</span>
<span class="nc" id="L1881">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L1882">				}</span>

<span class="nc" id="L1884">				serGameAgtMap.put(&quot;SE&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L1886" title="All 2 branches missed.">			if (isCS) {</span>
<span class="nc" id="L1887">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
				// Category Master Query
<span class="nc" id="L1889">				String catQry = &quot;select category_id,category_code from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L1890">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L1891">				rsGame = prodPstmt.executeQuery();</span>

<span class="nc bnc" id="L1893" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1894">					int catId = rsGame.getInt(&quot;category_id&quot;);</span>
<span class="nc" id="L1895">					Map&lt;String, CompleteCollectionBean&gt; prodMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1896">					prodMap.putAll(getAgentMap(rsRetOrg, isDG, isSE, isCS,</span>
							isOLA));
<span class="nc" id="L1898">					String addQry = &quot;&quot;;</span>
<span class="nc bnc" id="L1899" title="All 2 branches missed.">					if (agtOrgId != 0)</span>
<span class="nc" id="L1900">						addQry = &quot;and om.parent_id=&quot; + agtOrgId;</span>

<span class="nc" id="L1902">					String csQuery = &quot;select sale.organization_id,sale,cancel from (select organization_id,ifnull(sale,0.0) sale from st_lms_organization_master om left outer join (select cs.retailer_org_id,sum(mrp_amt) as sale from st_cs_sale_&quot;</span>
							+ catId
							+ &quot; cs inner join st_lms_retailer_transaction_master rtm on cs.transaction_id=rtm.transaction_id where rtm.transaction_type ='CS_SALE' and rtm.transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and rtm.transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' group by cs.retailer_org_id) sale on om.organization_id=retailer_org_id where om.organization_type='RETAILER' &quot;
							+ addQry
							+ &quot;) sale inner join (select organization_id,ifnull(cancel,0.0) cancel from st_lms_organization_master om left outer join (select cs.retailer_org_id,sum(mrp_amt) as cancel from st_cs_refund_&quot;
							+ catId
							+ &quot; cs inner join st_lms_retailer_transaction_master rtm on cs.transaction_id=rtm.transaction_id where transaction_type in('CS_CANCEL_SERVER','CS_CANCEL_RET') and transaction_date&gt;='&quot;
							+ startDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' group by cs.retailer_org_id) cancel on om.organization_id=retailer_org_id where om.organization_type='RETAILER'  &quot;
							+ addQry
							+ &quot;) cancel on sale.organization_id=cancel.organization_id&quot;;

<span class="nc bnc" id="L1920" title="All 2 branches missed.">					if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1921">						mainQuery = new StringBuilder(</span>
								&quot;select main.organization_id,sum(main.sale)as sale,sum(main.cancel)as cancel from (&quot;);
<span class="nc" id="L1923">						unionQuery = new StringBuilder(</span>
								&quot; union all select organization_id,sum(sale_mrp) as sale ,sum(ref_sale_mrp) cancel  from  st_rep_cs_retailer where  category_id=&quot;
										+ catId
										+ &quot; and parent_id=&quot;
										+ agtOrgId
										+ &quot; and finaldate&gt;=date('&quot;
										+ startDate
										+ &quot;') and finaldate&lt;=date('&quot;
										+ endDate
										+ &quot;') group by organization_id)as main group by main.organization_id &quot;);
<span class="nc" id="L1933">						pstmt = con.prepareStatement(mainQuery.append(csQuery)</span>
								.append(unionQuery.toString()).toString());
					}

<span class="nc" id="L1937">					logger.debug(&quot;-------Comm Service Query------\n&quot; + pstmt);</span>
<span class="nc" id="L1938">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1939" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1940">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L1941">						prodMap.get(agtId).setCSSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L1942">						prodMap.get(agtId).setCSCancel(rs.getDouble(&quot;cancel&quot;));</span>
<span class="nc" id="L1943">					}</span>
<span class="nc" id="L1944">					gameAgtMap.put(rsGame.getString(&quot;category_code&quot;), prodMap);</span>
<span class="nc" id="L1945">				}</span>

<span class="nc" id="L1947">				serGameAgtMap.put(&quot;CS&quot;, gameAgtMap);</span>

			}
<span class="nc" id="L1950">			logger.debug(serGameAgtMap);</span>
<span class="nc" id="L1951">		} catch (Exception e) {</span>
<span class="nc" id="L1952">			e.printStackTrace();</span>
<span class="nc" id="L1953">		}</span>
<span class="nc" id="L1954">		return serGameAgtMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionRetailerWiseExpandMrpWise(
			Timestamp startDate, Timestamp endDate, Connection con,
			boolean isDG, boolean isSE, boolean isCS, boolean isOLA,
			int agtOrgId) {
<span class="nc" id="L1961">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1962">		ResultSet rsGame = null;</span>
<span class="nc" id="L1963">		ResultSet rs = null;</span>
<span class="nc" id="L1964">		ResultSet rsRetOrg = null;</span>
<span class="nc" id="L1965">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; serGameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;();</span>
<span class="nc" id="L1966">		Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt; gameAgtMap = null;</span>
		// for Draw Game
<span class="nc" id="L1968">		String saleTranDG = null;</span>
<span class="nc" id="L1969">		String cancelTranDG = null;</span>
<span class="nc" id="L1970">		String pwtTranDG = null;</span>
<span class="nc" id="L1971">		StringBuilder drawQry = null;</span>
		// for scratch game
<span class="nc" id="L1973">		StringBuilder scratchQry = null;</span>
<span class="nc bnc" id="L1974" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L1975">			return serGameAgtMap;</span>
		}
		try {

			// Get All Agent
<span class="nc" id="L1980">			String agtOrgQry = &quot;select name,organization_id from st_lms_organization_master where parent_id=&quot;</span>
					+ agtOrgId + &quot; order by name&quot;;
<span class="nc" id="L1982">			pstmt = con.prepareStatement(agtOrgQry);</span>
<span class="nc" id="L1983">			rsRetOrg = pstmt.executeQuery();</span>

<span class="nc bnc" id="L1985" title="All 2 branches missed.">			if (isDG) {</span>
<span class="nc" id="L1986">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L1987">				drawQry = new StringBuilder(</span>
						&quot;select agtTlb.organization_id,ifnull(sale,0.0) sale,ifnull(cancel,0.0) cancel,ifnull(pwt,0.0)  pwt from (select sale.organization_id,sale,cancel,pwt from &quot;);
<span class="nc" id="L1989">				saleTranDG = &quot;(select bb.organization_id,sum(sale) as sale from (select drs.retailer_org_id,sum(mrp_amt) as sale from st_dg_ret_sale_? drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_SALE','DG_SALE_OFFLINE') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;)bb on retailer_org_id=organization_id group by organization_id) sale,&quot;;
<span class="nc" id="L1996">				cancelTranDG = &quot;(select bb.organization_id,sum(cancel) as cancel from (select drs.retailer_org_id,sum(mrp_amt) as cancel from st_dg_ret_sale_refund_? drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on retailer_org_id=organization_id group by organization_id) cancel,&quot;;
<span class="nc" id="L2003">				pwtTranDG = &quot;(select bb.organization_id,sum(pwt) as pwt from (select drs.retailer_org_id,sum(pwt_amt) as pwt from st_dg_ret_pwt_? drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on retailer_org_id=organization_id group by organization_id) pwt &quot;;
<span class="nc" id="L2010">				drawQry.append(saleTranDG);</span>
<span class="nc" id="L2011">				drawQry.append(cancelTranDG);</span>
<span class="nc" id="L2012">				drawQry.append(pwtTranDG);</span>
<span class="nc" id="L2013">				drawQry</span>
						.append(&quot; where sale.organization_id=cancel.organization_id and sale.organization_id=pwt.organization_id and cancel.organization_id=pwt.organization_id) gameTlb right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
								+ agtOrgId
								+ &quot;) agtTlb on gameTlb.organization_id=agtTlb.organization_id&quot;);
<span class="nc" id="L2017">				System.out.println(&quot;For Expand draw game Qry:: &quot; + drawQry);</span>

				// Game Master Query
<span class="nc" id="L2020">				String gameQry = &quot;select game_id,game_name from st_dg_game_master&quot;;</span>
<span class="nc" id="L2021">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L2022">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L2023" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L2024">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L2025">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L2026">					gameMap.putAll(getAgentMap(rsRetOrg, isDG, isSE, isCS,</span>
							isOLA));
<span class="nc" id="L2028">					pstmt = con.prepareStatement(drawQry.toString());</span>
<span class="nc" id="L2029">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L2030">					pstmt.setInt(2, gameId);</span>
<span class="nc" id="L2031">					pstmt.setInt(3, gameId);</span>
<span class="nc" id="L2032">					System.out.println(&quot;-------Indivisual Game Qry-------\n&quot;</span>
							+ pstmt);
<span class="nc" id="L2034">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2035" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L2036">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L2037">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L2038">						gameMap.get(agtId)</span>
								.setDrawCancel(rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L2040">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>

<span class="nc" id="L2042">					}</span>
<span class="nc" id="L2043">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L2044">				}</span>

<span class="nc" id="L2046">				serGameAgtMap.put(&quot;DG&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L2048" title="All 2 branches missed.">			if (isSE) {</span>
<span class="nc" id="L2049">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L2050">				scratchQry = new StringBuilder(</span>
						&quot;select agtTlb.organization_id,ifnull(sale,0.0) sale,ifnull(pwt,0.0) pwt from (select sale.organization_id,sale,pwt from&quot;);
<span class="nc" id="L2052">				saleTranDG = &quot;(select bb.organization_id,sum(sale) as sale from (select current_owner_id,sum(sale) sale from (select gmti.game_id,gmti.current_owner_id, (gmti.sold_tickets*ticket_price) sale from st_se_game_ticket_inv_history gmti ,st_se_game_master gm where gmti.current_owner='RETAILER'and gmti.date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and gmti.date&lt;='&quot;
						+ endDate
						+ &quot;' and gmti.game_id=gm.game_id and gm.game_id=?) aa group by current_owner_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on current_owner_id=organization_id group by organization_id) sale, &quot;;
<span class="nc" id="L2059">				pwtTranDG = &quot;(select bb.organization_id,sum(pwt) as pwt from (select retailer_org_id,sum(pwt_amt) pwt from st_se_retailer_pwt where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and transaction_type='PWT') and game_id=? group by retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on retailer_org_id=organization_id group by organization_id) pwt &quot;;
<span class="nc" id="L2066">				scratchQry.append(saleTranDG);</span>
<span class="nc" id="L2067">				scratchQry.append(pwtTranDG);</span>
<span class="nc" id="L2068">				scratchQry</span>
						.append(&quot; where sale.organization_id=pwt.organization_id) gameTlb right outer join (select organization_id from st_lms_organization_master where parent_id=4) agtTlb on gameTlb.organization_id=agtTlb.organization_id&quot;);
<span class="nc" id="L2070">				System.out.println(&quot;For Expand scratch game Qry:: &quot;</span>
						+ scratchQry);

				// Game Master Query
<span class="nc" id="L2074">				String gameQry = &quot;select game_id,game_name from st_se_game_master&quot;;</span>
<span class="nc" id="L2075">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L2076">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L2077" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L2078">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L2079">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L2080">					gameMap.putAll(getAgentMap(rsRetOrg, isDG, isSE, isCS,</span>
							isOLA));
<span class="nc" id="L2082">					pstmt = con.prepareStatement(scratchQry.toString());</span>
<span class="nc" id="L2083">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L2084">					pstmt.setInt(2, gameId);</span>
<span class="nc" id="L2085">					System.out.println(&quot;-------Indivisual Game Qry-------\n&quot;</span>
							+ pstmt);
<span class="nc" id="L2087">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2088" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L2089">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L2090">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L2091">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>
<span class="nc" id="L2092">					}</span>

<span class="nc" id="L2094">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L2095">				}</span>
<span class="nc" id="L2096">				serGameAgtMap.put(&quot;SE&quot;, gameAgtMap);</span>
			}
<span class="nc" id="L2098">			System.out.println(serGameAgtMap);</span>
<span class="nc" id="L2099">		} catch (Exception e) {</span>
<span class="nc" id="L2100">			e.printStackTrace();</span>
<span class="nc" id="L2101">		}</span>
<span class="nc" id="L2102">		return serGameAgtMap;</span>
	}

	private Map&lt;String, CompleteCollectionBean&gt; getAgentMap(ResultSet rsRetOrg,
			boolean isDG, boolean isSE, boolean isCS, boolean isOLA)
			throws SQLException {
<span class="nc" id="L2108">		Map&lt;String, CompleteCollectionBean&gt; agtMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L2109">		CompleteCollectionBean collBean = null;</span>

<span class="nc bnc" id="L2111" title="All 2 branches missed.">		while (rsRetOrg.next()) {</span>
<span class="nc" id="L2112">			collBean = new CompleteCollectionBean();</span>
<span class="nc" id="L2113">			collBean.setOrgName(rsRetOrg.getString(&quot;name&quot;));</span>
<span class="nc bnc" id="L2114" title="All 2 branches missed.">			if (isDG) {</span>
<span class="nc" id="L2115">				collBean.setDrawSale(0.0);</span>
<span class="nc" id="L2116">				collBean.setDrawPwt(0.0);</span>
<span class="nc" id="L2117">				collBean.setDrawCancel(0.0);</span>
			}
<span class="nc bnc" id="L2119" title="All 2 branches missed.">			if (isSE) {</span>
<span class="nc" id="L2120">				collBean.setScratchSale(0.0);</span>
<span class="nc" id="L2121">				collBean.setScratchPwt(0.0);</span>
			}
<span class="nc bnc" id="L2123" title="All 2 branches missed.">			if (isOLA) {</span>
<span class="nc" id="L2124">				collBean.setOlaDepositAmt(0.0);</span>
<span class="nc" id="L2125">				collBean.setOlaDepositCancelAmt(0.0);</span>
<span class="nc" id="L2126">				collBean.setOlaWithdrawalAmt(0.0);</span>
			}
<span class="nc" id="L2128">			agtMap.put(rsRetOrg.getString(&quot;organization_id&quot;), collBean);</span>
		}
<span class="nc" id="L2130">		rsRetOrg.beforeFirst();</span>
<span class="nc" id="L2131">		return agtMap;</span>
	}

	private Map&lt;String, CompleteCollectionBean&gt; getDayMap(Timestamp startDate,
			Timestamp endDate, boolean isDG, boolean isSE, boolean isCS)
			throws SQLException {
<span class="nc" id="L2137">		Map&lt;String, CompleteCollectionBean&gt; dateMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L2138">		CompleteCollectionBean collBean = null;</span>
<span class="nc" id="L2139">		String date = null;</span>
		// Get All Day
<span class="nc" id="L2141">		Calendar startCal = Calendar.getInstance();</span>
<span class="nc" id="L2142">		startCal.setTime(startDate);</span>

<span class="nc" id="L2144">		Calendar endCal = Calendar.getInstance();</span>
<span class="nc" id="L2145">		endCal.setTime(endDate);</span>
<span class="nc bnc" id="L2146" title="All 2 branches missed.">		while (startCal.getTime().before(endCal.getTime())) {</span>
<span class="nc" id="L2147">			date = new java.sql.Date(startCal.getTimeInMillis()).toString();</span>
<span class="nc" id="L2148">			collBean = new CompleteCollectionBean();</span>
<span class="nc" id="L2149">			collBean.setOrgName(date);</span>
<span class="nc" id="L2150">			dateMap.put(date, collBean);</span>
<span class="nc" id="L2151">			startCal.setTimeInMillis(startCal.getTimeInMillis() + 24 * 60 * 60</span>
					* 1000);
<span class="nc bnc" id="L2153" title="All 2 branches missed.">			if (isDG) {</span>
<span class="nc" id="L2154">				collBean.setDrawSale(0.0);</span>
<span class="nc" id="L2155">				collBean.setDrawPwt(0.0);</span>
<span class="nc" id="L2156">				collBean.setDrawCancel(0.0);</span>
<span class="nc" id="L2157">				collBean.setDrawDirPlyPwt(0.0);</span>
			}
<span class="nc bnc" id="L2159" title="All 2 branches missed.">			if (isSE) {</span>
<span class="nc" id="L2160">				collBean.setScratchSale(0.0);</span>
<span class="nc" id="L2161">				collBean.setScratchPwt(0.0);</span>
<span class="nc" id="L2162">				collBean.setScratchDirPlyPwt(0.0);</span>
			}
<span class="nc bnc" id="L2164" title="All 2 branches missed.">			if (isCS) {</span>
<span class="nc" id="L2165">				collBean.setCSSale(0.0);</span>
<span class="nc" id="L2166">				collBean.setCSCancel(0.0);</span>
			}
		}
<span class="nc" id="L2169">		return dateMap;</span>
	}

	public String getOrgAdd(int orgId) throws LMSException {
<span class="nc" id="L2173">		String orgAdd = &quot;&quot;;</span>
<span class="nc" id="L2174">		Connection con = null;</span>
<span class="nc" id="L2175">		con = DBConnect.getConnection();</span>
<span class="nc" id="L2176">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L2177">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L2179">			pstmt = con</span>
					.prepareStatement(&quot;select addr_line1, addr_line2, city from st_lms_organization_master where organization_id = ?&quot;);
<span class="nc" id="L2181">			pstmt.setInt(1, orgId);</span>
<span class="nc" id="L2182">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L2183">			System.out.println(pstmt);</span>
<span class="nc bnc" id="L2184" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L2185">				orgAdd = rs.getString(&quot;addr_line1&quot;) + &quot;, &quot;</span>
						+ rs.getString(&quot;addr_line2&quot;) + &quot;, &quot;
						+ rs.getString(&quot;city&quot;);
			}
<span class="nc" id="L2189">		} catch (SQLException e) {</span>
<span class="nc" id="L2190">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L2191">			e.printStackTrace();</span>
<span class="nc" id="L2192">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L2194">			try {</span>
<span class="nc bnc" id="L2195" title="All 8 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L2196">					con.close();</span>
				}
<span class="nc" id="L2198">			} catch (SQLException e) {</span>
<span class="nc" id="L2199">				logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L2200">				e.printStackTrace();</span>
<span class="nc" id="L2201">				throw new LMSException(e);</span>
<span class="nc" id="L2202">			}</span>
		}
<span class="nc" id="L2204">		return orgAdd;</span>
	}

	public Map&lt;Integer, String&gt; getOrgAddMap(String orgType, int parentId)
			throws LMSException {
<span class="nc" id="L2209">		Map&lt;Integer, String&gt; orgAddMap = new TreeMap&lt;Integer, String&gt;();</span>
<span class="nc" id="L2210">		Connection con = null;</span>
<span class="nc" id="L2211">		con = DBConnect.getConnection();</span>
<span class="nc" id="L2212">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L2213">		ResultSet rs = null;</span>
		try {
<span class="nc bnc" id="L2215" title="All 2 branches missed.">			if (orgType.equalsIgnoreCase(&quot;AGENT&quot;)) {</span>
<span class="nc" id="L2216">				pstmt = con</span>
						.prepareStatement(&quot;select addr_line1, addr_line2, city, organization_id from st_lms_organization_master where organization_type='AGENT'&quot;);

<span class="nc bnc" id="L2219" title="All 2 branches missed.">			} else if (orgType.equalsIgnoreCase(&quot;RETAILER&quot;)) {</span>
<span class="nc" id="L2220">				pstmt = con</span>
						.prepareStatement(&quot;select addr_line1, addr_line2, city, organization_id from st_lms_organization_master where organization_type='RETAILER' and parent_id = ?&quot;);
<span class="nc" id="L2222">				pstmt.setInt(1, parentId);</span>
			}
<span class="nc" id="L2224">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2225" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L2226">				orgAddMap.put(rs.getInt(&quot;organization_id&quot;), rs</span>
						.getString(&quot;addr_line1&quot;)
						+ &quot;,&quot;
						+ rs.getString(&quot;addr_line2&quot;)
						+ &quot;,&quot;
						+ rs.getString(&quot;city&quot;));
			}
<span class="nc" id="L2233">		} catch (SQLException e) {</span>
<span class="nc" id="L2234">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L2235">			e.printStackTrace();</span>
<span class="nc" id="L2236">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L2238">			try {</span>
<span class="nc bnc" id="L2239" title="All 8 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L2240">					con.close();</span>
				}
<span class="nc" id="L2242">			} catch (SQLException e) {</span>
<span class="nc" id="L2243">				logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L2244">				e.printStackTrace();</span>
<span class="nc" id="L2245">				throw new LMSException(e);</span>
<span class="nc" id="L2246">			}</span>
		}
<span class="nc" id="L2248">		return orgAddMap;</span>
	}

	public Map&lt;String, String&gt; getOrgMap(String orgType) {
<span class="nc" id="L2252">		Connection con = null;</span>
<span class="nc" id="L2253">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L2254">		Map&lt;String, String&gt; orgMap = new LinkedHashMap&lt;String, String&gt;();</span>
		try {
<span class="nc" id="L2256">			con = DBConnect.getConnection();</span>
<span class="nc" id="L2257">			String chkService = &quot;select name,organization_id from st_lms_organization_master where organization_type=? order by name&quot;;</span>
<span class="nc" id="L2258">			pstmt = con.prepareStatement(chkService);</span>
<span class="nc" id="L2259">			pstmt.setString(1, orgType);</span>
<span class="nc" id="L2260">			ResultSet rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2261" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L2262">				orgMap.put(rs.getString(&quot;organization_id&quot;), rs</span>
						.getString(&quot;name&quot;));
			}
<span class="nc" id="L2265">		} catch (Exception e) {</span>
<span class="nc" id="L2266">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L2268">			try {</span>
<span class="nc" id="L2269">				con.close();</span>
<span class="nc" id="L2270">			} catch (SQLException e) {</span>
<span class="nc" id="L2271">				e.printStackTrace();</span>
<span class="nc" id="L2272">			}</span>
<span class="nc" id="L2273">		}</span>
<span class="nc" id="L2274">		return orgMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;&gt; transactionReportForAgent(
			Timestamp startDate, Timestamp endDate, String reportType,
			int agtOrgId) {
<span class="nc" id="L2280">		System.out</span>
				.println(&quot;----------collectionReport----------reportType-----&quot;
						+ reportType);
<span class="nc" id="L2283">		Connection con = null;</span>
<span class="nc" id="L2284">		Map&lt;String, Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;&gt; resultMap = new HashMap&lt;String, Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;&gt;();</span>
<span class="nc" id="L2285">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; agtMap = null;</span>
<span class="nc" id="L2286">		boolean isSE = false;</span>
<span class="nc" id="L2287">		boolean isDG = false;</span>
<span class="nc" id="L2288">		boolean isCS = false;</span>
<span class="nc" id="L2289">		boolean isOLA = false;</span>
		try {
<span class="nc" id="L2291">			con = DBConnect.getConnection();</span>
<span class="nc" id="L2292">			Map&lt;String, Boolean&gt; serMap = checkAvailableService();</span>
<span class="nc" id="L2293">			isSE = serMap.get(&quot;SE&quot;);</span>
<span class="nc" id="L2294">			isDG = serMap.get(&quot;DG&quot;);</span>
<span class="nc" id="L2295">			isCS = serMap.get(&quot;CS&quot;);</span>
<span class="nc" id="L2296">			isOLA = serMap.get(&quot;OLA&quot;);</span>
<span class="nc bnc" id="L2297" title="All 2 branches missed.">			if (&quot;Retailer Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L2298">				agtMap = collectionRetailerWiseExpand(startDate, endDate, con,</span>
						isDG, isSE, isCS, isOLA, agtOrgId);
<span class="nc" id="L2300">				resultMap.put(&quot;NetAmt&quot;, agtMap);</span>
<span class="nc" id="L2301">				agtMap = collectionRetailerWiseExpandMrpWise(startDate,</span>
						endDate, con, isDG, isSE, isCS, isOLA, agtOrgId);
<span class="nc" id="L2303">				resultMap.put(&quot;MrpAmt&quot;, agtMap);</span>
			}
<span class="nc" id="L2305">		} catch (Exception e) {</span>
<span class="nc" id="L2306">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L2308">			try {</span>
<span class="nc" id="L2309">				con.close();</span>
<span class="nc" id="L2310">			} catch (SQLException e) {</span>
<span class="nc" id="L2311">				e.printStackTrace();</span>
<span class="nc" id="L2312">			}</span>
<span class="nc" id="L2313">		}</span>
<span class="nc" id="L2314">		return resultMap;</span>
	}

	@Override
	public Map&lt;String, CompleteCollectionBean&gt; collectionAgentWise(
			Timestamp startDate, Timestamp endDate, Connection con) {
		// TODO Auto-generated method stub
<span class="nc" id="L2321">		return null;</span>
	}

	@Override
	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionAgentWiseExpand(
			Timestamp startDate, Timestamp endDate, Connection con) {
		// TODO Auto-generated method stub
<span class="nc" id="L2328">		return null;</span>
	}

	@Override
	public Map&lt;String, CompleteCollectionBean&gt; collectionDayWise(
			Timestamp startDate, Timestamp endDate, Connection con,
			String viewBy, int orgId) {
		// TODO Auto-generated method stub
<span class="nc" id="L2336">		return null;</span>
	}

	@Override
	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionDayWiseExpand(
			Timestamp startDate, Timestamp endDate, Connection con,
			String viewBy, int orgId) {
		// TODO Auto-generated method stub
<span class="nc" id="L2344">		return null;</span>
	}

	@Override
	public Map&lt;String, CompleteCollectionBean&gt; collectionRetailerWise(
			Timestamp startDate, Timestamp endDate, Connection con, int agtOrgId) {
		// TODO Auto-generated method stub
<span class="nc" id="L2351">		return null;</span>
	}

	@Override
	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionRetailerWiseExpand(
			Timestamp startDate, Timestamp endDate, Connection con, int agtOrgId) {
		// TODO Auto-generated method stub
<span class="nc" id="L2358">		return null;</span>
	}

	@Override
	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionRetailerWiseExpandMrpWise(
			Timestamp startDate, Timestamp endDate, Connection con, int agtOrgId) {
		// TODO Auto-generated method stub
<span class="nc" id="L2365">		return null;</span>
	}

	@Override
	public Map&lt;String, Double&gt; agentDirectPlayerPwt(Timestamp startDate,
			Timestamp endDate, int agtOrgId, ReportStatusBean reportStatusBean) {
		// TODO Auto-generated method stub
<span class="nc" id="L2372">		return null;</span>
	}

	@Override
	public Map&lt;String, CompleteCollectionBean&gt; collectionReport(
			Timestamp startDate, Timestamp endDate, String reportType,
			ReportStatusBean reportStatusBean) {
		// TODO Auto-generated method stub
<span class="nc" id="L2380">		return null;</span>
	}

	@Override
	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionReportExpand(
			Timestamp startDate, Timestamp endDate, String reportType,
			ReportStatusBean reportStatusBean) {
		// TODO Auto-generated method stub
<span class="nc" id="L2388">		return null;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>