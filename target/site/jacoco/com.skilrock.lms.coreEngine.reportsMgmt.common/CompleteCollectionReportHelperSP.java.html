<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CompleteCollectionReportHelperSP.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.reportsMgmt.common</a> &gt; <span class="el_source">CompleteCollectionReportHelperSP.java</span></div><h1>CompleteCollectionReportHelperSP.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.reportsMgmt.common;

import java.sql.CallableStatement;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Timestamp;
import java.util.Calendar;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.Map;
import java.util.TreeMap;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.beans.CompleteCollectionBean;
import com.skilrock.lms.beans.ReportStatusBean;
import com.skilrock.lms.common.Utility;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.DBConnectReplica;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.filter.LMSFilterDispatcher;
import com.skilrock.lms.web.instantWin.reportsMgmt.beans.IWOrgReportRequestBean;
import com.skilrock.lms.web.instantWin.reportsMgmt.beans.IWOrgReportResponseBean;
import com.skilrock.lms.web.instantWin.reportsMgmt.controller.IWAgentReportsControllerImpl;
import com.skilrock.lms.web.instantWin.reportsMgmt.controller.IWRetailerReportsControllerImpl;
import com.skilrock.lms.web.reportsMgmt.common.ReportUtility;
import com.skilrock.lms.web.sportsLottery.reportsMgmt.beans.SLEOrgReportRequestBean;
import com.skilrock.lms.web.sportsLottery.reportsMgmt.beans.SLEOrgReportResponseBean;
import com.skilrock.lms.web.sportsLottery.reportsMgmt.controller.SLEAgentReportsControllerImpl;
import com.skilrock.lms.web.sportsLottery.reportsMgmt.controller.SLERetailerReportsControllerImpl;
import com.skilrock.lms.web.virtualSports.reportsMgmt.beans.VSOrgReportRequestBean;
import com.skilrock.lms.web.virtualSports.reportsMgmt.beans.VSOrgReportResponseBean;
import com.skilrock.lms.web.virtualSports.reportsMgmt.controller.VSAgentReportsControllerImpl;
import com.skilrock.lms.web.virtualSports.reportsMgmt.controller.VSRetailerReportsControllerImpl;
import com.skilrock.ola.reportsMgmt.controllerImpl.OlaAgentReportControllerImpl;
import com.skilrock.ola.reportsMgmt.controllerImpl.OlaRetailerReportControllerImpl;
import com.skilrock.ola.reportsMgmt.javaBeans.OlaOrgReportRequestBean;
import com.skilrock.ola.reportsMgmt.javaBeans.OlaOrgReportResponseBean;

<span class="nc" id="L44">public class CompleteCollectionReportHelperSP implements</span>
		ICompleteCollectionReportHelper {
<span class="nc" id="L46">	static Log logger = LogFactory</span>
			.getLog(CompleteCollectionReportHelperSP.class);
<span class="nc" id="L48">	StringBuilder dates = null;</span>

	public Map&lt;String, Double&gt; agentDirectPlayerPwt(Timestamp startDate,
			Timestamp endDate, int agtOrgId, ReportStatusBean reportStatusBean) {
<span class="nc" id="L52">		Connection con = null;</span>
<span class="nc" id="L53">		CallableStatement cstmt = null;</span>
<span class="nc" id="L54">		ResultSet rs = null;</span>
<span class="nc" id="L55">		Map&lt;String, Double&gt; dirPlrPwtMap = new LinkedHashMap&lt;String, Double&gt;();</span>
		// Draw Direct Player Qry
		try {
<span class="nc bnc" id="L58" title="All 4 branches missed.">			if(&quot;NO&quot;.equals(Utility.getPropertyValue(&quot;IS_DATA_FROM_REPLICA&quot;)) || &quot;MAIN_DB&quot;.equals(reportStatusBean.getReportingFrom()))</span>
<span class="nc" id="L59">				con = DBConnect.getConnection();</span>
			else
<span class="nc" id="L61">				con = DBConnectReplica.getConnection();</span>

<span class="nc" id="L63">			cstmt = con</span>
					.prepareCall(&quot;{call fetchDrawDirectPlyPwtofAgent(?,?,?)}&quot;);
<span class="nc" id="L65">			cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L66">			cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L67">			cstmt.setInt(3, agtOrgId);</span>
<span class="nc" id="L68">			rs = cstmt.executeQuery();</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L70">				dirPlrPwtMap.put(&quot;DG&quot;, rs.getDouble(&quot;pwtDir&quot;));</span>
			} else {
<span class="nc" id="L72">				dirPlrPwtMap.put(&quot;DG&quot;, 0.0);</span>
			}
			// Scratch Direct Player Qry

<span class="nc" id="L76">			cstmt = con</span>
					.prepareCall(&quot;{call fetchScratchDirectPlyPwtofAgent(?,?,?)}&quot;);
<span class="nc" id="L78">			cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L79">			cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L80">			cstmt.setInt(3, agtOrgId);</span>
<span class="nc" id="L81">			rs = cstmt.executeQuery();</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L83">				dirPlrPwtMap.put(&quot;SE&quot;, rs.getDouble(&quot;pwtDir&quot;));</span>
			} else {
<span class="nc" id="L85">				dirPlrPwtMap.put(&quot;SE&quot;, 0.0);</span>
			}

			// SLE Direct Player data
<span class="nc" id="L89">			SLEOrgReportRequestBean requestBean = new SLEOrgReportRequestBean();</span>
<span class="nc" id="L90">			requestBean.setFromDate(startDate);</span>
<span class="nc" id="L91">			requestBean.setToDate(endDate);</span>
<span class="nc" id="L92">			requestBean.setOrgId(agtOrgId);</span>
<span class="nc" id="L93">			SLEOrgReportResponseBean responseBean = SLEAgentReportsControllerImpl</span>
					.getDirPWTofAgent(requestBean, con);
<span class="nc" id="L95">			dirPlrPwtMap.put(&quot;SLE&quot;, responseBean.getPwtDirAmt());</span>
			
			
			// IW Direct Player data
			
<span class="nc" id="L100">			IWOrgReportRequestBean requestIWBean = new IWOrgReportRequestBean();</span>
<span class="nc" id="L101">			requestIWBean.setFromDate(startDate);</span>
<span class="nc" id="L102">			requestIWBean.setToDate(endDate);</span>
<span class="nc" id="L103">			requestIWBean.setOrgId(agtOrgId);</span>
<span class="nc" id="L104">			IWOrgReportResponseBean responseIWBean = IWAgentReportsControllerImpl</span>
					.getDirPWTofAgent(requestIWBean, con);
<span class="nc" id="L106">			dirPlrPwtMap.put(&quot;IW&quot;, responseIWBean.getPwtDirAmt());</span>
			
<span class="nc" id="L108">			VSOrgReportRequestBean requestVSBean = new VSOrgReportRequestBean();</span>
<span class="nc" id="L109">			requestVSBean.setFromDate(startDate);</span>
<span class="nc" id="L110">			requestVSBean.setToDate(endDate);</span>
<span class="nc" id="L111">			requestVSBean.setOrgId(agtOrgId);</span>
<span class="nc" id="L112">			VSOrgReportResponseBean responseVSBean = VSAgentReportsControllerImpl</span>
					.getDirPWTofAgent(requestVSBean, con);
<span class="nc" id="L114">			dirPlrPwtMap.put(&quot;VS&quot;, responseVSBean.getPwtDirAmt());</span>
			
<span class="nc" id="L116">		} catch (Exception e) {</span>
<span class="nc" id="L117">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L119">			DBConnect.closeCon(con);</span>
<span class="nc" id="L120">			DBConnect.closeCstmt(cstmt);</span>
<span class="nc" id="L121">		}</span>
<span class="nc" id="L122">		return dirPlrPwtMap;</span>
	}

	public Map&lt;String, CompleteCollectionBean&gt; collectionAgentWise(
			Timestamp startDate, Timestamp endDate, Connection con) {
<span class="nc" id="L127">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L128">		ResultSet rsGame = null;</span>
<span class="nc" id="L129">		ResultSet rs = null;</span>
<span class="nc" id="L130">		ResultSet rsRetOrg = null;</span>
<span class="nc" id="L131">		Map&lt;String, CompleteCollectionBean&gt; agtMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L132">		CompleteCollectionBean collBean = null;</span>
		// for Draw Game

<span class="nc bnc" id="L135" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L136">			return agtMap;</span>
		}

		// for scratch game
		try {

			// Get All Agent

<span class="nc" id="L144">			String agtOrgQry = QueryManager.getOrgQry(&quot;AGENT&quot;);</span>
<span class="nc" id="L145">			pstmt = con.prepareStatement(agtOrgQry);</span>
<span class="nc" id="L146">			rsRetOrg = pstmt.executeQuery();</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">			while (rsRetOrg.next()) {</span>
<span class="nc" id="L148">				collBean = new CompleteCollectionBean();</span>
<span class="nc" id="L149">				collBean.setOrgName(rsRetOrg.getString(&quot;orgCode&quot;));</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">				if (ReportUtility.isDG) {</span>
<span class="nc" id="L151">					collBean.setDrawSale(0.0);</span>
<span class="nc" id="L152">					collBean.setDrawPwt(0.0);</span>
<span class="nc" id="L153">					collBean.setDrawCancel(0.0);</span>
<span class="nc" id="L154">					collBean.setDrawDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L156" title="All 2 branches missed.">				if (ReportUtility.isSE) {</span>
<span class="nc" id="L157">					collBean.setScratchSale(0.0);</span>
<span class="nc" id="L158">					collBean.setScratchPwt(0.0);</span>
<span class="nc" id="L159">					collBean.setScratchDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L161" title="All 2 branches missed.">				if (ReportUtility.isCS) {</span>
<span class="nc" id="L162">					collBean.setCSSale(0.0);</span>
<span class="nc" id="L163">					collBean.setCSCancel(0.0);</span>
				}
<span class="nc bnc" id="L165" title="All 2 branches missed.">				if (ReportUtility.isSLE) {</span>
<span class="nc" id="L166">					collBean.setSleSale(0.0);</span>
<span class="nc" id="L167">					collBean.setSlePwt(0.0);</span>
<span class="nc" id="L168">					collBean.setSleCancel(0.0);</span>
<span class="nc" id="L169">					collBean.setSleDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L171" title="All 2 branches missed.">				if (ReportUtility.isIW) {</span>
<span class="nc" id="L172">					collBean.setIwSale(0.0);</span>
<span class="nc" id="L173">					collBean.setIwPwt(0.0);</span>
<span class="nc" id="L174">					collBean.setIwCancel(0.0);</span>
<span class="nc" id="L175">					collBean.setIwDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L177" title="All 2 branches missed.">				if (ReportUtility.isVS) {</span>
<span class="nc" id="L178">					collBean.setVsSale(0.0);</span>
<span class="nc" id="L179">					collBean.setVsPwt(0.0);</span>
<span class="nc" id="L180">					collBean.setVsCancel(0.0);</span>
<span class="nc" id="L181">					collBean.setVsDirPlyPwt(0.0);</span>
				}
<span class="nc" id="L183">				agtMap.put(rsRetOrg.getString(&quot;organization_id&quot;), collBean);</span>
			}
<span class="nc bnc" id="L185" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
				// Game Master Query
<span class="nc" id="L187">				String gameQry = ReportUtility.getDrawGameMapQuery(startDate);</span>
<span class="nc" id="L188">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L189">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L190">				CallableStatement cstmt = null;</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L192">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L193">					cstmt = con.prepareCall(&quot;{call drawCollectionAgentWisePerGame(?,?,?)}&quot;);</span>
<span class="nc" id="L194">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L195">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L196">					cstmt.setInt(3, gameNo);</span>
<span class="nc" id="L197">					rs = cstmt.executeQuery();</span>
<span class="nc" id="L198">					String agtOrgId = null;</span>
<span class="nc" id="L199">					double sale = 0, cancel = 0, pwt = 0;</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L201">						agtOrgId = rs.getString(&quot;parent_id&quot;);</span>
<span class="nc" id="L202">						sale = rs.getDouble(&quot;sale&quot;);</span>
<span class="nc" id="L203">						cancel = rs.getDouble(&quot;cancel&quot;);</span>
<span class="nc" id="L204">						pwt = rs.getDouble(&quot;pwt&quot;);</span>
<span class="nc" id="L205">						agtMap.get(agtOrgId).setDrawSale(</span>
								agtMap.get(agtOrgId).getDrawSale() + sale);
<span class="nc" id="L207">						agtMap.get(agtOrgId).setDrawCancel(</span>
								agtMap.get(agtOrgId).getDrawCancel() + cancel);
<span class="nc" id="L209">						agtMap.get(agtOrgId).setDrawPwt(</span>
								agtMap.get(agtOrgId).getDrawPwt() + pwt);
<span class="nc" id="L211">						agtMap.get(agtOrgId).setDrawDirPlyPwt(</span>
								agtMap.get(agtOrgId).getDrawDirPlyPwt()
										+ rs.getDouble(&quot;pwtDir&quot;));
					}
<span class="nc" id="L215">				}</span>
<span class="nc" id="L216">				DBConnect.closePstmt(gamePstmt);</span>
<span class="nc" id="L217">				DBConnect.closeCstmt(cstmt);</span>
			}
<span class="nc bnc" id="L219" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
				// Game Master Query
<span class="nc" id="L221">				String gameQry = ReportUtility</span>
						.getScratchGameMapQuery(startDate);
<span class="nc" id="L223">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L224">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L225">				CallableStatement cstmt = null;</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L227">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L228">					cstmt = con</span>
							.prepareCall(&quot;{call scratchCollectionAgentWisePerGame(?,?,?)}&quot;);
<span class="nc" id="L230">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L231">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L232">					cstmt.setInt(3, gameNo);</span>
<span class="nc" id="L233">					rs = cstmt.executeQuery();</span>
<span class="nc" id="L234">					String agtOrgId = null;</span>
<span class="nc" id="L235">					double sale = 0, cancel = 0, pwt = 0;</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L237">						agtOrgId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L238">						sale = rs.getDouble(&quot;sale&quot;);</span>
<span class="nc" id="L239">						cancel = rs.getDouble(&quot;cancel&quot;);</span>
<span class="nc" id="L240">						pwt = rs.getDouble(&quot;pwt&quot;);</span>
<span class="nc" id="L241">						agtMap.get(agtOrgId).setScratchSale(</span>
								agtMap.get(agtOrgId).getScratchSale()
										+ (sale - cancel));
<span class="nc" id="L244">						agtMap.get(agtOrgId).setScratchPwt(</span>
								agtMap.get(agtOrgId).getScratchPwt() + pwt);
<span class="nc" id="L246">						agtMap.get(agtOrgId).setScratchDirPlyPwt(</span>
								agtMap.get(agtOrgId).getScratchDirPlyPwt()
										+ rs.getDouble(&quot;pwtDir&quot;));
					}
<span class="nc" id="L250">				}</span>
<span class="nc" id="L251">				DBConnect.closePstmt(gamePstmt);</span>
<span class="nc" id="L252">				DBConnect.closeCstmt(cstmt);</span>
			}
<span class="nc bnc" id="L254" title="All 2 branches missed.">			if (ReportUtility.isCS) {</span>

				// category Master Query
<span class="nc" id="L257">				String catQry = &quot;select category_id from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L258">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L259">				rsGame = prodPstmt.executeQuery();</span>
<span class="nc" id="L260">				CallableStatement cstmt = null;</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L262">					int catId = rsGame.getInt(&quot;category_id&quot;);</span>
<span class="nc" id="L263">					cstmt = con.prepareCall(&quot;{call csCollectionAgentWisePerCategory(?,?,?)}&quot;);</span>
<span class="nc" id="L264">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L265">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L266">					cstmt.setInt(3, catId);</span>
<span class="nc" id="L267">					rs = cstmt.executeQuery();</span>
<span class="nc" id="L268">					String agtOrgId = null;</span>
<span class="nc" id="L269">					double sale = 0, cancel = 0;</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L271">						agtOrgId = rs.getString(&quot;parent_id&quot;);</span>
<span class="nc" id="L272">						sale = rs.getDouble(&quot;sale&quot;);</span>
<span class="nc" id="L273">						cancel = rs.getDouble(&quot;cancel&quot;);</span>
<span class="nc" id="L274">						agtMap.get(agtOrgId).setCSSale(</span>
								agtMap.get(agtOrgId).getCSSale() + sale);
<span class="nc" id="L276">						agtMap.get(agtOrgId).setCSCancel(</span>
								agtMap.get(agtOrgId).getCSCancel() + cancel);
					}
<span class="nc" id="L279">				}</span>
<span class="nc" id="L280">				DBConnect.closePstmt(prodPstmt);</span>
<span class="nc" id="L281">				DBConnect.closeCstmt(cstmt);</span>
			}

<span class="nc bnc" id="L284" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>
<span class="nc" id="L285">				OlaOrgReportRequestBean requestBean = new OlaOrgReportRequestBean();</span>
<span class="nc" id="L286">				requestBean.setFromDate(startDate.toString());</span>
<span class="nc" id="L287">				requestBean.setToDate(endDate.toString());</span>
<span class="nc" id="L288">				Map&lt;Integer, OlaOrgReportResponseBean&gt; olaResponseBeanMap = OlaAgentReportControllerImpl</span>
						.fetchDepositWithdrawlMultipleAgent(requestBean, con);

<span class="nc bnc" id="L291" title="All 2 branches missed.">				for (Map.Entry&lt;Integer, OlaOrgReportResponseBean&gt; entry : olaResponseBeanMap</span>
						.entrySet()) {
<span class="nc" id="L293">					String orgId = String.valueOf(entry.getKey());</span>
<span class="nc" id="L294">					OlaOrgReportResponseBean olaResponseBean = entry.getValue();</span>
<span class="nc bnc" id="L295" title="All 2 branches missed.">					if (agtMap.containsKey(orgId)) {</span>
<span class="nc" id="L296">						agtMap.get(orgId).setOlaWithdrawalAmt(</span>
								olaResponseBean.getNetWithdrawalAmt());
<span class="nc" id="L298">						agtMap.get(orgId).setOlaDepositAmt(</span>
								olaResponseBean.getNetDepositAmt());
					}
<span class="nc" id="L301">				}</span>
			}

<span class="nc bnc" id="L304" title="All 2 branches missed.">			if (ReportUtility.isSLE) {</span>
<span class="nc" id="L305">				SLEOrgReportRequestBean requestBean = new SLEOrgReportRequestBean();</span>
<span class="nc" id="L306">				requestBean.setFromDate(startDate);</span>
<span class="nc" id="L307">				requestBean.setToDate(endDate);</span>
<span class="nc" id="L308">				Map&lt;Integer, SLEOrgReportResponseBean&gt; sleResponseBeanMap = SLEAgentReportsControllerImpl</span>
						.fetchSaleCancelPWTMultipleAgent(requestBean, con);

<span class="nc bnc" id="L311" title="All 2 branches missed.">				for (Map.Entry&lt;Integer, SLEOrgReportResponseBean&gt; entry : sleResponseBeanMap</span>
						.entrySet()) {
<span class="nc" id="L313">					String orgId = String.valueOf(entry.getKey());</span>
<span class="nc" id="L314">					SLEOrgReportResponseBean sleResponseBean = entry.getValue();</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">					if (agtMap.containsKey(orgId)) {</span>
<span class="nc" id="L316">						agtMap.get(orgId).setSleSale(</span>
								agtMap.get(orgId).getSleSale()
										+ sleResponseBean.getSaleAmt());
<span class="nc" id="L319">						agtMap.get(orgId).setSleCancel(</span>
								agtMap.get(orgId).getSleCancel()
										+ sleResponseBean.getCancelAmt());
<span class="nc" id="L322">						agtMap.get(orgId).setSlePwt(</span>
								agtMap.get(orgId).getSlePwt()
										+ sleResponseBean.getPwtAmt());
<span class="nc" id="L325">						agtMap.get(orgId).setSleDirPlyPwt(</span>
								agtMap.get(orgId).getSleDirPlyPwt()
										+ sleResponseBean.getPwtDirAmt());
					}
<span class="nc" id="L329">				}</span>
			}
<span class="nc bnc" id="L331" title="All 2 branches missed.">			if (ReportUtility.isIW) {</span>
<span class="nc" id="L332">				IWOrgReportRequestBean requestBean = new IWOrgReportRequestBean();</span>
<span class="nc" id="L333">				requestBean.setFromDate(startDate);</span>
<span class="nc" id="L334">				requestBean.setToDate(endDate);</span>
<span class="nc" id="L335">				Map&lt;Integer, IWOrgReportResponseBean&gt; iwResponseBeanMap = IWAgentReportsControllerImpl</span>
						.fetchSaleCancelPWTMultipleAgent(requestBean, con);

<span class="nc bnc" id="L338" title="All 2 branches missed.">				for (Map.Entry&lt;Integer, IWOrgReportResponseBean&gt; entry : iwResponseBeanMap</span>
						.entrySet()) {
<span class="nc" id="L340">					String orgId = String.valueOf(entry.getKey());</span>
<span class="nc" id="L341">					IWOrgReportResponseBean iwResponseBean = entry.getValue();</span>
<span class="nc bnc" id="L342" title="All 2 branches missed.">					if (agtMap.containsKey(orgId)) {</span>
<span class="nc" id="L343">						agtMap.get(orgId).setIwSale(</span>
								agtMap.get(orgId).getIwSale()
										+ iwResponseBean.getSaleAmt());
<span class="nc" id="L346">						agtMap.get(orgId).setIwCancel(</span>
								agtMap.get(orgId).getIwCancel()
										+ iwResponseBean.getCancelAmt());
<span class="nc" id="L349">						agtMap.get(orgId).setIwPwt(</span>
								agtMap.get(orgId).getIwPwt()
										+ iwResponseBean.getPwtAmt());
<span class="nc" id="L352">						agtMap.get(orgId).setIwDirPlyPwt(</span>
								agtMap.get(orgId).getIwDirPlyPwt()
										+ iwResponseBean.getPwtDirAmt());
					}
<span class="nc" id="L356">				}</span>
			}
<span class="nc bnc" id="L358" title="All 2 branches missed.">			if (ReportUtility.isVS) {</span>
<span class="nc" id="L359">				String gameQry = ReportUtility.getVSGameMapQuery(startDate);</span>
<span class="nc" id="L360">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L361">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">				while(rsGame.next()){</span>
<span class="nc" id="L363">				VSOrgReportRequestBean requestBean = new VSOrgReportRequestBean();</span>
<span class="nc" id="L364">				requestBean.setFromDate(startDate);</span>
<span class="nc" id="L365">				requestBean.setToDate(endDate);</span>
<span class="nc" id="L366">				requestBean.setGameId(rsGame.getInt(&quot;game_id&quot;));</span>
<span class="nc" id="L367">				Map&lt;Integer, VSOrgReportResponseBean&gt; vsResponseBeanMap = VSAgentReportsControllerImpl</span>
						.fetchSaleCancelPWTMultipleAgent(requestBean, con);

<span class="nc bnc" id="L370" title="All 2 branches missed.">				for (Map.Entry&lt;Integer, VSOrgReportResponseBean&gt; entry : vsResponseBeanMap</span>
						.entrySet()) {
<span class="nc" id="L372">					String orgId = String.valueOf(entry.getKey());</span>
<span class="nc" id="L373">					VSOrgReportResponseBean vsResponseBean = entry.getValue();</span>
<span class="nc bnc" id="L374" title="All 2 branches missed.">					if (agtMap.containsKey(orgId)) {</span>
<span class="nc" id="L375">						agtMap.get(orgId).setVsSale(</span>
								agtMap.get(orgId).getVsSale()
										+ vsResponseBean.getSaleAmt());
<span class="nc" id="L378">						agtMap.get(orgId).setVsCancel(</span>
								agtMap.get(orgId).getVsCancel()
										+ vsResponseBean.getCancelAmt());
<span class="nc" id="L381">						agtMap.get(orgId).setVsPwt(</span>
								agtMap.get(orgId).getVsPwt()
										+ vsResponseBean.getPwtAmt());
<span class="nc" id="L384">						agtMap.get(orgId).setVsDirPlyPwt(</span>
								agtMap.get(orgId).getVsDirPlyPwt()
										+ vsResponseBean.getPwtDirAmt());
					}
<span class="nc" id="L388">				}</span>
<span class="nc" id="L389">			}	}</span>
<span class="nc" id="L390">		} catch (Exception e) {</span>
<span class="nc" id="L391">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L393">			DBConnect.closeResource(pstmt, rsGame);</span>
<span class="nc" id="L394">		}</span>

<span class="nc" id="L396">		return agtMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionAgentWiseExpand(
			Timestamp startDate, Timestamp endDate, Connection con) {
<span class="nc" id="L401">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L402">		ResultSet rsGame = null;</span>
<span class="nc" id="L403">		ResultSet rs = null;</span>
<span class="nc" id="L404">		ResultSet rsRetOrg = null;</span>
<span class="nc" id="L405">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; serGameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;();</span>
<span class="nc" id="L406">		Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt; gameAgtMap = null;</span>
		// for Draw Game
<span class="nc bnc" id="L408" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L409">			return serGameAgtMap;</span>
		}
		try {

			// Get All Agent
<span class="nc" id="L414">			String agtOrgQry = QueryManager.getOrgQry(&quot;AGENT&quot;);</span>
<span class="nc" id="L415">			pstmt = con.prepareStatement(agtOrgQry);</span>
<span class="nc" id="L416">			rsRetOrg = pstmt.executeQuery();</span>

<span class="nc bnc" id="L418" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L419">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>

				// Game Master Query
<span class="nc" id="L422">				String gameQry = ReportUtility.getDrawGameMapQuery(startDate);</span>
<span class="nc" id="L423">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L424">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L425">				CallableStatement cstmt = null;</span>
<span class="nc bnc" id="L426" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L427">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L428">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L429">					gameMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L430">					cstmt = con.prepareCall(&quot;{call drawCollectionAgentWisePerGame(?,?,?)}&quot;);</span>
<span class="nc" id="L431">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L432">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L433">					cstmt.setInt(3, gameId);</span>
<span class="nc" id="L434">					rs = cstmt.executeQuery();</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L436">						String agtId = rs.getString(&quot;parent_id&quot;);</span>
<span class="nc" id="L437">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L438">						gameMap.get(agtId)</span>
								.setDrawCancel(rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L440">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>
<span class="nc" id="L441">						gameMap.get(agtId).setDrawDirPlyPwt(</span>
								rs.getDouble(&quot;pwtDir&quot;));

<span class="nc" id="L444">					}</span>
<span class="nc" id="L445">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L446">				}</span>
<span class="nc" id="L447">				DBConnect.closePstmt(gamePstmt);</span>
<span class="nc" id="L448">				DBConnect.closeCstmt(cstmt);</span>

<span class="nc" id="L450">				serGameAgtMap.put(&quot;DG&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L452" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
<span class="nc" id="L453">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
				// Game Master Query
<span class="nc" id="L455">				String gameQry = ReportUtility</span>
						.getScratchGameMapQuery(startDate);
<span class="nc" id="L457">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L458">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L459">				CallableStatement cstmt = null;</span>
<span class="nc bnc" id="L460" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L461">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L462">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L463">					gameMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L464">					cstmt = con.prepareCall(&quot;{call scratchCollectionAgentWisePerGame(?,?,?)}&quot;);</span>
<span class="nc" id="L465">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L466">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L467">					cstmt.setInt(3, gameNo);</span>
<span class="nc" id="L468">					rs = cstmt.executeQuery();</span>
<span class="nc" id="L469">					double sale = 0, cancel = 0, pwt = 0;</span>
<span class="nc bnc" id="L470" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L471">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L472">						sale = rs.getDouble(&quot;sale&quot;);</span>
<span class="nc" id="L473">						cancel = rs.getDouble(&quot;cancel&quot;);</span>
<span class="nc" id="L474">						pwt = rs.getDouble(&quot;pwt&quot;);</span>
<span class="nc" id="L475">						gameMap.get(agtId).setDrawSale(sale - cancel);</span>
<span class="nc" id="L476">						gameMap.get(agtId).setDrawPwt(pwt);</span>
<span class="nc" id="L477">						gameMap.get(agtId).setScratchDirPlyPwt(</span>
								rs.getDouble(&quot;pwtDir&quot;));
<span class="nc" id="L479">					}</span>
<span class="nc" id="L480">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L481">				}</span>
<span class="nc" id="L482">				DBConnect.closePstmt(gamePstmt);</span>
<span class="nc" id="L483">				DBConnect.closeCstmt(cstmt);</span>

<span class="nc" id="L485">				serGameAgtMap.put(&quot;SE&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L487" title="All 2 branches missed.">			if (ReportUtility.isCS) {</span>

<span class="nc" id="L489">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>

				// Game Master Query
<span class="nc" id="L492">				String catQry = &quot;select category_id,category_code from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L493">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L494">				rsGame = prodPstmt.executeQuery();</span>
<span class="nc" id="L495">				CallableStatement cstmt = null;</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L497">					int catId = rsGame.getInt(&quot;category_id&quot;);</span>
<span class="nc" id="L498">					Map&lt;String, CompleteCollectionBean&gt; prodMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L499">					prodMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L500">					cstmt = con.prepareCall(&quot;{call csCollectionAgentWisePerCategory(?,?,?)}&quot;);</span>
<span class="nc" id="L501">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L502">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L503">					cstmt.setInt(3, catId);</span>
<span class="nc" id="L504">					rs = cstmt.executeQuery();</span>
<span class="nc bnc" id="L505" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L506">						String agtId = rs.getString(&quot;parent_id&quot;);</span>
<span class="nc" id="L507">						prodMap.get(agtId).setCSSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L508">						prodMap.get(agtId).setCSCancel(rs.getDouble(&quot;cancel&quot;));</span>
<span class="nc" id="L509">					}</span>
<span class="nc" id="L510">					gameAgtMap.put(rsGame.getString(&quot;category_code&quot;), prodMap);</span>
<span class="nc" id="L511">				}</span>
<span class="nc" id="L512">				DBConnect.closePstmt(prodPstmt);</span>
<span class="nc" id="L513">				DBConnect.closeCstmt(cstmt);</span>

<span class="nc" id="L515">				serGameAgtMap.put(&quot;CS&quot;, gameAgtMap);</span>

			}

<span class="nc bnc" id="L519" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>
<span class="nc" id="L520">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L521">				String walletQry = &quot;select wallet_id, wallet_name from st_ola_wallet_master where wallet_status='ACTIVE'&quot;;</span>
<span class="nc" id="L522">				PreparedStatement walletPstmt = con.prepareStatement(walletQry);</span>
<span class="nc" id="L523">				ResultSet rsWallet = walletPstmt.executeQuery();</span>
<span class="nc bnc" id="L524" title="All 2 branches missed.">				while (rsWallet.next()) {</span>
<span class="nc" id="L525">					int walletId = rsWallet.getInt(&quot;wallet_id&quot;);</span>
<span class="nc" id="L526">					String walletName = rsWallet.getString(&quot;wallet_name&quot;);</span>
<span class="nc" id="L527">					Map&lt;String, CompleteCollectionBean&gt; prodMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L528">					prodMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L529">					OlaOrgReportRequestBean requestBean = new OlaOrgReportRequestBean();</span>
<span class="nc" id="L530">					requestBean.setFromDate(startDate.toString());</span>
<span class="nc" id="L531">					requestBean.setToDate(endDate.toString());</span>
<span class="nc" id="L532">					requestBean.setWalletId(walletId);</span>
<span class="nc" id="L533">					Map&lt;Integer, OlaOrgReportResponseBean&gt; olaResponseBeanMap = OlaAgentReportControllerImpl</span>
							.fetchDepositWithdrawlMultipleAgent(requestBean,
									con);
<span class="nc bnc" id="L536" title="All 2 branches missed.">					for (Map.Entry&lt;Integer, OlaOrgReportResponseBean&gt; entry : olaResponseBeanMap</span>
							.entrySet()) {
<span class="nc" id="L538">						String orgId = String.valueOf(entry.getKey());</span>
<span class="nc" id="L539">						OlaOrgReportResponseBean olaResponseBean = entry</span>
								.getValue();
<span class="nc bnc" id="L541" title="All 2 branches missed.">						if (prodMap.containsKey(orgId)) {</span>
<span class="nc" id="L542">							prodMap.get(orgId).setOlaWithdrawalAmt(</span>
									olaResponseBean.getNetWithdrawalAmt());
<span class="nc" id="L544">							prodMap.get(orgId).setOlaDepositAmt(</span>
									olaResponseBean.getNetDepositAmt());
<span class="nc" id="L546">							prodMap.get(orgId).setOlaNetGaming(0.0);</span>
						}
<span class="nc" id="L548">					}</span>

<span class="nc" id="L550">					gameAgtMap.put(walletName, prodMap);</span>
<span class="nc" id="L551">				}</span>

<span class="nc" id="L553">				serGameAgtMap.put(&quot;OLA&quot;, gameAgtMap);</span>
			}

<span class="nc bnc" id="L556" title="All 2 branches missed.">			if (ReportUtility.isSLE) {</span>
<span class="nc" id="L557">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>

				// Game Master Query
<span class="nc" id="L560">				String gameQry = ReportUtility.getSLEGameMapQuery(startDate);</span>
<span class="nc" id="L561">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L562">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L564">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L565">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L566">					gameMap.putAll(getAgentMap(rsRetOrg));</span>

<span class="nc" id="L568">					SLEOrgReportRequestBean requestBean = new SLEOrgReportRequestBean();</span>
<span class="nc" id="L569">					requestBean.setFromDate(startDate);</span>
<span class="nc" id="L570">					requestBean.setToDate(endDate);</span>
<span class="nc" id="L571">					requestBean.setGameId(gameId);</span>
<span class="nc" id="L572">					Map&lt;Integer, SLEOrgReportResponseBean&gt; sleResponseBeanMap = SLEAgentReportsControllerImpl</span>
							.fetchSaleCancelPWTMultipleAgentGameWise(
									requestBean, con);
<span class="nc bnc" id="L575" title="All 2 branches missed.">					for (Map.Entry&lt;Integer, SLEOrgReportResponseBean&gt; entry : sleResponseBeanMap</span>
							.entrySet()) {
<span class="nc" id="L577">						String orgId = String.valueOf(entry.getKey());</span>
<span class="nc" id="L578">						SLEOrgReportResponseBean sleResponseBean = entry</span>
								.getValue();
<span class="nc bnc" id="L580" title="All 2 branches missed.">						if (gameMap.containsKey(orgId)) {</span>
<span class="nc" id="L581">							gameMap.get(orgId).setSleSale(</span>
									sleResponseBean.getSaleAmt());
<span class="nc" id="L583">							gameMap.get(orgId).setSleCancel(</span>
									sleResponseBean.getCancelAmt());
<span class="nc" id="L585">							gameMap.get(orgId).setSlePwt(</span>
									sleResponseBean.getPwtAmt());
<span class="nc" id="L587">							gameMap.get(orgId).setSleDirPlyPwt(</span>
									sleResponseBean.getPwtDirAmt());
						}
<span class="nc" id="L590">					}</span>

<span class="nc" id="L592">					gameAgtMap.put(rsGame.getString(&quot;game_disp_name&quot;), gameMap);</span>
<span class="nc" id="L593">				}</span>

<span class="nc" id="L595">				serGameAgtMap.put(&quot;SLE&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L597" title="All 2 branches missed.">			if (ReportUtility.isIW) {</span>
<span class="nc" id="L598">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>

				// Game Master Query
<span class="nc" id="L601">				String gameQry = ReportUtility.getIWGameMapQuery(startDate);</span>
<span class="nc" id="L602">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L603">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L604" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L605">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L606">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L607">					gameMap.putAll(getAgentMap(rsRetOrg));</span>

<span class="nc" id="L609">					IWOrgReportRequestBean requestBean = new IWOrgReportRequestBean();</span>
<span class="nc" id="L610">					requestBean.setFromDate(startDate);</span>
<span class="nc" id="L611">					requestBean.setToDate(endDate);</span>
<span class="nc" id="L612">					requestBean.setGameId(gameId);</span>
<span class="nc" id="L613">					Map&lt;Integer, IWOrgReportResponseBean&gt; iwResponseBeanMap = IWAgentReportsControllerImpl</span>
							.fetchSaleCancelPWTMultipleAgentGameWise(
									requestBean, con);
<span class="nc bnc" id="L616" title="All 2 branches missed.">					for (Map.Entry&lt;Integer, IWOrgReportResponseBean&gt; entry : iwResponseBeanMap</span>
							.entrySet()) {
<span class="nc" id="L618">						String orgId = String.valueOf(entry.getKey());</span>
<span class="nc" id="L619">						IWOrgReportResponseBean iwResponseBean = entry</span>
								.getValue();
<span class="nc bnc" id="L621" title="All 2 branches missed.">						if (gameMap.containsKey(orgId)) {</span>
<span class="nc" id="L622">							gameMap.get(orgId).setIwSale(</span>
									iwResponseBean.getSaleAmt());
<span class="nc" id="L624">							gameMap.get(orgId).setIwCancel(</span>
									iwResponseBean.getCancelAmt());
<span class="nc" id="L626">							gameMap.get(orgId).setIwPwt(</span>
									iwResponseBean.getPwtAmt());
<span class="nc" id="L628">							gameMap.get(orgId).setIwDirPlyPwt(</span>
									iwResponseBean.getPwtDirAmt());
						}
<span class="nc" id="L631">					}</span>

<span class="nc" id="L633">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L634">				}</span>

<span class="nc" id="L636">				serGameAgtMap.put(&quot;IW&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L638" title="All 2 branches missed.">			if (ReportUtility.isVS) {</span>
<span class="nc" id="L639">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>

				// Game Master Query
<span class="nc" id="L642">				String gameQry = ReportUtility.getVSGameMapQuery(startDate);</span>
<span class="nc" id="L643">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L644">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L645" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L646">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L647">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L648">					gameMap.putAll(getAgentMap(rsRetOrg));</span>

<span class="nc" id="L650">					VSOrgReportRequestBean requestBean = new VSOrgReportRequestBean();</span>
<span class="nc" id="L651">					requestBean.setFromDate(startDate);</span>
<span class="nc" id="L652">					requestBean.setToDate(endDate);</span>
<span class="nc" id="L653">					requestBean.setGameId(gameId);</span>
<span class="nc" id="L654">					Map&lt;Integer, VSOrgReportResponseBean&gt; vsResponseBeanMap = VSAgentReportsControllerImpl</span>
							.fetchSaleCancelPWTMultipleAgentGameWise(
									requestBean, con);
<span class="nc bnc" id="L657" title="All 2 branches missed.">					for (Map.Entry&lt;Integer, VSOrgReportResponseBean&gt; entry : vsResponseBeanMap</span>
							.entrySet()) {
<span class="nc" id="L659">						String orgId = String.valueOf(entry.getKey());</span>
<span class="nc" id="L660">						VSOrgReportResponseBean vsResponseBean = entry</span>
								.getValue();
<span class="nc bnc" id="L662" title="All 2 branches missed.">						if (gameMap.containsKey(orgId)) {</span>
<span class="nc" id="L663">							gameMap.get(orgId).setVsSale(</span>
									vsResponseBean.getSaleAmt());
<span class="nc" id="L665">							gameMap.get(orgId).setVsCancel(</span>
									vsResponseBean.getCancelAmt());
<span class="nc" id="L667">							gameMap.get(orgId).setVsPwt(</span>
									vsResponseBean.getPwtAmt());
<span class="nc" id="L669">							gameMap.get(orgId).setVsDirPlyPwt(</span>
									vsResponseBean.getPwtDirAmt());
						}
<span class="nc" id="L672">					}</span>
<span class="nc" id="L673">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L674">				}</span>
<span class="nc" id="L675">				serGameAgtMap.put(&quot;VS&quot;, gameAgtMap);</span>
			}
<span class="nc" id="L677">		} catch (Exception e) {</span>
<span class="nc" id="L678">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L680">			DBConnect.closePstmt(pstmt);</span>
<span class="nc" id="L681">		}</span>

<span class="nc" id="L683">		return serGameAgtMap;</span>
	}

	public Map&lt;String, CompleteCollectionBean&gt; collectionDayWise(
			Timestamp startDate, Timestamp endDate, Connection con,
			String viewBy, int orgId) {
<span class="nc" id="L689">		CallableStatement cstmt = null;</span>
<span class="nc" id="L690">		ResultSet rsGame = null;</span>
<span class="nc" id="L691">		ResultSet rs = null;</span>
<span class="nc" id="L692">		Map&lt;String, CompleteCollectionBean&gt; dateMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L693">		CompleteCollectionBean collBean = null;</span>
<span class="nc" id="L694">		String date = null;</span>

<span class="nc bnc" id="L696" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L697">			return dateMap;</span>
		}

		try {

			// Get All Agent
<span class="nc" id="L703">			Calendar startCal = Calendar.getInstance();</span>
<span class="nc" id="L704">			startCal.setTime(startDate);</span>

<span class="nc" id="L706">			Calendar endCal = Calendar.getInstance();</span>
<span class="nc" id="L707">			endCal.setTime(endDate);</span>
<span class="nc bnc" id="L708" title="All 2 branches missed.">			while (startCal.getTime().before(endCal.getTime())) {</span>
<span class="nc" id="L709">				date = new java.sql.Date(startCal.getTimeInMillis()).toString();</span>
<span class="nc" id="L710">				collBean = new CompleteCollectionBean();</span>
<span class="nc" id="L711">				collBean.setOrgName(date);</span>
<span class="nc" id="L712">				dateMap.put(date, collBean);</span>
<span class="nc" id="L713">				startCal.setTimeInMillis(startCal.getTimeInMillis() + 24 * 60</span>
						* 60 * 1000);
<span class="nc bnc" id="L715" title="All 2 branches missed.">				if (ReportUtility.isDG) {</span>
<span class="nc" id="L716">					collBean.setDrawSale(0.0);</span>
<span class="nc" id="L717">					collBean.setDrawPwt(0.0);</span>
<span class="nc" id="L718">					collBean.setDrawCancel(0.0);</span>
<span class="nc" id="L719">					collBean.setDrawDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L721" title="All 2 branches missed.">				if (ReportUtility.isSE) {</span>
<span class="nc" id="L722">					collBean.setScratchSale(0.0);</span>
<span class="nc" id="L723">					collBean.setScratchPwt(0.0);</span>
<span class="nc" id="L724">					collBean.setScratchDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L726" title="All 2 branches missed.">				if (ReportUtility.isSLE) {</span>
<span class="nc" id="L727">					collBean.setSleSale(0.0);</span>
<span class="nc" id="L728">					collBean.setSlePwt(0.0);</span>
<span class="nc" id="L729">					collBean.setSleCancel(0.0);</span>
<span class="nc" id="L730">					collBean.setSleDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L732" title="All 2 branches missed.">				if (ReportUtility.isIW) {</span>
<span class="nc" id="L733">					collBean.setIwSale(0.0);</span>
<span class="nc" id="L734">					collBean.setIwPwt(0.0);</span>
<span class="nc" id="L735">					collBean.setIwCancel(0.0);</span>
<span class="nc" id="L736">					collBean.setIwDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L738" title="All 2 branches missed.">				if (ReportUtility.isVS) {</span>
<span class="nc" id="L739">					collBean.setVsSale(0.0);</span>
<span class="nc" id="L740">					collBean.setVsPwt(0.0);</span>
<span class="nc" id="L741">					collBean.setVsCancel(0.0);</span>
<span class="nc" id="L742">					collBean.setVsDirPlyPwt(0.0);</span>
				}
			}

<span class="nc" id="L746">			cstmt = con.prepareCall(&quot;{call fillDateTable(?,?)}&quot;);</span>
<span class="nc" id="L747">			cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L748">			cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L749">			cstmt.executeQuery();</span>
<span class="nc" id="L750">			cstmt.close();</span>
<span class="nc bnc" id="L751" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
				// Game Master Query
<span class="nc" id="L753">				String gameQry = ReportUtility.getDrawGameMapQuery(startDate);</span>
<span class="nc" id="L754">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L755">				rsGame = gamePstmt.executeQuery();</span>

<span class="nc bnc" id="L757" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L758">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L759">					cstmt = con</span>
							.prepareCall(&quot;{call drawCollectionDayWisePerGame(?,?,?,?,?)}&quot;);
<span class="nc" id="L761">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L762">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L763">					cstmt.setInt(3, gameNo);</span>
<span class="nc" id="L764">					cstmt.setInt(4, orgId);</span>
<span class="nc" id="L765">					cstmt.setString(5, viewBy);</span>
<span class="nc" id="L766">					rs = cstmt.executeQuery();</span>
<span class="nc bnc" id="L767" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L768">						String tempDate = rs.getString(&quot;alldate&quot;);</span>
<span class="nc" id="L769">						dateMap.get(tempDate).setDrawSale(</span>
								dateMap.get(tempDate).getDrawSale()
										+ rs.getDouble(&quot;sale&quot;));
<span class="nc" id="L772">						dateMap.get(tempDate).setDrawCancel(</span>
								dateMap.get(tempDate).getDrawCancel()
										+ rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L775">						dateMap.get(tempDate).setDrawPwt(</span>
								dateMap.get(tempDate).getDrawPwt()
										+ rs.getDouble(&quot;pwt&quot;));
<span class="nc" id="L778">						dateMap.get(tempDate).setDrawDirPlyPwt(</span>
								dateMap.get(tempDate).getDrawDirPlyPwt()
										+ rs.getDouble(&quot;pwtDir&quot;));
<span class="nc" id="L781">					}</span>
					//cstmt.close();
<span class="nc" id="L783">				}</span>
<span class="nc" id="L784">				DBConnect.closePstmt(gamePstmt);</span>
			}
<span class="nc bnc" id="L786" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
				// Game Master Query
<span class="nc" id="L788">				String gameQry = ReportUtility</span>
						.getScratchGameMapQuery(startDate);
<span class="nc" id="L790">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L791">				rsGame = gamePstmt.executeQuery();</span>

<span class="nc bnc" id="L793" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L794">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L795">					cstmt = con</span>
							.prepareCall(&quot;{call scratchCollectionDayWisePerGame(?,?,?,?,?)}&quot;);
<span class="nc" id="L797">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L798">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L799">					cstmt.setInt(3, gameNo);</span>
<span class="nc" id="L800">					cstmt.setInt(4, orgId);</span>
<span class="nc" id="L801">					cstmt.setString(5, viewBy);</span>
<span class="nc" id="L802">					rs = cstmt.executeQuery();</span>

<span class="nc bnc" id="L804" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L805">						String tempDate = rs.getString(&quot;alldate&quot;);</span>
<span class="nc" id="L806">						double sale = rs.getDouble(&quot;sale&quot;)</span>
								- rs.getDouble(&quot;cancel&quot;);
<span class="nc" id="L808">						dateMap.get(tempDate).setScratchSale(</span>
								dateMap.get(tempDate).getScratchSale() + sale);
<span class="nc" id="L810">						dateMap.get(tempDate).setScratchPwt(</span>
								dateMap.get(tempDate).getScratchPwt()
										+ rs.getDouble(&quot;pwt&quot;));
<span class="nc" id="L813">						dateMap.get(tempDate).setScratchDirPlyPwt(</span>
								dateMap.get(tempDate).getScratchDirPlyPwt()
										+ rs.getDouble(&quot;pwtDir&quot;));
<span class="nc" id="L816">					}</span>
<span class="nc" id="L817">				}</span>
<span class="nc" id="L818">				DBConnect.closePstmt(gamePstmt);</span>
			}
<span class="nc bnc" id="L820" title="All 2 branches missed.">			if (ReportUtility.isCS) {</span>

				// Category Master Query
<span class="nc" id="L823">				String catQry = &quot;select category_id from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L824">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L825">				rsGame = prodPstmt.executeQuery();</span>

<span class="nc bnc" id="L827" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L828">					int catId = rsGame.getInt(&quot;category_id&quot;);</span>
<span class="nc" id="L829">					cstmt = con</span>
							.prepareCall(&quot;{call csCollectionDayWisePerCategory(?,?,?,?,?)}&quot;);
<span class="nc" id="L831">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L832">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L833">					cstmt.setInt(3, catId);</span>
<span class="nc" id="L834">					cstmt.setInt(4, orgId);</span>
<span class="nc" id="L835">					cstmt.setString(5, viewBy);</span>
<span class="nc" id="L836">					rs = cstmt.executeQuery();</span>
<span class="nc bnc" id="L837" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L838">						String tempDate = rs.getDate(&quot;alldate&quot;).toString();</span>
<span class="nc" id="L839">						dateMap.get(tempDate).setCSSale(</span>
								dateMap.get(tempDate).getCSSale()
										+ rs.getDouble(&quot;sale&quot;));
<span class="nc" id="L842">						dateMap.get(tempDate).setCSCancel(</span>
								dateMap.get(tempDate).getCSCancel()
										+ rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L845">					}</span>
<span class="nc" id="L846">				}</span>
<span class="nc" id="L847">				DBConnect.closePstmt(prodPstmt);</span>
			}

<span class="nc bnc" id="L850" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>

<span class="nc" id="L852">				OlaOrgReportRequestBean requestBean = new OlaOrgReportRequestBean();</span>
<span class="nc" id="L853">				requestBean.setFromDate(startDate.toString());</span>
<span class="nc" id="L854">				requestBean.setToDate(endDate.toString());</span>
<span class="nc" id="L855">				requestBean.setOrgId(orgId);</span>
<span class="nc" id="L856">				Map&lt;String, OlaOrgReportResponseBean&gt; olaResponseBeanMap = OlaAgentReportControllerImpl</span>
						.fetchDepositWithdrawlSingleAgentDateWise(requestBean,
								con);

<span class="nc bnc" id="L860" title="All 2 branches missed.">				for (Map.Entry&lt;String, OlaOrgReportResponseBean&gt; entry : olaResponseBeanMap</span>
						.entrySet()) {
<span class="nc" id="L862">					String txndate = entry.getKey();</span>
<span class="nc" id="L863">					OlaOrgReportResponseBean olaResponseBean = entry.getValue();</span>
<span class="nc bnc" id="L864" title="All 2 branches missed.">					if (dateMap.containsKey(txndate)) {</span>
<span class="nc" id="L865">						dateMap.get(txndate).setOlaWithdrawalAmt(</span>
								olaResponseBean.getNetWithdrawalAmt());
<span class="nc" id="L867">						dateMap.get(txndate).setOlaDepositAmt(</span>
								olaResponseBean.getNetDepositAmt());
					}
<span class="nc" id="L870">				}</span>
			}

<span class="nc bnc" id="L873" title="All 2 branches missed.">			if (ReportUtility.isSLE) {</span>
<span class="nc" id="L874">				String gameQry = ReportUtility.getSLEGameMapQuery(startDate);</span>
<span class="nc" id="L875">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L876">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L877" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L878">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>

<span class="nc" id="L880">					SLEOrgReportRequestBean requestBean = new SLEOrgReportRequestBean();</span>
<span class="nc" id="L881">					requestBean.setFromDate(startDate);</span>
<span class="nc" id="L882">					requestBean.setToDate(endDate);</span>
<span class="nc" id="L883">					requestBean.setGameId(gameId);</span>
<span class="nc" id="L884">					requestBean.setOrgId(orgId);</span>

<span class="nc" id="L886">					Map&lt;String, SLEOrgReportResponseBean&gt; responseMap = null;</span>

<span class="nc bnc" id="L888" title="All 2 branches missed.">					if (&quot;BO&quot;.equals(viewBy)) {</span>
<span class="nc" id="L889">						responseMap = SLEAgentReportsControllerImpl</span>
								.fetchSalePWTDayWiseForBO(requestBean, con);
<span class="nc bnc" id="L891" title="All 2 branches missed.">					} else if (&quot;AGENT&quot;.equals(viewBy)) {</span>
<span class="nc" id="L892">						responseMap = SLEAgentReportsControllerImpl</span>
								.fetchSalePWTDayWiseForAgent(requestBean, con);
					}

<span class="nc bnc" id="L896" title="All 2 branches missed.">					for (Map.Entry&lt;String, SLEOrgReportResponseBean&gt; entry : responseMap</span>
							.entrySet()) {
<span class="nc" id="L898">						String tmpdate = entry.getKey();</span>
<span class="nc" id="L899">						SLEOrgReportResponseBean responseBean = entry</span>
								.getValue();
<span class="nc" id="L901">						dateMap.get(tmpdate).setSleSale(</span>
								dateMap.get(tmpdate).getSleSale()
										+ responseBean.getSaleAmt());
<span class="nc" id="L904">						dateMap.get(tmpdate).setSleCancel(</span>
								dateMap.get(tmpdate).getSleCancel()
										+ responseBean.getCancelAmt());
<span class="nc" id="L907">						dateMap.get(tmpdate).setSlePwt(</span>
								dateMap.get(tmpdate).getSlePwt()
										+ responseBean.getPwtAmt());
<span class="nc" id="L910">						dateMap.get(tmpdate).setSleDirPlyPwt(</span>
								dateMap.get(tmpdate).getSleDirPlyPwt()
										+ responseBean.getPwtDirAmt());
<span class="nc" id="L913">					}</span>
<span class="nc" id="L914">				}</span>
			}
<span class="nc bnc" id="L916" title="All 2 branches missed.">			if (ReportUtility.isIW) {</span>
<span class="nc" id="L917">				String gameQry = ReportUtility.getIWGameMapQuery(startDate);</span>
<span class="nc" id="L918">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L919">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L920" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L921">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>

<span class="nc" id="L923">					IWOrgReportRequestBean requestBean = new IWOrgReportRequestBean();</span>
<span class="nc" id="L924">					requestBean.setFromDate(startDate);</span>
<span class="nc" id="L925">					requestBean.setToDate(endDate);</span>
<span class="nc" id="L926">					requestBean.setGameId(gameId);</span>
<span class="nc" id="L927">					requestBean.setOrgId(orgId);</span>

<span class="nc" id="L929">					Map&lt;String, IWOrgReportResponseBean&gt; responseMap = null;</span>

<span class="nc bnc" id="L931" title="All 2 branches missed.">					if (&quot;BO&quot;.equals(viewBy)) {</span>
<span class="nc" id="L932">						responseMap = IWAgentReportsControllerImpl.fetchSalePWTDayWiseForBO(requestBean, con);</span>
<span class="nc bnc" id="L933" title="All 2 branches missed.">					} else if (&quot;AGENT&quot;.equals(viewBy)) {</span>
<span class="nc" id="L934">						responseMap = IWAgentReportsControllerImpl.fetchSalePWTDayWiseForAgent(requestBean, con);</span>
					}

<span class="nc bnc" id="L937" title="All 2 branches missed.">					for (Map.Entry&lt;String, IWOrgReportResponseBean&gt; entry : responseMap.entrySet()) {</span>
<span class="nc" id="L938">						String tmpdate = entry.getKey();</span>
<span class="nc" id="L939">						IWOrgReportResponseBean responseBean = entry.getValue();</span>
<span class="nc" id="L940">						dateMap.get(tmpdate).setIwSale(dateMap.get(tmpdate).getIwSale() + responseBean.getSaleAmt());</span>
<span class="nc" id="L941">						dateMap.get(tmpdate).setIwCancel(dateMap.get(tmpdate).getIwCancel() + responseBean.getCancelAmt());</span>
<span class="nc" id="L942">						dateMap.get(tmpdate).setIwPwt(dateMap.get(tmpdate).getIwPwt() + responseBean.getPwtAmt());</span>
<span class="nc" id="L943">						dateMap.get(tmpdate).setIwDirPlyPwt(dateMap.get(tmpdate).getIwDirPlyPwt() + responseBean.getPwtDirAmt());</span>
<span class="nc" id="L944">					}</span>
<span class="nc" id="L945">				}</span>
			}
<span class="nc bnc" id="L947" title="All 2 branches missed.">			if (ReportUtility.isVS) {</span>
<span class="nc" id="L948">				String gameQry = ReportUtility.getVSGameMapQuery(startDate);</span>
<span class="nc" id="L949">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L950">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L951" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L952">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>

<span class="nc" id="L954">					VSOrgReportRequestBean requestBean = new VSOrgReportRequestBean();</span>
<span class="nc" id="L955">					requestBean.setFromDate(startDate);</span>
<span class="nc" id="L956">					requestBean.setToDate(endDate);</span>
<span class="nc" id="L957">					requestBean.setGameId(gameId);</span>
<span class="nc" id="L958">					requestBean.setOrgId(orgId);</span>

<span class="nc" id="L960">					Map&lt;String, VSOrgReportResponseBean&gt; responseMap = null;</span>

<span class="nc bnc" id="L962" title="All 2 branches missed.">					if (&quot;BO&quot;.equals(viewBy)) {</span>
<span class="nc" id="L963">						responseMap = VSAgentReportsControllerImpl.fetchSalePWTDayWiseForBO(requestBean, con);</span>
<span class="nc bnc" id="L964" title="All 2 branches missed.">					} else if (&quot;AGENT&quot;.equals(viewBy)) {</span>
<span class="nc" id="L965">						responseMap = VSAgentReportsControllerImpl.fetchSalePWTDayWiseForAgent(requestBean, con);</span>
					}

<span class="nc bnc" id="L968" title="All 2 branches missed.">					for (Map.Entry&lt;String, VSOrgReportResponseBean&gt; entry : responseMap.entrySet()) {</span>
<span class="nc" id="L969">						String tmpdate = entry.getKey();</span>
<span class="nc" id="L970">						VSOrgReportResponseBean responseBean = entry.getValue();</span>
<span class="nc" id="L971">						dateMap.get(tmpdate).setVsSale(dateMap.get(tmpdate).getVsSale() + responseBean.getSaleAmt());</span>
<span class="nc" id="L972">						dateMap.get(tmpdate).setVsCancel(dateMap.get(tmpdate).getVsCancel() + responseBean.getCancelAmt());</span>
<span class="nc" id="L973">						dateMap.get(tmpdate).setVsPwt(dateMap.get(tmpdate).getVsPwt() + responseBean.getPwtAmt());</span>
<span class="nc" id="L974">						dateMap.get(tmpdate).setVsDirPlyPwt(dateMap.get(tmpdate).getVsDirPlyPwt() + responseBean.getPwtDirAmt());</span>
<span class="nc" id="L975">					}</span>
<span class="nc" id="L976">				}</span>
			}

<span class="nc" id="L979">		} catch (Exception e) {</span>
<span class="nc" id="L980">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L982">			DBConnect.closeCstmt(cstmt);</span>
<span class="nc" id="L983">		}</span>
<span class="nc" id="L984">		return dateMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionDayWiseExpand(
			Timestamp startDate, Timestamp endDate, Connection con,
			String viewBy, int orgId) {
<span class="nc" id="L990">		CallableStatement cstmt = null;</span>
<span class="nc" id="L991">		ResultSet rsGame = null;</span>
<span class="nc" id="L992">		ResultSet rs = null;</span>
<span class="nc" id="L993">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; serGameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;();</span>
<span class="nc" id="L994">		Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt; gameAgtMap = null;</span>

<span class="nc bnc" id="L996" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L997">			return serGameAgtMap;</span>
		}

		try {
<span class="nc" id="L1001">			cstmt = con.prepareCall(&quot;{call fillDateTable(?,?)}&quot;);</span>
<span class="nc" id="L1002">			cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L1003">			cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L1004">			cstmt.executeQuery();</span>
<span class="nc bnc" id="L1005" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L1006">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>

				// Game Master Query
<span class="nc" id="L1009">				String gameQry = ReportUtility.getDrawGameMapQuery(startDate);</span>
<span class="nc" id="L1010">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1011">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L1012" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1013">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1014">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1015">					gameMap.putAll(getDayMap(startDate, endDate));</span>
<span class="nc" id="L1016">					cstmt = con</span>
							.prepareCall(&quot;{call drawCollectionDayWisePerGame(?,?,?,?,?)}&quot;);
<span class="nc" id="L1018">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L1019">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L1020">					cstmt.setInt(3, gameId);</span>
<span class="nc" id="L1021">					cstmt.setInt(4, orgId);</span>
<span class="nc" id="L1022">					cstmt.setString(5, viewBy);</span>
<span class="nc" id="L1023">					rs = cstmt.executeQuery();</span>
<span class="nc bnc" id="L1024" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1025">						String agtId = rs.getString(&quot;alldate&quot;);</span>
<span class="nc" id="L1026">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L1027">						gameMap.get(agtId)</span>
								.setDrawCancel(rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L1029">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>
<span class="nc" id="L1030">						gameMap.get(agtId).setDrawDirPlyPwt(</span>
								rs.getDouble(&quot;pwtDir&quot;));
<span class="nc" id="L1032">					}</span>

<span class="nc" id="L1034">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L1035">				}</span>
<span class="nc" id="L1036">				DBConnect.closePstmt(gamePstmt);</span>

<span class="nc" id="L1038">				serGameAgtMap.put(&quot;DG&quot;, gameAgtMap);</span>
			}

<span class="nc bnc" id="L1041" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
<span class="nc" id="L1042">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>

				// Game Master Query
<span class="nc" id="L1045">				String gameQry = &quot;select game_id,game_name from st_se_game_master&quot;;</span>
<span class="nc" id="L1046">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1047">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L1048" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1049">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1050">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1051">					gameMap.putAll(getDayMap(startDate, endDate));</span>
<span class="nc" id="L1052">					cstmt = con</span>
							.prepareCall(&quot;{call scratchCollectionDayWisePerGame(?,?,?,?,?)}&quot;);
<span class="nc" id="L1054">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L1055">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L1056">					cstmt.setInt(3, gameNo);</span>
<span class="nc" id="L1057">					cstmt.setInt(4, orgId);</span>
<span class="nc" id="L1058">					cstmt.setString(5, viewBy);</span>
<span class="nc" id="L1059">					rs = cstmt.executeQuery();</span>

<span class="nc bnc" id="L1061" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1062">						String tempDate = rs.getString(&quot;alldate&quot;);</span>
<span class="nc" id="L1063">						double sale = rs.getDouble(&quot;sale&quot;)</span>
								- rs.getDouble(&quot;cancel&quot;);
<span class="nc" id="L1065">						gameMap.get(tempDate).setDrawSale(sale);</span>
<span class="nc" id="L1066">						gameMap.get(tempDate).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>
<span class="nc" id="L1067">						gameMap.get(tempDate).setScratchDirPlyPwt(</span>
								rs.getDouble(&quot;pwtDir&quot;));
<span class="nc" id="L1069">					}</span>
<span class="nc" id="L1070">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L1071">				}</span>
<span class="nc" id="L1072">				DBConnect.closePstmt(gamePstmt);</span>

<span class="nc" id="L1074">				serGameAgtMap.put(&quot;SE&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L1076" title="All 2 branches missed.">			if (ReportUtility.isCS) {</span>

<span class="nc" id="L1078">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>

				// Category Master Query
<span class="nc" id="L1081">				String catQry = &quot;select category_id,category_code from st_cs_product_category_master&quot;;</span>
<span class="nc" id="L1082">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L1083">				rsGame = prodPstmt.executeQuery();</span>
<span class="nc bnc" id="L1084" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1085">					int catId = rsGame.getInt(&quot;category_id&quot;);</span>
<span class="nc" id="L1086">					Map&lt;String, CompleteCollectionBean&gt; prodMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1087">					prodMap.putAll(getDayMap(startDate, endDate));</span>
<span class="nc" id="L1088">					cstmt = con</span>
							.prepareCall(&quot;{call csCollectionDayWisePerCategory(?,?,?,?,?)}&quot;);
<span class="nc" id="L1090">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L1091">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L1092">					cstmt.setInt(3, catId);</span>
<span class="nc" id="L1093">					cstmt.setInt(4, orgId);</span>
<span class="nc" id="L1094">					cstmt.setString(5, viewBy);</span>
<span class="nc" id="L1095">					rs = cstmt.executeQuery();</span>
<span class="nc bnc" id="L1096" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1097">						String agtId = rs.getString(&quot;alldate&quot;).split(&quot; &quot;)[0];</span>
<span class="nc" id="L1098">						prodMap.get(agtId).setCSSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L1099">						prodMap.get(agtId).setCSCancel(rs.getDouble(&quot;cancel&quot;));</span>
<span class="nc" id="L1100">					}</span>

<span class="nc" id="L1102">					gameAgtMap.put(rsGame.getString(&quot;category_code&quot;), prodMap);</span>
<span class="nc" id="L1103">				}</span>
<span class="nc" id="L1104">				DBConnect.closePstmt(prodPstmt);</span>

<span class="nc" id="L1106">				serGameAgtMap.put(&quot;CS&quot;, gameAgtMap);</span>

			}

<span class="nc bnc" id="L1110" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>
<span class="nc" id="L1111">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L1112">				String walletQry = &quot;select wallet_id, wallet_name from st_ola_wallet_master where wallet_status='ACTIVE'&quot;;</span>
<span class="nc" id="L1113">				PreparedStatement walletPstmt = con.prepareStatement(walletQry);</span>
<span class="nc" id="L1114">				ResultSet rsWallet = walletPstmt.executeQuery();</span>
<span class="nc bnc" id="L1115" title="All 2 branches missed.">				while (rsWallet.next()) {</span>
<span class="nc" id="L1116">					int walletId = rsWallet.getInt(&quot;wallet_id&quot;);</span>
<span class="nc" id="L1117">					String walletName = rsWallet.getString(&quot;wallet_name&quot;);</span>
<span class="nc" id="L1118">					Map&lt;String, CompleteCollectionBean&gt; prodMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1119">					prodMap.putAll(getDayMap(startDate, endDate));</span>
<span class="nc" id="L1120">					OlaOrgReportRequestBean requestBean = new OlaOrgReportRequestBean();</span>
<span class="nc" id="L1121">					requestBean.setFromDate(startDate.toString());</span>
<span class="nc" id="L1122">					requestBean.setToDate(endDate.toString());</span>
<span class="nc" id="L1123">					requestBean.setWalletId(walletId);</span>
<span class="nc" id="L1124">					Map&lt;String, OlaOrgReportResponseBean&gt; olaResponseBeanMap = OlaAgentReportControllerImpl</span>
							.fetchDepositWithdrawlSingleAgentDateWise(
									requestBean, con);
<span class="nc bnc" id="L1127" title="All 2 branches missed.">					for (Map.Entry&lt;String, OlaOrgReportResponseBean&gt; entry : olaResponseBeanMap</span>
							.entrySet()) {
<span class="nc" id="L1129">						String txnDate = entry.getKey();</span>
<span class="nc" id="L1130">						OlaOrgReportResponseBean olaResponseBean = entry</span>
								.getValue();
<span class="nc bnc" id="L1132" title="All 2 branches missed.">						if (prodMap.containsKey(txnDate)) {</span>
<span class="nc" id="L1133">							prodMap.get(txnDate).setOlaWithdrawalAmt(</span>
									olaResponseBean.getNetWithdrawalAmt());
<span class="nc" id="L1135">							prodMap.get(txnDate).setOlaDepositAmt(</span>
									olaResponseBean.getNetDepositAmt());

						}
<span class="nc" id="L1139">					}</span>

<span class="nc" id="L1141">					gameAgtMap.put(walletName, prodMap);</span>
<span class="nc" id="L1142">				}</span>

<span class="nc" id="L1144">				serGameAgtMap.put(&quot;OLA&quot;, gameAgtMap);</span>
			}

<span class="nc bnc" id="L1147" title="All 2 branches missed.">			if (ReportUtility.isSLE) {</span>
<span class="nc" id="L1148">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>

				// Game Master Query
<span class="nc" id="L1151">				String gameQry = ReportUtility.getSLEGameMapQuery(startDate);</span>
<span class="nc" id="L1152">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1153">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L1154" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1155">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1156">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1157">					gameMap.putAll(getDayMap(startDate, endDate));</span>

<span class="nc" id="L1159">					SLEOrgReportRequestBean requestBean = new SLEOrgReportRequestBean();</span>
<span class="nc" id="L1160">					requestBean.setFromDate(startDate);</span>
<span class="nc" id="L1161">					requestBean.setToDate(endDate);</span>
<span class="nc" id="L1162">					requestBean.setGameId(gameId);</span>
<span class="nc" id="L1163">					requestBean.setOrgId(orgId);</span>

<span class="nc" id="L1165">					Map&lt;String, SLEOrgReportResponseBean&gt; responseMap = null;</span>

<span class="nc bnc" id="L1167" title="All 2 branches missed.">					if (&quot;BO&quot;.equals(viewBy)) {</span>
<span class="nc" id="L1168">						responseMap = SLEAgentReportsControllerImpl</span>
								.fetchSalePWTDayWiseForBO(requestBean, con);
<span class="nc bnc" id="L1170" title="All 2 branches missed.">					} else if (&quot;AGENT&quot;.equals(viewBy)) {</span>
<span class="nc" id="L1171">						responseMap = SLEAgentReportsControllerImpl</span>
								.fetchSalePWTDayWiseForAgent(requestBean, con);
					}

<span class="nc bnc" id="L1175" title="All 2 branches missed.">					for (Map.Entry&lt;String, SLEOrgReportResponseBean&gt; entry : responseMap</span>
							.entrySet()) {
<span class="nc" id="L1177">						String agtId = entry.getKey();</span>
<span class="nc" id="L1178">						SLEOrgReportResponseBean responseBean = entry</span>
								.getValue();
<span class="nc" id="L1180">						gameMap.get(agtId)</span>
								.setSleSale(responseBean.getSaleAmt());
<span class="nc" id="L1182">						gameMap.get(agtId).setSleCancel(</span>
								responseBean.getCancelAmt());
<span class="nc" id="L1184">						gameMap.get(agtId).setSlePwt(responseBean.getPwtAmt());</span>
<span class="nc" id="L1185">						gameMap.get(agtId).setSleDirPlyPwt(</span>
								responseBean.getPwtDirAmt());
<span class="nc" id="L1187">					}</span>
<span class="nc" id="L1188">					gameAgtMap.put(rsGame.getString(&quot;game_disp_name&quot;), gameMap);</span>
<span class="nc" id="L1189">				}</span>

<span class="nc" id="L1191">				serGameAgtMap.put(&quot;SLE&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L1193" title="All 2 branches missed.">			if (ReportUtility.isIW) {</span>
<span class="nc" id="L1194">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>

				// Game Master Query
<span class="nc" id="L1197">				String gameQry = ReportUtility.getIWGameMapQuery(startDate);</span>
<span class="nc" id="L1198">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1199">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L1200" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1201">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1202">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1203">					gameMap.putAll(getDayMap(startDate, endDate));</span>

<span class="nc" id="L1205">					IWOrgReportRequestBean requestBean = new IWOrgReportRequestBean();</span>
<span class="nc" id="L1206">					requestBean.setFromDate(startDate);</span>
<span class="nc" id="L1207">					requestBean.setToDate(endDate);</span>
<span class="nc" id="L1208">					requestBean.setGameId(gameId);</span>
<span class="nc" id="L1209">					requestBean.setOrgId(orgId);</span>

<span class="nc" id="L1211">					Map&lt;String, IWOrgReportResponseBean&gt; responseMap = null;</span>

<span class="nc bnc" id="L1213" title="All 2 branches missed.">					if (&quot;BO&quot;.equals(viewBy)) {</span>
<span class="nc" id="L1214">						responseMap = IWAgentReportsControllerImpl</span>
								.fetchSalePWTDayWiseForBO(requestBean, con);
<span class="nc bnc" id="L1216" title="All 2 branches missed.">					} else if (&quot;AGENT&quot;.equals(viewBy)) {</span>
<span class="nc" id="L1217">						responseMap = IWAgentReportsControllerImpl</span>
								.fetchSalePWTDayWiseForAgent(requestBean, con);
					}

<span class="nc bnc" id="L1221" title="All 2 branches missed.">					for (Map.Entry&lt;String, IWOrgReportResponseBean&gt; entry : responseMap</span>
							.entrySet()) {
<span class="nc" id="L1223">						String agtId = entry.getKey();</span>
<span class="nc" id="L1224">						IWOrgReportResponseBean responseBean = entry</span>
								.getValue();
<span class="nc" id="L1226">						gameMap.get(agtId)</span>
								.setIwSale(responseBean.getSaleAmt());
<span class="nc" id="L1228">						gameMap.get(agtId).setIwCancel(</span>
								responseBean.getCancelAmt());
<span class="nc" id="L1230">						gameMap.get(agtId).setIwPwt(responseBean.getPwtAmt());</span>
<span class="nc" id="L1231">						gameMap.get(agtId).setIwDirPlyPwt(</span>
								responseBean.getPwtDirAmt());
<span class="nc" id="L1233">					}</span>
<span class="nc" id="L1234">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L1235">				}</span>

<span class="nc" id="L1237">				serGameAgtMap.put(&quot;IW&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L1239" title="All 2 branches missed.">			if (ReportUtility.isVS) {</span>
<span class="nc" id="L1240">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>

				// Game Master Query
<span class="nc" id="L1243">				String gameQry = ReportUtility.getVSGameMapQuery(startDate);</span>
<span class="nc" id="L1244">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1245">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L1246" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1247">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1248">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1249">					gameMap.putAll(getDayMap(startDate, endDate));</span>

<span class="nc" id="L1251">					VSOrgReportRequestBean requestBean = new VSOrgReportRequestBean();</span>
<span class="nc" id="L1252">					requestBean.setFromDate(startDate);</span>
<span class="nc" id="L1253">					requestBean.setToDate(endDate);</span>
<span class="nc" id="L1254">					requestBean.setGameId(gameId);</span>
<span class="nc" id="L1255">					requestBean.setOrgId(orgId);</span>

<span class="nc" id="L1257">					Map&lt;String, VSOrgReportResponseBean&gt; responseMap = null;</span>

<span class="nc bnc" id="L1259" title="All 2 branches missed.">					if (&quot;BO&quot;.equals(viewBy)) {</span>
<span class="nc" id="L1260">						responseMap = VSAgentReportsControllerImpl.fetchSalePWTDayWiseForBO(requestBean, con);</span>
<span class="nc bnc" id="L1261" title="All 2 branches missed.">					} else if (&quot;AGENT&quot;.equals(viewBy)) {</span>
<span class="nc" id="L1262">						responseMap = VSAgentReportsControllerImpl.fetchSalePWTDayWiseForAgent(requestBean, con);</span>
					}

<span class="nc bnc" id="L1265" title="All 2 branches missed.">					for (Map.Entry&lt;String, VSOrgReportResponseBean&gt; entry : responseMap.entrySet()) {</span>
<span class="nc" id="L1266">						String agtId = entry.getKey();</span>
<span class="nc" id="L1267">						VSOrgReportResponseBean responseBean = entry.getValue();</span>
<span class="nc" id="L1268">						gameMap.get(agtId).setVsSale(responseBean.getSaleAmt());</span>
<span class="nc" id="L1269">						gameMap.get(agtId).setVsCancel(responseBean.getCancelAmt());</span>
<span class="nc" id="L1270">						gameMap.get(agtId).setVsPwt(responseBean.getPwtAmt());</span>
<span class="nc" id="L1271">						gameMap.get(agtId).setVsDirPlyPwt(responseBean.getPwtDirAmt());</span>
<span class="nc" id="L1272">					}</span>
<span class="nc" id="L1273">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L1274">				}</span>
<span class="nc" id="L1275">				serGameAgtMap.put(&quot;VS&quot;, gameAgtMap);</span>
			}
<span class="nc" id="L1277">			logger.debug(serGameAgtMap);</span>
<span class="nc" id="L1278">		} catch (Exception e) {</span>
<span class="nc" id="L1279">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1281">			DBConnect.closeCstmt(cstmt);</span>
<span class="nc" id="L1282">		}</span>
<span class="nc" id="L1283">		return serGameAgtMap;</span>
	}

	public Map&lt;String, CompleteCollectionBean&gt; collectionReport(
			Timestamp startDate, Timestamp endDate, String reportType) {

<span class="nc" id="L1289">		Connection con = null;</span>
<span class="nc" id="L1290">		Map&lt;String, CompleteCollectionBean&gt; agtMap = null;</span>

		try {
<span class="nc" id="L1293">			con = DBConnect.getConnection();</span>

<span class="nc bnc" id="L1295" title="All 2 branches missed.">			if (&quot;Agent Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1296">				agtMap = collectionAgentWise(startDate, endDate, con);</span>
<span class="nc bnc" id="L1297" title="All 2 branches missed.">			} else if (&quot;Day Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1298">				agtMap = collectionDayWise(startDate, endDate, con, &quot;BO&quot;, 0);</span>
			}
<span class="nc" id="L1300">		} catch (Exception e) {</span>
<span class="nc" id="L1301">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1303">			DBConnect.closeCon(con);</span>
<span class="nc" id="L1304">		}</span>
<span class="nc" id="L1305">		return agtMap;</span>
	}

	public Map&lt;String, CompleteCollectionBean&gt; collectionReport(
			Timestamp startDate, Timestamp endDate, String reportType, ReportStatusBean reportStatusBean) {

<span class="nc" id="L1311">		Connection con = null;</span>
<span class="nc" id="L1312">		Map&lt;String, CompleteCollectionBean&gt; agtMap = null;</span>

		try {
<span class="nc bnc" id="L1315" title="All 4 branches missed.">			if(&quot;NO&quot;.equals(Utility.getPropertyValue(&quot;IS_DATA_FROM_REPLICA&quot;)) || &quot;MAIN_DB&quot;.equals(reportStatusBean.getReportingFrom()))</span>
<span class="nc" id="L1316">				con = DBConnect.getConnection();</span>
			else
<span class="nc" id="L1318">				con = DBConnectReplica.getConnection();</span>

<span class="nc bnc" id="L1320" title="All 2 branches missed.">			if (&quot;Agent Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1321">				agtMap = collectionAgentWise(startDate, endDate, con);</span>
<span class="nc bnc" id="L1322" title="All 2 branches missed.">			} else if (&quot;Day Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1323">				agtMap = collectionDayWise(startDate, endDate, con, &quot;BO&quot;, 0);</span>
			}
<span class="nc" id="L1325">		} catch (Exception e) {</span>
<span class="nc" id="L1326">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1328">			DBConnect.closeCon(con);</span>
<span class="nc" id="L1329">		}</span>
<span class="nc" id="L1330">		return agtMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionReportExpand(
			Timestamp startDate, Timestamp endDate, String reportType, ReportStatusBean reportStatusBean) {

<span class="nc" id="L1336">		Connection con = null;</span>
<span class="nc" id="L1337">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; agtMap = null;</span>

		try {
<span class="nc bnc" id="L1340" title="All 4 branches missed.">			if(&quot;NO&quot;.equals(Utility.getPropertyValue(&quot;IS_DATA_FROM_REPLICA&quot;)) || &quot;MAIN_DB&quot;.equals(reportStatusBean.getReportingFrom()))</span>
<span class="nc" id="L1341">				con = DBConnect.getConnection();</span>
			else
<span class="nc" id="L1343">				con = DBConnectReplica.getConnection();</span>

<span class="nc bnc" id="L1345" title="All 2 branches missed.">			if (&quot;Agent Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L1346">				agtMap = collectionAgentWiseExpand(startDate, endDate, con);</span>
<span class="nc bnc" id="L1347" title="All 2 branches missed.">			} else if (&quot;Day Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L1348">				agtMap = collectionDayWiseExpand(startDate, endDate, con, &quot;BO&quot;,</span>
						0);
			}
<span class="nc" id="L1351">		} catch (Exception e) {</span>
<span class="nc" id="L1352">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1354">			DBConnect.closeCon(con);</span>
<span class="nc" id="L1355">		}</span>
<span class="nc" id="L1356">		return agtMap;</span>
	}

	public Map&lt;String, CompleteCollectionBean&gt; collectionReportForAgent(
			Timestamp startDate, Timestamp endDate, int agtOrgId,
			String reportType) {

<span class="nc" id="L1363">		Connection con = null;</span>
<span class="nc" id="L1364">		Map&lt;String, CompleteCollectionBean&gt; agtMap = null;</span>

		try {
<span class="nc" id="L1367">			con = DBConnect.getConnection();</span>

<span class="nc bnc" id="L1369" title="All 2 branches missed.">			if (&quot;Retailer Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1370">				agtMap = collectionRetailerWise(startDate, endDate, con,</span>
						agtOrgId);
<span class="nc bnc" id="L1372" title="All 2 branches missed.">			} else if (&quot;Agent Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1373">				agtMap = collectionAgentWise(startDate, endDate, con);</span>
<span class="nc bnc" id="L1374" title="All 2 branches missed.">			} else if (&quot;Day Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L1375">				agtMap = collectionDayWise(startDate, endDate, con, &quot;AGENT&quot;,</span>
						agtOrgId);
			}
<span class="nc" id="L1378">		} catch (Exception e) {</span>
<span class="nc" id="L1379">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1381">			DBConnect.closeCon(con);</span>
<span class="nc" id="L1382">		}</span>
<span class="nc" id="L1383">		return agtMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionReportForAgentExpand(
			Timestamp startDate, Timestamp endDate, String reportType,
			int agtOrgId) {

<span class="nc" id="L1390">		Connection con = null;</span>
<span class="nc" id="L1391">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; agtMap = null;</span>

		try {
<span class="nc" id="L1394">			con = DBConnect.getConnection();</span>

<span class="nc bnc" id="L1396" title="All 2 branches missed.">			if (&quot;Retailer Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L1397">				agtMap = collectionRetailerWiseExpand(startDate, endDate, con,</span>
						agtOrgId);
<span class="nc bnc" id="L1399" title="All 2 branches missed.">			} else if (&quot;Day Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L1400">				agtMap = collectionDayWiseExpand(startDate, endDate, con,</span>
						&quot;AGENT&quot;, agtOrgId);
			}
<span class="nc" id="L1403">		} catch (Exception e) {</span>
<span class="nc" id="L1404">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1406">			DBConnect.closeCon(con);</span>
<span class="nc" id="L1407">		}</span>
<span class="nc" id="L1408">		return agtMap;</span>
	}

	public Map&lt;String, CompleteCollectionBean&gt; collectionRetailerWise(
			Timestamp startDate, Timestamp endDate, Connection con, int agtOrgId) {
<span class="nc" id="L1413">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1414">		ResultSet rsGame = null;</span>
<span class="nc" id="L1415">		ResultSet rs = null;</span>
<span class="nc" id="L1416">		ResultSet rsRetOrg = null;</span>
<span class="nc" id="L1417">		Map&lt;String, CompleteCollectionBean&gt; agtMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1418">		CompleteCollectionBean collBean = null;</span>

<span class="nc" id="L1420">		String agtOrgQry = null;</span>

<span class="nc bnc" id="L1422" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L1423">			return agtMap;</span>
		}

		// for scratch game
		try {

<span class="nc bnc" id="L1429" title="All 2 branches missed.">			if (agtOrgId == 0) {</span>
				/*
				 * agtOrgQry =
				 * &quot;select name,organization_id from st_lms_organization_master where organization_type='RETAILER' order by name&quot;
				 * ;
				 */
<span class="nc" id="L1435">				agtOrgQry = QueryManager.getOrgQry(&quot;RETAILER&quot;);</span>
			} else {
				/*
				 * agtOrgQry =
				 * &quot;select name,organization_id from st_lms_organization_master where parent_id=&quot;
				 * + agtOrgId + &quot; order by name&quot;;
				 */

<span class="nc" id="L1443">				String appendOrder = QueryManager.getAppendOrgOrder();</span>
<span class="nc" id="L1444">				agtOrgQry = &quot;select name orgCode,organization_id from st_lms_organization_master where  parent_id=&quot;</span>
						+ agtOrgId + &quot;  order by &quot; + appendOrder;
<span class="nc bnc" id="L1446" title="All 2 branches missed.">				if ((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;CODE&quot;)) {</span>

<span class="nc" id="L1448">					agtOrgQry = &quot;select org_code orgCode,organization_id from st_lms_organization_master where  parent_id=&quot;</span>
							+ agtOrgId + &quot;  order by &quot; + appendOrder;

<span class="nc bnc" id="L1451" title="All 2 branches missed.">				} else if ((LMSFilterDispatcher.orgFieldType)</span>
						.equalsIgnoreCase(&quot;CODE_NAME&quot;)) {

<span class="nc" id="L1454">					agtOrgQry = &quot;select concat(org_code,'_',name) orgCode,organization_id from st_lms_organization_master where  parent_id=&quot;</span>
							+ agtOrgId + &quot;  order by &quot; + appendOrder;

<span class="nc bnc" id="L1457" title="All 2 branches missed.">				} else if ((LMSFilterDispatcher.orgFieldType)</span>
						.equalsIgnoreCase(&quot;NAME_CODE&quot;)) {
<span class="nc" id="L1459">					agtOrgQry = &quot;select concat(name,'_',org_code) orgCode,organization_id from st_lms_organization_master where  parent_id=&quot;</span>
							+ agtOrgId + &quot;  order by &quot; + appendOrder;

				}

			}
<span class="nc" id="L1465">			pstmt = con.prepareStatement(agtOrgQry);</span>
<span class="nc" id="L1466">			rsRetOrg = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1467" title="All 2 branches missed.">			while (rsRetOrg.next()) {</span>
<span class="nc" id="L1468">				collBean = new CompleteCollectionBean();</span>
<span class="nc" id="L1469">				collBean.setOrgName(rsRetOrg.getString(&quot;orgCode&quot;));</span>
<span class="nc bnc" id="L1470" title="All 2 branches missed.">				if (ReportUtility.isDG) {</span>
<span class="nc" id="L1471">					collBean.setDrawSale(0.0);</span>
<span class="nc" id="L1472">					collBean.setDrawPwt(0.0);</span>
<span class="nc" id="L1473">					collBean.setDrawCancel(0.0);</span>
<span class="nc" id="L1474">					collBean.setDrawDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L1476" title="All 2 branches missed.">				if (ReportUtility.isSE) {</span>
<span class="nc" id="L1477">					collBean.setScratchSale(0.0);</span>
<span class="nc" id="L1478">					collBean.setScratchPwt(0.0);</span>
<span class="nc" id="L1479">					collBean.setScratchDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L1481" title="All 2 branches missed.">				if (ReportUtility.isSLE) {</span>
<span class="nc" id="L1482">					collBean.setSleSale(0.0);</span>
<span class="nc" id="L1483">					collBean.setSlePwt(0.0);</span>
<span class="nc" id="L1484">					collBean.setSleCancel(0.0);</span>
<span class="nc" id="L1485">					collBean.setSleDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L1487" title="All 2 branches missed.">				if (ReportUtility.isIW) {</span>
<span class="nc" id="L1488">					collBean.setIwSale(0.0);</span>
<span class="nc" id="L1489">					collBean.setIwPwt(0.0);</span>
<span class="nc" id="L1490">					collBean.setIwCancel(0.0);</span>
<span class="nc" id="L1491">					collBean.setIwDirPlyPwt(0.0);</span>
				}
<span class="nc bnc" id="L1493" title="All 2 branches missed.">				if (ReportUtility.isVS) {</span>
<span class="nc" id="L1494">					collBean.setVsSale(0.0);</span>
<span class="nc" id="L1495">					collBean.setVsPwt(0.0);</span>
<span class="nc" id="L1496">					collBean.setVsCancel(0.0);</span>
<span class="nc" id="L1497">					collBean.setVsDirPlyPwt(0.0);</span>
				}
<span class="nc" id="L1499">				agtMap.put(rsRetOrg.getString(&quot;organization_id&quot;), collBean);</span>
			}
<span class="nc" id="L1501">			agtOrgQry = agtOrgQry.replace(&quot;name,&quot;, &quot;&quot;);</span>
<span class="nc bnc" id="L1502" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>

				// Game Master Query
<span class="nc" id="L1505">				String gameQry = ReportUtility.getDrawGameMapQuery(startDate);</span>
<span class="nc" id="L1506">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1507">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L1508">				CallableStatement cstmt = null;</span>
<span class="nc bnc" id="L1509" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1510">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1511">					cstmt = con.prepareCall(&quot;{call drawCollectionRetailerWisePerGame(?,?,?,?)}&quot;);</span>
<span class="nc" id="L1512">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L1513">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L1514">					cstmt.setInt(3, gameNo);</span>
<span class="nc" id="L1515">					cstmt.setInt(4, agtOrgId);</span>
<span class="nc" id="L1516">					rs = cstmt.executeQuery();</span>
<span class="nc" id="L1517">					String retOrgId = null;</span>
<span class="nc bnc" id="L1518" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1519">						retOrgId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L1520">						double sale = agtMap.get(retOrgId).getDrawSale()</span>
								+ rs.getDouble(&quot;sale&quot;);
<span class="nc" id="L1522">						agtMap.get(retOrgId).setDrawSale(sale);</span>
<span class="nc" id="L1523">						agtMap.get(retOrgId).setDrawCancel(</span>
								agtMap.get(retOrgId).getDrawCancel()
										+ rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L1526">						agtMap.get(retOrgId).setDrawPwt(</span>
								agtMap.get(retOrgId).getDrawPwt()
										+ rs.getDouble(&quot;pwt&quot;));
<span class="nc" id="L1529">					}</span>
<span class="nc" id="L1530">				}</span>
<span class="nc" id="L1531">				DBConnect.closePstmt(gamePstmt);</span>
<span class="nc" id="L1532">				DBConnect.closeCstmt(cstmt);</span>
			}
<span class="nc bnc" id="L1534" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
				// Game Master Query
<span class="nc" id="L1536">				String gameQry = ReportUtility</span>
						.getScratchGameMapQuery(startDate);
<span class="nc" id="L1538">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1539">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L1540">				CallableStatement cstmt = null;</span>
<span class="nc bnc" id="L1541" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1542">					int gameNo = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1543">					cstmt = con.prepareCall(&quot;{call scratchCollectionRetailerWisePerGame(?,?,?,?)}&quot;);</span>
<span class="nc" id="L1544">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L1545">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L1546">					cstmt.setInt(3, gameNo);</span>
<span class="nc" id="L1547">					cstmt.setInt(4, agtOrgId);</span>
<span class="nc" id="L1548">					rs = cstmt.executeQuery();</span>
<span class="nc" id="L1549">					String retOrgId = null;</span>
<span class="nc bnc" id="L1550" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1551">						retOrgId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L1552">						double sale = agtMap.get(retOrgId).getScratchSale()</span>
								+ (rs.getDouble(&quot;sale&quot;) - rs
										.getDouble(&quot;cancel&quot;));
<span class="nc" id="L1555">						agtMap.get(retOrgId).setScratchSale(sale);</span>
<span class="nc" id="L1556">						agtMap.get(retOrgId).setScratchPwt(</span>
								agtMap.get(retOrgId).getScratchPwt()
										+ rs.getDouble(&quot;pwt&quot;));
<span class="nc" id="L1559">					}</span>
<span class="nc" id="L1560">				}</span>
<span class="nc" id="L1561">				DBConnect.closePstmt(gamePstmt);</span>
<span class="nc" id="L1562">				DBConnect.closeCstmt(cstmt);</span>
			}
<span class="nc bnc" id="L1564" title="All 2 branches missed.">			if (ReportUtility.isCS) {</span>
				// Category Master Query
<span class="nc" id="L1566">				String catQry = &quot;select category_id from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L1567">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L1568">				rsGame = prodPstmt.executeQuery();</span>
<span class="nc" id="L1569">				CallableStatement cstmt = null;</span>
<span class="nc bnc" id="L1570" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1571">					int catId = rsGame.getInt(&quot;category_id&quot;);</span>
<span class="nc" id="L1572">					cstmt = con.prepareCall(&quot;{call csCollectionRetailerWisePerCategory(?,?,?,?)}&quot;);</span>
<span class="nc" id="L1573">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L1574">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L1575">					cstmt.setInt(3, catId);</span>
<span class="nc" id="L1576">					cstmt.setInt(4, agtOrgId);</span>
<span class="nc" id="L1577">					rs = cstmt.executeQuery();</span>
<span class="nc" id="L1578">					String retOrgId = null;</span>
<span class="nc bnc" id="L1579" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1580">						retOrgId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L1581">						agtMap.get(retOrgId).setCSSale(</span>
								agtMap.get(retOrgId).getCSSale()
										+ rs.getDouble(&quot;sale&quot;));
<span class="nc" id="L1584">						agtMap.get(retOrgId).setCSCancel(</span>
								agtMap.get(retOrgId).getCSCancel()
										+ rs.getDouble(&quot;cancel&quot;));
					}
<span class="nc" id="L1588">				}</span>
<span class="nc" id="L1589">				DBConnect.closePstmt(prodPstmt);</span>
<span class="nc" id="L1590">				DBConnect.closeCstmt(cstmt);</span>
			}
<span class="nc bnc" id="L1592" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>

<span class="nc" id="L1594">				OlaOrgReportRequestBean requestBean = new OlaOrgReportRequestBean();</span>
<span class="nc" id="L1595">				requestBean.setFromDate(startDate.toString());</span>
<span class="nc" id="L1596">				requestBean.setToDate(endDate.toString());</span>
<span class="nc" id="L1597">				requestBean.setOrgId(agtOrgId);</span>
<span class="nc" id="L1598">				Map&lt;Integer, OlaOrgReportResponseBean&gt; olaResponseBeanMap = OlaRetailerReportControllerImpl</span>
						.fetchDepositWithdrawlMultipleRetailer(requestBean, con);
<span class="nc bnc" id="L1600" title="All 2 branches missed.">				for (Map.Entry&lt;Integer, OlaOrgReportResponseBean&gt; entry : olaResponseBeanMap</span>
						.entrySet()) {
<span class="nc" id="L1602">					String orgId = String.valueOf(entry.getKey());</span>
<span class="nc" id="L1603">					OlaOrgReportResponseBean olaResponseBean = entry.getValue();</span>
<span class="nc bnc" id="L1604" title="All 2 branches missed.">					if (agtMap.containsKey(orgId)) {</span>
<span class="nc" id="L1605">						agtMap.get(orgId).setOlaWithdrawalAmt(</span>
								olaResponseBean.getNetWithdrawalAmt());
<span class="nc" id="L1607">						agtMap.get(orgId).setOlaDepositAmt(</span>
								olaResponseBean.getNetDepositAmt());
<span class="nc" id="L1609">						agtMap.get(orgId).setOlaNetGaming(0.0);</span>
					}
<span class="nc" id="L1611">				}</span>

			}

<span class="nc bnc" id="L1615" title="All 2 branches missed.">			if (ReportUtility.isSLE) {</span>

<span class="nc" id="L1617">				SLEOrgReportRequestBean requestBean = new SLEOrgReportRequestBean();</span>
<span class="nc" id="L1618">				requestBean.setFromDate(startDate);</span>
<span class="nc" id="L1619">				requestBean.setToDate(endDate);</span>
<span class="nc" id="L1620">				requestBean.setOrgId(agtOrgId);</span>
<span class="nc" id="L1621">				Map&lt;Integer, SLEOrgReportResponseBean&gt; sleResponseBeanMap = SLERetailerReportsControllerImpl</span>
						.fetchSaleCancelPwtMultipleRetailer(requestBean, con);
<span class="nc bnc" id="L1623" title="All 2 branches missed.">				for (Map.Entry&lt;Integer, SLEOrgReportResponseBean&gt; entry : sleResponseBeanMap</span>
						.entrySet()) {
<span class="nc" id="L1625">					String orgId = String.valueOf(entry.getKey());</span>
<span class="nc" id="L1626">					SLEOrgReportResponseBean sleResponseBean = entry.getValue();</span>
<span class="nc bnc" id="L1627" title="All 2 branches missed.">					if (agtMap.containsKey(orgId)) {</span>
<span class="nc" id="L1628">						agtMap.get(orgId).setSleSale(</span>
								sleResponseBean.getSaleAmt());
<span class="nc" id="L1630">						agtMap.get(orgId).setSleCancel(</span>
								sleResponseBean.getCancelAmt());
<span class="nc" id="L1632">						agtMap.get(orgId)</span>
								.setSlePwt(sleResponseBean.getPwtAmt());
					}
<span class="nc" id="L1635">				}</span>

			}
<span class="nc bnc" id="L1638" title="All 2 branches missed.">			if (ReportUtility.isIW) {</span>

<span class="nc" id="L1640">				IWOrgReportRequestBean requestBean = new IWOrgReportRequestBean();</span>
<span class="nc" id="L1641">				requestBean.setFromDate(startDate);</span>
<span class="nc" id="L1642">				requestBean.setToDate(endDate);</span>
<span class="nc" id="L1643">				requestBean.setOrgId(agtOrgId);</span>
<span class="nc" id="L1644">				Map&lt;Integer, IWOrgReportResponseBean&gt; iwResponseBeanMap = IWRetailerReportsControllerImpl</span>
						.fetchSaleCancelPwtMultipleRetailer(requestBean, con);
<span class="nc bnc" id="L1646" title="All 2 branches missed.">				for (Map.Entry&lt;Integer, IWOrgReportResponseBean&gt; entry : iwResponseBeanMap</span>
						.entrySet()) {
<span class="nc" id="L1648">					String orgId = String.valueOf(entry.getKey());</span>
<span class="nc" id="L1649">					IWOrgReportResponseBean iwResponseBean = entry.getValue();</span>
<span class="nc bnc" id="L1650" title="All 2 branches missed.">					if (agtMap.containsKey(orgId)) {</span>
<span class="nc" id="L1651">						agtMap.get(orgId).setIwSale(</span>
								iwResponseBean.getSaleAmt());
<span class="nc" id="L1653">						agtMap.get(orgId).setIwCancel(	</span>
								iwResponseBean.getCancelAmt());
<span class="nc" id="L1655">						agtMap.get(orgId)</span>
								.setIwPwt(iwResponseBean.getPwtAmt());
					}
<span class="nc" id="L1658">				}</span>
			}
			
<span class="nc bnc" id="L1661" title="All 2 branches missed.">			if (ReportUtility.isVS) {</span>
<span class="nc" id="L1662">				VSOrgReportRequestBean requestBean = new VSOrgReportRequestBean();</span>
<span class="nc" id="L1663">				requestBean.setFromDate(startDate);</span>
<span class="nc" id="L1664">				requestBean.setToDate(endDate);</span>
<span class="nc" id="L1665">				requestBean.setOrgId(agtOrgId);</span>
<span class="nc" id="L1666">				Map&lt;Integer, VSOrgReportResponseBean&gt; vsResponseBeanMap = VSRetailerReportsControllerImpl</span>
						.fetchSaleCancelPwtMultipleRetailer(requestBean, con);
<span class="nc bnc" id="L1668" title="All 2 branches missed.">				for (Map.Entry&lt;Integer, VSOrgReportResponseBean&gt; entry : vsResponseBeanMap.entrySet()) {</span>
<span class="nc" id="L1669">					String orgId = String.valueOf(entry.getKey());</span>
<span class="nc" id="L1670">					VSOrgReportResponseBean vsResponseBean = entry.getValue();</span>
<span class="nc bnc" id="L1671" title="All 2 branches missed.">					if (agtMap.containsKey(orgId)) {</span>
<span class="nc" id="L1672">						agtMap.get(orgId).setVsSale(vsResponseBean.getSaleAmt());</span>
<span class="nc" id="L1673">						agtMap.get(orgId).setVsCancel(vsResponseBean.getCancelAmt());</span>
<span class="nc" id="L1674">						agtMap.get(orgId).setVsPwt(vsResponseBean.getPwtAmt());</span>
					}
<span class="nc" id="L1676">				}</span>
			}
<span class="nc" id="L1678">		} catch (Exception e) {</span>
<span class="nc" id="L1679">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1681">			DBConnect.closePstmt(pstmt);</span>
<span class="nc" id="L1682">		}</span>

<span class="nc" id="L1684">		return agtMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionRetailerWiseExpand(
			Timestamp startDate, Timestamp endDate, Connection con, int agtOrgId) {
<span class="nc" id="L1689">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1690">		ResultSet rsGame = null;</span>
<span class="nc" id="L1691">		ResultSet rs = null;</span>
<span class="nc" id="L1692">		ResultSet rsRetOrg = null;</span>
<span class="nc" id="L1693">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; serGameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;();</span>
<span class="nc" id="L1694">		Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt; gameAgtMap = null;</span>
<span class="nc bnc" id="L1695" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L1696">			return serGameAgtMap;</span>
		}
		try {

			// Get All Agent
<span class="nc" id="L1701">			String orgCodeQry = &quot; name orgCode &quot;;</span>

<span class="nc bnc" id="L1703" title="All 2 branches missed.">			if ((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;CODE&quot;)) {</span>
<span class="nc" id="L1704">				orgCodeQry = &quot;org_code orgCode &quot;;</span>

<span class="nc bnc" id="L1706" title="All 2 branches missed.">			} else if ((LMSFilterDispatcher.orgFieldType)</span>
					.equalsIgnoreCase(&quot;CODE_NAME&quot;)) {
<span class="nc" id="L1708">				orgCodeQry = &quot; concat(org_code,'_',name)  orgCode  &quot;;</span>

<span class="nc bnc" id="L1710" title="All 2 branches missed.">			} else if ((LMSFilterDispatcher.orgFieldType)</span>
					.equalsIgnoreCase(&quot;NAME_CODE&quot;)) {
<span class="nc" id="L1712">				orgCodeQry = &quot; concat(name,'_',org_code)  orgCode &quot;;</span>

			}

<span class="nc" id="L1716">			String agtOrgQry = &quot;select &quot;</span>
					+ orgCodeQry
					+ &quot;,organization_id from st_lms_organization_master where parent_id=&quot;
					+ agtOrgId + &quot; order by &quot;
					+ QueryManager.getAppendOrgOrder();
<span class="nc" id="L1721">			pstmt = con.prepareStatement(agtOrgQry);</span>
<span class="nc" id="L1722">			rsRetOrg = pstmt.executeQuery();</span>

<span class="nc bnc" id="L1724" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L1725">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
				// Game Master Query
<span class="nc" id="L1727">				String gameQry = ReportUtility.getDrawGameMapQuery(startDate);</span>
<span class="nc" id="L1728">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1729">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L1730">				CallableStatement cstmt = null;</span>
<span class="nc bnc" id="L1731" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1732">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1733">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1734">					gameMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L1735">					cstmt = con.prepareCall(&quot;{call drawCollectionRetailerWisePerGame(?,?,?,?)}&quot;);</span>
<span class="nc" id="L1736">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L1737">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L1738">					cstmt.setInt(3, gameId);</span>
<span class="nc" id="L1739">					cstmt.setInt(4, agtOrgId);</span>
<span class="nc" id="L1740">					rs = cstmt.executeQuery();</span>
<span class="nc bnc" id="L1741" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1742">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L1743">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L1744">						gameMap.get(agtId)</span>
								.setDrawCancel(rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L1746">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>

<span class="nc" id="L1748">					}</span>
<span class="nc" id="L1749">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L1750">				}</span>
<span class="nc" id="L1751">				DBConnect.closePstmt(gamePstmt);</span>
<span class="nc" id="L1752">				DBConnect.closeCstmt(cstmt);</span>

<span class="nc" id="L1754">				serGameAgtMap.put(&quot;DG&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L1756" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
<span class="nc" id="L1757">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
				// Game Master Query
<span class="nc" id="L1759">				String gameQry = ReportUtility</span>
						.getScratchGameMapQuery(startDate);
<span class="nc" id="L1761">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1762">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L1763">				CallableStatement cstmt = null;</span>
<span class="nc bnc" id="L1764" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1765">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1766">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1767">					gameMap.putAll(getAgentMap(rsRetOrg));</span>

<span class="nc" id="L1769">					cstmt = con.prepareCall(&quot;{call scratchCollectionRetailerWisePerGame(?,?,?,?)}&quot;);</span>
<span class="nc" id="L1770">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L1771">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L1772">					cstmt.setInt(3, gameId);</span>
<span class="nc" id="L1773">					cstmt.setInt(4, agtOrgId);</span>
<span class="nc" id="L1774">					rs = cstmt.executeQuery();</span>
<span class="nc bnc" id="L1775" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1776">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L1777">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L1778">						gameMap.get(agtId)</span>
								.setDrawCancel(rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L1780">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>

<span class="nc" id="L1782">					}</span>
<span class="nc" id="L1783">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L1784">				}</span>
<span class="nc" id="L1785">				DBConnect.closePstmt(gamePstmt);</span>
<span class="nc" id="L1786">				DBConnect.closeCstmt(cstmt);</span>

<span class="nc" id="L1788">				serGameAgtMap.put(&quot;SE&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L1790" title="All 2 branches missed.">			if (ReportUtility.isCS) {</span>

<span class="nc" id="L1792">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
				// Category Master Query
<span class="nc" id="L1794">				String catQry = &quot;select category_id,category_code from st_cs_product_category_master WHERE status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L1795">				PreparedStatement prodPstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L1796">				rsGame = prodPstmt.executeQuery();</span>
<span class="nc" id="L1797">				CallableStatement cstmt = null;</span>
<span class="nc bnc" id="L1798" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1799">					int catId = rsGame.getInt(&quot;category_id&quot;);</span>
<span class="nc" id="L1800">					Map&lt;String, CompleteCollectionBean&gt; prodMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1801">					prodMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L1802">					cstmt = con.prepareCall(&quot;{call csCollectionRetailerWisePerCategory(?,?,?,?)}&quot;);</span>
<span class="nc" id="L1803">					cstmt.setTimestamp(1, startDate);</span>
<span class="nc" id="L1804">					cstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L1805">					cstmt.setInt(3, catId);</span>
<span class="nc" id="L1806">					cstmt.setInt(4, agtOrgId);</span>
<span class="nc" id="L1807">					rs = cstmt.executeQuery();</span>
<span class="nc bnc" id="L1808" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1809">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L1810">						prodMap.get(agtId).setCSSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L1811">						prodMap.get(agtId).setCSCancel(rs.getDouble(&quot;cancel&quot;));</span>
<span class="nc" id="L1812">					}</span>
<span class="nc" id="L1813">					gameAgtMap.put(rsGame.getString(&quot;category_code&quot;), prodMap);</span>
<span class="nc" id="L1814">				}</span>
<span class="nc" id="L1815">				DBConnect.closePstmt(prodPstmt);</span>
<span class="nc" id="L1816">				DBConnect.closeCstmt(cstmt);</span>

<span class="nc" id="L1818">				serGameAgtMap.put(&quot;CS&quot;, gameAgtMap);</span>

			}

<span class="nc bnc" id="L1822" title="All 2 branches missed.">			if (ReportUtility.isSLE) {</span>
<span class="nc" id="L1823">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
				// Game Master Query
<span class="nc" id="L1825">				String gameQry = ReportUtility.getSLEGameMapQuery(startDate);</span>
<span class="nc" id="L1826">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1827">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L1828" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1829">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1830">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1831">					gameMap.putAll(getAgentMap(rsRetOrg));</span>

<span class="nc" id="L1833">					SLEOrgReportRequestBean requestBean = new SLEOrgReportRequestBean();</span>
<span class="nc" id="L1834">					requestBean.setFromDate(startDate);</span>
<span class="nc" id="L1835">					requestBean.setToDate(endDate);</span>
<span class="nc" id="L1836">					requestBean.setOrgId(agtOrgId);</span>
<span class="nc" id="L1837">					requestBean.setGameId(gameId);</span>
<span class="nc" id="L1838">					Map&lt;Integer, SLEOrgReportResponseBean&gt; respMap = SLERetailerReportsControllerImpl</span>
							.fetchSaleCancelPwtMultipleRetailerGameWise(
									requestBean, con);
<span class="nc bnc" id="L1841" title="All 2 branches missed.">					for (Map.Entry&lt;Integer, SLEOrgReportResponseBean&gt; entry : respMap</span>
							.entrySet()) {
<span class="nc" id="L1843">						String agtId = String.valueOf(entry.getKey());</span>
<span class="nc" id="L1844">						SLEOrgReportResponseBean bean = entry.getValue();</span>
<span class="nc" id="L1845">						gameMap.get(agtId).setSleSale(bean.getSaleAmt());</span>
<span class="nc" id="L1846">						gameMap.get(agtId).setSleCancel(bean.getCancelAmt());</span>
<span class="nc" id="L1847">						gameMap.get(agtId).setSlePwt(bean.getPwtAmt());</span>
<span class="nc" id="L1848">					}</span>
<span class="nc" id="L1849">					gameAgtMap.put(rsGame.getString(&quot;game_disp_name&quot;), gameMap);</span>
<span class="nc" id="L1850">				}</span>
<span class="nc" id="L1851">				serGameAgtMap.put(&quot;SLE&quot;, gameAgtMap);</span>
			}
			
<span class="nc bnc" id="L1854" title="All 2 branches missed.">			if (ReportUtility.isIW) {</span>
<span class="nc" id="L1855">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
				// Game Master Query
<span class="nc" id="L1857">				String gameQry = ReportUtility.getIWGameMapQuery(startDate);</span>
<span class="nc" id="L1858">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1859">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L1860" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1861">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1862">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1863">					gameMap.putAll(getAgentMap(rsRetOrg));</span>

<span class="nc" id="L1865">					IWOrgReportRequestBean requestBean = new IWOrgReportRequestBean();</span>
<span class="nc" id="L1866">					requestBean.setFromDate(startDate);</span>
<span class="nc" id="L1867">					requestBean.setToDate(endDate);</span>
<span class="nc" id="L1868">					requestBean.setOrgId(agtOrgId);</span>
<span class="nc" id="L1869">					requestBean.setGameId(gameId);</span>
<span class="nc" id="L1870">					Map&lt;Integer, IWOrgReportResponseBean&gt; respMap = IWRetailerReportsControllerImpl.fetchSaleCancelPwtMultipleRetailerGameWise(requestBean, con);</span>
<span class="nc bnc" id="L1871" title="All 2 branches missed.">					for (Map.Entry&lt;Integer, IWOrgReportResponseBean&gt; entry : respMap.entrySet()) {</span>
<span class="nc" id="L1872">						String agtId = String.valueOf(entry.getKey());</span>
<span class="nc" id="L1873">						IWOrgReportResponseBean bean = entry.getValue();</span>
<span class="nc" id="L1874">						gameMap.get(agtId).setIwSale(bean.getSaleAmt());</span>
<span class="nc" id="L1875">						gameMap.get(agtId).setIwCancel(bean.getCancelAmt());</span>
<span class="nc" id="L1876">						gameMap.get(agtId).setIwPwt(bean.getPwtAmt());</span>
<span class="nc" id="L1877">					}</span>
<span class="nc" id="L1878">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L1879">				}</span>
<span class="nc" id="L1880">				serGameAgtMap.put(&quot;IW&quot;, gameAgtMap);</span>
			}

<span class="nc bnc" id="L1883" title="All 2 branches missed.">			if (ReportUtility.isVS) {</span>
<span class="nc" id="L1884">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
				// Game Master Query
<span class="nc" id="L1886">				String gameQry = ReportUtility.getVSGameMapQuery(startDate);</span>
<span class="nc" id="L1887">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1888">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L1889" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1890">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1891">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1892">					gameMap.putAll(getAgentMap(rsRetOrg));</span>

<span class="nc" id="L1894">					VSOrgReportRequestBean requestBean = new VSOrgReportRequestBean();</span>
<span class="nc" id="L1895">					requestBean.setFromDate(startDate);</span>
<span class="nc" id="L1896">					requestBean.setToDate(endDate);</span>
<span class="nc" id="L1897">					requestBean.setOrgId(agtOrgId);</span>
<span class="nc" id="L1898">					requestBean.setGameId(gameId);</span>
<span class="nc" id="L1899">					Map&lt;Integer, VSOrgReportResponseBean&gt; respMap = VSRetailerReportsControllerImpl.fetchSaleCancelPwtMultipleRetailerGameWise(requestBean, con);</span>
<span class="nc bnc" id="L1900" title="All 2 branches missed.">					for (Map.Entry&lt;Integer, VSOrgReportResponseBean&gt; entry : respMap.entrySet()) {</span>
<span class="nc" id="L1901">						String agtId = String.valueOf(entry.getKey());</span>
<span class="nc" id="L1902">						VSOrgReportResponseBean bean = entry.getValue();</span>
<span class="nc" id="L1903">						gameMap.get(agtId).setVsSale(bean.getSaleAmt());</span>
<span class="nc" id="L1904">						gameMap.get(agtId).setVsCancel(bean.getCancelAmt());</span>
<span class="nc" id="L1905">						gameMap.get(agtId).setVsPwt(bean.getPwtAmt());</span>
<span class="nc" id="L1906">					}</span>
<span class="nc" id="L1907">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L1908">				}</span>
<span class="nc" id="L1909">				serGameAgtMap.put(&quot;VS&quot;, gameAgtMap);</span>
			}

<span class="nc" id="L1912">			logger.debug(serGameAgtMap);</span>
<span class="nc" id="L1913">		} catch (Exception e) {</span>
<span class="nc" id="L1914">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1916">			DBConnect.closePstmt(pstmt);</span>
<span class="nc" id="L1917">		}</span>

<span class="nc" id="L1919">		return serGameAgtMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; collectionRetailerWiseExpandMrpWise(
			Timestamp startDate, Timestamp endDate, Connection con, int agtOrgId) {
<span class="nc" id="L1924">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1925">		ResultSet rsGame = null;</span>
<span class="nc" id="L1926">		ResultSet rs = null;</span>
<span class="nc" id="L1927">		ResultSet rsRetOrg = null;</span>
<span class="nc" id="L1928">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; serGameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;();</span>
<span class="nc" id="L1929">		Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt; gameAgtMap = null;</span>
		// for Draw Game
<span class="nc" id="L1931">		String saleTranDG = null;</span>
<span class="nc" id="L1932">		String cancelTranDG = null;</span>
<span class="nc" id="L1933">		String pwtTranDG = null;</span>
<span class="nc" id="L1934">		StringBuilder drawQry = null;</span>
		// for scratch game
<span class="nc" id="L1936">		StringBuilder scratchQry = null;</span>
<span class="nc bnc" id="L1937" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L1938">			return serGameAgtMap;</span>
		}
		try {

			// Get All Agent
<span class="nc" id="L1943">			String agtOrgQry = &quot;select name,organization_id from st_lms_organization_master where parent_id=&quot;</span>
					+ agtOrgId + &quot; order by name&quot;;
<span class="nc" id="L1945">			pstmt = con.prepareStatement(agtOrgQry);</span>
<span class="nc" id="L1946">			rsRetOrg = pstmt.executeQuery();</span>

<span class="nc bnc" id="L1948" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L1949">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L1950">				drawQry = new StringBuilder(</span>
						&quot;select agtTlb.organization_id,ifnull(sale,0.0) sale,ifnull(cancel,0.0) cancel,ifnull(pwt,0.0)  pwt from (select sale.organization_id,sale,cancel,pwt from &quot;);
<span class="nc" id="L1952">				saleTranDG = &quot;(select bb.organization_id,sum(sale) as sale from (select drs.retailer_org_id,sum(mrp_amt) as sale from st_dg_ret_sale_? drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_SALE','DG_SALE_OFFLINE') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;)bb on retailer_org_id=organization_id group by organization_id) sale,&quot;;
<span class="nc" id="L1959">				cancelTranDG = &quot;(select bb.organization_id,sum(cancel) as cancel from (select drs.retailer_org_id,sum(mrp_amt) as cancel from st_dg_ret_sale_refund_? drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on retailer_org_id=organization_id group by organization_id) cancel,&quot;;
<span class="nc" id="L1966">				pwtTranDG = &quot;(select bb.organization_id,sum(pwt) as pwt from (select drs.retailer_org_id,sum(pwt_amt) as pwt from st_dg_ret_pwt_? drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on retailer_org_id=organization_id group by organization_id) pwt &quot;;
<span class="nc" id="L1973">				drawQry.append(saleTranDG);</span>
<span class="nc" id="L1974">				drawQry.append(cancelTranDG);</span>
<span class="nc" id="L1975">				drawQry.append(pwtTranDG);</span>
<span class="nc" id="L1976">				drawQry</span>
						.append(&quot; where sale.organization_id=cancel.organization_id and sale.organization_id=pwt.organization_id and cancel.organization_id=pwt.organization_id) gameTlb right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
								+ agtOrgId
								+ &quot;) agtTlb on gameTlb.organization_id=agtTlb.organization_id&quot;);
<span class="nc" id="L1980">				System.out.println(&quot;For Expand draw game Qry:: &quot; + drawQry);</span>

				// Game Master Query
<span class="nc" id="L1983">				String gameQry = ReportUtility.getDrawGameMapQuery(startDate);</span>
<span class="nc" id="L1984">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1985">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L1986" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1987">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1988">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L1989">					gameMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L1990">					pstmt = con.prepareStatement(drawQry.toString());</span>
<span class="nc" id="L1991">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L1992">					pstmt.setInt(2, gameId);</span>
<span class="nc" id="L1993">					pstmt.setInt(3, gameId);</span>
<span class="nc" id="L1994">					System.out.println(&quot;-------Indivisual Game Qry-------\n&quot;</span>
							+ pstmt);
<span class="nc" id="L1996">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1997" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1998">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L1999">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L2000">						gameMap.get(agtId)</span>
								.setDrawCancel(rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L2002">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>

<span class="nc" id="L2004">					}</span>
<span class="nc" id="L2005">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L2006">				}</span>
<span class="nc" id="L2007">				DBConnect.closePstmt(gamePstmt);</span>

<span class="nc" id="L2009">				serGameAgtMap.put(&quot;DG&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L2011" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
<span class="nc" id="L2012">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L2013">				scratchQry = new StringBuilder(</span>
						&quot;select agtTlb.organization_id,ifnull(sale,0.0) sale,ifnull(pwt,0.0) pwt from (select sale.organization_id,sale,pwt from&quot;);
<span class="nc" id="L2015">				saleTranDG = &quot;(select bb.organization_id,sum(sale) as sale from (select current_owner_id,sum(sale) sale from (select gmti.game_id,gmti.current_owner_id, (gmti.sold_tickets*ticket_price) sale from st_se_game_ticket_inv_history gmti ,st_se_game_master gm where gmti.current_owner='RETAILER'and gmti.date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and gmti.date&lt;='&quot;
						+ endDate
						+ &quot;' and gmti.game_id=gm.game_id and gm.game_id=?) aa group by current_owner_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on current_owner_id=organization_id group by organization_id) sale, &quot;;
<span class="nc" id="L2022">				pwtTranDG = &quot;(select bb.organization_id,sum(pwt) as pwt from (select retailer_org_id,sum(pwt_amt) pwt from st_se_retailer_pwt where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and transaction_type='PWT') and game_id=? group by retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on retailer_org_id=organization_id group by organization_id) pwt &quot;;
<span class="nc" id="L2029">				scratchQry.append(saleTranDG);</span>
<span class="nc" id="L2030">				scratchQry.append(pwtTranDG);</span>
<span class="nc" id="L2031">				scratchQry</span>
						.append(&quot; where sale.organization_id=pwt.organization_id) gameTlb right outer join (select organization_id from st_lms_organization_master where parent_id=4) agtTlb on gameTlb.organization_id=agtTlb.organization_id&quot;);
<span class="nc" id="L2033">				System.out.println(&quot;For Expand scratch game Qry:: &quot;</span>
						+ scratchQry);

				// Game Master Query
<span class="nc" id="L2037">				String gameQry = &quot;select game_id,game_name from st_se_game_master&quot;;</span>
<span class="nc" id="L2038">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L2039">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L2040" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L2041">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L2042">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L2043">					gameMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L2044">					pstmt = con.prepareStatement(scratchQry.toString());</span>
<span class="nc" id="L2045">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L2046">					pstmt.setInt(2, gameId);</span>
<span class="nc" id="L2047">					System.out.println(&quot;-------Indivisual Game Qry-------\n&quot;</span>
							+ pstmt);
<span class="nc" id="L2049">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2050" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L2051">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L2052">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L2053">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>
<span class="nc" id="L2054">					}</span>

<span class="nc" id="L2056">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L2057">				}</span>
<span class="nc" id="L2058">				DBConnect.closePstmt(gamePstmt);</span>

<span class="nc" id="L2060">				serGameAgtMap.put(&quot;SE&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L2062" title="All 2 branches missed.">			if (ReportUtility.isIW) {</span>
<span class="nc" id="L2063">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L2064">				drawQry = new StringBuilder(&quot;select agtTlb.organization_id,ifnull(sale,0.0) sale,ifnull(cancel,0.0) cancel,ifnull(pwt,0.0)  pwt from (select sale.organization_id,sale,cancel,pwt from &quot;);</span>
<span class="nc" id="L2065">				saleTranDG = &quot;(select bb.organization_id,sum(sale) as sale from (select drs.retailer_org_id,sum(mrp_amt) as sale from st_iw_ret_sale drs where drs.game_id = ? and drs.is_cancel != 'Y' and transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('IW_SALE') and transaction_date&gt;='&quot; + startDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot; + agtOrgId + &quot;)bb on retailer_org_id=organization_id group by organization_id) sale,&quot;;</span>
<span class="nc" id="L2066">				cancelTranDG = &quot;(select bb.organization_id,sum(cancel) as cancel from (select drs.retailer_org_id,sum(mrp_amt) as cancel from st_iw_ret_sale_refund drs where drs.game_id = ? and transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('IW_REFUND_CANCEL','IW_REFUND_FAILED') and transaction_date&gt;='&quot; + startDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot; + agtOrgId + &quot;) bb on retailer_org_id=organization_id group by organization_id) cancel,&quot;;</span>
<span class="nc" id="L2067">				pwtTranDG = &quot;(select bb.organization_id,sum(pwt) as pwt from (select drs.retailer_org_id,sum(pwt_amt) as pwt from st_dg_ret_pwt drs where drs.game_id = ? and transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and transaction_date&gt;='&quot; + startDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot; + agtOrgId + &quot;) bb on retailer_org_id=organization_id group by organization_id) pwt &quot;;</span>
<span class="nc" id="L2068">				drawQry.append(saleTranDG);</span>
<span class="nc" id="L2069">				drawQry.append(cancelTranDG);</span>
<span class="nc" id="L2070">				drawQry.append(pwtTranDG);</span>
<span class="nc" id="L2071">				drawQry.append(&quot; where sale.organization_id=cancel.organization_id and sale.organization_id=pwt.organization_id and cancel.organization_id=pwt.organization_id) gameTlb right outer join (select organization_id from st_lms_organization_master where parent_id=&quot; + agtOrgId + &quot;) agtTlb on gameTlb.organization_id=agtTlb.organization_id&quot;);</span>
<span class="nc" id="L2072">				System.out.println(&quot;For Expand draw game Qry:: &quot; + drawQry);</span>

				// Game Master Query
<span class="nc" id="L2075">				String gameQry = ReportUtility.getDrawGameMapQuery(startDate);</span>
<span class="nc" id="L2076">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L2077">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L2078" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L2079">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L2080">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L2081">					gameMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L2082">					pstmt = con.prepareStatement(drawQry.toString());</span>
<span class="nc" id="L2083">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L2084">					pstmt.setInt(2, gameId);</span>
<span class="nc" id="L2085">					pstmt.setInt(3, gameId);</span>
<span class="nc" id="L2086">					System.out.println(&quot;-------Indivisual Game Qry-------\n&quot; + pstmt);</span>
<span class="nc" id="L2087">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2088" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L2089">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L2090">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L2091">						gameMap.get(agtId).setDrawCancel(rs.getDouble(&quot;cancel&quot;));</span>
<span class="nc" id="L2092">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>
<span class="nc" id="L2093">					}</span>
<span class="nc" id="L2094">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L2095">				}</span>
<span class="nc" id="L2096">				DBConnect.closePstmt(gamePstmt);</span>

<span class="nc" id="L2098">				serGameAgtMap.put(&quot;IW&quot;, gameAgtMap);</span>
			}
<span class="nc bnc" id="L2100" title="All 2 branches missed.">			if (ReportUtility.isVS) {</span>
<span class="nc" id="L2101">				gameAgtMap = new LinkedHashMap&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;();</span>
<span class="nc" id="L2102">				drawQry = new StringBuilder(</span>
						&quot;select agtTlb.organization_id,ifnull(sale,0.0) sale,ifnull(cancel,0.0) cancel,ifnull(pwt,0.0)  pwt from (select sale.organization_id,sale,cancel,pwt from &quot;);
<span class="nc" id="L2104">				saleTranDG = &quot;(select bb.organization_id,sum(sale) as sale from (select drs.retailer_org_id,sum(mrp_amt) as sale from st_vs_ret_sale drs where drs.game_id = ? and drs.is_cancel != 'Y' and transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('VS_SALE') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;)bb on retailer_org_id=organization_id group by organization_id) sale,&quot;;
<span class="nc" id="L2111">				cancelTranDG = &quot;(select bb.organization_id,sum(cancel) as cancel from (select drs.retailer_org_id,sum(mrp_amt) as cancel from st_vs_ret_sale_refund drs where drs.game_id = ? and transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('VS_SALE_REFUND') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on retailer_org_id=organization_id group by organization_id) cancel,&quot;;
<span class="nc" id="L2118">				pwtTranDG = &quot;(select bb.organization_id,sum(pwt) as pwt from (select drs.retailer_org_id,sum(pwt_amt) as pwt from st_vs_ret_pwt drs where drs.game_id = ? and transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('VS_PWT_AUTO','VS_PWT_PLR','VS_PWT') and transaction_date&gt;='&quot;</span>
						+ startDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;') group by drs.retailer_org_id) aa right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ agtOrgId
						+ &quot;) bb on retailer_org_id=organization_id group by organization_id) pwt &quot;;
<span class="nc" id="L2125">				drawQry.append(saleTranDG);</span>
<span class="nc" id="L2126">				drawQry.append(cancelTranDG);</span>
<span class="nc" id="L2127">				drawQry.append(pwtTranDG);</span>
<span class="nc" id="L2128">				drawQry.append(&quot; where sale.organization_id=cancel.organization_id and sale.organization_id=pwt.organization_id and cancel.organization_id=pwt.organization_id) gameTlb right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;</span>
						+ agtOrgId
						+ &quot;) agtTlb on gameTlb.organization_id=agtTlb.organization_id&quot;);
<span class="nc" id="L2131">				System.out.println(&quot;For Expand draw game Qry:: &quot; + drawQry);</span>

				// Game Master Query
<span class="nc" id="L2134">				String gameQry = ReportUtility.getDrawGameMapQuery(startDate);</span>
<span class="nc" id="L2135">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L2136">				rsGame = gamePstmt.executeQuery();</span>
<span class="nc bnc" id="L2137" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L2138">					int gameId = rsGame.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L2139">					Map&lt;String, CompleteCollectionBean&gt; gameMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L2140">					gameMap.putAll(getAgentMap(rsRetOrg));</span>
<span class="nc" id="L2141">					pstmt = con.prepareStatement(drawQry.toString());</span>
<span class="nc" id="L2142">					pstmt.setInt(1, gameId);</span>
<span class="nc" id="L2143">					pstmt.setInt(2, gameId);</span>
<span class="nc" id="L2144">					pstmt.setInt(3, gameId);</span>
<span class="nc" id="L2145">					System.out.println(&quot;-------Indivisual Game Qry-------\n&quot;</span>
							+ pstmt);
<span class="nc" id="L2147">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2148" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L2149">						String agtId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L2150">						gameMap.get(agtId).setDrawSale(rs.getDouble(&quot;sale&quot;));</span>
<span class="nc" id="L2151">						gameMap.get(agtId)</span>
								.setDrawCancel(rs.getDouble(&quot;cancel&quot;));
<span class="nc" id="L2153">						gameMap.get(agtId).setDrawPwt(rs.getDouble(&quot;pwt&quot;));</span>
<span class="nc" id="L2154">					}</span>
<span class="nc" id="L2155">					gameAgtMap.put(rsGame.getString(&quot;game_name&quot;), gameMap);</span>
<span class="nc" id="L2156">				}</span>
<span class="nc" id="L2157">				DBConnect.closePstmt(gamePstmt);</span>

<span class="nc" id="L2159">				serGameAgtMap.put(&quot;VS&quot;, gameAgtMap);</span>
			}
<span class="nc" id="L2161">			System.out.println(serGameAgtMap);</span>
<span class="nc" id="L2162">		} catch (Exception e) {</span>
<span class="nc" id="L2163">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L2165">			DBConnect.closePstmt(pstmt);</span>
<span class="nc" id="L2166">		}</span>
<span class="nc" id="L2167">		return serGameAgtMap;</span>
	}

	private Map&lt;String, CompleteCollectionBean&gt; getAgentMap(ResultSet rsRetOrg)
			throws SQLException {
<span class="nc" id="L2172">		Map&lt;String, CompleteCollectionBean&gt; agtMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L2173">		CompleteCollectionBean collBean = null;</span>

<span class="nc bnc" id="L2175" title="All 2 branches missed.">		while (rsRetOrg.next()) {</span>
<span class="nc" id="L2176">			collBean = new CompleteCollectionBean();</span>
<span class="nc" id="L2177">			collBean.setOrgName(rsRetOrg.getString(&quot;orgCode&quot;));</span>
<span class="nc bnc" id="L2178" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L2179">				collBean.setDrawSale(0.0);</span>
<span class="nc" id="L2180">				collBean.setDrawPwt(0.0);</span>
<span class="nc" id="L2181">				collBean.setDrawCancel(0.0);</span>
			}
<span class="nc bnc" id="L2183" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
<span class="nc" id="L2184">				collBean.setScratchSale(0.0);</span>
<span class="nc" id="L2185">				collBean.setScratchPwt(0.0);</span>
			}
<span class="nc bnc" id="L2187" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>
<span class="nc" id="L2188">				collBean.setOlaDepositAmt(0.0);</span>
<span class="nc" id="L2189">				collBean.setOlaDepositCancelAmt(0.0);</span>
<span class="nc" id="L2190">				collBean.setOlaWithdrawalAmt(0.0);</span>
			}
<span class="nc" id="L2192">			agtMap.put(rsRetOrg.getString(&quot;organization_id&quot;), collBean);</span>
		}
<span class="nc" id="L2194">		rsRetOrg.beforeFirst();</span>
<span class="nc" id="L2195">		return agtMap;</span>
	}

	private Map&lt;String, CompleteCollectionBean&gt; getDayMap(Timestamp startDate,
			Timestamp endDate) throws SQLException {
<span class="nc" id="L2200">		Map&lt;String, CompleteCollectionBean&gt; dateMap = new LinkedHashMap&lt;String, CompleteCollectionBean&gt;();</span>
<span class="nc" id="L2201">		CompleteCollectionBean collBean = null;</span>
<span class="nc" id="L2202">		String date = null;</span>
		// Get All Day
<span class="nc" id="L2204">		Calendar startCal = Calendar.getInstance();</span>
<span class="nc" id="L2205">		startCal.setTime(startDate);</span>

<span class="nc" id="L2207">		Calendar endCal = Calendar.getInstance();</span>
<span class="nc" id="L2208">		endCal.setTime(endDate);</span>
<span class="nc bnc" id="L2209" title="All 2 branches missed.">		while (startCal.getTime().before(endCal.getTime())) {</span>
<span class="nc" id="L2210">			date = new java.sql.Date(startCal.getTimeInMillis()).toString();</span>
<span class="nc" id="L2211">			collBean = new CompleteCollectionBean();</span>
<span class="nc" id="L2212">			collBean.setOrgName(date);</span>
<span class="nc" id="L2213">			dateMap.put(date, collBean);</span>
<span class="nc" id="L2214">			startCal.setTimeInMillis(startCal.getTimeInMillis() + 24 * 60 * 60</span>
					* 1000);
<span class="nc bnc" id="L2216" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L2217">				collBean.setDrawSale(0.0);</span>
<span class="nc" id="L2218">				collBean.setDrawPwt(0.0);</span>
<span class="nc" id="L2219">				collBean.setDrawCancel(0.0);</span>
<span class="nc" id="L2220">				collBean.setDrawDirPlyPwt(0.0);</span>
			}
<span class="nc bnc" id="L2222" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
<span class="nc" id="L2223">				collBean.setScratchSale(0.0);</span>
<span class="nc" id="L2224">				collBean.setScratchPwt(0.0);</span>
<span class="nc" id="L2225">				collBean.setScratchDirPlyPwt(0.0);</span>
			}
		}
<span class="nc" id="L2228">		return dateMap;</span>
	}

	public Map&lt;Integer, String&gt; getOrgAddMap(String orgType, int parentId)
			throws LMSException {
<span class="nc" id="L2233">		Map&lt;Integer, String&gt; orgAddMap = new TreeMap&lt;Integer, String&gt;();</span>
<span class="nc" id="L2234">		Connection con = null;</span>
<span class="nc" id="L2235">		con = DBConnect.getConnection();</span>
<span class="nc" id="L2236">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L2237">		ResultSet rs = null;</span>
		try {
<span class="nc bnc" id="L2239" title="All 2 branches missed.">			if (orgType.equalsIgnoreCase(&quot;AGENT&quot;)) {</span>
<span class="nc" id="L2240">				pstmt = con</span>
						.prepareStatement(&quot;select addr_line1, addr_line2, city, organization_id from st_lms_organization_master where organization_type='AGENT'&quot;);

<span class="nc bnc" id="L2243" title="All 2 branches missed.">			} else if (orgType.equalsIgnoreCase(&quot;RETAILER&quot;)) {</span>
<span class="nc" id="L2244">				pstmt = con</span>
						.prepareStatement(&quot;select addr_line1, addr_line2, city, organization_id from st_lms_organization_master where organization_type='RETAILER' and parent_id = ?&quot;);
<span class="nc" id="L2246">				pstmt.setInt(1, parentId);</span>
			}
<span class="nc" id="L2248">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2249" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L2250">				orgAddMap.put(rs.getInt(&quot;organization_id&quot;), rs</span>
						.getString(&quot;addr_line1&quot;)
						+ &quot;,&quot;
						+ rs.getString(&quot;addr_line2&quot;)
						+ &quot;,&quot;
						+ rs.getString(&quot;city&quot;));
			}
<span class="nc" id="L2257">		} catch (SQLException e) {</span>
<span class="nc" id="L2258">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L2259">			e.printStackTrace();</span>
<span class="nc" id="L2260">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L2262">			DBConnect.closeCon(con);</span>
<span class="nc" id="L2263">			DBConnect.closePstmt(pstmt);</span>
<span class="nc" id="L2264">		}</span>
<span class="nc" id="L2265">		return orgAddMap;</span>
	}

	public Map&lt;String, Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;&gt; transactionReportForAgent(
			Timestamp startDate, Timestamp endDate, String reportType,
			int agtOrgId) {

<span class="nc" id="L2272">		Connection con = null;</span>
<span class="nc" id="L2273">		Map&lt;String, Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;&gt; resultMap = new HashMap&lt;String, Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt;&gt;();</span>
<span class="nc" id="L2274">		Map&lt;String, Map&lt;String, Map&lt;String, CompleteCollectionBean&gt;&gt;&gt; agtMap = null;</span>

		try {
<span class="nc" id="L2277">			con = DBConnect.getConnection();</span>

<span class="nc bnc" id="L2279" title="All 2 branches missed.">			if (&quot;Retailer Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L2280">				agtMap = collectionRetailerWiseExpand(startDate, endDate, con,</span>
						agtOrgId);
<span class="nc" id="L2282">				resultMap.put(&quot;NetAmt&quot;, agtMap);</span>
<span class="nc" id="L2283">				agtMap = collectionRetailerWiseExpandMrpWise(startDate,</span>
						endDate, con, agtOrgId);
<span class="nc" id="L2285">				resultMap.put(&quot;MrpAmt&quot;, agtMap);</span>
			}
<span class="nc" id="L2287">		} catch (Exception e) {</span>
<span class="nc" id="L2288">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L2290">			DBConnect.closeCon(con);</span>
<span class="nc" id="L2291">		}</span>
<span class="nc" id="L2292">		return resultMap;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>