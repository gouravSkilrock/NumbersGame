<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RetDailyLedgerHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.reportsMgmt.common</a> &gt; <span class="el_source">RetDailyLedgerHelper.java</span></div><h1>RetDailyLedgerHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.reportsMgmt.common;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Timestamp;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.TreeMap;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.ajax.AjaxRequestHelper;
import com.skilrock.lms.beans.CollectionReportBean;
import com.skilrock.lms.beans.DailyLedgerBean;
import com.skilrock.lms.beans.DateBeans;
import com.skilrock.lms.beans.ReportStatusBean;
import com.skilrock.lms.beans.ServicesBean;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.Utility;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.DBConnectReplica;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.common.exception.LMSErrors;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.filter.LMSFilterDispatcher;
import com.skilrock.lms.common.utility.FormatNumber;
import com.skilrock.lms.coreEngine.accMgmt.common.TrainingExpAgentHelper;
import com.skilrock.lms.coreEngine.commercialService.common.CSUtil;
import com.skilrock.lms.coreEngine.commercialService.productMgmt.CSProductRegistrationHelper;
import com.skilrock.lms.web.accMgmt.common.RetailerOpeningBalanceHelper;
import com.skilrock.lms.web.drawGames.common.Util;
import com.skilrock.lms.web.reportsMgmt.common.ReportUtility;
import com.skilrock.ola.reportsMgmt.controllerImpl.DepositWthdrwReportControllerImpl;
import com.skilrock.ola.reportsMgmt.controllerImpl.OlaRetailerReportControllerImpl;
import com.skilrock.ola.reportsMgmt.javaBeans.OlaOrgReportRequestBean;
import com.skilrock.ola.reportsMgmt.javaBeans.OlaOrgReportResponseBean;
import com.skilrock.ola.reportsMgmt.javaBeans.OlaReportBean;

<span class="nc" id="L45">public class RetDailyLedgerHelper {</span>
<span class="nc" id="L46">	private static Log logger = LogFactory.getLog(RetDailyLedgerHelper.class);</span>

	public Map&lt;Integer, String&gt; getRetailerList(int agtOrgId) {

<span class="nc" id="L50">		Connection connection = DBConnect.getConnection();</span>

<span class="nc" id="L52">		Map&lt;Integer, String&gt; selectMap = new TreeMap&lt;Integer, String&gt;();</span>
<span class="nc" id="L53">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L54">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L56">			pstmt = connection</span>
					.prepareStatement(&quot;select organization_id, name from st_lms_organization_master where organization_type='RETAILER' and parent_id = ? order by name&quot;);
<span class="nc" id="L58">			pstmt.setInt(1, agtOrgId);</span>
<span class="nc" id="L59">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L61">				selectMap.put(rs.getInt(&quot;organization_id&quot;), rs</span>
						.getString(&quot;name&quot;));
			}
<span class="nc" id="L64">		} catch (SQLException e) {</span>
<span class="nc" id="L65">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L67">			try {</span>

<span class="nc" id="L69">				System.out.println(&quot; closing connection  &quot;);</span>
<span class="nc bnc" id="L70" title="All 6 branches missed.">				if (connection != null) {</span>
<span class="nc" id="L71">					connection.close();</span>
				}
<span class="nc" id="L73">			} catch (SQLException e) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L75">				e.printStackTrace();</span>
<span class="nc" id="L76">			}</span>
<span class="nc" id="L77">		}</span>
<span class="nc" id="L78">		return selectMap;</span>
	}

	public DailyLedgerBean getRetLegderDetail(DateBeans dBean,
			boolean isScratch, boolean isDraw, boolean isCS, int orgId) {
<span class="nc" id="L83">		DailyLedgerBean bean = new DailyLedgerBean();</span>
<span class="nc" id="L84">		Connection connection = null;</span>

		try {

<span class="nc" id="L88">			connection = DBConnect.getConnection();</span>
<span class="nc" id="L89">			PreparedStatement pstmt = null;</span>
<span class="nc" id="L90">			ResultSet rs1 = null, rs2 = null, rs3 = null, rs4 = null, rs5 = null, rs6 = null, rs7 = null, rs8 = null;</span>
			// List&lt;Integer&gt; gameNumList = Util.getGameNumberList();
<span class="nc" id="L92">			List&lt;Integer&gt; gameNumList = Util.getLMSGameNumberList();</span>
<span class="nc" id="L93">			StringBuilder drawSaleQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L94">			StringBuilder drawSaleRefQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L95">			StringBuilder drawPwtQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L96">			String drawSaleQuery = null;</span>
<span class="nc" id="L97">			String drawSaleRefQuery = null;</span>
<span class="nc" id="L98">			String drawPwtQuery = null;</span>
<span class="nc" id="L99">			String scratchPurchaseQuery = null;</span>
<span class="nc" id="L100">			String scratchSaleRetQuery = null;</span>
<span class="nc" id="L101">			String scratchPwtQuery = null;</span>
<span class="nc" id="L102">			String scratchSaleQuery = null;</span>
<span class="nc" id="L103">			String paymentQuery = null;</span>

<span class="nc" id="L105">			String sleSaleQuery = null;</span>
<span class="nc" id="L106">			String sleSaleRefQuery = null;</span>
<span class="nc" id="L107">			String slePwtQuery = null;</span>
			
<span class="nc" id="L109">			String iwSaleQuery = null;</span>
<span class="nc" id="L110">			String iwSaleRefQuery = null;</span>
<span class="nc" id="L111">			String iwPwtQuery = null;</span>
			
<span class="nc" id="L113">			String vsSaleQuery = null;</span>
<span class="nc" id="L114">			String vsSaleRefQuery = null;</span>
<span class="nc" id="L115">			String vsPwtQuery = null;</span>

<span class="nc" id="L117">			double netSaleCS = 0.0;</span>
<span class="nc" id="L118">			double mrpSaleCS = 0.0;</span>
<span class="nc" id="L119">			double olaDeposit = 0.0;</span>
<span class="nc" id="L120">			double olaWithdrawal = 0.0;</span>
<span class="nc" id="L121">			double netDeposit = 0.0;</span>
<span class="nc" id="L122">			double netWdrwl = 0.0;</span>

<span class="nc" id="L124">			double netSleSale = 0.0;</span>
<span class="nc" id="L125">			double mrpSleSale = 0.0;</span>
<span class="nc" id="L126">			double netSlePWT = 0.0;</span>
<span class="nc" id="L127">			double mrpSlePWT = 0.0;</span>
			
<span class="nc" id="L129">			double netIwSale = 0.0;</span>
<span class="nc" id="L130">			double mrpIwSale = 0.0;</span>
<span class="nc" id="L131">			double netIwPWT = 0.0;</span>
<span class="nc" id="L132">			double mrpIwPWT = 0.0;</span>
			
<span class="nc" id="L134">			double netVsSale = 0.0;</span>
<span class="nc" id="L135">			double mrpVsSale = 0.0;</span>
<span class="nc" id="L136">			double netVsPWT = 0.0;</span>
<span class="nc" id="L137">			double mrpVsPWT = 0.0;</span>

<span class="nc bnc" id="L139" title="All 2 branches missed.">			for (int i = 0; i &lt; gameNumList.size(); i++) {</span>
<span class="nc" id="L140">				drawSaleQueryBuilder</span>
						.append(&quot;select transaction_id, mrp_amt, net_amt from st_dg_ret_sale_&quot;
								+ gameNumList.get(i)
								+ &quot; where retailer_org_id = ? union &quot;);
<span class="nc" id="L144">				drawSaleRefQueryBuilder</span>
						.append(&quot;select transaction_id, mrp_amt, net_amt from st_dg_ret_sale_refund_&quot;
								+ gameNumList.get(i)
								+ &quot; where retailer_org_id = ? union &quot;);
<span class="nc" id="L148">				drawPwtQueryBuilder</span>
						.append(&quot;select transaction_id, pwt_amt as mrpPwt,(pwt_amt+retailer_claim_comm-govt_claim_comm)as  net_amt from st_dg_ret_pwt_&quot;
								+ gameNumList.get(i)
								+ &quot; where retailer_org_id = ? union &quot;);
			}
<span class="nc" id="L153">			drawSaleQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.net_amt),0) as netSale from (&quot;</span>
					+ drawSaleQueryBuilder.toString().substring(0,
							drawSaleQueryBuilder.lastIndexOf(&quot; union &quot;))
					+ &quot;)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;
<span class="nc" id="L157">			drawSaleRefQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.net_amt),0)as netRef from (&quot;</span>
					+ drawSaleRefQueryBuilder.toString().substring(0,
							drawSaleRefQueryBuilder.lastIndexOf(&quot; union &quot;))
					+ &quot;)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;
<span class="nc" id="L161">			drawPwtQuery = &quot;select ifnull(sum(uni.mrpPwt),0)as mrpPwt, ifnull(sum(uni.net_amt),0)as netPwt from (&quot;</span>
					+ drawPwtQueryBuilder.toString().substring(0,
							drawPwtQueryBuilder.lastIndexOf(&quot; union &quot;))
					+ &quot;)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;
<span class="nc" id="L165">			scratchPurchaseQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpPur, ifnull(sum(net_amt),0)as netPur from st_se_agent_retailer_transaction sart, st_lms_agent_transaction_master atm where sart.transaction_type='SALE' and sart.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and sart.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L166">			scratchSaleRetQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpSaleRet, ifnull(sum(net_amt),0)as netSaleRet from st_se_agent_retailer_transaction sart, st_lms_retailer_transaction_master atm where sart.transaction_type='SALE_RET' and sart.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and sart.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L167">			scratchPwtQuery = &quot;select ifnull(sum(pwt_amt),0) as mrpPwt, ifnull(sum(pwt_amt*(1+claim_comm*0.01)),0)as  net_amt from st_se_retailer_pwt srp, st_lms_retailer_transaction_master atm where srp.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and srp.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L168">			scratchSaleQuery = &quot;select ifnull(sum(cnt.ticket_count*unit.ticket_price),0)as soldTicketPrice from (select game_id, ifnull(sum(sold_tickets),0) as ticket_count from st_se_game_ticket_inv_history where current_owner='RETAILER' and current_owner_id = ? and date(date)=? group by game_id)cnt, (select game_id, ticket_price from st_se_game_master)unit where cnt.game_id = unit.game_id&quot;;</span>
<span class="nc" id="L169">			paymentQuery = &quot;select cash.cashAmt, chq.chqAmt, chqboun.chqBounce, dbnote.dbnAmt,crnote.crnAmt,bankDeposit.bankDepoAmt from (select ifnull(sum(slact.amount),0)as cashAmt from st_lms_agent_cash_transaction slact, st_lms_agent_transaction_master atm where slact.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and slact.transaction_id = atm.transaction_id)as cash, (select ifnull(sum(cheque_amt),0)as chqAmt from st_lms_agent_sale_chq slasc, st_lms_agent_transaction_master atm where slasc.retailer_org_id = ? and (slasc.transaction_type='CHEQUE' or slasc.transaction_type='CLOSED') and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and slasc.transaction_id = atm.transaction_id)as chq, (select ifnull(sum(cheque_amt),0)as chqBounce from st_lms_agent_sale_chq slasc, st_lms_agent_transaction_master atm where slasc.retailer_org_id = ? and slasc.transaction_type='CHQ_BOUNCE' and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and slasc.transaction_id = atm.transaction_id)as chqboun, (select ifnull(sum(amount),0)as dbnAmt from st_lms_agent_debit_note sladn, st_lms_agent_transaction_master atm where sladn.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and sladn.transaction_id = atm.transaction_id) as dbnote ,&quot;</span>
					+ &quot;(select ifnull(sum(amount),0)as crnAmt from st_lms_agent_credit_note slacn, st_lms_agent_transaction_master atm where slacn.retailer_org_id =  ? and (atm.transaction_date)&gt;= ? and (atm.transaction_date)&lt;= ? and slacn.transaction_id = atm.transaction_id) as crnote,(select ifnull(sum(slabdt.amount),0)as bankDepoAmt from st_lms_agent_bank_deposit_transaction slabdt, st_lms_agent_transaction_master atm where slabdt.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and slabdt.transaction_id = atm.transaction_id)as bankDeposit&quot;;

<span class="nc bnc" id="L172" title="All 2 branches missed.">			if (isDraw) {</span>
<span class="nc" id="L173">				pstmt = connection.prepareStatement(drawSaleQuery);</span>
<span class="nc" id="L174">				int i = 0;</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">				for (i = 1; i &lt;= gameNumList.size(); i++) {</span>
<span class="nc" id="L176">					pstmt.setInt(i, orgId);</span>
				}
<span class="nc" id="L178">				pstmt.setTimestamp(i, dBean.getStartTime());</span>
<span class="nc" id="L179">				pstmt.setTimestamp(i + 1, dBean.getEndTime());</span>
<span class="nc" id="L180">				logger.debug(&quot;drawSaleQuery:- &quot; + pstmt);</span>
<span class="nc" id="L181">				rs1 = pstmt.executeQuery();</span>

<span class="nc" id="L183">				pstmt = connection.prepareStatement(drawSaleRefQuery);</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">				for (i = 1; i &lt;= gameNumList.size(); i++) {</span>
<span class="nc" id="L185">					pstmt.setInt(i, orgId);</span>
				}
<span class="nc" id="L187">				pstmt.setTimestamp(i, dBean.getStartTime());</span>
<span class="nc" id="L188">				pstmt.setTimestamp(i + 1, dBean.getEndTime());</span>
<span class="nc" id="L189">				logger.debug(&quot;drawSaleRefQuery:- &quot; + pstmt);</span>
<span class="nc" id="L190">				rs2 = pstmt.executeQuery();</span>

<span class="nc" id="L192">				pstmt = connection.prepareStatement(drawPwtQuery);</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">				for (i = 1; i &lt;= gameNumList.size(); i++) {</span>
<span class="nc" id="L194">					pstmt.setInt(i, orgId);</span>
				}
<span class="nc" id="L196">				pstmt.setTimestamp(i, dBean.getStartTime());</span>
<span class="nc" id="L197">				pstmt.setTimestamp(i + 1, dBean.getEndTime());</span>
<span class="nc" id="L198">				logger.debug(&quot;drawPwtQuery:- &quot; + pstmt);</span>
<span class="nc" id="L199">				rs3 = pstmt.executeQuery();</span>
			}
<span class="nc bnc" id="L201" title="All 2 branches missed.">			if (isScratch) {</span>
<span class="nc" id="L202">				pstmt = connection.prepareStatement(scratchPurchaseQuery);</span>
<span class="nc" id="L203">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L204">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L205">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L206">				logger.debug(&quot;scratchPurchaseQuery:- &quot; + pstmt);</span>
<span class="nc" id="L207">				rs4 = pstmt.executeQuery();</span>

<span class="nc" id="L209">				pstmt = connection.prepareStatement(scratchSaleRetQuery);</span>
<span class="nc" id="L210">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L211">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L212">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L213">				logger.debug(&quot;scratchSaleRetQuery:- &quot; + pstmt);</span>
<span class="nc" id="L214">				rs5 = pstmt.executeQuery();</span>

<span class="nc" id="L216">				pstmt = connection.prepareStatement(scratchPwtQuery);</span>
<span class="nc" id="L217">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L218">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L219">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L220">				logger.debug(&quot;scratchPwtQuery:- &quot; + pstmt);</span>
<span class="nc" id="L221">				rs6 = pstmt.executeQuery();</span>

<span class="nc" id="L223">				pstmt = connection.prepareStatement(scratchSaleQuery);</span>
<span class="nc" id="L224">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L225">				pstmt.setTimestamp(2, dBean.getStartTime());</span>

<span class="nc" id="L227">				logger.debug(&quot;scratchSaleQuery:- &quot; + pstmt);</span>
<span class="nc" id="L228">				rs7 = pstmt.executeQuery();</span>
			}

<span class="nc bnc" id="L231" title="All 2 branches missed.">			if (isCS) {</span>
<span class="nc" id="L232">				List&lt;Integer&gt; csGameNumList = CSUtil.fetchCSGameNumList();</span>
<span class="nc" id="L233">				StringBuilder csSaleQueryBuilder = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L234">				String csSaleQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.net_amt),0) as netSale from (&quot;;</span>

<span class="nc" id="L236">				StringBuilder csRefundQueryBuilder = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L237">				String csRefundQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.net_amt),0)as netRef from (&quot;;</span>

<span class="nc bnc" id="L239" title="All 2 branches missed.">				for (int j = 0; j &lt; csGameNumList.size(); j++) {</span>
<span class="nc" id="L240">					csSaleQueryBuilder</span>
							.append(&quot;select transaction_id, mrp_amt, net_amt from st_cs_sale_&quot;
									+ csGameNumList.get(j)
									+ &quot; where retailer_org_id = &quot;
									+ orgId
									+ &quot; union &quot;);

<span class="nc" id="L247">					csRefundQueryBuilder</span>
							.append(&quot;select transaction_id, mrp_amt, net_amt from st_cs_refund_&quot;
									+ csGameNumList.get(j)
									+ &quot; where retailer_org_id = &quot;
									+ orgId
									+ &quot; union &quot;);
				}

<span class="nc" id="L255">				csSaleQuery = csSaleQuery</span>
						+ csSaleQueryBuilder.toString().substring(
								0,
								csSaleQueryBuilder.toString().lastIndexOf(
										&quot; union &quot;));

<span class="nc" id="L261">				csRefundQuery = csRefundQuery</span>
						+ csRefundQueryBuilder.toString().substring(
								0,
								csRefundQueryBuilder.toString().lastIndexOf(
										&quot; union &quot;));

<span class="nc" id="L267">				csSaleQuery = csSaleQuery</span>
						+ &quot;)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;

<span class="nc" id="L270">				csRefundQuery = csRefundQuery</span>
						+ &quot;)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;

<span class="nc" id="L273">				PreparedStatement pstmtCS = connection</span>
						.prepareStatement(csSaleQuery);
<span class="nc" id="L275">				pstmtCS.setTimestamp(1, dBean.getStartTime());</span>
<span class="nc" id="L276">				pstmtCS.setTimestamp(2, dBean.getEndTime());</span>
<span class="nc" id="L277">				System.out.println(&quot;***getRetLegderDetail CS Sale Query :&quot;</span>
						+ pstmtCS);
<span class="nc" id="L279">				ResultSet rsCSSale = pstmtCS.executeQuery();</span>

<span class="nc" id="L281">				pstmtCS = connection.prepareStatement(csRefundQuery);</span>
<span class="nc" id="L282">				pstmtCS.setTimestamp(1, dBean.getStartTime());</span>
<span class="nc" id="L283">				pstmtCS.setTimestamp(2, dBean.getEndTime());</span>
<span class="nc" id="L284">				System.out.println(&quot;***getRetLegderDetail CS Refund Query :&quot;</span>
						+ pstmtCS);
<span class="nc" id="L286">				ResultSet rsCSRefund = pstmtCS.executeQuery();</span>

<span class="nc bnc" id="L288" title="All 4 branches missed.">				if (rsCSSale != null &amp;&amp; rsCSRefund != null) {</span>
<span class="nc" id="L289">					rsCSSale.next();</span>
<span class="nc" id="L290">					rsCSRefund.next();</span>

<span class="nc" id="L292">					netSaleCS = rsCSSale.getDouble(&quot;netSale&quot;)</span>
							- rsCSRefund.getDouble(&quot;netRef&quot;);
<span class="nc" id="L294">					mrpSaleCS = rsCSSale.getDouble(&quot;mrpSale&quot;)</span>
							- rsCSRefund.getDouble(&quot;mrpRef&quot;);
				}

			}
<span class="nc bnc" id="L299" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>
<span class="nc" id="L300">				OlaOrgReportRequestBean reqBean = new OlaOrgReportRequestBean();</span>
<span class="nc" id="L301">				reqBean.setFromDate(dBean.getStartTime().toString());</span>
<span class="nc" id="L302">				reqBean.setToDate(dBean.getEndTime().toString());</span>
<span class="nc" id="L303">				reqBean.setOrgId(orgId);</span>
<span class="nc" id="L304">				OlaOrgReportResponseBean respBean = OlaRetailerReportControllerImpl</span>
						.fetchDepositWithdrawlSinglaRetailer(reqBean,
								connection);
<span class="nc" id="L307">				olaDeposit = respBean.getMrpDepositAmt();</span>
<span class="nc" id="L308">				olaWithdrawal = respBean.getMrpWithdrawalAmt();</span>
<span class="nc" id="L309">				netDeposit = respBean.getNetDepositAmt();</span>
<span class="nc" id="L310">				netWdrwl = respBean.getNetWithdrawalAmt();</span>
<span class="nc" id="L311">				bean.setOlaDeposit(Double.toString(netDeposit));</span>
<span class="nc" id="L312">				bean.setOlaWithdrawal(Double.toString(netWdrwl));</span>
			}

<span class="nc bnc" id="L315" title="All 2 branches missed.">			if (ReportUtility.isSLE) {</span>
<span class="nc" id="L316">				ResultSet rs = null;</span>

<span class="nc" id="L318">				double netSaleTemp = 0.0;</span>
<span class="nc" id="L319">				double netRefTemp = 0.0;</span>
<span class="nc" id="L320">				double mrpSaleTemp = 0.0;</span>
<span class="nc" id="L321">				double mrpRefTemp = 0.0;</span>

				// sleSaleQuery =
				// &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.retailer_net_amt),0) as netSale from (select transaction_id, mrp_amt, retailer_net_amt from st_sle_ret_sale where retailer_org_id = ? )uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;
				// sleSaleRefQuery =
				// &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.retailer_net_amt),0)as netRef from (select transaction_id, mrp_amt, retailer_net_amt from st_sle_ret_sale_refund where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;
				// slePwtQuery =
				// &quot;select ifnull(sum(uni.mrpPwt),0)as mrpPwt, ifnull(sum(uni.net_amt),0)as netPwt from (select transaction_id, pwt_amt as mrpPwt,(pwt_amt+retailer_claim_comm)as  net_amt from st_sle_ret_pwt where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;

<span class="nc" id="L330">				sleSaleQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpSale, ifnull(sum(retailer_net_amt),0) as netSale from st_sle_ret_sale where retailer_org_id = ? and transaction_date&gt;=? and transaction_date&lt;=?&quot;;</span>
<span class="nc" id="L331">				sleSaleRefQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpRef, ifnull(sum(retailer_net_amt),0)as netRef from st_sle_ret_sale_refund where retailer_org_id = ? and transaction_date&gt;=? and transaction_date&lt;=?&quot;;</span>
<span class="nc" id="L332">				slePwtQuery = &quot;select ifnull(sum(pwt_amt),0)as mrpPwt, ifnull(sum(pwt_amt+retailer_claim_comm-govt_claim_comm),0)as netPwt from st_sle_ret_pwt where retailer_org_id = ? and transaction_date&gt;=? and transaction_date&lt;=?&quot;;</span>

<span class="nc" id="L334">				pstmt = connection.prepareStatement(sleSaleQuery);</span>
<span class="nc" id="L335">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L336">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L337">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L338">				logger.debug(&quot;SLESaleQuery - &quot; + pstmt);</span>
<span class="nc" id="L339">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L340" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L341">					netSaleTemp = rs.getDouble(&quot;netSale&quot;);</span>
<span class="nc" id="L342">					mrpSaleTemp = rs.getDouble(&quot;mrpSale&quot;);</span>
				}

<span class="nc" id="L345">				pstmt = connection.prepareStatement(sleSaleRefQuery);</span>
<span class="nc" id="L346">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L347">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L348">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L349">				logger.debug(&quot;SLERefundQuery - &quot; + pstmt);</span>
<span class="nc" id="L350">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L352">					netRefTemp = rs.getDouble(&quot;netRef&quot;);</span>
<span class="nc" id="L353">					mrpRefTemp = rs.getDouble(&quot;mrpRef&quot;);</span>
				}

<span class="nc" id="L356">				pstmt = connection.prepareStatement(slePwtQuery);</span>
<span class="nc" id="L357">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L358">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L359">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L360">				logger.debug(&quot;SLEPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L361">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L363">					netSlePWT = rs.getDouble(&quot;netPwt&quot;);</span>
<span class="nc" id="L364">					mrpSlePWT = rs.getDouble(&quot;mrpPwt&quot;);</span>
				}

<span class="nc" id="L367">				netSleSale = netSaleTemp - netRefTemp;</span>
<span class="nc" id="L368">				mrpSleSale = mrpSaleTemp - mrpRefTemp;</span>
			}
<span class="nc bnc" id="L370" title="All 2 branches missed.">			if (ReportUtility.isIW) {</span>
<span class="nc" id="L371">				ResultSet rs = null;</span>

<span class="nc" id="L373">				double netSaleTemp = 0.0;</span>
<span class="nc" id="L374">				double netRefTemp = 0.0;</span>
<span class="nc" id="L375">				double mrpSaleTemp = 0.0;</span>
<span class="nc" id="L376">				double mrpRefTemp = 0.0;</span>

				// sleSaleQuery =
				// &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.retailer_net_amt),0) as netSale from (select transaction_id, mrp_amt, retailer_net_amt from st_sle_ret_sale where retailer_org_id = ? )uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;
				// sleSaleRefQuery =
				// &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.retailer_net_amt),0)as netRef from (select transaction_id, mrp_amt, retailer_net_amt from st_sle_ret_sale_refund where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;
				// slePwtQuery =
				// &quot;select ifnull(sum(uni.mrpPwt),0)as mrpPwt, ifnull(sum(uni.net_amt),0)as netPwt from (select transaction_id, pwt_amt as mrpPwt,(pwt_amt+retailer_claim_comm)as  net_amt from st_sle_ret_pwt where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;

<span class="nc" id="L385">				iwSaleQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpSale, ifnull(sum(retailer_net_amt),0) as netSale from st_iw_ret_sale where retailer_org_id = ? and transaction_date&gt;=? and transaction_date&lt;=?&quot;;</span>
<span class="nc" id="L386">				iwSaleRefQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpRef, ifnull(sum(retailer_net_amt),0)as netRef from st_iw_ret_sale_refund where retailer_org_id = ? and transaction_date&gt;=? and transaction_date&lt;=?&quot;;</span>
<span class="nc" id="L387">				iwPwtQuery = &quot;select ifnull(sum(pwt_amt),0)as mrpPwt, ifnull(sum(pwt_amt+retailer_claim_comm),0)as netPwt from st_iw_ret_pwt where retailer_org_id = ? and transaction_date&gt;=? and transaction_date&lt;=?&quot;;</span>

<span class="nc" id="L389">				pstmt = connection.prepareStatement(iwSaleQuery);</span>
<span class="nc" id="L390">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L391">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L392">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L393">				logger.debug(&quot;IWSaleQuery - &quot; + pstmt);</span>
<span class="nc" id="L394">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L395" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L396">					netSaleTemp = rs.getDouble(&quot;netSale&quot;);</span>
<span class="nc" id="L397">					mrpSaleTemp = rs.getDouble(&quot;mrpSale&quot;);</span>
				}

<span class="nc" id="L400">				pstmt = connection.prepareStatement(iwSaleRefQuery);</span>
<span class="nc" id="L401">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L402">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L403">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L404">				logger.debug(&quot;IWRefundQuery - &quot; + pstmt);</span>
<span class="nc" id="L405">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L407">					netRefTemp = rs.getDouble(&quot;netRef&quot;);</span>
<span class="nc" id="L408">					mrpRefTemp = rs.getDouble(&quot;mrpRef&quot;);</span>
				}

<span class="nc" id="L411">				pstmt = connection.prepareStatement(iwPwtQuery);</span>
<span class="nc" id="L412">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L413">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L414">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L415">				logger.debug(&quot;IWPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L416">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L417" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L418">					netIwPWT = rs.getDouble(&quot;netPwt&quot;);</span>
<span class="nc" id="L419">					mrpIwPWT = rs.getDouble(&quot;mrpPwt&quot;);</span>
				}

<span class="nc" id="L422">				netIwSale = netSaleTemp - netRefTemp;</span>
<span class="nc" id="L423">				mrpIwSale = mrpSaleTemp - mrpRefTemp;</span>
			}
			
<span class="nc bnc" id="L426" title="All 2 branches missed.">			if (ReportUtility.isVS) {</span>
<span class="nc" id="L427">				ResultSet rs = null;</span>

<span class="nc" id="L429">				double netSaleTemp = 0.0;</span>
<span class="nc" id="L430">				double netRefTemp = 0.0;</span>
<span class="nc" id="L431">				double mrpSaleTemp = 0.0;</span>
<span class="nc" id="L432">				double mrpRefTemp = 0.0;</span>

<span class="nc" id="L434">				vsSaleQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpSale, ifnull(sum(retailer_net_amt),0) as netSale from st_vs_ret_sale where retailer_org_id = ? and transaction_date&gt;=? and transaction_date&lt;=?&quot;;</span>
<span class="nc" id="L435">				vsSaleRefQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpRef, ifnull(sum(retailer_net_amt),0)as netRef from st_vs_ret_sale_refund where retailer_org_id = ? and transaction_date&gt;=? and transaction_date&lt;=?&quot;;</span>
<span class="nc" id="L436">				vsPwtQuery = &quot;select ifnull(sum(pwt_amt),0)as mrpPwt, ifnull(sum(pwt_amt+retailer_claim_comm),0)as netPwt from st_vs_ret_pwt where retailer_org_id = ? and transaction_date&gt;=? and transaction_date&lt;=?&quot;;</span>

<span class="nc" id="L438">				pstmt = connection.prepareStatement(vsSaleQuery);</span>
<span class="nc" id="L439">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L440">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L441">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L442">				logger.debug(&quot;VSSaleQuery - &quot; + pstmt);</span>
<span class="nc" id="L443">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L444" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L445">					netSaleTemp = rs.getDouble(&quot;netSale&quot;);</span>
<span class="nc" id="L446">					mrpSaleTemp = rs.getDouble(&quot;mrpSale&quot;);</span>
				}

<span class="nc" id="L449">				pstmt = connection.prepareStatement(vsSaleRefQuery);</span>
<span class="nc" id="L450">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L451">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L452">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L453">				logger.debug(&quot;VSRefundQuery - &quot; + pstmt);</span>
<span class="nc" id="L454">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L456">					netRefTemp = rs.getDouble(&quot;netRef&quot;);</span>
<span class="nc" id="L457">					mrpRefTemp = rs.getDouble(&quot;mrpRef&quot;);</span>
				}

<span class="nc" id="L460">				pstmt = connection.prepareStatement(vsPwtQuery);</span>
<span class="nc" id="L461">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L462">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L463">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L464">				logger.debug(&quot;VSPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L465">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L466" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L467">					netVsPWT = rs.getDouble(&quot;netPwt&quot;);</span>
<span class="nc" id="L468">					mrpVsPWT = rs.getDouble(&quot;mrpPwt&quot;);</span>
				}

<span class="nc" id="L471">				netVsSale = netSaleTemp - netRefTemp;</span>
<span class="nc" id="L472">				mrpVsSale = mrpSaleTemp - mrpRefTemp;</span>
			}

<span class="nc" id="L475">			pstmt = connection.prepareStatement(paymentQuery);</span>
<span class="nc" id="L476">			pstmt.setInt(1, orgId);</span>
<span class="nc" id="L477">			pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L478">			pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L479">			pstmt.setInt(4, orgId);</span>
<span class="nc" id="L480">			pstmt.setTimestamp(5, dBean.getStartTime());</span>
<span class="nc" id="L481">			pstmt.setTimestamp(6, dBean.getEndTime());</span>
<span class="nc" id="L482">			pstmt.setInt(7, orgId);</span>
<span class="nc" id="L483">			pstmt.setTimestamp(8, dBean.getStartTime());</span>
<span class="nc" id="L484">			pstmt.setTimestamp(9, dBean.getEndTime());</span>
<span class="nc" id="L485">			pstmt.setInt(10, orgId);</span>
<span class="nc" id="L486">			pstmt.setTimestamp(11, dBean.getStartTime());</span>
<span class="nc" id="L487">			pstmt.setTimestamp(12, dBean.getEndTime());</span>
<span class="nc" id="L488">			pstmt.setInt(13, orgId);</span>
<span class="nc" id="L489">			pstmt.setTimestamp(14, dBean.getStartTime());</span>
<span class="nc" id="L490">			pstmt.setTimestamp(15, dBean.getEndTime());</span>
<span class="nc" id="L491">			pstmt.setInt(16,orgId);</span>
<span class="nc" id="L492">			pstmt.setTimestamp(17, dBean.getStartTime());</span>
<span class="nc" id="L493">			pstmt.setTimestamp(18, dBean.getEndTime());</span>
<span class="nc" id="L494">			logger.debug(&quot;paymentQuery:- &quot; + pstmt);</span>
<span class="nc" id="L495">			rs8 = pstmt.executeQuery();</span>

<span class="nc" id="L497">			double netSale = 0.0;</span>
<span class="nc" id="L498">			double mrpSale = 0.0;</span>
<span class="nc" id="L499">			double netPwt = 0.0;</span>
<span class="nc" id="L500">			double mrpPwt = 0.0;</span>
<span class="nc" id="L501">			double netPurchase = 0.0;</span>
<span class="nc" id="L502">			double mrpPurchase = 0.0;</span>
<span class="nc" id="L503">			double netPayment = 0.0;</span>
<span class="nc" id="L504">			double scratchSale = 0.0;</span>
<span class="nc" id="L505">			double opBal = 0.0;</span>
<span class="nc" id="L506">			double cashCol = 0.0;</span>
<span class="nc" id="L507">			double profit = 0.0;</span>

<span class="nc bnc" id="L509" title="All 6 branches missed.">			if (rs1 != null &amp;&amp; rs2 != null &amp;&amp; rs3 != null) {</span>
<span class="nc" id="L510">				rs1.next();</span>
<span class="nc" id="L511">				rs2.next();</span>
<span class="nc" id="L512">				rs3.next();</span>
<span class="nc" id="L513">				netSale = rs1.getDouble(&quot;netSale&quot;) - rs2.getDouble(&quot;netRef&quot;);</span>
<span class="nc" id="L514">				mrpSale = rs1.getDouble(&quot;mrpSale&quot;) - rs2.getDouble(&quot;mrpRef&quot;);</span>
<span class="nc" id="L515">				netPwt = rs3.getDouble(&quot;netPwt&quot;);</span>
<span class="nc" id="L516">				mrpPwt = rs3.getDouble(&quot;mrpPwt&quot;);</span>
			}
<span class="nc bnc" id="L518" title="All 8 branches missed.">			if (rs4 != null &amp;&amp; rs5 != null &amp;&amp; rs6 != null &amp;&amp; rs7 != null) {</span>
<span class="nc" id="L519">				rs4.next();</span>
<span class="nc" id="L520">				rs5.next();</span>
<span class="nc" id="L521">				rs6.next();</span>
<span class="nc" id="L522">				rs7.next();</span>
<span class="nc" id="L523">				netPurchase = rs4.getDouble(&quot;netPur&quot;)</span>
						- rs5.getDouble(&quot;netSaleRet&quot;);
<span class="nc" id="L525">				mrpPurchase = rs4.getDouble(&quot;mrpPur&quot;)</span>
						- rs5.getDouble(&quot;mrpSaleRet&quot;);
<span class="nc" id="L527">				netPwt += rs6.getDouble(&quot;net_amt&quot;);</span>
<span class="nc" id="L528">				mrpPwt += rs6.getDouble(&quot;mrpPwt&quot;);</span>
<span class="nc" id="L529">				scratchSale = rs7.getDouble(&quot;soldTicketPrice&quot;);</span>
			}
<span class="nc" id="L531">			rs8.next();</span>
<span class="nc" id="L532">			netPayment = rs8.getDouble(&quot;cashAmt&quot;) + rs8.getDouble(&quot;chqAmt&quot;)</span>
					+ rs8.getDouble(&quot;crnAmt&quot;) + rs8.getDouble(&quot;bankDepoAmt&quot;)
					- rs8.getDouble(&quot;chqBounce&quot;) - rs8.getDouble(&quot;dbnAmt&quot;);

<span class="nc" id="L536">			opBal = netPayment + netPwt - netPurchase - netSale - netSaleCS</span>
					+ netWdrwl - netDeposit + netSlePWT - netSleSale + netIwPWT
					- netIwSale + netVsPWT - netVsSale;
<span class="nc" id="L539">			cashCol = -netPayment - mrpPwt - olaWithdrawal + mrpSale</span>
					+ scratchSale + mrpSaleCS + olaDeposit - mrpSlePWT
					+ mrpSleSale - mrpIwPWT + mrpIwSale - mrpVsPWT + mrpVsSale;
<span class="nc" id="L542">			profit = mrpPurchase - netPurchase + mrpSale - netSale + mrpPwt</span>
					- netPwt + mrpSaleCS - netSaleCS + olaDeposit - netDeposit
					+ (olaWithdrawal - netWdrwl) + mrpSleSale - netSleSale
					+ mrpSlePWT - netSlePWT + mrpIwSale - netIwSale + mrpIwPWT
					- netIwPWT + mrpVsSale - netVsSale + mrpVsPWT - netVsPWT;
<span class="nc" id="L547">			bean.setClrBal(opBal + &quot;&quot;);</span>
<span class="nc" id="L548">			bean.setPurchase(netPurchase + &quot;&quot;);</span>
			// bean.setNetPwt(netPwt + &quot;&quot;);
			// bean.setNetsale(netSale + &quot;&quot;);
<span class="nc" id="L551">			bean.setNetPwt(netPwt +&quot;&quot;);</span>
<span class="nc" id="L552">			bean.setNetsale(netSale +&quot;&quot;);</span>
<span class="nc" id="L553">			bean.setNetSaleRefund(&quot;&quot;);</span>
<span class="nc" id="L554">			bean.setNetPayment(netPayment + &quot;&quot;);</span>
<span class="nc" id="L555">			bean.setScratchSale(scratchSale + &quot;&quot;);</span>
<span class="nc" id="L556">			bean.setCashCol(cashCol + &quot;&quot;);</span>
<span class="nc" id="L557">			bean.setProfit(profit + &quot;&quot;);</span>
<span class="nc" id="L558">			bean.setNetSaleCS(netSaleCS + &quot;&quot;);</span>

<span class="nc" id="L560">			bean.setSleSale(netSleSale + &quot;&quot;);</span>
<span class="nc" id="L561">			bean.setSlePwt(netSlePWT + &quot;&quot;);</span>
			
<span class="nc" id="L563">			bean.setIwSale(netIwSale + &quot;&quot;);</span>
<span class="nc" id="L564">			bean.setIwPwt(netIwPWT + &quot;&quot;);</span>
			
<span class="nc" id="L566">			bean.setVsSale(netVsSale + &quot;&quot;);</span>
<span class="nc" id="L567">			bean.setVsPwt(netVsPWT + &quot;&quot;);</span>

<span class="nc" id="L569">			return bean;</span>
<span class="nc" id="L570">		} catch (Exception e) {</span>
<span class="nc" id="L571">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L573">			try {</span>
<span class="nc" id="L574">				System.out.println(&quot; closing connection  &quot;);</span>
<span class="nc bnc" id="L575" title="All 6 branches missed.">				if (connection != null) {</span>
<span class="nc" id="L576">					connection.close();</span>
				}
<span class="nc" id="L578">			} catch (SQLException e) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L580">				e.printStackTrace();</span>
<span class="nc" id="L581">			}</span>
<span class="nc" id="L582">		}</span>
<span class="nc" id="L583">		return bean;</span>
	}

	 public DailyLedgerBean getRetLegderDetail(Timestamp deployDate, DateBeans dBean, UserInfoBean userBean, ReportStatusBean reportStatusBean) {
<span class="nc" id="L587">	        DailyLedgerBean bean = new DailyLedgerBean();</span>
<span class="nc" id="L588">	        Connection connection = null;</span>
	        
<span class="nc" id="L590">	        String drawSaleQuery = null;</span>
<span class="nc" id="L591">	        String drawSaleRefQuery = null;</span>
<span class="nc" id="L592">	        String drawPwtQuery = null;</span>
<span class="nc" id="L593">	        String scratchPurchaseQuery = null;</span>
<span class="nc" id="L594">	        String scratchSaleRetQuery = null;</span>
<span class="nc" id="L595">	        String scratchPwtQuery = null;</span>
<span class="nc" id="L596">	        String scratchSaleQuery = null;</span>
<span class="nc" id="L597">	        String paymentQuery = null;</span>

<span class="nc" id="L599">	        String sleSaleQuery = null;</span>
<span class="nc" id="L600">	        String sleSaleRefQuery = null;</span>
<span class="nc" id="L601">	        String slePwtQuery = null;</span>

<span class="nc" id="L603">	        String iwSaleQuery = null;</span>
<span class="nc" id="L604">	        String iwSaleRefQuery = null;</span>
<span class="nc" id="L605">	        String iwPwtQuery = null;</span>

<span class="nc" id="L607">	        double netSaleCS = 0.0;</span>
<span class="nc" id="L608">	        double mrpSaleCS = 0.0;</span>
<span class="nc" id="L609">	        double olaDeposit = 0.0;</span>
<span class="nc" id="L610">	        double olaWithdrawal = 0.0;</span>
<span class="nc" id="L611">	        double netDeposit = 0.0;</span>
<span class="nc" id="L612">	        double netWdrwl = 0.0;</span>

<span class="nc" id="L614">	        double netSleSale = 0.0;</span>
<span class="nc" id="L615">	        double mrpSleSale = 0.0;</span>
<span class="nc" id="L616">	        double netSlePWT = 0.0;</span>
<span class="nc" id="L617">	        double mrpSlePWT = 0.0;</span>

<span class="nc" id="L619">	        double netIwSale = 0.0;</span>
<span class="nc" id="L620">	        double mrpIwSale = 0.0;</span>
<span class="nc" id="L621">	        double netIwPWT = 0.0;</span>
<span class="nc" id="L622">	        double mrpIwPWT = 0.0;</span>
	        
<span class="nc" id="L624">	        int orgId = 0;</span>
	        try {
<span class="nc" id="L626">	            connection = DBConnect.getConnection();</span>
<span class="nc" id="L627">	            PreparedStatement pstmt = null;</span>
<span class="nc" id="L628">	            ResultSet rs1 = null, rs2 = null, rs3 = null, rs4 = null, rs5 = null, rs6 = null, rs7 = null, rs8 = null;</span>
	            // List&lt;Integer&gt; gameNumList = Util.getGameNumberList();
<span class="nc" id="L630">	            List&lt;Integer&gt; gameNumList = Util.getLMSGameNumberList();</span>
<span class="nc" id="L631">	            StringBuilder drawSaleQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L632">	            StringBuilder drawSaleRefQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L633">	            StringBuilder drawPwtQueryBuilder = new StringBuilder();</span>
	            
	            
<span class="nc" id="L636">	            orgId = userBean.getUserOrgId();</span>

<span class="nc" id="L638">	            double openingbal = new RetailerOpeningBalanceHelper().getRetailerOpeningBal(deployDate, dBean.getStartTime(), userBean.getUserOrgId(), userBean.getParentOrgId(), connection);</span>

<span class="nc bnc" id="L640" title="All 2 branches missed.">	            for (int i = 0; i &lt; gameNumList.size(); i++) {</span>
<span class="nc" id="L641">	                drawSaleQueryBuilder</span>
	                        .append(&quot;select transaction_id, mrp_amt, net_amt from st_dg_ret_sale_&quot;
	                                + gameNumList.get(i)
	                                + &quot; where retailer_org_id = ? union &quot;);
<span class="nc" id="L645">	                drawSaleRefQueryBuilder</span>
	                        .append(&quot;select transaction_id, mrp_amt, net_amt from st_dg_ret_sale_refund_&quot;
	                                + gameNumList.get(i)
	                                + &quot; where retailer_org_id = ? union &quot;);
<span class="nc" id="L649">	                drawPwtQueryBuilder</span>
	                        .append(&quot;select transaction_id, pwt_amt as mrpPwt,(pwt_amt+retailer_claim_comm)as  net_amt from st_dg_ret_pwt_&quot;
	                                + gameNumList.get(i)
	                                + &quot; where retailer_org_id = ? union &quot;);
	            }
<span class="nc" id="L654">	            drawSaleQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.net_amt),0) as netSale from (&quot;</span>
	                    + drawSaleQueryBuilder.toString().substring(0,
	                            drawSaleQueryBuilder.lastIndexOf(&quot; union &quot;))
	                    + &quot;)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;
<span class="nc" id="L658">	            drawSaleRefQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.net_amt),0)as netRef from (&quot;</span>
	                    + drawSaleRefQueryBuilder.toString().substring(0,
	                            drawSaleRefQueryBuilder.lastIndexOf(&quot; union &quot;))
	                    + &quot;)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;
<span class="nc" id="L662">	            drawPwtQuery = &quot;select ifnull(sum(uni.mrpPwt),0)as mrpPwt, ifnull(sum(uni.net_amt),0)as netPwt from (&quot;</span>
	                    + drawPwtQueryBuilder.toString().substring(0,
	                            drawPwtQueryBuilder.lastIndexOf(&quot; union &quot;))
	                    + &quot;)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;
<span class="nc" id="L666">	            scratchPurchaseQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpPur, ifnull(sum(net_amt),0)as netPur from st_se_agent_retailer_transaction sart, st_lms_agent_transaction_master atm where sart.transaction_type='SALE' and sart.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and sart.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L667">	            scratchSaleRetQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpSaleRet, ifnull(sum(net_amt),0)as netSaleRet from st_se_agent_retailer_transaction sart, st_lms_retailer_transaction_master atm where sart.transaction_type='SALE_RET' and sart.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and sart.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L668">	            scratchPwtQuery = &quot;select ifnull(sum(pwt_amt),0) as mrpPwt, ifnull(sum(pwt_amt*(1+claim_comm*0.01)),0)as  net_amt from st_se_retailer_pwt srp, st_lms_retailer_transaction_master atm where srp.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and srp.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L669">	            scratchSaleQuery = &quot;select ifnull(sum(cnt.ticket_count*unit.ticket_price),0)as soldTicketPrice from (select game_id, ifnull(sum(sold_tickets),0) as ticket_count from st_se_game_ticket_inv_history where current_owner='RETAILER' and current_owner_id = ? and date(date)=? group by game_id)cnt, (select game_id, ticket_price from st_se_game_master)unit where cnt.game_id = unit.game_id&quot;;</span>
<span class="nc" id="L670">	            paymentQuery = &quot;select cash.cashAmt, chq.chqAmt, chqboun.chqBounce, dbnote.dbnAmt,crnote.crnAmt,bankDeposit.bankDepoAmt from (select ifnull(sum(slact.amount),0)as cashAmt from st_lms_agent_cash_transaction slact, st_lms_agent_transaction_master atm where slact.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and slact.transaction_id = atm.transaction_id)as cash, (select ifnull(sum(cheque_amt),0)as chqAmt from st_lms_agent_sale_chq slasc, st_lms_agent_transaction_master atm where slasc.retailer_org_id = ? and (slasc.transaction_type='CHEQUE' or slasc.transaction_type='CLOSED') and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and slasc.transaction_id = atm.transaction_id)as chq, (select ifnull(sum(cheque_amt),0)as chqBounce from st_lms_agent_sale_chq slasc, st_lms_agent_transaction_master atm where slasc.retailer_org_id = ? and slasc.transaction_type='CHQ_BOUNCE' and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and slasc.transaction_id = atm.transaction_id)as chqboun, (select ifnull(sum(amount),0)as dbnAmt from st_lms_agent_debit_note sladn, st_lms_agent_transaction_master atm where sladn.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and sladn.transaction_id = atm.transaction_id) as dbnote ,&quot;</span>
	                    + &quot;(select ifnull(sum(amount),0)as crnAmt from st_lms_agent_credit_note slacn, st_lms_agent_transaction_master atm where slacn.retailer_org_id =  ? and (atm.transaction_date)&gt;= ? and (atm.transaction_date)&lt;= ? and slacn.transaction_id = atm.transaction_id) as crnote,(select ifnull(sum(slabdt.amount),0)as bankDepoAmt from st_lms_agent_bank_deposit_transaction slabdt, st_lms_agent_transaction_master atm where slabdt.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and slabdt.transaction_id = atm.transaction_id)as bankDeposit&quot;;

<span class="nc bnc" id="L673" title="All 2 branches missed.">	            if (ReportUtility.isDG) {</span>
<span class="nc" id="L674">	                pstmt = connection.prepareStatement(drawSaleQuery);</span>
<span class="nc" id="L675">	                int i = 0;</span>
<span class="nc bnc" id="L676" title="All 2 branches missed.">	                for (i = 1; i &lt;= gameNumList.size(); i++) {</span>
<span class="nc" id="L677">	                    pstmt.setInt(i, orgId);</span>
	                }
<span class="nc" id="L679">	                pstmt.setTimestamp(i, dBean.getStartTime());</span>
<span class="nc" id="L680">	                pstmt.setTimestamp(i + 1, dBean.getEndTime());</span>
<span class="nc" id="L681">	                logger.debug(&quot;drawSaleQuery:- &quot; + pstmt);</span>
<span class="nc" id="L682">	                rs1 = pstmt.executeQuery();</span>

<span class="nc" id="L684">	                pstmt = connection.prepareStatement(drawSaleRefQuery);</span>
<span class="nc bnc" id="L685" title="All 2 branches missed.">	                for (i = 1; i &lt;= gameNumList.size(); i++) {</span>
<span class="nc" id="L686">	                    pstmt.setInt(i, orgId);</span>
	                }
<span class="nc" id="L688">	                pstmt.setTimestamp(i, dBean.getStartTime());</span>
<span class="nc" id="L689">	                pstmt.setTimestamp(i + 1, dBean.getEndTime());</span>
<span class="nc" id="L690">	                logger.debug(&quot;drawSaleRefQuery:- &quot; + pstmt);</span>
<span class="nc" id="L691">	                rs2 = pstmt.executeQuery();</span>

<span class="nc" id="L693">	                pstmt = connection.prepareStatement(drawPwtQuery);</span>
<span class="nc bnc" id="L694" title="All 2 branches missed.">	                for (i = 1; i &lt;= gameNumList.size(); i++) {</span>
<span class="nc" id="L695">	                    pstmt.setInt(i, orgId);</span>
	                }
<span class="nc" id="L697">	                pstmt.setTimestamp(i, dBean.getStartTime());</span>
<span class="nc" id="L698">	                pstmt.setTimestamp(i + 1, dBean.getEndTime());</span>
<span class="nc" id="L699">	                logger.debug(&quot;drawPwtQuery:- &quot; + pstmt);</span>
<span class="nc" id="L700">	                rs3 = pstmt.executeQuery();</span>
	            }
<span class="nc bnc" id="L702" title="All 2 branches missed.">	            if (ReportUtility.isSE) {</span>
<span class="nc" id="L703">	                pstmt = connection.prepareStatement(scratchPurchaseQuery);</span>
<span class="nc" id="L704">	                pstmt.setInt(1, orgId);</span>
<span class="nc" id="L705">	                pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L706">	                pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L707">	                logger.debug(&quot;scratchPurchaseQuery:- &quot; + pstmt);</span>
<span class="nc" id="L708">	                rs4 = pstmt.executeQuery();</span>

<span class="nc" id="L710">	                pstmt = connection.prepareStatement(scratchSaleRetQuery);</span>
<span class="nc" id="L711">	                pstmt.setInt(1, orgId);</span>
<span class="nc" id="L712">	                pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L713">	                pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L714">	                logger.debug(&quot;scratchSaleRetQuery:- &quot; + pstmt);</span>
<span class="nc" id="L715">	                rs5 = pstmt.executeQuery();</span>

<span class="nc" id="L717">	                pstmt = connection.prepareStatement(scratchPwtQuery);</span>
<span class="nc" id="L718">	                pstmt.setInt(1, orgId);</span>
<span class="nc" id="L719">	                pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L720">	                pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L721">	                logger.debug(&quot;scratchPwtQuery:- &quot; + pstmt);</span>
<span class="nc" id="L722">	                rs6 = pstmt.executeQuery();</span>

<span class="nc" id="L724">	                pstmt = connection.prepareStatement(scratchSaleQuery);</span>
<span class="nc" id="L725">	                pstmt.setInt(1, orgId);</span>
<span class="nc" id="L726">	                pstmt.setTimestamp(2, dBean.getStartTime());</span>

<span class="nc" id="L728">	                logger.debug(&quot;scratchSaleQuery:- &quot; + pstmt);</span>
<span class="nc" id="L729">	                rs7 = pstmt.executeQuery();</span>
	            }

<span class="nc bnc" id="L732" title="All 2 branches missed.">	            if (ReportUtility.isCS) {</span>
<span class="nc" id="L733">	                List&lt;Integer&gt; csGameNumList = CSUtil.fetchCSGameNumList();</span>
<span class="nc" id="L734">	                StringBuilder csSaleQueryBuilder = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L735">	                String csSaleQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.net_amt),0) as netSale from (&quot;;</span>

<span class="nc" id="L737">	                StringBuilder csRefundQueryBuilder = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L738">	                String csRefundQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.net_amt),0)as netRef from (&quot;;</span>

<span class="nc bnc" id="L740" title="All 2 branches missed.">	                for (int j = 0; j &lt; csGameNumList.size(); j++) {</span>
<span class="nc" id="L741">	                    csSaleQueryBuilder</span>
	                            .append(&quot;select transaction_id, mrp_amt, net_amt from st_cs_sale_&quot;
	                                    + csGameNumList.get(j)
	                                    + &quot; where retailer_org_id = &quot;
	                                    + orgId
	                                    + &quot; union &quot;);

<span class="nc" id="L748">	                    csRefundQueryBuilder</span>
	                            .append(&quot;select transaction_id, mrp_amt, net_amt from st_cs_refund_&quot;
	                                    + csGameNumList.get(j)
	                                    + &quot; where retailer_org_id = &quot;
	                                    + orgId
	                                    + &quot; union &quot;);
	                }

<span class="nc" id="L756">	                csSaleQuery = csSaleQuery</span>
	                        + csSaleQueryBuilder.toString().substring(
	                                0,
	                                csSaleQueryBuilder.toString().lastIndexOf(
	                                        &quot; union &quot;));

<span class="nc" id="L762">	                csRefundQuery = csRefundQuery</span>
	                        + csRefundQueryBuilder.toString().substring(
	                                0,
	                                csRefundQueryBuilder.toString().lastIndexOf(
	                                        &quot; union &quot;));

<span class="nc" id="L768">	                csSaleQuery = csSaleQuery</span>
	                        + &quot;)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;

<span class="nc" id="L771">	                csRefundQuery = csRefundQuery</span>
	                        + &quot;)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;

<span class="nc" id="L774">	                PreparedStatement pstmtCS = connection</span>
	                        .prepareStatement(csSaleQuery);
<span class="nc" id="L776">	                pstmtCS.setTimestamp(1, dBean.getStartTime());</span>
<span class="nc" id="L777">	                pstmtCS.setTimestamp(2, dBean.getEndTime());</span>
<span class="nc" id="L778">	                System.out.println(&quot;***getRetLegderDetail CS Sale Query :&quot;</span>
	                        + pstmtCS);
<span class="nc" id="L780">	                ResultSet rsCSSale = pstmtCS.executeQuery();</span>

<span class="nc" id="L782">	                pstmtCS = connection.prepareStatement(csRefundQuery);</span>
<span class="nc" id="L783">	                pstmtCS.setTimestamp(1, dBean.getStartTime());</span>
<span class="nc" id="L784">	                pstmtCS.setTimestamp(2, dBean.getEndTime());</span>
<span class="nc" id="L785">	                System.out.println(&quot;***getRetLegderDetail CS Refund Query :&quot;</span>
	                        + pstmtCS);
<span class="nc" id="L787">	                ResultSet rsCSRefund = pstmtCS.executeQuery();</span>

<span class="nc bnc" id="L789" title="All 4 branches missed.">	                if (rsCSSale != null &amp;&amp; rsCSRefund != null) {</span>
<span class="nc" id="L790">	                    rsCSSale.next();</span>
<span class="nc" id="L791">	                    rsCSRefund.next();</span>

<span class="nc" id="L793">	                    netSaleCS = rsCSSale.getDouble(&quot;netSale&quot;)</span>
	                            - rsCSRefund.getDouble(&quot;netRef&quot;);
<span class="nc" id="L795">	                    mrpSaleCS = rsCSSale.getDouble(&quot;mrpSale&quot;)</span>
	                            - rsCSRefund.getDouble(&quot;mrpRef&quot;);
	                }

	            }
<span class="nc bnc" id="L800" title="All 2 branches missed.">	            if (ReportUtility.isOLA) {</span>
<span class="nc" id="L801">	                OlaOrgReportRequestBean reqBean = new OlaOrgReportRequestBean();</span>
<span class="nc" id="L802">	                reqBean.setFromDate(dBean.getStartTime().toString());</span>
<span class="nc" id="L803">	                reqBean.setToDate(dBean.getEndTime().toString());</span>
<span class="nc" id="L804">	                reqBean.setOrgId(orgId);</span>
<span class="nc" id="L805">	                OlaOrgReportResponseBean respBean = OlaRetailerReportControllerImpl</span>
	                        .fetchDepositWithdrawlSinglaRetailer(reqBean,
	                                connection);
<span class="nc" id="L808">	                olaDeposit = respBean.getMrpDepositAmt();</span>
<span class="nc" id="L809">	                olaWithdrawal = respBean.getMrpWithdrawalAmt();</span>
<span class="nc" id="L810">	                netDeposit = respBean.getNetDepositAmt();</span>
<span class="nc" id="L811">	                netWdrwl = respBean.getNetWithdrawalAmt();</span>
<span class="nc" id="L812">	                bean.setOlaDeposit(Double.toString(netDeposit));</span>
<span class="nc" id="L813">	                bean.setOlaWithdrawal(Double.toString(netWdrwl));</span>
	            }

<span class="nc bnc" id="L816" title="All 2 branches missed.">	            if (ReportUtility.isSLE) {</span>
<span class="nc" id="L817">	                ResultSet rs = null;</span>

<span class="nc" id="L819">	                double netSaleTemp = 0.0;</span>
<span class="nc" id="L820">	                double netRefTemp = 0.0;</span>
<span class="nc" id="L821">	                double mrpSaleTemp = 0.0;</span>
<span class="nc" id="L822">	                double mrpRefTemp = 0.0;</span>

	                // sleSaleQuery =
	                // &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.retailer_net_amt),0) as netSale from (select transaction_id, mrp_amt, retailer_net_amt from st_sle_ret_sale where retailer_org_id = ? )uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;
	                // sleSaleRefQuery =
	                // &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.retailer_net_amt),0)as netRef from (select transaction_id, mrp_amt, retailer_net_amt from st_sle_ret_sale_refund where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;
	                // slePwtQuery =
	                // &quot;select ifnull(sum(uni.mrpPwt),0)as mrpPwt, ifnull(sum(uni.net_amt),0)as netPwt from (select transaction_id, pwt_amt as mrpPwt,(pwt_amt+retailer_claim_comm)as  net_amt from st_sle_ret_pwt where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;

<span class="nc" id="L831">	                sleSaleQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpSale, ifnull(sum(retailer_net_amt),0) as netSale from st_sle_ret_sale where retailer_org_id = ? and transaction_date&gt;=? and transaction_date&lt;=?&quot;;</span>
<span class="nc" id="L832">	                sleSaleRefQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpRef, ifnull(sum(retailer_net_amt),0)as netRef from st_sle_ret_sale_refund where retailer_org_id = ? and transaction_date&gt;=? and transaction_date&lt;=?&quot;;</span>
<span class="nc" id="L833">	                slePwtQuery = &quot;select ifnull(sum(pwt_amt),0)as mrpPwt, ifnull(sum(pwt_amt+retailer_claim_comm),0)as netPwt from st_sle_ret_pwt where retailer_org_id = ? and transaction_date&gt;=? and transaction_date&lt;=?&quot;;</span>

<span class="nc" id="L835">	                pstmt = connection.prepareStatement(sleSaleQuery);</span>
<span class="nc" id="L836">	                pstmt.setInt(1, orgId);</span>
<span class="nc" id="L837">	                pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L838">	                pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L839">	                logger.debug(&quot;SLESaleQuery - &quot; + pstmt);</span>
<span class="nc" id="L840">	                rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L841" title="All 2 branches missed.">	                if (rs.next()) {</span>
<span class="nc" id="L842">	                    netSaleTemp = rs.getDouble(&quot;netSale&quot;);</span>
<span class="nc" id="L843">	                    mrpSaleTemp = rs.getDouble(&quot;mrpSale&quot;);</span>
	                }

<span class="nc" id="L846">	                pstmt = connection.prepareStatement(sleSaleRefQuery);</span>
<span class="nc" id="L847">	                pstmt.setInt(1, orgId);</span>
<span class="nc" id="L848">	                pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L849">	                pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L850">	                logger.debug(&quot;SLERefundQuery - &quot; + pstmt);</span>
<span class="nc" id="L851">	                rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L852" title="All 2 branches missed.">	                if (rs.next()) {</span>
<span class="nc" id="L853">	                    netRefTemp = rs.getDouble(&quot;netRef&quot;);</span>
<span class="nc" id="L854">	                    mrpRefTemp = rs.getDouble(&quot;mrpRef&quot;);</span>
	                }

<span class="nc" id="L857">	                pstmt = connection.prepareStatement(slePwtQuery);</span>
<span class="nc" id="L858">	                pstmt.setInt(1, orgId);</span>
<span class="nc" id="L859">	                pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L860">	                pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L861">	                logger.debug(&quot;SLEPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L862">	                rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L863" title="All 2 branches missed.">	                if (rs.next()) {</span>
<span class="nc" id="L864">	                    netSlePWT = rs.getDouble(&quot;netPwt&quot;);</span>
<span class="nc" id="L865">	                    mrpSlePWT = rs.getDouble(&quot;mrpPwt&quot;);</span>
	                }

<span class="nc" id="L868">	                netSleSale = netSaleTemp - netRefTemp;</span>
<span class="nc" id="L869">	                mrpSleSale = mrpSaleTemp - mrpRefTemp;</span>
	            }
<span class="nc bnc" id="L871" title="All 2 branches missed.">	            if (ReportUtility.isIW) {</span>
<span class="nc" id="L872">	                ResultSet rs = null;</span>

<span class="nc" id="L874">	                double netSaleTemp = 0.0;</span>
<span class="nc" id="L875">	                double netRefTemp = 0.0;</span>
<span class="nc" id="L876">	                double mrpSaleTemp = 0.0;</span>
<span class="nc" id="L877">	                double mrpRefTemp = 0.0;</span>

	                // sleSaleQuery =
	                // &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.retailer_net_amt),0) as netSale from (select transaction_id, mrp_amt, retailer_net_amt from st_sle_ret_sale where retailer_org_id = ? )uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;
	                // sleSaleRefQuery =
	                // &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.retailer_net_amt),0)as netRef from (select transaction_id, mrp_amt, retailer_net_amt from st_sle_ret_sale_refund where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;
	                // slePwtQuery =
	                // &quot;select ifnull(sum(uni.mrpPwt),0)as mrpPwt, ifnull(sum(uni.net_amt),0)as netPwt from (select transaction_id, pwt_amt as mrpPwt,(pwt_amt+retailer_claim_comm)as  net_amt from st_sle_ret_pwt where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;

<span class="nc" id="L886">	                iwSaleQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpSale, ifnull(sum(retailer_net_amt),0) as netSale from st_iw_ret_sale where retailer_org_id = ? and transaction_date&gt;=? and transaction_date&lt;=?&quot;;</span>
<span class="nc" id="L887">	                iwSaleRefQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpRef, ifnull(sum(retailer_net_amt),0)as netRef from st_iw_ret_sale_refund where retailer_org_id = ? and transaction_date&gt;=? and transaction_date&lt;=?&quot;;</span>
<span class="nc" id="L888">	                iwPwtQuery = &quot;select ifnull(sum(pwt_amt),0)as mrpPwt, ifnull(sum(pwt_amt+retailer_claim_comm),0)as netPwt from st_iw_ret_pwt where retailer_org_id = ? and transaction_date&gt;=? and transaction_date&lt;=?&quot;;</span>

<span class="nc" id="L890">	                pstmt = connection.prepareStatement(iwSaleQuery);</span>
<span class="nc" id="L891">	                pstmt.setInt(1, orgId);</span>
<span class="nc" id="L892">	                pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L893">	                pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L894">	                logger.debug(&quot;IWSaleQuery - &quot; + pstmt);</span>
<span class="nc" id="L895">	                rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L896" title="All 2 branches missed.">	                if (rs.next()) {</span>
<span class="nc" id="L897">	                    netSaleTemp = rs.getDouble(&quot;netSale&quot;);</span>
<span class="nc" id="L898">	                    mrpSaleTemp = rs.getDouble(&quot;mrpSale&quot;);</span>
	                }

<span class="nc" id="L901">	                pstmt = connection.prepareStatement(iwSaleRefQuery);</span>
<span class="nc" id="L902">	                pstmt.setInt(1, orgId);</span>
<span class="nc" id="L903">	                pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L904">	                pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L905">	                logger.debug(&quot;IWRefundQuery - &quot; + pstmt);</span>
<span class="nc" id="L906">	                rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L907" title="All 2 branches missed.">	                if (rs.next()) {</span>
<span class="nc" id="L908">	                    netRefTemp = rs.getDouble(&quot;netRef&quot;);</span>
<span class="nc" id="L909">	                    mrpRefTemp = rs.getDouble(&quot;mrpRef&quot;);</span>
	                }

<span class="nc" id="L912">	                pstmt = connection.prepareStatement(iwPwtQuery);</span>
<span class="nc" id="L913">	                pstmt.setInt(1, orgId);</span>
<span class="nc" id="L914">	                pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L915">	                pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L916">	                logger.debug(&quot;IWPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L917">	                rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L918" title="All 2 branches missed.">	                if (rs.next()) {</span>
<span class="nc" id="L919">	                    netIwPWT = rs.getDouble(&quot;netPwt&quot;);</span>
<span class="nc" id="L920">	                    mrpIwPWT = rs.getDouble(&quot;mrpPwt&quot;);</span>
	                }

<span class="nc" id="L923">	                netIwSale = netSaleTemp - netRefTemp;</span>
<span class="nc" id="L924">	                mrpIwSale = mrpSaleTemp - mrpRefTemp;</span>
	            }

<span class="nc" id="L927">	            pstmt = connection.prepareStatement(paymentQuery);</span>
<span class="nc" id="L928">	            pstmt.setInt(1, orgId);</span>
<span class="nc" id="L929">	            pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L930">	            pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L931">	            pstmt.setInt(4, orgId);</span>
<span class="nc" id="L932">	            pstmt.setTimestamp(5, dBean.getStartTime());</span>
<span class="nc" id="L933">	            pstmt.setTimestamp(6, dBean.getEndTime());</span>
<span class="nc" id="L934">	            pstmt.setInt(7, orgId);</span>
<span class="nc" id="L935">	            pstmt.setTimestamp(8, dBean.getStartTime());</span>
<span class="nc" id="L936">	            pstmt.setTimestamp(9, dBean.getEndTime());</span>
<span class="nc" id="L937">	            pstmt.setInt(10, orgId);</span>
<span class="nc" id="L938">	            pstmt.setTimestamp(11, dBean.getStartTime());</span>
<span class="nc" id="L939">	            pstmt.setTimestamp(12, dBean.getEndTime());</span>
<span class="nc" id="L940">	            pstmt.setInt(13, orgId);</span>
<span class="nc" id="L941">	            pstmt.setTimestamp(14, dBean.getStartTime());</span>
<span class="nc" id="L942">	            pstmt.setTimestamp(15, dBean.getEndTime());</span>
<span class="nc" id="L943">	            pstmt.setInt(16, orgId);</span>
<span class="nc" id="L944">	            pstmt.setTimestamp(17, dBean.getStartTime());</span>
<span class="nc" id="L945">	            pstmt.setTimestamp(18, dBean.getEndTime());</span>
<span class="nc" id="L946">	            logger.debug(&quot;paymentQuery:- &quot; + pstmt);</span>
<span class="nc" id="L947">	            rs8 = pstmt.executeQuery();</span>

<span class="nc" id="L949">	            double netSale = 0.0;</span>
<span class="nc" id="L950">	            double mrpSale = 0.0;</span>
<span class="nc" id="L951">	            double netPwt = 0.0;</span>
<span class="nc" id="L952">	            double mrpPwt = 0.0;</span>
<span class="nc" id="L953">	            double netPurchase = 0.0;</span>
<span class="nc" id="L954">	            double mrpPurchase = 0.0;</span>
<span class="nc" id="L955">	            double netPayment = 0.0;</span>
<span class="nc" id="L956">	            double scratchSale = 0.0;</span>
<span class="nc" id="L957">	            double opBal = 0.0;</span>
<span class="nc" id="L958">	            double cashCol = 0.0;</span>
<span class="nc" id="L959">	            double profit = 0.0;</span>

<span class="nc bnc" id="L961" title="All 6 branches missed.">	            if (rs1 != null &amp;&amp; rs2 != null &amp;&amp; rs3 != null) {</span>
<span class="nc" id="L962">	                rs1.next();</span>
<span class="nc" id="L963">	                rs2.next();</span>
<span class="nc" id="L964">	                rs3.next();</span>
<span class="nc" id="L965">	                netSale = rs1.getDouble(&quot;netSale&quot;) - rs2.getDouble(&quot;netRef&quot;);</span>
<span class="nc" id="L966">	                mrpSale = rs1.getDouble(&quot;mrpSale&quot;) - rs2.getDouble(&quot;mrpRef&quot;);</span>
<span class="nc" id="L967">	                netPwt = rs3.getDouble(&quot;netPwt&quot;);</span>
<span class="nc" id="L968">	                mrpPwt = rs3.getDouble(&quot;mrpPwt&quot;);</span>
	            }
<span class="nc bnc" id="L970" title="All 8 branches missed.">	            if (rs4 != null &amp;&amp; rs5 != null &amp;&amp; rs6 != null &amp;&amp; rs7 != null) {</span>
<span class="nc" id="L971">	                rs4.next();</span>
<span class="nc" id="L972">	                rs5.next();</span>
<span class="nc" id="L973">	                rs6.next();</span>
<span class="nc" id="L974">	                rs7.next();</span>
<span class="nc" id="L975">	                netPurchase = rs4.getDouble(&quot;netPur&quot;)</span>
	                        - rs5.getDouble(&quot;netSaleRet&quot;);
<span class="nc" id="L977">	                mrpPurchase = rs4.getDouble(&quot;mrpPur&quot;)</span>
	                        - rs5.getDouble(&quot;mrpSaleRet&quot;);
<span class="nc" id="L979">	                netPwt += rs6.getDouble(&quot;net_amt&quot;);</span>
<span class="nc" id="L980">	                mrpPwt += rs6.getDouble(&quot;mrpPwt&quot;);</span>
<span class="nc" id="L981">	                scratchSale = rs7.getDouble(&quot;soldTicketPrice&quot;);</span>
	            }
<span class="nc" id="L983">	            rs8.next();</span>
<span class="nc" id="L984">	            netPayment = rs8.getDouble(&quot;cashAmt&quot;) + rs8.getDouble(&quot;chqAmt&quot;) + rs8.getDouble(&quot;crnAmt&quot;) + rs8.getDouble(&quot;bankDepoAmt&quot;) - rs8.getDouble(&quot;chqBounce&quot;) - rs8.getDouble(&quot;dbnAmt&quot;);</span>

<span class="nc" id="L986">	            opBal = netPayment + netPwt - netPurchase - netSale - netSaleCS</span>
	                    + netWdrwl - netDeposit + netSlePWT - netSleSale + netIwPWT
	                    - netIwSale;
<span class="nc" id="L989">	            cashCol = -netPayment - mrpPwt - olaWithdrawal + mrpSale</span>
	                    + scratchSale + mrpSaleCS + olaDeposit - mrpSlePWT
	                    + mrpSleSale - mrpIwPWT + mrpIwSale;
<span class="nc" id="L992">	            profit = mrpPurchase - netPurchase + mrpSale - netSale + mrpPwt</span>
	                    - netPwt + mrpSaleCS - netSaleCS + olaDeposit - netDeposit
	                    + (olaWithdrawal - netWdrwl) + mrpSleSale - netSleSale
	                    + mrpSlePWT - netSlePWT + mrpIwSale - netIwSale + mrpIwPWT
	                    - netIwPWT;

<span class="nc" id="L998">	            AjaxRequestHelper ajxHelper = new AjaxRequestHelper();</span>
<span class="nc" id="L999">	            ajxHelper.getAvlblCreditAmt(userBean, connection);</span>
<span class="nc" id="L1000">	            double bal = userBean.getAvailableCreditLimit()</span>
	                    - userBean.getClaimableBal();
<span class="nc" id="L1002">	            String balance = Util.getBalInString(bal);</span>
<span class="nc" id="L1003">	            bean.setBalance(balance);</span>
<span class="nc" id="L1004">	            bean.setOpenBal(String.valueOf(openingbal));</span>
<span class="nc" id="L1005">	            bean.setClrBal(openingbal - opBal + &quot;&quot;);</span>
<span class="nc" id="L1006">	            bean.setPurchase(netPurchase + &quot;&quot;);</span>
	            // bean.setNetPwt(netPwt + &quot;&quot;);
	            // bean.setNetsale(netSale + &quot;&quot;);
<span class="nc" id="L1009">	            bean.setNetPwt(netPwt + &quot;&quot;);</span>
<span class="nc" id="L1010">	            bean.setNetsale(netSale + &quot;&quot;);</span>
<span class="nc" id="L1011">	            bean.setNetSaleRefund(&quot;&quot;);</span>
<span class="nc" id="L1012">	            bean.setNetPayment(netPayment + &quot;&quot;);</span>
<span class="nc" id="L1013">	            bean.setScratchSale(scratchSale + &quot;&quot;);</span>
<span class="nc" id="L1014">	            bean.setCashCol(cashCol + &quot;&quot;);</span>
<span class="nc" id="L1015">	            bean.setProfit(profit + &quot;&quot;);</span>
<span class="nc" id="L1016">	            bean.setNetSaleCS(netSaleCS + &quot;&quot;);</span>

<span class="nc" id="L1018">	            bean.setSleSale(netSleSale + &quot;&quot;);</span>
<span class="nc" id="L1019">	            bean.setSlePwt(netSlePWT + &quot;&quot;);</span>
<span class="nc" id="L1020">	            bean.setVsSale(0.0+&quot;&quot;);</span>
<span class="nc" id="L1021">	            bean.setVsPwt(0.0+&quot;&quot;);</span>

<span class="nc" id="L1023">	            bean.setIwSale(netIwSale + &quot;&quot;);</span>
<span class="nc" id="L1024">	            bean.setIwPwt(netIwPWT + &quot;&quot;);</span>

<span class="nc" id="L1026">	            return bean;</span>
<span class="nc" id="L1027">	        } catch (Exception e) {</span>
<span class="nc" id="L1028">	            e.printStackTrace();</span>
	        } finally {
<span class="nc" id="L1030">	            try {</span>

<span class="nc" id="L1032">	                System.out.println(&quot; closing connection  &quot;);</span>
<span class="nc bnc" id="L1033" title="All 6 branches missed.">	                if (connection != null) {</span>
<span class="nc" id="L1034">	                    connection.close();</span>
	                }
<span class="nc" id="L1036">	            } catch (SQLException e) {</span>
	                // TODO Auto-generated catch block
<span class="nc" id="L1038">	                e.printStackTrace();</span>
<span class="nc" id="L1039">	            }</span>

<span class="nc" id="L1041">	        }</span>
<span class="nc" id="L1042">	        return bean;</span>
	    }
	 
	public DailyLedgerBean getRetLegderDetailClXclInc(Timestamp deployDate,
			DateBeans dBean, UserInfoBean userBean,
			ReportStatusBean reportStatusBean) throws LMSException {

<span class="nc" id="L1049">		Connection connection = null;</span>
<span class="nc" id="L1050">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1051">		ResultSet rs = null;</span>

<span class="nc" id="L1053">		int orgId = 0;</span>
<span class="nc" id="L1054">		double netSale = 0.0;</span>
<span class="nc" id="L1055">		double mrpSale = 0.0;</span>
<span class="nc" id="L1056">		double netPwt = 0.0;</span>
<span class="nc" id="L1057">		double mrpPwt = 0.0;</span>
<span class="nc" id="L1058">		double netPurchase = 0.0;</span>
<span class="nc" id="L1059">		double mrpPurchase = 0.0;</span>
<span class="nc" id="L1060">		double netPayment = 0.0;</span>
<span class="nc" id="L1061">		double scratchSale = 0.0;</span>
<span class="nc" id="L1062">		double netSaleCS = 0.0;</span>
<span class="nc" id="L1063">		double mrpSaleCS = 0.0;</span>
<span class="nc" id="L1064">		double netSleSale = 0.0;</span>
<span class="nc" id="L1065">		double mrpSleSale = 0.0;</span>
<span class="nc" id="L1066">		double netSlePWT = 0.0;</span>
<span class="nc" id="L1067">		double mrpSlePWT = 0.0;</span>
		
<span class="nc" id="L1069">		double netIwSale = 0.0;</span>
<span class="nc" id="L1070">		double mrpIwSale = 0.0;</span>
<span class="nc" id="L1071">		double netIwPWT = 0.0;</span>
<span class="nc" id="L1072">		double mrpIwPWT = 0.0;</span>
		
<span class="nc" id="L1074">		double netVsSale = 0.0;</span>
<span class="nc" id="L1075">		double mrpVsSale = 0.0;</span>
<span class="nc" id="L1076">		double netVsPWT = 0.0;</span>
<span class="nc" id="L1077">		double mrpVsPWT = 0.0;</span>

<span class="nc" id="L1079">		DailyLedgerBean bean = null;</span>
		try {
<span class="nc bnc" id="L1081" title="All 4 branches missed.">			if (&quot;NO&quot;.equals(Utility.getPropertyValue(&quot;IS_DATA_FROM_REPLICA&quot;))</span>
					|| &quot;MAIN_DB&quot;.equals(reportStatusBean.getReportingFrom()))
<span class="nc" id="L1083">				connection = DBConnect.getConnection();</span>
			else
<span class="nc" id="L1085">				connection = DBConnectReplica.getConnection();</span>

<span class="nc" id="L1087">			orgId = userBean.getUserOrgId();</span>

<span class="nc" id="L1089">			double openingbal = new RetailerOpeningBalanceHelper()</span>
					.getRetailerOpeningBalIncludingCLXCL(deployDate, dBean
							.getStartTime(), userBean.getUserOrgId(), userBean
							.getParentOrgId(), connection);
<span class="nc" id="L1093">			System.out.println(&quot;openingbal - &quot; + openingbal);</span>
			// double openingbal = 800;

<span class="nc bnc" id="L1096" title="All 2 branches missed.">			if (ServicesBean.isDG()) {</span>
<span class="nc" id="L1097">				double netSaleTemp = 0.0;</span>
<span class="nc" id="L1098">				double netRefTemp = 0.0;</span>
<span class="nc" id="L1099">				double mrpSaleTemp = 0.0;</span>
<span class="nc" id="L1100">				double mrpRefTemp = 0.0;</span>

				// List&lt;Integer&gt; gameNumList = Util.getGameNumberList();
<span class="nc" id="L1103">				List&lt;Integer&gt; gameNumList = Util.getLMSGameNumberList();</span>

<span class="nc" id="L1105">				StringBuilder drawSaleQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L1106">				StringBuilder drawSaleRefQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L1107">				StringBuilder drawPwtQueryBuilder = new StringBuilder();</span>

<span class="nc bnc" id="L1109" title="All 2 branches missed.">				for (int i = 0; i &lt; gameNumList.size(); i++) {</span>
<span class="nc" id="L1110">					drawSaleQueryBuilder</span>
							.append(&quot;select transaction_id, mrp_amt, net_amt from st_dg_ret_sale_&quot;
									+ gameNumList.get(i)
									+ &quot; where retailer_org_id = ? union &quot;);
<span class="nc" id="L1114">					drawSaleRefQueryBuilder</span>
							.append(&quot;select transaction_id, mrp_amt, net_amt from st_dg_ret_sale_refund_&quot;
									+ gameNumList.get(i)
									+ &quot; where retailer_org_id = ? union &quot;);
<span class="nc" id="L1118">					drawPwtQueryBuilder</span>
							.append(&quot;select transaction_id, pwt_amt as mrpPwt,(pwt_amt+retailer_claim_comm-govt_claim_comm)as  net_amt from st_dg_ret_pwt_&quot;
									+ gameNumList.get(i)
									+ &quot; where retailer_org_id = ? union &quot;);
				}
<span class="nc" id="L1123">				String drawSaleQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.net_amt),0) as netSale from (&quot;</span>
						+ drawSaleQueryBuilder.toString().substring(0,
								drawSaleQueryBuilder.lastIndexOf(&quot; union &quot;))
						+ &quot;)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;
<span class="nc" id="L1127">				String drawSaleRefQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.net_amt),0)as netRef from (&quot;</span>
						+ drawSaleRefQueryBuilder.toString().substring(0,
								drawSaleRefQueryBuilder.lastIndexOf(&quot; union &quot;))
						+ &quot;)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;
<span class="nc" id="L1131">				String drawPwtQuery = &quot;select ifnull(sum(uni.mrpPwt),0)as mrpPwt, ifnull(sum(uni.net_amt),0)as netPwt from (&quot;</span>
						+ drawPwtQueryBuilder.toString().substring(0,
								drawPwtQueryBuilder.lastIndexOf(&quot; union &quot;))
						+ &quot;)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;

<span class="nc" id="L1136">				pstmt = connection.prepareStatement(drawSaleQuery);</span>
<span class="nc" id="L1137">				int i = 0;</span>
<span class="nc bnc" id="L1138" title="All 2 branches missed.">				for (i = 1; i &lt;= gameNumList.size(); i++) {</span>
<span class="nc" id="L1139">					pstmt.setInt(i, orgId);</span>
				}
<span class="nc" id="L1141">				pstmt.setTimestamp(i, dBean.getStartTime());</span>
<span class="nc" id="L1142">				pstmt.setTimestamp(i + 1, dBean.getEndTime());</span>
<span class="nc" id="L1143">				logger.debug(&quot;DrawSaleQuery - &quot; + pstmt);</span>
<span class="nc" id="L1144">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1145" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1146">					netSaleTemp = rs.getDouble(&quot;netSale&quot;);</span>
<span class="nc" id="L1147">					mrpSaleTemp = rs.getDouble(&quot;mrpSale&quot;);</span>
				}

<span class="nc" id="L1150">				pstmt = connection.prepareStatement(drawSaleRefQuery);</span>
<span class="nc bnc" id="L1151" title="All 2 branches missed.">				for (i = 1; i &lt;= gameNumList.size(); i++) {</span>
<span class="nc" id="L1152">					pstmt.setInt(i, orgId);</span>
				}
<span class="nc" id="L1154">				pstmt.setTimestamp(i, dBean.getStartTime());</span>
<span class="nc" id="L1155">				pstmt.setTimestamp(i + 1, dBean.getEndTime());</span>
<span class="nc" id="L1156">				logger.debug(&quot;DrawSaleRefundQuery - &quot; + pstmt);</span>
<span class="nc" id="L1157">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1158" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1159">					netRefTemp = rs.getDouble(&quot;netRef&quot;);</span>
<span class="nc" id="L1160">					mrpRefTemp = rs.getDouble(&quot;mrpRef&quot;);</span>
				}

<span class="nc" id="L1163">				pstmt = connection.prepareStatement(drawPwtQuery);</span>
<span class="nc bnc" id="L1164" title="All 2 branches missed.">				for (i = 1; i &lt;= gameNumList.size(); i++) {</span>
<span class="nc" id="L1165">					pstmt.setInt(i, orgId);</span>
				}
<span class="nc" id="L1167">				pstmt.setTimestamp(i, dBean.getStartTime());</span>
<span class="nc" id="L1168">				pstmt.setTimestamp(i + 1, dBean.getEndTime());</span>
<span class="nc" id="L1169">				logger.debug(&quot;DrawPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L1170">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1171" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1172">					netPwt = rs.getDouble(&quot;netPwt&quot;);</span>
<span class="nc" id="L1173">					mrpPwt = rs.getDouble(&quot;mrpPwt&quot;);</span>
				}

<span class="nc" id="L1176">				netSale = netSaleTemp - netRefTemp;</span>
<span class="nc" id="L1177">				mrpSale = mrpSaleTemp - mrpRefTemp;</span>
			}
<span class="nc bnc" id="L1179" title="All 2 branches missed.">			if (ServicesBean.isSE()) {</span>
<span class="nc" id="L1180">				double netPurTemp = 0.0;</span>
<span class="nc" id="L1181">				double netSaleRetTemp = 0.0;</span>
<span class="nc" id="L1182">				double mrpPurTemp = 0.0;</span>
<span class="nc" id="L1183">				double mrpSaleRetTemp = 0.0;</span>

<span class="nc" id="L1185">				String scratchPurchaseQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpPur, ifnull(sum(net_amt),0)as netPur from st_se_agent_retailer_transaction sart, st_lms_agent_transaction_master atm where sart.transaction_type='SALE' and sart.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and sart.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L1186">				String scratchSaleRetQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpSaleRet, ifnull(sum(net_amt),0)as netSaleRet from st_se_agent_retailer_transaction sart, st_lms_retailer_transaction_master atm where sart.transaction_type='SALE_RET' and sart.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and sart.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L1187">				String scratchPwtQuery = &quot;select ifnull(sum(pwt_amt),0) as mrpPwt, ifnull(sum(pwt_amt*(1+claim_comm*0.01)),0)as  net_amt from st_se_retailer_pwt srp, st_lms_retailer_transaction_master atm where srp.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and srp.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L1188">				String scratchSaleQuery = &quot;select ifnull(sum(cnt.ticket_count*unit.ticket_price),0)as soldTicketPrice from (select game_id, ifnull(sum(sold_tickets),0) as ticket_count from st_se_game_ticket_inv_history where current_owner='RETAILER' and current_owner_id = ? and date(date)=? group by game_id)cnt, (select game_id, ticket_price from st_se_game_master)unit where cnt.game_id = unit.game_id&quot;;</span>

<span class="nc" id="L1190">				pstmt = connection.prepareStatement(scratchPurchaseQuery);</span>
<span class="nc" id="L1191">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L1192">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1193">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1194">				logger.debug(&quot;ScratchPurchaseQuery - &quot; + pstmt);</span>
<span class="nc" id="L1195">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1196" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1197">					netPurTemp = rs.getDouble(&quot;netPur&quot;);</span>
<span class="nc" id="L1198">					mrpPurTemp = rs.getDouble(&quot;mrpPur&quot;);</span>
				}

<span class="nc" id="L1201">				pstmt = connection.prepareStatement(scratchSaleRetQuery);</span>
<span class="nc" id="L1202">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L1203">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1204">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1205">				logger.debug(&quot;ScratchSaleRetQuery - &quot; + pstmt);</span>
<span class="nc" id="L1206">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1207" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1208">					netSaleRetTemp = rs.getDouble(&quot;netSaleRet&quot;);</span>
<span class="nc" id="L1209">					mrpSaleRetTemp = rs.getDouble(&quot;mrpSaleRet&quot;);</span>
				}

<span class="nc" id="L1212">				pstmt = connection.prepareStatement(scratchPwtQuery);</span>
<span class="nc" id="L1213">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L1214">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1215">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1216">				logger.debug(&quot;ScratchPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L1217">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1218" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1219">					netPwt += rs.getDouble(&quot;net_amt&quot;);</span>
<span class="nc" id="L1220">					mrpPwt += rs.getDouble(&quot;mrpPwt&quot;);</span>
				}

<span class="nc" id="L1223">				pstmt = connection.prepareStatement(scratchSaleQuery);</span>
<span class="nc" id="L1224">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L1225">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1226">				logger.debug(&quot;scratchSaleQuery:- &quot; + pstmt);</span>
<span class="nc" id="L1227">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1228" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1229">					scratchSale = rs.getDouble(&quot;soldTicketPrice&quot;);</span>
				}

<span class="nc" id="L1232">				netPurchase = netPurTemp - netSaleRetTemp;</span>
<span class="nc" id="L1233">				mrpPurchase = mrpPurTemp - mrpSaleRetTemp;</span>
			}

<span class="nc bnc" id="L1236" title="All 2 branches missed.">			if (ServicesBean.isCS()) {</span>
<span class="nc" id="L1237">				double netSaleTemp = 0.0;</span>
<span class="nc" id="L1238">				double netRefTemp = 0.0;</span>
<span class="nc" id="L1239">				double mrpSaleTemp = 0.0;</span>
<span class="nc" id="L1240">				double mrpRefTemp = 0.0;</span>

<span class="nc" id="L1242">				List&lt;Integer&gt; csGameNumList = CSUtil.fetchCSGameNumList();</span>
<span class="nc" id="L1243">				StringBuilder csSaleQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L1244">				StringBuilder csRefundQueryBuilder = new StringBuilder();</span>

<span class="nc bnc" id="L1246" title="All 2 branches missed.">				for (int j = 0; j &lt; csGameNumList.size(); j++) {</span>
<span class="nc" id="L1247">					csSaleQueryBuilder</span>
							.append(&quot;select transaction_id, mrp_amt, net_amt from st_cs_sale_&quot;
									+ csGameNumList.get(j)
									+ &quot; where retailer_org_id = &quot;
									+ orgId
									+ &quot; union &quot;);
<span class="nc" id="L1253">					csRefundQueryBuilder</span>
							.append(&quot;select transaction_id, mrp_amt, net_amt from st_cs_refund_&quot;
									+ csGameNumList.get(j)
									+ &quot; where retailer_org_id = &quot;
									+ orgId
									+ &quot; union &quot;);
				}

<span class="nc" id="L1261">				String csSaleQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.net_amt),0) as netSale from (&quot;</span>
						+ csSaleQueryBuilder.toString().substring(
								0,
								csSaleQueryBuilder.toString().lastIndexOf(
										&quot; union &quot;))
						+ &quot;)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;

<span class="nc" id="L1268">				String csRefundQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.net_amt),0)as netRef from (&quot;</span>
						+ csRefundQueryBuilder.toString().substring(
								0,
								csRefundQueryBuilder.toString().lastIndexOf(
										&quot; union &quot;))
						+ &quot;)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;

<span class="nc" id="L1275">				pstmt = connection.prepareStatement(csSaleQuery);</span>
<span class="nc" id="L1276">				pstmt.setTimestamp(1, dBean.getStartTime());</span>
<span class="nc" id="L1277">				pstmt.setTimestamp(2, dBean.getEndTime());</span>
<span class="nc" id="L1278">				logger.debug(&quot;CSSaleQuery - &quot; + pstmt);</span>
<span class="nc" id="L1279">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1280" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1281">					netSaleTemp = rs.getDouble(&quot;netSale&quot;);</span>
<span class="nc" id="L1282">					mrpSaleTemp = rs.getDouble(&quot;mrpSale&quot;);</span>
				}

<span class="nc" id="L1285">				pstmt = connection.prepareStatement(csRefundQuery);</span>
<span class="nc" id="L1286">				pstmt.setTimestamp(1, dBean.getStartTime());</span>
<span class="nc" id="L1287">				pstmt.setTimestamp(2, dBean.getEndTime());</span>
<span class="nc" id="L1288">				logger.debug(&quot;CSSaleRefundQuery - &quot; + pstmt);</span>
<span class="nc" id="L1289">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1290" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1291">					netRefTemp = rs.getDouble(&quot;netRef&quot;);</span>
<span class="nc" id="L1292">					mrpRefTemp = rs.getDouble(&quot;mrpRef&quot;);</span>
				}

<span class="nc" id="L1295">				netSaleCS = netSaleTemp - netRefTemp;</span>
<span class="nc" id="L1296">				mrpSaleCS = mrpSaleTemp - mrpRefTemp;</span>
			}

<span class="nc bnc" id="L1299" title="All 2 branches missed.">			if (ServicesBean.isSLE()) {</span>
<span class="nc" id="L1300">				double netSaleTemp = 0.0;</span>
<span class="nc" id="L1301">				double netRefTemp = 0.0;</span>
<span class="nc" id="L1302">				double mrpSaleTemp = 0.0;</span>
<span class="nc" id="L1303">				double mrpRefTemp = 0.0;</span>

<span class="nc" id="L1305">				String sleSaleQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.retailer_net_amt),0) as netSale from (select transaction_id, mrp_amt, retailer_net_amt from st_sle_ret_sale where retailer_org_id = ? )uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L1306">				String sleSaleRefQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.retailer_net_amt),0)as netRef from (select transaction_id, mrp_amt, retailer_net_amt from st_sle_ret_sale_refund where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L1307">				String slePwtQuery = &quot;select ifnull(sum(uni.mrpPwt),0)as mrpPwt, ifnull(sum(uni.net_amt),0)as netPwt from (select transaction_id, pwt_amt as mrpPwt,(pwt_amt+retailer_claim_comm-govt_claim_comm)as  net_amt from st_sle_ret_pwt where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>

<span class="nc" id="L1309">				pstmt = connection.prepareStatement(sleSaleQuery);</span>
<span class="nc" id="L1310">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L1311">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1312">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1313">				logger.debug(&quot;SLESaleQuery - &quot; + pstmt);</span>
<span class="nc" id="L1314">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1315" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1316">					netSaleTemp = rs.getDouble(&quot;netSale&quot;);</span>
<span class="nc" id="L1317">					mrpSaleTemp = rs.getDouble(&quot;mrpSale&quot;);</span>
				}

<span class="nc" id="L1320">				pstmt = connection.prepareStatement(sleSaleRefQuery);</span>
<span class="nc" id="L1321">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L1322">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1323">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1324">				logger.debug(&quot;SLEPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L1325">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1326" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1327">					netRefTemp = rs.getDouble(&quot;netRef&quot;);</span>
<span class="nc" id="L1328">					mrpRefTemp = rs.getDouble(&quot;mrpRef&quot;);</span>
				}

<span class="nc" id="L1331">				pstmt = connection.prepareStatement(slePwtQuery);</span>
<span class="nc" id="L1332">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L1333">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1334">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1335">				logger.debug(&quot;SLEPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L1336">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1337" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1338">					netSlePWT = rs.getDouble(&quot;netPwt&quot;);</span>
<span class="nc" id="L1339">					mrpSlePWT = rs.getDouble(&quot;mrpPwt&quot;);</span>
				}

<span class="nc" id="L1342">				netSleSale = netSaleTemp - netRefTemp;</span>
<span class="nc" id="L1343">				mrpSleSale = mrpSaleTemp - mrpRefTemp;</span>
			}
			
<span class="nc bnc" id="L1346" title="All 2 branches missed.">			if (ServicesBean.isIW()) {</span>
<span class="nc" id="L1347">				double netSaleTemp = 0.0;</span>
<span class="nc" id="L1348">				double netRefTemp = 0.0;</span>
<span class="nc" id="L1349">				double mrpSaleTemp = 0.0;</span>
<span class="nc" id="L1350">				double mrpRefTemp = 0.0;</span>

<span class="nc" id="L1352">				String iwSaleQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.retailer_net_amt),0) as netSale from (select transaction_id, mrp_amt, retailer_net_amt from st_iw_ret_sale where retailer_org_id = ? )uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L1353">				String iwSaleRefQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.retailer_net_amt),0)as netRef from (select transaction_id, mrp_amt, retailer_net_amt from st_iw_ret_sale_refund where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L1354">				String iwPwtQuery = &quot;select ifnull(sum(uni.mrpPwt),0)as mrpPwt, ifnull(sum(uni.net_amt),0)as netPwt from (select transaction_id, pwt_amt as mrpPwt,(pwt_amt+retailer_claim_comm)as  net_amt from st_iw_ret_pwt where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>

<span class="nc" id="L1356">				pstmt = connection.prepareStatement(iwSaleQuery);</span>
<span class="nc" id="L1357">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L1358">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1359">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1360">				logger.debug(&quot;IWSaleQuery - &quot; + pstmt);</span>
<span class="nc" id="L1361">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1362" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1363">					netSaleTemp = rs.getDouble(&quot;netSale&quot;);</span>
<span class="nc" id="L1364">					mrpSaleTemp = rs.getDouble(&quot;mrpSale&quot;);</span>
				}

<span class="nc" id="L1367">				pstmt = connection.prepareStatement(iwSaleRefQuery);</span>
<span class="nc" id="L1368">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L1369">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1370">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1371">				logger.debug(&quot;IWPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L1372">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1373" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1374">					netRefTemp = rs.getDouble(&quot;netRef&quot;);</span>
<span class="nc" id="L1375">					mrpRefTemp = rs.getDouble(&quot;mrpRef&quot;);</span>
				}

<span class="nc" id="L1378">				pstmt = connection.prepareStatement(iwPwtQuery);</span>
<span class="nc" id="L1379">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L1380">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1381">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1382">				logger.debug(&quot;IWPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L1383">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1384" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1385">					netIwPWT = rs.getDouble(&quot;netPwt&quot;);</span>
<span class="nc" id="L1386">					mrpIwPWT = rs.getDouble(&quot;mrpPwt&quot;);</span>
				}

<span class="nc" id="L1389">				netIwSale = netSaleTemp - netRefTemp;</span>
<span class="nc" id="L1390">				mrpIwSale = mrpSaleTemp - mrpRefTemp;</span>
			}

<span class="nc bnc" id="L1393" title="All 2 branches missed.">			if (ServicesBean.isVS()) {</span>
<span class="nc" id="L1394">				double netSaleTemp = 0.0;</span>
<span class="nc" id="L1395">				double netRefTemp = 0.0;</span>
<span class="nc" id="L1396">				double mrpSaleTemp = 0.0;</span>
<span class="nc" id="L1397">				double mrpRefTemp = 0.0;</span>

<span class="nc" id="L1399">				String vsSaleQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.retailer_net_amt),0) as netSale from (select transaction_id, mrp_amt, retailer_net_amt from st_vs_ret_sale where retailer_org_id = ? )uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L1400">				String vsSaleRefQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.retailer_net_amt),0)as netRef from (select transaction_id, mrp_amt, retailer_net_amt from st_vs_ret_sale_refund where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L1401">				String vsPwtQuery = &quot;select ifnull(sum(uni.mrpPwt),0)as mrpPwt, ifnull(sum(uni.net_amt),0)as netPwt from (select transaction_id, pwt_amt as mrpPwt,(pwt_amt+retailer_claim_comm)as  net_amt from st_vs_ret_pwt where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>

<span class="nc" id="L1403">				pstmt = connection.prepareStatement(vsSaleQuery);</span>
<span class="nc" id="L1404">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L1405">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1406">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1407">				logger.debug(&quot;VSSaleQuery - &quot; + pstmt);</span>
<span class="nc" id="L1408">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1409" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1410">					netSaleTemp = rs.getDouble(&quot;netSale&quot;);</span>
<span class="nc" id="L1411">					mrpSaleTemp = rs.getDouble(&quot;mrpSale&quot;);</span>
				}

<span class="nc" id="L1414">				pstmt = connection.prepareStatement(vsSaleRefQuery);</span>
<span class="nc" id="L1415">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L1416">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1417">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1418">				logger.debug(&quot;VSPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L1419">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1420" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1421">					netRefTemp = rs.getDouble(&quot;netRef&quot;);</span>
<span class="nc" id="L1422">					mrpRefTemp = rs.getDouble(&quot;mrpRef&quot;);</span>
				}

<span class="nc" id="L1425">				pstmt = connection.prepareStatement(vsPwtQuery);</span>
<span class="nc" id="L1426">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L1427">				pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1428">				pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1429">				logger.debug(&quot;VSPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L1430">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1431" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1432">					netVsPWT = rs.getDouble(&quot;netPwt&quot;);</span>
<span class="nc" id="L1433">					mrpVsPWT = rs.getDouble(&quot;mrpPwt&quot;);</span>
				}

<span class="nc" id="L1436">				netVsSale = netSaleTemp - netRefTemp;</span>
<span class="nc" id="L1437">				mrpVsSale = mrpSaleTemp - mrpRefTemp;</span>
			}
			
<span class="nc" id="L1440">			String paymentQuery = &quot;select cash.cashAmt, chq.chqAmt, chqboun.chqBounce, dbnote.dbnAmt,crnote.crnAmt from (select ifnull(sum(slact.amount),0)as cashAmt from st_lms_agent_cash_transaction slact, st_lms_agent_transaction_master atm where slact.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and slact.transaction_id = atm.transaction_id)as cash, (select ifnull(sum(cheque_amt),0)as chqAmt from st_lms_agent_sale_chq slasc, st_lms_agent_transaction_master atm where slasc.retailer_org_id = ? and (slasc.transaction_type='CHEQUE' or slasc.transaction_type='CLOSED') and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and slasc.transaction_id = atm.transaction_id)as chq, (select ifnull(sum(cheque_amt),0)as chqBounce from st_lms_agent_sale_chq slasc, st_lms_agent_transaction_master atm where slasc.retailer_org_id = ? and slasc.transaction_type='CHQ_BOUNCE' and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and slasc.transaction_id = atm.transaction_id)as chqboun, (select ifnull(sum(amount),0)as dbnAmt from st_lms_agent_debit_note sladn, st_lms_agent_transaction_master atm where sladn.retailer_org_id = ? and (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and sladn.transaction_id = atm.transaction_id) as dbnote ,&quot;</span>
					+ &quot;(select ifnull(sum(amount),0)as crnAmt from st_lms_agent_credit_note slacn, st_lms_agent_transaction_master atm where slacn.retailer_org_id =  ? and (atm.transaction_date)&gt;= ? and (atm.transaction_date)&lt;= ? and slacn.transaction_id = atm.transaction_id) as crnote&quot;;
<span class="nc" id="L1442">			pstmt = connection.prepareStatement(paymentQuery);</span>
<span class="nc" id="L1443">			pstmt.setInt(1, orgId);</span>
<span class="nc" id="L1444">			pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1445">			pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1446">			pstmt.setInt(4, orgId);</span>
<span class="nc" id="L1447">			pstmt.setTimestamp(5, dBean.getStartTime());</span>
<span class="nc" id="L1448">			pstmt.setTimestamp(6, dBean.getEndTime());</span>
<span class="nc" id="L1449">			pstmt.setInt(7, orgId);</span>
<span class="nc" id="L1450">			pstmt.setTimestamp(8, dBean.getStartTime());</span>
<span class="nc" id="L1451">			pstmt.setTimestamp(9, dBean.getEndTime());</span>
<span class="nc" id="L1452">			pstmt.setInt(10, orgId);</span>
<span class="nc" id="L1453">			pstmt.setTimestamp(11, dBean.getStartTime());</span>
<span class="nc" id="L1454">			pstmt.setTimestamp(12, dBean.getEndTime());</span>
<span class="nc" id="L1455">			pstmt.setInt(13, orgId);</span>
<span class="nc" id="L1456">			pstmt.setTimestamp(14, dBean.getStartTime());</span>
<span class="nc" id="L1457">			pstmt.setTimestamp(15, dBean.getEndTime());</span>
<span class="nc" id="L1458">			logger.debug(&quot;PaymentQuery - &quot; + pstmt);</span>
<span class="nc" id="L1459">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1460" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L1461">				netPayment = rs.getDouble(&quot;cashAmt&quot;) + rs.getDouble(&quot;chqAmt&quot;)</span>
						+ rs.getDouble(&quot;crnAmt&quot;) - rs.getDouble(&quot;chqBounce&quot;)
						- rs.getDouble(&quot;dbnAmt&quot;);
			}

<span class="nc" id="L1466">			double opBal = 0.0;</span>
<span class="nc" id="L1467">			double cashCol = 0.0;</span>
<span class="nc" id="L1468">			double profit = 0.0;</span>

<span class="nc" id="L1470">			double clXclAmount = 0.0;</span>
<span class="nc" id="L1471">			pstmt = connection</span>
					.prepareStatement(&quot;SELECT IFNULL(SUM(amount),0.0) AS amount FROM st_lms_cl_xcl_update_history WHERE organization_id=? AND date_time&gt;=? AND date_time&lt;?;&quot;);
<span class="nc" id="L1473">			pstmt.setInt(1, orgId);</span>
<span class="nc" id="L1474">			pstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1475">			pstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1476">			logger.debug(&quot;ClXcl Statement - &quot; + pstmt);</span>
<span class="nc" id="L1477">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1478" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1479">				clXclAmount = rs.getDouble(&quot;amount&quot;);</span>
			}

<span class="nc" id="L1482">			opBal = netPayment + netPwt + netSlePWT + netIwPWT + netVsPWT - netPurchase - netSale</span>
					- netSaleCS - netSleSale - netIwSale  - netVsSale;
<span class="nc" id="L1484">			cashCol = -netPayment - mrpPwt - mrpSlePWT - mrpIwPWT - mrpVsPWT + mrpSale + scratchSale</span>
					+ mrpSaleCS + mrpSleSale + mrpIwSale + mrpVsSale;
<span class="nc" id="L1486">			profit = mrpPurchase - netPurchase + mrpSale - netSale + mrpPwt</span>
					- netPwt + mrpSaleCS - netSaleCS + mrpSleSale + mrpIwSale
					+ mrpVsSale - netSleSale - netIwSale - netVsSale + mrpSlePWT + mrpIwPWT + mrpVsPWT - netSlePWT - netIwPWT - netVsPWT;

<span class="nc" id="L1490">			AjaxRequestHelper ajxHelper = new AjaxRequestHelper();</span>
<span class="nc" id="L1491">			ajxHelper.getAvlblCreditAmt(userBean, connection);</span>
<span class="nc" id="L1492">			double bal = userBean.getAvailableCreditLimit()</span>
					- userBean.getClaimableBal();
<span class="nc" id="L1494">			String balance = Util.getBalInString(bal);</span>

<span class="nc" id="L1496">			bean = new DailyLedgerBean();</span>
<span class="nc" id="L1497">			bean.setOpenBal(String.valueOf(openingbal));</span>
<span class="nc" id="L1498">			bean.setClrBal(String.valueOf(openingbal + opBal + clXclAmount));</span>
<span class="nc" id="L1499">			bean.setPurchase(String.valueOf(netPurchase));</span>
<span class="nc" id="L1500">			bean.setNetPwt(String.valueOf(netPwt));</span>
<span class="nc" id="L1501">			bean.setNetsale(String.valueOf(netSale));</span>
<span class="nc" id="L1502">			bean.setNetSaleRefund(&quot;&quot;);</span>
<span class="nc" id="L1503">			bean.setNetPayment(String.valueOf(netPayment));</span>
<span class="nc" id="L1504">			bean.setScratchSale(String.valueOf(scratchSale));</span>
<span class="nc" id="L1505">			bean.setCashCol(String.valueOf(cashCol));</span>
<span class="nc" id="L1506">			bean.setProfit(String.valueOf(profit));</span>
<span class="nc" id="L1507">			bean.setNetSaleCS(String.valueOf(netSaleCS));</span>
<span class="nc" id="L1508">			bean.setClXclAmount(String.valueOf(clXclAmount));</span>
<span class="nc" id="L1509">			bean.setBalance(balance);</span>

<span class="nc" id="L1511">			bean.setSleSale(String.valueOf(netSleSale));</span>
<span class="nc" id="L1512">			bean.setSlePwt(String.valueOf(netSlePWT));</span>
			
<span class="nc" id="L1514">			bean.setIwSale(String.valueOf(netIwSale));</span>
<span class="nc" id="L1515">			bean.setIwPwt(String.valueOf(netIwPWT));</span>
			
<span class="nc" id="L1517">			bean.setVsSale(String.valueOf(netVsSale));</span>
<span class="nc" id="L1518">			bean.setVsPwt(String.valueOf(netVsPWT));</span>
<span class="nc" id="L1519">		} catch (SQLException se) {</span>
<span class="nc" id="L1520">			logger.error(&quot;Exception&quot;, se);</span>
<span class="nc" id="L1521">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE,</span>
					LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);
<span class="nc" id="L1523">		} catch (Exception e) {</span>
<span class="nc" id="L1524">			logger.error(&quot;Exception&quot;, e);</span>
<span class="nc" id="L1525">			throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE,</span>
					LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);
		} finally {
<span class="nc" id="L1528">			DBConnect.closeConnection(connection, pstmt, rs);</span>
<span class="nc" id="L1529">		}</span>

<span class="nc" id="L1531">		return bean;</span>
	}

	public String getRetName(int OrgId) {

<span class="nc" id="L1536">		Connection connection = DBConnect.getConnection();</span>
<span class="nc" id="L1537">		String retName = &quot;&quot;;</span>
<span class="nc" id="L1538">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1539">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L1541">			String appendOrder = QueryManager.getAppendOrgOrder();</span>
<span class="nc" id="L1542">			String agtOrgQry = &quot;select name orgCode,organization_id from st_lms_organization_master where  organization_id = ? and organization_type=?  order by &quot;</span>
					+ appendOrder;
<span class="nc bnc" id="L1544" title="All 2 branches missed.">			if ((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;CODE&quot;)) {</span>

<span class="nc" id="L1546">				agtOrgQry = &quot;select org_code orgCode,organization_id from st_lms_organization_master where  organization_id = ? and organization_type=?  order by &quot;</span>
						+ appendOrder;

<span class="nc bnc" id="L1549" title="All 2 branches missed.">			} else if ((LMSFilterDispatcher.orgFieldType)</span>
					.equalsIgnoreCase(&quot;CODE_NAME&quot;)) {

<span class="nc" id="L1552">				agtOrgQry = &quot;select concat(org_code,'_',name) orgCode,organization_id from st_lms_organization_master where  organization_id = ? and organization_type=?  order by &quot;</span>
						+ appendOrder;

<span class="nc bnc" id="L1555" title="All 2 branches missed.">			} else if ((LMSFilterDispatcher.orgFieldType)</span>
					.equalsIgnoreCase(&quot;NAME_CODE&quot;)) {
<span class="nc" id="L1557">				agtOrgQry = &quot;select concat(name,'_',org_code) orgCode,organization_id from st_lms_organization_master where  organization_id = ? and organization_type=?  order by &quot;</span>
						+ appendOrder;

			}

<span class="nc" id="L1562">			pstmt = connection.prepareStatement(agtOrgQry);</span>
<span class="nc" id="L1563">			pstmt.setInt(1, OrgId);</span>
<span class="nc" id="L1564">			pstmt.setString(2, &quot;RETAILER&quot;);</span>
<span class="nc" id="L1565">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1566" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1567">				retName = rs.getString(&quot;orgCode&quot;);</span>
			}
<span class="nc" id="L1569">		} catch (SQLException e) {</span>
<span class="nc" id="L1570">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1572">			try {</span>

<span class="nc" id="L1574">				System.out.println(&quot; closing connection  &quot;);</span>
<span class="nc bnc" id="L1575" title="All 6 branches missed.">				if (connection != null) {</span>
<span class="nc" id="L1576">					connection.close();</span>
				}
<span class="nc" id="L1578">			} catch (SQLException e) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L1580">				e.printStackTrace();</span>
<span class="nc" id="L1581">			}</span>
<span class="nc" id="L1582">		}</span>
<span class="nc" id="L1583">		return retName;</span>
	}

	public static synchronized  Map&lt;String, List&lt;Map&lt;String, Double&gt;&gt;&gt; retDailyLedgerGameWiseTerminal(
			DateBeans dBean, int retOrgId, ReportStatusBean reportStatusBean) throws Exception {
<span class="nc" id="L1588">		Map&lt;String, List&lt;Map&lt;String, Double&gt;&gt;&gt; dataMap = new HashMap&lt;String, List&lt;Map&lt;String, Double&gt;&gt;&gt;();</span>

<span class="nc" id="L1590">		List&lt;Map&lt;String, Double&gt;&gt; dgDataList = new ArrayList&lt;Map&lt;String, Double&gt;&gt;();</span>
<span class="nc" id="L1591">		List&lt;Map&lt;String, Double&gt;&gt; sleDataList = new ArrayList&lt;Map&lt;String, Double&gt;&gt;();</span>
<span class="nc" id="L1592">		List&lt;Map&lt;String, Double&gt;&gt; iwDataList = new ArrayList&lt;Map&lt;String, Double&gt;&gt;();</span>
<span class="nc" id="L1593">		List&lt;Map&lt;String, Double&gt;&gt; vsDataList = new ArrayList&lt;Map&lt;String, Double&gt;&gt;();</span>
<span class="nc" id="L1594">		List&lt;Map&lt;String, Double&gt;&gt; seDataList = new ArrayList&lt;Map&lt;String, Double&gt;&gt;();</span>

<span class="nc" id="L1596">		Connection connection = null;</span>

		try {
//			connection = DBConnect.getConnection();
<span class="nc bnc" id="L1600" title="All 4 branches missed.">			if (&quot;NO&quot;.equals(Utility.getPropertyValue(&quot;IS_DATA_FROM_REPLICA&quot;)) || &quot;MAIN_DB&quot;.equals(reportStatusBean.getReportingFrom()))</span>
<span class="nc" id="L1601">			connection = DBConnect.getConnection();</span>
			else
<span class="nc" id="L1603">				connection = DBConnectReplica.getConnection();</span>
			
<span class="nc" id="L1605">			PreparedStatement pstmt = null;</span>
<span class="nc" id="L1606">			ResultSet rs1 = null, rs2 = null, rs3 = null, rs_2 = null, rs4 = null, rs5 = null;</span>

			// 1#14:00:00_16:00:00~2#00:00:00_00:00:00

			// String saleSlotTimeString =
			// Utility.getPropertyValue(&quot;SALE_SLOT_TIME&quot;);
<span class="nc" id="L1612">			SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>

<span class="nc" id="L1614">			String saleSlotTimeString = new TrainingExpAgentHelper()</span>
					.getPropertyValue(connection, sdf.format(dBean
							.getStartTime().getTime()));
<span class="nc" id="L1617">			String[] gameWiseTimingArr = saleSlotTimeString.split(&quot;~&quot;);</span>
<span class="nc" id="L1618">			Map&lt;Integer, String&gt; gameSlotTimingMap = new HashMap&lt;Integer, String&gt;();</span>
<span class="nc bnc" id="L1619" title="All 2 branches missed.">			for (String gameWiseTiming : gameWiseTimingArr) {</span>
<span class="nc" id="L1620">				int gameId = Integer.parseInt(gameWiseTiming.split(&quot;#&quot;)[0]);</span>
<span class="nc" id="L1621">				String timeString = gameWiseTiming.split(&quot;#&quot;)[1];</span>
<span class="nc bnc" id="L1622" title="All 2 branches missed.">				if (!&quot;00:00:00_00:00:00&quot;.equals(timeString)) {</span>
<span class="nc" id="L1623">					gameSlotTimingMap.put(gameId, timeString);</span>
				}
			}

			// Thisis hard coded check becuase onw to twellve game is added in
			// LMS but WGRL does not wants to display it in retailer reports
<span class="nc" id="L1629">			String activeGamesQry = &quot;select game_id, game_name from st_dg_game_master where game_status = 'OPEN' and game_name_dev&lt;&gt;'OneToTwelve'&quot;;</span>
<span class="nc" id="L1630">			pstmt = connection.prepareStatement(activeGamesQry);</span>
<span class="nc" id="L1631">			rs1 = pstmt.executeQuery();</span>

<span class="nc" id="L1633">			String saleQuery = &quot;SELECT IFNULL(SUM(mrp_amt),0) mrpSale, IFNULL(SUM(net_amt),0) netSale FROM st_dg_ret_sale_? rs INNER JOIN st_lms_retailer_transaction_master rtm ON rs.transaction_id=rtm.transaction_id &quot;</span>
					+ &quot;AND transaction_date&gt;=? AND transaction_date&lt;=? AND transaction_type IN ('DG_SALE','DG_SALE_OFFLINE') AND rs.retailer_org_id=?;&quot;;
<span class="nc" id="L1635">			String saleRetQuery = &quot;SELECT IFNULL(SUM(mrp_amt),0) mrpSaleRef, IFNULL(SUM(net_amt),0) netSaleRef FROM st_dg_ret_sale_refund_? rsr INNER JOIN st_lms_retailer_transaction_master rtm ON rsr.transaction_id=rtm.transaction_id &quot;</span>
					+ &quot;AND transaction_date&gt;=? AND transaction_date&lt;=? AND transaction_type IN ('DG_REFUND_CANCEL','DG_REFUND_FAILED') AND rsr.retailer_org_id=?;&quot;;
<span class="nc" id="L1637">			String pwtQuery = &quot;SELECT IFNULL(SUM(pwt_amt),0)AS mrpPwt, IFNULL(SUM(pwt_amt+retailer_claim_comm-govt_claim_comm),0)AS netPwt FROM st_dg_ret_pwt_? rp INNER JOIN st_lms_retailer_transaction_master rtm ON rp.transaction_id=rtm.transaction_id &quot;</span>
					+ &quot;AND transaction_date&gt;=? AND transaction_date&lt;=? AND transaction_type IN ('DG_PWT','DG_PWT_AUTO') AND rp.retailer_org_id=?;&quot;;

			/*
			 * String saleSlotQuery =
			 * &quot;SELECT IFNULL(SUM(mrp_amt),0) mrpAmt, IFNULL(SUM(net_amt),0) netAmt FROM st_dg_ret_sale_? rs INNER JOIN st_lms_retailer_transaction_master rtm ON rs.transaction_id=rtm.transaction_id &quot;
			 * +
			 * &quot;WHERE transaction_type IN('DG_SALE','DG_SALE_OFFLINE') AND transaction_date&gt;=? AND transaction_date&gt;=? AND transaction_date&lt;=? AND transaction_date&lt;=? AND rs.retailer_org_id=? &quot;
			 * +
			 * &quot;AND rs.transaction_id NOT IN (SELECT ref_transaction_id FROM st_dg_ret_sale_refund_? refund INNER JOIN  st_lms_retailer_transaction_master rtm ON refund.transaction_id=rtm.transaction_id WHERE transaction_type IN('DG_REFUND_CANCEL','DG_REFUND_FAILED') &quot;
			 * +
			 * &quot;AND transaction_date&gt;=? AND transaction_date&lt;=?  and refund.retailer_org_id=?);&quot;
			 * ;
			 */

<span class="nc" id="L1652">			String saleSlotQuery = &quot; SELECT IFNULL(SUM(mrp_amt),0) mrpAmt, IFNULL(SUM(net_amt),0) netAmt  FROM st_dg_ret_sale_? rs INNER JOIN st_lms_retailer_transaction_master rtm ON rs.transaction_id=rtm.transaction_id &quot;</span>
					+ &quot; left join (SELECT ref_transaction_id FROM st_dg_ret_sale_refund_? refund INNER JOIN  st_lms_retailer_transaction_master rtm ON refund.transaction_id=rtm.transaction_id WHERE transaction_type IN('DG_REFUND_CANCEL','DG_REFUND_FAILED') AND transaction_date&gt;=? AND transaction_date&lt;=? and refund.retailer_org_id=?)ref on ref.ref_transaction_id=rs.transaction_id WHERE transaction_type IN('DG_SALE','DG_SALE_OFFLINE') AND transaction_date&gt;=? AND transaction_date&gt;=? AND transaction_date&lt;=? AND transaction_date&lt;=? AND rs.retailer_org_id=? AND ref.ref_transaction_id is null &quot;;

<span class="nc" id="L1655">			PreparedStatement slotPstmt = connection</span>
					.prepareStatement(saleSlotQuery);
<span class="nc" id="L1657">			PreparedStatement salePstmt = connection</span>
					.prepareStatement(saleQuery);
<span class="nc" id="L1659">			PreparedStatement saleReturnPstmt = connection</span>
					.prepareStatement(saleRetQuery);
<span class="nc" id="L1661">			PreparedStatement pwtPstmt = connection.prepareStatement(pwtQuery);</span>
<span class="nc" id="L1662">			SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>

<span class="nc bnc" id="L1664" title="All 2 branches missed.">			while (rs1.next()) {</span>
<span class="nc" id="L1665">				int gameId = rs1.getInt(&quot;game_id&quot;);</span>
				/*
				 * String saleQuery =
				 * &quot;select ifnull(sum(mrp_amt),0)mrpSale, ifnull(sum(net_amt),0)netSale from st_dg_ret_sale_&quot;
				 * + rs1.getInt(&quot;game_id&quot;) +
				 * &quot; where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date&gt;=? and transaction_date&lt;=? and transaction_type in ('DG_SALE','DG_SALE_OFFLINE')) and retailer_org_id = ?&quot;
				 * ; String saleRetQuery =
				 * &quot;select ifnull(sum(mrp_amt),0)mrpSaleRef, ifnull(sum(net_amt),0)netSaleRef from st_dg_ret_sale_refund_&quot;
				 * + rs1.getInt(&quot;game_id&quot;) +
				 * &quot; where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date&gt;=? and transaction_date&lt;=? and transaction_type in ('DG_REFUND_CANCEL','DG_REFUND_FAILED')) and retailer_org_id = ?&quot;
				 * ; String pwtQuery =
				 * &quot;select ifnull(sum(pwt_amt),0)as mrpPwt, ifnull(sum(pwt_amt+retailer_claim_comm),0)as netPwt from st_dg_ret_pwt_&quot;
				 * + rs1.getInt(&quot;game_id&quot;) +
				 * &quot; where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date &gt;=? and transaction_date&lt;=? and transaction_type in ('DG_PWT','DG_PWT_AUTO')) and retailer_org_id = ?&quot;
				 * ; String saleSlotQuery =
				 * &quot;SELECT IFNULL(SUM(mrp_amt),0) mrpAmt, IFNULL(SUM(net_amt),0) netAmt FROM st_dg_ret_sale_&quot;
				 * + rs1.getInt(&quot;game_id&quot;) +
				 * &quot; WHERE transaction_id IN (SELECT transaction_id FROM st_lms_retailer_transaction_master WHERE transaction_type IN('DG_SALE','DG_SALE_OFFLINE') AND transaction_date&gt;=? AND transaction_date&lt;=?&quot;
				 * +
				 * &quot; AND retailer_org_id=? AND transaction_id NOT IN(select ref_transaction_id from st_dg_ret_sale_refund_&quot;
				 * +rs1.getInt(&quot;game_id&quot;)+
				 * &quot; refund inner join  st_lms_retailer_transaction_master rtm on refund.transaction_id=rtm.transaction_id where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;=?));&quot;
				 * ;
				 */

<span class="nc" id="L1690">				String slotTiming = gameSlotTimingMap.get(gameId);</span>
<span class="nc bnc" id="L1691" title="All 2 branches missed.">				if (slotTiming != null) {</span>
					// SimpleDateFormat simpleDateFormat = new
					// SimpleDateFormat(&quot;HH:mm:ss&quot;);
					// simpleDateFormat.setTimeZone(TimeZone.getTimeZone(&quot;UTC&quot;));
					// long startTimeSlot =
					// simpleDateFormat.parse(slotTiming.split(&quot;_&quot;)[0]).getTime();
					// long endTimeSlot =
					// simpleDateFormat.parse(slotTiming.split(&quot;_&quot;)[1]).getTime();

					/*
					 * pstmt = connection.prepareStatement(saleQuery);
					 * pstmt.setTimestamp(1, new
					 * Timestamp(dBean.getStartTime().getTime()+startTimeSlot));
					 * pstmt.setTimestamp(2, new
					 * Timestamp(dBean.getStartTime().getTime()+endTimeSlot));
					 * pstmt.setInt(3, retOrgId); logger.debug(&quot;SaleSlot Qry: &quot;
					 * + pstmt); rs_2 = pstmt.executeQuery();
					 * 
					 * pstmt = connection.prepareStatement(saleRetQuery);
					 * pstmt.setTimestamp(1, new
					 * Timestamp(dBean.getStartTime().getTime()+startTimeSlot));
					 * pstmt.setTimestamp(2, new
					 * Timestamp(dBean.getStartTime().getTime()+endTimeSlot));
					 * pstmt.setInt(3, retOrgId);
					 * logger.debug(&quot;SaleReturnSlot Qry: &quot; + pstmt); rs_3 =
					 * pstmt.executeQuery();
					 */

					// SimpleDateFormat timeFormat = new
					// SimpleDateFormat(&quot;HH:mm:ss&quot;);

<span class="nc" id="L1722">					String startDate = dateFormat.format(dBean.getStartTime()</span>
							.getTime());
					/*
					 * String startTime =
					 * timeFormat.format(dBean.getStartTime().getTime()); String
					 * endDate =
					 * dateFormat.format(dBean.getEndTime().getTime()); String
					 * endTime =
					 * timeFormat.format(dBean.getEndTime().getTime());
					 */
<span class="nc" id="L1732">					String slotStartTime = slotTiming.split(&quot;_&quot;)[0];</span>
<span class="nc" id="L1733">					String slotEndTime = slotTiming.split(&quot;_&quot;)[1];</span>

<span class="nc" id="L1735">					slotPstmt.setInt(1, gameId);</span>
<span class="nc" id="L1736">					slotPstmt.setInt(2, gameId);</span>
<span class="nc" id="L1737">					slotPstmt.setTimestamp(3, dBean.getStartTime());</span>
<span class="nc" id="L1738">					slotPstmt.setTimestamp(4, dBean.getEndTime());</span>
<span class="nc" id="L1739">					slotPstmt.setInt(5, retOrgId);</span>
<span class="nc" id="L1740">					slotPstmt.setTimestamp(6, dBean.getStartTime());</span>
<span class="nc" id="L1741">					slotPstmt.setString(7, startDate + &quot; &quot; + slotStartTime);</span>
<span class="nc" id="L1742">					slotPstmt.setTimestamp(8, dBean.getEndTime());</span>
<span class="nc" id="L1743">					slotPstmt.setString(9, startDate + &quot; &quot; + slotEndTime);</span>
<span class="nc" id="L1744">					slotPstmt.setInt(10, retOrgId);</span>

<span class="nc" id="L1746">					logger.info(&quot;SaleSlot Qry: &quot; + slotPstmt);</span>
<span class="nc" id="L1747">					rs_2 = slotPstmt.executeQuery();</span>
				}

<span class="nc" id="L1750">				salePstmt.setInt(1, gameId);</span>
<span class="nc" id="L1751">				salePstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1752">				salePstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1753">				salePstmt.setInt(4, retOrgId);</span>
<span class="nc" id="L1754">				logger.debug(&quot;Sale Qry: &quot; + salePstmt);</span>
<span class="nc" id="L1755">				rs2 = salePstmt.executeQuery();</span>

<span class="nc" id="L1757">				saleReturnPstmt.setInt(1, gameId);</span>
<span class="nc" id="L1758">				saleReturnPstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1759">				saleReturnPstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1760">				saleReturnPstmt.setInt(4, retOrgId);</span>
<span class="nc" id="L1761">				logger.debug(&quot;SaleReturn Qry: &quot; + saleReturnPstmt);</span>
<span class="nc" id="L1762">				rs3 = saleReturnPstmt.executeQuery();</span>

<span class="nc" id="L1764">				pwtPstmt.setInt(1, gameId);</span>
<span class="nc" id="L1765">				pwtPstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L1766">				pwtPstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L1767">				pwtPstmt.setInt(4, retOrgId);</span>
<span class="nc" id="L1768">				logger.debug(&quot;PWT Qry: &quot; + pwtPstmt);</span>
<span class="nc" id="L1769">				rs4 = pwtPstmt.executeQuery();</span>

<span class="nc" id="L1771">				Map&lt;String, Double&gt; dgDataMap = new HashMap&lt;String, Double&gt;();</span>
<span class="nc" id="L1772">				dgDataMap.put(&quot;gameId&quot;, rs1.getDouble(&quot;game_id&quot;));</span>
<span class="nc" id="L1773">				dgDataMap.put(&quot;name&quot; + rs1.getString(&quot;game_name&quot;), 0.0);</span>

<span class="nc bnc" id="L1775" title="All 2 branches missed.">				if (rs_2 != null) {</span>
<span class="nc bnc" id="L1776" title="All 2 branches missed.">					while (rs_2.next()) {</span>
<span class="nc" id="L1777">						dgDataMap.put(&quot;mrpSaleSlot&quot;, rs_2.getDouble(&quot;mrpAmt&quot;));</span>
<span class="nc" id="L1778">						dgDataMap.put(&quot;netSaleSlot&quot;, rs_2.getDouble(&quot;netAmt&quot;));</span>
					}
				}
<span class="nc bnc" id="L1781" title="All 2 branches missed.">				while (rs2.next()) {</span>
<span class="nc bnc" id="L1782" title="All 2 branches missed.">					if (rs3.next()) {</span>
<span class="nc" id="L1783">						dgDataMap.put(&quot;mrpSale&quot;, rs2.getDouble(&quot;mrpSale&quot;)</span>
								- rs3.getDouble(&quot;mrpSaleRef&quot;));
<span class="nc" id="L1785">						dgDataMap.put(&quot;netSale&quot;, rs2.getDouble(&quot;netSale&quot;)</span>
								- rs3.getDouble(&quot;netSaleRef&quot;));
					} else {
<span class="nc" id="L1788">						dgDataMap.put(&quot;mrpSale&quot;, rs2.getDouble(&quot;mrp_amt&quot;));</span>
<span class="nc" id="L1789">						dgDataMap.put(&quot;netSale&quot;, rs2.getDouble(&quot;net_amt&quot;));</span>
					}
				}
<span class="nc bnc" id="L1792" title="All 2 branches missed.">				while (rs4.next()) {</span>
<span class="nc" id="L1793">					dgDataMap.put(&quot;mrpPwt&quot;, rs4.getDouble(&quot;mrpPwt&quot;));</span>
<span class="nc" id="L1794">					dgDataMap.put(&quot;netPwt&quot;, rs4.getDouble(&quot;netPwt&quot;));</span>
				}
<span class="nc" id="L1796">				dgDataList.add(dgDataMap);</span>
<span class="nc" id="L1797">				logger.debug(&quot;game Wise Report Map &quot; + dgDataMap);</span>
<span class="nc" id="L1798">			}</span>
<span class="nc" id="L1799">			dataMap.put(&quot;DG&quot;, dgDataList);</span>

<span class="nc bnc" id="L1801" title="All 2 branches missed.">			if (ServicesBean.isSLE()) {</span>

<span class="nc" id="L1803">				String sleActiveGamesQry = &quot;select game_id, game_disp_name from st_sle_game_master where game_status = 'SALE_OPEN'&quot;;</span>
<span class="nc" id="L1804">				pstmt = connection.prepareStatement(sleActiveGamesQry);</span>
<span class="nc" id="L1805">				rs1 = pstmt.executeQuery();</span>

<span class="nc" id="L1807">				String sleSaleQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.retailer_net_amt),0) as netSale from (select transaction_id, mrp_amt, retailer_net_amt from st_sle_ret_sale where retailer_org_id = ? AND game_id=?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L1808">				String sleSaleRefQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.retailer_net_amt),0)as netRef from (select transaction_id, mrp_amt, retailer_net_amt from st_sle_ret_sale_refund where retailer_org_id = ? AND game_id=?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L1809">				String slePwtQuery = &quot;select ifnull(sum(uni.mrpPwt),0)as mrpPwt, ifnull(sum(uni.net_amt),0)as netPwt from (select transaction_id, pwt_amt as mrpPwt,(pwt_amt+retailer_claim_comm-govt_claim_comm)as  net_amt from st_sle_ret_pwt where retailer_org_id = ? AND game_id=?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>

<span class="nc" id="L1811">				PreparedStatement sleSalePstmt = connection</span>
						.prepareStatement(sleSaleQuery);
<span class="nc" id="L1813">				PreparedStatement sleSaleReturnPstmt = connection</span>
						.prepareStatement(sleSaleRefQuery);
<span class="nc" id="L1815">				PreparedStatement slePwtPstmt = connection</span>
						.prepareStatement(slePwtQuery);

<span class="nc bnc" id="L1818" title="All 2 branches missed.">				while (rs1.next()) {</span>
<span class="nc" id="L1819">					int gameId = rs1.getInt(&quot;game_id&quot;);</span>

<span class="nc" id="L1821">					sleSalePstmt = connection.prepareStatement(sleSaleQuery);</span>
<span class="nc" id="L1822">					sleSalePstmt.setInt(1, retOrgId);</span>
<span class="nc" id="L1823">					sleSalePstmt.setInt(2, gameId);</span>
<span class="nc" id="L1824">					sleSalePstmt.setTimestamp(3, dBean.getStartTime());</span>
<span class="nc" id="L1825">					sleSalePstmt.setTimestamp(4, dBean.getEndTime());</span>
<span class="nc" id="L1826">					rs2 = sleSalePstmt.executeQuery();</span>

<span class="nc" id="L1828">					sleSaleReturnPstmt = connection</span>
							.prepareStatement(sleSaleRefQuery);
<span class="nc" id="L1830">					sleSaleReturnPstmt.setInt(1, retOrgId);</span>
<span class="nc" id="L1831">					sleSaleReturnPstmt.setInt(2, gameId);</span>
<span class="nc" id="L1832">					sleSaleReturnPstmt.setTimestamp(3, dBean.getStartTime());</span>
<span class="nc" id="L1833">					sleSaleReturnPstmt.setTimestamp(4, dBean.getEndTime());</span>
<span class="nc" id="L1834">					rs3 = sleSaleReturnPstmt.executeQuery();</span>

<span class="nc" id="L1836">					slePwtPstmt = connection.prepareStatement(slePwtQuery);</span>
<span class="nc" id="L1837">					slePwtPstmt.setInt(1, retOrgId);</span>
<span class="nc" id="L1838">					slePwtPstmt.setInt(2, gameId);</span>
<span class="nc" id="L1839">					slePwtPstmt.setTimestamp(3, dBean.getStartTime());</span>
<span class="nc" id="L1840">					slePwtPstmt.setTimestamp(4, dBean.getEndTime());</span>
<span class="nc" id="L1841">					rs4 = slePwtPstmt.executeQuery();</span>

<span class="nc" id="L1843">					Map&lt;String, Double&gt; sleDataMap = new HashMap&lt;String, Double&gt;();</span>

<span class="nc" id="L1845">					sleDataMap.put(&quot;gameId&quot;, rs1.getDouble(&quot;game_id&quot;));</span>
<span class="nc" id="L1846">					sleDataMap.put(&quot;name&quot; + rs1.getString(&quot;game_disp_name&quot;),</span>
							0.0);

<span class="nc bnc" id="L1849" title="All 2 branches missed.">					if (rs2.next()) {</span>
<span class="nc bnc" id="L1850" title="All 2 branches missed.">						if (rs3.next()) {</span>
<span class="nc" id="L1851">							sleDataMap.put(&quot;mrpSale&quot;, rs2.getDouble(&quot;mrpSale&quot;)</span>
									- rs3.getDouble(&quot;mrpRef&quot;));
<span class="nc" id="L1853">							sleDataMap.put(&quot;netSale&quot;, rs2.getDouble(&quot;netSale&quot;)</span>
									- rs3.getDouble(&quot;netRef&quot;));
						} else {
<span class="nc" id="L1856">							sleDataMap.put(&quot;mrpSale&quot;, rs3.getDouble(&quot;mrpSale&quot;));</span>
<span class="nc" id="L1857">							sleDataMap.put(&quot;netSale&quot;, rs3.getDouble(&quot;netSale&quot;));</span>
						}
					}

<span class="nc bnc" id="L1861" title="All 2 branches missed.">					if (rs4.next()) {</span>
<span class="nc" id="L1862">						sleDataMap.put(&quot;mrpPwt&quot;, rs4.getDouble(&quot;mrpPwt&quot;));</span>
<span class="nc" id="L1863">						sleDataMap.put(&quot;netPwt&quot;, rs4.getDouble(&quot;netPwt&quot;));</span>
					}
<span class="nc" id="L1865">					logger.debug(&quot;SLE Report Map &quot; + sleDataMap);</span>
<span class="nc" id="L1866">					sleDataList.add(sleDataMap);</span>
<span class="nc" id="L1867">				}</span>

			}

<span class="nc" id="L1871">			dataMap.put(&quot;SLE&quot;, sleDataList);</span>
<span class="nc bnc" id="L1872" title="All 2 branches missed.">			if (ServicesBean.isIW()) {</span>

<span class="nc" id="L1874">				String iwActiveGamesQry = &quot;select game_id, game_disp_name from st_iw_game_master where game_status = 'SALE_OPEN'&quot;;</span>
<span class="nc" id="L1875">				pstmt = connection.prepareStatement(iwActiveGamesQry);</span>
<span class="nc" id="L1876">				rs1 = pstmt.executeQuery();</span>

<span class="nc" id="L1878">				String iwSaleQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.retailer_net_amt),0) as netSale from (select transaction_id, mrp_amt, retailer_net_amt from st_iw_ret_sale where retailer_org_id = ? AND game_id=?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L1879">				String iwSaleRefQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.retailer_net_amt),0)as netRef from (select transaction_id, mrp_amt, retailer_net_amt from st_iw_ret_sale_refund where retailer_org_id = ? AND game_id=?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L1880">				String iwPwtQuery = &quot;select ifnull(sum(uni.mrpPwt),0)as mrpPwt, ifnull(sum(uni.net_amt),0)as netPwt from (select transaction_id, pwt_amt as mrpPwt,(pwt_amt+retailer_claim_comm)as  net_amt from st_iw_ret_pwt where retailer_org_id = ? AND game_id=?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>

<span class="nc" id="L1882">				PreparedStatement iwSalePstmt = connection</span>
						.prepareStatement(iwSaleQuery);
<span class="nc" id="L1884">				PreparedStatement iwSaleReturnPstmt = connection</span>
						.prepareStatement(iwSaleRefQuery);
<span class="nc" id="L1886">				PreparedStatement iwPwtPstmt = connection</span>
						.prepareStatement(iwPwtQuery);

<span class="nc bnc" id="L1889" title="All 2 branches missed.">				while (rs1.next()) {</span>
<span class="nc" id="L1890">					int gameId = rs1.getInt(&quot;game_id&quot;);</span>

<span class="nc" id="L1892">					iwSalePstmt = connection.prepareStatement(iwSaleQuery);</span>
<span class="nc" id="L1893">					iwSalePstmt.setInt(1, retOrgId);</span>
<span class="nc" id="L1894">					iwSalePstmt.setInt(2, gameId);</span>
<span class="nc" id="L1895">					iwSalePstmt.setTimestamp(3, dBean.getStartTime());</span>
<span class="nc" id="L1896">					iwSalePstmt.setTimestamp(4, dBean.getEndTime());</span>
<span class="nc" id="L1897">					rs2 = iwSalePstmt.executeQuery();</span>

<span class="nc" id="L1899">					iwSaleReturnPstmt = connection</span>
							.prepareStatement(iwSaleRefQuery);
<span class="nc" id="L1901">					iwSaleReturnPstmt.setInt(1, retOrgId);</span>
<span class="nc" id="L1902">					iwSaleReturnPstmt.setInt(2, gameId);</span>
<span class="nc" id="L1903">					iwSaleReturnPstmt.setTimestamp(3, dBean.getStartTime());</span>
<span class="nc" id="L1904">					iwSaleReturnPstmt.setTimestamp(4, dBean.getEndTime());</span>
<span class="nc" id="L1905">					rs3 = iwSaleReturnPstmt.executeQuery();</span>

<span class="nc" id="L1907">					iwPwtPstmt = connection.prepareStatement(iwPwtQuery);</span>
<span class="nc" id="L1908">					iwPwtPstmt.setInt(1, retOrgId);</span>
<span class="nc" id="L1909">					iwPwtPstmt.setInt(2, gameId);</span>
<span class="nc" id="L1910">					iwPwtPstmt.setTimestamp(3, dBean.getStartTime());</span>
<span class="nc" id="L1911">					iwPwtPstmt.setTimestamp(4, dBean.getEndTime());</span>
<span class="nc" id="L1912">					rs4 = iwPwtPstmt.executeQuery();</span>

<span class="nc" id="L1914">					Map&lt;String, Double&gt; iwDataMap = new HashMap&lt;String, Double&gt;();</span>

<span class="nc" id="L1916">					iwDataMap.put(&quot;gameId&quot;, rs1.getDouble(&quot;game_id&quot;));</span>
<span class="nc" id="L1917">					iwDataMap.put(&quot;name&quot; + rs1.getString(&quot;game_disp_name&quot;),</span>
							0.0);

<span class="nc bnc" id="L1920" title="All 2 branches missed.">					if (rs2.next()) {</span>
<span class="nc bnc" id="L1921" title="All 2 branches missed.">						if (rs3.next()) {</span>
<span class="nc" id="L1922">							iwDataMap.put(&quot;mrpSale&quot;, rs2.getDouble(&quot;mrpSale&quot;)</span>
									- rs3.getDouble(&quot;mrpRef&quot;));
<span class="nc" id="L1924">							iwDataMap.put(&quot;netSale&quot;, rs2.getDouble(&quot;netSale&quot;)</span>
									- rs3.getDouble(&quot;netRef&quot;));
						} else {
<span class="nc" id="L1927">							iwDataMap.put(&quot;mrpSale&quot;, rs3.getDouble(&quot;mrpSale&quot;));</span>
<span class="nc" id="L1928">							iwDataMap.put(&quot;netSale&quot;, rs3.getDouble(&quot;netSale&quot;));</span>
						}
					}

<span class="nc bnc" id="L1932" title="All 2 branches missed.">					if (rs4.next()) {</span>
<span class="nc" id="L1933">						iwDataMap.put(&quot;mrpPwt&quot;, rs4.getDouble(&quot;mrpPwt&quot;));</span>
<span class="nc" id="L1934">						iwDataMap.put(&quot;netPwt&quot;, rs4.getDouble(&quot;netPwt&quot;));</span>
					}
<span class="nc" id="L1936">					logger.debug(&quot;IW Report Map &quot; + iwDataMap);</span>
<span class="nc" id="L1937">					iwDataList.add(iwDataMap);</span>
<span class="nc" id="L1938">				}</span>

			}

<span class="nc" id="L1942">			dataMap.put(&quot;IW&quot;, iwDataList);</span>
			
<span class="nc bnc" id="L1944" title="All 2 branches missed.">			if (ServicesBean.isVS()) {</span>
<span class="nc" id="L1945">				String vsActiveGamesQry = &quot;select game_id, game_disp_name from st_vs_game_master where game_status = 'SALE_OPEN'&quot;;</span>
<span class="nc" id="L1946">				pstmt = connection.prepareStatement(vsActiveGamesQry);</span>
<span class="nc" id="L1947">				rs1 = pstmt.executeQuery();</span>

<span class="nc" id="L1949">				String vsSaleQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.retailer_net_amt),0) as netSale from (select transaction_id, mrp_amt, retailer_net_amt from st_vs_ret_sale where retailer_org_id = ? AND game_id=?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L1950">				String vsSaleRefQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.retailer_net_amt),0)as netRef from (select transaction_id, mrp_amt, retailer_net_amt from st_vs_ret_sale_refund where retailer_org_id = ? AND game_id=?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L1951">				String vsPwtQuery = &quot;select ifnull(sum(uni.mrpPwt),0)as mrpPwt, ifnull(sum(uni.net_amt),0)as netPwt from (select transaction_id, pwt_amt as mrpPwt,(pwt_amt+retailer_claim_comm)as  net_amt from st_vs_ret_pwt where retailer_org_id = ? AND game_id=?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>

<span class="nc" id="L1953">				PreparedStatement vsSalePstmt = connection</span>
						.prepareStatement(vsSaleQuery);
<span class="nc" id="L1955">				PreparedStatement vsSaleReturnPstmt = connection</span>
						.prepareStatement(vsSaleRefQuery);
<span class="nc" id="L1957">				PreparedStatement vsPwtPstmt = connection</span>
						.prepareStatement(vsPwtQuery);

<span class="nc bnc" id="L1960" title="All 2 branches missed.">				while (rs1.next()) {</span>
<span class="nc" id="L1961">					int gameId = rs1.getInt(&quot;game_id&quot;);</span>

<span class="nc" id="L1963">					vsSalePstmt = connection.prepareStatement(vsSaleQuery);</span>
<span class="nc" id="L1964">					vsSalePstmt.setInt(1, retOrgId);</span>
<span class="nc" id="L1965">					vsSalePstmt.setInt(2, gameId);</span>
<span class="nc" id="L1966">					vsSalePstmt.setTimestamp(3, dBean.getStartTime());</span>
<span class="nc" id="L1967">					vsSalePstmt.setTimestamp(4, dBean.getEndTime());</span>
<span class="nc" id="L1968">					rs2 = vsSalePstmt.executeQuery();</span>

<span class="nc" id="L1970">					vsSaleReturnPstmt = connection.prepareStatement(vsSaleRefQuery);</span>
<span class="nc" id="L1971">					vsSaleReturnPstmt.setInt(1, retOrgId);</span>
<span class="nc" id="L1972">					vsSaleReturnPstmt.setInt(2, gameId);</span>
<span class="nc" id="L1973">					vsSaleReturnPstmt.setTimestamp(3, dBean.getStartTime());</span>
<span class="nc" id="L1974">					vsSaleReturnPstmt.setTimestamp(4, dBean.getEndTime());</span>
<span class="nc" id="L1975">					rs3 = vsSaleReturnPstmt.executeQuery();</span>

<span class="nc" id="L1977">					vsPwtPstmt = connection.prepareStatement(vsPwtQuery);</span>
<span class="nc" id="L1978">					vsPwtPstmt.setInt(1, retOrgId);</span>
<span class="nc" id="L1979">					vsPwtPstmt.setInt(2, gameId);</span>
<span class="nc" id="L1980">					vsPwtPstmt.setTimestamp(3, dBean.getStartTime());</span>
<span class="nc" id="L1981">					vsPwtPstmt.setTimestamp(4, dBean.getEndTime());</span>
<span class="nc" id="L1982">					rs4 = vsPwtPstmt.executeQuery();</span>

<span class="nc" id="L1984">					Map&lt;String, Double&gt; vsDataMap = new HashMap&lt;String, Double&gt;();</span>

<span class="nc" id="L1986">					vsDataMap.put(&quot;gameId&quot;, rs1.getDouble(&quot;game_id&quot;));</span>
<span class="nc" id="L1987">					vsDataMap.put(&quot;name&quot; + rs1.getString(&quot;game_disp_name&quot;), 0.0);</span>

<span class="nc bnc" id="L1989" title="All 2 branches missed.">					if (rs2.next()) {</span>
<span class="nc bnc" id="L1990" title="All 2 branches missed.">						if (rs3.next()) {</span>
<span class="nc" id="L1991">							vsDataMap.put(&quot;mrpSale&quot;, rs2.getDouble(&quot;mrpSale&quot;) - rs3.getDouble(&quot;mrpRef&quot;));</span>
<span class="nc" id="L1992">							vsDataMap.put(&quot;netSale&quot;, rs2.getDouble(&quot;netSale&quot;) - rs3.getDouble(&quot;netRef&quot;));</span>
						} else {
<span class="nc" id="L1994">							vsDataMap.put(&quot;mrpSale&quot;, rs3.getDouble(&quot;mrpSale&quot;));</span>
<span class="nc" id="L1995">							vsDataMap.put(&quot;netSale&quot;, rs3.getDouble(&quot;netSale&quot;));</span>
						}
					}

<span class="nc bnc" id="L1999" title="All 2 branches missed.">					if (rs4.next()) {</span>
<span class="nc" id="L2000">						vsDataMap.put(&quot;mrpPwt&quot;, rs4.getDouble(&quot;mrpPwt&quot;));</span>
<span class="nc" id="L2001">						vsDataMap.put(&quot;netPwt&quot;, rs4.getDouble(&quot;netPwt&quot;));</span>
					}
<span class="nc" id="L2003">					logger.debug(&quot;VS Report Map &quot; + vsDataMap);</span>
<span class="nc" id="L2004">					vsDataList.add(vsDataMap);</span>
<span class="nc" id="L2005">				}</span>
			}
<span class="nc" id="L2007">			dataMap.put(&quot;VS&quot;, vsDataList);</span>

			// Added code for addition of Scratch data in txn report...
<span class="nc bnc" id="L2010" title="All 2 branches missed.">			if (ServicesBean.isSE()) {</span>
<span class="nc" id="L2011">				String scratchPwtQuery = &quot;select ifnull(sum(pwt_amt),0) as mrpPwt, ifnull(sum(pwt_amt*(1+claim_comm*0.01)),0)as net_amt from st_se_retailer_pwt srp, st_lms_retailer_transaction_master atm where srp.retailer_org_id = ? and date(atm.transaction_date)&gt;=? and date(atm.transaction_date)&lt;? and srp.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L2012">				PreparedStatement scratchPwtPstmt = connection</span>
						.prepareStatement(scratchPwtQuery);
<span class="nc" id="L2014">				scratchPwtPstmt.setInt(1, retOrgId);</span>
<span class="nc" id="L2015">				scratchPwtPstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L2016">				scratchPwtPstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L2017">				logger.debug(&quot;PWT Qry: &quot; + scratchPwtQuery);</span>
<span class="nc" id="L2018">				rs5 = scratchPwtPstmt.executeQuery();</span>

<span class="nc" id="L2020">				Map&lt;String, Double&gt; scratchDataMap = new HashMap&lt;String, Double&gt;();</span>

<span class="nc bnc" id="L2022" title="All 2 branches missed.">				if (rs5.next()) {</span>
<span class="nc" id="L2023">					scratchDataMap</span>
							.put(&quot;scratchMrpPwt&quot;, rs5.getDouble(&quot;mrpPwt&quot;));
<span class="nc" id="L2025">					scratchDataMap.put(&quot;scratchNetPwt&quot;, rs5</span>
							.getDouble(&quot;net_amt&quot;));
				}
<span class="nc" id="L2028">				logger.debug(&quot;Scratch Report Map &quot; + scratchDataMap);</span>
<span class="nc" id="L2029">				seDataList.add(scratchDataMap);</span>
			}
<span class="nc" id="L2031">			dataMap.put(&quot;SE&quot;, seDataList);</span>

			// Addition of Scratch data in txn report ends here...

<span class="nc" id="L2035">			return dataMap;</span>
<span class="nc" id="L2036">		} catch (SQLException e) {</span>
<span class="nc" id="L2037">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L2039">			DBConnect.closeCon(connection);</span>
<span class="nc" id="L2040">		}</span>
<span class="nc" id="L2041">		return dataMap;</span>
	}

	public List&lt;Map&lt;String, Double&gt;&gt; retDailyLedgerGameWise(DateBeans dBean,
			int retOrgId) {
<span class="nc" id="L2046">		List&lt;Map&lt;String, Double&gt;&gt; dataList = new ArrayList&lt;Map&lt;String, Double&gt;&gt;();</span>
<span class="nc" id="L2047">		Connection connection = null;</span>

		try {

<span class="nc" id="L2051">			connection = DBConnect.getConnection();</span>
<span class="nc" id="L2052">			PreparedStatement pstmt = null;</span>
<span class="nc" id="L2053">			ResultSet rs1 = null, rs2 = null, rs3 = null, rs4 = null;</span>

<span class="nc" id="L2055">			String activeGamesQry = &quot;select game_id, game_name from st_dg_game_master where game_status = 'OPEN'&quot;;</span>
<span class="nc" id="L2056">			pstmt = connection.prepareStatement(activeGamesQry);</span>
<span class="nc" id="L2057">			rs1 = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2058" title="All 2 branches missed.">			while (rs1.next()) {</span>
<span class="nc" id="L2059">				String saleQuery = &quot;select ifnull(sum(mrp_amt),0)mrpSale, ifnull(sum(net_amt),0)netSale from st_dg_ret_sale_&quot;</span>
						+ rs1.getString(&quot;game_id&quot;)
						+ &quot; where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where date(transaction_date)&gt;=? and date(transaction_date)&lt;? and transaction_type in ('DG_SALE','DG_SALE_OFFLINE')) and retailer_org_id = ?&quot;;
<span class="nc" id="L2062">				String saleRetQuery = &quot;select ifnull(sum(mrp_amt),0)mrpSaleRef, ifnull(sum(net_amt),0)netSaleRef from st_dg_ret_sale_refund_&quot;</span>
						+ rs1.getString(&quot;game_id&quot;)
						+ &quot; where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where date(transaction_date)&gt;=? and date(transaction_date)&lt;? and transaction_type in ('DG_REFUND_CANCEL','DG_REFUND_FAILED')) and retailer_org_id = ?&quot;;
<span class="nc" id="L2065">				String pwtQuery = &quot;select ifnull(sum(pwt_amt),0)as mrpPwt, ifnull(sum(pwt_amt+retailer_claim_comm),0)as netPwt from st_dg_ret_pwt_&quot;</span>
						+ rs1.getString(&quot;game_id&quot;)
						+ &quot; where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date &gt;=? and transaction_date&lt;? and transaction_type in ('DG_PWT','DG_PWT_AUTO')) and retailer_org_id = ?&quot;;

<span class="nc" id="L2069">				pstmt = connection.prepareStatement(saleQuery);</span>
<span class="nc" id="L2070">				pstmt.setTimestamp(1, dBean.getStartTime());</span>
<span class="nc" id="L2071">				pstmt.setTimestamp(2, dBean.getEndTime());</span>
<span class="nc" id="L2072">				pstmt.setInt(3, retOrgId);</span>
<span class="nc" id="L2073">				logger.debug(&quot;Sale Qry: &quot; + pstmt);</span>
<span class="nc" id="L2074">				rs2 = pstmt.executeQuery();</span>

<span class="nc" id="L2076">				pstmt = connection.prepareStatement(saleRetQuery);</span>
<span class="nc" id="L2077">				pstmt.setTimestamp(1, dBean.getStartTime());</span>
<span class="nc" id="L2078">				pstmt.setTimestamp(2, dBean.getEndTime());</span>
<span class="nc" id="L2079">				pstmt.setInt(3, retOrgId);</span>
<span class="nc" id="L2080">				logger.debug(&quot;SaleReturn Qry: &quot; + pstmt);</span>
<span class="nc" id="L2081">				rs3 = pstmt.executeQuery();</span>

<span class="nc" id="L2083">				pstmt = connection.prepareStatement(pwtQuery);</span>
<span class="nc" id="L2084">				pstmt.setTimestamp(1, dBean.getStartTime());</span>
<span class="nc" id="L2085">				pstmt.setTimestamp(2, dBean.getEndTime());</span>
<span class="nc" id="L2086">				pstmt.setInt(3, retOrgId);</span>
<span class="nc" id="L2087">				logger.debug(&quot;PWT Qry: &quot; + pstmt);</span>
<span class="nc" id="L2088">				rs4 = pstmt.executeQuery();</span>

<span class="nc" id="L2090">				Map&lt;String, Double&gt; dataMap = new HashMap&lt;String, Double&gt;();</span>
<span class="nc" id="L2091">				dataMap.put(&quot;gameId&quot;, rs1.getDouble(&quot;game_id&quot;));</span>
<span class="nc" id="L2092">				dataMap.put(&quot;name&quot; + rs1.getString(&quot;game_name&quot;), 0.0);</span>
<span class="nc bnc" id="L2093" title="All 2 branches missed.">				while (rs2.next()) {</span>
<span class="nc bnc" id="L2094" title="All 2 branches missed.">					if (rs3.next()) {</span>
<span class="nc" id="L2095">						dataMap.put(&quot;mrpSale&quot;, rs2.getDouble(&quot;mrpSale&quot;)</span>
								- rs3.getDouble(&quot;mrpSaleRef&quot;));
<span class="nc" id="L2097">						dataMap.put(&quot;netSale&quot;, rs2.getDouble(&quot;netSale&quot;)</span>
								- rs3.getDouble(&quot;netSaleRef&quot;));
					} else {
<span class="nc" id="L2100">						dataMap.put(&quot;mrpSale&quot;, rs2.getDouble(&quot;mrp_amt&quot;));</span>
<span class="nc" id="L2101">						dataMap.put(&quot;netSale&quot;, rs2.getDouble(&quot;net_amt&quot;));</span>
					}
				}
<span class="nc bnc" id="L2104" title="All 2 branches missed.">				while (rs4.next()) {</span>
<span class="nc" id="L2105">					dataMap.put(&quot;mrpPwt&quot;, rs4.getDouble(&quot;mrpPwt&quot;));</span>
<span class="nc" id="L2106">					dataMap.put(&quot;netPwt&quot;, rs4.getDouble(&quot;netPwt&quot;));</span>
				}
<span class="nc" id="L2108">				logger.debug(&quot;game Wise Report Map &quot; + dataMap);</span>
<span class="nc" id="L2109">				dataList.add(dataMap);</span>
<span class="nc" id="L2110">			}</span>
<span class="nc" id="L2111">			return dataList;</span>
<span class="nc" id="L2112">		} catch (SQLException e) {</span>
<span class="nc" id="L2113">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L2115">			try {</span>

<span class="nc" id="L2117">				System.out.println(&quot; closing connection  &quot;);</span>
<span class="nc bnc" id="L2118" title="All 6 branches missed.">				if (connection != null) {</span>
<span class="nc" id="L2119">					connection.close();</span>
				}
<span class="nc" id="L2121">			} catch (SQLException e) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L2123">				e.printStackTrace();</span>
<span class="nc" id="L2124">			}</span>
<span class="nc" id="L2125">		}</span>
<span class="nc" id="L2126">		return dataList;</span>
	}

	// Change this method as retDailyLedgerGameWiseTerminal if SLE data needs to
	// be added in Web reports...
	public List&lt;Map&lt;String, Double&gt;&gt; retDailyLedgerGameWiseWeb(DateBeans dBean,
			int retOrgId) throws Exception {
<span class="nc" id="L2133">		List&lt;Map&lt;String, Double&gt;&gt; dataList = new ArrayList&lt;Map&lt;String, Double&gt;&gt;();</span>
<span class="nc" id="L2134">		Connection connection = null;</span>

		try {
<span class="nc" id="L2137">			connection = DBConnect.getConnection();</span>
<span class="nc" id="L2138">			PreparedStatement pstmt = null;</span>
<span class="nc" id="L2139">			ResultSet rs1 = null, rs2 = null, rs3 = null, rs_2 = null, rs4 = null, rs5 = null;</span>

			// 1#14:00:00_16:00:00~2#00:00:00_00:00:00

			// String saleSlotTimeString =
			// Utility.getPropertyValue(&quot;SALE_SLOT_TIME&quot;);
<span class="nc" id="L2145">			SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>

<span class="nc" id="L2147">			String saleSlotTimeString = new TrainingExpAgentHelper()</span>
					.getPropertyValue(connection, sdf.format(dBean
							.getStartTime().getTime()));
<span class="nc" id="L2150">			String[] gameWiseTimingArr = saleSlotTimeString.split(&quot;~&quot;);</span>
<span class="nc" id="L2151">			Map&lt;Integer, String&gt; gameSlotTimingMap = new HashMap&lt;Integer, String&gt;();</span>
<span class="nc bnc" id="L2152" title="All 2 branches missed.">			for (String gameWiseTiming : gameWiseTimingArr) {</span>
<span class="nc" id="L2153">				int gameId = Integer.parseInt(gameWiseTiming.split(&quot;#&quot;)[0]);</span>
<span class="nc" id="L2154">				String timeString = gameWiseTiming.split(&quot;#&quot;)[1];</span>
<span class="nc bnc" id="L2155" title="All 2 branches missed.">				if (!&quot;00:00:00_00:00:00&quot;.equals(timeString)) {</span>
<span class="nc" id="L2156">					gameSlotTimingMap.put(gameId, timeString);</span>
				}
			}

			// Thisis hard coded check becuase onw to twellve game is added in
			// LMS but WGRL does not wants to display it in retailer reports
<span class="nc" id="L2162">			String activeGamesQry = &quot;select game_id, game_name from st_dg_game_master where game_status = 'OPEN' and game_name_dev&lt;&gt;'OneToTwelve'&quot;;</span>
<span class="nc" id="L2163">			pstmt = connection.prepareStatement(activeGamesQry);</span>
<span class="nc" id="L2164">			rs1 = pstmt.executeQuery();</span>

<span class="nc" id="L2166">			String saleQuery = &quot;SELECT IFNULL(SUM(mrp_amt),0) mrpSale, IFNULL(SUM(net_amt),0) netSale FROM st_dg_ret_sale_? rs INNER JOIN st_lms_retailer_transaction_master rtm ON rs.transaction_id=rtm.transaction_id &quot;</span>
					+ &quot;AND transaction_date&gt;=? AND transaction_date&lt;=? AND transaction_type IN ('DG_SALE','DG_SALE_OFFLINE') AND rs.retailer_org_id=?;&quot;;
<span class="nc" id="L2168">			String saleRetQuery = &quot;SELECT IFNULL(SUM(mrp_amt),0) mrpSaleRef, IFNULL(SUM(net_amt),0) netSaleRef FROM st_dg_ret_sale_refund_? rsr INNER JOIN st_lms_retailer_transaction_master rtm ON rsr.transaction_id=rtm.transaction_id &quot;</span>
					+ &quot;AND transaction_date&gt;=? AND transaction_date&lt;=? AND transaction_type IN ('DG_REFUND_CANCEL','DG_REFUND_FAILED') AND rsr.retailer_org_id=?;&quot;;
<span class="nc" id="L2170">			String pwtQuery = &quot;SELECT IFNULL(SUM(pwt_amt),0)AS mrpPwt, IFNULL(SUM(pwt_amt+retailer_claim_comm),0)AS netPwt FROM st_dg_ret_pwt_? rp INNER JOIN st_lms_retailer_transaction_master rtm ON rp.transaction_id=rtm.transaction_id &quot;</span>
					+ &quot;AND transaction_date&gt;=? AND transaction_date&lt;=? AND transaction_type IN ('DG_PWT','DG_PWT_AUTO') AND rp.retailer_org_id=?;&quot;;

			/*
			 * String saleSlotQuery =
			 * &quot;SELECT IFNULL(SUM(mrp_amt),0) mrpAmt, IFNULL(SUM(net_amt),0) netAmt FROM st_dg_ret_sale_? rs INNER JOIN st_lms_retailer_transaction_master rtm ON rs.transaction_id=rtm.transaction_id &quot;
			 * +
			 * &quot;WHERE transaction_type IN('DG_SALE','DG_SALE_OFFLINE') AND transaction_date&gt;=? AND transaction_date&gt;=? AND transaction_date&lt;=? AND transaction_date&lt;=? AND rs.retailer_org_id=? &quot;
			 * +
			 * &quot;AND rs.transaction_id NOT IN (SELECT ref_transaction_id FROM st_dg_ret_sale_refund_? refund INNER JOIN  st_lms_retailer_transaction_master rtm ON refund.transaction_id=rtm.transaction_id WHERE transaction_type IN('DG_REFUND_CANCEL','DG_REFUND_FAILED') &quot;
			 * +
			 * &quot;AND transaction_date&gt;=? AND transaction_date&lt;=?  and refund.retailer_org_id=?);&quot;
			 * ;
			 */

<span class="nc" id="L2185">			String saleSlotQuery = &quot; SELECT IFNULL(SUM(mrp_amt),0) mrpAmt, IFNULL(SUM(net_amt),0) netAmt  FROM st_dg_ret_sale_? rs INNER JOIN st_lms_retailer_transaction_master rtm ON rs.transaction_id=rtm.transaction_id &quot;</span>
					+ &quot; left join (SELECT ref_transaction_id FROM st_dg_ret_sale_refund_? refund INNER JOIN  st_lms_retailer_transaction_master rtm ON refund.transaction_id=rtm.transaction_id WHERE transaction_type IN('DG_REFUND_CANCEL','DG_REFUND_FAILED') AND transaction_date&gt;=? AND transaction_date&lt;=? and refund.retailer_org_id=?)ref on ref.ref_transaction_id=rs.transaction_id WHERE transaction_type IN('DG_SALE','DG_SALE_OFFLINE') AND transaction_date&gt;=? AND transaction_date&gt;=? AND transaction_date&lt;=? AND transaction_date&lt;=? AND rs.retailer_org_id=? AND ref.ref_transaction_id is null &quot;;

<span class="nc" id="L2188">			PreparedStatement slotPstmt = connection</span>
					.prepareStatement(saleSlotQuery);
<span class="nc" id="L2190">			PreparedStatement salePstmt = connection</span>
					.prepareStatement(saleQuery);
<span class="nc" id="L2192">			PreparedStatement saleReturnPstmt = connection</span>
					.prepareStatement(saleRetQuery);
<span class="nc" id="L2194">			PreparedStatement pwtPstmt = connection.prepareStatement(pwtQuery);</span>
<span class="nc" id="L2195">			SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>

<span class="nc bnc" id="L2197" title="All 2 branches missed.">			while (rs1.next()) {</span>
<span class="nc" id="L2198">				int gameId = rs1.getInt(&quot;game_id&quot;);</span>
				/*
				 * String saleQuery =
				 * &quot;select ifnull(sum(mrp_amt),0)mrpSale, ifnull(sum(net_amt),0)netSale from st_dg_ret_sale_&quot;
				 * + rs1.getInt(&quot;game_id&quot;) +
				 * &quot; where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date&gt;=? and transaction_date&lt;=? and transaction_type in ('DG_SALE','DG_SALE_OFFLINE')) and retailer_org_id = ?&quot;
				 * ; String saleRetQuery =
				 * &quot;select ifnull(sum(mrp_amt),0)mrpSaleRef, ifnull(sum(net_amt),0)netSaleRef from st_dg_ret_sale_refund_&quot;
				 * + rs1.getInt(&quot;game_id&quot;) +
				 * &quot; where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date&gt;=? and transaction_date&lt;=? and transaction_type in ('DG_REFUND_CANCEL','DG_REFUND_FAILED')) and retailer_org_id = ?&quot;
				 * ; String pwtQuery =
				 * &quot;select ifnull(sum(pwt_amt),0)as mrpPwt, ifnull(sum(pwt_amt+retailer_claim_comm),0)as netPwt from st_dg_ret_pwt_&quot;
				 * + rs1.getInt(&quot;game_id&quot;) +
				 * &quot; where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date &gt;=? and transaction_date&lt;=? and transaction_type in ('DG_PWT','DG_PWT_AUTO')) and retailer_org_id = ?&quot;
				 * ; String saleSlotQuery =
				 * &quot;SELECT IFNULL(SUM(mrp_amt),0) mrpAmt, IFNULL(SUM(net_amt),0) netAmt FROM st_dg_ret_sale_&quot;
				 * + rs1.getInt(&quot;game_id&quot;) +
				 * &quot; WHERE transaction_id IN (SELECT transaction_id FROM st_lms_retailer_transaction_master WHERE transaction_type IN('DG_SALE','DG_SALE_OFFLINE') AND transaction_date&gt;=? AND transaction_date&lt;=?&quot;
				 * +
				 * &quot; AND retailer_org_id=? AND transaction_id NOT IN(select ref_transaction_id from st_dg_ret_sale_refund_&quot;
				 * +rs1.getInt(&quot;game_id&quot;)+
				 * &quot; refund inner join  st_lms_retailer_transaction_master rtm on refund.transaction_id=rtm.transaction_id where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;=?));&quot;
				 * ;
				 */

<span class="nc" id="L2223">				String slotTiming = gameSlotTimingMap.get(gameId);</span>
<span class="nc bnc" id="L2224" title="All 2 branches missed.">				if (slotTiming != null) {</span>
					// SimpleDateFormat simpleDateFormat = new
					// SimpleDateFormat(&quot;HH:mm:ss&quot;);
					// simpleDateFormat.setTimeZone(TimeZone.getTimeZone(&quot;UTC&quot;));
					// long startTimeSlot =
					// simpleDateFormat.parse(slotTiming.split(&quot;_&quot;)[0]).getTime();
					// long endTimeSlot =
					// simpleDateFormat.parse(slotTiming.split(&quot;_&quot;)[1]).getTime();

					/*
					 * pstmt = connection.prepareStatement(saleQuery);
					 * pstmt.setTimestamp(1, new
					 * Timestamp(dBean.getStartTime().getTime()+startTimeSlot));
					 * pstmt.setTimestamp(2, new
					 * Timestamp(dBean.getStartTime().getTime()+endTimeSlot));
					 * pstmt.setInt(3, retOrgId); logger.debug(&quot;SaleSlot Qry: &quot;
					 * + pstmt); rs_2 = pstmt.executeQuery();
					 * 
					 * pstmt = connection.prepareStatement(saleRetQuery);
					 * pstmt.setTimestamp(1, new
					 * Timestamp(dBean.getStartTime().getTime()+startTimeSlot));
					 * pstmt.setTimestamp(2, new
					 * Timestamp(dBean.getStartTime().getTime()+endTimeSlot));
					 * pstmt.setInt(3, retOrgId);
					 * logger.debug(&quot;SaleReturnSlot Qry: &quot; + pstmt); rs_3 =
					 * pstmt.executeQuery();
					 */

					// SimpleDateFormat timeFormat = new
					// SimpleDateFormat(&quot;HH:mm:ss&quot;);

<span class="nc" id="L2255">					String startDate = dateFormat.format(dBean.getStartTime()</span>
							.getTime());
					/*
					 * String startTime =
					 * timeFormat.format(dBean.getStartTime().getTime()); String
					 * endDate =
					 * dateFormat.format(dBean.getEndTime().getTime()); String
					 * endTime =
					 * timeFormat.format(dBean.getEndTime().getTime());
					 */
<span class="nc" id="L2265">					String slotStartTime = slotTiming.split(&quot;_&quot;)[0];</span>
<span class="nc" id="L2266">					String slotEndTime = slotTiming.split(&quot;_&quot;)[1];</span>

<span class="nc" id="L2268">					slotPstmt.setInt(1, gameId);</span>
<span class="nc" id="L2269">					slotPstmt.setInt(2, gameId);</span>
<span class="nc" id="L2270">					slotPstmt.setTimestamp(3, dBean.getStartTime());</span>
<span class="nc" id="L2271">					slotPstmt.setTimestamp(4, dBean.getEndTime());</span>
<span class="nc" id="L2272">					slotPstmt.setInt(5, retOrgId);</span>
<span class="nc" id="L2273">					slotPstmt.setTimestamp(6, dBean.getStartTime());</span>
<span class="nc" id="L2274">					slotPstmt.setString(7, startDate + &quot; &quot; + slotStartTime);</span>
<span class="nc" id="L2275">					slotPstmt.setTimestamp(8, dBean.getEndTime());</span>
<span class="nc" id="L2276">					slotPstmt.setString(9, startDate + &quot; &quot; + slotEndTime);</span>
<span class="nc" id="L2277">					slotPstmt.setInt(10, retOrgId);</span>

<span class="nc" id="L2279">					logger.info(&quot;SaleSlot Qry: &quot; + slotPstmt);</span>
<span class="nc" id="L2280">					rs_2 = slotPstmt.executeQuery();</span>
				}

<span class="nc" id="L2283">				salePstmt.setInt(1, gameId);</span>
<span class="nc" id="L2284">				salePstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L2285">				salePstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L2286">				salePstmt.setInt(4, retOrgId);</span>
<span class="nc" id="L2287">				logger.debug(&quot;Sale Qry: &quot; + salePstmt);</span>
<span class="nc" id="L2288">				rs2 = salePstmt.executeQuery();</span>

<span class="nc" id="L2290">				saleReturnPstmt.setInt(1, gameId);</span>
<span class="nc" id="L2291">				saleReturnPstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L2292">				saleReturnPstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L2293">				saleReturnPstmt.setInt(4, retOrgId);</span>
<span class="nc" id="L2294">				logger.debug(&quot;SaleReturn Qry: &quot; + saleReturnPstmt);</span>
<span class="nc" id="L2295">				rs3 = saleReturnPstmt.executeQuery();</span>

<span class="nc" id="L2297">				pwtPstmt.setInt(1, gameId);</span>
<span class="nc" id="L2298">				pwtPstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L2299">				pwtPstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L2300">				pwtPstmt.setInt(4, retOrgId);</span>
<span class="nc" id="L2301">				logger.debug(&quot;PWT Qry: &quot; + pwtPstmt);</span>
<span class="nc" id="L2302">				rs4 = pwtPstmt.executeQuery();</span>

<span class="nc" id="L2304">				Map&lt;String, Double&gt; dataMap = new HashMap&lt;String, Double&gt;();</span>
<span class="nc" id="L2305">				dataMap.put(&quot;gameId&quot;, rs1.getDouble(&quot;game_id&quot;));</span>
<span class="nc" id="L2306">				dataMap.put(&quot;name&quot; + rs1.getString(&quot;game_name&quot;), 0.0);</span>

<span class="nc bnc" id="L2308" title="All 2 branches missed.">				if (rs_2 != null) {</span>
<span class="nc bnc" id="L2309" title="All 2 branches missed.">					while (rs_2.next()) {</span>
<span class="nc" id="L2310">						dataMap.put(&quot;mrpSaleSlot&quot;, rs_2.getDouble(&quot;mrpAmt&quot;));</span>
<span class="nc" id="L2311">						dataMap.put(&quot;netSaleSlot&quot;, rs_2.getDouble(&quot;netAmt&quot;));</span>
					}
				}
<span class="nc bnc" id="L2314" title="All 2 branches missed.">				while (rs2.next()) {</span>
<span class="nc bnc" id="L2315" title="All 2 branches missed.">					if (rs3.next()) {</span>
<span class="nc" id="L2316">						dataMap.put(&quot;mrpSale&quot;, rs2.getDouble(&quot;mrpSale&quot;)</span>
								- rs3.getDouble(&quot;mrpSaleRef&quot;));
<span class="nc" id="L2318">						dataMap.put(&quot;netSale&quot;, rs2.getDouble(&quot;netSale&quot;)</span>
								- rs3.getDouble(&quot;netSaleRef&quot;));
					} else {
<span class="nc" id="L2321">						dataMap.put(&quot;mrpSale&quot;, rs2.getDouble(&quot;mrp_amt&quot;));</span>
<span class="nc" id="L2322">						dataMap.put(&quot;netSale&quot;, rs2.getDouble(&quot;net_amt&quot;));</span>
					}
				}
<span class="nc bnc" id="L2325" title="All 2 branches missed.">				while (rs4.next()) {</span>
<span class="nc" id="L2326">					dataMap.put(&quot;mrpPwt&quot;, rs4.getDouble(&quot;mrpPwt&quot;));</span>
<span class="nc" id="L2327">					dataMap.put(&quot;netPwt&quot;, rs4.getDouble(&quot;netPwt&quot;));</span>
				}

<span class="nc" id="L2330">				logger.debug(&quot;game Wise Report Map &quot; + dataMap);</span>
<span class="nc" id="L2331">				dataList.add(dataMap);</span>
<span class="nc" id="L2332">			}</span>

			// Added code for addition of Scratch data in txn report...
<span class="nc bnc" id="L2335" title="All 2 branches missed.">			if (ServicesBean.isSE()) {</span>
<span class="nc" id="L2336">				String scratchPwtQuery = &quot;select ifnull(sum(pwt_amt),0) as mrpPwt, ifnull(sum(pwt_amt*(1+claim_comm*0.01)),0)as net_amt from st_se_retailer_pwt srp, st_lms_retailer_transaction_master atm where srp.retailer_org_id = ? and date(atm.transaction_date)&gt;=? and date(atm.transaction_date)&lt;? and srp.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L2337">				PreparedStatement scratchPwtPstmt = connection</span>
						.prepareStatement(scratchPwtQuery);
<span class="nc" id="L2339">				scratchPwtPstmt.setInt(1, retOrgId);</span>
<span class="nc" id="L2340">				scratchPwtPstmt.setTimestamp(2, dBean.getStartTime());</span>
<span class="nc" id="L2341">				scratchPwtPstmt.setTimestamp(3, dBean.getEndTime());</span>
<span class="nc" id="L2342">				logger.debug(&quot;PWT Qry: &quot; + scratchPwtQuery);</span>
<span class="nc" id="L2343">				rs5 = scratchPwtPstmt.executeQuery();</span>

<span class="nc" id="L2345">				Map&lt;String, Double&gt; scratchDataMap = new HashMap&lt;String, Double&gt;();</span>

<span class="nc bnc" id="L2347" title="All 2 branches missed.">				if (rs5.next()) {</span>
<span class="nc" id="L2348">					scratchDataMap</span>
							.put(&quot;scratchMrpPwt&quot;, rs5.getDouble(&quot;mrpPwt&quot;));
<span class="nc" id="L2350">					scratchDataMap.put(&quot;scratchNetPwt&quot;, rs5</span>
							.getDouble(&quot;net_amt&quot;));
				}
<span class="nc" id="L2353">				logger.debug(&quot;Scratch Report Map &quot; + scratchDataMap);</span>
<span class="nc" id="L2354">				dataList.add(scratchDataMap);</span>
			}

			// Addition of Scratch data in txn report ends here...

<span class="nc" id="L2359">			return dataList;</span>
<span class="nc" id="L2360">		} catch (SQLException e) {</span>
<span class="nc" id="L2361">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L2363">			DBConnect.closeCon(connection);</span>
<span class="nc" id="L2364">		}</span>
<span class="nc" id="L2365">		return dataList;</span>
	}

	public CollectionReportBean getSummaryTxnReport(DateBeans dBean, int orgId)
			throws Exception {
<span class="nc" id="L2370">		Connection connection = null;</span>
<span class="nc" id="L2371">		CollectionReportBean localBean = new CollectionReportBean();</span>

		try {

<span class="nc" id="L2375">			connection = DBConnect.getConnection();</span>
<span class="nc" id="L2376">			PreparedStatement pstmt = null;</span>
<span class="nc" id="L2377">			ResultSet rs = null, rs1 = null, rs2 = null, rs3 = null, rs4 = null, rs5 = null, rs6 = null, rs7 = null, rs8 = null, rs9 = null;</span>

			// List&lt;Integer&gt; gameNumList = Util.getGameNumberList();
<span class="nc" id="L2380">			List&lt;Integer&gt; gameNumList = Util.getLMSGameNumberList();</span>
<span class="nc" id="L2381">			List&lt;Integer&gt; categoryList = CSProductRegistrationHelper</span>
					.getActiveCategoriesList();
<span class="nc" id="L2383">			StringBuilder drawSaleQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L2384">			StringBuilder drawSaleRefQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L2385">			StringBuilder drawPwtQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L2386">			StringBuilder CSSaleQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L2387">			StringBuilder CSSaleRefQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L2388">			String drawSaleQuery = null;</span>
<span class="nc" id="L2389">			String drawSaleRefQuery = null;</span>
<span class="nc" id="L2390">			String drawPwtQuery = null;</span>
<span class="nc" id="L2391">			String scratchPurchaseQuery = null;</span>
<span class="nc" id="L2392">			String scratchSaleRetQuery = null;</span>
<span class="nc" id="L2393">			String scratchPwtQuery = null;</span>
<span class="nc" id="L2394">			String scratchSaleQuery = null;</span>
<span class="nc" id="L2395">			String CSSaleQuery = null;</span>
<span class="nc" id="L2396">			String CSSaleRefQuery = null;</span>

<span class="nc" id="L2398">			double olaDeposit = 0.0;</span>
<span class="nc" id="L2399">			double olaWithdrawal = 0.0;</span>
<span class="nc" id="L2400">			double netDeposit = 0.0;</span>
<span class="nc" id="L2401">			double netWdrwl = 0.0;</span>

<span class="nc" id="L2403">			double netSleSale = 0.0;</span>
<span class="nc" id="L2404">			double mrpSleSale = 0.0;</span>
<span class="nc" id="L2405">			double netSlePwt = 0.0;</span>
<span class="nc" id="L2406">			double mrpSlePwt = 0.0;</span>
			
<span class="nc" id="L2408">			double netIwSale = 0.0;</span>
<span class="nc" id="L2409">			double mrpIwSale = 0.0;</span>
<span class="nc" id="L2410">			double netIwPwt = 0.0;</span>
<span class="nc" id="L2411">			double mrpIwPwt = 0.0;</span>

<span class="nc bnc" id="L2413" title="All 2 branches missed.">			for (int i = 0; i &lt; gameNumList.size(); i++) {</span>
<span class="nc" id="L2414">				drawSaleQueryBuilder</span>
						.append(&quot;select transaction_id, mrp_amt, net_amt from st_dg_ret_sale_&quot;
								+ gameNumList.get(i)
								+ &quot; where retailer_org_id = ? union &quot;);
<span class="nc" id="L2418">				drawSaleRefQueryBuilder</span>
						.append(&quot;select transaction_id, mrp_amt, net_amt from st_dg_ret_sale_refund_&quot;
								+ gameNumList.get(i)
								+ &quot; where retailer_org_id = ? union &quot;);
<span class="nc" id="L2422">				drawPwtQueryBuilder</span>
						.append(&quot;select transaction_id, pwt_amt as mrpPwt,(pwt_amt+retailer_claim_comm)as  net_amt from st_dg_ret_pwt_&quot;
								+ gameNumList.get(i)
								+ &quot; where retailer_org_id = ? union &quot;);
			}
<span class="nc bnc" id="L2427" title="All 2 branches missed.">			for (int i = 0; i &lt; categoryList.size(); i++) {</span>
<span class="nc" id="L2428">				CSSaleQueryBuilder</span>
						.append(&quot;select transaction_id, mrp_amt, net_amt from st_cs_sale_&quot;
								+ categoryList.get(i)
								+ &quot; where retailer_org_id = ? union &quot;);
<span class="nc" id="L2432">				CSSaleRefQueryBuilder</span>
						.append(&quot;select transaction_id, mrp_amt, net_amt from st_cs_refund_&quot;
								+ categoryList.get(i)
								+ &quot; where retailer_org_id = ? union &quot;);
			}
<span class="nc" id="L2437">			drawSaleQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.net_amt),0) as netSale from (&quot;</span>
					+ drawSaleQueryBuilder.toString().substring(0,
							drawSaleQueryBuilder.lastIndexOf(&quot; union &quot;))
					+ &quot;)uni, st_lms_retailer_transaction_master atm where date(atm.transaction_date)&gt;=? and date(atm.transaction_date)&lt;? and uni.transaction_id = atm.transaction_id&quot;;
<span class="nc" id="L2441">			drawSaleRefQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.net_amt),0)as netRef from (&quot;</span>
					+ drawSaleRefQueryBuilder.toString().substring(0,
							drawSaleRefQueryBuilder.lastIndexOf(&quot; union &quot;))
					+ &quot;)uni, st_lms_retailer_transaction_master atm where date(atm.transaction_date)&gt;=? and date(atm.transaction_date)&lt;? and uni.transaction_id = atm.transaction_id&quot;;
<span class="nc" id="L2445">			drawPwtQuery = &quot;select ifnull(sum(uni.mrpPwt),0)as mrpPwt, ifnull(sum(uni.net_amt),0)as netPwt from (&quot;</span>
					+ drawPwtQueryBuilder.toString().substring(0,
							drawPwtQueryBuilder.lastIndexOf(&quot; union &quot;))
					+ &quot;)uni, st_lms_retailer_transaction_master atm where date(atm.transaction_date)&gt;=? and date(atm.transaction_date)&lt;? and uni.transaction_id = atm.transaction_id&quot;;
<span class="nc" id="L2449">			scratchPurchaseQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpPur, ifnull(sum(net_amt),0)as netPur from st_se_agent_retailer_transaction sart, st_lms_agent_transaction_master atm where sart.transaction_type='SALE' and sart.retailer_org_id = ? and date(atm.transaction_date)&gt;=? and date(atm.transaction_date)&lt;? and sart.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L2450">			scratchSaleRetQuery = &quot;select ifnull(sum(mrp_amt),0)as mrpSaleRet, ifnull(sum(net_amt),0)as netSaleRet from st_se_agent_retailer_transaction sart, st_lms_retailer_transaction_master atm where sart.transaction_type='SALE_RET' and sart.retailer_org_id = ? and date(atm.transaction_date)&gt;=? and date(atm.transaction_date)&lt;? and sart.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L2451">			scratchPwtQuery = &quot;select ifnull(sum(pwt_amt),0) as mrpPwt, ifnull(sum(pwt_amt*(1+claim_comm*0.01)),0)as  net_amt from st_se_retailer_pwt srp, st_lms_retailer_transaction_master atm where srp.retailer_org_id = ? and date(atm.transaction_date)&gt;=? and date(atm.transaction_date)&lt;? and srp.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L2452">			scratchSaleQuery = &quot;select ifnull(sum(cnt.ticket_count*unit.ticket_price),0)as soldTicketPrice from (select game_id, ifnull(sum(sold_tickets),0) as ticket_count from st_se_game_ticket_inv_history where current_owner='RETAILER' and current_owner_id = ? and date(date)=? group by game_id)cnt, (select game_id, ticket_price from st_se_game_master)unit where cnt.game_id = unit.game_id&quot;;</span>
<span class="nc bnc" id="L2453" title="All 2 branches missed.">			if (CSSaleQueryBuilder.length() &gt; 0) {</span>
<span class="nc" id="L2454">				CSSaleQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.net_amt),0) as netSale from (&quot;</span>
						+ CSSaleQueryBuilder.toString().substring(0,
								CSSaleQueryBuilder.lastIndexOf(&quot; union &quot;))
						+ &quot;)uni, st_lms_retailer_transaction_master atm where date(atm.transaction_date)&gt;=? and date(atm.transaction_date)&lt;? and uni.transaction_id = atm.transaction_id and atm.transaction_type='CS_SALE'&quot;;
<span class="nc" id="L2458">				CSSaleRefQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.net_amt),0) as netRef from (&quot;</span>
						+ CSSaleRefQueryBuilder.toString().substring(0,
								CSSaleRefQueryBuilder.lastIndexOf(&quot; union &quot;))
						+ &quot;)uni, st_lms_retailer_transaction_master atm where date(atm.transaction_date)&gt;=? and date(atm.transaction_date)&lt;? and uni.transaction_id = atm.transaction_id and (atm.transaction_type = 'CS_CANCEL_SERVER' or atm.transaction_type = 'CS_CANCEL_RET')&quot;;
			}
<span class="nc bnc" id="L2463" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L2464">				pstmt = connection.prepareStatement(drawSaleQuery);</span>
<span class="nc" id="L2465">				int i = 0;</span>
<span class="nc bnc" id="L2466" title="All 2 branches missed.">				for (i = 1; i &lt;= gameNumList.size(); i++) {</span>
<span class="nc" id="L2467">					pstmt.setInt(i, orgId);</span>
				}
<span class="nc" id="L2469">				pstmt.setDate(i, dBean.getFirstdate());</span>
<span class="nc" id="L2470">				pstmt.setDate(i + 1, dBean.getLastdate());</span>
<span class="nc" id="L2471">				logger.debug(&quot;drawSaleQuery:- &quot; + pstmt);</span>
<span class="nc" id="L2472">				rs1 = pstmt.executeQuery();</span>

<span class="nc" id="L2474">				pstmt = connection.prepareStatement(drawSaleRefQuery);</span>
<span class="nc bnc" id="L2475" title="All 2 branches missed.">				for (i = 1; i &lt;= gameNumList.size(); i++) {</span>
<span class="nc" id="L2476">					pstmt.setInt(i, orgId);</span>
				}
<span class="nc" id="L2478">				pstmt.setDate(i, dBean.getFirstdate());</span>
<span class="nc" id="L2479">				pstmt.setDate(i + 1, dBean.getLastdate());</span>
<span class="nc" id="L2480">				logger.debug(&quot;drawSaleRefQuery:- &quot; + pstmt);</span>
<span class="nc" id="L2481">				rs2 = pstmt.executeQuery();</span>

<span class="nc" id="L2483">				pstmt = connection.prepareStatement(drawPwtQuery);</span>
<span class="nc bnc" id="L2484" title="All 2 branches missed.">				for (i = 1; i &lt;= gameNumList.size(); i++) {</span>
<span class="nc" id="L2485">					pstmt.setInt(i, orgId);</span>
				}
<span class="nc" id="L2487">				pstmt.setDate(i, dBean.getFirstdate());</span>
<span class="nc" id="L2488">				pstmt.setDate(i + 1, dBean.getLastdate());</span>
<span class="nc" id="L2489">				logger.debug(&quot;drawPwtQuery:- &quot; + pstmt);</span>
<span class="nc" id="L2490">				rs3 = pstmt.executeQuery();</span>
			}
<span class="nc bnc" id="L2492" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
<span class="nc" id="L2493">				pstmt = connection.prepareStatement(scratchPurchaseQuery);</span>
<span class="nc" id="L2494">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L2495">				pstmt.setDate(2, dBean.getFirstdate());</span>
<span class="nc" id="L2496">				pstmt.setDate(3, dBean.getLastdate());</span>
<span class="nc" id="L2497">				logger.debug(&quot;scratchPurchaseQuery:- &quot; + pstmt);</span>
<span class="nc" id="L2498">				rs4 = pstmt.executeQuery();</span>

<span class="nc" id="L2500">				pstmt = connection.prepareStatement(scratchSaleRetQuery);</span>
<span class="nc" id="L2501">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L2502">				pstmt.setDate(2, dBean.getFirstdate());</span>
<span class="nc" id="L2503">				pstmt.setDate(3, dBean.getLastdate());</span>
<span class="nc" id="L2504">				logger.debug(&quot;scratchSaleRetQuery:- &quot; + pstmt);</span>
<span class="nc" id="L2505">				rs5 = pstmt.executeQuery();</span>

<span class="nc" id="L2507">				pstmt = connection.prepareStatement(scratchPwtQuery);</span>
<span class="nc" id="L2508">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L2509">				pstmt.setDate(2, dBean.getFirstdate());</span>
<span class="nc" id="L2510">				pstmt.setDate(3, dBean.getLastdate());</span>
<span class="nc" id="L2511">				logger.debug(&quot;scratchPwtQuery:- &quot; + pstmt);</span>
<span class="nc" id="L2512">				rs6 = pstmt.executeQuery();</span>

<span class="nc" id="L2514">				pstmt = connection.prepareStatement(scratchSaleQuery);</span>
<span class="nc" id="L2515">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L2516">				pstmt.setDate(2, dBean.getFirstdate());</span>
<span class="nc" id="L2517">				logger.debug(&quot;scratchSaleQuery:- &quot; + pstmt);</span>
<span class="nc" id="L2518">				rs7 = pstmt.executeQuery();</span>
			}

<span class="nc bnc" id="L2521" title="All 2 branches missed.">			if (ReportUtility.isCS) {</span>
<span class="nc" id="L2522">				pstmt = connection.prepareStatement(CSSaleQuery);</span>
<span class="nc" id="L2523">				int i = 0;</span>
<span class="nc bnc" id="L2524" title="All 2 branches missed.">				for (i = 1; i &lt;= categoryList.size(); i++) {</span>
<span class="nc" id="L2525">					pstmt.setInt(i, orgId);</span>
				}
<span class="nc" id="L2527">				pstmt.setDate(i, dBean.getFirstdate());</span>
<span class="nc" id="L2528">				pstmt.setDate(i + 1, dBean.getLastdate());</span>
<span class="nc" id="L2529">				logger.debug(&quot;CSSaleQuery:- &quot; + pstmt);</span>
<span class="nc" id="L2530">				rs8 = pstmt.executeQuery();</span>

<span class="nc" id="L2532">				pstmt = connection.prepareStatement(CSSaleRefQuery);</span>
<span class="nc bnc" id="L2533" title="All 2 branches missed.">				for (i = 1; i &lt;= categoryList.size(); i++) {</span>
<span class="nc" id="L2534">					pstmt.setInt(i, orgId);</span>
				}
<span class="nc" id="L2536">				pstmt.setDate(i, dBean.getFirstdate());</span>
<span class="nc" id="L2537">				pstmt.setDate(i + 1, dBean.getLastdate());</span>
<span class="nc" id="L2538">				logger.debug(&quot;CSSaleRefQuery:- &quot; + pstmt);</span>
<span class="nc" id="L2539">				rs9 = pstmt.executeQuery();</span>
			}

<span class="nc bnc" id="L2542" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>

<span class="nc" id="L2544">				DepositWthdrwReportControllerImpl controller = new DepositWthdrwReportControllerImpl();</span>
<span class="nc" id="L2545">				OlaReportBean totBean = controller.fetchTxnReportData(dBean</span>
						.getFirstdate().toString(), dBean.getLastdate()
						.toString(), orgId);
<span class="nc" id="L2548">				olaDeposit = totBean.getDepositAmt();</span>
<span class="nc" id="L2549">				olaWithdrawal = totBean.getWithdrawlAmt();</span>
<span class="nc" id="L2550">				netDeposit = totBean.getTotalDepositAmount();</span>
<span class="nc" id="L2551">				netWdrwl = totBean.getTotalWithdrawlAmount();</span>
<span class="nc" id="L2552">				localBean.setOlaDeposit(olaDeposit);</span>
<span class="nc" id="L2553">				localBean.setOlaWithdraw(olaWithdrawal);</span>
			}

<span class="nc bnc" id="L2556" title="All 2 branches missed.">			if (ReportUtility.isSLE) {</span>

<span class="nc" id="L2558">				double netSaleTemp = 0.0;</span>
<span class="nc" id="L2559">				double netRefTemp = 0.0;</span>
<span class="nc" id="L2560">				double mrpSaleTemp = 0.0;</span>
<span class="nc" id="L2561">				double mrpRefTemp = 0.0;</span>

<span class="nc" id="L2563">				String sleSaleQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.retailer_net_amt),0) as netSale from (select transaction_id, mrp_amt, retailer_net_amt from st_sle_ret_sale where retailer_org_id = ? )uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L2564">				String sleSaleRefQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.retailer_net_amt),0)as netRef from (select transaction_id, mrp_amt, retailer_net_amt from st_sle_ret_sale_refund where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L2565">				String slePwtQuery = &quot;select ifnull(sum(uni.mrpPwt),0)as mrpPwt, ifnull(sum(uni.net_amt),0)as netPwt from (select transaction_id, pwt_amt as mrpPwt,(pwt_amt+retailer_claim_comm)as  net_amt from st_sle_ret_pwt where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>

<span class="nc" id="L2567">				pstmt = connection.prepareStatement(sleSaleQuery);</span>
<span class="nc" id="L2568">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L2569">				pstmt.setDate(2, dBean.getFirstdate());</span>
<span class="nc" id="L2570">				pstmt.setDate(3, dBean.getLastdate());</span>
<span class="nc" id="L2571">				logger.debug(&quot;SLESaleQuery - &quot; + pstmt);</span>
<span class="nc" id="L2572">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2573" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L2574">					netSaleTemp = rs.getDouble(&quot;netSale&quot;);</span>
<span class="nc" id="L2575">					mrpSaleTemp = rs.getDouble(&quot;mrpSale&quot;);</span>
				}

<span class="nc" id="L2578">				pstmt = connection.prepareStatement(sleSaleRefQuery);</span>
<span class="nc" id="L2579">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L2580">				pstmt.setDate(2, dBean.getFirstdate());</span>
<span class="nc" id="L2581">				pstmt.setDate(3, dBean.getLastdate());</span>
<span class="nc" id="L2582">				logger.debug(&quot;SLEPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L2583">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2584" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L2585">					netRefTemp = rs.getDouble(&quot;netRef&quot;);</span>
<span class="nc" id="L2586">					mrpRefTemp = rs.getDouble(&quot;mrpRef&quot;);</span>
				}

<span class="nc" id="L2589">				pstmt = connection.prepareStatement(slePwtQuery);</span>
<span class="nc" id="L2590">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L2591">				pstmt.setDate(2, dBean.getFirstdate());</span>
<span class="nc" id="L2592">				pstmt.setDate(3, dBean.getLastdate());</span>
<span class="nc" id="L2593">				logger.debug(&quot;SLEPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L2594">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2595" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L2596">					netSlePwt = rs.getDouble(&quot;netPwt&quot;);</span>
<span class="nc" id="L2597">					mrpSlePwt = rs.getDouble(&quot;mrpPwt&quot;);</span>
				}

<span class="nc" id="L2600">				netSleSale = netSaleTemp - netRefTemp;</span>
<span class="nc" id="L2601">				mrpSleSale = mrpSaleTemp - mrpRefTemp;</span>
			}
			
<span class="nc bnc" id="L2604" title="All 2 branches missed.">			if(ReportUtility.isIW){</span>


<span class="nc" id="L2607">				double netSaleTemp = 0.0;</span>
<span class="nc" id="L2608">				double netRefTemp = 0.0;</span>
<span class="nc" id="L2609">				double mrpSaleTemp = 0.0;</span>
<span class="nc" id="L2610">				double mrpRefTemp = 0.0;</span>

<span class="nc" id="L2612">				String iwSaleQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpSale, ifnull(sum(uni.retailer_net_amt),0) as netSale from (select transaction_id, mrp_amt, retailer_net_amt from st_iw_ret_sale where retailer_org_id = ? )uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L2613">				String iwSaleRefQuery = &quot;select ifnull(sum(uni.mrp_amt),0)as mrpRef, ifnull(sum(uni.retailer_net_amt),0)as netRef from (select transaction_id, mrp_amt, retailer_net_amt from st_iw_ret_sale_refund where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>
<span class="nc" id="L2614">				String iwPwtQuery = &quot;select ifnull(sum(uni.mrpPwt),0)as mrpPwt, ifnull(sum(uni.net_amt),0)as netPwt from (select transaction_id, pwt_amt as mrpPwt,(pwt_amt+retailer_claim_comm)as  net_amt from st_iw_ret_pwt where retailer_org_id = ?)uni, st_lms_retailer_transaction_master atm where (atm.transaction_date)&gt;=? and (atm.transaction_date)&lt;=? and uni.transaction_id = atm.transaction_id&quot;;</span>

<span class="nc" id="L2616">				pstmt = connection.prepareStatement(iwSaleQuery);</span>
<span class="nc" id="L2617">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L2618">				pstmt.setDate(2, dBean.getFirstdate());</span>
<span class="nc" id="L2619">				pstmt.setDate(3, dBean.getLastdate());</span>
<span class="nc" id="L2620">				logger.debug(&quot;SLESaleQuery - &quot; + pstmt);</span>
<span class="nc" id="L2621">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2622" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L2623">					netSaleTemp = rs.getDouble(&quot;netSale&quot;);</span>
<span class="nc" id="L2624">					mrpSaleTemp = rs.getDouble(&quot;mrpSale&quot;);</span>
				}

<span class="nc" id="L2627">				pstmt = connection.prepareStatement(iwSaleRefQuery);</span>
<span class="nc" id="L2628">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L2629">				pstmt.setDate(2, dBean.getFirstdate());</span>
<span class="nc" id="L2630">				pstmt.setDate(3, dBean.getLastdate());</span>
<span class="nc" id="L2631">				logger.debug(&quot;SLEPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L2632">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2633" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L2634">					netRefTemp = rs.getDouble(&quot;netRef&quot;);</span>
<span class="nc" id="L2635">					mrpRefTemp = rs.getDouble(&quot;mrpRef&quot;);</span>
				}

<span class="nc" id="L2638">				pstmt = connection.prepareStatement(iwPwtQuery);</span>
<span class="nc" id="L2639">				pstmt.setInt(1, orgId);</span>
<span class="nc" id="L2640">				pstmt.setDate(2, dBean.getFirstdate());</span>
<span class="nc" id="L2641">				pstmt.setDate(3, dBean.getLastdate());</span>
<span class="nc" id="L2642">				logger.debug(&quot;SLEPwtQuery - &quot; + pstmt);</span>
<span class="nc" id="L2643">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2644" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L2645">					netIwPwt = rs.getDouble(&quot;netPwt&quot;);</span>
<span class="nc" id="L2646">					mrpIwPwt = rs.getDouble(&quot;mrpPwt&quot;);</span>
				}

<span class="nc" id="L2649">				netIwSale = netSaleTemp - netRefTemp;</span>
<span class="nc" id="L2650">				mrpIwSale = mrpSaleTemp - mrpRefTemp;</span>
			
			}

<span class="nc" id="L2654">			double netDrawSale = 0.0;</span>
<span class="nc" id="L2655">			double netScratchSale = 0.0;</span>
<span class="nc" id="L2656">			double mrpDrawSale = 0.0;</span>
<span class="nc" id="L2657">			double mrpScratchSale = 0.0;</span>
<span class="nc" id="L2658">			double netDrawPwt = 0.0;</span>
<span class="nc" id="L2659">			double netScratchPwt = 0.0;</span>
<span class="nc" id="L2660">			double mrpDrawPwt = 0.0;</span>
<span class="nc" id="L2661">			double mrpScratchPwt = 0.0;</span>
<span class="nc" id="L2662">			double mrpCSSale = 0.0;</span>
<span class="nc" id="L2663">			double netCSSale = 0.0;</span>
<span class="nc" id="L2664">			double mrpPurchase = 0.0;</span>
<span class="nc" id="L2665">			double netPurchase = 0.0;</span>
<span class="nc" id="L2666">			double cashCol = 0.0;</span>
<span class="nc" id="L2667">			double payToAgt = 0.0;</span>

<span class="nc bnc" id="L2669" title="All 6 branches missed.">			if (rs1 != null &amp;&amp; rs2 != null &amp;&amp; rs3 != null) {</span>
<span class="nc" id="L2670">				rs1.next();</span>
<span class="nc" id="L2671">				rs2.next();</span>
<span class="nc" id="L2672">				rs3.next();</span>
<span class="nc" id="L2673">				netDrawSale = rs1.getDouble(&quot;netSale&quot;)</span>
						- rs2.getDouble(&quot;netRef&quot;);
<span class="nc" id="L2675">				mrpDrawSale = rs1.getDouble(&quot;mrpSale&quot;)</span>
						- rs2.getDouble(&quot;mrpRef&quot;);
<span class="nc" id="L2677">				netDrawPwt = rs3.getDouble(&quot;netPwt&quot;);</span>
<span class="nc" id="L2678">				mrpDrawPwt = rs3.getDouble(&quot;mrpPwt&quot;);</span>
			}
<span class="nc bnc" id="L2680" title="All 8 branches missed.">			if (rs4 != null &amp;&amp; rs5 != null &amp;&amp; rs6 != null &amp;&amp; rs7 != null) {</span>
<span class="nc" id="L2681">				rs4.next();</span>
<span class="nc" id="L2682">				rs5.next();</span>
<span class="nc" id="L2683">				rs6.next();</span>
<span class="nc" id="L2684">				rs7.next();</span>
<span class="nc" id="L2685">				netPurchase = rs4.getDouble(&quot;netPur&quot;)</span>
						- rs5.getDouble(&quot;netSaleRet&quot;);
<span class="nc" id="L2687">				mrpPurchase = rs4.getDouble(&quot;mrpPur&quot;)</span>
						- rs5.getDouble(&quot;mrpSaleRet&quot;);
<span class="nc" id="L2689">				netScratchPwt += rs6.getDouble(&quot;net_amt&quot;);</span>
<span class="nc" id="L2690">				mrpScratchPwt += rs6.getDouble(&quot;mrpPwt&quot;);</span>
<span class="nc" id="L2691">				mrpScratchSale = rs7.getDouble(&quot;soldTicketPrice&quot;);</span>

			}
<span class="nc bnc" id="L2694" title="All 4 branches missed.">			if (rs8 != null &amp;&amp; rs9 != null) {</span>
<span class="nc" id="L2695">				rs8.next();</span>
<span class="nc" id="L2696">				rs9.next();</span>
<span class="nc" id="L2697">				mrpCSSale = rs8.getDouble(&quot;mrpSale&quot;) - rs9.getDouble(&quot;mrpRef&quot;);</span>
<span class="nc" id="L2698">				netCSSale = rs8.getDouble(&quot;netSale&quot;) - rs9.getDouble(&quot;netRef&quot;);</span>
			}

<span class="nc" id="L2701">			cashCol = mrpDrawSale + mrpScratchSale + mrpCSSale - mrpDrawPwt</span>
					- mrpScratchPwt + olaDeposit - olaWithdrawal + mrpSleSale
					- mrpSlePwt + mrpIwSale- mrpIwPwt;
<span class="nc" id="L2704">			payToAgt = netDrawSale + netScratchSale + netCSSale - netDrawPwt</span>
					- netScratchPwt + netDeposit - netWdrwl + netSleSale
					- netSlePwt + netIwSale - netIwPwt ;
<span class="nc" id="L2707">			localBean.setGrandTotal(FormatNumber.formatNumber(cashCol) + &quot;&quot;);</span>
<span class="nc" id="L2708">			localBean.setOpenBal(FormatNumber.formatNumber(payToAgt) + &quot;&quot;);</span>
<span class="nc" id="L2709">			localBean.setDrawSale(mrpDrawSale + &quot;&quot;);</span>
<span class="nc" id="L2710">			localBean.setScratchSale(mrpScratchSale + &quot;&quot;);</span>
<span class="nc" id="L2711">			localBean.setCSSale(mrpCSSale + &quot;&quot;);</span>
<span class="nc" id="L2712">			localBean.setDrawPwt(mrpDrawPwt + &quot;&quot;);</span>
<span class="nc" id="L2713">			localBean.setScratchPwt(mrpScratchPwt + &quot;&quot;);</span>
<span class="nc" id="L2714">			localBean.setSleSale(mrpSleSale + &quot;&quot;);</span>
<span class="nc" id="L2715">			localBean.setSlePwt(mrpSlePwt + &quot;&quot;);</span>
<span class="nc" id="L2716">			localBean.setIwSale(mrpIwSale + &quot;&quot;);</span>
<span class="nc" id="L2717">			localBean.setIwPwt(mrpIwPwt + &quot;&quot;);</span>

<span class="nc" id="L2719">		} catch (SQLException e) {</span>
<span class="nc" id="L2720">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L2722">			try {</span>

<span class="nc" id="L2724">				System.out.println(&quot; closing connection  &quot;);</span>
<span class="nc bnc" id="L2725" title="All 6 branches missed.">				if (connection != null) {</span>
<span class="nc" id="L2726">					connection.close();</span>
				}
<span class="nc" id="L2728">			} catch (SQLException e) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L2730">				e.printStackTrace();</span>
<span class="nc" id="L2731">			}</span>
<span class="nc" id="L2732">		}</span>
<span class="nc" id="L2733">		return localBean;</span>
	}

	public Map&lt;String, List&lt;String&gt;&gt; getDGDetailReport(DateBeans dBean,
			int orgId) {
<span class="nc" id="L2738">		Map&lt;String, List&lt;String&gt;&gt; dgMap = new HashMap&lt;String, List&lt;String&gt;&gt;();</span>
<span class="nc" id="L2739">		DBConnect dbConnect = null;</span>
<span class="nc" id="L2740">		Connection connection = null;</span>
<span class="nc" id="L2741">		List&lt;Integer&gt; gameNbrList = Util.getGameNumberList();</span>

		try {

<span class="nc" id="L2745">			connection = DBConnect.getConnection();</span>
<span class="nc" id="L2746">			PreparedStatement pstmt = null;</span>
<span class="nc" id="L2747">			StringBuilder saleQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L2748">			StringBuilder saleRefQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L2749">			StringBuilder PwtQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L2750">			String intSaleQuery = &quot;&quot;;</span>
<span class="nc" id="L2751">			String leftSaleQuery = &quot;&quot;;</span>
<span class="nc" id="L2752">			String rightSaleQuery = &quot;&quot;;</span>
<span class="nc" id="L2753">			String pwtQuery = &quot;&quot;;</span>
<span class="nc bnc" id="L2754" title="All 2 branches missed.">			for (int i = 0; i &lt; gameNbrList.size(); i++) {</span>
<span class="nc" id="L2755">				saleQueryBuilder</span>
						.append(&quot;select transaction_id, game_id, mrp_amt, net_amt from st_dg_ret_sale_&quot;
								+ gameNbrList.get(i)
								+ &quot; where retailer_org_id = ? union &quot;);
<span class="nc" id="L2759">				saleRefQueryBuilder</span>
						.append(&quot;select transaction_id, game_id, mrp_amt, net_amt from st_dg_ret_sale_refund_&quot;
								+ gameNbrList.get(i)
								+ &quot; where retailer_org_id = ? union &quot;);
<span class="nc" id="L2763">				PwtQueryBuilder</span>
						.append(&quot;select transaction_id, game_id, pwt_amt as mrp_pwt,(pwt_amt+retailer_claim_comm)as  net_pwt from st_dg_ret_pwt_&quot;
								+ gameNbrList.get(i)
								+ &quot; where retailer_org_id = ? union &quot;);
			}
<span class="nc" id="L2768">			leftSaleQuery = &quot;select ifnull(sale.game_id, saleRef.game_id) as gid, mrpSale, netSale, mrpSaleRef, netsaleRef from ((select ifnull(sum(mrp_amt),0) as mrpSale, ifnull(sum(net_amt),0) as netSale, game_id from (&quot;</span>
					+ saleQueryBuilder.substring(0, saleQueryBuilder
							.lastIndexOf(&quot; union &quot;))
					+ &quot;)saletab where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date &gt;= ? and transaction_date &lt; ? and transaction_type in('DG_SALE', 'DG_SALE_OFFLINE') and retailer_org_id = ?) group by game_id)sale left outer join (select ifnull(sum(mrp_amt),0) as mrpSaleRef, ifnull(sum(net_amt),0) as netSaleRef, game_id from (&quot;
					+ saleRefQueryBuilder.substring(0, saleRefQueryBuilder
							.lastIndexOf(&quot; union &quot;))
					+ &quot;)saleReftab where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date &gt;= ? and transaction_date &lt; ? and transaction_type in ( 'DG_REFUND_CANCEL', 'DG_REFUND_FAILED') and retailer_org_id = ?) group by game_id)saleRef on sale.game_id = saleRef.game_id)&quot;;
<span class="nc" id="L2775">			rightSaleQuery = &quot;select ifnull(sale.game_id, saleRef.game_id) as gid, mrpSale, netSale, mrpSaleRef, netsaleRef from ((select ifnull(sum(mrp_amt),0) as mrpSale, ifnull(sum(net_amt),0) as netSale, game_id from (&quot;</span>
					+ saleQueryBuilder.substring(0, saleQueryBuilder
							.lastIndexOf(&quot; union &quot;))
					+ &quot;)saletab where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date &gt;= ? and transaction_date &lt; ? and transaction_type in('DG_SALE', 'DG_SALE_OFFLINE') and retailer_org_id = ?) group by game_id)sale right outer join (select ifnull(sum(mrp_amt),0) as mrpSaleRef, ifnull(sum(net_amt),0) as netSaleRef, game_id from (&quot;
					+ saleRefQueryBuilder.substring(0, saleRefQueryBuilder
							.lastIndexOf(&quot; union &quot;))
					+ &quot;)saleReftab where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date &gt;= ? and transaction_date &lt; ? and transaction_type in ( 'DG_REFUND_CANCEL', 'DG_REFUND_FAILED') and retailer_org_id = ?) group by game_id)saleRef on sale.game_id = saleRef.game_id)&quot;;
<span class="nc" id="L2782">			intSaleQuery = &quot;select game_name, mrpSale, netSale, mrpSaleRef, netSaleRef from (&quot;</span>
					+ leftSaleQuery
					+ &quot; union &quot;
					+ rightSaleQuery
					+ &quot;)full, st_dg_game_master dgm where full.gid = dgm.game_id&quot;;
<span class="nc" id="L2787">			pwtQuery = &quot;select game_id, ifnull(sum(mrp_pwt),0) mrpPwt, ifnull(sum(net_pwt),0)netPwt from (&quot;</span>
					+ PwtQueryBuilder.substring(0, PwtQueryBuilder
							.lastIndexOf(&quot; union &quot;))
					+ &quot;) pwt where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_date &gt;= ? and transaction_date &lt; ? and transaction_type = 'DG_PWT' and retailer_org_id  = ?) group by pwt.game_id&quot;;

<span class="nc" id="L2792">			pstmt = connection.prepareStatement(intSaleQuery);</span>
<span class="nc" id="L2793">			int i = 0, j = 0;</span>
<span class="nc bnc" id="L2794" title="All 2 branches missed.">			while (i &lt; gameNbrList.size()) {</span>
<span class="nc" id="L2795">				pstmt.setInt(++i, orgId);</span>
			}
<span class="nc" id="L2797">			pstmt.setDate(++i, dBean.getFirstdate());</span>
<span class="nc" id="L2798">			pstmt.setDate(++i, dBean.getLastdate());</span>
<span class="nc" id="L2799">			pstmt.setInt(++i, orgId);</span>
<span class="nc bnc" id="L2800" title="All 2 branches missed.">			while (j &lt; gameNbrList.size()) {</span>
<span class="nc" id="L2801">				pstmt.setInt(++i, orgId);</span>
<span class="nc" id="L2802">				j++;</span>
			}
<span class="nc" id="L2804">			pstmt.setDate(++i, dBean.getFirstdate());</span>
<span class="nc" id="L2805">			pstmt.setDate(++i, dBean.getLastdate());</span>
<span class="nc" id="L2806">			pstmt.setInt(++i, orgId);</span>
<span class="nc" id="L2807">			j = 0;</span>
<span class="nc bnc" id="L2808" title="All 2 branches missed.">			while (j &lt; gameNbrList.size()) {</span>
<span class="nc" id="L2809">				pstmt.setInt(++i, orgId);</span>
<span class="nc" id="L2810">				j++;</span>
			}
<span class="nc" id="L2812">			pstmt.setDate(++i, dBean.getFirstdate());</span>
<span class="nc" id="L2813">			pstmt.setDate(++i, dBean.getLastdate());</span>
<span class="nc" id="L2814">			pstmt.setInt(++i, orgId);</span>
<span class="nc" id="L2815">			j = 0;</span>
<span class="nc bnc" id="L2816" title="All 2 branches missed.">			while (j &lt; gameNbrList.size()) {</span>
<span class="nc" id="L2817">				pstmt.setInt(++i, orgId);</span>
<span class="nc" id="L2818">				j++;</span>
			}
<span class="nc" id="L2820">			pstmt.setDate(++i, dBean.getFirstdate());</span>
<span class="nc" id="L2821">			pstmt.setDate(++i, dBean.getLastdate());</span>
<span class="nc" id="L2822">			pstmt.setInt(++i, orgId);</span>
<span class="nc" id="L2823">			logger.debug(&quot;query for draw sale for detail txn report &quot; + pstmt);</span>
<span class="nc" id="L2824">			ResultSet rs1 = pstmt.executeQuery();</span>

<span class="nc" id="L2826">			pstmt = connection.prepareStatement(pwtQuery);</span>
<span class="nc" id="L2827">			i = 0;</span>
<span class="nc bnc" id="L2828" title="All 2 branches missed.">			while (i &lt; gameNbrList.size()) {</span>
<span class="nc" id="L2829">				pstmt.setInt(++i, orgId);</span>
			}
<span class="nc" id="L2831">			pstmt.setDate(++i, dBean.getFirstdate());</span>
<span class="nc" id="L2832">			pstmt.setDate(++i, dBean.getLastdate());</span>
<span class="nc" id="L2833">			pstmt.setInt(++i, orgId);</span>
<span class="nc" id="L2834">			logger.debug(&quot;query for draw pwt for detail txn report &quot; + pstmt);</span>
<span class="nc" id="L2835">			ResultSet rs2 = pstmt.executeQuery();</span>

<span class="nc" id="L2837">			List&lt;String&gt; gameAmtList = null;</span>
<span class="nc bnc" id="L2838" title="All 2 branches missed.">			while (rs1.next()) {</span>
<span class="nc" id="L2839">				gameAmtList = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L2840">				gameAmtList.add(rs1.getString(&quot;game_name&quot;));</span>
<span class="nc" id="L2841">				gameAmtList.add(FormatNumber.formatNumber(rs1</span>
						.getDouble(&quot;mrpSale&quot;)
						- rs1.getDouble(&quot;mrpSaleRef&quot;)));
<span class="nc" id="L2844">				gameAmtList.add(FormatNumber.formatNumber(rs1</span>
						.getDouble(&quot;netSale&quot;)
						- rs1.getDouble(&quot;netSaleRef&quot;)));
			}
<span class="nc" id="L2848">			dgMap.put(&quot;sale&quot;, gameAmtList);</span>
<span class="nc bnc" id="L2849" title="All 2 branches missed.">			while (rs2.next()) {</span>
<span class="nc" id="L2850">				gameAmtList = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L2851">				gameAmtList.add(rs2.getString(&quot;game_name&quot;));</span>
<span class="nc" id="L2852">				gameAmtList.add(rs2.getDouble(&quot;mrpPwt&quot;) + &quot;&quot;);</span>
<span class="nc" id="L2853">				gameAmtList.add(rs2.getDouble(&quot;netPwt&quot;) + &quot;&quot;);</span>
			}
<span class="nc" id="L2855">			dgMap.put(&quot;pwt&quot;, gameAmtList);</span>
<span class="nc" id="L2856">		} catch (SQLException e) {</span>
<span class="nc" id="L2857">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L2859">			try {</span>

<span class="nc" id="L2861">				System.out.println(&quot; closing connection  &quot;);</span>
<span class="nc bnc" id="L2862" title="All 6 branches missed.">				if (connection != null) {</span>
<span class="nc" id="L2863">					connection.close();</span>
				}
<span class="nc" id="L2865">			} catch (SQLException e) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L2867">				e.printStackTrace();</span>
<span class="nc" id="L2868">			}</span>
<span class="nc" id="L2869">		}</span>
<span class="nc" id="L2870">		return dgMap;</span>
	}

	public Map&lt;String, List&lt;String&gt;&gt; getSEDetailReport(DateBeans dBean,
			int orgId) {
<span class="nc" id="L2875">		Map&lt;String, List&lt;String&gt;&gt; seMap = new HashMap&lt;String, List&lt;String&gt;&gt;();</span>
<span class="nc" id="L2876">		DBConnect dbConnect = null;</span>
<span class="nc" id="L2877">		Connection connection = null;</span>
<span class="nc" id="L2878">		List&lt;Integer&gt; gameNbrList = null;</span>

		try {

<span class="nc" id="L2882">			connection = DBConnect.getConnection();</span>
<span class="nc" id="L2883">			PreparedStatement pstmt = null;</span>
<span class="nc" id="L2884">			pstmt = connection</span>
					.prepareStatement(&quot;select game_nbr from st_se_game_master where game_status != 'CLOSE' and game_status != 'TERMINATE'&quot;);
<span class="nc" id="L2886">			ResultSet rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2887" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L2888">				gameNbrList.add(rs.getInt(&quot;game_nbr&quot;));</span>
			}

<span class="nc" id="L2891">			String scratchSaleQuery = &quot;select sgm.game_id, sgm.game_name, (ticket_price*ifnull(sum(sold_tickets),0)) as ticketSale from st_se_game_master sgm, st_se_game_ticket_inv_history gtih where sgm.game_id = gtih.game_id and gtih.current_owner = 'RETAILER' and date &gt;= ? and date &lt; ? and current_owner_id = ? group by gtih.game_id&quot;;</span>
<span class="nc" id="L2892">			String scratchPwtQuery = &quot;&quot;;</span>
<span class="nc" id="L2893">		} catch (SQLException e) {</span>
<span class="nc" id="L2894">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L2896">			try {</span>

<span class="nc" id="L2898">				System.out.println(&quot; closing connection  &quot;);</span>
<span class="nc bnc" id="L2899" title="All 6 branches missed.">				if (connection != null) {</span>
<span class="nc" id="L2900">					connection.close();</span>
				}
<span class="nc" id="L2902">			} catch (SQLException e) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L2904">				e.printStackTrace();</span>
<span class="nc" id="L2905">			}</span>
<span class="nc" id="L2906">		}</span>
<span class="nc" id="L2907">		return seMap;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>