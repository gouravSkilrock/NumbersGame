<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LedgerHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.reportsMgmt.common</a> &gt; <span class="el_source">LedgerHelper.java</span></div><h1>LedgerHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.reportsMgmt.common;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.Timestamp;
import java.text.DateFormat;
import java.text.ParseException;
import java.util.ArrayList;
import java.util.Date;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.struts2.ServletActionContext;

import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.utility.FormatNumber;
import com.skilrock.lms.common.utility.PropertyLoader;
import com.skilrock.lms.coreEngine.userMgmt.common.updateLedgerHelper;

/**
 * This Helper class is for generation of Agent and Back Office ledger.
 * 
 * @author Skilrock Technologies
 * 
 */
<span class="nc" id="L31">public class LedgerHelper {</span>
<span class="nc" id="L32">	private static Log logger = LogFactory.getLog(LedgerHelper.class);</span>
<span class="nc" id="L33">	String address = null;</span>
	double AGENT_ACCOUNT_CURRENT;
	double agent_bank_acc_current;
	private int agent_id;
	double agent_pwt_charges_current;
	double agent_pwt_charges_rcv_current;
	double agent_pwt_pay_current;
	double agent_vat_pay_current;
	double agnt_prchse_current;
	double agnt_purchs_ret_current;
	double agnt_pwt_rcv_current;
	double agnt_sale_acc_current;
	double agnt_sale_ret_current;

	double BANK_ACC_CURRENT;

	double bo_bank_acc_current;
	double bo_pwt_charges_current;
	double bo_pwt_pay_current;
	double bo_sale_acc_current;
	double bo_sale_ret_current;
<span class="nc" id="L54">	Connection connection = null;</span>
<span class="nc" id="L55">	Date date = null;</span>
<span class="nc" id="L56">	DateFormat dateFormat1 = new java.text.SimpleDateFormat(&quot;dd-MM-yyyy&quot;);</span>

<span class="nc" id="L58">	String dep_Date = getDeployMentDate();</span>
<span class="nc" id="L59">	String genNum = null;</span>
	double GOVT_COMM_CURRENT;
<span class="nc" id="L61">	String orgName = null;</span>
	double PLAYER_CASH_CURRENT;
	double PLAYER_PWT_CURRENT;
	double PLAYER_TDS_CURRENT;
	// Date present_date = null;
<span class="nc" id="L66">	Timestamp present_date = null;</span>
	double PWT_CHARGES_CURRENT;
	double PWT_PAY_CURRENT;
<span class="nc" id="L69">	String query1 = null;</span>
<span class="nc" id="L70">	String query2 = null;</span>
<span class="nc" id="L71">	String query3 = null;</span>
<span class="nc" id="L72">	PreparedStatement rcptPS = null;</span>
<span class="nc" id="L73">	String rcptQry = null;</span>
<span class="nc" id="L74">	ResultSet rcptRS = null;</span>
	double retailer_org_id_current;
<span class="nc" id="L76">	ResultSet rs = null;</span>

<span class="nc" id="L78">	ResultSet rs1 = null;</span>
<span class="nc" id="L79">	ResultSet rs2 = null;</span>
	double SALE_ACC_CURRENT;
	double SALE_RET_CURRENT;

<span class="nc" id="L83">	Statement statement = null;</span>
<span class="nc" id="L84">	PreparedStatement stmt = null;</span>
<span class="nc" id="L85">	PreparedStatement stmt1 = null;</span>
<span class="nc" id="L86">	PreparedStatement stmt2 = null;</span>

	double TDS_PAY_CURRENT;
<span class="nc" id="L89">	Timestamp to_Date = null;</span>
	double UNCLM_GOVT_CURRENT;
<span class="nc" id="L91">	PreparedStatement updatePstmt = null;</span>
<span class="nc" id="L92">	PreparedStatement updPstmt = null;</span>
<span class="nc" id="L93">	PreparedStatement upPstmt = null;</span>
	double VAT_PAY_CURRENT;

	public void adhocUpdateClmBal() {
		try {
<span class="nc" id="L98">			updateLedgerHelper.updateLedger();</span>
<span class="nc" id="L99">		} catch (LMSException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L101">			e.printStackTrace();</span>
<span class="nc" id="L102">		}</span>
<span class="nc" id="L103">	}</span>

	public String getAddress(String addQuery, String id, String agentName)
			throws Exception {
<span class="nc" id="L107">		Connection connection = null;</span>

<span class="nc" id="L109">		connection = DBConnect.getConnection();</span>
<span class="nc" id="L110">		PreparedStatement stmt = null;</span>
<span class="nc" id="L111">		ResultSet rs = null;</span>
<span class="nc" id="L112">		String add1 = null;</span>
<span class="nc" id="L113">		String add2 = null;</span>
<span class="nc" id="L114">		String add3 = null;</span>
<span class="nc" id="L115">		String add4 = null;</span>
<span class="nc" id="L116">		String add5 = null;</span>

<span class="nc" id="L118">		stmt = connection.prepareStatement(addQuery);</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">		if (agentName != null) {</span>
<span class="nc" id="L120">			stmt.setString(1, agentName);</span>
		} else {
<span class="nc" id="L122">			stmt.setString(1, id);</span>
		}
<span class="nc" id="L124">		rs = stmt.executeQuery();</span>

<span class="nc bnc" id="L126" title="All 2 branches missed.">		while (rs.next()) {</span>
<span class="nc" id="L127">			add1 = rs.getString(1);</span>
<span class="nc" id="L128">			add2 = rs.getString(2);</span>
<span class="nc" id="L129">			add3 = rs.getString(3);</span>
<span class="nc" id="L130">			add4 = rs.getString(4);</span>
<span class="nc" id="L131">			add5 = rs.getString(5);</span>

		}
		try {

		} finally {
<span class="nc bnc" id="L137" title="All 4 branches missed.">			if (connection != null) {</span>
<span class="nc" id="L138">				connection.close();</span>
			}
		}

<span class="nc" id="L142">		return add1 + &quot;, &quot; + add2 + &quot;, &quot; + add3 + &quot;, &quot; + add4 + &quot;, &quot; + add5;</span>
	}

	/**
	 * This method is for entering the data into back office ledger.
	 * 
	 * @param toDate_Bean
	 *            is Date and used for comparing the date from Database.
	 * @throws LMSException
	 */
	public String getDeployMentDate() {
<span class="nc" id="L153">		String dep_Date = null;</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">		if (ServletActionContext.getServletContext() != null) {</span>
<span class="nc" id="L155">			dep_Date = (String) ServletActionContext.getServletContext()</span>
					.getAttribute(&quot;DEPLOYMENT_DATE&quot;);
		} else {
<span class="nc" id="L158">			PropertyLoader.loadProperties(&quot;RMS/LMS.properties&quot;);</span>
<span class="nc" id="L159">			dep_Date = PropertyLoader.getProperty(&quot;deployment_date&quot;);</span>
		}
<span class="nc" id="L161">		return dep_Date;</span>
	}

	// END OF METHOD

	// Fetching data for ajax list on Boledger

	public double getDouble(double number) {
<span class="nc" id="L169">		double d = 0.0;</span>
<span class="nc" id="L170">		d = number * 100;</span>
<span class="nc" id="L171">		d = Math.round(d);</span>
<span class="nc" id="L172">		d = d / 100;</span>

<span class="nc" id="L174">		return d;</span>
	}

	/**
	 * This method is used for fetching data for ajax request for ledger
	 * 
	 * @param ledgerType
	 * @param ledgerFor
	 * @param id
	 * @return Arraylist of names.
	 * @throws Exception
	 */
	public ArrayList getList(String ledgerType, String ledgerFor, int id)
			throws Exception {

<span class="nc" id="L189">		Connection connection = null;</span>

<span class="nc" id="L191">		connection = DBConnect.getConnection();</span>

<span class="nc" id="L193">		ArrayList selectList = new ArrayList();</span>
		Connection con;
<span class="nc" id="L195">		Statement stmt = null;</span>
<span class="nc" id="L196">		ResultSet rs = null;</span>

<span class="nc" id="L198">		stmt = connection.createStatement();</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">		if (ledgerFor.equals(&quot;BO&quot;)) {</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">			if (ledgerType.equals(&quot;Accountwise&quot;)) {</span>
<span class="nc" id="L201">				rs = stmt</span>
						.executeQuery(&quot;select account_type from st_lms_bo_current_balance &quot;);
<span class="nc bnc" id="L203" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L204">					selectList.add(rs.getString(&quot;account_type&quot;));</span>
				}
<span class="nc bnc" id="L206" title="All 4 branches missed.">			} else if (ledgerType.equals(&quot;Agentwise&quot;)</span>
					|| ledgerType.equals(&quot;consolidated&quot;)) {
<span class="nc" id="L208">				rs = stmt</span>
						.executeQuery(&quot;select name from st_lms_organization_master where organization_type='AGENT' order by name &quot;);
<span class="nc bnc" id="L210" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L211">					selectList.add(rs.getString(&quot;name&quot;));</span>
				}
			}
<span class="nc bnc" id="L214" title="All 2 branches missed.">		} else if (ledgerFor.equals(&quot;agent&quot;)) {</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">			if (ledgerType.equals(&quot;Accountwise&quot;)) {</span>
<span class="nc" id="L216">				rs = stmt</span>
						.executeQuery(&quot;select account_type from st_lms_agent_current_balance where agent_org_id = &quot;
								+ id);
<span class="nc bnc" id="L219" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L220">					selectList.add(rs.getString(&quot;account_type&quot;));</span>
				}
<span class="nc bnc" id="L222" title="All 4 branches missed.">			} else if (ledgerType.equals(&quot;Retailerwise&quot;)</span>
					|| ledgerType.equals(&quot;consolidated&quot;)) {
<span class="nc" id="L224">				rs = stmt</span>
						.executeQuery(&quot;select name from st_lms_organization_master where organization_type='RETAILER' and parent_id = &quot;
								+ id + &quot; order by name&quot;);
<span class="nc bnc" id="L227" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L228">					selectList.add(rs.getString(&quot;name&quot;));</span>
				}
			}

		}

		try {
		} finally {
<span class="nc bnc" id="L236" title="All 4 branches missed.">			if (connection != null) {</span>
<span class="nc" id="L237">				connection.close();</span>
			}
		}
<span class="nc" id="L240">		return selectList;</span>

	}

	public String getOrganizationName(int id) throws Exception {
<span class="nc" id="L245">		Connection connection = null;</span>

<span class="nc" id="L247">		connection = DBConnect.getConnection();</span>
<span class="nc" id="L248">		Statement stmt = null;</span>
<span class="nc" id="L249">		ResultSet rs = null;</span>
<span class="nc" id="L250">		String name = null;</span>

<span class="nc" id="L252">		stmt = connection.createStatement();</span>
<span class="nc" id="L253">		rs = stmt</span>
				.executeQuery(&quot;select name from st_lms_organization_master where organization_id= '&quot;
						+ id + &quot;'&quot;);
<span class="nc bnc" id="L256" title="All 2 branches missed.">		while (rs.next()) {</span>
<span class="nc" id="L257">			name = rs.getString(&quot;name&quot;);</span>
		}
		try {
		} finally {
<span class="nc bnc" id="L261" title="All 4 branches missed.">			if (connection != null) {</span>
<span class="nc" id="L262">				connection.close();</span>
			}
		}
<span class="nc" id="L265">		return name;</span>
	}

	public int getParentOrgId(int userOrgId) throws Exception {
<span class="nc" id="L269">		String query = &quot;select b.parent_id from st_lms_organization_master a, st_lms_organization_master b where a.organization_id=b.parent_id and b.organization_id='&quot;</span>
				+ userOrgId + &quot;'&quot;;

<span class="nc" id="L272">		Connection connection = null;</span>

<span class="nc" id="L274">		connection = DBConnect.getConnection();</span>
<span class="nc" id="L275">		Statement stmt = null;</span>
<span class="nc" id="L276">		ResultSet rs = null;</span>

<span class="nc" id="L278">		int parentId = 0;</span>

<span class="nc" id="L280">		stmt = connection.createStatement();</span>
<span class="nc" id="L281">		rs = stmt.executeQuery(query);</span>
<span class="nc bnc" id="L282" title="All 2 branches missed.">		while (rs.next()) {</span>
<span class="nc" id="L283">			parentId = rs.getInt(&quot;parent_id&quot;);</span>
		}
		try {

		} finally {
<span class="nc bnc" id="L288" title="All 4 branches missed.">			if (connection != null) {</span>
<span class="nc" id="L289">				connection.close();</span>
			}
		}
<span class="nc" id="L292">		return parentId;</span>

	}

	public String getParentOrgName(int userOrgId) throws Exception {
<span class="nc" id="L297">		String query = &quot;select a.name from st_lms_organization_master a, st_lms_organization_master b where a.organization_id=b.parent_id and b.organization_id='&quot;</span>
				+ userOrgId + &quot;'&quot;;

<span class="nc" id="L300">		Connection connection = null;</span>

<span class="nc" id="L302">		connection = DBConnect.getConnection();</span>
<span class="nc" id="L303">		Statement stmt = null;</span>
<span class="nc" id="L304">		ResultSet rs = null;</span>

<span class="nc" id="L306">		String parentName = null;</span>

<span class="nc" id="L308">		stmt = connection.createStatement();</span>
<span class="nc" id="L309">		rs = stmt.executeQuery(query);</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">		while (rs.next()) {</span>
<span class="nc" id="L311">			parentName = rs.getString(&quot;name&quot;);</span>
		}
		try {

		} finally {
<span class="nc bnc" id="L316" title="All 4 branches missed.">			if (connection != null) {</span>
<span class="nc" id="L317">				connection.close();</span>
			}
		}
<span class="nc" id="L320">		return parentName;</span>

	}

	public String getVatNumber(String id) throws Exception {
<span class="nc" id="L325">		Connection connection = null;</span>

<span class="nc" id="L327">		connection = DBConnect.getConnection();</span>
<span class="nc" id="L328">		Statement stmt = null;</span>
<span class="nc" id="L329">		ResultSet rs = null;</span>

<span class="nc" id="L331">		String vatNum = null;</span>

<span class="nc" id="L333">		stmt = connection.createStatement();</span>
<span class="nc" id="L334">		rs = stmt</span>
				.executeQuery(&quot;select vat_registration_nbr from st_lms_organization_master where organization_id= '&quot;
						+ id + &quot;'&quot;);
<span class="nc bnc" id="L337" title="All 2 branches missed.">		while (rs.next()) {</span>
<span class="nc" id="L338">			vatNum = rs.getString(&quot;vat_registration_nbr&quot;);</span>
		}
		try {

		} finally {
<span class="nc bnc" id="L343" title="All 4 branches missed.">			if (connection != null) {</span>
<span class="nc" id="L344">				connection.close();</span>
			}
		}
<span class="nc" id="L347">		return vatNum;</span>
	}

	/**
	 * This method is used from fetching the organization id of the name passed
	 * to method.
	 * 
	 * @param name
	 *            String
	 * @return integer Organization id
	 * @throws Exception
	 */
	public int id(String name) throws Exception {
<span class="nc" id="L360">		Connection connection = null;</span>

<span class="nc" id="L362">		connection = DBConnect.getConnection();</span>
<span class="nc" id="L363">		Statement stmt = null;</span>
<span class="nc" id="L364">		ResultSet rs = null;</span>
<span class="nc" id="L365">		int id = 0;</span>

<span class="nc" id="L367">		stmt = connection.createStatement();</span>
<span class="nc" id="L368">		rs = stmt</span>
				.executeQuery(&quot;select organization_id from st_lms_organization_master where name= '&quot;
						+ name + &quot;'&quot;);
<span class="nc bnc" id="L371" title="All 2 branches missed.">		while (rs.next()) {</span>
<span class="nc" id="L372">			id = rs.getInt(&quot;organization_id&quot;);</span>
		}

		try {
		} finally {
<span class="nc bnc" id="L377" title="All 4 branches missed.">			if (connection != null) {</span>
<span class="nc" id="L378">				connection.close();</span>
			}
		}

<span class="nc" id="L382">		return id;</span>
	}

	/**
	 * This method is for entering the data into agent ledger.
	 * 
	 * @param toDate_Bean
	 *            is Date and used for comparing the date from Database.
	 * @param userId
	 *            is integer and is current user's Organization Id
	 * @throws NumberFormatException
	 */

	public void ledgerAgentEntry(Timestamp toDate_Bean, int userId)
			throws NumberFormatException {

<span class="nc" id="L398">		int retailerPresent = 0;</span>
<span class="nc" id="L399">		agent_id = userId;</span>
		try {
			//  
<span class="nc" id="L402">			connection = DBConnect.getConnection();</span>
<span class="nc" id="L403">			connection.setAutoCommit(false);</span>
<span class="nc" id="L404">			present_date = null;</span>
<span class="nc" id="L405">			to_Date = toDate_Bean;</span>
<span class="nc" id="L406">			stmt1 = connection.prepareStatement(QueryManager</span>
					.getST6TransactionDate()); /* start from here */
<span class="nc" id="L408">			stmt1.setInt(1, agent_id);</span>
<span class="nc" id="L409">			rs1 = stmt1.executeQuery();</span>
<span class="nc" id="L410">			String rcptQry = &quot;select sbr.receipt_id,sbr.generated_id from st_lms_bo_receipts_trn_mapping sbrtm , st_lms_bo_receipts sbr where transaction_id=? and sbrtm.receipt_id=sbr.receipt_id&quot;;</span>

<span class="nc bnc" id="L412" title="All 2 branches missed.">			while (rs1.next()) {</span>
<span class="nc" id="L413">				present_date = rs1.getTimestamp(&quot;transaction_date&quot;);</span>
				break;
			}

<span class="nc bnc" id="L417" title="All 2 branches missed.">			if (stmt1 != null) {</span>
<span class="nc" id="L418">				stmt1.close();</span>
			}
<span class="nc bnc" id="L420" title="All 2 branches missed.">			if (rs1 != null) {</span>
<span class="nc" id="L421">				rs1.close();</span>
			}

<span class="nc bnc" id="L424" title="All 4 branches missed.">			if (present_date == null || present_date.before(to_Date)) {</span>
<span class="nc bnc" id="L425" title="All 2 branches missed.">				if (present_date == null) {</span>
					try {
<span class="nc" id="L427">						date = dateFormat1.parse(dep_Date);</span>
<span class="nc" id="L428">						present_date = new java.sql.Timestamp(date.getTime());</span>

<span class="nc" id="L430">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L432">						e.printStackTrace();</span>
<span class="nc" id="L433">					}</span>
				}
<span class="nc" id="L435">				logger.debug(&quot;LH-AGT**PresentDate-&quot; + present_date</span>
						+ &quot;**ToDate-&quot; + toDate_Bean);

<span class="nc" id="L438">				int i = 0;</span>
<span class="nc" id="L439">				String genNum = null;</span>
<span class="nc" id="L440">				stmt = connection.prepareStatement(QueryManager</span>
						.getST2AgentCurrentBal());
<span class="nc" id="L442">				stmt.setInt(1, agent_id);</span>
<span class="nc" id="L443">				rs = stmt.executeQuery();</span>
<span class="nc bnc" id="L444" title="All 2 branches missed.">				while (rs.next()) {</span>

<span class="nc bnc" id="L446" title="All 2 branches missed.">					if (rs.getString(&quot;account_type&quot;).equals(&quot;AGNT_BANK_ACC&quot;)) {</span>
<span class="nc" id="L447">						agent_bank_acc_current = rs</span>
								.getDouble(&quot;current_balance&quot;);
<span class="nc bnc" id="L449" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;AGNT_SALE_ACC&quot;)) {
<span class="nc" id="L451">						agnt_sale_acc_current = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L452" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;AGNT_SALE_RET&quot;)) {
<span class="nc" id="L454">						agnt_sale_ret_current = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;AGNT_PWT_PAY&quot;)) {
<span class="nc" id="L457">						agent_pwt_pay_current = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L458" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;AGNT_PWT_RCV&quot;)) {
<span class="nc" id="L460">						agnt_pwt_rcv_current = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L461" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;AGNT_PRCHSE_ACC&quot;)) {
<span class="nc" id="L463">						agnt_prchse_current = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L464" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;AGNT_PURCHS_RET_ACC&quot;)) {
<span class="nc" id="L466">						agnt_purchs_ret_current = rs</span>
								.getDouble(&quot;current_balance&quot;);
<span class="nc bnc" id="L468" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;BO_BANK_ACC&quot;)) {
<span class="nc" id="L470">						bo_bank_acc_current = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L471" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;BO_SALE_ACC&quot;)) {
<span class="nc" id="L473">						bo_sale_acc_current = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L474" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;BO_SALE_RET&quot;)) {
<span class="nc" id="L476">						bo_sale_ret_current = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L477" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;)</span>
							.equals(&quot;BO_PWT_PAY&quot;)) {
<span class="nc" id="L479">						bo_pwt_pay_current = rs.getDouble(&quot;current_balance&quot;);</span>
					}
					/*
					 * for collection charges
					 */
<span class="nc bnc" id="L484" title="All 2 branches missed.">					else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;AGNT_PWT_CHARGES_RCV&quot;)) {
<span class="nc" id="L486">						agent_pwt_charges_rcv_current = rs</span>
								.getDouble(&quot;current_balance&quot;);
<span class="nc bnc" id="L488" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;BO_PWT_CHARGES&quot;)) {
<span class="nc" id="L490">						bo_pwt_charges_current = rs</span>
								.getDouble(&quot;current_balance&quot;);
<span class="nc bnc" id="L492" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;AGENT_PWT_CHARGES&quot;)) {
<span class="nc" id="L494">						agent_pwt_charges_current = rs</span>
								.getDouble(&quot;current_balance&quot;);
<span class="nc bnc" id="L496" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;AGENT_VAT_PAY&quot;)) {
<span class="nc" id="L498">						agent_vat_pay_current = rs.getDouble(&quot;current_balance&quot;);</span>
					}
					/*
					 * for player pwt
					 */
<span class="nc bnc" id="L503" title="All 2 branches missed.">					else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;AGNT_PLAYER_TDS&quot;)) {
<span class="nc" id="L505">						PLAYER_TDS_CURRENT = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L506" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;AGNT_PLAYER_PWT&quot;)) {
<span class="nc" id="L508">						PLAYER_PWT_CURRENT = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L509" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;AGNT_PLAYER_CAS&quot;)) {
<span class="nc" id="L511">						PLAYER_CASH_CURRENT = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;AGNT_TDS_PAY&quot;)) {
<span class="nc" id="L514">						PLAYER_CASH_CURRENT = rs.getDouble(&quot;current_balance&quot;);</span>
					}

<span class="nc" id="L517">					i++;</span>
				}

<span class="nc bnc" id="L520" title="All 2 branches missed.">				if (rs != null) {</span>
<span class="nc" id="L521">					rs.close();</span>
				}
<span class="nc bnc" id="L523" title="All 2 branches missed.">				if (i == 0) {</span>
<span class="nc" id="L524">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('AGNT_BANK_ACC',0.0,&quot;
									+ agent_id + &quot;)&quot;);
<span class="nc" id="L527">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('AGNT_SALE_ACC',0.0,&quot;
									+ agent_id + &quot;)&quot;);
<span class="nc" id="L530">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('AGNT_SALE_RET',0.0,&quot;
									+ agent_id + &quot;)&quot;);
<span class="nc" id="L533">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('AGNT_PWT_PAY',0.0,&quot;
									+ agent_id + &quot;)&quot;);
<span class="nc" id="L536">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('AGNT_PWT_RCV',0.0,&quot;
									+ agent_id + &quot;)&quot;);
<span class="nc" id="L539">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('AGNT_PRCHSE_ACC',0.0,&quot;
									+ agent_id + &quot;)&quot;);
<span class="nc" id="L542">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('AGNT_PURCHS_RET_ACC',0.0,&quot;
									+ agent_id + &quot;)&quot;);
<span class="nc" id="L545">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('BO_BANK_ACC',0.0,&quot;
									+ agent_id + &quot;)&quot;);
<span class="nc" id="L548">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('BO_SALE_ACC',0.0,&quot;
									+ agent_id + &quot;)&quot;);
<span class="nc" id="L551">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('BO_SALE_RET',0.0,&quot;
									+ agent_id + &quot;)&quot;);
<span class="nc" id="L554">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('BO_PWT_PAY',0.0,&quot;
									+ agent_id + &quot;)&quot;);
					/*
					 * for player pwt
					 */
<span class="nc" id="L560">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('AGNT_PLAYER_TDS',0.0,&quot;
									+ agent_id + &quot;)&quot;);
<span class="nc" id="L563">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('AGNT_PLAYER_PWT',0.0,&quot;
									+ agent_id + &quot;)&quot;);
<span class="nc" id="L566">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('AGNT_PLAYER_CAS',0.0,&quot;
									+ agent_id + &quot;)&quot;);
<span class="nc" id="L569">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('AGNT_TDS_PAY',0.0,&quot;
									+ agent_id + &quot;)&quot;);
					/*
					 * for collection charges
					 */
<span class="nc" id="L575">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('AGNT_PWT_CHARGES_RCV',0.0,&quot;
									+ agent_id + &quot;)&quot;);
<span class="nc" id="L578">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('BO_PWT_CHARGES',0.0,&quot;
									+ agent_id + &quot;)&quot;);
<span class="nc" id="L581">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('AGENT_PWT_CHARGES',0.0,&quot;
									+ agent_id + &quot;)&quot;);
<span class="nc" id="L584">					stmt</span>
							.executeUpdate(&quot;insert into st_lms_agent_current_balance (account_type,current_balance,agent_org_id) values ('AGENT_VAT_PAY',0.0,&quot;
									+ agent_id + &quot;)&quot;);

<span class="nc bnc" id="L588" title="All 2 branches missed.">					if (stmt != null) {</span>
<span class="nc" id="L589">						stmt.close();</span>
					}

				}

				// ///////////////////////Start of Back Office and Agent Ledger
				// Entry Part/////////////

<span class="nc" id="L597">				stmt1 = connection.prepareStatement(QueryManager</span>
						.getST2BoAgtTransactions());
<span class="nc" id="L599">				stmt1.setTimestamp(1, present_date);</span>
<span class="nc" id="L600">				stmt1.setTimestamp(2, to_Date);</span>
<span class="nc" id="L601">				stmt1.setInt(3, agent_id);</span>
<span class="nc" id="L602">				logger.debug(&quot;LH-AGT**Select Trxn Master**&quot; + stmt1);</span>
<span class="nc" id="L603">				rs1 = stmt1.executeQuery();</span>

<span class="nc bnc" id="L605" title="All 2 branches missed.">				while (rs1.next()) {</span>

<span class="nc" id="L607">					int transaction_id = rs1.getInt(&quot;transaction_id&quot;);</span>
<span class="nc" id="L608">					String transaction_type = rs1.getString(&quot;transaction_type&quot;);</span>
<span class="nc" id="L609">					String RECEIPT_ID = &quot;N.A.&quot;;</span>

<span class="nc" id="L611">					rcptPS = connection.prepareStatement(rcptQry);</span>
<span class="nc" id="L612">					rcptPS.setInt(1, transaction_id);</span>
<span class="nc" id="L613">					rcptRS = rcptPS.executeQuery();</span>

<span class="nc bnc" id="L615" title="All 2 branches missed.">					while (rcptRS.next()) {</span>
<span class="nc" id="L616">						genNum = rcptRS.getString(&quot;generated_id&quot;);</span>
<span class="nc bnc" id="L617" title="All 8 branches missed.">						if (genNum != null</span>
								&amp;&amp; !genNum.trim().equals(&quot;&quot;)
								&amp;&amp; !(genNum.contains(&quot;DLB&quot;) || genNum
										.contains(&quot;DSB&quot;))) {
<span class="nc" id="L621">							RECEIPT_ID = rcptRS.getString(&quot;generated_id&quot;);</span>
						}

					}

<span class="nc bnc" id="L626" title="All 2 branches missed.">					if (rcptPS != null) {</span>
<span class="nc" id="L627">						rcptPS.close();</span>
					}
<span class="nc bnc" id="L629" title="All 2 branches missed.">					if (rcptRS != null) {</span>
<span class="nc" id="L630">						rcptRS.close();</span>
					}

<span class="nc" id="L633">					double amount = 0;</span>
<span class="nc" id="L634">					double pwt_charges_amount = 0;</span>
<span class="nc" id="L635">					Timestamp transaction_date = null;</span>
					// java.sql.Date transaction_date = null;
<span class="nc" id="L637">					String acc_type = &quot;&quot;;</span>
<span class="nc" id="L638">					String acc_type_charges = &quot;&quot;;</span>
<span class="nc" id="L639">					String saleQuery = &quot;&quot;;</span>
<span class="nc" id="L640">					String saleRetQuery = &quot;&quot;;</span>
<span class="nc bnc" id="L641" title="All 8 branches missed.">					if (transaction_type.equalsIgnoreCase(&quot;Sale&quot;)</span>
							|| transaction_type.equalsIgnoreCase(&quot;DG_SALE&quot;)
							|| transaction_type.equalsIgnoreCase(&quot;CS_SALE&quot;) || transaction_type.equalsIgnoreCase(&quot;OLA_DEPOSIT&quot;)) {
<span class="nc bnc" id="L644" title="All 2 branches missed.">						if (transaction_type.equalsIgnoreCase(&quot;Sale&quot;)) {</span>
<span class="nc" id="L645">							saleQuery = QueryManager.getST2BoSale();</span>
<span class="nc bnc" id="L646" title="All 2 branches missed.">						} else if(transaction_type.equalsIgnoreCase(&quot;DG_SALE&quot;)){</span>
<span class="nc" id="L647">							saleQuery = QueryManager.getST2BoDrwGmSale();</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">						}else if(transaction_type.equalsIgnoreCase(&quot;CS_SALE&quot;)){</span>
<span class="nc" id="L649">							saleQuery = QueryManager.getST2BoCsSale();</span>
<span class="nc bnc" id="L650" title="All 2 branches missed.">						}else if(transaction_type.equalsIgnoreCase(&quot;OLA_DEPOSIT&quot;))</span>
						{
<span class="nc" id="L652">							saleQuery = QueryManager.getST2BoOlaDeposit();</span>
						}
<span class="nc" id="L654">						stmt2 = connection.prepareStatement(saleQuery);</span>
<span class="nc" id="L655">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L656">						rs2 = stmt2.executeQuery();</span>
<span class="nc" id="L657">						logger.debug(&quot;LH-AGT**&quot; + transaction_type</span>
								+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
								+ RECEIPT_ID);
<span class="nc bnc" id="L660" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L661">							amount = rs2.getDouble(&quot;net_amt&quot;);</span>
<span class="nc" id="L662">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L664">							acc_type = &quot;AGNT_PRCHSE_ACC&quot;;</span>
						}

<span class="nc bnc" id="L667" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L668">							stmt2.close();</span>
						}
<span class="nc bnc" id="L670" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L671">							rs2.close();</span>
						}

<span class="nc" id="L674">						stmt = connection.prepareStatement(QueryManager</span>
								.getST6AgtCurrBal());
<span class="nc" id="L676">						stmt.setString(1, acc_type);</span>
<span class="nc" id="L677">						stmt.setInt(2, agent_id);</span>
<span class="nc" id="L678">						rs = stmt.executeQuery();</span>
<span class="nc bnc" id="L679" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L680">							agnt_prchse_current = rs</span>
									.getDouble(&quot;current_balance&quot;);

						}

<span class="nc bnc" id="L685" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L686">							stmt.close();</span>
						}
<span class="nc bnc" id="L688" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L689">							rs.close();</span>
						}

<span class="nc" id="L692">						agnt_prchse_current = agnt_prchse_current - amount;</span>
<span class="nc" id="L693">						bo_sale_acc_current = bo_sale_acc_current + amount;</span>

<span class="nc" id="L695">						logger.debug(&quot;LH-AGT**&quot; + transaction_date + &quot;**AMT-&quot;</span>
								+ amount + &quot;**ACT_TYPE-&quot; + acc_type
								+ &quot;**AGT_PURCH_ACC=&quot; + agnt_prchse_current
								+ &quot;**BO_SALE_ACC&quot; + bo_sale_acc_current);
<span class="nc" id="L699">						query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L700">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L702">						updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L703">						updatePstmt.setString(2, &quot;PURCH&quot;);</span>
<span class="nc" id="L704">						updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L705">						updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L706">						updatePstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L707">						updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L708">						updatePstmt.setString(7, agnt_prchse_current + &quot;&quot;);</span>
<span class="nc" id="L709">						updatePstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L710">						updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L711">						updatePstmt.execute();</span>

<span class="nc bnc" id="L713" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L714">							updatePstmt.close();</span>
						}

<span class="nc" id="L717">						query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L718">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L719">						upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L720">						upPstmt.setString(2, &quot;PURCH&quot;);</span>
<span class="nc" id="L721">						upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L722">						upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L723">						upPstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L724">						upPstmt.setString(6, &quot;BO_SALE_ACC&quot;);</span>
<span class="nc" id="L725">						upPstmt.setString(7, bo_sale_acc_current + &quot;&quot;);</span>
<span class="nc" id="L726">						upPstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L727">						upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L728">						upPstmt.execute();</span>

<span class="nc bnc" id="L730" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L731">							upPstmt.close();</span>
						}

<span class="nc" id="L734">						query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L735">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L736">						updPstmt.setString(1, agnt_prchse_current + &quot;&quot;);</span>
<span class="nc" id="L737">						updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L738">						updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L739">						updPstmt.execute();</span>

<span class="nc bnc" id="L741" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L742">							updPstmt.close();</span>
						}

<span class="nc bnc" id="L745" title="All 12 branches missed.">					} else if (transaction_type.equalsIgnoreCase(&quot;sale_ret&quot;)</span>
							|| transaction_type
									.equalsIgnoreCase(&quot;DG_REFUND_FAILED&quot;)
							|| transaction_type
									.equalsIgnoreCase(&quot;DG_REFUND_CANCEL&quot;)
							|| transaction_type
									.equalsIgnoreCase(&quot;CS_CANCEL_SERVER&quot;)
							|| transaction_type
									.equalsIgnoreCase(&quot;CS_CANCEL_RET&quot;) || transaction_type.equalsIgnoreCase(&quot;OLA_DEPOSIT_REFUND&quot;)) {

<span class="nc bnc" id="L755" title="All 2 branches missed.">						if (transaction_type.equalsIgnoreCase(&quot;sale_ret&quot;)) {</span>
<span class="nc" id="L756">							saleRetQuery = QueryManager.getST2BoSaleRet();</span>
<span class="nc bnc" id="L757" title="All 4 branches missed.">						} else if (transaction_type</span>
								.equalsIgnoreCase(&quot;DG_REFUND_FAILED&quot;)
								|| transaction_type
										.equalsIgnoreCase(&quot;DG_REFUND_CANCEL&quot;)) {
<span class="nc" id="L761">							saleRetQuery = QueryManager.getST2BoDrwGmRefnd();</span>
<span class="nc bnc" id="L762" title="All 4 branches missed.">						}else if(transaction_type</span>
								.equalsIgnoreCase(&quot;CS_CANCEL_SERVER&quot;)
								|| transaction_type
										.equalsIgnoreCase(&quot;CS_CANCEL_RET&quot;)){
<span class="nc" id="L766">							saleRetQuery = QueryManager.getST2BoCsRefnd();</span>
<span class="nc bnc" id="L767" title="All 2 branches missed.">						}else if(transaction_type.equalsIgnoreCase(&quot;OLA_DEPOSIT_REFUND&quot;))</span>
						{
<span class="nc" id="L769">							saleRetQuery = QueryManager.getST2BoOlaRefnd();</span>
						}
<span class="nc" id="L771">						stmt2 = connection.prepareStatement(saleRetQuery);</span>
<span class="nc" id="L772">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L773">						rs2 = stmt2.executeQuery();</span>
<span class="nc" id="L774">						logger.debug(&quot;LH-AGT**&quot; + transaction_type</span>
								+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
								+ RECEIPT_ID);
<span class="nc bnc" id="L777" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L778">							amount = rs2.getDouble(&quot;net_amt&quot;);</span>
<span class="nc" id="L779">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L781">							acc_type = &quot;AGNT_PURCHS_RET_ACC&quot;;</span>
						}

<span class="nc bnc" id="L784" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L785">							stmt2.close();</span>
						}
<span class="nc bnc" id="L787" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L788">							rs2.close();</span>
						}

<span class="nc" id="L791">						stmt = connection.prepareStatement(QueryManager</span>
								.getST6AgtCurrBal());
<span class="nc" id="L793">						stmt.setString(1, acc_type);</span>
<span class="nc" id="L794">						stmt.setInt(2, agent_id);</span>
<span class="nc" id="L795">						rs = stmt.executeQuery();</span>
<span class="nc bnc" id="L796" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L797">							agnt_purchs_ret_current = rs</span>
									.getDouble(&quot;current_balance&quot;);
						}

<span class="nc bnc" id="L801" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L802">							stmt.close();</span>
						}
<span class="nc bnc" id="L804" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L805">							rs.close();</span>
						}

<span class="nc" id="L808">						agnt_purchs_ret_current = agnt_purchs_ret_current</span>
								+ amount;
<span class="nc" id="L810">						bo_sale_ret_current = bo_sale_ret_current - amount;</span>

<span class="nc" id="L812">						logger.debug(&quot;LH-AGT**&quot; + transaction_date + &quot;**AMT-&quot;</span>
								+ amount + &quot;**ACT_TYPE-&quot; + acc_type
								+ &quot;**AGT_PURCH_RET_ACC=&quot;
								+ agnt_purchs_ret_current + &quot;**BO_SALE_RET_ACC&quot;
								+ bo_sale_ret_current);

<span class="nc" id="L818">						query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L819">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L820">						upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L821">						upPstmt.setString(2, &quot;PURCH_RET&quot;);</span>
<span class="nc" id="L822">						upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L823">						upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L824">						upPstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L825">						upPstmt.setString(6, &quot;BO_SALE_RET_ACC&quot;);</span>
<span class="nc" id="L826">						upPstmt.setString(7, bo_sale_ret_current + &quot;&quot;);</span>
<span class="nc" id="L827">						upPstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L828">						upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L829">						upPstmt.execute();</span>

<span class="nc bnc" id="L831" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L832">							upPstmt.close();</span>
						}

<span class="nc" id="L835">						query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L836">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L838">						updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L839">						updatePstmt.setString(2, &quot;PURCH_RET&quot;);</span>
<span class="nc" id="L840">						updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L841">						updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L842">						updatePstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L843">						updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L844">						updatePstmt.setString(7, agnt_purchs_ret_current + &quot;&quot;);</span>
<span class="nc" id="L845">						updatePstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L846">						updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L847">						updatePstmt.execute();</span>

<span class="nc bnc" id="L849" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L850">							updatePstmt.close();</span>
						}

<span class="nc" id="L853">						query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L854">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L855">						updPstmt.setString(1, agnt_purchs_ret_current + &quot;&quot;);</span>
<span class="nc" id="L856">						updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L857">						updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L858">						updPstmt.execute();</span>

<span class="nc bnc" id="L860" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L861">							updatePstmt.close();</span>
						}

					}

<span class="nc bnc" id="L866" title="All 2 branches missed.">					else if (transaction_type.equalsIgnoreCase(&quot;cheque&quot;)) {</span>
						// This has been changed to prepared statement 10-03-08
<span class="nc" id="L868">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST2BoChq());
<span class="nc" id="L870">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L871">						rs2 = stmt2.executeQuery();</span>
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2BoChq()+&quot;&quot;+
						// transaction_id + &quot;&quot;);;

<span class="nc bnc" id="L876" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L877">							amount = rs2.getDouble(&quot;cheque_amt&quot;);</span>
<span class="nc" id="L878">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L880">							acc_type = &quot;AGNT_BANK_ACC&quot;;</span>
						}

<span class="nc bnc" id="L883" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L884">							stmt2.close();</span>
						}
<span class="nc bnc" id="L886" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L887">							rs2.close();</span>
						}

<span class="nc" id="L890">						stmt = connection.prepareStatement(QueryManager</span>
								.getST6AgtCurrBal());
<span class="nc" id="L892">						stmt.setString(1, acc_type);</span>
<span class="nc" id="L893">						stmt.setInt(2, agent_id);</span>
<span class="nc" id="L894">						rs = stmt.executeQuery();</span>
<span class="nc" id="L895">						logger.debug(&quot;LH-AGT**&quot; + transaction_type</span>
								+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
								+ RECEIPT_ID);

<span class="nc bnc" id="L899" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L900">							agent_bank_acc_current = rs</span>
									.getDouble(&quot;current_balance&quot;);
						}

<span class="nc bnc" id="L904" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L905">							stmt.close();</span>
						}
<span class="nc bnc" id="L907" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L908">							rs.close();</span>
						}

<span class="nc" id="L911">						agent_bank_acc_current = agent_bank_acc_current</span>
								+ amount;
<span class="nc" id="L913">						bo_bank_acc_current = bo_bank_acc_current - amount;</span>
<span class="nc" id="L914">						logger.debug(&quot;LH-AGT**&quot; + transaction_date + &quot;**AMT-&quot;</span>
								+ amount + &quot;**ACT_TYPE-&quot; + acc_type
								+ &quot;**AGT_BANK_ACC=&quot; + agent_bank_acc_current
								+ &quot;**BO_ACC&quot; + bo_sale_acc_current);
<span class="nc" id="L918">						query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L919">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L920">						upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L921">						upPstmt.setString(2, &quot;BO_&quot; + transaction_type);</span>
<span class="nc" id="L922">						upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L923">						upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L924">						upPstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L925">						upPstmt.setString(6, &quot;BO_BANK_ACC&quot;);</span>
<span class="nc" id="L926">						upPstmt.setString(7, bo_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L927">						upPstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L928">						upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L929">						upPstmt.execute();</span>

<span class="nc bnc" id="L931" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L932">							upPstmt.close();</span>
						}

<span class="nc" id="L935">						query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L936">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L938">						updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L939">						updatePstmt.setString(2, &quot;BO_&quot; + transaction_type);</span>
<span class="nc" id="L940">						updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L941">						updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L942">						updatePstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L943">						updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L944">						updatePstmt.setString(7, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L945">						updatePstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L946">						updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L947">						updatePstmt.execute();</span>

<span class="nc bnc" id="L949" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L950">							updatePstmt.close();</span>
						}

<span class="nc" id="L953">						query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L954">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L955">						updPstmt.setString(1, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L956">						updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L957">						updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L958">						updPstmt.execute();</span>

<span class="nc bnc" id="L960" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L961">							updPstmt.close();</span>
						}

					}

<span class="nc bnc" id="L966" title="All 2 branches missed.">					else if (transaction_type.equalsIgnoreCase(&quot;chq_bounce&quot;)) {</span>
						// This has been changed to prepared statement 10-03-08
<span class="nc" id="L968">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST2BoChqBounce());
<span class="nc" id="L970">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L971">						rs2 = stmt2.executeQuery();</span>
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2BoChqBounce()+&quot;&quot;+
						// transaction_id + &quot;&quot;);
<span class="nc bnc" id="L975" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L976">							amount = rs2.getDouble(&quot;cheque_amt&quot;);</span>
<span class="nc" id="L977">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L979">							acc_type = &quot;AGNT_BANK_ACC&quot;;</span>
						}

<span class="nc bnc" id="L982" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L983">							stmt2.close();</span>
						}
<span class="nc bnc" id="L985" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L986">							rs2.close();</span>
						}

<span class="nc" id="L989">						stmt = connection.prepareStatement(QueryManager</span>
								.getST6AgtCurrBal());
<span class="nc" id="L991">						stmt.setString(1, acc_type);</span>
<span class="nc" id="L992">						stmt.setInt(2, agent_id);</span>
<span class="nc" id="L993">						rs = stmt.executeQuery();</span>
<span class="nc" id="L994">						logger.debug(&quot;LH-AGT**&quot; + transaction_type</span>
								+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
								+ RECEIPT_ID);
<span class="nc bnc" id="L997" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L998">							agent_bank_acc_current = rs</span>
									.getDouble(&quot;current_balance&quot;);
						}

<span class="nc bnc" id="L1002" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L1003">							stmt.close();</span>
						}
<span class="nc bnc" id="L1005" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L1006">							rs.close();</span>
						}

<span class="nc" id="L1009">						agent_bank_acc_current = agent_bank_acc_current</span>
								- amount;
<span class="nc" id="L1011">						bo_bank_acc_current = bo_bank_acc_current + amount;</span>
<span class="nc" id="L1012">						logger.debug(&quot;LH-AGT**&quot; + transaction_date + &quot;**AMT-&quot;</span>
								+ amount + &quot;**ACT_TYPE-&quot; + acc_type
								+ &quot;**AGT_BANK_ACC=&quot; + agent_bank_acc_current
								+ &quot;**BO_ACC&quot; + bo_sale_acc_current);
<span class="nc" id="L1016">						query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L1017">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L1019">						updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1020">						updatePstmt.setString(2, &quot;BO_CH_BOUN&quot;);</span>
<span class="nc" id="L1021">						updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1022">						updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1023">						updatePstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L1024">						updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L1025">						updatePstmt.setString(7, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1026">						updatePstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L1027">						updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1028">						updatePstmt.execute();</span>

<span class="nc bnc" id="L1030" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L1031">							updatePstmt.close();</span>
						}

<span class="nc" id="L1034">						query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L1035">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L1036">						upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1037">						upPstmt.setString(2, &quot;BO_CH_BOUN&quot;);</span>
<span class="nc" id="L1038">						upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1039">						upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1040">						upPstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L1041">						upPstmt.setString(6, &quot;BO_BANK_ACC&quot;);</span>
<span class="nc" id="L1042">						upPstmt.setString(7, bo_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1043">						upPstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L1044">						upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1045">						upPstmt.execute();</span>

<span class="nc bnc" id="L1047" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L1048">							upPstmt.close();</span>
						}

<span class="nc" id="L1051">						query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L1052">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L1053">						updPstmt.setString(1, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1054">						updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L1055">						updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L1056">						updPstmt.execute();</span>

<span class="nc bnc" id="L1058" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L1059">							updPstmt.close();</span>
						}

					}

<span class="nc bnc" id="L1064" title="All 4 branches missed.">					else if (transaction_type.equalsIgnoreCase(&quot;DR_NOTE_CASH&quot;)</span>
							|| transaction_type.equalsIgnoreCase(&quot;DR_NOTE&quot;)) {
						// This has been changed to prepared statement 10-03-08
<span class="nc" id="L1067">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST6BoDebitNote());
<span class="nc" id="L1069">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L1070">						rs2 = stmt2.executeQuery();</span>
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2BoChqBounce()+&quot;&quot;+
						// transaction_id + &quot;&quot;);
<span class="nc bnc" id="L1074" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L1075">							amount = rs2.getDouble(&quot;amount&quot;);</span>
<span class="nc" id="L1076">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L1078">							acc_type = &quot;AGNT_BANK_ACC&quot;;</span>
						}

<span class="nc bnc" id="L1081" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L1082">							stmt2.close();</span>
						}
<span class="nc bnc" id="L1084" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L1085">							rs2.close();</span>
						}
<span class="nc" id="L1087">						logger.debug(&quot;LH-AGT**&quot; + transaction_type</span>
								+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
								+ RECEIPT_ID);
<span class="nc" id="L1090">						stmt = connection.prepareStatement(QueryManager</span>
								.getST6AgtCurrBal());
<span class="nc" id="L1092">						stmt.setString(1, acc_type);</span>
<span class="nc" id="L1093">						stmt.setInt(2, agent_id);</span>
<span class="nc" id="L1094">						rs = stmt.executeQuery();</span>
						// This has been changed to prepared statement and moved
						// to query manager 10-03-08
						// rs = stmt.executeQuery(&quot;select current_balance from
						// st_lms_agent_current_balance where account_type = '&quot;+
						// acc_type + &quot;' and agent_id = &quot;+agent_id);
<span class="nc bnc" id="L1100" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L1101">							agent_bank_acc_current = rs</span>
									.getDouble(&quot;current_balance&quot;);
						}

<span class="nc bnc" id="L1105" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L1106">							stmt.close();</span>
						}
<span class="nc bnc" id="L1108" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L1109">							rs.close();</span>
						}

<span class="nc" id="L1112">						agent_bank_acc_current = agent_bank_acc_current</span>
								- amount;
<span class="nc" id="L1114">						bo_bank_acc_current = bo_bank_acc_current + amount;</span>
<span class="nc" id="L1115">						logger.debug(&quot;LH-AGT**&quot; + transaction_date + &quot;**AMT-&quot;</span>
								+ amount + &quot;**ACT_TYPE-&quot; + acc_type
								+ &quot;**AGT_BANK_ACC=&quot; + agent_bank_acc_current
								+ &quot;**BO_ACC&quot; + bo_bank_acc_current);
<span class="nc" id="L1119">						query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L1120">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L1122">						updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1123">						updatePstmt.setString(2, &quot;BO_&quot; + transaction_type);</span>
<span class="nc" id="L1124">						updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1125">						updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1126">						updatePstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L1127">						updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L1128">						updatePstmt.setString(7, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1129">						updatePstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L1130">						updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1131">						updatePstmt.execute();</span>

<span class="nc bnc" id="L1133" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L1134">							updatePstmt.close();</span>
						}

<span class="nc" id="L1137">						query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L1138">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L1139">						upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1140">						upPstmt.setString(2, &quot;BO_&quot; + transaction_type);</span>
<span class="nc" id="L1141">						upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1142">						upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1143">						upPstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L1144">						upPstmt.setString(6, &quot;BO_BANK_ACC&quot;);</span>
<span class="nc" id="L1145">						upPstmt.setString(7, bo_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1146">						upPstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L1147">						upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1148">						upPstmt.execute();</span>

<span class="nc bnc" id="L1150" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L1151">							upPstmt.close();</span>
						}

<span class="nc" id="L1154">						query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L1155">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L1156">						updPstmt.setString(1, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1157">						updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L1158">						updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L1159">						updPstmt.execute();</span>

<span class="nc bnc" id="L1161" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L1162">							updPstmt.close();</span>
						}

<span class="nc bnc" id="L1165" title="All 4 branches missed.">					} else if (transaction_type</span>
							.equalsIgnoreCase(&quot;CR_NOTE_CASH&quot;)
							|| transaction_type.equalsIgnoreCase(&quot;CR_NOTE&quot;)) {
						// This has been changed to prepared statement 10-03-08
<span class="nc" id="L1169">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST6BoCreditNote());
<span class="nc" id="L1171">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L1172">						rs2 = stmt2.executeQuery();</span>
<span class="nc" id="L1173">						logger.debug(&quot;LH-AGT**&quot; + transaction_type</span>
								+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
								+ RECEIPT_ID);
<span class="nc bnc" id="L1176" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L1177">							amount = rs2.getDouble(&quot;amount&quot;);</span>
<span class="nc" id="L1178">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L1180">							acc_type = &quot;AGNT_BANK_ACC&quot;;</span>
						}

<span class="nc bnc" id="L1183" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L1184">							stmt2.close();</span>
						}
<span class="nc bnc" id="L1186" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L1187">							rs2.close();</span>
						}

<span class="nc" id="L1190">						stmt = connection.prepareStatement(QueryManager</span>
								.getST6AgtCurrBal());
<span class="nc" id="L1192">						stmt.setString(1, acc_type);</span>
<span class="nc" id="L1193">						stmt.setInt(2, agent_id);</span>
<span class="nc" id="L1194">						rs = stmt.executeQuery();</span>

<span class="nc bnc" id="L1196" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L1197">							agent_bank_acc_current = rs</span>
									.getDouble(&quot;current_balance&quot;);
						}

<span class="nc bnc" id="L1201" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L1202">							stmt.close();</span>
						}
<span class="nc bnc" id="L1204" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L1205">							rs.close();</span>
						}

<span class="nc" id="L1208">						agent_bank_acc_current = agent_bank_acc_current</span>
								+ amount;
<span class="nc" id="L1210">						bo_bank_acc_current = bo_bank_acc_current - amount;</span>
<span class="nc" id="L1211">						logger.debug(&quot;LH-AGT**&quot; + transaction_date + &quot;**AMT-&quot;</span>
								+ amount + &quot;**ACT_TYPE-&quot; + acc_type
								+ &quot;**AGT_ACC&quot; + agent_bank_acc_current
								+ &quot;**BO_ACC&quot; + bo_bank_acc_current);
<span class="nc" id="L1215">						query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L1216">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L1217">						upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1218">						upPstmt.setString(2, &quot;BO_&quot; + transaction_type);</span>
<span class="nc" id="L1219">						upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1220">						upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1221">						upPstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L1222">						upPstmt.setString(6, &quot;BO_BANK_ACC&quot;);</span>
<span class="nc" id="L1223">						upPstmt.setString(7, bo_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1224">						upPstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L1225">						upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1226">						upPstmt.execute();</span>

<span class="nc bnc" id="L1228" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L1229">							upPstmt.close();</span>
						}

<span class="nc" id="L1232">						query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L1233">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L1235">						updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1236">						updatePstmt.setString(2, &quot;BO_&quot; + transaction_type);</span>
<span class="nc" id="L1237">						updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1238">						updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1239">						updatePstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L1240">						updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L1241">						updatePstmt.setString(7, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1242">						updatePstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L1243">						updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1244">						updatePstmt.execute();</span>

<span class="nc bnc" id="L1246" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L1247">							updatePstmt.close();</span>
						}

<span class="nc" id="L1250">						query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L1251">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L1252">						updPstmt.setString(1, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1253">						updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L1254">						updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L1255">						updPstmt.execute();</span>

<span class="nc bnc" id="L1257" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L1258">							updPstmt.close();</span>
						}

					}

<span class="nc bnc" id="L1263" title="All 2 branches missed.">					else if (transaction_type.equalsIgnoreCase(&quot;cash&quot;)) {</span>
<span class="nc" id="L1264">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST2BoCash());
<span class="nc" id="L1266">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L1267">						rs2 = stmt2.executeQuery();</span>
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2BoCash()+&quot;&quot;+
						// transaction_id + &quot;&quot;);
<span class="nc bnc" id="L1271" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L1272">							amount = rs2.getDouble(&quot;amount&quot;);</span>
<span class="nc" id="L1273">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L1275">							acc_type = &quot;AGNT_BANK_ACC&quot;;</span>
						}

<span class="nc bnc" id="L1278" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L1279">							stmt2.close();</span>
						}
<span class="nc bnc" id="L1281" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L1282">							rs2.close();</span>
						}
<span class="nc" id="L1284">						logger.debug(&quot;LH-AGT**&quot; + transaction_type</span>
								+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
								+ RECEIPT_ID);
<span class="nc" id="L1287">						stmt = connection.prepareStatement(QueryManager</span>
								.getST6AgtCurrBal());
<span class="nc" id="L1289">						stmt.setString(1, acc_type);</span>
<span class="nc" id="L1290">						stmt.setInt(2, agent_id);</span>
<span class="nc" id="L1291">						rs = stmt.executeQuery();</span>
						// This has been changed to prepared statement and moved
						// to query manager 10-03-08
						// rs = stmt.executeQuery(&quot;select current_balance from
						// st_lms_agent_current_balance where account_type = '&quot;+
						// acc_type + &quot;' and agent_id = &quot;+agent_id);
<span class="nc bnc" id="L1297" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L1298">							agent_bank_acc_current = rs</span>
									.getDouble(&quot;current_balance&quot;);
						}

<span class="nc bnc" id="L1302" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L1303">							stmt.close();</span>
						}
<span class="nc bnc" id="L1305" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L1306">							rs.close();</span>
						}

<span class="nc" id="L1309">						agent_bank_acc_current = agent_bank_acc_current</span>
								+ amount;
<span class="nc" id="L1311">						bo_bank_acc_current = bo_bank_acc_current - amount;</span>
<span class="nc" id="L1312">						logger.debug(&quot;LH-AGT**&quot; + transaction_date + &quot;**AMT-&quot;</span>
								+ amount + &quot;**ACT_TYPE-&quot; + acc_type
								+ &quot;**AGT_ACC-&quot; + agent_bank_acc_current
								+ &quot;**BO_ACC-&quot; + bo_bank_acc_current);
<span class="nc" id="L1316">						query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L1317">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L1318">						upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1319">						upPstmt.setString(2, &quot;BO_&quot; + transaction_type);</span>
<span class="nc" id="L1320">						upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1321">						upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1322">						upPstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L1323">						upPstmt.setString(6, &quot;BO_BANK_ACC&quot;);</span>
<span class="nc" id="L1324">						upPstmt.setString(7, bo_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1325">						upPstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L1326">						upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1327">						upPstmt.execute();</span>

<span class="nc bnc" id="L1329" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L1330">							upPstmt.close();</span>
						}

<span class="nc" id="L1333">						query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L1334">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L1336">						updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1337">						updatePstmt.setString(2, &quot;BO_&quot; + transaction_type);</span>
<span class="nc" id="L1338">						updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1339">						updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1340">						updatePstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L1341">						updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L1342">						updatePstmt.setString(7, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1343">						updatePstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L1344">						updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1345">						updatePstmt.execute();</span>

<span class="nc bnc" id="L1347" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L1348">							updatePstmt.close();</span>
						}

<span class="nc" id="L1351">						query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L1352">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L1353">						updPstmt.setString(1, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1354">						updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L1355">						updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L1356">						updPstmt.execute();</span>

<span class="nc bnc" id="L1358" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L1359">							updPstmt.close();</span>
						}

					}
<span class="nc bnc" id="L1363" title="All 2 branches missed.">					else if (transaction_type.equalsIgnoreCase(&quot;OLA_COMMISSION&quot;)) {</span>
<span class="nc" id="L1364">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST2BoOlaCommission());
<span class="nc" id="L1366">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L1367">						rs2 = stmt2.executeQuery();</span>
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2BoCash()+&quot;&quot;+
						// transaction_id + &quot;&quot;);
<span class="nc bnc" id="L1371" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L1372">							amount = rs2.getDouble(&quot;amount&quot;);</span>
<span class="nc" id="L1373">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L1375">							acc_type = &quot;AGNT_BANK_ACC&quot;;</span>
						}

<span class="nc bnc" id="L1378" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L1379">							stmt2.close();</span>
						}
<span class="nc bnc" id="L1381" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L1382">							rs2.close();</span>
						}
<span class="nc" id="L1384">						logger.debug(&quot;LH-AGT**&quot; + transaction_type</span>
								+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
								+ RECEIPT_ID);
<span class="nc" id="L1387">						stmt = connection.prepareStatement(QueryManager</span>
								.getST6AgtCurrBal());
<span class="nc" id="L1389">						stmt.setString(1, acc_type);</span>
<span class="nc" id="L1390">						stmt.setInt(2, agent_id);</span>
<span class="nc" id="L1391">						rs = stmt.executeQuery();</span>
						// This has been changed to prepared statement and moved
						// to query manager 10-03-08
						// rs = stmt.executeQuery(&quot;select current_balance from
						// st_lms_agent_current_balance where account_type = '&quot;+
						// acc_type + &quot;' and agent_id = &quot;+agent_id);
<span class="nc bnc" id="L1397" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L1398">							agent_bank_acc_current = rs</span>
									.getDouble(&quot;current_balance&quot;);
						}

<span class="nc bnc" id="L1402" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L1403">							stmt.close();</span>
						}
<span class="nc bnc" id="L1405" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L1406">							rs.close();</span>
						}

<span class="nc" id="L1409">						agent_bank_acc_current = agent_bank_acc_current</span>
								+ amount;
<span class="nc" id="L1411">						bo_bank_acc_current = bo_bank_acc_current - amount;</span>
<span class="nc" id="L1412">						logger.debug(&quot;LH-AGT**&quot; + transaction_date + &quot;**AMT-&quot;</span>
								+ amount + &quot;**ACT_TYPE-&quot; + acc_type
								+ &quot;**AGT_ACC-&quot; + agent_bank_acc_current
								+ &quot;**BO_ACC-&quot; + bo_bank_acc_current);
<span class="nc" id="L1416">						query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L1417">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L1418">						upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1419">						upPstmt.setString(2, &quot;BO_&quot; + transaction_type);</span>
<span class="nc" id="L1420">						upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1421">						upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1422">						upPstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L1423">						upPstmt.setString(6, &quot;BO_BANK_ACC&quot;);</span>
<span class="nc" id="L1424">						upPstmt.setString(7, bo_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1425">						upPstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L1426">						upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1427">						upPstmt.execute();</span>

<span class="nc bnc" id="L1429" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L1430">							upPstmt.close();</span>
						}

<span class="nc" id="L1433">						query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L1434">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L1436">						updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1437">						updatePstmt.setString(2, &quot;BO_&quot; + transaction_type);</span>
<span class="nc" id="L1438">						updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1439">						updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1440">						updatePstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L1441">						updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L1442">						updatePstmt.setString(7, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1443">						updatePstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L1444">						updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1445">						updatePstmt.execute();</span>

<span class="nc bnc" id="L1447" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L1448">							updatePstmt.close();</span>
						}

<span class="nc" id="L1451">						query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L1452">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L1453">						updPstmt.setString(1, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1454">						updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L1455">						updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L1456">						updPstmt.execute();</span>

<span class="nc bnc" id="L1458" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L1459">							updPstmt.close();</span>
						}

					}

<span class="nc bnc" id="L1464" title="All 10 branches missed.">					else if (transaction_type.equalsIgnoreCase(&quot;pwt&quot;)</span>
							|| transaction_type.equalsIgnoreCase(&quot;pwt_auto&quot;)
							|| transaction_type.equalsIgnoreCase(&quot;DG_PWT&quot;)
							|| transaction_type.equalsIgnoreCase(&quot;DG_PWT_AUTO&quot;) || transaction_type.equalsIgnoreCase(&quot;OLA_WITHDRAWL&quot;)) {
<span class="nc" id="L1468">						int result = 0;</span>
<span class="nc" id="L1469">						String pwtQuery = &quot;&quot;;</span>
						// This has been changed to prepared statement 10-03-08
<span class="nc bnc" id="L1471" title="All 4 branches missed.">						if (transaction_type.equalsIgnoreCase(&quot;DG_PWT&quot;)</span>
								|| transaction_type
										.equalsIgnoreCase(&quot;DG_PWT_AUTO&quot;)) {
<span class="nc" id="L1474">							pwtQuery = QueryManager.getST2BoDrGmPwtPay();</span>
<span class="nc bnc" id="L1475" title="All 2 branches missed.">						} else if(transaction_type.equalsIgnoreCase(&quot;OLA_WITHDRAWL&quot;))</span>
							{
<span class="nc" id="L1477">							pwtQuery = QueryManager.getST2BoOlaWithdrawl();</span>
							}else {
<span class="nc" id="L1479">							pwtQuery = QueryManager.getST2BoPwtPay();</span>
						}
<span class="nc" id="L1481">						stmt2 = connection.prepareStatement(pwtQuery);</span>
<span class="nc" id="L1482">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L1483">						rs2 = stmt2.executeQuery();</span>
<span class="nc" id="L1484">						logger.debug(&quot;LH-AGT**&quot; + transaction_type</span>
								+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
								+ RECEIPT_ID);
<span class="nc bnc" id="L1487" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L1488">							amount = rs2.getDouble(&quot;pwt_amount&quot;);</span>
<span class="nc" id="L1489">							pwt_charges_amount = rs2.getDouble(&quot;comm_amount&quot;);</span>
<span class="nc" id="L1490">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L1492">							acc_type = &quot;AGNT_PWT_RCV&quot;;</span>
<span class="nc" id="L1493">							acc_type_charges = &quot;AGNT_PWT_CHARGES_RCV&quot;;</span>
<span class="nc" id="L1494">							result++;</span>
						}

<span class="nc bnc" id="L1497" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L1498">							stmt2.close();</span>
						}
<span class="nc bnc" id="L1500" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L1501">							rs2.close();</span>
						}

<span class="nc bnc" id="L1504" title="All 2 branches missed.">						if (result != 0) {</span>
<span class="nc bnc" id="L1505" title="All 2 branches missed.">							if (acc_type.equals(&quot;AGNT_PWT_RCV&quot;)) {</span>

<span class="nc" id="L1507">								stmt = connection.prepareStatement(QueryManager</span>
										.getST6AgtCurrBal());
<span class="nc" id="L1509">								stmt.setString(1, acc_type);</span>
<span class="nc" id="L1510">								stmt.setInt(2, agent_id);</span>
<span class="nc" id="L1511">								rs = stmt.executeQuery();</span>

<span class="nc bnc" id="L1513" title="All 2 branches missed.">								while (rs.next()) {</span>
<span class="nc" id="L1514">									agnt_pwt_rcv_current = rs</span>
											.getDouble(&quot;current_balance&quot;);
								}

<span class="nc bnc" id="L1518" title="All 2 branches missed.">								if (stmt != null) {</span>
<span class="nc" id="L1519">									stmt.close();</span>
								}
<span class="nc bnc" id="L1521" title="All 2 branches missed.">								if (rs != null) {</span>
<span class="nc" id="L1522">									rs.close();</span>
								}

<span class="nc" id="L1525">								agnt_pwt_rcv_current = agnt_pwt_rcv_current</span>
										+ amount;
<span class="nc" id="L1527">								bo_pwt_pay_current = bo_pwt_pay_current</span>
										- amount;
<span class="nc" id="L1529">								logger.debug(&quot;LH-AGT**&quot; + transaction_date</span>
										+ &quot;**AMT-&quot; + amount + &quot;**ACT_TYPE-&quot;
										+ acc_type + &quot;**AGT_PWT_RCV_ACC-&quot;
										+ agnt_pwt_rcv_current
										+ &quot;**BO_PWT_PAY_ACC-&quot;
										+ bo_pwt_pay_current);

<span class="nc" id="L1536">								query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L1537">								upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L1538">								upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1539">								upPstmt.setString(2, &quot;BO_&quot; + transaction_type);</span>
<span class="nc" id="L1540">								upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1541">								upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1542">								upPstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L1543">								upPstmt.setString(6, &quot;BO_PWT_PAY&quot;);</span>
<span class="nc" id="L1544">								upPstmt.setString(7, bo_pwt_pay_current + &quot;&quot;);</span>
<span class="nc" id="L1545">								upPstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L1546">								upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1547">								upPstmt.execute();</span>

<span class="nc bnc" id="L1549" title="All 2 branches missed.">								if (upPstmt != null) {</span>
<span class="nc" id="L1550">									upPstmt.close();</span>
								}

<span class="nc" id="L1553">								query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L1554">								updatePstmt = connection</span>
										.prepareStatement(query1);

<span class="nc" id="L1557">								updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1558">								updatePstmt.setString(2, &quot;BO_&quot;</span>
										+ transaction_type);
<span class="nc" id="L1560">								updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1561">								updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1562">								updatePstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L1563">								updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L1564">								updatePstmt.setString(7, agnt_pwt_rcv_current</span>
										+ &quot;&quot;);
<span class="nc" id="L1566">								updatePstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L1567">								updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1568">								updatePstmt.execute();</span>

<span class="nc bnc" id="L1570" title="All 2 branches missed.">								if (updatePstmt != null) {</span>
<span class="nc" id="L1571">									updatePstmt.close();</span>
								}

<span class="nc" id="L1574">								query3 = QueryManager</span>
										.getST2UpadateAgentCurrentBal();
<span class="nc" id="L1576">								updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L1577">								updPstmt</span>
										.setString(1, agnt_pwt_rcv_current + &quot;&quot;);
<span class="nc" id="L1579">								updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L1580">								updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L1581">								updPstmt.execute();</span>

<span class="nc bnc" id="L1583" title="All 2 branches missed.">								if (updPstmt != null) {</span>
<span class="nc" id="L1584">									updPstmt.close();</span>
								}

							}/*
								 * for charges collection
								 */
<span class="nc bnc" id="L1590" title="All 2 branches missed.">							if (acc_type_charges.equals(&quot;AGNT_PWT_CHARGES_RCV&quot;)) {</span>

<span class="nc" id="L1592">								stmt = connection.prepareStatement(QueryManager</span>
										.getST6AgtCurrBal());
<span class="nc" id="L1594">								stmt.setString(1, acc_type_charges);</span>
<span class="nc" id="L1595">								stmt.setInt(2, agent_id);</span>
<span class="nc" id="L1596">								rs = stmt.executeQuery();</span>
								// This has been changed to prepared statement
								// and moved to query manager 10-03-08
								// rs = stmt.executeQuery(&quot;select
								// current_balance from
								// st_lms_agent_current_balance where
								// account_type = '&quot;+ acc_type + &quot;' and agent_id
								// = &quot;+agent_id);
<span class="nc bnc" id="L1604" title="All 2 branches missed.">								while (rs.next()) {</span>
<span class="nc" id="L1605">									agent_pwt_charges_rcv_current = rs</span>
											.getDouble(&quot;current_balance&quot;);
								}

<span class="nc bnc" id="L1609" title="All 2 branches missed.">								if (stmt != null) {</span>
<span class="nc" id="L1610">									stmt.close();</span>
								}
<span class="nc bnc" id="L1612" title="All 2 branches missed.">								if (rs != null) {</span>
<span class="nc" id="L1613">									rs.close();</span>
								}

<span class="nc" id="L1616">								agent_pwt_charges_rcv_current = agent_pwt_charges_rcv_current</span>
										+ pwt_charges_amount;
<span class="nc" id="L1618">								bo_pwt_charges_current = bo_pwt_charges_current</span>
										- pwt_charges_amount;

<span class="nc bnc" id="L1621" title="All 2 branches missed.">								if (pwt_charges_amount != 0.0) {</span>
<span class="nc" id="L1622">									query2 = QueryManager</span>
											.getST2InsertAgentLedger();
<span class="nc" id="L1624">									upPstmt = connection</span>
											.prepareStatement(query2);
<span class="nc" id="L1626">									upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1627">									upPstmt.setString(2, &quot;BO_&quot;</span>
											+ transaction_type);
<span class="nc" id="L1629">									upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1630">									upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1631">									upPstmt.setString(5, -pwt_charges_amount</span>
											+ &quot;&quot;);
<span class="nc" id="L1633">									upPstmt.setString(6, &quot;BO_PWT_CHARGES&quot;);</span>
<span class="nc" id="L1634">									upPstmt.setString(7, bo_pwt_charges_current</span>
											+ &quot;&quot;);
<span class="nc" id="L1636">									upPstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L1637">									upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1638">									upPstmt.execute();</span>

<span class="nc bnc" id="L1640" title="All 2 branches missed.">									if (upPstmt != null) {</span>
<span class="nc" id="L1641">										upPstmt.close();</span>
									}

<span class="nc" id="L1644">									query1 = QueryManager</span>
											.getST2InsertAgentLedger();
<span class="nc" id="L1646">									updatePstmt = connection</span>
											.prepareStatement(query1);

<span class="nc" id="L1649">									updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1650">									updatePstmt.setString(2, &quot;BO_&quot;</span>
											+ transaction_type);
<span class="nc" id="L1652">									updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1653">									updatePstmt.setTimestamp(4,</span>
											transaction_date);
<span class="nc" id="L1655">									updatePstmt.setString(5, pwt_charges_amount</span>
											+ &quot;&quot;);
<span class="nc" id="L1657">									updatePstmt.setString(6, acc_type_charges);</span>
<span class="nc" id="L1658">									updatePstmt.setString(7,</span>
											agent_pwt_charges_rcv_current + &quot;&quot;);
<span class="nc" id="L1660">									updatePstmt.setString(8, &quot;BO&quot;);</span>
<span class="nc" id="L1661">									updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1662">									updatePstmt.execute();</span>

<span class="nc bnc" id="L1664" title="All 2 branches missed.">									if (updatePstmt != null) {</span>
<span class="nc" id="L1665">										updatePstmt.close();</span>
									}

								}

<span class="nc" id="L1670">								query3 = QueryManager</span>
										.getST2UpadateAgentCurrentBal();
<span class="nc" id="L1672">								updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L1673">								updPstmt.setString(1,</span>
										agent_pwt_charges_rcv_current + &quot;&quot;);
<span class="nc" id="L1675">								updPstmt.setString(2, acc_type_charges);</span>
<span class="nc" id="L1676">								updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L1677">								updPstmt.execute();</span>

<span class="nc bnc" id="L1679" title="All 2 branches missed.">								if (updPstmt != null) {</span>
<span class="nc" id="L1680">									updPstmt.close();</span>
								}

							}
						} else {
<span class="nc" id="L1685">							System.out.println(&quot;Error in Transaction&quot;</span>
									+ transaction_id + &quot; and Transaction_type &quot;
									+ transaction_type);
						}
					}

<span class="nc" id="L1691">				}</span>

<span class="nc bnc" id="L1693" title="All 2 branches missed.">				if (stmt1 != null) {</span>
<span class="nc" id="L1694">					stmt1.close();</span>
				}
<span class="nc bnc" id="L1696" title="All 2 branches missed.">				if (rs1 != null) {</span>
<span class="nc" id="L1697">					rs1.close();</span>
				}

				// ///////////////////////////////////////////Agent Retailer
				// Transaction
				// Start////////////////////////////////////////////////////////////////////
<span class="nc" id="L1703">				String rcptQryAgt = &quot;select sar.receipt_id,sar.generated_id from st_lms_agent_receipts_trn_mapping sartm , st_lms_agent_receipts sar where transaction_id=? and sartm.receipt_id=sar.receipt_id&quot;;</span>

<span class="nc" id="L1705">				stmt1 = connection.prepareStatement(QueryManager</span>
						.getST6AgtTransaction());
<span class="nc" id="L1707">				stmt1.setTimestamp(1, present_date);</span>
<span class="nc" id="L1708">				stmt1.setTimestamp(2, to_Date);</span>
<span class="nc" id="L1709">				stmt1.setInt(3, agent_id);</span>
<span class="nc" id="L1710">				rs1 = stmt1.executeQuery();</span>

<span class="nc" id="L1712">				logger.debug(&quot;LH-AGT-RET**PresentDate-&quot; + present_date</span>
						+ &quot;**ToDate-&quot; + toDate_Bean);
<span class="nc bnc" id="L1714" title="All 2 branches missed.">				while (rs1.next()) {</span>

<span class="nc" id="L1716">					int transaction_id = rs1.getInt(&quot;transaction_id&quot;);</span>
<span class="nc" id="L1717">					String transaction_type = rs1.getString(&quot;transaction_type&quot;);</span>
<span class="nc" id="L1718">					String RECEIPT_ID = &quot;N.A.&quot;;</span>

<span class="nc" id="L1720">					rcptPS = connection.prepareStatement(rcptQryAgt);</span>
<span class="nc" id="L1721">					rcptPS.setInt(1, transaction_id);</span>
<span class="nc" id="L1722">					rcptRS = rcptPS.executeQuery();</span>

<span class="nc bnc" id="L1724" title="All 2 branches missed.">					while (rcptRS.next()) {</span>
<span class="nc" id="L1725">						genNum = rcptRS.getString(&quot;generated_id&quot;);</span>
<span class="nc bnc" id="L1726" title="All 8 branches missed.">						if (genNum != null</span>
								&amp;&amp; !genNum.trim().equals(&quot;&quot;)
								&amp;&amp; !(genNum.contains(&quot;DLA&quot;) || genNum
										.contains(&quot;DSA&quot;))) {
<span class="nc" id="L1730">							RECEIPT_ID = rcptRS.getString(&quot;generated_id&quot;);</span>
						}

					}

<span class="nc bnc" id="L1735" title="All 2 branches missed.">					if (rcptPS != null) {</span>
<span class="nc" id="L1736">						rcptPS.close();</span>
					}
<span class="nc bnc" id="L1738" title="All 2 branches missed.">					if (rcptRS != null) {</span>
<span class="nc" id="L1739">						rcptRS.close();</span>
					}

<span class="nc" id="L1742">					double amount = 0;</span>
<span class="nc" id="L1743">					double pwt_charges_amount = 0;</span>
					// java.sql.Date transaction_date = null;
<span class="nc" id="L1745">					Timestamp transaction_date = null;</span>
					// java.sql.Date TRANS_DATE = null;
<span class="nc" id="L1747">					String acc_type = &quot;&quot;;</span>
<span class="nc bnc" id="L1748" title="All 6 branches missed.">					if (transaction_type.equalsIgnoreCase(&quot;Sale&quot;)</span>
							|| transaction_type.equalsIgnoreCase(&quot;DG_SALE&quot;)
							|| transaction_type.equalsIgnoreCase(&quot;CS_SALE&quot;)) {
<span class="nc" id="L1751">						String saleQuery = &quot;&quot;;</span>
<span class="nc bnc" id="L1752" title="All 2 branches missed.">						if (transaction_type.equalsIgnoreCase(&quot;Sale&quot;)) {</span>
<span class="nc" id="L1753">							saleQuery = QueryManager.getST2AgentSale();</span>
<span class="nc bnc" id="L1754" title="All 2 branches missed.">						} else if(transaction_type.equalsIgnoreCase(&quot;DG_SALE&quot;)){</span>
<span class="nc" id="L1755">							saleQuery = QueryManager.getST2AgentDrGmSale();</span>
<span class="nc bnc" id="L1756" title="All 2 branches missed.">						}else if(transaction_type.equalsIgnoreCase(&quot;CS_SALE&quot;)){</span>
<span class="nc" id="L1757">							saleQuery = QueryManager.getST2AgentCSSale();</span>
						}
<span class="nc" id="L1759">						stmt2 = connection.prepareStatement(saleQuery);</span>
<span class="nc" id="L1760">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L1761">						rs2 = stmt2.executeQuery();</span>
						// This has been moved to query manager 10-03-08 and
						// statement has been changed in to Prepared statement
						// 10-03-08
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2AgentSale()+&quot;&quot;+
						// transaction_id + &quot;&quot;);
<span class="nc bnc" id="L1768" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L1769">							amount = rs2.getDouble(&quot;net_amt&quot;);</span>
<span class="nc" id="L1770">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L1772">							acc_type = &quot;&quot; + rs2.getInt(&quot;retailer_org_id&quot;);</span>
<span class="nc" id="L1773">							orgName = rs2.getString(&quot;name&quot;);</span>
						}

<span class="nc bnc" id="L1776" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L1777">							stmt2.close();</span>
						}
<span class="nc bnc" id="L1779" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L1780">							rs2.close();</span>
						}

<span class="nc" id="L1783">						stmt = connection.prepareStatement(QueryManager</span>
								.getST6AgtCurrBal());
<span class="nc" id="L1785">						stmt.setString(1, acc_type);</span>
<span class="nc" id="L1786">						stmt.setInt(2, agent_id);</span>
<span class="nc" id="L1787">						rs = stmt.executeQuery();</span>
<span class="nc" id="L1788">						logger.debug(&quot;LH-AGT-RET**&quot; + transaction_type</span>
								+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
								+ RECEIPT_ID);
<span class="nc bnc" id="L1791" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L1792">							retailer_org_id_current = rs</span>
									.getDouble(&quot;current_balance&quot;);

<span class="nc" id="L1795">							retailerPresent++;</span>
						}

<span class="nc bnc" id="L1798" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L1799">							stmt.close();</span>
						}
<span class="nc bnc" id="L1801" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L1802">							rs.close();</span>
						}

<span class="nc bnc" id="L1805" title="All 2 branches missed.">						if (retailerPresent == 0) {</span>

<span class="nc" id="L1807">							stmt = connection.prepareStatement(QueryManager</span>
									.getST6InsertAgentCurrBal());
<span class="nc" id="L1809">							stmt.setString(1, acc_type);</span>
<span class="nc" id="L1810">							stmt.setDouble(2, 0.0);</span>
<span class="nc" id="L1811">							stmt.setInt(3, agent_id);</span>
<span class="nc" id="L1812">							stmt.execute();</span>
<span class="nc" id="L1813">							retailer_org_id_current = 0.0;</span>

<span class="nc bnc" id="L1815" title="All 2 branches missed.">							if (stmt != null) {</span>
<span class="nc" id="L1816">								stmt.close();</span>
							}

						}
<span class="nc" id="L1820">						retailerPresent = 0;</span>

<span class="nc" id="L1822">						retailer_org_id_current = retailer_org_id_current</span>
								- amount;

<span class="nc" id="L1825">						agnt_sale_acc_current = agnt_sale_acc_current + amount;</span>
<span class="nc" id="L1826">						logger.debug(&quot;LH-AGT-RET**&quot; + transaction_date</span>
								+ &quot;**AMT-&quot; + amount + &quot;**ACT_TYPE-&quot; + acc_type
								+ &quot;**RET_ACC-&quot; + retailer_org_id_current
								+ &quot;**AGT_ACC-&quot; + agnt_sale_acc_current);
<span class="nc" id="L1830">						query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L1831">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L1833">						updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1834">						updatePstmt.setString(2, transaction_type);</span>
<span class="nc" id="L1835">						updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1836">						updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1837">						updatePstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L1838">						updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L1839">						updatePstmt.setString(7, retailer_org_id_current + &quot;&quot;);</span>
<span class="nc" id="L1840">						updatePstmt.setString(8, orgName);</span>
<span class="nc" id="L1841">						updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1842">						updatePstmt.execute();</span>

<span class="nc bnc" id="L1844" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L1845">							updatePstmt.close();</span>
						}

<span class="nc" id="L1848">						query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L1849">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L1850">						upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1851">						upPstmt.setString(2, transaction_type);</span>
<span class="nc" id="L1852">						upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1853">						upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1854">						upPstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L1855">						upPstmt.setString(6, &quot;AGNT_SALE_ACC&quot;);</span>
<span class="nc" id="L1856">						upPstmt.setString(7, agnt_sale_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1857">						upPstmt.setString(8, orgName);</span>
<span class="nc" id="L1858">						upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1859">						upPstmt.execute();</span>

<span class="nc bnc" id="L1861" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L1862">							upPstmt.close();</span>
						}

<span class="nc" id="L1865">						query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L1866">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L1867">						updPstmt.setString(1, retailer_org_id_current + &quot;&quot;);</span>
<span class="nc" id="L1868">						updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L1869">						updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L1870">						updPstmt.execute();</span>

<span class="nc bnc" id="L1872" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L1873">							updPstmt.close();</span>
						}

<span class="nc" id="L1876">					}</span>

<span class="nc bnc" id="L1878" title="All 2 branches missed.">					else if (transaction_type.equalsIgnoreCase(&quot;cheque&quot;)) {</span>
<span class="nc" id="L1879">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST2AgentChq());
<span class="nc" id="L1881">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L1882">						rs2 = stmt2.executeQuery();</span>

						// This has been changed into prepared Statement
						// 10-03-08

						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2AgentChq()+&quot;&quot;+
						// transaction_id + &quot;&quot;);

<span class="nc bnc" id="L1891" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L1892">							amount = rs2.getDouble(&quot;cheque_amt&quot;);</span>
<span class="nc" id="L1893">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
							// TRANS_DATE= new
							// java.sql.Date(transaction_date.getTime());
<span class="nc" id="L1897">							acc_type = &quot;&quot; + rs2.getInt(&quot;retailer_org_id&quot;);</span>
<span class="nc" id="L1898">							orgName = rs2.getString(&quot;name&quot;);</span>
						}

<span class="nc bnc" id="L1901" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L1902">							stmt2.close();</span>
						}
<span class="nc bnc" id="L1904" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L1905">							rs2.close();</span>
						}

<span class="nc" id="L1908">						stmt = connection.prepareStatement(QueryManager</span>
								.getST6AgtCurrBal());
<span class="nc" id="L1910">						stmt.setString(1, acc_type);</span>
<span class="nc" id="L1911">						stmt.setInt(2, agent_id);</span>
<span class="nc" id="L1912">						rs = stmt.executeQuery();</span>

<span class="nc bnc" id="L1914" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L1915">							retailer_org_id_current = rs</span>
									.getDouble(&quot;current_balance&quot;);
<span class="nc" id="L1917">							retailerPresent++;</span>

						}

<span class="nc bnc" id="L1921" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L1922">							stmt.close();</span>
						}
<span class="nc bnc" id="L1924" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L1925">							rs.close();</span>
						}

<span class="nc bnc" id="L1928" title="All 2 branches missed.">						if (retailerPresent == 0) {</span>

<span class="nc" id="L1930">							stmt = connection.prepareStatement(QueryManager</span>
									.getST6InsertAgentCurrBal());
<span class="nc" id="L1932">							stmt.setString(1, acc_type);</span>
<span class="nc" id="L1933">							stmt.setDouble(2, 0.0);</span>
<span class="nc" id="L1934">							stmt.setInt(3, agent_id);</span>
<span class="nc" id="L1935">							stmt.execute();</span>
<span class="nc" id="L1936">							retailer_org_id_current = 0.0;</span>

<span class="nc bnc" id="L1938" title="All 2 branches missed.">							if (stmt != null) {</span>
<span class="nc" id="L1939">								stmt.close();</span>
							}

						}
<span class="nc" id="L1943">						logger.debug(&quot;LH-AGT-RET**&quot; + transaction_type</span>
								+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
								+ RECEIPT_ID);
<span class="nc" id="L1946">						retailerPresent = 0;</span>
<span class="nc" id="L1947">						retailer_org_id_current = retailer_org_id_current</span>
								+ amount;

<span class="nc" id="L1950">						agent_bank_acc_current = agent_bank_acc_current</span>
								- amount;
<span class="nc" id="L1952">						logger.debug(&quot;LH-AGT-RET**&quot; + transaction_date</span>
								+ &quot;**AMT-&quot; + amount + &quot;**ACT_TYPE-&quot; + acc_type
								+ &quot;**RET_ACC-&quot; + retailer_org_id_current
								+ &quot;**AGT_ACC-&quot; + agent_bank_acc_current);
<span class="nc" id="L1956">						query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L1957">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L1958">						upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1959">						upPstmt.setString(2, transaction_type);</span>
<span class="nc" id="L1960">						upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1961">						upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1962">						upPstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L1963">						upPstmt.setString(6, &quot;AGNT_BANK_ACC&quot;);</span>
<span class="nc" id="L1964">						upPstmt.setString(7, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L1965">						upPstmt.setString(8, orgName);</span>
<span class="nc" id="L1966">						upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1967">						upPstmt.execute();</span>

<span class="nc bnc" id="L1969" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L1970">							upPstmt.close();</span>
						}

<span class="nc" id="L1973">						query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L1974">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L1976">						updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L1977">						updatePstmt.setString(2, transaction_type);</span>
<span class="nc" id="L1978">						updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L1979">						updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L1980">						updatePstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L1981">						updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L1982">						updatePstmt.setString(7, retailer_org_id_current + &quot;&quot;);</span>
<span class="nc" id="L1983">						updatePstmt.setString(8, orgName);</span>
<span class="nc" id="L1984">						updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L1985">						updatePstmt.execute();</span>

<span class="nc bnc" id="L1987" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L1988">							updatePstmt.close();</span>
						}

<span class="nc" id="L1991">						query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L1992">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L1993">						updPstmt.setString(1, retailer_org_id_current + &quot;&quot;);</span>
<span class="nc" id="L1994">						updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L1995">						updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L1996">						updPstmt.execute();</span>

<span class="nc bnc" id="L1998" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L1999">							updPstmt.close();</span>
						}

					}

<span class="nc bnc" id="L2004" title="All 2 branches missed.">					else if (transaction_type.equalsIgnoreCase(&quot;chq_bounce&quot;)) {</span>

<span class="nc" id="L2006">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST2AgentChqBounce());
<span class="nc" id="L2008">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L2009">						rs2 = stmt2.executeQuery();</span>
						// This has been changed to prepared statement 10-03-08
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2AgentChqBounce()+&quot;&quot;+
						// transaction_id + &quot;&quot;);
<span class="nc bnc" id="L2014" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L2015">							amount = rs2.getDouble(&quot;cheque_amt&quot;);</span>
<span class="nc" id="L2016">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
							// TRANS_DATE= new
							// java.sql.Date(transaction_date.getTime());
<span class="nc" id="L2020">							acc_type = &quot;&quot; + rs2.getInt(&quot;retailer_org_id&quot;);</span>
<span class="nc" id="L2021">							orgName = rs2.getString(&quot;name&quot;);</span>
						}

<span class="nc bnc" id="L2024" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L2025">							stmt2.close();</span>
						}
<span class="nc bnc" id="L2027" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L2028">							rs2.close();</span>
						}

<span class="nc" id="L2031">						stmt = connection.prepareStatement(QueryManager</span>
								.getST6AgtCurrBal());
<span class="nc" id="L2033">						stmt.setString(1, acc_type);</span>
<span class="nc" id="L2034">						stmt.setInt(2, agent_id);</span>
<span class="nc" id="L2035">						rs = stmt.executeQuery();</span>
						// This has been changed into Prepared statement and
						// moved to Query manager 10-03-08
						// rs = stmt.executeQuery(&quot;select current_balance from
						// st_lms_agent_current_balance where account_type = '&quot;+
						// acc_type + &quot;' and agent_id = &quot;+agent_id);

<span class="nc bnc" id="L2042" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L2043">							retailer_org_id_current = rs</span>
									.getDouble(&quot;current_balance&quot;);
<span class="nc" id="L2045">							retailerPresent++;</span>
						}

<span class="nc bnc" id="L2048" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L2049">							stmt.close();</span>
						}
<span class="nc bnc" id="L2051" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L2052">							rs.close();</span>
						}

<span class="nc bnc" id="L2055" title="All 2 branches missed.">						if (retailerPresent == 0) {</span>
<span class="nc" id="L2056">							stmt = connection.prepareStatement(QueryManager</span>
									.getST6InsertAgentCurrBal());
<span class="nc" id="L2058">							stmt.setString(1, acc_type);</span>
<span class="nc" id="L2059">							stmt.setDouble(2, 0.0);</span>
<span class="nc" id="L2060">							stmt.setInt(3, agent_id);</span>
<span class="nc" id="L2061">							stmt.execute();</span>
<span class="nc" id="L2062">							retailer_org_id_current = 0.0;</span>

<span class="nc bnc" id="L2064" title="All 2 branches missed.">							if (stmt != null) {</span>
<span class="nc" id="L2065">								stmt.close();</span>
							}

							// This has been moved into query manager and
							// changed to prepared statement 10-03-08
							// stmt.executeUpdate(&quot;insert into
							// st_lms_agent_current_balance
							// (account_type,current_balance,agent_id) values
							// ('&quot;+acc_type+&quot;',0.0,&quot;+agent_id+&quot;)&quot;);
						}
<span class="nc" id="L2075">						retailerPresent = 0;</span>

<span class="nc" id="L2077">						logger.debug(&quot;LH-AGT-RET**&quot; + transaction_type</span>
								+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
								+ RECEIPT_ID);
<span class="nc" id="L2080">						retailer_org_id_current = retailer_org_id_current</span>
								- amount;
<span class="nc" id="L2082">						agent_bank_acc_current = agent_bank_acc_current</span>
								+ amount;
<span class="nc" id="L2084">						logger.debug(&quot;LH-AGT-RET**&quot; + transaction_date</span>
								+ &quot;**AMT-&quot; + amount + &quot;**ACT_TYPE-&quot; + acc_type
								+ &quot;**RET_ACC-&quot; + retailer_org_id_current
								+ &quot;**AGT_ACC-&quot; + agent_bank_acc_current);
<span class="nc" id="L2088">						query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L2089">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L2091">						updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L2092">						updatePstmt.setString(2, transaction_type);</span>
<span class="nc" id="L2093">						updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L2094">						updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L2095">						updatePstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L2096">						updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L2097">						updatePstmt.setString(7, retailer_org_id_current + &quot;&quot;);</span>
<span class="nc" id="L2098">						updatePstmt.setString(8, orgName);</span>
<span class="nc" id="L2099">						updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L2100">						updatePstmt.execute();</span>

<span class="nc bnc" id="L2102" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L2103">							updatePstmt.close();</span>
						}

<span class="nc" id="L2106">						query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L2107">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L2108">						upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L2109">						upPstmt.setString(2, transaction_type);</span>
<span class="nc" id="L2110">						upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L2111">						upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L2112">						upPstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L2113">						upPstmt.setString(6, &quot;AGNT_BANK_ACC&quot;);</span>
<span class="nc" id="L2114">						upPstmt.setString(7, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L2115">						upPstmt.setString(8, orgName);</span>
<span class="nc" id="L2116">						upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L2117">						upPstmt.execute();</span>

<span class="nc bnc" id="L2119" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L2120">							upPstmt.close();</span>
						}

<span class="nc" id="L2123">						query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L2124">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L2125">						updPstmt.setString(1, retailer_org_id_current + &quot;&quot;);</span>
<span class="nc" id="L2126">						updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L2127">						updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L2128">						updPstmt.execute();</span>

<span class="nc bnc" id="L2130" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L2131">							updPstmt.close();</span>
						}

					}
					/*
					 * on abshishekhs recomendation
					 */

<span class="nc bnc" id="L2139" title="All 2 branches missed.">					else if (transaction_type.equalsIgnoreCase(&quot;vat&quot;)) {</span>

<span class="nc" id="L2141">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST6AgentVATPayable());
<span class="nc" id="L2143">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L2144">						rs2 = stmt2.executeQuery();</span>
						// This has been replaced by the obove prepared
						// statements statements 07-03-08
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2BoGovtComm()+&quot;&quot;+
						// transaction_id + &quot;&quot;);

<span class="nc bnc" id="L2151" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L2152">							amount = rs2.getDouble(&quot;amount&quot;);</span>
							// TRANSACTION_DATE =
							// rs2.getDate(&quot;transaction_date&quot;);
<span class="nc" id="L2155">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L2157">							acc_type = &quot;AGENT_VAT_PAY&quot;;</span>
						}

<span class="nc bnc" id="L2160" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L2161">							stmt2.close();</span>
						}
<span class="nc bnc" id="L2163" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L2164">							rs2.close();</span>
						}

<span class="nc" id="L2167">						agent_vat_pay_current = agent_vat_pay_current - amount;</span>
<span class="nc" id="L2168">						agent_bank_acc_current = agent_bank_acc_current</span>
								+ amount;

<span class="nc" id="L2171">						query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L2172">						updatePstmt = connection.prepareStatement(query1);</span>
<span class="nc" id="L2173">						updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L2174">						updatePstmt.setString(2, transaction_type);</span>
<span class="nc" id="L2175">						updatePstmt.setInt(3, transaction_id);</span>
						// updatePstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L2177">						updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L2178">						updatePstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L2179">						updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L2180">						updatePstmt.setString(7, agent_vat_pay_current + &quot;&quot;);</span>
<span class="nc" id="L2181">						updatePstmt.setString(8, &quot;GOVERNMENT&quot;);</span>
<span class="nc" id="L2182">						updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L2183">						updatePstmt.execute();</span>

<span class="nc bnc" id="L2185" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L2186">							updatePstmt.close();</span>
						}

<span class="nc" id="L2189">						query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L2190">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L2191">						upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L2192">						upPstmt.setString(2, transaction_type);</span>
<span class="nc" id="L2193">						upPstmt.setInt(3, transaction_id);</span>
						// upPstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L2195">						upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L2196">						upPstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L2197">						upPstmt.setString(6, &quot;AGNT_BANK_ACC&quot;);</span>
<span class="nc" id="L2198">						upPstmt.setString(7, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L2199">						upPstmt.setString(8, &quot;GOVERNMENT&quot;);</span>
<span class="nc" id="L2200">						upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L2201">						upPstmt.execute();</span>

<span class="nc bnc" id="L2203" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L2204">							upPstmt.close();</span>
						}

					}

					/*
					 */
<span class="nc bnc" id="L2211" title="All 4 branches missed.">					else if (transaction_type.equalsIgnoreCase(&quot;DR_NOTE_CASH&quot;)</span>
							|| transaction_type.equalsIgnoreCase(&quot;DR_NOTE&quot;)) {

<span class="nc" id="L2214">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST6AgentDebitNote());
<span class="nc" id="L2216">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L2217">						rs2 = stmt2.executeQuery();</span>
						// This has been changed to prepared statement 10-03-08
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2AgentChqBounce()+&quot;&quot;+
						// transaction_id + &quot;&quot;);
<span class="nc bnc" id="L2222" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L2223">							amount = rs2.getDouble(&quot;amount&quot;);</span>
<span class="nc" id="L2224">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
							// TRANS_DATE= new
							// java.sql.Date(transaction_date.getTime());
<span class="nc" id="L2228">							acc_type = &quot;&quot; + rs2.getInt(&quot;retailer_org_id&quot;);</span>
<span class="nc" id="L2229">							orgName = rs2.getString(&quot;name&quot;);</span>
						}

<span class="nc bnc" id="L2232" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L2233">							stmt2.close();</span>
						}
<span class="nc bnc" id="L2235" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L2236">							rs2.close();</span>
						}

<span class="nc" id="L2239">						stmt = connection.prepareStatement(QueryManager</span>
								.getST6AgtCurrBal());
<span class="nc" id="L2241">						stmt.setString(1, acc_type);</span>
<span class="nc" id="L2242">						stmt.setInt(2, agent_id);</span>
<span class="nc" id="L2243">						rs = stmt.executeQuery();</span>

<span class="nc bnc" id="L2245" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L2246">							retailer_org_id_current = rs</span>
									.getDouble(&quot;current_balance&quot;);
<span class="nc" id="L2248">							retailerPresent++;</span>
						}

<span class="nc bnc" id="L2251" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L2252">							stmt2.close();</span>
						}
<span class="nc bnc" id="L2254" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L2255">							rs2.close();</span>
						}

<span class="nc bnc" id="L2258" title="All 2 branches missed.">						if (retailerPresent == 0) {</span>
<span class="nc" id="L2259">							stmt = connection.prepareStatement(QueryManager</span>
									.getST6InsertAgentCurrBal());
<span class="nc" id="L2261">							stmt.setString(1, acc_type);</span>
<span class="nc" id="L2262">							stmt.setDouble(2, 0.0);</span>
<span class="nc" id="L2263">							stmt.setInt(3, agent_id);</span>
<span class="nc" id="L2264">							stmt.execute();</span>
<span class="nc" id="L2265">							retailer_org_id_current = 0.0;</span>

<span class="nc bnc" id="L2267" title="All 2 branches missed.">							if (stmt != null) {</span>
<span class="nc" id="L2268">								stmt.close();</span>
							}

							// This has been moved into query manager and
							// changed to prepared statement 10-03-08
							// stmt.executeUpdate(&quot;insert into
							// st_lms_agent_current_balance
							// (account_type,current_balance,agent_id) values
							// ('&quot;+acc_type+&quot;',0.0,&quot;+agent_id+&quot;)&quot;);
						}
<span class="nc" id="L2278">						retailerPresent = 0;</span>
<span class="nc" id="L2279">						retailer_org_id_current = retailer_org_id_current</span>
								- amount;
<span class="nc" id="L2281">						agent_bank_acc_current = agent_bank_acc_current</span>
								+ amount;

<span class="nc" id="L2284">						logger.debug(&quot;LH-AGT-RET**&quot; + transaction_type</span>
								+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
								+ RECEIPT_ID);
<span class="nc" id="L2287">						logger.debug(&quot;LH-AGT-RET**&quot; + transaction_date</span>
								+ &quot;**AMT-&quot; + amount + &quot;**ACT_TYPE-&quot; + acc_type
								+ &quot;**RET_ACC-&quot; + retailer_org_id_current
								+ &quot;**AGT_ACC-&quot; + agent_bank_acc_current);
<span class="nc" id="L2291">						query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L2292">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L2294">						updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L2295">						updatePstmt.setString(2, transaction_type);</span>
<span class="nc" id="L2296">						updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L2297">						updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L2298">						updatePstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L2299">						updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L2300">						updatePstmt.setString(7, retailer_org_id_current + &quot;&quot;);</span>
<span class="nc" id="L2301">						updatePstmt.setString(8, orgName);</span>
<span class="nc" id="L2302">						updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L2303">						updatePstmt.execute();</span>

<span class="nc bnc" id="L2305" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L2306">							updatePstmt.close();</span>
						}

<span class="nc" id="L2309">						query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L2310">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L2311">						upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L2312">						upPstmt.setString(2, transaction_type);</span>
<span class="nc" id="L2313">						upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L2314">						upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L2315">						upPstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L2316">						upPstmt.setString(6, &quot;AGNT_BANK_ACC&quot;);</span>
<span class="nc" id="L2317">						upPstmt.setString(7, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L2318">						upPstmt.setString(8, orgName);</span>
<span class="nc" id="L2319">						upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L2320">						upPstmt.execute();</span>

<span class="nc bnc" id="L2322" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L2323">							upPstmt.close();</span>
						}

<span class="nc" id="L2326">						query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L2327">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L2328">						updPstmt.setString(1, retailer_org_id_current + &quot;&quot;);</span>
<span class="nc" id="L2329">						updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L2330">						updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L2331">						updPstmt.execute();</span>

<span class="nc bnc" id="L2333" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L2334">							updPstmt.close();</span>
						}

					}
					// code for credit note entry in ledger @amit starts...

<span class="nc bnc" id="L2340" title="All 4 branches missed.">					else if (transaction_type.equalsIgnoreCase(&quot;CR_NOTE_CASH&quot;)</span>
							|| transaction_type.equalsIgnoreCase(&quot;CR_NOTE&quot;)) {
<span class="nc" id="L2342">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST6AgentCreditNote());
<span class="nc" id="L2344">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L2345">						rs2 = stmt2.executeQuery();</span>
						// This has been changed to prepared statement 10-03-08
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2AgentChqBounce()+&quot;&quot;+
						// transaction_id + &quot;&quot;);
<span class="nc bnc" id="L2350" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L2351">							amount = rs2.getDouble(&quot;amount&quot;);</span>
<span class="nc" id="L2352">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
							// TRANS_DATE= new
							// java.sql.Date(transaction_date.getTime());
<span class="nc" id="L2356">							acc_type = &quot;&quot; + rs2.getInt(&quot;retailer_org_id&quot;);</span>
<span class="nc" id="L2357">							orgName = rs2.getString(&quot;name&quot;);</span>
						}

<span class="nc bnc" id="L2360" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L2361">							stmt2.close();</span>
						}
<span class="nc bnc" id="L2363" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L2364">							rs2.close();</span>
						}

<span class="nc" id="L2367">						stmt = connection.prepareStatement(QueryManager</span>
								.getST6AgtCurrBal());
<span class="nc" id="L2369">						stmt.setString(1, acc_type);</span>
<span class="nc" id="L2370">						stmt.setInt(2, agent_id);</span>
<span class="nc" id="L2371">						rs = stmt.executeQuery();</span>

<span class="nc bnc" id="L2373" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L2374">							retailer_org_id_current = rs</span>
									.getDouble(&quot;current_balance&quot;);
<span class="nc" id="L2376">							retailerPresent++;</span>
						}

<span class="nc bnc" id="L2379" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L2380">							stmt2.close();</span>
						}
<span class="nc bnc" id="L2382" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L2383">							rs2.close();</span>
						}

<span class="nc bnc" id="L2386" title="All 2 branches missed.">						if (retailerPresent == 0) {</span>
<span class="nc" id="L2387">							stmt = connection.prepareStatement(QueryManager</span>
									.getST6InsertAgentCurrBal());
<span class="nc" id="L2389">							stmt.setString(1, acc_type);</span>
<span class="nc" id="L2390">							stmt.setDouble(2, 0.0);</span>
<span class="nc" id="L2391">							stmt.setInt(3, agent_id);</span>
<span class="nc" id="L2392">							stmt.execute();</span>
<span class="nc" id="L2393">							retailer_org_id_current = 0.0;</span>

<span class="nc bnc" id="L2395" title="All 2 branches missed.">							if (stmt != null) {</span>
<span class="nc" id="L2396">								stmt.close();</span>
							}

							// This has been moved into query manager and
							// changed to prepared statement 10-03-08
							// stmt.executeUpdate(&quot;insert into
							// st_lms_agent_current_balance
							// (account_type,current_balance,agent_id) values
							// ('&quot;+acc_type+&quot;',0.0,&quot;+agent_id+&quot;)&quot;);
						}
<span class="nc" id="L2406">						retailerPresent = 0;</span>
<span class="nc" id="L2407">						retailer_org_id_current = retailer_org_id_current</span>
								+ amount;
<span class="nc" id="L2409">						agent_bank_acc_current = agent_bank_acc_current</span>
								- amount;
<span class="nc" id="L2411">						logger.debug(&quot;LH-AGT-RET**&quot; + transaction_type</span>
								+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
								+ RECEIPT_ID);
<span class="nc" id="L2414">						logger.debug(&quot;LH-AGT-RET**&quot; + transaction_date</span>
								+ &quot;**AMT-&quot; + amount + &quot;**ACT_TYPE-&quot; + acc_type
								+ &quot;**RET_ACC-&quot; + retailer_org_id_current
								+ &quot;**AGT_ACC-&quot; + agent_bank_acc_current);
<span class="nc" id="L2418">						query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L2419">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L2421">						updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L2422">						updatePstmt.setString(2, transaction_type);</span>
<span class="nc" id="L2423">						updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L2424">						updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L2425">						updatePstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L2426">						updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L2427">						updatePstmt.setString(7, retailer_org_id_current + &quot;&quot;);</span>
<span class="nc" id="L2428">						updatePstmt.setString(8, orgName);</span>
<span class="nc" id="L2429">						updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L2430">						updatePstmt.execute();</span>

<span class="nc bnc" id="L2432" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L2433">							updatePstmt.close();</span>
						}

<span class="nc" id="L2436">						query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L2437">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L2438">						upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L2439">						upPstmt.setString(2, transaction_type);</span>
<span class="nc" id="L2440">						upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L2441">						upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L2442">						upPstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L2443">						upPstmt.setString(6, &quot;AGNT_BANK_ACC&quot;);</span>
<span class="nc" id="L2444">						upPstmt.setString(7, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L2445">						upPstmt.setString(8, orgName);</span>
<span class="nc" id="L2446">						upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L2447">						upPstmt.execute();</span>

<span class="nc bnc" id="L2449" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L2450">							upPstmt.close();</span>
						}

<span class="nc" id="L2453">						query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L2454">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L2455">						updPstmt.setString(1, retailer_org_id_current + &quot;&quot;);</span>
<span class="nc" id="L2456">						updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L2457">						updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L2458">						updPstmt.execute();</span>

<span class="nc bnc" id="L2460" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L2461">							updPstmt.close();</span>
						}
					}

					// code for credit note entry in ledger @amit ends...

<span class="nc bnc" id="L2467" title="All 10 branches missed.">					else if (transaction_type.equalsIgnoreCase(&quot;sale_ret&quot;)</span>
							|| transaction_type
									.equalsIgnoreCase(&quot;DG_REFUND_FAILED&quot;)
							|| transaction_type
									.equalsIgnoreCase(&quot;DG_REFUND_CANCEL&quot;)
							|| transaction_type
									.equalsIgnoreCase(&quot;CS_CANCEL_SERVER&quot;)
							|| transaction_type
									.equalsIgnoreCase(&quot;CS_CANCEL_RET&quot;)) {
<span class="nc" id="L2476">						String saleRetQuery = &quot;&quot;;</span>
<span class="nc bnc" id="L2477" title="All 2 branches missed.">						if (transaction_type.equalsIgnoreCase(&quot;sale_ret&quot;)) {</span>
<span class="nc" id="L2478">							saleRetQuery = QueryManager.getST2AgentSaleRet();</span>
<span class="nc bnc" id="L2479" title="All 4 branches missed.">						} else if (transaction_type</span>
								.equalsIgnoreCase(&quot;DG_REFUND_FAILED&quot;)
								|| transaction_type
										.equalsIgnoreCase(&quot;DG_REFUND_CANCEL&quot;)) {
<span class="nc" id="L2483">							saleRetQuery = QueryManager.getST2AgtDrwGmRefnd();</span>

<span class="nc bnc" id="L2485" title="All 4 branches missed.">						}else if (transaction_type</span>
								.equalsIgnoreCase(&quot;CS_CANCEL_SERVER&quot;)
								|| transaction_type
										.equalsIgnoreCase(&quot;CS_CANCEL_RET&quot;)) {
<span class="nc" id="L2489">							saleRetQuery = QueryManager.getST2AgtCSRefnd();</span>

						}
<span class="nc" id="L2492">						stmt2 = connection.prepareStatement(saleRetQuery);</span>
<span class="nc" id="L2493">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L2494">						rs2 = stmt2.executeQuery();</span>
						// This has been changed to prepared statement 10-03-08
						// Wrong query was being used here instead of sale
						// return query for sale was being used here
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2AgentSale()+&quot;&quot;+
						// transaction_id + &quot;&quot;);
<span class="nc bnc" id="L2501" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L2502">							amount = rs2.getDouble(&quot;net_amt&quot;);</span>
<span class="nc" id="L2503">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L2505">							acc_type = &quot;&quot; + rs2.getInt(&quot;retailer_org_id&quot;);</span>
<span class="nc" id="L2506">							orgName = rs2.getString(&quot;name&quot;);</span>
						}

<span class="nc bnc" id="L2509" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L2510">							stmt2.close();</span>
						}
<span class="nc bnc" id="L2512" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L2513">							rs2.close();</span>
						}

<span class="nc" id="L2516">						stmt = connection.prepareStatement(QueryManager</span>
								.getST6AgtCurrBal());
<span class="nc" id="L2518">						stmt.setString(1, acc_type);</span>
<span class="nc" id="L2519">						stmt.setInt(2, agent_id);</span>
<span class="nc" id="L2520">						rs = stmt.executeQuery();</span>

<span class="nc bnc" id="L2522" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L2523">							retailer_org_id_current = rs</span>
									.getDouble(&quot;current_balance&quot;);

<span class="nc" id="L2526">							retailerPresent++;</span>
						}

<span class="nc bnc" id="L2529" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L2530">							stmt.close();</span>
						}
<span class="nc bnc" id="L2532" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L2533">							rs.close();</span>
						}

<span class="nc bnc" id="L2536" title="All 2 branches missed.">						if (retailerPresent == 0) {</span>
<span class="nc" id="L2537">							stmt = connection.prepareStatement(QueryManager</span>
									.getST6InsertAgentCurrBal());
<span class="nc" id="L2539">							stmt.setString(1, acc_type);</span>
<span class="nc" id="L2540">							stmt.setDouble(2, 0.0);</span>
<span class="nc" id="L2541">							stmt.setInt(3, agent_id);</span>
<span class="nc" id="L2542">							stmt.execute();</span>
<span class="nc" id="L2543">							retailer_org_id_current = 0.0;</span>

<span class="nc bnc" id="L2545" title="All 2 branches missed.">							if (stmt != null) {</span>
<span class="nc" id="L2546">								stmt.close();</span>
							}
						}
<span class="nc" id="L2549">						retailerPresent = 0;</span>
<span class="nc" id="L2550">						retailer_org_id_current = retailer_org_id_current</span>
								+ amount;
<span class="nc" id="L2552">						agnt_sale_ret_current = agnt_sale_ret_current - amount;</span>
<span class="nc" id="L2553">						logger.debug(&quot;LH-AGT-RET**&quot; + transaction_type</span>
								+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
								+ RECEIPT_ID);
<span class="nc" id="L2556">						logger.debug(&quot;LH-AGT-RET**&quot; + transaction_date</span>
								+ &quot;**AMT-&quot; + amount + &quot;**ACT_TYPE-&quot; + acc_type
								+ &quot;**RET_ACC-&quot; + retailer_org_id_current
								+ &quot;**AGT_ACC-&quot; + agnt_sale_ret_current);
<span class="nc" id="L2560">						query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L2561">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L2562">						upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L2563">						upPstmt.setString(2, transaction_type);</span>
<span class="nc" id="L2564">						upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L2565">						upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L2566">						upPstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L2567">						upPstmt.setString(6, &quot;AGNT_SALE_RET_ACC&quot;);</span>
<span class="nc" id="L2568">						upPstmt.setString(7, agnt_sale_ret_current + &quot;&quot;);</span>
<span class="nc" id="L2569">						upPstmt.setString(8, orgName);</span>
<span class="nc" id="L2570">						upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L2571">						upPstmt.execute();</span>

<span class="nc bnc" id="L2573" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L2574">							upPstmt.close();</span>
						}

<span class="nc" id="L2577">						query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L2578">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L2580">						updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L2581">						updatePstmt.setString(2, transaction_type);</span>
<span class="nc" id="L2582">						updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L2583">						updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L2584">						updatePstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L2585">						updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L2586">						updatePstmt.setString(7, retailer_org_id_current + &quot;&quot;);</span>
<span class="nc" id="L2587">						updatePstmt.setString(8, orgName);</span>
<span class="nc" id="L2588">						updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L2589">						updatePstmt.execute();</span>

<span class="nc bnc" id="L2591" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L2592">							updatePstmt.close();</span>
						}

<span class="nc" id="L2595">						query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L2596">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L2597">						updPstmt.setString(1, retailer_org_id_current + &quot;&quot;);</span>
<span class="nc" id="L2598">						updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L2599">						updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L2600">						updPstmt.execute();</span>

<span class="nc bnc" id="L2602" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L2603">							updPstmt.close();</span>
						}

<span class="nc" id="L2606">					}</span>

<span class="nc bnc" id="L2608" title="All 8 branches missed.">					else if (transaction_type.equalsIgnoreCase(&quot;pwt&quot;)</span>
							|| transaction_type.equalsIgnoreCase(&quot;pwt_auto&quot;)
							|| transaction_type.equalsIgnoreCase(&quot;DG_PWT&quot;)
							|| transaction_type.equalsIgnoreCase(&quot;DG_PWT_AUTO&quot;)) {
<span class="nc" id="L2612">						int result = 0;</span>
<span class="nc" id="L2613">						String pwtQuery = &quot;&quot;;</span>
<span class="nc bnc" id="L2614" title="All 4 branches missed.">						if (transaction_type.equalsIgnoreCase(&quot;DG_PWT&quot;)</span>
								|| transaction_type
										.equalsIgnoreCase(&quot;DG_PWT_AUTO&quot;)) {
<span class="nc" id="L2617">							pwtQuery = QueryManager.getST2AgentDrGmPwtPay();</span>
						} else {
<span class="nc" id="L2619">							pwtQuery = QueryManager.getST2AgentPwtPay();</span>
						}
<span class="nc" id="L2621">						stmt2 = connection.prepareStatement(pwtQuery);</span>
<span class="nc" id="L2622">						stmt2.setInt(1, transaction_id);</span>

<span class="nc" id="L2624">						rs2 = stmt2.executeQuery();</span>

<span class="nc bnc" id="L2626" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L2627">							amount = rs2.getDouble(&quot;pwt_amount&quot;);</span>
<span class="nc" id="L2628">							pwt_charges_amount = rs2.getDouble(&quot;comm_amount&quot;);</span>
<span class="nc" id="L2629">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L2631">							acc_type = &quot;&quot; + rs2.getInt(&quot;retailer_org_id&quot;);</span>
<span class="nc" id="L2632">							orgName = rs2.getString(&quot;name&quot;);</span>

<span class="nc" id="L2634">							result++;</span>
						}

<span class="nc bnc" id="L2637" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L2638">							stmt2.close();</span>
						}
<span class="nc bnc" id="L2640" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L2641">							rs2.close();</span>
						}

<span class="nc bnc" id="L2644" title="All 2 branches missed.">						if (result != 0) {</span>
<span class="nc" id="L2645">							stmt = connection.prepareStatement(QueryManager</span>
									.getST6AgtCurrBal());
<span class="nc" id="L2647">							stmt.setString(1, acc_type);</span>
<span class="nc" id="L2648">							stmt.setInt(2, agent_id);</span>
<span class="nc" id="L2649">							rs = stmt.executeQuery();</span>
							// This has been changed into Prepared statement and
							// moved to Query manager 10-03-08
							// rs = stmt.executeQuery(&quot;select current_balance
							// from st_lms_agent_current_balance where
							// account_type = '&quot;+ acc_type + &quot;' and agent_id =
							// &quot;+agent_id);
<span class="nc bnc" id="L2656" title="All 2 branches missed.">							while (rs.next()) {</span>
<span class="nc" id="L2657">								retailer_org_id_current = rs</span>
										.getDouble(&quot;current_balance&quot;);
<span class="nc" id="L2659">								retailerPresent++;</span>
							}

<span class="nc bnc" id="L2662" title="All 2 branches missed.">							if (stmt != null) {</span>
<span class="nc" id="L2663">								stmt.close();</span>
							}
<span class="nc bnc" id="L2665" title="All 2 branches missed.">							if (rs != null) {</span>
<span class="nc" id="L2666">								rs.close();</span>
							}

<span class="nc bnc" id="L2669" title="All 2 branches missed.">							if (retailerPresent == 0) {</span>
<span class="nc" id="L2670">								stmt = connection.prepareStatement(QueryManager</span>
										.getST6InsertAgentCurrBal());
<span class="nc" id="L2672">								stmt.setString(1, acc_type);</span>
<span class="nc" id="L2673">								stmt.setDouble(2, 0.0);</span>
<span class="nc" id="L2674">								stmt.setInt(3, agent_id);</span>
<span class="nc" id="L2675">								stmt.execute();</span>
<span class="nc" id="L2676">								retailer_org_id_current = 0.0;</span>

<span class="nc bnc" id="L2678" title="All 2 branches missed.">								if (stmt != null) {</span>
<span class="nc" id="L2679">									stmt.close();</span>
								}

							}
<span class="nc" id="L2683">							retailerPresent = 0;</span>
							try {
<span class="nc" id="L2685">								retailer_org_id_current = getDouble(retailer_org_id_current)</span>
										+ amount;
<span class="nc" id="L2687">								agent_pwt_pay_current = getDouble(agent_pwt_pay_current)</span>
										- amount;

<span class="nc" id="L2690">							} catch (NumberFormatException e) {</span>
<span class="nc" id="L2691">							}</span>
<span class="nc" id="L2692">							logger.debug(&quot;LH-AGT-RET**&quot; + transaction_type</span>
									+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
									+ RECEIPT_ID);
<span class="nc" id="L2695">							logger.debug(&quot;LH-AGT-RET**&quot; + transaction_date</span>
									+ &quot;**AMT-&quot; + amount + &quot;**ACT_TYPE-&quot;
									+ acc_type + &quot;**RET_ACC-&quot;
									+ retailer_org_id_current + &quot;**AGT_ACC-&quot;
									+ agent_pwt_pay_current);
<span class="nc" id="L2700">							query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L2701">							upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L2702">							upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L2703">							upPstmt.setString(2, transaction_type);</span>
<span class="nc" id="L2704">							upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L2705">							upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L2706">							upPstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L2707">							upPstmt.setString(6, &quot;AGNT_PWT_PAY&quot;);</span>
<span class="nc" id="L2708">							upPstmt.setString(7, agent_pwt_pay_current + &quot;&quot;);</span>
<span class="nc" id="L2709">							upPstmt.setString(8, orgName);</span>
<span class="nc" id="L2710">							upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L2711">							upPstmt.execute();</span>

<span class="nc bnc" id="L2713" title="All 2 branches missed.">							if (upPstmt != null) {</span>
<span class="nc" id="L2714">								upPstmt.close();</span>
							}

<span class="nc" id="L2717">							query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L2718">							updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L2720">							updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L2721">							updatePstmt.setString(2, transaction_type);</span>
<span class="nc" id="L2722">							updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L2723">							updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L2724">							updatePstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L2725">							updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L2726">							updatePstmt.setString(7, retailer_org_id_current</span>
									+ &quot;&quot;);
<span class="nc" id="L2728">							updatePstmt.setString(8, orgName);</span>
<span class="nc" id="L2729">							updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L2730">							updatePstmt.execute();</span>

<span class="nc bnc" id="L2732" title="All 2 branches missed.">							if (updatePstmt != null) {</span>
<span class="nc" id="L2733">								updatePstmt.close();</span>
							}

<span class="nc" id="L2736">							query3 = QueryManager</span>
									.getST2UpadateAgentCurrentBal();
<span class="nc" id="L2738">							updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L2739">							updPstmt.setString(1, retailer_org_id_current + &quot;&quot;);</span>
<span class="nc" id="L2740">							updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L2741">							updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L2742">							updPstmt.execute();</span>

<span class="nc bnc" id="L2744" title="All 2 branches missed.">							if (updPstmt != null) {</span>
<span class="nc" id="L2745">								updPstmt.close();</span>
							}

							/*
							 * moved below for collection charges query3 =
							 * QueryManager.getST2UpadateAgentCurrentBal();
							 * updPstmt=connection.prepareStatement(query3);
							 * updPstmt.setString(1,
							 * retailer_org_id_current+&quot;&quot;);
							 * updPstmt.setString(2, acc_type);
							 * updPstmt.setInt(3, agent_id); updPstmt.execute();
							 */
							/*
							 * 
							 * for collection charges
							 */
							try {
<span class="nc" id="L2762">								retailer_org_id_current = getDouble(retailer_org_id_current)</span>
										+ pwt_charges_amount;
<span class="nc" id="L2764">								agent_pwt_charges_current = getDouble(agent_pwt_charges_current)</span>
										- pwt_charges_amount;

<span class="nc" id="L2767">							} catch (NumberFormatException e) {</span>
<span class="nc" id="L2768">							}</span>

<span class="nc bnc" id="L2770" title="All 2 branches missed.">							if (pwt_charges_amount != 0.0) {</span>
<span class="nc" id="L2771">								query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L2772">								upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L2773">								upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L2774">								upPstmt.setString(2, transaction_type);</span>
<span class="nc" id="L2775">								upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L2776">								upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L2777">								upPstmt.setString(5, -pwt_charges_amount + &quot;&quot;);</span>
<span class="nc" id="L2778">								upPstmt.setString(6, &quot;AGENT_PWT_CHARGES&quot;);</span>
<span class="nc" id="L2779">								upPstmt.setString(7, agent_pwt_charges_current</span>
										+ &quot;&quot;);
<span class="nc" id="L2781">								upPstmt.setString(8, orgName);</span>
<span class="nc" id="L2782">								upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L2783">								upPstmt.execute();</span>

<span class="nc bnc" id="L2785" title="All 2 branches missed.">								if (upPstmt != null) {</span>
<span class="nc" id="L2786">									upPstmt.close();</span>
								}

<span class="nc" id="L2789">								query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L2790">								updatePstmt = connection</span>
										.prepareStatement(query1);

<span class="nc" id="L2793">								updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L2794">								updatePstmt.setString(2, transaction_type);</span>
<span class="nc" id="L2795">								updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L2796">								updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L2797">								updatePstmt.setString(5, pwt_charges_amount</span>
										+ &quot;&quot;);
<span class="nc" id="L2799">								updatePstmt.setString(6, acc_type + &quot;#&quot;);</span>
<span class="nc" id="L2800">								updatePstmt.setString(7,</span>
										retailer_org_id_current + &quot;&quot;);
<span class="nc" id="L2802">								updatePstmt.setString(8, orgName);</span>
<span class="nc" id="L2803">								updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L2804">								updatePstmt.execute();</span>

<span class="nc bnc" id="L2806" title="All 2 branches missed.">								if (updatePstmt != null) {</span>
<span class="nc" id="L2807">									updatePstmt.close();</span>
								}

							}
<span class="nc" id="L2811">							query3 = QueryManager</span>
									.getST2UpadateAgentCurrentBal();
<span class="nc" id="L2813">							updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L2814">							updPstmt.setString(1, retailer_org_id_current + &quot;&quot;);</span>
<span class="nc" id="L2815">							updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L2816">							updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L2817">							updPstmt.execute();</span>

<span class="nc bnc" id="L2819" title="All 2 branches missed.">							if (updPstmt != null) {</span>
<span class="nc" id="L2820">								updPstmt.close();</span>
							}

						} else {
<span class="nc" id="L2824">							System.out.println(&quot;Error in Transaction at &quot;</span>
									+ transaction_id + &quot; and Transaction_type&quot;
									+ transaction_type);
						}
<span class="nc bnc" id="L2828" title="All 2 branches missed.">					} else if (transaction_type.equalsIgnoreCase(&quot;cash&quot;)) {</span>
<span class="nc" id="L2829">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST2AgentCash());
<span class="nc" id="L2831">						stmt2.setInt(1, transaction_id);</span>
<span class="nc" id="L2832">						rs2 = stmt2.executeQuery();</span>
						// This has been changed to prepared statement 10-03-08
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2AgentCash()+&quot;&quot;+
						// transaction_id + &quot;&quot;);
<span class="nc bnc" id="L2837" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L2838">							amount = rs2.getDouble(&quot;amount&quot;);</span>
<span class="nc" id="L2839">							transaction_date = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L2841">							acc_type = &quot;&quot; + rs2.getInt(&quot;retailer_org_id&quot;);</span>
<span class="nc" id="L2842">							orgName = rs2.getString(&quot;name&quot;);</span>
						}

<span class="nc bnc" id="L2845" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L2846">							stmt2.close();</span>
						}
<span class="nc bnc" id="L2848" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L2849">							rs2.close();</span>
						}

<span class="nc" id="L2852">						stmt = connection.prepareStatement(QueryManager</span>
								.getST6AgtCurrBal());
<span class="nc" id="L2854">						stmt.setString(1, acc_type);</span>
<span class="nc" id="L2855">						stmt.setInt(2, agent_id);</span>
<span class="nc" id="L2856">						rs = stmt.executeQuery();</span>

<span class="nc bnc" id="L2858" title="All 2 branches missed.">						while (rs.next()) {</span>

<span class="nc" id="L2860">							retailer_org_id_current = rs</span>
									.getDouble(&quot;current_balance&quot;);

<span class="nc" id="L2863">							retailerPresent++;</span>
						}

<span class="nc bnc" id="L2866" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L2867">							stmt.close();</span>
						}
<span class="nc bnc" id="L2869" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L2870">							rs.close();</span>
						}

<span class="nc bnc" id="L2873" title="All 2 branches missed.">						if (retailerPresent == 0) {</span>
<span class="nc" id="L2874">							stmt = connection.prepareStatement(QueryManager</span>
									.getST6InsertAgentCurrBal());
<span class="nc" id="L2876">							stmt.setString(1, acc_type);</span>
<span class="nc" id="L2877">							stmt.setDouble(2, 0.0);</span>
<span class="nc" id="L2878">							stmt.setInt(3, agent_id);</span>
<span class="nc" id="L2879">							stmt.execute();</span>
<span class="nc" id="L2880">							retailer_org_id_current = 0.0;</span>

<span class="nc bnc" id="L2882" title="All 2 branches missed.">							if (stmt != null) {</span>
<span class="nc" id="L2883">								stmt.close();</span>
							}

							// This has been moved into query manager and
							// changed to prepared statement 10-03-08
							// stmt.executeUpdate(&quot;insert into
							// st_lms_agent_current_balance
							// (account_type,current_balance,agent_id) values
							// ('&quot;+acc_type+&quot;',0.0,&quot;+agent_id+&quot;)&quot;);
						}
<span class="nc" id="L2893">						retailerPresent = 0;</span>
<span class="nc" id="L2894">						agent_bank_acc_current = agent_bank_acc_current</span>
								- amount;
<span class="nc" id="L2896">						retailer_org_id_current = retailer_org_id_current</span>
								+ amount;
<span class="nc" id="L2898">						logger.debug(&quot;LH-AGT-RET**&quot; + transaction_type</span>
								+ &quot;**TRX_ID-&quot; + transaction_id + &quot;**R_ID-&quot;
								+ RECEIPT_ID);
<span class="nc" id="L2901">						logger.debug(&quot;LH-AGT-RET**&quot; + transaction_date</span>
								+ &quot;**AMT-&quot; + amount + &quot;**ACT_TYPE-&quot; + acc_type
								+ &quot;**RET_ACC-&quot; + retailer_org_id_current
								+ &quot;**AGT_ACC-&quot; + agent_bank_acc_current);
<span class="nc" id="L2905">						query2 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L2906">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L2907">						upPstmt.setInt(1, agent_id);</span>
<span class="nc" id="L2908">						upPstmt.setString(2, transaction_type);</span>
<span class="nc" id="L2909">						upPstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L2910">						upPstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L2911">						upPstmt.setString(5, -amount + &quot;&quot;);</span>
<span class="nc" id="L2912">						upPstmt.setString(6, &quot;AGNT_BANK_ACC&quot;);</span>
<span class="nc" id="L2913">						upPstmt.setString(7, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L2914">						upPstmt.setString(8, orgName);</span>
<span class="nc" id="L2915">						upPstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L2916">						upPstmt.execute();</span>

<span class="nc bnc" id="L2918" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L2919">							upPstmt.close();</span>
						}

<span class="nc" id="L2922">						query1 = QueryManager.getST2InsertAgentLedger();</span>
<span class="nc" id="L2923">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L2925">						updatePstmt.setInt(1, agent_id);</span>
<span class="nc" id="L2926">						updatePstmt.setString(2, transaction_type);</span>
<span class="nc" id="L2927">						updatePstmt.setInt(3, transaction_id);</span>
<span class="nc" id="L2928">						updatePstmt.setTimestamp(4, transaction_date);</span>
<span class="nc" id="L2929">						updatePstmt.setString(5, amount + &quot;&quot;);</span>
<span class="nc" id="L2930">						updatePstmt.setString(6, acc_type);</span>
<span class="nc" id="L2931">						updatePstmt.setString(7, retailer_org_id_current + &quot;&quot;);</span>
<span class="nc" id="L2932">						updatePstmt.setString(8, orgName);</span>
<span class="nc" id="L2933">						updatePstmt.setString(9, RECEIPT_ID);</span>
<span class="nc" id="L2934">						updatePstmt.execute();</span>

<span class="nc bnc" id="L2936" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L2937">							updatePstmt.close();</span>
						}

<span class="nc" id="L2940">						query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L2941">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L2942">						updPstmt.setString(1, retailer_org_id_current + &quot;&quot;);</span>
<span class="nc" id="L2943">						updPstmt.setString(2, acc_type);</span>
<span class="nc" id="L2944">						updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L2945">						updPstmt.execute();</span>

<span class="nc bnc" id="L2947" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L2948">							updPstmt.close();</span>
						}

<span class="nc bnc" id="L2951" title="All 4 branches missed.">					} else if (transaction_type.equalsIgnoreCase(&quot;pwt_plr&quot;)</span>
							|| transaction_type.equalsIgnoreCase(&quot;dg_pwt_plr&quot;)) {

<span class="nc" id="L2954">						double PWT_AMT = 0;</span>
<span class="nc" id="L2955">						double TAX_AMT = 0;</span>
<span class="nc" id="L2956">						double NET_AMT = 0;</span>
<span class="nc" id="L2957">						String directPwtPlrQry = &quot;&quot;;</span>
<span class="nc bnc" id="L2958" title="All 2 branches missed.">						if (transaction_type.equalsIgnoreCase(&quot;dg_pwt_plr&quot;)) {</span>
<span class="nc" id="L2959">							directPwtPlrQry = QueryManager</span>
									.getST2AgentDGPwtPlr();
						} else {
<span class="nc" id="L2962">							directPwtPlrQry = QueryManager.getST2AgentPwtPlr();</span>
						}
<span class="nc" id="L2964">						stmt = connection.prepareStatement(directPwtPlrQry);</span>
<span class="nc" id="L2965">						stmt.setInt(1, transaction_id);</span>
<span class="nc" id="L2966">						rs = stmt.executeQuery();</span>
						// This has been replaced by the obove prepared
						// statements statements 07-03-08
						// rs =
						// stmt.executeQuery(QueryManager.getST2BoPwtPlr()+&quot;&quot;+
						// transaction_id + &quot;&quot;);
<span class="nc bnc" id="L2972" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L2973">							PWT_AMT = rs.getDouble(&quot;pwt_amt&quot;);</span>
<span class="nc" id="L2974">							TAX_AMT = rs.getDouble(&quot;tax_amt&quot;);</span>
<span class="nc" id="L2975">							NET_AMT = rs.getDouble(&quot;net_amt&quot;);</span>
<span class="nc" id="L2976">							transaction_type = rs.getString(&quot;transaction_type&quot;);</span>
							// TRANSACTION_DATE =
							// rs.getDate(&quot;transaction_date&quot;);
<span class="nc" id="L2979">							transaction_date = rs</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L2981">							orgName = rs.getString(&quot;first_name&quot;);</span>
						}

<span class="nc bnc" id="L2984" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L2985">							rs.close();</span>
						}

<span class="nc" id="L2988">						PLAYER_PWT_CURRENT = PLAYER_PWT_CURRENT + PWT_AMT;</span>
<span class="nc" id="L2989">						agent_pwt_pay_current = agent_pwt_pay_current - PWT_AMT;</span>
<span class="nc" id="L2990">						PLAYER_TDS_CURRENT = PLAYER_TDS_CURRENT - TAX_AMT;</span>
<span class="nc" id="L2991">						TDS_PAY_CURRENT = TDS_PAY_CURRENT + TAX_AMT;</span>
<span class="nc" id="L2992">						agent_bank_acc_current = agent_bank_acc_current</span>
								+ NET_AMT;
<span class="nc" id="L2994">						PLAYER_CASH_CURRENT = PLAYER_CASH_CURRENT - NET_AMT;</span>

<span class="nc" id="L2996">						stmt</span>
								.executeUpdate(&quot;insert into st_lms_agent_ledger (agent_org_id,transaction_type, transaction_id,transaction_date,amount,account_type,balance,transaction_with,receipt_id) values ('&quot;
										+ agent_id
										+ &quot;','&quot;
										+ transaction_type
										+ &quot;',&quot;
										+ transaction_id
										+ &quot;,'&quot;
										+ transaction_date
										+ &quot;',&quot;
										+ (-PWT_AMT + &quot;&quot;)
										+ &quot;,'AGNT_PWT_PAY',&quot;
										+ FormatNumber
												.formatNumber(agent_pwt_pay_current)
										+ &quot;, '&quot;
										+ orgName
										+ &quot;','&quot;
										+ RECEIPT_ID
										+ &quot;')&quot;);

<span class="nc" id="L3016">						stmt</span>
								.executeUpdate(&quot;insert into st_lms_agent_ledger (agent_org_id,transaction_type, transaction_id,transaction_date,amount,account_type,balance,transaction_with,receipt_id) values ('&quot;
										+ agent_id
										+ &quot;','&quot;
										+ transaction_type
										+ &quot;',&quot;
										+ transaction_id
										+ &quot;,'&quot;
										+ transaction_date
										+ &quot;',&quot;
										+ FormatNumber.formatNumber(PWT_AMT)
										+ &quot;,'AGNT_PLAYER_PWT',&quot;
										+ FormatNumber
												.formatNumber(PLAYER_PWT_CURRENT)
										+ &quot;, '&quot;
										+ orgName
										+ &quot;','&quot;
										+ RECEIPT_ID
										+ &quot;')&quot;);

<span class="nc" id="L3036">						stmt</span>
								.executeUpdate(&quot;insert into st_lms_agent_ledger (agent_org_id,transaction_type, transaction_id,transaction_date,amount,account_type,balance,transaction_with,receipt_id) values ('&quot;
										+ agent_id
										+ &quot;','&quot;
										+ transaction_type
										+ &quot;',&quot;
										+ transaction_id
										+ &quot;,'&quot;
										+ transaction_date
										+ &quot;',&quot;
										+ (-TAX_AMT + &quot;&quot;)
										+ &quot;,'AGNT_PLAYER_TDS',&quot;
										+ FormatNumber
												.formatNumber(PLAYER_TDS_CURRENT)
										+ &quot;, '&quot;
										+ orgName
										+ &quot;','&quot;
										+ RECEIPT_ID
										+ &quot;')&quot;);
<span class="nc" id="L3055">						stmt</span>
								.executeUpdate(&quot;insert into st_lms_agent_ledger (agent_org_id,transaction_type, transaction_id,transaction_date,amount,account_type,balance,transaction_with,receipt_id) values ('&quot;
										+ agent_id
										+ &quot;','&quot;
										+ transaction_type
										+ &quot;',&quot;
										+ transaction_id
										+ &quot;,'&quot;
										+ transaction_date
										+ &quot;',&quot;
										+ TAX_AMT
										+ &quot;&quot;
										+ &quot;,'AGNT_TDS_PAY',&quot;
										+ FormatNumber
												.formatNumber(TDS_PAY_CURRENT)
										+ &quot;, '&quot;
										+ orgName
										+ &quot;','&quot;
										+ RECEIPT_ID
										+ &quot;' )&quot;);

<span class="nc" id="L3076">						stmt</span>
								.executeUpdate(&quot;insert into st_lms_agent_ledger (agent_org_id,transaction_type, transaction_id,transaction_date,amount,account_type,balance,transaction_with,receipt_id) values ('&quot;
										+ agent_id
										+ &quot;','&quot;
										+ transaction_type
										+ &quot;',&quot;
										+ transaction_id
										+ &quot;,'&quot;
										+ transaction_date
										+ &quot;',&quot;
										+ (-NET_AMT + &quot;&quot;)
										+ &quot;,'AGNT_PLAYER_CAS',&quot;
										+ FormatNumber
												.formatNumber(PLAYER_CASH_CURRENT)
										+ &quot;, '&quot;
										+ orgName
										+ &quot;','&quot;
										+ RECEIPT_ID
										+ &quot;' )&quot;);

<span class="nc" id="L3096">						stmt</span>
								.executeUpdate(&quot;insert into st_lms_agent_ledger (agent_org_id,transaction_type, transaction_id,transaction_date,amount,account_type,balance,transaction_with,receipt_id) values ('&quot;
										+ agent_id
										+ &quot;','&quot;
										+ transaction_type
										+ &quot;',&quot;
										+ transaction_id
										+ &quot;,'&quot;
										+ transaction_date
										+ &quot;',&quot;
										+ FormatNumber.formatNumber(NET_AMT)
										+ &quot;,'AGNT_BANK_ACC',&quot;
										+ FormatNumber
												.formatNumber(agent_bank_acc_current)
										+ &quot;, '&quot;
										+ orgName
										+ &quot;','&quot;
										+ RECEIPT_ID
										+ &quot;' )&quot;);

<span class="nc bnc" id="L3116" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L3117">							stmt.close();</span>
						}

					}

<span class="nc" id="L3122">					query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L3123">					updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3124">					updPstmt.setString(1, agent_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L3125">					updPstmt.setString(2, &quot;AGNT_BANK_ACC&quot;);</span>
<span class="nc" id="L3126">					updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L3127">					updPstmt.execute();</span>

<span class="nc bnc" id="L3129" title="All 2 branches missed.">					if (updPstmt != null) {</span>
<span class="nc" id="L3130">						updPstmt.close();</span>
					}

<span class="nc" id="L3133">					query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L3134">					updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3135">					updPstmt.setString(1, agnt_sale_acc_current + &quot;&quot;);</span>
<span class="nc" id="L3136">					updPstmt.setString(2, &quot;AGNT_SALE_ACC&quot;);</span>
<span class="nc" id="L3137">					updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L3138">					updPstmt.execute();</span>

<span class="nc bnc" id="L3140" title="All 2 branches missed.">					if (updPstmt != null) {</span>
<span class="nc" id="L3141">						updPstmt.close();</span>
					}

<span class="nc" id="L3144">					query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L3145">					updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3146">					updPstmt.setString(1, agnt_sale_ret_current + &quot;&quot;);</span>
<span class="nc" id="L3147">					updPstmt.setString(2, &quot;AGNT_SALE_RET&quot;);</span>
<span class="nc" id="L3148">					updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L3149">					updPstmt.execute();</span>

<span class="nc bnc" id="L3151" title="All 2 branches missed.">					if (updPstmt != null) {</span>
<span class="nc" id="L3152">						updPstmt.close();</span>
					}

<span class="nc" id="L3155">					query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L3156">					updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3157">					updPstmt.setString(1, agent_pwt_pay_current + &quot;&quot;);</span>
<span class="nc" id="L3158">					updPstmt.setString(2, &quot;AGNT_PWT_PAY&quot;);</span>
<span class="nc" id="L3159">					updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L3160">					updPstmt.execute();</span>

<span class="nc bnc" id="L3162" title="All 2 branches missed.">					if (updPstmt != null) {</span>
<span class="nc" id="L3163">						updPstmt.close();</span>
					}

					/*
					 * for collection charges
					 */
<span class="nc" id="L3169">					query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L3170">					updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3171">					updPstmt.setString(1, agent_pwt_charges_current + &quot;&quot;);</span>
<span class="nc" id="L3172">					updPstmt.setString(2, &quot;AGENT_PWT_CHARGES&quot;);</span>
<span class="nc" id="L3173">					updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L3174">					updPstmt.execute();</span>

<span class="nc bnc" id="L3176" title="All 2 branches missed.">					if (updPstmt != null) {</span>
<span class="nc" id="L3177">						updPstmt.close();</span>
					}

					/*
					 * for vat payable
					 */

<span class="nc" id="L3184">					query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L3185">					updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3186">					updPstmt.setString(1, agent_vat_pay_current + &quot;&quot;);</span>
<span class="nc" id="L3187">					updPstmt.setString(2, &quot;AGENT_VAT_PAY&quot;);</span>
<span class="nc" id="L3188">					updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L3189">					updPstmt.execute();</span>

<span class="nc bnc" id="L3191" title="All 2 branches missed.">					if (updPstmt != null) {</span>
<span class="nc" id="L3192">						updPstmt.close();</span>
					}

<span class="nc" id="L3195">					query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L3196">					updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3197">					updPstmt.setString(1, PLAYER_PWT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L3198">					updPstmt.setString(2, &quot;AGNT_PLAYER_PWT&quot;);</span>
<span class="nc" id="L3199">					updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L3200">					updPstmt.execute();</span>

<span class="nc bnc" id="L3202" title="All 2 branches missed.">					if (updPstmt != null) {</span>
<span class="nc" id="L3203">						updPstmt.close();</span>
					}

<span class="nc" id="L3206">					query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L3207">					updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3208">					updPstmt.setString(1, PLAYER_TDS_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L3209">					updPstmt.setString(2, &quot;AGNT_PLAYER_TDS&quot;);</span>
<span class="nc" id="L3210">					updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L3211">					updPstmt.execute();</span>

<span class="nc bnc" id="L3213" title="All 2 branches missed.">					if (updPstmt != null) {</span>
<span class="nc" id="L3214">						updPstmt.close();</span>
					}

<span class="nc" id="L3217">					query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L3218">					updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3219">					updPstmt.setString(1, TDS_PAY_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L3220">					updPstmt.setString(2, &quot;AGNT_TDS_PAY&quot;);</span>
<span class="nc" id="L3221">					updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L3222">					updPstmt.execute();</span>

<span class="nc bnc" id="L3224" title="All 2 branches missed.">					if (updPstmt != null) {</span>
<span class="nc" id="L3225">						updPstmt.close();</span>
					}

<span class="nc" id="L3228">					query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L3229">					updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3230">					updPstmt.setString(1, PLAYER_CASH_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L3231">					updPstmt.setString(2, &quot;AGNT_PLAYER_CAS&quot;);</span>
<span class="nc" id="L3232">					updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L3233">					updPstmt.execute();</span>

<span class="nc bnc" id="L3235" title="All 2 branches missed.">					if (updPstmt != null) {</span>
<span class="nc" id="L3236">						updPstmt.close();</span>
					}

<span class="nc" id="L3239">				}</span>

<span class="nc bnc" id="L3241" title="All 2 branches missed.">				if (stmt1 != null) {</span>
<span class="nc" id="L3242">					stmt1.close();</span>
				}
<span class="nc bnc" id="L3244" title="All 2 branches missed.">				if (rs1 != null) {</span>
<span class="nc" id="L3245">					rs1.close();</span>
				}

				// ///////////////////////////////////////////Agent Retailer
				// Transaction
				// End////////////////////////////////////////////////////////////////////
				// This is the end of Retailer and Agent Ledger entry Part

<span class="nc" id="L3253">				query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L3254">				updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3255">				updPstmt.setString(1, bo_bank_acc_current + &quot;&quot;);</span>
<span class="nc" id="L3256">				updPstmt.setString(2, &quot;BO_BANK_ACC&quot;);</span>
<span class="nc" id="L3257">				updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L3258">				updPstmt.execute();</span>

<span class="nc bnc" id="L3260" title="All 2 branches missed.">				if (updPstmt != null) {</span>
<span class="nc" id="L3261">					updPstmt.close();</span>
				}

<span class="nc" id="L3264">				query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L3265">				updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3266">				updPstmt.setString(1, bo_sale_acc_current + &quot;&quot;);</span>
<span class="nc" id="L3267">				updPstmt.setString(2, &quot;BO_SALE_ACC&quot;);</span>
<span class="nc" id="L3268">				updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L3269">				updPstmt.execute();</span>

<span class="nc bnc" id="L3271" title="All 2 branches missed.">				if (updPstmt != null) {</span>
<span class="nc" id="L3272">					updPstmt.close();</span>
				}

<span class="nc" id="L3275">				query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L3276">				updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3277">				updPstmt.setString(1, bo_sale_ret_current + &quot;&quot;);</span>
<span class="nc" id="L3278">				updPstmt.setString(2, &quot;BO_SALE_RET&quot;);</span>
<span class="nc" id="L3279">				updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L3280">				updPstmt.execute();</span>

<span class="nc bnc" id="L3282" title="All 2 branches missed.">				if (updPstmt != null) {</span>
<span class="nc" id="L3283">					updPstmt.close();</span>
				}

<span class="nc" id="L3286">				query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L3287">				updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3288">				updPstmt.setString(1, bo_pwt_pay_current + &quot;&quot;);</span>
<span class="nc" id="L3289">				updPstmt.setString(2, &quot;BO_PWT_PAY&quot;);</span>
<span class="nc" id="L3290">				updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L3291">				updPstmt.execute();</span>

<span class="nc bnc" id="L3293" title="All 2 branches missed.">				if (updPstmt != null) {</span>
<span class="nc" id="L3294">					updPstmt.close();</span>
				}

<span class="nc" id="L3297">				query3 = QueryManager.getST2UpadateAgentCurrentBal();</span>
<span class="nc" id="L3298">				updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3299">				updPstmt.setString(1, bo_pwt_charges_current + &quot;&quot;);</span>
<span class="nc" id="L3300">				updPstmt.setString(2, &quot;BO_PWT_CHARGES&quot;);</span>
<span class="nc" id="L3301">				updPstmt.setInt(3, agent_id);</span>
<span class="nc" id="L3302">				updPstmt.execute();</span>

<span class="nc bnc" id="L3304" title="All 2 branches missed.">				if (updPstmt != null) {</span>
<span class="nc" id="L3305">					updPstmt.close();</span>
				}

				// END OF BO AND AGENT LEDGER TRANSACTION
<span class="nc" id="L3309">				insBalHistory(&quot;agent&quot;, connection);</span>
			} // END OF IF STATEMENT
<span class="nc" id="L3311">			connection.commit();</span>
<span class="nc" id="L3312">		} catch (SQLException e) {</span>

			try {
<span class="nc" id="L3315">				System.out.println(&quot;In agent Exception &quot; + e);</span>
<span class="nc" id="L3316">				e.printStackTrace();</span>
<span class="nc" id="L3317">				connection.rollback();</span>
<span class="nc" id="L3318">			} catch (SQLException e1) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L3320">				e1.printStackTrace();</span>
<span class="nc" id="L3321">			}</span>
		}

		finally {
<span class="nc bnc" id="L3325" title="All 6 branches missed.">			if (connection != null) {</span>
				try {

<span class="nc" id="L3328">					connection.close();</span>
<span class="nc" id="L3329">				} catch (SQLException e) {</span>
					// TODO Auto-generated catch block
<span class="nc" id="L3331">					e.printStackTrace();</span>
<span class="nc" id="L3332">				}</span>
			}
		}
<span class="nc" id="L3335">	}</span>

	public void ledgerBoEntry(Timestamp toDate_Bean) throws LMSException {

		try {

<span class="nc" id="L3341">			connection = DBConnect.getConnection();</span>
<span class="nc" id="L3342">			connection.setAutoCommit(false);</span>
<span class="nc" id="L3343">			present_date = null;</span>
<span class="nc" id="L3344">			String rcptQry = &quot;select sbr.receipt_id,sbr.generated_id from st_lms_bo_receipts_trn_mapping sbrtm , st_lms_bo_receipts sbr where transaction_id=? and sbrtm.receipt_id=sbr.receipt_id&quot;;</span>

<span class="nc" id="L3346">			statement = connection.createStatement();</span>

<span class="nc" id="L3348">			to_Date = toDate_Bean;</span>

<span class="nc" id="L3350">			rs1 = statement.executeQuery(QueryManager.getBoDate());</span>
<span class="nc bnc" id="L3351" title="All 2 branches missed.">			while (rs1.next()) {</span>
				// present_date = rs1.getDate(&quot;date&quot;);
<span class="nc" id="L3353">				present_date = rs1.getTimestamp(&quot;transaction_date&quot;);</span>

				break;
			}
<span class="nc bnc" id="L3357" title="All 2 branches missed.">			if (statement != null) {</span>
<span class="nc" id="L3358">				statement.close();</span>
			}
<span class="nc bnc" id="L3360" title="All 2 branches missed.">			if (rs1 != null) {</span>
<span class="nc" id="L3361">				rs1.close();</span>
			}

<span class="nc" id="L3364">			logger.debug(&quot;LH-BO**PresentDate-&quot; + present_date + &quot;**ToDate-&quot;</span>
					+ toDate_Bean);
<span class="nc bnc" id="L3366" title="All 4 branches missed.">			if (present_date == null || present_date.before(to_Date)) {</span>
<span class="nc bnc" id="L3367" title="All 2 branches missed.">				if (present_date == null) {</span>
					/*
					 * moved the below variables to global variables 10-03-08
					 */
					// dep_Date =
					// (String)ServletActionContext.getServletContext().getAttribute(&quot;DEPLOYMENT_DATE&quot;);
					// dateFormat1 = new
					// java.text.SimpleDateFormat(&quot;dd-MM-yyyy&quot;);
					try {
<span class="nc" id="L3376">						date = dateFormat1.parse(dep_Date);</span>
<span class="nc" id="L3377">						present_date = new java.sql.Timestamp(date.getTime());</span>
<span class="nc" id="L3378">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L3380">						e.printStackTrace();</span>
<span class="nc" id="L3381">					}</span>
				}

<span class="nc" id="L3384">				int resultQuery = 0;</span>
<span class="nc" id="L3385">				statement = connection.createStatement();</span>
<span class="nc" id="L3386">				rs = statement.executeQuery(QueryManager.getST2BoCurrentBal());</span>

<span class="nc bnc" id="L3388" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc bnc" id="L3389" title="All 2 branches missed.">					if (rs.getString(&quot;account_type&quot;).equals(&quot;TDS_PAY&quot;)) {</span>
<span class="nc" id="L3390">						TDS_PAY_CURRENT = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L3391" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(&quot;SALE_ACC&quot;)) {</span>
<span class="nc" id="L3392">						SALE_ACC_CURRENT = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L3393" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(&quot;SALE_RET&quot;)) {</span>
<span class="nc" id="L3394">						SALE_RET_CURRENT = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L3395" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(&quot;PWT_PAY&quot;)) {</span>
<span class="nc" id="L3396">						PWT_PAY_CURRENT = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L3397" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;)</span>
							.equals(&quot;UNCLM_GOVT&quot;)) {
<span class="nc" id="L3399">						UNCLM_GOVT_CURRENT = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L3400" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(&quot;GOVT_COMM&quot;)) {</span>
<span class="nc" id="L3401">						GOVT_COMM_CURRENT = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L3402" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(&quot;BANK_ACC&quot;)) {</span>
<span class="nc" id="L3403">						BANK_ACC_CURRENT = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L3404" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;)</span>
							.equals(&quot;PLAYER_TDS&quot;)) {
<span class="nc" id="L3406">						PLAYER_TDS_CURRENT = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L3407" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;)</span>
							.equals(&quot;PLAYER_PWT&quot;)) {
<span class="nc" id="L3409">						PLAYER_PWT_CURRENT = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L3410" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;)</span>
							.equals(&quot;PLAYER_CAS&quot;)) {
<span class="nc" id="L3412">						PLAYER_CASH_CURRENT = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L3413" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(&quot;VAT_PAY&quot;)) {</span>
<span class="nc" id="L3414">						VAT_PAY_CURRENT = rs.getDouble(&quot;current_balance&quot;);</span>
<span class="nc bnc" id="L3415" title="All 2 branches missed.">					} else if (rs.getString(&quot;account_type&quot;).equals(</span>
							&quot;PWT_CHARGES&quot;)) {
<span class="nc" id="L3417">						PWT_CHARGES_CURRENT = rs.getDouble(&quot;current_balance&quot;);</span>
					}
<span class="nc" id="L3419">					resultQuery++;</span>
				}
<span class="nc bnc" id="L3421" title="All 2 branches missed.">				if (statement != null) {</span>
<span class="nc" id="L3422">					statement.close();</span>
				}
<span class="nc bnc" id="L3424" title="All 2 branches missed.">				if (rs != null) {</span>
<span class="nc" id="L3425">					rs.close();</span>
				}

<span class="nc" id="L3428">				Statement stmtInitial = connection.createStatement();</span>
<span class="nc bnc" id="L3429" title="All 2 branches missed.">				if (resultQuery == 0) {</span>

<span class="nc" id="L3431">					stmtInitial</span>
							.executeUpdate(&quot;insert into st_lms_bo_current_balance (account_type,current_balance) values ('BANK_ACC',0.0)&quot;);
<span class="nc" id="L3433">					stmtInitial</span>
							.executeUpdate(&quot;insert into st_lms_bo_current_balance (account_type,current_balance) values ('GOVT_COMM',0.0)&quot;);
<span class="nc" id="L3435">					stmtInitial</span>
							.executeUpdate(&quot;insert into st_lms_bo_current_balance (account_type,current_balance) values ('PLAYER_CAS',0.0)&quot;);
<span class="nc" id="L3437">					stmtInitial</span>
							.executeUpdate(&quot;insert into st_lms_bo_current_balance (account_type,current_balance) values ('PLAYER_PWT',0.0)&quot;);
<span class="nc" id="L3439">					stmtInitial</span>
							.executeUpdate(&quot;insert into st_lms_bo_current_balance (account_type,current_balance) values ('PLAYER_TDS',0.0)&quot;);
<span class="nc" id="L3441">					stmtInitial</span>
							.executeUpdate(&quot;insert into st_lms_bo_current_balance (account_type,current_balance) values ('PWT_PAY',0.0)&quot;);
<span class="nc" id="L3443">					stmtInitial</span>
							.executeUpdate(&quot;insert into st_lms_bo_current_balance (account_type,current_balance) values ('SALE_ACC',0.0)&quot;);
<span class="nc" id="L3445">					stmtInitial</span>
							.executeUpdate(&quot;insert into st_lms_bo_current_balance (account_type,current_balance) values ('SALE_RET',0.0)&quot;);
<span class="nc" id="L3447">					stmtInitial</span>
							.executeUpdate(&quot;insert into st_lms_bo_current_balance (account_type,current_balance) values ('TDS_PAY',0.0)&quot;);
<span class="nc" id="L3449">					stmtInitial</span>
							.executeUpdate(&quot;insert into st_lms_bo_current_balance (account_type,current_balance) values ('UNCLM_GOVT',0.0)&quot;);
<span class="nc" id="L3451">					stmtInitial</span>
							.executeUpdate(&quot;insert into st_lms_bo_current_balance (account_type,current_balance) values ('VAT_PAY',0.0)&quot;);
<span class="nc" id="L3453">					stmtInitial</span>
							.executeUpdate(&quot;insert into st_lms_bo_current_balance (account_type,current_balance) values ('PWT_CHARGES',0.0)&quot;);

				}
<span class="nc bnc" id="L3457" title="All 2 branches missed.">				if (stmtInitial != null) {</span>
<span class="nc" id="L3458">					stmtInitial.close();</span>
				}

<span class="nc" id="L3461">				stmt1 = connection.prepareStatement(QueryManager</span>
						.getST2BoTransaction());
<span class="nc" id="L3463">				stmt1.setTimestamp(1, present_date);</span>
<span class="nc" id="L3464">				stmt1.setTimestamp(2, to_Date);</span>
<span class="nc" id="L3465">				logger.debug(&quot;LH-BO**Select Trxn Master**&quot; + stmt1);</span>
<span class="nc" id="L3466">				rs1 = stmt1.executeQuery();</span>
				// This has been replaced by the obove prepared statements
				// statements 07-03-08
				// rs1 =
				// stmt1.executeQuery(QueryManager.getST2BoTransaction()+&quot;'&quot;+
				// present_date + &quot;'&quot;);

<span class="nc bnc" id="L3473" title="All 2 branches missed.">				while (rs1.next()) {</span>

<span class="nc" id="L3475">					long transaction_id = rs1.getLong(&quot;transaction_id&quot;);</span>
<span class="nc" id="L3476">					String TRANSACTION_TYPE = rs1.getString(&quot;transaction_type&quot;);</span>
<span class="nc" id="L3477">					String RECEIPT_ID = &quot;N.A.&quot;;</span>

<span class="nc" id="L3479">					rcptPS = connection.prepareStatement(rcptQry);</span>
<span class="nc" id="L3480">					rcptPS.setLong(1, transaction_id);</span>
<span class="nc" id="L3481">					rcptRS = rcptPS.executeQuery();</span>
<span class="nc bnc" id="L3482" title="All 2 branches missed.">					while (rcptRS.next()) {</span>
<span class="nc" id="L3483">						genNum = rcptRS.getString(&quot;generated_id&quot;);</span>

<span class="nc bnc" id="L3485" title="All 8 branches missed.">						if (genNum != null</span>
								&amp;&amp; !genNum.trim().equals(&quot;&quot;)
								&amp;&amp; !(genNum.contains(&quot;DLB&quot;) || genNum
										.contains(&quot;DSB&quot;))) {
<span class="nc" id="L3489">							RECEIPT_ID = rcptRS.getString(&quot;generated_id&quot;);</span>
						}

					}
<span class="nc bnc" id="L3493" title="All 2 branches missed.">					if (rcptPS != null) {</span>
<span class="nc" id="L3494">						rcptPS.close();</span>
					}
<span class="nc bnc" id="L3496" title="All 2 branches missed.">					if (rcptRS != null) {</span>
<span class="nc" id="L3497">						rcptRS.close();</span>
					}

<span class="nc" id="L3500">					double AMOUNT = 0;</span>
<span class="nc" id="L3501">					Timestamp TRANSACTION_DATE = null;</span>
<span class="nc" id="L3502">					String ACC_TYPE = &quot;&quot;;</span>
<span class="nc" id="L3503">					String saleQuery = &quot;&quot;;</span>
<span class="nc" id="L3504">					String saleRetQuery = &quot;&quot;;</span>
<span class="nc" id="L3505">					logger.debug(&quot;LH-BO**&quot; + TRANSACTION_TYPE + &quot;**TRX_ID-&quot;</span>
							+ transaction_id + &quot;**R_ID-&quot; + RECEIPT_ID);
<span class="nc bnc" id="L3507" title="All 8 branches missed.">					if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;Sale&quot;)</span>
							|| TRANSACTION_TYPE.equalsIgnoreCase(&quot;DG_SALE&quot;)
							|| TRANSACTION_TYPE.equalsIgnoreCase(&quot;CS_SALE&quot;) || TRANSACTION_TYPE.equalsIgnoreCase(&quot;OLA_DEPOSIT&quot;)) {
<span class="nc bnc" id="L3510" title="All 2 branches missed.">						if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;Sale&quot;)) {</span>
<span class="nc" id="L3511">							saleQuery = QueryManager.getST2BoSale();</span>
<span class="nc bnc" id="L3512" title="All 2 branches missed.">						} else if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;DG_SALE&quot;)) {</span>
<span class="nc" id="L3513">							saleQuery = QueryManager.getST2BoDrwGmSale();</span>
<span class="nc bnc" id="L3514" title="All 2 branches missed.">						}else if(TRANSACTION_TYPE.equalsIgnoreCase(&quot;CS_SALE&quot;)){</span>
<span class="nc" id="L3515">							saleQuery = QueryManager.getST2BoCsSale();</span>
						}
<span class="nc bnc" id="L3517" title="All 2 branches missed.">						else if(TRANSACTION_TYPE.equalsIgnoreCase(&quot;OLA_DEPOSIT&quot;))</span>
						{
<span class="nc" id="L3519">							saleQuery = QueryManager.getST2BoOlaDeposit();</span>
						}
<span class="nc" id="L3521">						stmt2 = connection.prepareStatement(saleQuery);</span>
<span class="nc" id="L3522">						stmt2.setLong(1, transaction_id);</span>
<span class="nc" id="L3523">						rs2 = stmt2.executeQuery();</span>
<span class="nc bnc" id="L3524" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L3525">							AMOUNT = rs2.getDouble(&quot;net_amt&quot;);</span>
<span class="nc" id="L3526">							TRANSACTION_DATE = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L3528">							ACC_TYPE = &quot;&quot; + rs2.getInt(&quot;agent_org_id&quot;);</span>
<span class="nc" id="L3529">							orgName = rs2.getString(&quot;name&quot;);</span>
						}
<span class="nc bnc" id="L3531" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L3532">							stmt2.close();</span>
						}
<span class="nc bnc" id="L3534" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L3535">							rs2.close();</span>
						}

<span class="nc" id="L3538">						stmt = connection.prepareStatement(QueryManager</span>
								.getST2BoCurrentBalAgent());
<span class="nc" id="L3540">						stmt.setString(1, ACC_TYPE);</span>
<span class="nc" id="L3541">						rs = stmt.executeQuery();</span>
<span class="nc" id="L3542">						int i = 0;</span>
<span class="nc bnc" id="L3543" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L3544">							AGENT_ACCOUNT_CURRENT = rs</span>
									.getDouble(&quot;current_balance&quot;);
<span class="nc" id="L3546">							i++;</span>
						}
<span class="nc bnc" id="L3548" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L3549">							stmt.close();</span>
						}
<span class="nc bnc" id="L3551" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L3552">							rs.close();</span>
						}

<span class="nc bnc" id="L3555" title="All 2 branches missed.">						if (i == 0) {</span>
<span class="nc" id="L3556">							query1 = QueryManager.getST2InsertAgentCurrentBal();</span>
<span class="nc" id="L3557">							updatePstmt = connection.prepareStatement(query1);</span>
<span class="nc" id="L3558">							updatePstmt.setString(1, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L3559">							updatePstmt.setInt(2, 0);</span>
<span class="nc" id="L3560">							updatePstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L3561">							updatePstmt.execute();</span>
<span class="nc" id="L3562">							AGENT_ACCOUNT_CURRENT = 0.0;</span>

<span class="nc bnc" id="L3564" title="All 2 branches missed.">							if (updatePstmt != null) {</span>
<span class="nc" id="L3565">								updatePstmt.close();</span>
							}

						}
<span class="nc" id="L3569">						AGENT_ACCOUNT_CURRENT = AGENT_ACCOUNT_CURRENT - AMOUNT;</span>
<span class="nc" id="L3570">						SALE_ACC_CURRENT = SALE_ACC_CURRENT + AMOUNT;</span>
<span class="nc" id="L3571">						logger.debug(&quot;LH-BO**&quot; + TRANSACTION_DATE + &quot;**AMT-&quot;</span>
								+ AMOUNT + &quot;**ACT_TYPE-&quot; + ACC_TYPE
								+ &quot;**AGT_ACC=&quot; + AGENT_ACCOUNT_CURRENT
								+ &quot;**SALE_ACC&quot; + SALE_ACC_CURRENT);
<span class="nc" id="L3575">						query1 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L3576">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L3578">						updatePstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L3579">						updatePstmt.setLong(2, transaction_id);</span>
<span class="nc" id="L3580">						updatePstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L3581">						updatePstmt.setString(4, -AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L3582">						updatePstmt.setString(5, ACC_TYPE);</span>
<span class="nc" id="L3583">						updatePstmt.setString(6, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L3584">						updatePstmt.setString(7, orgName);</span>
<span class="nc" id="L3585">						updatePstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L3586">						updatePstmt.execute();</span>

<span class="nc bnc" id="L3588" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L3589">							updatePstmt.close();</span>
						}

<span class="nc" id="L3592">						query2 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L3593">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L3594">						upPstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L3595">						upPstmt.setLong(2, transaction_id);</span>
<span class="nc" id="L3596">						upPstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L3597">						upPstmt.setString(4, AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L3598">						upPstmt.setString(5, &quot;SALE_ACC&quot;);</span>
<span class="nc" id="L3599">						upPstmt.setString(6, SALE_ACC_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L3600">						upPstmt.setString(7, orgName);</span>
<span class="nc" id="L3601">						upPstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L3602">						upPstmt.execute();</span>

<span class="nc bnc" id="L3604" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L3605">							upPstmt.close();</span>
						}

<span class="nc" id="L3608">						query3 = QueryManager.getST2UpadateCurrentBalAgent();</span>
<span class="nc" id="L3609">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3610">						updPstmt.setString(1, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L3611">						updPstmt.setString(2, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L3612">						updPstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L3613">						updPstmt.execute();</span>

<span class="nc bnc" id="L3615" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L3616">							updPstmt.close();</span>
						}
<span class="nc" id="L3618">					}</span>

<span class="nc bnc" id="L3620" title="All 2 branches missed.">					else if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;cash&quot;)) {</span>
<span class="nc" id="L3621">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST2BoCash());
<span class="nc" id="L3623">						stmt2.setLong(1, transaction_id);</span>
<span class="nc" id="L3624">						rs2 = stmt2.executeQuery();</span>

<span class="nc bnc" id="L3626" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L3627">							TRANSACTION_DATE = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L3629">							AMOUNT = rs2.getDouble(&quot;amount&quot;);</span>
<span class="nc" id="L3630">							ACC_TYPE = &quot;&quot; + rs2.getInt(&quot;agent_org_id&quot;);</span>
<span class="nc" id="L3631">							orgName = rs2.getString(&quot;name&quot;);</span>
						}
<span class="nc bnc" id="L3633" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L3634">							stmt2.close();</span>
						}
<span class="nc bnc" id="L3636" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L3637">							rs2.close();</span>
						}
<span class="nc" id="L3639">						stmt = connection.prepareStatement(QueryManager</span>
								.getST2BoCurrentBalAgent());
<span class="nc" id="L3641">						stmt.setString(1, ACC_TYPE);</span>
<span class="nc" id="L3642">						rs = stmt.executeQuery();</span>
<span class="nc" id="L3643">						int i = 0;</span>
<span class="nc bnc" id="L3644" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L3645">							AGENT_ACCOUNT_CURRENT = rs</span>
									.getDouble(&quot;current_balance&quot;);
<span class="nc" id="L3647">							i++;</span>
						}

<span class="nc bnc" id="L3650" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L3651">							stmt.close();</span>
						}
<span class="nc bnc" id="L3653" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L3654">							rs.close();</span>
						}

<span class="nc bnc" id="L3657" title="All 2 branches missed.">						if (i == 0) {</span>
<span class="nc" id="L3658">							query1 = QueryManager.getST2InsertAgentCurrentBal();</span>
<span class="nc" id="L3659">							updatePstmt = connection.prepareStatement(query1);</span>
<span class="nc" id="L3660">							updatePstmt.setString(1, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L3661">							updatePstmt.setInt(2, 0);</span>
<span class="nc" id="L3662">							updatePstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L3663">							updatePstmt.execute();</span>
<span class="nc" id="L3664">							AGENT_ACCOUNT_CURRENT = 0.0;</span>

<span class="nc bnc" id="L3666" title="All 2 branches missed.">							if (updatePstmt != null) {</span>
<span class="nc" id="L3667">								updatePstmt.close();</span>
							}

						}

<span class="nc" id="L3672">						AGENT_ACCOUNT_CURRENT = AGENT_ACCOUNT_CURRENT + AMOUNT;</span>
<span class="nc" id="L3673">						BANK_ACC_CURRENT = BANK_ACC_CURRENT - AMOUNT;</span>
<span class="nc" id="L3674">						logger.debug(&quot;LH-BO**&quot; + TRANSACTION_DATE + &quot;**AMT-&quot;</span>
								+ AMOUNT + &quot;**ACT_TYPE-&quot; + ACC_TYPE
								+ &quot;**AGT_ACC=&quot; + AGENT_ACCOUNT_CURRENT
								+ &quot;**BANK_ACC&quot; + BANK_ACC_CURRENT);

<span class="nc" id="L3679">						query2 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L3680">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L3681">						upPstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L3682">						upPstmt.setLong(2, transaction_id);</span>
						// upPstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L3684">						upPstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L3685">						upPstmt.setString(4, -AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L3686">						upPstmt.setString(5, &quot;BANK_ACC&quot;);</span>
<span class="nc" id="L3687">						upPstmt.setString(6, BANK_ACC_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L3688">						upPstmt.setString(7, orgName);</span>
<span class="nc" id="L3689">						upPstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L3690">						upPstmt.execute();</span>

<span class="nc bnc" id="L3692" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L3693">							upPstmt.close();</span>
						}

<span class="nc" id="L3696">						query1 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L3697">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L3699">						updatePstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L3700">						updatePstmt.setLong(2, transaction_id);</span>
						// updatePstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L3702">						updatePstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L3703">						updatePstmt.setString(4, AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L3704">						updatePstmt.setString(5, ACC_TYPE);</span>
<span class="nc" id="L3705">						updatePstmt.setString(6, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L3706">						updatePstmt.setString(7, orgName);</span>
<span class="nc" id="L3707">						updatePstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L3708">						updatePstmt.execute();</span>

<span class="nc bnc" id="L3710" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L3711">							updatePstmt.close();</span>
						}

<span class="nc" id="L3714">						query3 = QueryManager.getST2UpadateCurrentBalAgent();</span>
<span class="nc" id="L3715">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3716">						updPstmt.setString(1, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L3717">						updPstmt.setString(2, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L3718">						updPstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L3719">						updPstmt.execute();</span>

<span class="nc bnc" id="L3721" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L3722">							updPstmt.close();</span>
						}
						//code  updated for Bank Dep starts ...
<span class="nc" id="L3725">					}</span>
<span class="nc bnc" id="L3726" title="All 2 branches missed.">					else if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;OLA_COMMISSION&quot;)) {</span>
<span class="nc" id="L3727">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST2BoOlaCommission());
<span class="nc" id="L3729">						stmt2.setLong(1, transaction_id);</span>
<span class="nc" id="L3730">						rs2 = stmt2.executeQuery();</span>

<span class="nc bnc" id="L3732" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L3733">							TRANSACTION_DATE = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L3735">							AMOUNT = rs2.getDouble(&quot;amount&quot;);</span>
<span class="nc" id="L3736">							ACC_TYPE = &quot;&quot; + rs2.getInt(&quot;agent_org_id&quot;);</span>
<span class="nc" id="L3737">							orgName = rs2.getString(&quot;name&quot;);</span>
						}
<span class="nc bnc" id="L3739" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L3740">							stmt2.close();</span>
						}
<span class="nc bnc" id="L3742" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L3743">							rs2.close();</span>
						}
<span class="nc" id="L3745">						stmt = connection.prepareStatement(QueryManager</span>
								.getST2BoCurrentBalAgent());
<span class="nc" id="L3747">						stmt.setString(1, ACC_TYPE);</span>
<span class="nc" id="L3748">						rs = stmt.executeQuery();</span>
<span class="nc" id="L3749">						int i = 0;</span>
<span class="nc bnc" id="L3750" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L3751">							AGENT_ACCOUNT_CURRENT = rs</span>
									.getDouble(&quot;current_balance&quot;);
<span class="nc" id="L3753">							i++;</span>
						}

<span class="nc bnc" id="L3756" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L3757">							stmt.close();</span>
						}
<span class="nc bnc" id="L3759" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L3760">							rs.close();</span>
						}

<span class="nc bnc" id="L3763" title="All 2 branches missed.">						if (i == 0) {</span>
<span class="nc" id="L3764">							query1 = QueryManager.getST2InsertAgentCurrentBal();</span>
<span class="nc" id="L3765">							updatePstmt = connection.prepareStatement(query1);</span>
<span class="nc" id="L3766">							updatePstmt.setString(1, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L3767">							updatePstmt.setInt(2, 0);</span>
<span class="nc" id="L3768">							updatePstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L3769">							updatePstmt.execute();</span>
<span class="nc" id="L3770">							AGENT_ACCOUNT_CURRENT = 0.0;</span>

<span class="nc bnc" id="L3772" title="All 2 branches missed.">							if (updatePstmt != null) {</span>
<span class="nc" id="L3773">								updatePstmt.close();</span>
							}

						}

<span class="nc" id="L3778">						AGENT_ACCOUNT_CURRENT = AGENT_ACCOUNT_CURRENT + AMOUNT;</span>
<span class="nc" id="L3779">						BANK_ACC_CURRENT = BANK_ACC_CURRENT - AMOUNT;</span>
<span class="nc" id="L3780">						logger.debug(&quot;LH-BO**&quot; + TRANSACTION_DATE + &quot;**AMT-&quot;</span>
								+ AMOUNT + &quot;**ACT_TYPE-&quot; + ACC_TYPE
								+ &quot;**AGT_ACC=&quot; + AGENT_ACCOUNT_CURRENT
								+ &quot;**BANK_ACC&quot; + BANK_ACC_CURRENT);

<span class="nc" id="L3785">						query2 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L3786">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L3787">						upPstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L3788">						upPstmt.setLong(2, transaction_id);</span>
						// upPstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L3790">						upPstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L3791">						upPstmt.setString(4, -AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L3792">						upPstmt.setString(5, &quot;BANK_ACC&quot;);</span>
<span class="nc" id="L3793">						upPstmt.setString(6, BANK_ACC_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L3794">						upPstmt.setString(7, orgName);</span>
<span class="nc" id="L3795">						upPstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L3796">						upPstmt.execute();</span>

<span class="nc bnc" id="L3798" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L3799">							upPstmt.close();</span>
						}

<span class="nc" id="L3802">						query1 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L3803">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L3805">						updatePstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L3806">						updatePstmt.setLong(2, transaction_id);</span>
						// updatePstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L3808">						updatePstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L3809">						updatePstmt.setString(4, AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L3810">						updatePstmt.setString(5, ACC_TYPE);</span>
<span class="nc" id="L3811">						updatePstmt.setString(6, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L3812">						updatePstmt.setString(7, orgName);</span>
<span class="nc" id="L3813">						updatePstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L3814">						updatePstmt.execute();</span>

<span class="nc bnc" id="L3816" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L3817">							updatePstmt.close();</span>
						}

<span class="nc" id="L3820">						query3 = QueryManager.getST2UpadateCurrentBalAgent();</span>
<span class="nc" id="L3821">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3822">						updPstmt.setString(1, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L3823">						updPstmt.setString(2, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L3824">						updPstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L3825">						updPstmt.execute();</span>

<span class="nc bnc" id="L3827" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L3828">							updPstmt.close();</span>
						}
						//code  updated for Bank Dep starts ...
<span class="nc" id="L3831">					}</span>
					
<span class="nc bnc" id="L3833" title="All 2 branches missed.">					else if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;BANK_DEPOSIT&quot;)){</span>
<span class="nc" id="L3834">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST2BoBankDep());
<span class="nc" id="L3836">						stmt2.setLong(1, transaction_id);</span>
<span class="nc" id="L3837">						rs2 = stmt2.executeQuery();</span>

<span class="nc bnc" id="L3839" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L3840">							TRANSACTION_DATE = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L3842">							AMOUNT = rs2.getDouble(&quot;amount&quot;);</span>
<span class="nc" id="L3843">							ACC_TYPE = &quot;&quot; + rs2.getInt(&quot;agent_org_id&quot;);</span>
<span class="nc" id="L3844">							orgName = rs2.getString(&quot;name&quot;);</span>
						}
<span class="nc bnc" id="L3846" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L3847">							stmt2.close();</span>
						}
<span class="nc bnc" id="L3849" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L3850">							rs2.close();</span>
						}
<span class="nc" id="L3852">						stmt = connection.prepareStatement(QueryManager</span>
								.getST2BoCurrentBalAgent());
<span class="nc" id="L3854">						stmt.setString(1, ACC_TYPE);</span>
<span class="nc" id="L3855">						rs = stmt.executeQuery();</span>
<span class="nc" id="L3856">						int i = 0;</span>
<span class="nc bnc" id="L3857" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L3858">							AGENT_ACCOUNT_CURRENT = rs</span>
									.getDouble(&quot;current_balance&quot;);
<span class="nc" id="L3860">							i++;</span>
						}

<span class="nc bnc" id="L3863" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L3864">							stmt.close();</span>
						}
<span class="nc bnc" id="L3866" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L3867">							rs.close();</span>
						}

<span class="nc bnc" id="L3870" title="All 2 branches missed.">						if (i == 0) {</span>
<span class="nc" id="L3871">							query1 = QueryManager.getST2InsertAgentCurrentBal();</span>
<span class="nc" id="L3872">							updatePstmt = connection.prepareStatement(query1);</span>
<span class="nc" id="L3873">							updatePstmt.setString(1, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L3874">							updatePstmt.setInt(2, 0);</span>
<span class="nc" id="L3875">							updatePstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L3876">							updatePstmt.execute();</span>
<span class="nc" id="L3877">							AGENT_ACCOUNT_CURRENT = 0.0;</span>

<span class="nc bnc" id="L3879" title="All 2 branches missed.">							if (updatePstmt != null) {</span>
<span class="nc" id="L3880">								updatePstmt.close();</span>
							}

						}

<span class="nc" id="L3885">						AGENT_ACCOUNT_CURRENT = AGENT_ACCOUNT_CURRENT + AMOUNT;</span>
<span class="nc" id="L3886">						BANK_ACC_CURRENT = BANK_ACC_CURRENT - AMOUNT;</span>
<span class="nc" id="L3887">						logger.debug(&quot;LH-BO**&quot; + TRANSACTION_DATE + &quot;**AMT-&quot;</span>
								+ AMOUNT + &quot;**ACT_TYPE-&quot; + ACC_TYPE
								+ &quot;**AGT_ACC=&quot; + AGENT_ACCOUNT_CURRENT
								+ &quot;**BANK_ACC&quot; + BANK_ACC_CURRENT);

<span class="nc" id="L3892">						query2 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L3893">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L3894">						upPstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L3895">						upPstmt.setLong(2, transaction_id);</span>
						// upPstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L3897">						upPstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L3898">						upPstmt.setString(4, -AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L3899">						upPstmt.setString(5, &quot;BANK_ACC&quot;);</span>
<span class="nc" id="L3900">						upPstmt.setString(6, BANK_ACC_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L3901">						upPstmt.setString(7, orgName);</span>
<span class="nc" id="L3902">						upPstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L3903">						upPstmt.execute();</span>

<span class="nc bnc" id="L3905" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L3906">							upPstmt.close();</span>
						}

<span class="nc" id="L3909">						query1 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L3910">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L3912">						updatePstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L3913">						updatePstmt.setLong(2, transaction_id);</span>
						// updatePstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L3915">						updatePstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L3916">						updatePstmt.setString(4, AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L3917">						updatePstmt.setString(5, ACC_TYPE);</span>
<span class="nc" id="L3918">						updatePstmt.setString(6, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L3919">						updatePstmt.setString(7, orgName);</span>
<span class="nc" id="L3920">						updatePstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L3921">						updatePstmt.execute();</span>

<span class="nc bnc" id="L3923" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L3924">							updatePstmt.close();</span>
						}

<span class="nc" id="L3927">						query3 = QueryManager.getST2UpadateCurrentBalAgent();</span>
<span class="nc" id="L3928">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L3929">						updPstmt.setString(1, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L3930">						updPstmt.setString(2, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L3931">						updPstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L3932">						updPstmt.execute();</span>

<span class="nc bnc" id="L3934" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L3935">							updPstmt.close();</span>
						}

					
					
<span class="nc" id="L3940">					}//code  updated for Bank Dep ends...</span>
<span class="nc bnc" id="L3941" title="All 2 branches missed.">					else if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;cheque&quot;)) {</span>

<span class="nc" id="L3943">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST2BoChq());
<span class="nc" id="L3945">						stmt2.setLong(1, transaction_id);</span>
<span class="nc" id="L3946">						rs2 = stmt2.executeQuery();</span>

<span class="nc bnc" id="L3948" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L3949">							AMOUNT = rs2.getDouble(&quot;cheque_amt&quot;);</span>
							// TRANSACTION_DATE =
							// rs2.getDate(&quot;transaction_date&quot;);
<span class="nc" id="L3952">							TRANSACTION_DATE = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
							// TRANS_DATE= new
							// java.sql.Date(TRANSACTION_DATE.getTime());

<span class="nc" id="L3957">							ACC_TYPE = &quot;&quot; + rs2.getInt(&quot;agent_org_id&quot;);</span>
<span class="nc" id="L3958">							orgName = rs2.getString(&quot;name&quot;);</span>
						}

<span class="nc bnc" id="L3961" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L3962">							stmt2.close();</span>
						}
<span class="nc bnc" id="L3964" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L3965">							rs2.close();</span>
						}

<span class="nc" id="L3968">						stmt = connection.prepareStatement(QueryManager</span>
								.getST2BoCurrentBalAgent());
<span class="nc" id="L3970">						stmt.setString(1, ACC_TYPE);</span>
<span class="nc" id="L3971">						rs = stmt.executeQuery();</span>

<span class="nc" id="L3973">						int i = 0;</span>
<span class="nc bnc" id="L3974" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L3975">							AGENT_ACCOUNT_CURRENT = rs</span>
									.getDouble(&quot;current_balance&quot;);
<span class="nc" id="L3977">							i++;</span>
						}

<span class="nc bnc" id="L3980" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L3981">							stmt.close();</span>
						}
<span class="nc bnc" id="L3983" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L3984">							rs.close();</span>
						}

<span class="nc bnc" id="L3987" title="All 2 branches missed.">						if (i == 0) {</span>
<span class="nc" id="L3988">							query1 = QueryManager.getST2InsertAgentCurrentBal();</span>
<span class="nc" id="L3989">							updatePstmt = connection.prepareStatement(query1);</span>
<span class="nc" id="L3990">							updatePstmt.setString(1, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L3991">							updatePstmt.setInt(2, 0);</span>
<span class="nc" id="L3992">							updatePstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L3993">							updatePstmt.execute();</span>
<span class="nc" id="L3994">							AGENT_ACCOUNT_CURRENT = 0.0;</span>

<span class="nc bnc" id="L3996" title="All 2 branches missed.">							if (updatePstmt != null) {</span>
<span class="nc" id="L3997">								updatePstmt.close();</span>
							}

						}

<span class="nc" id="L4002">						AGENT_ACCOUNT_CURRENT = AGENT_ACCOUNT_CURRENT + AMOUNT;</span>
<span class="nc" id="L4003">						BANK_ACC_CURRENT = BANK_ACC_CURRENT - AMOUNT;</span>

<span class="nc" id="L4005">						logger.debug(&quot;LH-BO**&quot; + TRANSACTION_DATE + &quot;**AMT-&quot;</span>
								+ AMOUNT + &quot;**ACT_TYPE-&quot; + ACC_TYPE
								+ &quot;**AGT_ACC=&quot; + AGENT_ACCOUNT_CURRENT
								+ &quot;**BANK_ACC&quot; + BANK_ACC_CURRENT);

<span class="nc" id="L4010">						query2 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L4011">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L4012">						upPstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L4013">						upPstmt.setLong(2, transaction_id);</span>
						// upPstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L4015">						upPstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L4016">						upPstmt.setString(4, -AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L4017">						upPstmt.setString(5, &quot;BANK_ACC&quot;);</span>
<span class="nc" id="L4018">						upPstmt.setString(6, BANK_ACC_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4019">						upPstmt.setString(7, orgName);</span>
<span class="nc" id="L4020">						upPstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L4021">						upPstmt.execute();</span>

<span class="nc bnc" id="L4023" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L4024">							upPstmt.close();</span>
						}

<span class="nc" id="L4027">						query1 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L4028">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L4030">						updatePstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L4031">						updatePstmt.setLong(2, transaction_id);</span>
						// updatePstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L4033">						updatePstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L4034">						updatePstmt.setString(4, AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L4035">						updatePstmt.setString(5, ACC_TYPE);</span>
<span class="nc" id="L4036">						updatePstmt.setString(6, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4037">						updatePstmt.setString(7, orgName);</span>
<span class="nc" id="L4038">						updatePstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L4039">						updatePstmt.execute();</span>

<span class="nc bnc" id="L4041" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L4042">							updatePstmt.close();</span>
						}

<span class="nc" id="L4045">						query3 = QueryManager.getST2UpadateCurrentBalAgent();</span>
<span class="nc" id="L4046">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L4047">						updPstmt.setString(1, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4048">						updPstmt.setString(2, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L4049">						updPstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L4050">						updPstmt.execute();</span>

<span class="nc bnc" id="L4052" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L4053">							updPstmt.close();</span>
						}

<span class="nc bnc" id="L4056" title="All 12 branches missed.">					} else if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;sale_ret&quot;)</span>
							|| TRANSACTION_TYPE
									.equalsIgnoreCase(&quot;DG_REFUND_FAILED&quot;)
							|| TRANSACTION_TYPE
									.equalsIgnoreCase(&quot;DG_REFUND_CANCEL&quot;)
							|| TRANSACTION_TYPE
									.equalsIgnoreCase(&quot;CS_CANCEL_SERVER&quot;)
							||	TRANSACTION_TYPE
									.equalsIgnoreCase(&quot;CS_CANCEL_RET&quot;)
									
							|| TRANSACTION_TYPE.equalsIgnoreCase(&quot;OLA_DEPOSIT_REFUND&quot;)) {

<span class="nc bnc" id="L4068" title="All 2 branches missed.">						if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;sale_ret&quot;)) {</span>
<span class="nc" id="L4069">							saleRetQuery = QueryManager.getST2BoSaleRet();</span>
<span class="nc bnc" id="L4070" title="All 4 branches missed.">						} else if (TRANSACTION_TYPE</span>
								.equalsIgnoreCase(&quot;DG_REFUND_FAILED&quot;)
								|| TRANSACTION_TYPE
										.equalsIgnoreCase(&quot;DG_REFUND_CANCEL&quot;)) {
<span class="nc" id="L4074">							saleRetQuery = QueryManager.getST2BoDrwGmRefnd();</span>
<span class="nc bnc" id="L4075" title="All 4 branches missed.">						}else if (TRANSACTION_TYPE</span>
								.equalsIgnoreCase(&quot;CS_CANCEL_SERVER&quot;)
								||	TRANSACTION_TYPE
										.equalsIgnoreCase(&quot;CS_CANCEL_RET&quot;)){
<span class="nc" id="L4079">							saleRetQuery = QueryManager.getST2BoCsRefnd();</span>
<span class="nc bnc" id="L4080" title="All 2 branches missed.">						}else if(TRANSACTION_TYPE.equalsIgnoreCase(&quot;OLA_DEPOSIT_REFUND&quot;))</span>
						{
<span class="nc" id="L4082">							saleRetQuery = QueryManager.getST2BoOlaRefnd();</span>
						}
<span class="nc" id="L4084">						stmt2 = connection.prepareStatement(saleRetQuery);</span>
<span class="nc" id="L4085">						stmt2.setLong(1, transaction_id);</span>
<span class="nc" id="L4086">						rs2 = stmt2.executeQuery();</span>
						// This has been replaced by the obove prepared
						// statements statements 07-03-08
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2BoSaleRet()+&quot;&quot;+
						// transaction_id + &quot;&quot;);

<span class="nc bnc" id="L4093" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L4094">							AMOUNT = rs2.getDouble(&quot;net_amt&quot;);</span>
							// TRANSACTION_DATE =
							// rs2.getDate(&quot;transaction_date&quot;);
<span class="nc" id="L4097">							TRANSACTION_DATE = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L4099">							ACC_TYPE = &quot;&quot; + rs2.getInt(&quot;agent_org_id&quot;);</span>
<span class="nc" id="L4100">							orgName = rs2.getString(&quot;name&quot;);</span>
						}

<span class="nc bnc" id="L4103" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L4104">							stmt2.close();</span>
						}
<span class="nc bnc" id="L4106" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L4107">							rs2.close();</span>
						}

<span class="nc" id="L4110">						stmt = connection.prepareStatement(QueryManager</span>
								.getST2BoCurrentBalAgent());
<span class="nc" id="L4112">						stmt.setString(1, ACC_TYPE);</span>
<span class="nc" id="L4113">						rs = stmt.executeQuery();</span>

<span class="nc" id="L4115">						int i = 0;</span>
<span class="nc bnc" id="L4116" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L4117">							AGENT_ACCOUNT_CURRENT = rs</span>
									.getDouble(&quot;current_balance&quot;);
<span class="nc" id="L4119">							i++;</span>
						}

<span class="nc bnc" id="L4122" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L4123">							stmt.close();</span>
						}
<span class="nc bnc" id="L4125" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L4126">							rs.close();</span>
						}

<span class="nc bnc" id="L4129" title="All 2 branches missed.">						if (i == 0) {</span>
<span class="nc" id="L4130">							query1 = QueryManager.getST2InsertAgentCurrentBal();</span>
<span class="nc" id="L4131">							updatePstmt = connection.prepareStatement(query1);</span>
<span class="nc" id="L4132">							updatePstmt.setString(1, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L4133">							updatePstmt.setInt(2, 0);</span>
<span class="nc" id="L4134">							updatePstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L4135">							updatePstmt.execute();</span>
<span class="nc" id="L4136">							AGENT_ACCOUNT_CURRENT = 0.0;</span>

<span class="nc bnc" id="L4138" title="All 2 branches missed.">							if (updatePstmt != null) {</span>
<span class="nc" id="L4139">								updatePstmt.close();</span>
							}

						}

<span class="nc" id="L4144">						AGENT_ACCOUNT_CURRENT = AGENT_ACCOUNT_CURRENT + AMOUNT;</span>
<span class="nc" id="L4145">						SALE_RET_CURRENT = SALE_RET_CURRENT - AMOUNT;</span>

<span class="nc" id="L4147">						logger.debug(&quot;LH-BO**&quot; + TRANSACTION_DATE + &quot;**AMT-&quot;</span>
								+ AMOUNT + &quot;**ACT_TYPE-&quot; + ACC_TYPE
								+ &quot;**AGT_ACC=&quot; + AGENT_ACCOUNT_CURRENT
								+ &quot;**SALE_RET_ACC&quot; + SALE_RET_CURRENT);

<span class="nc" id="L4152">						query2 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L4153">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L4154">						upPstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L4155">						upPstmt.setLong(2, transaction_id);</span>
						// upPstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L4157">						upPstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L4158">						upPstmt.setString(4, -AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L4159">						upPstmt.setString(5, &quot;SALE_RET&quot;);</span>
<span class="nc" id="L4160">						upPstmt.setString(6, SALE_RET_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4161">						upPstmt.setString(7, orgName);</span>
<span class="nc" id="L4162">						upPstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L4163">						upPstmt.execute();</span>

<span class="nc bnc" id="L4165" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L4166">							upPstmt.close();</span>
						}

<span class="nc" id="L4169">						query1 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L4170">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L4172">						updatePstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L4173">						updatePstmt.setLong(2, transaction_id);</span>
						// updatePstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L4175">						updatePstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L4176">						updatePstmt.setString(4, AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L4177">						updatePstmt.setString(5, ACC_TYPE);</span>
<span class="nc" id="L4178">						updatePstmt.setString(6, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4179">						updatePstmt.setString(7, orgName);</span>
<span class="nc" id="L4180">						updatePstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L4181">						updatePstmt.execute();</span>

<span class="nc bnc" id="L4183" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L4184">							updatePstmt.close();</span>
						}

<span class="nc" id="L4187">						query3 = QueryManager.getST2UpadateCurrentBalAgent();</span>
<span class="nc" id="L4188">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L4189">						updPstmt.setString(1, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4190">						updPstmt.setString(2, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L4191">						updPstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L4192">						updPstmt.execute();</span>

<span class="nc bnc" id="L4194" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L4195">							updPstmt.close();</span>
						}

<span class="nc bnc" id="L4198" title="All 2 branches missed.">					} else if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;chq_bounce&quot;)) {</span>
						// System.out.println(&quot;in chq bounce&quot;);
<span class="nc" id="L4200">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST2BoChqBounce());
<span class="nc" id="L4202">						stmt2.setLong(1, transaction_id);</span>
<span class="nc" id="L4203">						rs2 = stmt2.executeQuery();</span>
						// This has been replaced by the obove prepared
						// statements statements 07-03-08
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2BoChqBounce()+&quot;&quot;+
						// transaction_id + &quot;&quot;);

<span class="nc bnc" id="L4210" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L4211">							AMOUNT = rs2.getDouble(&quot;cheque_amt&quot;);</span>
							// TRANSACTION_DATE =
							// rs2.getDate(&quot;transaction_date&quot;);
<span class="nc" id="L4214">							TRANSACTION_DATE = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
							// TRANS_DATE= new
							// java.sql.Date(TRANSACTION_DATE.getTime());
<span class="nc" id="L4218">							ACC_TYPE = &quot;&quot; + rs2.getInt(&quot;agent_org_id&quot;);</span>
<span class="nc" id="L4219">							orgName = rs2.getString(&quot;name&quot;);</span>
						}

<span class="nc bnc" id="L4222" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L4223">							stmt2.close();</span>
						}
<span class="nc bnc" id="L4225" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L4226">							rs2.close();</span>
						}

						// System.out.println(&quot;Amount-- &quot;+AMOUNT+&quot; TRANS DATE--
						// &quot;+TRANSACTION_DATE+&quot; ACC_TYPE-- &quot;+ACC_TYPE+&quot; Org NAme
						// &quot;+orgName);
<span class="nc" id="L4232">						stmt = connection.prepareStatement(QueryManager</span>
								.getST2BoCurrentBalAgent());
<span class="nc" id="L4234">						stmt.setString(1, ACC_TYPE);</span>
<span class="nc" id="L4235">						rs = stmt.executeQuery();</span>
						// This has been replaced by the obove prepared
						// statements statements 07-03-08
						// rs =
						// stmt.executeQuery(QueryManager.getST2BoCurrentBalAgent()+&quot;'&quot;+
						// ACC_TYPE + &quot;'&quot;);
<span class="nc" id="L4241">						int i = 0;</span>
<span class="nc bnc" id="L4242" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L4243">							AGENT_ACCOUNT_CURRENT = rs</span>
									.getDouble(&quot;current_balance&quot;);
<span class="nc" id="L4245">							i++;</span>
						}

<span class="nc bnc" id="L4248" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L4249">							stmt.close();</span>
						}
<span class="nc bnc" id="L4251" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L4252">							rs.close();</span>
						}

<span class="nc bnc" id="L4255" title="All 2 branches missed.">						if (i == 0) {</span>
<span class="nc" id="L4256">							query1 = QueryManager.getST2InsertAgentCurrentBal();</span>
<span class="nc" id="L4257">							updatePstmt = connection.prepareStatement(query1);</span>
<span class="nc" id="L4258">							updatePstmt.setString(1, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L4259">							updatePstmt.setInt(2, 0);</span>
<span class="nc" id="L4260">							updatePstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L4261">							updatePstmt.execute();</span>
<span class="nc" id="L4262">							AGENT_ACCOUNT_CURRENT = 0.0;</span>

<span class="nc bnc" id="L4264" title="All 2 branches missed.">							if (updatePstmt != null) {</span>
<span class="nc" id="L4265">								updatePstmt.close();</span>
							}

						}

<span class="nc" id="L4270">						AGENT_ACCOUNT_CURRENT = AGENT_ACCOUNT_CURRENT - AMOUNT;</span>
<span class="nc" id="L4271">						BANK_ACC_CURRENT = BANK_ACC_CURRENT + AMOUNT;</span>

						// System.out.println(&quot;AGT ACC CUR--
						// &quot;+AGENT_ACCOUNT_CURRENT+&quot;Bank ACC
						// CUR&quot;+BANK_ACC_CURRENT+&quot;&quot;);
<span class="nc" id="L4276">						logger.debug(&quot;LH-BO**&quot; + TRANSACTION_DATE + &quot;**AMT-&quot;</span>
								+ AMOUNT + &quot;**ACT_TYPE-&quot; + ACC_TYPE
								+ &quot;**AGT_ACC=&quot; + AGENT_ACCOUNT_CURRENT
								+ &quot;**BANK_ACC&quot; + BANK_ACC_CURRENT);

<span class="nc" id="L4281">						query1 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L4282">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L4284">						updatePstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L4285">						updatePstmt.setLong(2, transaction_id);</span>
						// updatePstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L4287">						updatePstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L4288">						updatePstmt.setString(4, -AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L4289">						updatePstmt.setString(5, ACC_TYPE);</span>
<span class="nc" id="L4290">						updatePstmt.setString(6, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4291">						updatePstmt.setString(7, orgName);</span>
<span class="nc" id="L4292">						updatePstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L4293">						updatePstmt.execute();</span>

<span class="nc bnc" id="L4295" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L4296">							updatePstmt.close();</span>
						}

<span class="nc" id="L4299">						query2 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L4300">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L4301">						upPstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L4302">						upPstmt.setLong(2, transaction_id);</span>
						// upPstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L4304">						upPstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L4305">						upPstmt.setString(4, AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L4306">						upPstmt.setString(5, &quot;BANK_ACC&quot;);</span>
<span class="nc" id="L4307">						upPstmt.setString(6, BANK_ACC_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4308">						upPstmt.setString(7, orgName);</span>
<span class="nc" id="L4309">						upPstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L4310">						upPstmt.execute();</span>

<span class="nc bnc" id="L4312" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L4313">							upPstmt.close();</span>
						}

<span class="nc" id="L4316">						query3 = QueryManager.getST2UpadateCurrentBalAgent();</span>
<span class="nc" id="L4317">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L4318">						updPstmt.setString(1, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4319">						updPstmt.setString(2, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L4320">						updPstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L4321">						updPstmt.execute();</span>

<span class="nc bnc" id="L4323" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L4324">							updPstmt.close();</span>
						}

<span class="nc bnc" id="L4327" title="All 4 branches missed.">					} else if (TRANSACTION_TYPE</span>
							.equalsIgnoreCase(&quot;DR_NOTE_CASH&quot;)
							|| TRANSACTION_TYPE.equalsIgnoreCase(&quot;DR_NOTE&quot;)) {
						// System.out.println(&quot;in DR_NOTE_CASH &quot;);
<span class="nc" id="L4331">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST6BoDebitNote());
<span class="nc" id="L4333">						stmt2.setLong(1, transaction_id);</span>
<span class="nc" id="L4334">						rs2 = stmt2.executeQuery();</span>
						// System.out.println(&quot;query &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot; + stmt2);//
						// for
						// testing
						// This has been replaced by the obove prepared
						// statements statements 07-03-08
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2BoChqBounce()+&quot;&quot;+
						// transaction_id + &quot;&quot;);

<span class="nc bnc" id="L4344" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L4345">							AMOUNT = rs2.getDouble(&quot;amount&quot;);</span>
							// TRANSACTION_DATE =
							// rs2.getDate(&quot;transaction_date&quot;);
<span class="nc" id="L4348">							TRANSACTION_DATE = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
							// TRANS_DATE= new
							// java.sql.Date(TRANSACTION_DATE.getTime());
<span class="nc" id="L4352">							ACC_TYPE = &quot;&quot; + rs2.getInt(&quot;agent_org_id&quot;);</span>
<span class="nc" id="L4353">							orgName = rs2.getString(&quot;name&quot;);</span>
						}
<span class="nc bnc" id="L4355" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L4356">							stmt2.close();</span>
						}
<span class="nc bnc" id="L4358" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L4359">							rs2.close();</span>
						}
						// System.out.println(&quot;Amount-- &quot;+AMOUNT+&quot; TRANS DATE--
						// &quot;+TRANSACTION_DATE+&quot; ACC_TYPE-- &quot;+ACC_TYPE+&quot; Org NAme
						// &quot;+orgName);
<span class="nc" id="L4364">						stmt = connection.prepareStatement(QueryManager</span>
								.getST2BoCurrentBalAgent());
<span class="nc" id="L4366">						stmt.setString(1, ACC_TYPE);</span>
<span class="nc" id="L4367">						rs = stmt.executeQuery();</span>
						// This has been replaced by the obove prepared
						// statements statements 07-03-08
						// rs =
						// stmt.executeQuery(QueryManager.getST2BoCurrentBalAgent()+&quot;'&quot;+
						// ACC_TYPE + &quot;'&quot;);
<span class="nc" id="L4373">						int i = 0;</span>
<span class="nc bnc" id="L4374" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L4375">							AGENT_ACCOUNT_CURRENT = rs</span>
									.getDouble(&quot;current_balance&quot;);
<span class="nc" id="L4377">							i++;</span>
						}

<span class="nc bnc" id="L4380" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L4381">							stmt.close();</span>
						}
<span class="nc bnc" id="L4383" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L4384">							rs.close();</span>
						}

<span class="nc bnc" id="L4387" title="All 2 branches missed.">						if (i == 0) {</span>
<span class="nc" id="L4388">							query1 = QueryManager.getST2InsertAgentCurrentBal();</span>
<span class="nc" id="L4389">							updatePstmt = connection.prepareStatement(query1);</span>
<span class="nc" id="L4390">							updatePstmt.setString(1, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L4391">							updatePstmt.setInt(2, 0);</span>
<span class="nc" id="L4392">							updatePstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L4393">							updatePstmt.execute();</span>
<span class="nc" id="L4394">							AGENT_ACCOUNT_CURRENT = 0.0;</span>

<span class="nc bnc" id="L4396" title="All 2 branches missed.">							if (updatePstmt != null) {</span>
<span class="nc" id="L4397">								updatePstmt.close();</span>
							}

						}

<span class="nc" id="L4402">						AGENT_ACCOUNT_CURRENT = AGENT_ACCOUNT_CURRENT - AMOUNT;</span>
<span class="nc" id="L4403">						BANK_ACC_CURRENT = BANK_ACC_CURRENT + AMOUNT;</span>

						// System.out.println(&quot;AGT ACC CUR--
						// &quot;+AGENT_ACCOUNT_CURRENT+&quot;Bank ACC
						// CUR&quot;+BANK_ACC_CURRENT+&quot;&quot;);
<span class="nc" id="L4408">						logger.debug(&quot;LH-BO**&quot; + TRANSACTION_DATE + &quot;**AMT-&quot;</span>
								+ AMOUNT + &quot;**ACT_TYPE-&quot; + ACC_TYPE
								+ &quot;**AGT_ACC=&quot; + AGENT_ACCOUNT_CURRENT
								+ &quot;**BANK_ACC&quot; + BANK_ACC_CURRENT);

<span class="nc" id="L4413">						query1 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L4414">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L4416">						updatePstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L4417">						updatePstmt.setLong(2, transaction_id);</span>
						// updatePstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L4419">						updatePstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L4420">						updatePstmt.setString(4, -AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L4421">						updatePstmt.setString(5, ACC_TYPE);</span>
<span class="nc" id="L4422">						updatePstmt.setString(6, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4423">						updatePstmt.setString(7, orgName);</span>
<span class="nc" id="L4424">						updatePstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L4425">						updatePstmt.execute();</span>

<span class="nc bnc" id="L4427" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L4428">							updatePstmt.close();</span>
						}

<span class="nc" id="L4431">						query2 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L4432">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L4433">						upPstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L4434">						upPstmt.setLong(2, transaction_id);</span>
						// upPstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L4436">						upPstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L4437">						upPstmt.setString(4, AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L4438">						upPstmt.setString(5, &quot;BANK_ACC&quot;);</span>
<span class="nc" id="L4439">						upPstmt.setString(6, BANK_ACC_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4440">						upPstmt.setString(7, orgName);</span>
<span class="nc" id="L4441">						upPstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L4442">						upPstmt.execute();</span>

<span class="nc bnc" id="L4444" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L4445">							upPstmt.close();</span>
						}

<span class="nc" id="L4448">						query3 = QueryManager.getST2UpadateCurrentBalAgent();</span>
<span class="nc" id="L4449">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L4450">						updPstmt.setString(1, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4451">						updPstmt.setString(2, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L4452">						updPstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L4453">						updPstmt.execute();</span>

<span class="nc bnc" id="L4455" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L4456">							updPstmt.close();</span>
						}

<span class="nc bnc" id="L4459" title="All 2 branches missed.">					} else if (TRANSACTION_TYPE</span>
							.equalsIgnoreCase(&quot;CR_NOTE_CASH&quot;)) {
						// System.out.println(&quot;in CR_NOTE_CASH &quot;);
<span class="nc" id="L4462">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST6BoCreditNote());
<span class="nc" id="L4464">						stmt2.setLong(1, transaction_id);</span>
<span class="nc" id="L4465">						rs2 = stmt2.executeQuery();</span>
						// This has been replaced by the obove prepared
						// statements statements 07-03-08
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2BoChqBounce()+&quot;&quot;+
						// transaction_id + &quot;&quot;);

<span class="nc bnc" id="L4472" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L4473">							AMOUNT = rs2.getDouble(&quot;amount&quot;);</span>
							// TRANSACTION_DATE =
							// rs2.getDate(&quot;transaction_date&quot;);
<span class="nc" id="L4476">							TRANSACTION_DATE = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
							// TRANS_DATE= new
							// java.sql.Date(TRANSACTION_DATE.getTime());
<span class="nc" id="L4480">							ACC_TYPE = &quot;&quot; + rs2.getInt(&quot;agent_org_id&quot;);</span>
<span class="nc" id="L4481">							orgName = rs2.getString(&quot;name&quot;);</span>
						}

<span class="nc bnc" id="L4484" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L4485">							stmt2.close();</span>
						}
<span class="nc bnc" id="L4487" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L4488">							rs2.close();</span>
						}

						// System.out.println(&quot;Amount-- &quot;+AMOUNT+&quot; TRANS DATE--
						// &quot;+TRANSACTION_DATE+&quot; ACC_TYPE-- &quot;+ACC_TYPE+&quot; Org NAme
						// &quot;+orgName);
<span class="nc" id="L4494">						stmt = connection.prepareStatement(QueryManager</span>
								.getST2BoCurrentBalAgent());
<span class="nc" id="L4496">						stmt.setString(1, ACC_TYPE);</span>
<span class="nc" id="L4497">						rs = stmt.executeQuery();</span>
						// This has been replaced by the obove prepared
						// statements statements 07-03-08
						// rs =
						// stmt.executeQuery(QueryManager.getST2BoCurrentBalAgent()+&quot;'&quot;+
						// ACC_TYPE + &quot;'&quot;);
<span class="nc" id="L4503">						int i = 0;</span>
<span class="nc bnc" id="L4504" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L4505">							AGENT_ACCOUNT_CURRENT = rs</span>
									.getDouble(&quot;current_balance&quot;);
<span class="nc" id="L4507">							i++;</span>
						}

<span class="nc bnc" id="L4510" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L4511">							stmt.close();</span>
						}
<span class="nc bnc" id="L4513" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L4514">							rs.close();</span>
						}

<span class="nc bnc" id="L4517" title="All 2 branches missed.">						if (i == 0) {</span>
<span class="nc" id="L4518">							query1 = QueryManager.getST2InsertAgentCurrentBal();</span>
<span class="nc" id="L4519">							updatePstmt = connection.prepareStatement(query1);</span>
<span class="nc" id="L4520">							updatePstmt.setString(1, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L4521">							updatePstmt.setInt(2, 0);</span>
<span class="nc" id="L4522">							updatePstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L4523">							updatePstmt.execute();</span>
<span class="nc" id="L4524">							AGENT_ACCOUNT_CURRENT = 0.0;</span>

<span class="nc bnc" id="L4526" title="All 2 branches missed.">							if (updatePstmt != null) {</span>
<span class="nc" id="L4527">								updatePstmt.close();</span>
							}

						}

<span class="nc" id="L4532">						AGENT_ACCOUNT_CURRENT = AGENT_ACCOUNT_CURRENT + AMOUNT;</span>
<span class="nc" id="L4533">						BANK_ACC_CURRENT = BANK_ACC_CURRENT - AMOUNT;</span>

						// System.out.println(&quot;AGT ACC CUR--
						// &quot;+AGENT_ACCOUNT_CURRENT+&quot;Bank ACC
						// CUR&quot;+BANK_ACC_CURRENT+&quot;&quot;);
<span class="nc" id="L4538">						logger.debug(&quot;LH-BO**&quot; + TRANSACTION_DATE + &quot;**AMT-&quot;</span>
								+ AMOUNT + &quot;**ACT_TYPE-&quot; + ACC_TYPE
								+ &quot;**AGT_ACC=&quot; + AGENT_ACCOUNT_CURRENT
								+ &quot;**BANK_ACC&quot; + BANK_ACC_CURRENT);

<span class="nc" id="L4543">						query2 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L4544">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L4545">						upPstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L4546">						upPstmt.setLong(2, transaction_id);</span>
						// upPstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L4548">						upPstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L4549">						upPstmt.setString(4, -AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L4550">						upPstmt.setString(5, &quot;BANK_ACC&quot;);</span>
<span class="nc" id="L4551">						upPstmt.setString(6, BANK_ACC_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4552">						upPstmt.setString(7, orgName);</span>
<span class="nc" id="L4553">						upPstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L4554">						upPstmt.execute();</span>

<span class="nc bnc" id="L4556" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L4557">							upPstmt.close();</span>
						}

<span class="nc" id="L4560">						query1 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L4561">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L4563">						updatePstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L4564">						updatePstmt.setLong(2, transaction_id);</span>
						// updatePstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L4566">						updatePstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L4567">						updatePstmt.setString(4, AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L4568">						updatePstmt.setString(5, ACC_TYPE);</span>
<span class="nc" id="L4569">						updatePstmt.setString(6, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4570">						updatePstmt.setString(7, orgName);</span>
<span class="nc" id="L4571">						updatePstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L4572">						updatePstmt.execute();</span>

<span class="nc bnc" id="L4574" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L4575">							updatePstmt.close();</span>
						}

<span class="nc" id="L4578">						query3 = QueryManager.getST2UpadateCurrentBalAgent();</span>
<span class="nc" id="L4579">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L4580">						updPstmt.setString(1, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4581">						updPstmt.setString(2, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L4582">						updPstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L4583">						updPstmt.execute();</span>

<span class="nc bnc" id="L4585" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L4586">							updPstmt.close();</span>
						}

<span class="nc bnc" id="L4589" title="All 4 branches missed.">					} else if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;pwt_plr&quot;)</span>
							|| TRANSACTION_TYPE.equalsIgnoreCase(&quot;dg_pwt_plr&quot;)) {

<span class="nc" id="L4592">						double PWT_AMT = 0;</span>
<span class="nc" id="L4593">						double TAX_AMT = 0;</span>
<span class="nc" id="L4594">						double NET_AMT = 0;</span>
<span class="nc" id="L4595">						String directPwtPlrQry = &quot;&quot;;</span>
<span class="nc bnc" id="L4596" title="All 2 branches missed.">						if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;dg_pwt_plr&quot;)) {</span>
<span class="nc" id="L4597">							directPwtPlrQry = QueryManager.getST2BoDGPwtPlr();</span>
						} else {
<span class="nc" id="L4599">							directPwtPlrQry = QueryManager.getST2BoPwtPlr();</span>
						}
<span class="nc" id="L4601">						stmt = connection.prepareStatement(directPwtPlrQry);</span>
<span class="nc" id="L4602">						stmt.setLong(1, transaction_id);</span>
<span class="nc" id="L4603">						rs = stmt.executeQuery();</span>
						// This has been replaced by the obove prepared
						// statements statements 07-03-08
						// rs =
						// stmt.executeQuery(QueryManager.getST2BoPwtPlr()+&quot;&quot;+
						// transaction_id + &quot;&quot;);
<span class="nc bnc" id="L4609" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L4610">							PWT_AMT = rs.getDouble(&quot;pwt_amt&quot;);</span>
<span class="nc" id="L4611">							TAX_AMT = rs.getDouble(&quot;tax_amt&quot;);</span>
<span class="nc" id="L4612">							NET_AMT = rs.getDouble(&quot;net_amt&quot;);</span>
<span class="nc" id="L4613">							TRANSACTION_TYPE = rs.getString(&quot;transaction_type&quot;);</span>
							// TRANSACTION_DATE =
							// rs.getDate(&quot;transaction_date&quot;);
<span class="nc" id="L4616">							TRANSACTION_DATE = rs</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L4618">							orgName = rs.getString(&quot;first_name&quot;);</span>
						}

<span class="nc" id="L4621">						logger.debug(&quot;LH-BO**&quot; + TRANSACTION_DATE + &quot;**AMT-&quot;</span>
								+ AMOUNT + &quot;**ACT_TYPE-&quot; + ACC_TYPE + &quot;**&quot;
								+ PLAYER_CASH_CURRENT + &quot; PLAYER_TDS_CURRENT =&quot;
								+ PLAYER_TDS_CURRENT + &quot;PLAYER_PWT_CURRENT =&quot;
								+ PLAYER_PWT_CURRENT);
<span class="nc" id="L4626">						logger.debug(&quot;In PWT_PAY_CURRENT is =&quot;</span>
								+ FormatNumber.formatNumber(PWT_PAY_CURRENT)
								+ &quot; TDS_PAY_CURRENT = &quot; + TDS_PAY_CURRENT
								+ &quot;BANK_ACC_CURRENT =&quot;
								+ FormatNumber.formatNumber(BANK_ACC_CURRENT));

<span class="nc" id="L4632">						stmt</span>
								.executeUpdate(&quot;insert into st_lms_bo_ledger (transaction_type, transaction_id,transaction_date,amount,account_type,balance,transaction_with,receipt_id) values ('&quot;
										+ TRANSACTION_TYPE
										+ &quot;',&quot;
										+ transaction_id
										+ &quot;,'&quot;
										+ TRANSACTION_DATE
										+ &quot;',&quot;
										+ (-PWT_AMT + &quot;&quot;)
										+ &quot;,'PWT_PAY',&quot;
										+ FormatNumber
												.formatNumber(PWT_PAY_CURRENT)
										+ &quot;, '&quot;
										+ orgName
										+ &quot;','&quot;
										+ RECEIPT_ID
										+ &quot;')&quot;);

<span class="nc" id="L4650">						stmt</span>
								.executeUpdate(&quot;insert into st_lms_bo_ledger (transaction_type, transaction_id,transaction_date,amount,account_type,balance,transaction_with,receipt_id) values ('&quot;
										+ TRANSACTION_TYPE
										+ &quot;',&quot;
										+ transaction_id
										+ &quot;,'&quot;
										+ TRANSACTION_DATE
										+ &quot;',&quot;
										+ FormatNumber.formatNumber(PWT_AMT)
										+ &quot;,'PLAYER_PWT',&quot;
										+ FormatNumber
												.formatNumber(PLAYER_PWT_CURRENT)
										+ &quot;, '&quot;
										+ orgName
										+ &quot;','&quot;
										+ RECEIPT_ID
										+ &quot;')&quot;);

<span class="nc" id="L4668">						stmt</span>
								.executeUpdate(&quot;insert into st_lms_bo_ledger (transaction_type, transaction_id,transaction_date,amount,account_type,balance,transaction_with,receipt_id) values ('&quot;
										+ TRANSACTION_TYPE
										+ &quot;',&quot;
										+ transaction_id
										+ &quot;,'&quot;
										+ TRANSACTION_DATE
										+ &quot;',&quot;
										+ (-TAX_AMT + &quot;&quot;)
										+ &quot;,'PLAYER_TDS',&quot;
										+ FormatNumber
												.formatNumber(PLAYER_TDS_CURRENT)
										+ &quot;, '&quot;
										+ orgName
										+ &quot;','&quot;
										+ RECEIPT_ID
										+ &quot;')&quot;);
<span class="nc" id="L4685">						stmt</span>
								.executeUpdate(&quot;insert into st_lms_bo_ledger (transaction_type, transaction_id,transaction_date,amount,account_type,balance,transaction_with,receipt_id) values ('&quot;
										+ TRANSACTION_TYPE
										+ &quot;',&quot;
										+ transaction_id
										+ &quot;,'&quot;
										+ TRANSACTION_DATE
										+ &quot;',&quot;
										+ TAX_AMT
										+ &quot;&quot;
										+ &quot;,'TDS_PAY',&quot;
										+ FormatNumber
												.formatNumber(TDS_PAY_CURRENT)
										+ &quot;, '&quot;
										+ orgName
										+ &quot;','&quot;
										+ RECEIPT_ID
										+ &quot;' )&quot;);

<span class="nc" id="L4704">						stmt</span>
								.executeUpdate(&quot;insert into st_lms_bo_ledger (transaction_type, transaction_id,transaction_date,amount,account_type,balance,transaction_with,receipt_id) values ('&quot;
										+ TRANSACTION_TYPE
										+ &quot;',&quot;
										+ transaction_id
										+ &quot;,'&quot;
										+ TRANSACTION_DATE
										+ &quot;',&quot;
										+ (-NET_AMT + &quot;&quot;)
										+ &quot;,'PLAYER_CAS',&quot;
										+ FormatNumber
												.formatNumber(PLAYER_CASH_CURRENT)
										+ &quot;, '&quot;
										+ orgName
										+ &quot;','&quot;
										+ RECEIPT_ID
										+ &quot;' )&quot;);

<span class="nc" id="L4722">						stmt</span>
								.executeUpdate(&quot;insert into st_lms_bo_ledger (transaction_type, transaction_id,transaction_date,amount,account_type,balance,transaction_with,receipt_id) values ('&quot;
										+ TRANSACTION_TYPE
										+ &quot;',&quot;
										+ transaction_id
										+ &quot;,'&quot;
										+ TRANSACTION_DATE
										+ &quot;',&quot;
										+ FormatNumber.formatNumber(NET_AMT)
										+ &quot;,'BANK_ACC',&quot;
										+ FormatNumber
												.formatNumber(BANK_ACC_CURRENT)
										+ &quot;, '&quot;
										+ orgName
										+ &quot;','&quot;
										+ RECEIPT_ID
										+ &quot;' )&quot;);

<span class="nc bnc" id="L4740" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L4741">							stmt.close();</span>
						}
<span class="nc bnc" id="L4743" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L4744">							rs.close();</span>
						}

<span class="nc" id="L4747">					}</span>

<span class="nc bnc" id="L4749" title="All 2 branches missed.">					else if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;tds&quot;)) {</span>
						// System.out.println(&quot;in TDS&quot;);
<span class="nc" id="L4751">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST2BoTds());
<span class="nc" id="L4753">						stmt2.setLong(1, transaction_id);</span>
<span class="nc" id="L4754">						rs2 = stmt2.executeQuery();</span>
						// This has been replaced by the obove prepared
						// statements statements 07-03-08
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2BoTds()+&quot;&quot;+
						// transaction_id + &quot;&quot;);

<span class="nc bnc" id="L4761" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L4762">							AMOUNT = rs2.getDouble(&quot;amount&quot;);</span>
							// TRANSACTION_DATE =
							// rs2.getDate(&quot;transaction_date&quot;);
<span class="nc" id="L4765">							TRANSACTION_DATE = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L4767">							ACC_TYPE = &quot;TDS_PAY&quot;;</span>
						}

<span class="nc bnc" id="L4770" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L4771">							stmt2.close();</span>
						}
<span class="nc bnc" id="L4773" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L4774">							rs2.close();</span>
						}

						// System.out.println(&quot;Amount-- &quot;+AMOUNT+&quot; TRANS DATE--
						// &quot;+TRANSACTION_DATE+&quot; ACC_TYPE-- &quot;+ACC_TYPE);

<span class="nc" id="L4780">						TDS_PAY_CURRENT = TDS_PAY_CURRENT - AMOUNT;</span>
<span class="nc" id="L4781">						BANK_ACC_CURRENT = BANK_ACC_CURRENT + AMOUNT;</span>
						// System.out.println(&quot;TDS ACC CUR--
						// &quot;+TDS_PAY_CURRENT+&quot;Bank ACC
						// CUR&quot;+BANK_ACC_CURRENT+&quot;&quot;);
<span class="nc" id="L4785">						logger.debug(&quot;LH-BO**&quot; + TRANSACTION_DATE + &quot;**AMT-&quot;</span>
								+ AMOUNT + &quot;**ACT_TYPE-&quot; + ACC_TYPE
								+ &quot;**TDS_ACC=&quot; + TDS_PAY_CURRENT + &quot;**BANK_ACC&quot;
								+ BANK_ACC_CURRENT);

<span class="nc" id="L4790">						query1 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L4791">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L4793">						updatePstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L4794">						updatePstmt.setLong(2, transaction_id);</span>
						// updatePstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L4796">						updatePstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L4797">						updatePstmt.setString(4, -AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L4798">						updatePstmt.setString(5, ACC_TYPE);</span>
<span class="nc" id="L4799">						updatePstmt.setString(6, TDS_PAY_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4800">						updatePstmt.setString(7, &quot;GOVERNMENT&quot;);</span>
<span class="nc" id="L4801">						updatePstmt.setString(8, RECEIPT_ID);</span>

<span class="nc" id="L4803">						updatePstmt.execute();</span>

<span class="nc bnc" id="L4805" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L4806">							updatePstmt.close();</span>
						}

<span class="nc" id="L4809">						query2 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L4810">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L4811">						upPstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L4812">						upPstmt.setLong(2, transaction_id);</span>
						// upPstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L4814">						upPstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L4815">						upPstmt.setString(4, AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L4816">						upPstmt.setString(5, &quot;BANK_ACC&quot;);</span>
<span class="nc" id="L4817">						upPstmt.setString(6, BANK_ACC_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4818">						upPstmt.setString(7, &quot;GOVERNMENT&quot;);</span>
<span class="nc" id="L4819">						upPstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L4820">						upPstmt.execute();</span>

<span class="nc bnc" id="L4822" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L4823">							upPstmt.close();</span>
						}

<span class="nc bnc" id="L4826" title="All 2 branches missed.">					} else if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;govt_comm&quot;)) {</span>
						// System.out.println(&quot;in Govt COmm&quot;);
<span class="nc" id="L4828">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST2BoGovtComm());
<span class="nc" id="L4830">						stmt2.setLong(1, transaction_id);</span>
<span class="nc" id="L4831">						rs2 = stmt2.executeQuery();</span>
						// This has been replaced by the obove prepared
						// statements statements 07-03-08
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2BoGovtComm()+&quot;&quot;+
						// transaction_id + &quot;&quot;);

<span class="nc bnc" id="L4838" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L4839">							AMOUNT = rs2.getDouble(&quot;amount&quot;);</span>
							// TRANSACTION_DATE =
							// rs2.getDate(&quot;transaction_date&quot;);
<span class="nc" id="L4842">							TRANSACTION_DATE = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L4844">							ACC_TYPE = &quot;GOVT_COMM&quot;;</span>
						}

<span class="nc bnc" id="L4847" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L4848">							stmt2.close();</span>
						}
<span class="nc bnc" id="L4850" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L4851">							rs2.close();</span>
						}

						// System.out.println(&quot;Amount-- &quot;+AMOUNT+&quot; TRANS DATE--
						// &quot;+TRANSACTION_DATE+&quot; ACC_TYPE-- &quot;+ACC_TYPE);

<span class="nc" id="L4857">						GOVT_COMM_CURRENT = GOVT_COMM_CURRENT - AMOUNT;</span>
<span class="nc" id="L4858">						BANK_ACC_CURRENT = BANK_ACC_CURRENT + AMOUNT;</span>
						// System.out.println(&quot;GOVT ACC CUR--
						// &quot;+GOVT_COMM_CURRENT+&quot;Bank ACC
						// CUR&quot;+BANK_ACC_CURRENT+&quot;&quot;);
<span class="nc" id="L4862">						logger.debug(&quot;LH-BO**&quot; + TRANSACTION_DATE + &quot;**AMT-&quot;</span>
								+ AMOUNT + &quot;**ACT_TYPE-&quot; + ACC_TYPE
								+ &quot;**GOVT_ACC=&quot; + GOVT_COMM_CURRENT
								+ &quot;**BANK_ACC&quot; + BANK_ACC_CURRENT);

<span class="nc" id="L4867">						query1 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L4868">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L4870">						updatePstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L4871">						updatePstmt.setLong(2, transaction_id);</span>
						// updatePstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L4873">						updatePstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L4874">						updatePstmt.setString(4, -AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L4875">						updatePstmt.setString(5, ACC_TYPE);</span>
<span class="nc" id="L4876">						updatePstmt.setString(6, GOVT_COMM_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4877">						updatePstmt.setString(7, &quot;GOVERNMENT&quot;);</span>
<span class="nc" id="L4878">						updatePstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L4879">						updatePstmt.execute();</span>

<span class="nc bnc" id="L4881" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L4882">							updatePstmt.close();</span>
						}

<span class="nc" id="L4885">						query2 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L4886">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L4887">						upPstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L4888">						upPstmt.setLong(2, transaction_id);</span>
						// upPstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L4890">						upPstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L4891">						upPstmt.setString(4, AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L4892">						upPstmt.setString(5, &quot;BANK_ACC&quot;);</span>
<span class="nc" id="L4893">						upPstmt.setString(6, BANK_ACC_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4894">						upPstmt.setString(7, &quot;GOVERNMENT&quot;);</span>
<span class="nc" id="L4895">						upPstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L4896">						upPstmt.execute();</span>

<span class="nc bnc" id="L4898" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L4899">							upPstmt.close();</span>
						}

					}
					/*
					 * added on 7-12-2008 on Abhisheks recommendations
					 */
<span class="nc bnc" id="L4906" title="All 2 branches missed.">					else if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;vat&quot;)) {</span>

						// System.out.println(&quot;in VAT&quot;);
<span class="nc" id="L4909">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST6BoVATPayable());
<span class="nc" id="L4911">						stmt2.setLong(1, transaction_id);</span>
<span class="nc" id="L4912">						rs2 = stmt2.executeQuery();</span>
						// This has been replaced by the obove prepared
						// statements statements 07-03-08
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2BoGovtComm()+&quot;&quot;+
						// transaction_id + &quot;&quot;);

<span class="nc bnc" id="L4919" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L4920">							AMOUNT = rs2.getDouble(&quot;amount&quot;);</span>
							// TRANSACTION_DATE =
							// rs2.getDate(&quot;transaction_date&quot;);
<span class="nc" id="L4923">							TRANSACTION_DATE = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L4925">							ACC_TYPE = &quot;VAT_PAY&quot;;</span>
						}

<span class="nc bnc" id="L4928" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L4929">							stmt2.close();</span>
						}
<span class="nc bnc" id="L4931" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L4932">							rs2.close();</span>
						}

						// System.out.println(&quot;Amount-- &quot;+AMOUNT+&quot; TRANS DATE--
						// &quot;+TRANSACTION_DATE+&quot; ACC_TYPE-- &quot;+ACC_TYPE);

<span class="nc" id="L4938">						VAT_PAY_CURRENT = VAT_PAY_CURRENT - AMOUNT;</span>
<span class="nc" id="L4939">						BANK_ACC_CURRENT = BANK_ACC_CURRENT + AMOUNT;</span>
						// System.out.println(&quot;VAT_PAY_CURRENT--
						// &quot;+VAT_PAY_CURRENT+&quot;Bank ACC
						// CUR&quot;+BANK_ACC_CURRENT+&quot;&quot;);
<span class="nc" id="L4943">						logger.debug(&quot;LH-BO**&quot; + TRANSACTION_DATE + &quot;**AMT-&quot;</span>
								+ AMOUNT + &quot;**ACT_TYPE-&quot; + ACC_TYPE
								+ &quot;**VAT_ACC=&quot; + VAT_PAY_CURRENT + &quot;**BANK_ACC&quot;
								+ BANK_ACC_CURRENT);

<span class="nc" id="L4948">						query1 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L4949">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L4951">						updatePstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L4952">						updatePstmt.setLong(2, transaction_id);</span>
						// updatePstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L4954">						updatePstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L4955">						updatePstmt.setString(4, -AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L4956">						updatePstmt.setString(5, ACC_TYPE);</span>
<span class="nc" id="L4957">						updatePstmt.setString(6, VAT_PAY_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4958">						updatePstmt.setString(7, &quot;GOVERNMENT&quot;);</span>
<span class="nc" id="L4959">						updatePstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L4960">						updatePstmt.execute();</span>

<span class="nc bnc" id="L4962" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L4963">							updatePstmt.close();</span>
						}

<span class="nc" id="L4966">						query2 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L4967">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L4968">						upPstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L4969">						upPstmt.setLong(2, transaction_id);</span>
						// upPstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L4971">						upPstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L4972">						upPstmt.setString(4, AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L4973">						upPstmt.setString(5, &quot;BANK_ACC&quot;);</span>
<span class="nc" id="L4974">						upPstmt.setString(6, BANK_ACC_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L4975">						upPstmt.setString(7, &quot;GOVERNMENT&quot;);</span>
<span class="nc" id="L4976">						upPstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L4977">						upPstmt.execute();</span>

<span class="nc bnc" id="L4979" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L4980">							upPstmt.close();</span>
						}

					}

<span class="nc bnc" id="L4985" title="All 2 branches missed.">					else if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;unclm_pwt&quot;)) {</span>
						// System.out.println(&quot;in UNCLM PWT&quot;);
<span class="nc" id="L4987">						stmt2 = connection.prepareStatement(QueryManager</span>
								.getST2BoUnclmPwt());
<span class="nc" id="L4989">						stmt2.setLong(1, transaction_id);</span>
<span class="nc" id="L4990">						rs2 = stmt2.executeQuery();</span>
						// This has been replaced by the obove prepared
						// statements statements 07-03-08
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2BoUnclmPwt()+&quot;&quot;+
						// transaction_id + &quot;&quot;);

<span class="nc bnc" id="L4997" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L4998">							AMOUNT = rs2.getDouble(&quot;amount&quot;);</span>
							// TRANSACTION_DATE =
							// rs2.getDate(&quot;transaction_date&quot;);
<span class="nc" id="L5001">							TRANSACTION_DATE = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L5003">							ACC_TYPE = &quot;UNCLM_GOVT&quot;;</span>
						}

<span class="nc bnc" id="L5006" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L5007">							stmt2.close();</span>
						}
<span class="nc bnc" id="L5009" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L5010">							rs2.close();</span>
						}
						// System.out.println(&quot;Amount-- &quot;+AMOUNT+&quot; TRANS DATE--
						// &quot;+TRANSACTION_DATE+&quot; ACC_TYPE-- &quot;+ACC_TYPE);

<span class="nc" id="L5015">						UNCLM_GOVT_CURRENT = UNCLM_GOVT_CURRENT - AMOUNT;</span>
<span class="nc" id="L5016">						BANK_ACC_CURRENT = BANK_ACC_CURRENT + AMOUNT;</span>
						// System.out.println(&quot;UNCLM ACC CUR--
						// &quot;+UNCLM_GOVT_CURRENT+&quot;Bank ACC
						// CUR&quot;+BANK_ACC_CURRENT+&quot;&quot;);
<span class="nc" id="L5020">						logger.debug(&quot;LH-BO**&quot; + TRANSACTION_DATE + &quot;**AMT-&quot;</span>
								+ AMOUNT + &quot;**ACT_TYPE-&quot; + ACC_TYPE
								+ &quot;**UNCLM_GOVT_ACC=&quot; + UNCLM_GOVT_CURRENT
								+ &quot;**BANK_ACC&quot; + BANK_ACC_CURRENT);

<span class="nc" id="L5025">						query1 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L5026">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L5028">						updatePstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L5029">						updatePstmt.setLong(2, transaction_id);</span>
						// updatePstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L5031">						updatePstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L5032">						updatePstmt.setString(4, -AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L5033">						updatePstmt.setString(5, ACC_TYPE);</span>
<span class="nc" id="L5034">						updatePstmt.setString(6, UNCLM_GOVT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5035">						updatePstmt.setString(7, &quot;GOVERNMENT&quot;);</span>
<span class="nc" id="L5036">						updatePstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L5037">						updatePstmt.execute();</span>

<span class="nc bnc" id="L5039" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L5040">							updatePstmt.close();</span>
						}

<span class="nc" id="L5043">						query2 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L5044">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L5045">						upPstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L5046">						upPstmt.setLong(2, transaction_id);</span>
						// upPstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L5048">						upPstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L5049">						upPstmt.setString(4, AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L5050">						upPstmt.setString(5, &quot;BANK_ACC&quot;);</span>
<span class="nc" id="L5051">						upPstmt.setString(6, BANK_ACC_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5052">						upPstmt.setString(7, &quot;GOVERNMENT&quot;);</span>
<span class="nc" id="L5053">						upPstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L5054">						upPstmt.execute();</span>

<span class="nc bnc" id="L5056" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L5057">							upPstmt.close();</span>
						}

<span class="nc bnc" id="L5060" title="All 10 branches missed.">					} else if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;pwt&quot;)</span>
							|| TRANSACTION_TYPE.equalsIgnoreCase(&quot;pwt_auto&quot;)
							|| TRANSACTION_TYPE.equalsIgnoreCase(&quot;DG_PWT&quot;)
							|| TRANSACTION_TYPE.equalsIgnoreCase(&quot;DG_PWT_AUTO&quot;) || TRANSACTION_TYPE.equalsIgnoreCase(&quot;OLA_WITHDRAWL&quot;)) {
						// System.out.println(&quot;in PWT&quot;);
						// System.out.println(&quot;in pwtttttt&quot;);
<span class="nc" id="L5066">						String pwtQuery = &quot;&quot;;</span>
<span class="nc" id="L5067">						double PWT_CHARGES_AMOUNT = 0.0;</span>
<span class="nc bnc" id="L5068" title="All 4 branches missed.">						if (TRANSACTION_TYPE.equalsIgnoreCase(&quot;DG_PWT&quot;)</span>
								|| TRANSACTION_TYPE
										.equalsIgnoreCase(&quot;DG_PWT_AUTO&quot;)) {
<span class="nc" id="L5071">							pwtQuery = QueryManager.getST2BoDrGmPwtPay();</span>
							// System.out.println(&quot;getST2BoDrGmPwtPay &quot; +
							// pwtQuery);
<span class="nc bnc" id="L5074" title="All 2 branches missed.">						}else if(TRANSACTION_TYPE.equalsIgnoreCase(&quot;OLA_WITHDRAWL&quot;))</span>
						{
<span class="nc" id="L5076">							pwtQuery = QueryManager.getST2BoOlaWithdrawl();</span>
						}
						else {
<span class="nc" id="L5079">							pwtQuery = QueryManager.getST2BoPwtPay();</span>
							// System.out.println(&quot;getST2BoPwtPay &quot; + pwtQuery);
						}
<span class="nc" id="L5082">						stmt2 = connection.prepareStatement(pwtQuery);</span>
<span class="nc" id="L5083">						stmt2.setLong(1, transaction_id);</span>
<span class="nc" id="L5084">						rs2 = stmt2.executeQuery();</span>
						// This has been replaced by the obove prepared
						// statements statements 07-03-08
						// rs2 =
						// stmt2.executeQuery(QueryManager.getST2BoPwtPay()+&quot;&quot;+
						// transaction_id + &quot;&quot;);
<span class="nc bnc" id="L5090" title="All 2 branches missed.">						while (rs2.next()) {</span>
<span class="nc" id="L5091">							AMOUNT = rs2.getDouble(&quot;pwt_amount&quot;);</span>
<span class="nc" id="L5092">							PWT_CHARGES_AMOUNT = rs2.getDouble(&quot;comm_amount&quot;);</span>
							// TRANSACTION_DATE =
							// rs2.getDate(&quot;transaction_date&quot;);
<span class="nc" id="L5095">							TRANSACTION_DATE = rs2</span>
									.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L5097">							ACC_TYPE = &quot;&quot; + rs2.getInt(&quot;agent_org_id&quot;);</span>
<span class="nc" id="L5098">							orgName = rs2.getString(&quot;name&quot;);</span>
						}

<span class="nc bnc" id="L5101" title="All 2 branches missed.">						if (stmt2 != null) {</span>
<span class="nc" id="L5102">							stmt2.close();</span>
						}
<span class="nc bnc" id="L5104" title="All 2 branches missed.">						if (rs2 != null) {</span>
<span class="nc" id="L5105">							rs2.close();</span>
						}

						// System.out.println(&quot;Amount-- &quot;+AMOUNT+&quot; TRANS DATE--
						// &quot;+TRANSACTION_DATE+&quot; ACC_TYPE-- &quot;+ACC_TYPE +&quot;
						// PWT_CHARGES_AMOUNT &quot;+PWT_CHARGES_AMOUNT+&quot;&quot;);

<span class="nc" id="L5112">						stmt = connection.prepareStatement(QueryManager</span>
								.getST2BoCurrentBalAgent());
<span class="nc" id="L5114">						stmt.setString(1, ACC_TYPE);</span>
						// System.out.println(&quot;gggggggggggggggggggg&quot;);
<span class="nc" id="L5116">						rs = stmt.executeQuery();</span>
						// System.out.println(&quot;ffffffffffffffffffffffff&quot;);
						// This has been replaced by the obove prepared
						// statements statements 07-03-08
						// rs =
						// stmt.executeQuery(QueryManager.getST2BoCurrentBalAgent()+&quot;
						// '&quot;+ ACC_TYPE + &quot;'&quot;);
<span class="nc" id="L5123">						int i = 0;</span>
<span class="nc bnc" id="L5124" title="All 2 branches missed.">						while (rs.next()) {</span>
<span class="nc" id="L5125">							AGENT_ACCOUNT_CURRENT = rs</span>
									.getDouble(&quot;current_balance&quot;);
<span class="nc" id="L5127">							i++;</span>
						}

<span class="nc bnc" id="L5130" title="All 2 branches missed.">						if (stmt != null) {</span>
<span class="nc" id="L5131">							stmt.close();</span>
						}
<span class="nc bnc" id="L5133" title="All 2 branches missed.">						if (rs != null) {</span>
<span class="nc" id="L5134">							rs.close();</span>
						}

<span class="nc bnc" id="L5137" title="All 2 branches missed.">						if (i == 0) {</span>
<span class="nc" id="L5138">							query1 = QueryManager.getST2InsertAgentCurrentBal();</span>
<span class="nc" id="L5139">							updatePstmt = connection.prepareStatement(query1);</span>
<span class="nc" id="L5140">							updatePstmt.setString(1, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L5141">							updatePstmt.setInt(2, 0);</span>
<span class="nc" id="L5142">							updatePstmt.setString(3, ACC_TYPE);</span>
							// System.out.println(&quot;sdsdsdsd&quot;);
							// System.out.println(&quot;query is : &quot; + updatePstmt +
							// &quot;agent id is &quot; + ACC_TYPE);
<span class="nc" id="L5146">							updatePstmt.execute();</span>
							// System.out.println(&quot;hhhhhhhhh&quot;);
<span class="nc" id="L5148">							AGENT_ACCOUNT_CURRENT = 0.0;</span>

<span class="nc bnc" id="L5150" title="All 2 branches missed.">							if (updatePstmt != null) {</span>
<span class="nc" id="L5151">								updatePstmt.close();</span>
							}

						}

<span class="nc" id="L5156">						AGENT_ACCOUNT_CURRENT = AGENT_ACCOUNT_CURRENT + AMOUNT;</span>
<span class="nc" id="L5157">						PWT_PAY_CURRENT = PWT_PAY_CURRENT - AMOUNT;</span>
						// System.out.println(&quot;In BoLedger trans_id is =
						// &quot;+transaction_id+&quot; tratype = &quot;+TRANSACTION_TYPE+
						// &quot;TRANSACTION_DATE = &quot;+TRANSACTION_DATE+&quot; AGENT
						// curr=&quot;+AGENT_ACCOUNT_CURRENT+&quot;&quot;);
						// System.out.println(&quot;PWT ACC CUR--
						// &quot;+PWT_PAY_CURRENT+&quot;AGENT ACC
						// CUR&quot;+AGENT_ACCOUNT_CURRENT+&quot;&quot;);
<span class="nc" id="L5165">						logger.debug(&quot;LH-BO**&quot; + TRANSACTION_DATE + &quot;**AMT-&quot;</span>
								+ AMOUNT + &quot;**ACT_TYPE-&quot; + ACC_TYPE
								+ &quot;**AGT_ACC=&quot; + AGENT_ACCOUNT_CURRENT
								+ &quot;**PWT_ACC&quot; + PWT_PAY_CURRENT);

<span class="nc" id="L5170">						query2 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L5171">						upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L5172">						upPstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L5173">						upPstmt.setLong(2, transaction_id);</span>
						// upPstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L5175">						upPstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L5176">						upPstmt.setString(4, -AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L5177">						upPstmt.setString(5, &quot;PWT_PAY&quot;);</span>
<span class="nc" id="L5178">						upPstmt.setString(6, PWT_PAY_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5179">						upPstmt.setString(7, orgName);</span>
<span class="nc" id="L5180">						upPstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L5181">						upPstmt.execute();</span>

<span class="nc bnc" id="L5183" title="All 2 branches missed.">						if (upPstmt != null) {</span>
<span class="nc" id="L5184">							upPstmt.close();</span>
						}

<span class="nc" id="L5187">						query1 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L5188">						updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L5190">						updatePstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L5191">						updatePstmt.setLong(2, transaction_id);</span>
						// updatePstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L5193">						updatePstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L5194">						updatePstmt.setString(4, AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L5195">						updatePstmt.setString(5, ACC_TYPE);</span>
<span class="nc" id="L5196">						updatePstmt.setString(6, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5197">						updatePstmt.setString(7, orgName);</span>
<span class="nc" id="L5198">						updatePstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L5199">						updatePstmt.execute();</span>

<span class="nc bnc" id="L5201" title="All 2 branches missed.">						if (updatePstmt != null) {</span>
<span class="nc" id="L5202">							updatePstmt.close();</span>
						}

<span class="nc" id="L5205">						query3 = QueryManager.getST2UpadateCurrentBalAgent();</span>
<span class="nc" id="L5206">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L5207">						updPstmt.setString(1, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5208">						updPstmt.setString(2, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L5209">						updPstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L5210">						updPstmt.execute();</span>

<span class="nc bnc" id="L5212" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L5213">							updPstmt.close();</span>
						}

						/*
						 * moved below after changes for collection charges
						 * 
						 * query3 = QueryManager.getST2UpadateCurrentBalAgent();
						 * updPstmt=connection.prepareStatement(query3);
						 * updPstmt.setString(1, AGENT_ACCOUNT_CURRENT+&quot;&quot;);
						 * updPstmt.setString(2, &quot;AGENT_ACC&quot;);
						 * updPstmt.setString(3, ACC_TYPE); updPstmt.execute();
						 */

						/*
						 * added for pwt collection charges 08-12-2008
						 */
<span class="nc" id="L5229">						AGENT_ACCOUNT_CURRENT = AGENT_ACCOUNT_CURRENT</span>
								+ PWT_CHARGES_AMOUNT;
<span class="nc" id="L5231">						PWT_CHARGES_CURRENT = PWT_CHARGES_CURRENT</span>
								- PWT_CHARGES_AMOUNT;
						// System.out.println(&quot;In BoLedger trans_id is =
						// &quot;+transaction_id+&quot; tratype = &quot;+TRANSACTION_TYPE+
						// &quot;TRANSACTION_DATE = &quot;+TRANSACTION_DATE+&quot; AGENT
						// curr=&quot;+AGENT_ACCOUNT_CURRENT+&quot;&quot;);
						// System.out.println(&quot;PWT_CHARGES_CURRENT--
						// &quot;+PWT_CHARGES_CURRENT+&quot;AGENT ACC
						// CUR&quot;+AGENT_ACCOUNT_CURRENT+&quot;&quot;);

<span class="nc bnc" id="L5241" title="All 2 branches missed.">						if (PWT_CHARGES_AMOUNT != 0.0) {</span>
<span class="nc" id="L5242">							query2 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L5243">							upPstmt = connection.prepareStatement(query2);</span>
<span class="nc" id="L5244">							upPstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L5245">							upPstmt.setLong(2, transaction_id);</span>
							// upPstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L5247">							upPstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L5248">							upPstmt.setString(4, -PWT_CHARGES_AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L5249">							upPstmt.setString(5, &quot;PWT_CHARGES&quot;);</span>
<span class="nc" id="L5250">							upPstmt.setString(6, PWT_CHARGES_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5251">							upPstmt.setString(7, orgName);</span>
<span class="nc" id="L5252">							upPstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L5253">							upPstmt.execute();</span>

<span class="nc bnc" id="L5255" title="All 2 branches missed.">							if (upPstmt != null) {</span>
<span class="nc" id="L5256">								upPstmt.close();</span>
							}

<span class="nc" id="L5259">							query1 = QueryManager.getST2InsertBoLedger();</span>
<span class="nc" id="L5260">							updatePstmt = connection.prepareStatement(query1);</span>

<span class="nc" id="L5262">							updatePstmt.setString(1, TRANSACTION_TYPE);</span>
<span class="nc" id="L5263">							updatePstmt.setLong(2, transaction_id);</span>
							// updatePstmt.setDate(3, TRANSACTION_DATE);
<span class="nc" id="L5265">							updatePstmt.setTimestamp(3, TRANSACTION_DATE);</span>
<span class="nc" id="L5266">							updatePstmt.setString(4, PWT_CHARGES_AMOUNT + &quot;&quot;);</span>
<span class="nc" id="L5267">							updatePstmt.setString(5, ACC_TYPE + &quot;#&quot;);</span>
<span class="nc" id="L5268">							updatePstmt</span>
									.setString(6, AGENT_ACCOUNT_CURRENT + &quot;&quot;);
<span class="nc" id="L5270">							updatePstmt.setString(7, orgName);</span>
<span class="nc" id="L5271">							updatePstmt.setString(8, RECEIPT_ID);</span>
<span class="nc" id="L5272">							updatePstmt.execute();</span>

<span class="nc bnc" id="L5274" title="All 2 branches missed.">							if (updatePstmt != null) {</span>
<span class="nc" id="L5275">								updatePstmt.close();</span>
							}

						}

<span class="nc" id="L5280">						query3 = QueryManager.getST2UpadateCurrentBalAgent();</span>
<span class="nc" id="L5281">						updPstmt = connection.prepareStatement(query3);</span>
<span class="nc" id="L5282">						updPstmt.setString(1, AGENT_ACCOUNT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5283">						updPstmt.setString(2, &quot;AGENT_ACC&quot;);</span>
<span class="nc" id="L5284">						updPstmt.setString(3, ACC_TYPE);</span>
<span class="nc" id="L5285">						updPstmt.execute();</span>

<span class="nc bnc" id="L5287" title="All 2 branches missed.">						if (updPstmt != null) {</span>
<span class="nc" id="L5288">							updPstmt.close();</span>
						}

						/*
						 * end pwt collection charges
						 */
					}
<span class="nc" id="L5295">				}</span>

<span class="nc" id="L5297">				query3 = QueryManager.getST2UpdateCurrentBal();</span>
<span class="nc" id="L5298">				updPstmt = connection.prepareStatement(query3);</span>

<span class="nc" id="L5300">				updPstmt.setString(1, BANK_ACC_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5301">				updPstmt.setString(2, &quot;BANK_ACC&quot;);</span>
<span class="nc" id="L5302">				updPstmt.execute();</span>
<span class="nc" id="L5303">				updPstmt.setString(1, TDS_PAY_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5304">				updPstmt.setString(2, &quot;TDS_PAY&quot;);</span>
<span class="nc" id="L5305">				updPstmt.execute();</span>
<span class="nc" id="L5306">				updPstmt.setString(1, SALE_ACC_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5307">				updPstmt.setString(2, &quot;SALE_ACC&quot;);</span>
<span class="nc" id="L5308">				updPstmt.execute();</span>

<span class="nc" id="L5310">				updPstmt.setString(1, SALE_RET_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5311">				updPstmt.setString(2, &quot;SALE_RET&quot;);</span>
<span class="nc" id="L5312">				updPstmt.execute();</span>
<span class="nc" id="L5313">				updPstmt.setString(1, PWT_PAY_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5314">				updPstmt.setString(2, &quot;PWT_PAY&quot;);</span>
<span class="nc" id="L5315">				updPstmt.execute();</span>

<span class="nc" id="L5317">				updPstmt.setString(1, UNCLM_GOVT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5318">				updPstmt.setString(2, &quot;UNCLM_GOVT&quot;);</span>
<span class="nc" id="L5319">				updPstmt.execute();</span>
<span class="nc" id="L5320">				updPstmt.setString(1, GOVT_COMM_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5321">				updPstmt.setString(2, &quot;GOVT_COMM&quot;);</span>
<span class="nc" id="L5322">				updPstmt.execute();</span>

				/*
				 * added on 07-12-2008 on abhishekhs recommendation
				 */

<span class="nc" id="L5328">				updPstmt.setString(1, VAT_PAY_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5329">				updPstmt.setString(2, &quot;VAT_PAY&quot;);</span>
<span class="nc" id="L5330">				updPstmt.execute();</span>

				/*
				 * for collection charges
				 */
<span class="nc" id="L5335">				updPstmt.setString(1, PWT_CHARGES_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5336">				updPstmt.setString(2, &quot;PWT_CHARGES&quot;);</span>
<span class="nc" id="L5337">				updPstmt.execute();</span>

				/*
				 */
<span class="nc" id="L5341">				updPstmt.setString(1, PLAYER_TDS_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5342">				updPstmt.setString(2, &quot;PLAYER_TDS&quot;);</span>
<span class="nc" id="L5343">				updPstmt.execute();</span>

<span class="nc" id="L5345">				updPstmt.setString(1, PLAYER_PWT_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5346">				updPstmt.setString(2, &quot;PLAYER_PWT&quot;);</span>
<span class="nc" id="L5347">				updPstmt.execute();</span>

<span class="nc" id="L5349">				updPstmt.setString(1, PLAYER_CASH_CURRENT + &quot;&quot;);</span>
<span class="nc" id="L5350">				updPstmt.setString(2, &quot;PLAYER_CAS&quot;);</span>
<span class="nc" id="L5351">				updPstmt.execute();</span>

<span class="nc bnc" id="L5353" title="All 2 branches missed.">				if (updPstmt != null) {</span>
<span class="nc" id="L5354">					updPstmt.close();</span>
				}
<span class="nc" id="L5356">				insBalHistory(&quot;bo&quot;, connection);</span>
			}

<span class="nc" id="L5359">			connection.commit();</span>
<span class="nc" id="L5360">		} catch (SQLException e) {</span>

			try {
<span class="nc" id="L5363">				System.out.println(&quot;In BO Exception &quot; + e);</span>
<span class="nc" id="L5364">				connection.rollback();</span>
<span class="nc" id="L5365">			} catch (SQLException e1) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L5367">				e1.printStackTrace();</span>
<span class="nc" id="L5368">			}</span>
<span class="nc" id="L5369">			e.printStackTrace();</span>
<span class="nc" id="L5370">			throw new LMSException(e);</span>
		}

		finally {

<span class="nc bnc" id="L5375" title="All 4 branches missed.">			if (connection != null) {</span>
				try {
<span class="nc bnc" id="L5377" title="All 4 branches missed.">					if (rs1 != null) {</span>
<span class="nc" id="L5378">						rs1.close();</span>
					}
<span class="nc" id="L5380">					connection.close();</span>

<span class="nc" id="L5382">				} catch (SQLException e) {</span>
					// TODO Auto-generated catch block
<span class="nc" id="L5384">					e.printStackTrace();</span>
<span class="nc" id="L5385">				}</span>
			}
		}

<span class="nc" id="L5389">	}</span>

	private void onAdhocUpdateLedger(String tier) {
<span class="nc" id="L5392">		Connection connection = DBConnect.getConnection();</span>
<span class="nc" id="L5393">		Timestamp trxDate = null;</span>
<span class="nc" id="L5394">		Timestamp ledgerDate = null;</span>
<span class="nc" id="L5395">		String trxWith = null;</span>
<span class="nc" id="L5396">		String tableName = tier;</span>
<span class="nc" id="L5397">		long trxId = 0;</span>
		try {
<span class="nc" id="L5399">			connection.setAutoCommit(false);</span>
<span class="nc" id="L5400">			stmt = connection</span>
					.prepareStatement(&quot;select transaction_date,transaction_id,transaction_with from st_lms_&quot;
							+ tier
							+ &quot;_ledger order by transaction_date desc limit 1&quot;);
<span class="nc" id="L5404">			rs = stmt.executeQuery();</span>
<span class="nc bnc" id="L5405" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L5406">				ledgerDate = rs.getTimestamp(&quot;transaction_date&quot;);</span>
<span class="nc" id="L5407">				trxId = rs.getLong(&quot;transaction_id&quot;);</span>
<span class="nc" id="L5408">				trxWith = rs.getString(&quot;transaction_with&quot;);</span>
			}
<span class="nc" id="L5410">			logger.debug(&quot;In Ledger Helper**tier &quot; + tier</span>
					+ &quot;**Selecting ledger Date**&quot; + trxId + &quot;---TrxID&quot; + stmt);
<span class="nc bnc" id="L5412" title="All 2 branches missed.">			if (trxWith.equals(&quot;BO&quot;)) {</span>
<span class="nc" id="L5413">				tableName = &quot;bo&quot;;</span>
			}
<span class="nc" id="L5415">			stmt = connection</span>
					.prepareStatement(&quot;select transaction_date from st_lms_&quot;
							+ tableName
							+ &quot;_transaction_master where transaction_id&gt;&quot;
							+ trxId + &quot; order by transaction_date asc limit 1&quot;);
<span class="nc" id="L5420">			logger.debug(&quot;In Ledger Helper**tier Agent****&quot; + stmt);</span>
<span class="nc" id="L5421">			rs = stmt.executeQuery();</span>
<span class="nc bnc" id="L5422" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L5423">				trxDate = rs.getTimestamp(&quot;transaction_date&quot;);</span>
			}

<span class="nc" id="L5426">			logger.debug(&quot;Tier*****&quot; + tier + &quot;Date in Transaction Master***&quot;</span>
					+ trxDate + &quot;***Date in Ledger*****&quot; + ledgerDate);
<span class="nc bnc" id="L5428" title="All 6 branches missed.">			if (trxDate != null &amp;&amp; ledgerDate != null</span>
					&amp;&amp; trxDate.before(ledgerDate)) {
<span class="nc" id="L5430">				Date deleteFromDate = new java.sql.Date(trxDate.getTime());</span>
<span class="nc" id="L5431">				Timestamp deleteTS = trxDate;</span>

<span class="nc" id="L5433">				stmt = connection</span>
						.prepareStatement(&quot;select distinct(transaction_date) from st_lms_&quot;
								+ tier
								+ &quot;_current_balance_history where transaction_date&lt;'&quot;
								+ deleteFromDate
								+ &quot; 00:00:00' order by transaction_date desc&quot;);
<span class="nc" id="L5439">				rs = stmt.executeQuery();</span>
<span class="nc bnc" id="L5440" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L5441">					trxDate = rs.getTimestamp(&quot;transaction_date&quot;);</span>
<span class="nc bnc" id="L5442" title="All 2 branches missed.">					if (deleteFromDate.after(rs</span>
							.getTimestamp(&quot;transaction_date&quot;))) {
<span class="nc" id="L5444">						deleteTS = rs.getTimestamp(&quot;transaction_date&quot;);</span>
<span class="nc" id="L5445">						deleteFromDate = new java.sql.Date(deleteTS.getTime());</span>
<span class="nc" id="L5446">						break;</span>
					}
				}
<span class="nc" id="L5449">				logger.debug(&quot;In Ledger Helper Deleting data from*******&quot;</span>
						+ deleteTS);

<span class="nc" id="L5452">				stmt = connection.prepareStatement(&quot;delete from st_lms_&quot; + tier</span>
						+ &quot;_current_balance&quot;);
<span class="nc" id="L5454">				logger.debug(&quot;LH**&quot; + tier + &quot;*1**&quot; + stmt);</span>

<span class="nc" id="L5456">				stmt.execute();</span>
<span class="nc" id="L5457">				stmt = connection.prepareStatement(&quot;delete from st_lms_&quot; + tier</span>
						+ &quot;_ledger where transaction_date&gt;'&quot; + deleteTS + &quot;'&quot;);
<span class="nc" id="L5459">				logger.debug(&quot;LH**&quot; + tier + &quot;*2**&quot; + stmt);</span>

<span class="nc" id="L5461">				stmt.execute();</span>
<span class="nc" id="L5462">				stmt = connection</span>
						.prepareStatement(&quot;insert into st_lms_&quot;
								+ tier
								+ &quot;_current_balance select account_type,current_balance,agent_org_id from st_lms_&quot;
								+ tier
								+ &quot;_current_balance_history where transaction_date='&quot;
								+ deleteTS + &quot;'&quot;);
<span class="nc" id="L5469">				logger.debug(&quot;LH**&quot; + tier + &quot;*3**&quot; + stmt);</span>

<span class="nc" id="L5471">				stmt.execute();</span>
<span class="nc" id="L5472">				stmt = connection.prepareStatement(&quot;delete from st_lms_&quot; + tier</span>
						+ &quot;_current_balance_history where transaction_date&gt;'&quot;
						+ deleteTS + &quot;'&quot;);
<span class="nc" id="L5475">				logger.debug(&quot;LH**&quot; + tier + &quot;*4**&quot; + stmt);</span>

<span class="nc" id="L5477">				stmt.execute();</span>
<span class="nc" id="L5478">				stmt = connection</span>
						.prepareStatement(&quot;select distinct(transaction_date)  from st_lms_&quot;
								+ tier + &quot;_current_balance_history &quot;);
<span class="nc" id="L5481">				logger.debug(&quot;LH**&quot; + tier + &quot;*5**&quot; + stmt);</span>

<span class="nc" id="L5483">				rs = stmt.executeQuery();</span>
<span class="nc bnc" id="L5484" title="All 2 branches missed.">				if (!rs.next()) {</span>
					// Mail to Support
<span class="nc" id="L5486">					stmt = connection</span>
							.prepareStatement(&quot;delete from st_lms_bo_ledger&quot;);
<span class="nc" id="L5488">					stmt</span>
							.addBatch(&quot;delete from st_lms_bo_current_balance_history&quot;);
<span class="nc" id="L5490">					stmt.addBatch(&quot;delete from st_lms_bo_current_balance&quot;);</span>
<span class="nc" id="L5491">					stmt.addBatch(&quot;delete from st_lms_agent_ledger&quot;);</span>
<span class="nc" id="L5492">					stmt</span>
							.addBatch(&quot;delete from st_lms_agent_current_balance_history&quot;);
<span class="nc" id="L5494">					stmt.addBatch(&quot;delete from st_lms_agent_current_balance&quot;);</span>
<span class="nc" id="L5495">					stmt.executeBatch();</span>
<span class="nc" id="L5496">					logger.debug(&quot;LH***6****deleting all ledger***&quot;);</span>
				}

			}
<span class="nc" id="L5500">			connection.commit();</span>
<span class="nc" id="L5501">		} catch (Exception e) {</span>
<span class="nc" id="L5502">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L5504">			DBConnect.closeCon(connection);</span>
<span class="nc" id="L5505">		}</span>
<span class="nc" id="L5506">	}</span>

	private static void insBalHistory(String tier, Connection connection)
			throws SQLException {
<span class="nc" id="L5510">		ResultSet rs = null;</span>
<span class="nc" id="L5511">		PreparedStatement stmt = connection</span>
				.prepareStatement(&quot;select transaction_date from (select date(transaction_date) transaction_date from st_lms_&quot;
						+ tier
						+ &quot;_current_balance_history ) res where res.transaction_date='&quot;
						+ new java.sql.Date(new Date().getTime()) + &quot;' limit 1&quot;);
<span class="nc" id="L5516">		rs = stmt.executeQuery();</span>
<span class="nc" id="L5517">		logger.debug(&quot;Selecting bal history ledger****&quot; + stmt);</span>
<span class="nc bnc" id="L5518" title="All 2 branches missed.">		if (rs.next()) {</span>
			// Mail to Support
<span class="nc" id="L5520">			stmt = connection</span>
					.prepareStatement(&quot;delete from st_lms_&quot;
							+ tier
							+ &quot;_current_balance_history where date(transaction_date) ='&quot;
							+ new java.sql.Date(new Date().getTime()) + &quot;'&quot;);
<span class="nc" id="L5525">			logger.debug(&quot;Deleting from bal history ledger****&quot; + stmt);</span>
<span class="nc" id="L5526">			stmt.execute();</span>

		}
<span class="nc" id="L5529">		stmt = connection</span>
				.prepareStatement(&quot;insert into st_lms_&quot;
						+ tier
						+ &quot;_current_balance_history select account_type,current_balance,agent_org_id,'&quot;
						+ new Timestamp(new Date().getTime())
						+ &quot;' from st_lms_&quot; + tier + &quot;_current_balance&quot;);
<span class="nc" id="L5535">		logger.debug(&quot;Inserting into bal history ledger****&quot; + stmt);</span>
<span class="nc" id="L5536">		stmt.execute();</span>

<span class="nc" id="L5538">	}</span>

	public static void main(String[] args) throws SQLException {
<span class="nc" id="L5541">		Connection connection = DBConnect.getConnection();</span>
		// new LedgerHelper().onAdhocUpdateLedger(&quot;bo&quot;);
		// new LedgerHelper().insBalHistory(&quot;bo&quot;, connection);
<span class="nc" id="L5544">		new LedgerHelper().fillLedger();</span>

<span class="nc" id="L5546">	}</span>

	public void fillLedger() {
<span class="nc" id="L5549">		Connection connection = DBConnect.getConnection();</span>

		try {
<span class="nc" id="L5552">			Timestamp toDate = new Timestamp(new Date().getTime());</span>
<span class="nc" id="L5553">			ResultSet rs = null;</span>
<span class="nc" id="L5554">			PreparedStatement stmt = connection</span>
					.prepareStatement(&quot;select organization_id from st_lms_organization_master where organization_type='AGENT'&quot;);
<span class="nc" id="L5556">			rs = stmt.executeQuery();</span>
<span class="nc bnc" id="L5557" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L5558">				ledgerAgentEntry(toDate, rs.getInt(&quot;organization_id&quot;));</span>
			}
<span class="nc" id="L5560">			ledgerBoEntry(toDate);</span>
<span class="nc" id="L5561">			DBConnect.closeCon(connection);</span>

<span class="nc" id="L5563">			onAdhocUpdateLedger(&quot;bo&quot;);</span>
<span class="nc" id="L5564">			onAdhocUpdateLedger(&quot;agent&quot;);</span>

<span class="nc" id="L5566">		} catch (Exception e) {</span>
<span class="nc" id="L5567">			e.printStackTrace();</span>
<span class="nc" id="L5568">		}</span>

<span class="nc" id="L5570">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>