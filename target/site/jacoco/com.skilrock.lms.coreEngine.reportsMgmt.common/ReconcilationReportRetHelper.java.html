<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReconcilationReportRetHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.reportsMgmt.common</a> &gt; <span class="el_source">ReconcilationReportRetHelper.java</span></div><h1>ReconcilationReportRetHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.reportsMgmt.common;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.Timestamp;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import com.skilrock.lms.beans.CashChqPmntBean;
import com.skilrock.lms.beans.ConsolidatedBean;
import com.skilrock.lms.beans.PWTPaymentsBean;
import com.skilrock.lms.beans.ReportBean;
import com.skilrock.lms.beans.SalePurchaseBean;
import com.skilrock.lms.beans.SalePurchaseRetBean;
import com.skilrock.lms.beans.StockMrpDiscountBean;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.common.db.TableConstants;
import com.skilrock.lms.common.exception.LMSException;

<span class="nc" id="L30">public class ReconcilationReportRetHelper {</span>

	public static void main(String[] args) {
		// Map&lt;Integer, SalePurchaseRetBean&gt; salegameMap=new
		// ReconcilationReportRetHelper().getSalePurchaseDetails(con, retOrgId,
		// from, toDate);
<span class="nc" id="L36">		System.out.println(&quot;done@@@@@@&quot;);</span>
<span class="nc" id="L37">	}</span>

<span class="nc" id="L39">	private double closingBal = 0.0;</span>
<span class="nc" id="L40">	private double closingBal2 = 0.0;</span>
<span class="nc" id="L41">	private double finalclosingBal = 0.0;</span>
<span class="nc" id="L42">	private double finalopeningBal = 0.0;</span>
<span class="nc" id="L43">	private double openingBal = 0.0;</span>
<span class="nc" id="L44">	private double openingBal2 = 0.0;</span>
	private PreparedStatement prepstatement;
<span class="nc" id="L46">	Timestamp presentDate = null;</span>
	private ResultSet resultSet;
	private ResultSet resultSet2;
	// private Connection con;
	private Statement statement;
	private Statement statement2;
<span class="nc" id="L52">	Timestamp toDate = null;</span>
<span class="nc" id="L53">	private double totalAmount = 0.0;</span>
<span class="nc" id="L54">	double totalPurchAmount = 0.0;</span>
<span class="nc" id="L55">	double totalSaleAmount = 0.0;</span>
<span class="nc" id="L56">	int totalSaleBooks = 0;</span>
<span class="nc" id="L57">	double totalSaleComm = 0.0;</span>

<span class="nc" id="L59">	double totalSaleMrp = 0.0;</span>

	public List createConReportAftrPmnt(int retOrgId, Timestamp from,
			Timestamp toDate, SimpleDateFormat dateformat1) {
		// double opLedbalance=0.0;
		// double closLedbalance=0.0;
<span class="nc" id="L65">		double weeklyOpeningBal = 0.0;</span>
<span class="nc" id="L66">		String reconReportTypeRet = null;</span>
<span class="nc" id="L67">		List consolidatedList = new ArrayList();</span>
<span class="nc" id="L68">		ConsolidatedBean consolidatedBean = null;</span>
<span class="nc" id="L69">		ReconcilationReportHelper agtreconhelper = new ReconcilationReportHelper();</span>
<span class="nc" id="L70">		Connection con = null;</span>
		try {
<span class="nc" id="L72">			con = DBConnect.getConnection();</span>
<span class="nc" id="L73">			System.out.println(&quot; ======createConsolidatedReport ========&quot;);</span>

<span class="nc" id="L75">			System.out.println(&quot;Retailer org ID ===== &quot; + retOrgId);</span>
			// opLedbalance= getLedgerBal(retOrgId, from);
			// closLedbalance= getLedgerBal(retOrgId, toDate);
<span class="nc" id="L78">			reconReportTypeRet = agtreconhelper.getReconRepType(retOrgId);</span>
<span class="nc" id="L79">			System.out.println(&quot;from &quot; + from);</span>
<span class="nc" id="L80">			weeklyOpeningBal = getPrevBalFtrpymnt(retOrgId, from,</span>
					reconReportTypeRet);
<span class="nc" id="L82">			System.out.println(&quot;weeklyOpeningBal  ====== &quot; + weeklyOpeningBal);</span>
<span class="nc" id="L83">			consolidatedBean = getConDetAftrPmt(con, retOrgId, from, toDate,</span>
					weeklyOpeningBal);
<span class="nc" id="L85">			consolidatedBean.setWeeklyOpeningBal(weeklyOpeningBal);</span>
			// consolidatedBean.setOpeningLedBal(opLedbalance);
			// consolidatedBean.setClosingLedBal(closLedbalance);
<span class="nc" id="L88">			consolidatedList.add(consolidatedBean);</span>

<span class="nc" id="L90">			Calendar calendar = Calendar.getInstance();</span>
<span class="nc" id="L91">			calendar.setTimeInMillis(toDate.getTime());</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">			if (!dateformat1.format(calendar.getTime()).equals(</span>
					dateformat1.format(from))) {
<span class="nc" id="L94">				calendar.add(Calendar.DAY_OF_MONTH, -1);</span>
<span class="nc" id="L95">				System.out.println(&quot; inside if calendar Agt &quot;</span>
						+ dateformat1.format(from) + &quot;  cTo &quot;
						+ dateformat1.format(calendar.getTime()));
			}
<span class="nc" id="L99">			System.out.println(&quot; inside if calendar Agt &quot;</span>
					+ dateformat1.format(from) + &quot;  cTo &quot;
					+ dateformat1.format(calendar.getTime()));

<span class="nc" id="L103">			consolidatedList.add(dateformat1.format(from)); // 1 in list</span>
<span class="nc" id="L104">			consolidatedList.add(dateformat1.format(calendar.getTime()));// 2</span>
<span class="nc" id="L105">		} catch (LMSException e) {</span>
<span class="nc" id="L106">			e.printStackTrace();</span>
		} finally {
<span class="nc bnc" id="L108" title="All 6 branches missed.">			if (con != null) {</span>
				try {
<span class="nc" id="L110">					con.close();</span>
<span class="nc" id="L111">				} catch (SQLException e) {</span>
					// TODO Auto-generated catch block
<span class="nc" id="L113">					e.printStackTrace();</span>
<span class="nc" id="L114">				}</span>
			}
		}

		// TODO Auto-generated method stub
<span class="nc" id="L119">		return consolidatedList;</span>
	}

	public List createConsolidatedReport(Map retOrgIdMap, Timestamp from,
			Timestamp toDate, SimpleDateFormat dateformat1) {
<span class="nc" id="L124">		double opLedbalance = 0.0;</span>
<span class="nc" id="L125">		double closLedbalance = 0.0;</span>
<span class="nc" id="L126">		double weeklyOpeningBal = 0.0;</span>
<span class="nc" id="L127">		String reconReportTypeRet = null;</span>
<span class="nc" id="L128">		List consolidatedList = new ArrayList();</span>
<span class="nc" id="L129">		ConsolidatedBean consolidatedBean = null;</span>
<span class="nc" id="L130">		ReconcilationReportHelper agtreconhelper = new ReconcilationReportHelper();</span>
<span class="nc" id="L131">		Iterator retOrgitr = retOrgIdMap.entrySet().iterator();</span>
<span class="nc" id="L132">		Timestamp regDate = null;</span>
<span class="nc" id="L133">		Timestamp fromDate = null;</span>
<span class="nc" id="L134">		Connection con = null;</span>
		try {
<span class="nc" id="L136">			con = DBConnect.getConnection();</span>
<span class="nc" id="L137">			System.out.println(&quot; ======createConsolidatedReport ========&quot;);</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">			while (retOrgitr.hasNext()) {</span>
<span class="nc" id="L139">				Map.Entry&lt;Integer, String&gt; retOrgpair = (Map.Entry&lt;Integer, String&gt;) retOrgitr</span>
						.next();
<span class="nc" id="L141">				int retOrgId = retOrgpair.getKey();</span>
<span class="nc" id="L142">				statement = con.createStatement();</span>
<span class="nc" id="L143">				resultSet = statement</span>
						.executeQuery(&quot;select registration_date from st_lms_user_master where organization_id='&quot;
								+ retOrgId + &quot;' and isrolehead='Y' &quot;);
<span class="nc bnc" id="L146" title="All 2 branches missed.">				while (resultSet.next()) {</span>
<span class="nc" id="L147">					regDate = resultSet.getTimestamp(&quot;registration_date&quot;);</span>
				}
<span class="nc bnc" id="L149" title="All 2 branches missed.">				if (regDate != null) {</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">					if (regDate.compareTo(from) &lt; 0) {</span>
<span class="nc" id="L151">						fromDate = from;</span>
					} else {
<span class="nc" id="L153">						fromDate = regDate;</span>
					}
				} else {
<span class="nc" id="L156">					fromDate = from;</span>
				}
<span class="nc" id="L158">				System.out.println(&quot;Retailer org ID ===== &quot; + retOrgId);</span>
<span class="nc" id="L159">				opLedbalance = 0.0;</span>
<span class="nc" id="L160">				closLedbalance = 0.0;</span>
<span class="nc" id="L161">				opLedbalance = getLedgerBal(retOrgId, fromDate);</span>

<span class="nc" id="L163">				closLedbalance = getLedgerBal(retOrgId, toDate);</span>
<span class="nc" id="L164">				reconReportTypeRet = agtreconhelper.getReconRepType(retOrgId);</span>
<span class="nc" id="L165">				weeklyOpeningBal = getPreviousBalance(retOrgId, fromDate,</span>
						reconReportTypeRet);
<span class="nc" id="L167">				System.out.println(&quot;weeklyOpeningBal  ====== &quot;</span>
						+ weeklyOpeningBal);
<span class="nc" id="L169">				consolidatedBean = getConsolidatedDetails(con, retOrgId,</span>
						fromDate, toDate, weeklyOpeningBal);
<span class="nc" id="L171">				consolidatedBean.setWeeklyOpeningBal(weeklyOpeningBal);</span>
<span class="nc" id="L172">				consolidatedBean.setOpeningLedBal(opLedbalance);</span>
<span class="nc" id="L173">				consolidatedBean.setClosingLedBal(closLedbalance);</span>
<span class="nc" id="L174">				consolidatedList.add(consolidatedBean);</span>
<span class="nc" id="L175">			}</span>
<span class="nc" id="L176">			Calendar calendar = Calendar.getInstance();</span>
<span class="nc" id="L177">			calendar.setTimeInMillis(toDate.getTime());</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">			if (!dateformat1.format(calendar.getTime()).equals(</span>
					dateformat1.format(from))) {
<span class="nc" id="L180">				calendar.add(Calendar.DAY_OF_MONTH, -1);</span>
<span class="nc" id="L181">				System.out.println(&quot; inside if calendar Agt &quot;</span>
						+ dateformat1.format(from) + &quot;  cTo &quot;
						+ dateformat1.format(calendar.getTime()));
			}
<span class="nc" id="L185">			System.out.println(&quot; inside if calendar Agt &quot;</span>
					+ dateformat1.format(from) + &quot;  cTo &quot;
					+ dateformat1.format(calendar.getTime()));

<span class="nc" id="L189">			consolidatedList.add(dateformat1.format(from)); // 1 in list</span>
<span class="nc" id="L190">			consolidatedList.add(dateformat1.format(calendar.getTime()));// 2</span>
<span class="nc" id="L191">		} catch (LMSException e) {</span>
<span class="nc" id="L192">			e.printStackTrace();</span>
<span class="nc" id="L193">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L195">			e.printStackTrace();</span>
		} finally {
<span class="nc bnc" id="L197" title="All 8 branches missed.">			if (con != null) {</span>
				try {
<span class="nc" id="L199">					con.close();</span>
<span class="nc" id="L200">				} catch (SQLException e) {</span>
					// TODO Auto-generated catch block
<span class="nc" id="L202">					e.printStackTrace();</span>
<span class="nc" id="L203">				}</span>
			}
		}

		// TODO Auto-generated method stub
<span class="nc" id="L208">		return consolidatedList;</span>
	}

	public List CreateReport(int retOrgId, Timestamp from, Timestamp toDate,
			SimpleDateFormat dateformat1) {
<span class="nc" id="L213">		Connection con = null;</span>
<span class="nc" id="L214">		con = DBConnect.getConnection();</span>
<span class="nc" id="L215">		List reconList = new ArrayList();</span>
<span class="nc" id="L216">		List&lt;SalePurchaseBean&gt; saleList = null;</span>
<span class="nc" id="L217">		List&lt;PWTPaymentsBean&gt; pwtList = null;</span>
<span class="nc" id="L218">		List&lt;CashChqPmntBean&gt; paymentList = null;</span>
<span class="nc" id="L219">		Map&lt;String, StockMrpDiscountBean&gt; stockMrpDiscMap = null;</span>
<span class="nc" id="L220">		ReportBean reportBean = new ReportBean();</span>
		try {

<span class="nc" id="L223">			saleList = getSalePurchBeanTktWiseList(con, retOrgId, from, toDate);</span>
<span class="nc" id="L224">			pwtList = getPwtBeanBookTktList(con, retOrgId, from, toDate);</span>
<span class="nc" id="L225">			paymentList = getPaymentBeanTktWiseList(con, retOrgId, from, toDate);</span>

<span class="nc" id="L227">			stockMrpDiscMap = getStockMrpDiscTktWiseMap(con, retOrgId, from,</span>
					toDate);
<span class="nc" id="L229">			reportBean.setSaleList(saleList);</span>
<span class="nc" id="L230">			reportBean.setPwtList(pwtList);</span>
<span class="nc" id="L231">			reportBean.setPaymentList(paymentList);</span>
<span class="nc" id="L232">			reportBean.setStockMrpDiscMap(stockMrpDiscMap);</span>

<span class="nc" id="L234">			resultSet = statement</span>
					.executeQuery(&quot;select balance,account_type from st_lms_agent_ledger where (account_type ='&quot;
							+ retOrgId
							+ &quot;' or account_type = '&quot;
							+ retOrgId
							+ &quot;#') and transaction_date &lt;'&quot;
							+ from
							+ &quot;' order by transaction_date desc, task_id desc limit 2&quot;);
<span class="nc" id="L242">			System.out</span>
					.println(&quot;opning balance Ret select balance,account_type from st_lms_agent_ledger where (account_type ='&quot;
							+ retOrgId
							+ &quot;' or account_type = '&quot;
							+ retOrgId
							+ &quot;#') and transaction_date &lt;'&quot;
							+ from
							+ &quot;' order by transaction_date desc, task_id desc limit 2&quot;);
<span class="nc" id="L250">			boolean count = false;</span>
<span class="nc" id="L251">			int countt = 0;</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">			while (resultSet.next()) {</span>

<span class="nc bnc" id="L254" title="All 2 branches missed.">				if (resultSet.getString(&quot;account_type&quot;).equalsIgnoreCase(</span>
						retOrgId + &quot;#&quot;)) {
<span class="nc" id="L256">					openingBal = resultSet.getDouble(&quot;balance&quot;);</span>
<span class="nc" id="L257">					count = true;</span>
				} else {
<span class="nc" id="L259">					countt++;</span>
<span class="nc" id="L260">					openingBal2 = resultSet.getDouble(&quot;balance&quot;);</span>
				}
<span class="nc bnc" id="L262" title="All 2 branches missed.">				if (countt == 1) {</span>
<span class="nc" id="L263">					break;</span>
				}
			}
<span class="nc bnc" id="L266" title="All 2 branches missed.">			if (count == true) {</span>
<span class="nc" id="L267">				finalopeningBal = openingBal;</span>
			} else {
<span class="nc" id="L269">				finalopeningBal = openingBal2;</span>
			}

<span class="nc" id="L272">			resultSet = statement</span>
					.executeQuery(&quot;select balance,account_type from st_lms_agent_ledger where (account_type = '&quot;
							+ retOrgId
							+ &quot;' or account_type = '&quot;
							+ retOrgId
							+ &quot;#') and transaction_date &lt;='&quot;
							+ toDate
							+ &quot;' order by transaction_date desc, task_id desc limit 2&quot;);
<span class="nc" id="L280">			System.out</span>
					.println(&quot;Closing balance Ret select balance,account_type from st_lms_agent_ledger where (account_type = '&quot;
							+ retOrgId
							+ &quot;' or account_type = '&quot;
							+ retOrgId
							+ &quot;#') and transaction_date &lt;='&quot;
							+ toDate
							+ &quot;' order by transaction_date desc, task_id desc limit 2&quot;);
<span class="nc" id="L288">			boolean count2 = false;</span>
<span class="nc" id="L289">			int countt2 = 0;</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">				if (resultSet.getString(&quot;account_type&quot;).equalsIgnoreCase(</span>
						retOrgId + &quot;#&quot;)) {
<span class="nc" id="L293">					closingBal = resultSet.getDouble(&quot;balance&quot;);</span>
<span class="nc" id="L294">					count2 = true;</span>
				} else {
<span class="nc" id="L296">					countt2++;</span>
<span class="nc" id="L297">					closingBal2 = resultSet.getDouble(&quot;balance&quot;);</span>
				}
<span class="nc bnc" id="L299" title="All 2 branches missed.">				if (countt2 == 1) {</span>
<span class="nc" id="L300">					break;</span>
				}
			}
<span class="nc bnc" id="L303" title="All 2 branches missed.">			if (count2 == true) {</span>
<span class="nc" id="L304">				finalclosingBal = closingBal;</span>
			} else {
<span class="nc" id="L306">				finalclosingBal = closingBal2;</span>
			}
<span class="nc" id="L308">			Calendar calendar = Calendar.getInstance();</span>
<span class="nc" id="L309">			calendar.setTimeInMillis(toDate.getTime());</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">			if (!dateformat1.format(calendar.getTime()).equals(</span>
					dateformat1.format(from))) {
<span class="nc" id="L312">				calendar.add(Calendar.DAY_OF_MONTH, -1);</span>
<span class="nc" id="L313">				System.out.println(&quot; inside if calendar Ret &quot;</span>
						+ dateformat1.format(from) + &quot;  cTo &quot;
						+ dateformat1.format(calendar.getTime()));
			}
<span class="nc" id="L317">			System.out.println(&quot; inside if calendar Ret &quot;</span>
					+ dateformat1.format(from) + &quot;  cTo &quot;
					+ dateformat1.format(calendar.getTime()));

<span class="nc" id="L321">			reconList.add(reportBean);// 0</span>
<span class="nc" id="L322">			reconList.add(totalAmount);// 1</span>
<span class="nc" id="L323">			reconList.add(finalopeningBal);// 2</span>
<span class="nc" id="L324">			reconList.add(finalclosingBal);// 3</span>
<span class="nc" id="L325">			reconList.add(dateformat1.format(from)); // 4 in list</span>
<span class="nc" id="L326">			reconList.add(dateformat1.format(calendar.getTime()));// 5</span>
<span class="nc" id="L327">			reconList.add(totalSaleMrp);// 6</span>
<span class="nc" id="L328">			reconList.add(totalSaleComm);// 7</span>
<span class="nc" id="L329">			reconList.add(totalSaleAmount);// 8</span>
<span class="nc" id="L330">			reconList.add(totalPurchAmount);// 9</span>

<span class="nc" id="L332">			System.out.println(&quot;reconList size is &quot; + reconList.size());</span>
<span class="nc" id="L333">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L335">			e.printStackTrace();</span>
		} finally {
<span class="nc bnc" id="L337" title="All 6 branches missed.">			if (con != null) {</span>
				try {
<span class="nc" id="L339">					con.close();</span>
<span class="nc" id="L340">				} catch (SQLException e) {</span>
					// TODO Auto-generated catch block
<span class="nc" id="L342">					e.printStackTrace();</span>
<span class="nc" id="L343">				}</span>
			}
		}

<span class="nc" id="L347">		return reconList;</span>
	}

	private ConsolidatedBean getConDetAftrPmt(Connection con, int retOrgId,
			Timestamp from, Timestamp toDate, double weeklyOpeningBal) {
<span class="nc" id="L352">		double weeklyClosingBal = weeklyOpeningBal;</span>
<span class="nc" id="L353">		ConsolidatedBean consolidatedBean = new ConsolidatedBean();</span>

<span class="nc" id="L355">		System.out.println(&quot;getConsolidatedDetails ========== &quot;);</span>
		try {
<span class="nc" id="L357">			statement = con.createStatement();</span>
<span class="nc" id="L358">			resultSet = statement</span>
					.executeQuery(&quot;select sum(amt_child) as purchAmount ,sum(mrp-amt_child) as comm from st_lms_ret_recon_ticketwise arb where retailer_org_id='&quot;
							+ retOrgId
							+ &quot;' and type='NET_SALE' and recon_date&gt;'&quot;
							+ from
							+ &quot;' and recon_date &lt;='&quot;
							+ toDate
							+ &quot;' group by retailer_org_id&quot;);
<span class="nc bnc" id="L366" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L367">				consolidatedBean.setNetPayable(resultSet</span>
						.getDouble(&quot;purchAmount&quot;));
<span class="nc" id="L369">				weeklyClosingBal = weeklyClosingBal</span>
						+ resultSet.getDouble(&quot;purchAmount&quot;);
			}
<span class="nc" id="L372">			System.out.println(&quot;getConsolidatedDetails ========== 2&quot;);</span>

<span class="nc" id="L374">			resultSet = statement</span>
					.executeQuery(&quot;select sum(amt_parent) as totalPWT from st_lms_ret_recon_ticketwise arb where retailer_org_id='&quot;
							+ retOrgId
							+ &quot;'  and type='PWT' and recon_date&gt;'&quot;
							+ from
							+ &quot;' and recon_date &lt;='&quot;
							+ toDate
							+ &quot;' group by retailer_org_id&quot;);
<span class="nc bnc" id="L382" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L383">				consolidatedBean.setNetPWT(resultSet.getDouble(&quot;totalPWT&quot;));</span>
<span class="nc" id="L384">				weeklyClosingBal = weeklyClosingBal</span>
						- resultSet.getDouble(&quot;totalPWT&quot;);
			}
<span class="nc" id="L387">			System.out.println(&quot;getConsolidatedDetails ========== 3&quot;);</span>

<span class="nc" id="L389">			resultSet = statement</span>
					.executeQuery(&quot;select sum(amt_parent) as total,type  from st_lms_ret_recon_ticketwise  where retailer_org_id='&quot;
							+ retOrgId
							+ &quot;' and recon_date&gt;'&quot;
							+ from
							+ &quot;' and recon_date &lt;='&quot;
							+ toDate
							+ &quot;' and game_id is null   group by type&quot;);

<span class="nc bnc" id="L398" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc bnc" id="L399" title="All 4 branches missed.">				if (resultSet.getString(&quot;type&quot;).equalsIgnoreCase(&quot;Cash&quot;)</span>
						|| resultSet.getString(&quot;type&quot;).equalsIgnoreCase(
								&quot;Cheque&quot;)) {
<span class="nc" id="L402">					consolidatedBean.setNetPayments(consolidatedBean</span>
							.getNetPayments()
							+ resultSet.getDouble(&quot;total&quot;));
<span class="nc" id="L405">					weeklyClosingBal = weeklyClosingBal</span>
							- resultSet.getDouble(&quot;total&quot;);
				} else {
<span class="nc" id="L408">					consolidatedBean.setNetPayments(consolidatedBean</span>
							.getNetPayments()
							- resultSet.getDouble(&quot;total&quot;));
<span class="nc" id="L411">					weeklyClosingBal = weeklyClosingBal</span>
							+ resultSet.getDouble(&quot;total&quot;);
				}

			}

<span class="nc" id="L417">			resultSet = statement</span>
					.executeQuery(&quot;select name  from st_lms_organization_master  where organization_id='&quot;
							+ retOrgId + &quot;' &quot;);
<span class="nc bnc" id="L420" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L421">				consolidatedBean.setUserName(resultSet.getString(&quot;name&quot;));</span>
			}
<span class="nc" id="L423">			consolidatedBean.setWeeklyClosingBal(weeklyClosingBal);</span>
<span class="nc" id="L424">			System.out.println(&quot;getConsolidatedDetails ========== 4&quot;);</span>

<span class="nc" id="L426">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L428">			e.printStackTrace();</span>
<span class="nc" id="L429">		}</span>

<span class="nc" id="L431">		return consolidatedBean;</span>
	}

	private ConsolidatedBean getConsolidatedDetails(Connection con,
			int retOrgId, Timestamp from, Timestamp toDate,
			double weeklyOpeningBal) {
<span class="nc" id="L437">		double weeklyClosingBal = weeklyOpeningBal;</span>
<span class="nc" id="L438">		ConsolidatedBean consolidatedBean = new ConsolidatedBean();</span>

<span class="nc" id="L440">		System.out.println(&quot; Retailer getConsolidatedDetails ========== &quot;);</span>
		try {
<span class="nc" id="L442">			statement = con.createStatement();</span>
<span class="nc" id="L443">			resultSet = statement</span>
					.executeQuery(&quot;select sum(amt_child) as purchAmount ,sum(mrp-amt_child) as comm from st_lms_ret_recon_ticketwise arb where retailer_org_id='&quot;
							+ retOrgId
							+ &quot;' and type='NET_SALE' and recon_date&gt;'&quot;
							+ from
							+ &quot;' and recon_date &lt;='&quot;
							+ toDate
							+ &quot;' group by retailer_org_id&quot;);
<span class="nc bnc" id="L451" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L452">				consolidatedBean.setNetPayable(resultSet</span>
						.getDouble(&quot;purchAmount&quot;));
<span class="nc" id="L454">				weeklyClosingBal = weeklyClosingBal</span>
						+ resultSet.getDouble(&quot;purchAmount&quot;);
			}
<span class="nc" id="L457">			System.out.println(&quot;Retailer getConsolidatedDetails ========== 2&quot;);</span>

<span class="nc" id="L459">			resultSet = statement</span>
					.executeQuery(&quot;select sum(amt_parent) as totalPWT from st_lms_ret_recon_ticketwise arb where retailer_org_id='&quot;
							+ retOrgId
							+ &quot;'  and type='PWT' and recon_date&gt;'&quot;
							+ from
							+ &quot;' and recon_date &lt;='&quot;
							+ toDate
							+ &quot;' group by retailer_org_id&quot;);
<span class="nc bnc" id="L467" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L468">				consolidatedBean.setNetPWT(resultSet.getDouble(&quot;totalPWT&quot;));</span>
<span class="nc" id="L469">				weeklyClosingBal = weeklyClosingBal</span>
						- resultSet.getDouble(&quot;totalPWT&quot;);
			}
<span class="nc" id="L472">			System.out.println(&quot;Retailer getConsolidatedDetails ========== 3&quot;);</span>

<span class="nc" id="L474">			resultSet = statement</span>
					.executeQuery(&quot;select sum(amt_parent) as total,type  from st_lms_ret_recon_ticketwise  where retailer_org_id='&quot;
							+ retOrgId
							+ &quot;' and recon_date&gt;'&quot;
							+ from
							+ &quot;' and recon_date &lt;='&quot;
							+ toDate
							+ &quot;' and game_id is null   group by type&quot;);

<span class="nc bnc" id="L483" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc bnc" id="L484" title="All 4 branches missed.">				if (resultSet.getString(&quot;type&quot;).equalsIgnoreCase(&quot;Cash&quot;)</span>
						|| resultSet.getString(&quot;type&quot;).equalsIgnoreCase(
								&quot;Cheque&quot;)) {
<span class="nc" id="L487">					consolidatedBean.setNetPayments(consolidatedBean</span>
							.getNetPayments()
							+ resultSet.getDouble(&quot;total&quot;));
<span class="nc" id="L490">					weeklyClosingBal = weeklyClosingBal</span>
							- resultSet.getDouble(&quot;total&quot;);
				} else {
<span class="nc" id="L493">					consolidatedBean.setNetPayments(consolidatedBean</span>
							.getNetPayments()
							- resultSet.getDouble(&quot;total&quot;));
<span class="nc" id="L496">					weeklyClosingBal = weeklyClosingBal</span>
							+ resultSet.getDouble(&quot;total&quot;);
				}

			}

<span class="nc" id="L502">			resultSet = statement</span>
					.executeQuery(&quot;select name  from st_lms_organization_master  where organization_id='&quot;
							+ retOrgId + &quot;' &quot;);
<span class="nc bnc" id="L505" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L506">				consolidatedBean.setUserName(resultSet.getString(&quot;name&quot;));</span>
			}
<span class="nc" id="L508">			consolidatedBean.setWeeklyClosingBal(weeklyClosingBal);</span>
<span class="nc" id="L509">			System.out.println(&quot;Retailer getConsolidatedDetails ========== 4&quot;);</span>

<span class="nc" id="L511">			Map&lt;String, StockMrpDiscountBean&gt; stockMrpDiscMap = getStockMrpDiscTktWiseMap(</span>
					con, retOrgId, from, toDate);
<span class="nc" id="L513">			Iterator invItr = stockMrpDiscMap.entrySet().iterator();</span>
<span class="nc bnc" id="L514" title="All 2 branches missed.">			while (invItr.hasNext()) {</span>
<span class="nc" id="L515">				Map.Entry&lt;Integer, StockMrpDiscountBean&gt; stockItrpair = (Map.Entry&lt;Integer, StockMrpDiscountBean&gt;) invItr</span>
						.next();
<span class="nc" id="L517">				StockMrpDiscountBean stockMrpDiscountBean = stockItrpair</span>
						.getValue();
<span class="nc" id="L519">				consolidatedBean.setPurchPrcRemStk(consolidatedBean</span>
						.getPurchPrcRemStk()
						+ stockMrpDiscountBean.getStDiscPrice());
<span class="nc" id="L522">			}</span>

<span class="nc" id="L524">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L526">			e.printStackTrace();</span>
<span class="nc" id="L527">		}</span>

<span class="nc" id="L529">		return consolidatedBean;</span>
	}

	public List getDetailsAftrLstPmnt(int retOrgId, Timestamp from,
			Timestamp toDate, SimpleDateFormat dateformat1) {
<span class="nc" id="L534">		String query = &quot;select amount,transaction_date,transaction_type from(select 'Cash' as transaction_type,sbtm.transaction_id,amount,transaction_date from st_lms_agent_transaction_master sbtm,st_lms_agent_cash_transaction sbct where (transaction_type='CASH' )  and transaction_date&gt;='&quot;</span>
				+ from
				+ &quot;' and transaction_date&lt;='&quot;
				+ toDate
				+ &quot;' and sbtm.transaction_id=sbct.transaction_id and party_id='&quot;
				+ retOrgId
				+ &quot;' union select 'Cheque' as transaction_type,sbtm.transaction_id,cheque_amt as amount,transaction_date from st_lms_agent_transaction_master sbtm,st_lms_agent_sale_chq sbsc where (sbtm.transaction_type='CHEQUE')  and transaction_date&gt;='&quot;
				+ from
				+ &quot;' and transaction_date&lt;='&quot;
				+ toDate
				+ &quot;' and sbtm.transaction_id=sbsc.transaction_id and party_id='&quot;
				+ retOrgId + &quot;') final order by transaction_id desc limit 1&quot;;

<span class="nc" id="L547">		System.out.println(query);</span>
<span class="nc" id="L548">		Connection con = null;</span>
<span class="nc" id="L549">		con = DBConnect.getConnection();</span>
<span class="nc" id="L550">		double amount = 0.0;</span>
<span class="nc" id="L551">		Timestamp timestamp = null;</span>
<span class="nc" id="L552">		List list1 = null;</span>
<span class="nc" id="L553">		String transactionType = null;</span>
		try {
<span class="nc" id="L555">			statement = con.createStatement();</span>

<span class="nc" id="L557">			resultSet = statement.executeQuery(query);</span>
<span class="nc" id="L558">			System.out</span>
					.println(&quot;############### getDetailsAftrLstPmnt &quot; + query);
<span class="nc bnc" id="L560" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L561">				amount = resultSet.getDouble(&quot;amount&quot;);</span>
<span class="nc" id="L562">				timestamp = resultSet.getTimestamp(&quot;transaction_date&quot;);</span>
<span class="nc" id="L563">				transactionType = resultSet.getString(&quot;transaction_type&quot;);</span>
<span class="nc" id="L564">				list1 = (List) new ReconcilationReportRetHelper()</span>
						.createConReportAftrPmnt(retOrgId, timestamp, toDate,
								dateformat1);

			}
<span class="nc" id="L569">			System.out.println(&quot;timestamp &quot; + timestamp);</span>
<span class="nc bnc" id="L570" title="All 2 branches missed.">			if (list1 != null) {</span>
<span class="nc" id="L571">				list1.add(amount); // 3</span>
<span class="nc" id="L572">				list1.add(timestamp);// 4</span>
<span class="nc" id="L573">				list1.add(transactionType);// 5</span>
			} else {
<span class="nc" id="L575">				System.out.println(&quot;done$$$$$$$$$$$$$$$&quot;);</span>
			}

<span class="nc" id="L578">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L580">			e.printStackTrace();</span>
		} finally {
<span class="nc bnc" id="L582" title="All 6 branches missed.">			if (con != null) {</span>
				try {
<span class="nc" id="L584">					con.close();</span>
<span class="nc" id="L585">				} catch (SQLException e) {</span>
					// TODO Auto-generated catch block
<span class="nc" id="L587">					e.printStackTrace();</span>
<span class="nc" id="L588">				}</span>
			}
		}
<span class="nc" id="L591">		return list1;</span>
	}

	public double getLedgerBal(int retOrgId, Timestamp time) {
<span class="nc" id="L595">		double ledgerBal = 0.0;</span>
<span class="nc" id="L596">		double ledgerBal2 = 0.0;</span>
<span class="nc" id="L597">		double finalLedgerBal = 0.0;</span>
<span class="nc" id="L598">		Connection con = null;</span>
		try {
<span class="nc" id="L600">			con = DBConnect.getConnection();</span>
<span class="nc" id="L601">			statement = con.createStatement();</span>
<span class="nc" id="L602">			resultSet = statement</span>
					.executeQuery(&quot;select balance,account_type from st_lms_agent_ledger where (account_type ='&quot;
							+ retOrgId
							+ &quot;' or account_type = '&quot;
							+ retOrgId
							+ &quot;#') and transaction_date &lt;'&quot;
							+ time
							+ &quot;' order by transaction_date desc, task_id desc limit 2&quot;);

<span class="nc" id="L611">			System.out</span>
					.println(&quot;opning balance Ret select balance,account_type from st_lms_agent_ledger where (account_type ='&quot;
							+ retOrgId
							+ &quot;' or account_type = '&quot;
							+ retOrgId
							+ &quot;#') and transaction_date &lt;'&quot;
							+ time
							+ &quot;' order by transaction_date desc, task_id desc limit 2&quot;);
<span class="nc" id="L619">			boolean count = false;</span>
<span class="nc" id="L620">			int countt = 0;</span>
<span class="nc bnc" id="L621" title="All 2 branches missed.">			while (resultSet.next()) {</span>

<span class="nc bnc" id="L623" title="All 2 branches missed.">				if (resultSet.getString(&quot;account_type&quot;).equalsIgnoreCase(</span>
						retOrgId + &quot;#&quot;)) {
<span class="nc" id="L625">					ledgerBal = resultSet.getDouble(&quot;balance&quot;);</span>
<span class="nc" id="L626">					count = true;</span>
				} else {
<span class="nc" id="L628">					countt++;</span>
<span class="nc" id="L629">					ledgerBal2 = resultSet.getDouble(&quot;balance&quot;);</span>
				}
<span class="nc bnc" id="L631" title="All 2 branches missed.">				if (countt == 1) {</span>
<span class="nc" id="L632">					break;</span>
				}
			}
<span class="nc bnc" id="L635" title="All 2 branches missed.">			if (count == true) {</span>
<span class="nc" id="L636">				finalLedgerBal = ledgerBal;</span>
			} else {
<span class="nc" id="L638">				finalLedgerBal = ledgerBal2;</span>
			}
<span class="nc" id="L640">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L642">			e.printStackTrace();</span>
		} finally {
<span class="nc bnc" id="L644" title="All 6 branches missed.">			if (con != null) {</span>
				try {
<span class="nc" id="L646">					con.close();</span>
<span class="nc" id="L647">				} catch (SQLException e) {</span>
					// TODO Auto-generated catch block
<span class="nc" id="L649">					e.printStackTrace();</span>
<span class="nc" id="L650">				}</span>
			}
		}

<span class="nc" id="L654">		return finalLedgerBal;</span>
	}

	public Map&lt;String, CashChqPmntBean&gt; getPaymentBeanList(Connection con,
			int retOrgId, Timestamp from, Timestamp toDate) {
<span class="nc" id="L659">		String creditQuery = &quot;select 'Cash' as transactionType,amount,sbct.transaction_id from st_lms_agent_cash_transaction sbct,st_lms_agent_transaction_master sbtm where transaction_date&gt;='&quot;</span>
				+ from
				+ &quot;' and transaction_date &lt;='&quot;
				+ toDate
				+ &quot;' and sbct.transaction_id=sbtm.transaction_id and party_id='&quot;
				+ retOrgId
				+ &quot;' union select 'Cheque',cheque_amt as amount,sbsc.transaction_id from st_lms_agent_sale_chq sbsc,st_lms_agent_transaction_master sbtm  where sbtm.transaction_type='CHEQUE' and transaction_date&gt;='&quot;
				+ from
				+ &quot;' and transaction_date &lt;='&quot;
				+ toDate
				+ &quot;' and sbsc.transaction_id=sbtm.transaction_id and  party_id='&quot;
				+ retOrgId + &quot;'&quot;;
<span class="nc" id="L671">		String debitQuery = &quot;select 'Cheque Bounce' as transactionType,cheque_amt as amount,sbsc.transaction_id from st_lms_agent_sale_chq sbsc,st_lms_agent_transaction_master sbtm  where sbtm.transaction_type='CHQ_BOUNCE' and transaction_date&gt;='&quot;</span>
				+ from
				+ &quot;' and transaction_date &lt;='&quot;
				+ toDate
				+ &quot;' and sbsc.transaction_id=sbtm.transaction_id and  party_id='&quot;
				+ retOrgId
				+ &quot;' union select 'Cheque Bounce Charges',amount,sbdn.transaction_id from st_lms_agent_debit_note sbdn,st_lms_agent_transaction_master sbtm  where sbtm.transaction_type='DR_NOTE' and transaction_date&gt;='&quot;
				+ from
				+ &quot;' and transaction_date &lt;='&quot;
				+ toDate
				+ &quot;' and sbdn.transaction_id=sbtm.transaction_id and  party_id='&quot;
				+ retOrgId
				+ &quot;' union select 'Debit Note',amount,sbdn.transaction_id from st_lms_agent_debit_note sbdn,st_lms_agent_transaction_master sbtm  where sbtm.transaction_type='DR_NOTE_CASH' and transaction_date&gt;='&quot;
				+ from
				+ &quot;' and transaction_date &lt;='&quot;
				+ toDate
				+ &quot;' and sbdn.transaction_id=sbtm.transaction_id and  party_id='&quot;
				+ retOrgId + &quot;'&quot;;
<span class="nc" id="L689">		String paymentType = null;</span>
<span class="nc" id="L690">		double paymentAmount = 0.0;</span>
<span class="nc" id="L691">		CashChqPmntBean paymentBean = null;</span>
<span class="nc" id="L692">		Map&lt;String, CashChqPmntBean&gt; paymentmap = new HashMap&lt;String, CashChqPmntBean&gt;();</span>
<span class="nc" id="L693">		System.out.println(&quot;Total amount in getPaymentBeanList  enter &quot;</span>
				+ totalAmount);
		try {
<span class="nc" id="L696">			statement = con.createStatement();</span>
<span class="nc" id="L697">			resultSet = statement.executeQuery(creditQuery);</span>
<span class="nc bnc" id="L698" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L699">				paymentType = resultSet.getString(&quot;transactionType&quot;);</span>
<span class="nc" id="L700">				paymentAmount = resultSet.getDouble(&quot;amount&quot;);</span>
<span class="nc bnc" id="L701" title="All 2 branches missed.">				if (paymentmap.containsKey(paymentType)) {</span>
<span class="nc" id="L702">					paymentBean = paymentmap.get(paymentType);</span>
<span class="nc" id="L703">					paymentBean.setPaymentAmount(paymentBean.getPaymentAmount()</span>
							+ paymentAmount);
<span class="nc" id="L705">					totalAmount = totalAmount - paymentAmount;</span>
				} else {
<span class="nc" id="L707">					paymentBean = new CashChqPmntBean();</span>
<span class="nc" id="L708">					paymentBean.setPaymentType(paymentType);</span>
<span class="nc" id="L709">					paymentBean.setPaymentAmount(paymentAmount);</span>
<span class="nc" id="L710">					paymentmap.put(paymentType, paymentBean);</span>
<span class="nc" id="L711">					totalAmount = totalAmount - paymentAmount;</span>
				}
			}
<span class="nc" id="L714">			resultSet = statement.executeQuery(debitQuery);</span>

<span class="nc bnc" id="L716" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L717">				paymentType = resultSet.getString(&quot;transactionType&quot;);</span>
<span class="nc" id="L718">				paymentAmount = resultSet.getDouble(&quot;amount&quot;);</span>
<span class="nc bnc" id="L719" title="All 2 branches missed.">				if (paymentmap.containsKey(paymentType)) {</span>
<span class="nc" id="L720">					paymentBean = paymentmap.get(paymentType);</span>
<span class="nc" id="L721">					paymentBean.setPaymentAmount(paymentBean.getPaymentAmount()</span>
							+ paymentAmount);
<span class="nc" id="L723">					totalAmount = totalAmount + paymentAmount;</span>
				} else {
<span class="nc" id="L725">					paymentBean = new CashChqPmntBean();</span>
<span class="nc" id="L726">					paymentBean.setPaymentType(paymentType);</span>
<span class="nc" id="L727">					paymentBean.setPaymentAmount(paymentAmount);</span>
<span class="nc" id="L728">					paymentmap.put(paymentType, paymentBean);</span>
<span class="nc" id="L729">					totalAmount = totalAmount + paymentAmount;</span>
				}
			}
<span class="nc" id="L732">			System.out.println(&quot;creditQuery &quot; + creditQuery);</span>
<span class="nc" id="L733">			System.out.println(paymentmap.size() + &quot; debitQuery &quot; + debitQuery);</span>
<span class="nc" id="L734">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L736">			e.printStackTrace();</span>
<span class="nc" id="L737">		}</span>
<span class="nc" id="L738">		System.out.println(&quot;Total amount in getPaymentBeanList  exit &quot;</span>
				+ totalAmount);
<span class="nc" id="L740">		return paymentmap;</span>
	}

	private List&lt;CashChqPmntBean&gt; getPaymentBeanTktWiseList(Connection con,
			int retOrgId, Timestamp from, Timestamp toDate) {
		CashChqPmntBean paymentBean;
<span class="nc" id="L746">		List&lt;CashChqPmntBean&gt; paymentList = new ArrayList&lt;CashChqPmntBean&gt;();</span>
		try {
<span class="nc" id="L748">			statement = con.createStatement();</span>
<span class="nc" id="L749">			resultSet = statement</span>
					.executeQuery(&quot;select type,sum(amt_parent) as total from st_lms_ret_recon_ticketwise  where retailer_org_id='&quot;
							+ retOrgId
							+ &quot;' and recon_date&gt;'&quot;
							+ from
							+ &quot;' and recon_date &lt;='&quot;
							+ toDate
							+ &quot;' and game_id is null   group by type&quot;);
<span class="nc bnc" id="L757" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L758">				paymentBean = new CashChqPmntBean();</span>
<span class="nc" id="L759">				paymentBean.setPaymentType(resultSet.getString(&quot;type&quot;));</span>
<span class="nc" id="L760">				paymentBean.setPaymentAmount(resultSet.getDouble(&quot;total&quot;));</span>
<span class="nc" id="L761">				paymentList.add(paymentBean);</span>
			}
<span class="nc" id="L763">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L765">			e.printStackTrace();</span>
<span class="nc" id="L766">		}</span>

<span class="nc" id="L768">		return paymentList;</span>

	}

	public double getPrevBalFtrpymnt(int retOrgId, Timestamp frDate,
			String reconReportTypeRet) throws LMSException {
<span class="nc" id="L774">		Connection con = null;</span>
<span class="nc" id="L775">		con = DBConnect.getConnection();</span>
		// resultSet=statement.executeQuery(&quot;select recon_balance from
		// st_lms_agent_recon_bookwise where org_id='&quot;+retOrgId+&quot;' and
		// recon_date&lt; '&quot;+frDate+&quot;' order by recon_date desc,task_id desc limit
		// 1&quot;);
<span class="nc" id="L780">		Calendar calendar = Calendar.getInstance();</span>
<span class="nc" id="L781">		calendar.setTimeInMillis(frDate.getTime());</span>
<span class="nc" id="L782">		calendar.add(Calendar.MINUTE, 10);</span>
<span class="nc" id="L783">		double balance = 0.0;</span>
<span class="nc" id="L784">		String bookwiseQuery = &quot;select recon_balance from st_ret_recon_bookwise where retailer_org_id='&quot;</span>
				+ retOrgId
				+ &quot;' and recon_date &lt; '&quot;
				+ new Timestamp(calendar.getTimeInMillis())
				+ &quot;' order by recon_date desc,task_id desc limit 1&quot;;
<span class="nc" id="L789">		String ticketWiseQuery = &quot;select recon_balance from st_lms_ret_recon_ticketwise where retailer_org_id='&quot;</span>
				+ retOrgId
				+ &quot;' and recon_date &lt; '&quot;
				+ new Timestamp(calendar.getTimeInMillis())
				+ &quot;' order by recon_date desc,task_id desc limit 1&quot;;
		String query;
		try {
<span class="nc" id="L796">			Statement statement = con.createStatement();</span>
<span class="nc bnc" id="L797" title="All 2 branches missed.">			if (reconReportTypeRet.equalsIgnoreCase(&quot;Book Wise Report&quot;)) {</span>
<span class="nc" id="L798">				query = bookwiseQuery;</span>
			} else {
<span class="nc" id="L800">				query = ticketWiseQuery;</span>
			}
<span class="nc" id="L802">			resultSet = statement.executeQuery(query);</span>
<span class="nc" id="L803">			System.out.println(&quot;balance query  &quot; + query);</span>

<span class="nc bnc" id="L805" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L806">				balance = resultSet.getDouble(&quot;recon_balance&quot;);</span>
			}
<span class="nc" id="L808">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L810">			e.printStackTrace();</span>
		} finally {
<span class="nc bnc" id="L812" title="All 6 branches missed.">			if (con != null) {</span>
				try {
<span class="nc" id="L814">					con.close();</span>
<span class="nc" id="L815">				} catch (SQLException e) {</span>
					// TODO Auto-generated catch block
<span class="nc" id="L817">					e.printStackTrace();</span>
<span class="nc" id="L818">				}</span>
			}
		}
<span class="nc" id="L821">		System.out.println(&quot;balance &quot; + balance);</span>
<span class="nc" id="L822">		return balance;</span>
	}

	public double getPreviousBalance(int retOrgId, Timestamp frDate,
			String reconReportTypeRet) throws LMSException {
<span class="nc" id="L827">		Connection con = null;</span>
<span class="nc" id="L828">		con = DBConnect.getConnection();</span>
		// resultSet=statement.executeQuery(&quot;select recon_balance from
		// st_lms_agent_recon_bookwise where org_id='&quot;+retOrgId+&quot;' and
		// recon_date&lt; '&quot;+frDate+&quot;' order by recon_date desc,task_id desc limit
		// 1&quot;);
<span class="nc" id="L833">		Calendar calendar = Calendar.getInstance();</span>
<span class="nc" id="L834">		calendar.setTimeInMillis(frDate.getTime());</span>
<span class="nc" id="L835">		calendar.add(Calendar.MINUTE, 10);</span>
<span class="nc" id="L836">		double balance = 0.0;</span>
<span class="nc" id="L837">		String bookwiseQuery = &quot;select recon_balance from st_ret_recon_bookwise where retailer_org_id='&quot;</span>
				+ retOrgId
				+ &quot;' and recon_date&lt; '&quot;
				+ new Timestamp(calendar.getTimeInMillis())
				+ &quot;' order by recon_date desc,task_id desc limit 1&quot;;
<span class="nc" id="L842">		String ticketWiseQuery = &quot;select recon_balance from st_lms_ret_recon_ticketwise where retailer_org_id='&quot;</span>
				+ retOrgId
				+ &quot;' and recon_date&lt; '&quot;
				+ new Timestamp(calendar.getTimeInMillis())
				+ &quot;' order by recon_date desc,task_id desc limit 1&quot;;
		String query;
		try {
<span class="nc" id="L849">			Statement statement = con.createStatement();</span>
<span class="nc bnc" id="L850" title="All 2 branches missed.">			if (reconReportTypeRet.equalsIgnoreCase(&quot;Book Wise Report&quot;)) {</span>
<span class="nc" id="L851">				query = bookwiseQuery;</span>
			} else {
<span class="nc" id="L853">				query = ticketWiseQuery;</span>
			}
<span class="nc" id="L855">			resultSet = statement.executeQuery(query);</span>
<span class="nc" id="L856">			System.out.println(&quot;balance query  &quot; + query);</span>

<span class="nc bnc" id="L858" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L859">				balance = resultSet.getDouble(&quot;recon_balance&quot;);</span>
			}
<span class="nc" id="L861">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L863">			e.printStackTrace();</span>
		} finally {
<span class="nc bnc" id="L865" title="All 6 branches missed.">			if (con != null) {</span>
				try {
<span class="nc" id="L867">					con.close();</span>
<span class="nc" id="L868">				} catch (SQLException e) {</span>
					// TODO Auto-generated catch block
<span class="nc" id="L870">					e.printStackTrace();</span>
<span class="nc" id="L871">				}</span>
			}
		}
<span class="nc" id="L874">		System.out.println(&quot;balance &quot; + balance);</span>
<span class="nc" id="L875">		return balance;</span>
	}

	private List&lt;PWTPaymentsBean&gt; getPwtBeanBookTktList(Connection con,
			int retOrgId, Timestamp from, Timestamp toDate) {
		PWTPaymentsBean pwtPaymentsBean;
<span class="nc" id="L881">		List&lt;PWTPaymentsBean&gt; pwtList = new ArrayList&lt;PWTPaymentsBean&gt;();</span>
		try {
<span class="nc" id="L883">			statement = con.createStatement();</span>
<span class="nc" id="L884">			resultSet = statement</span>
					.executeQuery(&quot;select sgm.game_nbr,sgm.game_id,game_name,type,sum(amt_parent) as totalPWT,sum(amt_child) as netPWT ,sum(amt_parent-amt_child) as comm from st_lms_ret_recon_ticketwise arb,st_se_game_master sgm where retailer_org_id='&quot;
							+ retOrgId
							+ &quot;' and sgm.game_id=arb.game_id and type='PWT' and recon_date&gt;'&quot;
							+ from
							+ &quot;' and recon_date &lt;='&quot;
							+ toDate
							+ &quot;' group by game_id&quot;);
<span class="nc bnc" id="L892" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L893">				pwtPaymentsBean = new PWTPaymentsBean();</span>
<span class="nc" id="L894">				pwtPaymentsBean.setGameNo(resultSet.getInt(&quot;game_nbr&quot;));</span>
<span class="nc" id="L895">				pwtPaymentsBean.setGameName(resultSet.getString(&quot;game_name&quot;));</span>
<span class="nc" id="L896">				pwtPaymentsBean.setTotalAmt(resultSet.getDouble(&quot;totalPWT&quot;));</span>
<span class="nc" id="L897">				pwtPaymentsBean.setNetPWT(resultSet.getDouble(&quot;netPWT&quot;));</span>
<span class="nc" id="L898">				pwtPaymentsBean.setNetCommAmt(resultSet.getDouble(&quot;comm&quot;));</span>

<span class="nc" id="L900">				pwtList.add(pwtPaymentsBean);</span>
			}
<span class="nc" id="L902">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L904">			e.printStackTrace();</span>
<span class="nc" id="L905">		}</span>

<span class="nc" id="L907">		return pwtList;</span>
	}

	public List&lt;PWTPaymentsBean&gt; getPwtBeanList(Connection con, int retOrgId,
			Timestamp from, Timestamp toDate) {
<span class="nc" id="L912">		String pwtQuery = &quot;select sgm.game_id,sum(pwt_amt) as pwt_amt,sum(comm_amt) as comm_amt,sum(net_amt) as net_amt ,game_name from  st_se_agent_pwt sbp, st_lms_agent_transaction_master sbtm,st_se_game_master sgm where sbp.game_id=sgm.game_id and transaction_date&gt;='&quot;</span>
				+ from
				+ &quot;' and transaction_date &lt;='&quot;
				+ toDate
				+ &quot;' and sbp.transaction_id=sbtm.transaction_id and party_id='&quot;
				+ retOrgId + &quot;' group by game_id&quot;;
<span class="nc" id="L918">		int gameNo = 0;</span>
<span class="nc" id="L919">		String gameName = null;</span>
<span class="nc" id="L920">		double netPWT = 0.0;</span>
<span class="nc" id="L921">		double netCommAmt = 0.0;</span>
<span class="nc" id="L922">		double totalAmt = 0.0;</span>
<span class="nc" id="L923">		PWTPaymentsBean bean = null;</span>
<span class="nc" id="L924">		PWTPaymentsBean pwtBean = null;</span>
<span class="nc" id="L925">		List&lt;PWTPaymentsBean&gt; pwtList = new ArrayList&lt;PWTPaymentsBean&gt;();</span>
<span class="nc" id="L926">		System.out.println(&quot;Total amount in getPwtBeanList  enter &quot;</span>
				+ totalAmount);
		try {
<span class="nc" id="L929">			statement = con.createStatement();</span>
<span class="nc" id="L930">			resultSet = statement.executeQuery(pwtQuery);</span>
<span class="nc bnc" id="L931" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L932">				gameNo = resultSet.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L933">				gameName = resultSet.getString(&quot;game_name&quot;);</span>
<span class="nc" id="L934">				netPWT = resultSet.getDouble(&quot;pwt_amt&quot;);</span>
<span class="nc" id="L935">				netCommAmt = resultSet.getDouble(&quot;comm_amt&quot;);</span>
<span class="nc" id="L936">				totalAmt = resultSet.getDouble(&quot;net_amt&quot;);</span>
<span class="nc" id="L937">				pwtBean = new PWTPaymentsBean();</span>
<span class="nc" id="L938">				pwtBean.setGameNo(gameNo);</span>
<span class="nc" id="L939">				pwtBean.setGameName(gameName);</span>
<span class="nc" id="L940">				pwtBean.setNetPWT(netPWT);</span>
<span class="nc" id="L941">				pwtBean.setNetCommAmt(netCommAmt);</span>
<span class="nc" id="L942">				pwtBean.setTotalAmt(totalAmt);</span>
<span class="nc" id="L943">				pwtList.add(pwtBean);</span>
<span class="nc" id="L944">				totalAmount = totalAmount - totalAmt;</span>
			}
<span class="nc" id="L946">			System.out.println(pwtList.size() + &quot; pwt query &quot; + pwtQuery</span>
					+ &quot;  totalAmt == &quot; + totalAmt);
<span class="nc" id="L948">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L950">			e.printStackTrace();</span>
<span class="nc" id="L951">		}</span>
<span class="nc" id="L952">		System.out.println(&quot;Total amount in getPwtBeanList  exit ****** &quot;</span>
				+ totalAmount + &quot; totalAmt ==== &quot; + totalAmt);
<span class="nc" id="L954">		return pwtList;</span>
	}

	public double getReconbalance(int retOrgId, Connection connection,
			String reconReportTypeRet) {

<span class="nc" id="L960">		double balance = 0.0;</span>
		// String bookwiseQuery=&quot;select recon_balance from st_ret_recon_bookwise
		// where retailer_org_id='&quot;+retOrgId+&quot;' order by recon_date desc,task_id
		// desc limit 1&quot;;
<span class="nc" id="L964">		String ticketWiseQuery = &quot;select recon_balance from st_lms_ret_recon_ticketwise where retailer_org_id='&quot;</span>
				+ retOrgId + &quot;'  order by recon_date desc,task_id desc limit 1&quot;;
		String query;
		try {
<span class="nc" id="L968">			Statement statement = connection.createStatement();</span>
			/*
			 * if(reconReportTypeRet.equalsIgnoreCase(&quot;Book Wise Report&quot;)){
			 * query=bookwiseQuery; }else{
			 */
<span class="nc" id="L973">			query = ticketWiseQuery;</span>
			// }
<span class="nc" id="L975">			resultSet = statement.executeQuery(query);</span>

<span class="nc bnc" id="L977" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L978">				balance = resultSet.getDouble(&quot;recon_balance&quot;);</span>
			}
<span class="nc" id="L980">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L982">			e.printStackTrace();</span>
<span class="nc" id="L983">		}</span>

<span class="nc" id="L985">		return balance;</span>
	}

	public Map&lt;Integer, String&gt; getRetOrgMap(int userOrgId, Timestamp toDate) {
<span class="nc" id="L989">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L990">		Statement stmt = null;</span>
<span class="nc" id="L991">		ResultSet result = null;</span>
<span class="nc" id="L992">		Map&lt;Integer, String&gt; orgMap = new HashMap&lt;Integer, String&gt;();</span>
		try {
<span class="nc" id="L994">			stmt = conn.createStatement();</span>
<span class="nc" id="L995">			result = stmt</span>
					.executeQuery(&quot;select name,om.organization_id from st_lms_organization_master om,st_lms_user_master um where om.organization_type='RETAILER' and  parent_id='&quot;
							+ userOrgId
							+ &quot;' and om.organization_id=um.organization_id and registration_date&lt;'&quot;
							+ toDate + &quot;' order by name&quot;);
<span class="nc bnc" id="L1000" title="All 2 branches missed.">			while (result.next()) {</span>
<span class="nc" id="L1001">				System.out.println(&quot;ID ################ &quot;</span>
						+ result.getInt(TableConstants.ORG_ID) + &quot; Name &quot;
						+ result.getString(TableConstants.NAME));
<span class="nc" id="L1004">				orgMap.put(result.getInt(TableConstants.ORG_ID), result</span>
						.getString(TableConstants.NAME));
			}
<span class="nc" id="L1007">		} catch (SQLException e) {</span>
<span class="nc" id="L1008">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1010">			try {</span>
<span class="nc" id="L1011">				conn.close();</span>
<span class="nc" id="L1012">			} catch (SQLException e) {</span>
<span class="nc" id="L1013">				e.printStackTrace();</span>
<span class="nc" id="L1014">			}</span>
<span class="nc" id="L1015">		}</span>
<span class="nc" id="L1016">		return orgMap;</span>

	}

	public Map&lt;Integer, SalePurchaseRetBean&gt; getSalePurchaseDetails(
			Connection con, int retOrgId, Timestamp from, Timestamp toDate) {
		// String salebooklistQuery=&quot;select
		// sgtih.game_id,game_name,book_nbr,date,sum(sold_tickets)
		// soldTickets,(ticket_price*sum(sold_tickets))as totalmrp from
		// st_se_game_ticket_inv_history sgtih ,st_se_game_master sgm where
		// current_owner_id='&quot;+retOrgId+&quot;' and date&gt;='&quot;+from+&quot;' and
		// date&lt;='&quot;+toDate+&quot;' and (status='ACTIVE_CLOSE' or
		// status='CLAIMED_CLOSE') and sgtih.game_id=sgm.game_id group by
		// book_nbr,game_id&quot;;
<span class="nc" id="L1030">		String salebooklistQuery = &quot;select cur_rem_tickets,game_id,game_name,book_nbr,date,sum(sold_tickets) soldTickets,(ticket_price*sum(sold_tickets))as totalmrp from (select cur_rem_tickets,sgtih.game_id,game_name,book_nbr,date,sold_tickets,ticket_price  from st_se_game_ticket_inv_history sgtih ,st_se_game_master sgm where current_owner_id='&quot;</span>
				+ retOrgId
				+ &quot;'  and date&gt;='&quot;
				+ from
				+ &quot;' and date&lt;='&quot;
				+ toDate
				+ &quot;' and (status='ACTIVE_CLOSE' or status='CLAIMED_CLOSE') and sgtih.game_id=sgm.game_id  order by task_id desc ) aa group by book_nbr,game_id&quot;;
<span class="nc" id="L1037">		String saleBookCommDetails = &quot;select game_id,(1-(transacrion_sale_comm_rate*.01)) as retpurch,(1-(transaction_purchase_comm_rate*.01)) as agtpurch from st_se_game_inv_detail where book_nbr=? order by  transaction_date desc limit 1&quot;;</span>
<span class="nc" id="L1038">		String saleDrawGamesDetails = &quot;&quot;;</span>

<span class="nc" id="L1040">		Timestamp transactionDate = null;</span>

<span class="nc" id="L1042">		System.out.println(&quot;Total amount in getSalePurchaseBeanList  enter &quot;</span>
				+ totalAmount);

<span class="nc" id="L1045">		String gameName = null;</span>
<span class="nc" id="L1046">		String bookNo = null;</span>
<span class="nc" id="L1047">		double salePrice = 0.0;</span>
<span class="nc" id="L1048">		double mrp = 0.0;</span>
<span class="nc" id="L1049">		double retpurchPrice = 0.0;</span>
<span class="nc" id="L1050">		double agtpurchPrice = 0.0;</span>
<span class="nc" id="L1051">		double comm = 0.0;</span>
<span class="nc" id="L1052">		int gameId = 0;</span>
<span class="nc" id="L1053">		int soldTickets = 0;</span>
<span class="nc" id="L1054">		int remTickets = 0;</span>
<span class="nc" id="L1055">		SalePurchaseRetBean salePurchaseRetBean = null;</span>
<span class="nc" id="L1056">		List&lt;String&gt; salebookList = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L1057">		Map&lt;Integer, SalePurchaseRetBean&gt; salegameMap = new HashMap&lt;Integer, SalePurchaseRetBean&gt;();</span>

		try {

<span class="nc" id="L1061">			statement = con.createStatement();</span>
<span class="nc" id="L1062">			System.out.println(&quot;salebooklistQuery &quot; + salebooklistQuery);</span>
<span class="nc" id="L1063">			resultSet = statement.executeQuery(salebooklistQuery);</span>

<span class="nc bnc" id="L1065" title="All 2 branches missed.">			while (resultSet.next()) {</span>

<span class="nc" id="L1067">				gameName = resultSet.getString(&quot;game_name&quot;);</span>
<span class="nc" id="L1068">				transactionDate = resultSet.getTimestamp(&quot;date&quot;);</span>
<span class="nc" id="L1069">				mrp = resultSet.getDouble(&quot;totalmrp&quot;);</span>
<span class="nc" id="L1070">				soldTickets = resultSet.getInt(&quot;soldTickets&quot;);</span>
<span class="nc" id="L1071">				bookNo = resultSet.getString(&quot;book_nbr&quot;);</span>
<span class="nc" id="L1072">				gameId = resultSet.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L1073">				remTickets = resultSet.getInt(&quot;cur_rem_tickets&quot;);</span>

<span class="nc" id="L1075">				salebookList.add(bookNo);</span>
<span class="nc bnc" id="L1076" title="All 2 branches missed.">				if (salegameMap.containsKey(gameId)) {</span>
<span class="nc" id="L1077">					System.out.println(&quot;before cast&quot;);</span>
<span class="nc" id="L1078">					salePurchaseRetBean = (SalePurchaseRetBean) salegameMap</span>
							.get(gameId);
<span class="nc" id="L1080">					System.out.println(&quot;after cast&quot;);</span>
<span class="nc" id="L1081">					salePurchaseRetBean.setGameName(salePurchaseRetBean</span>
							.getGameName());
<span class="nc" id="L1083">					salePurchaseRetBean.setMrp(salePurchaseRetBean.getMrp()</span>
							+ mrp);
<span class="nc" id="L1085">					salePurchaseRetBean.setRetpurchPrice(salePurchaseRetBean</span>
							.getRetpurchPrice()
							+ retpurchPrice);
<span class="nc" id="L1088">					salePurchaseRetBean.setAgtpurchPrice(salePurchaseRetBean</span>
							.getAgtpurchPrice()
							+ agtpurchPrice);
<span class="nc" id="L1091">					salePurchaseRetBean.setComm(salePurchaseRetBean.getComm()</span>
							+ comm);
<span class="nc" id="L1093">					salePurchaseRetBean.setSoldTickets(salePurchaseRetBean</span>
							.getSoldTickets()
							+ soldTickets);
<span class="nc" id="L1096">					salePurchaseRetBean.setGameId(salePurchaseRetBean</span>
							.getGameId());
<span class="nc" id="L1098">					salePurchaseRetBean.setRemTickets(remTickets);</span>
<span class="nc" id="L1099">					System.out.println(&quot;entry udated &quot;);</span>

				} else {
<span class="nc" id="L1102">					salePurchaseRetBean = new SalePurchaseRetBean();</span>
<span class="nc" id="L1103">					salePurchaseRetBean.setGameName(gameName);</span>
<span class="nc" id="L1104">					salePurchaseRetBean.setMrp(mrp);</span>
<span class="nc" id="L1105">					salePurchaseRetBean.setRetpurchPrice(retpurchPrice);</span>
<span class="nc" id="L1106">					salePurchaseRetBean.setAgtpurchPrice(agtpurchPrice);</span>
<span class="nc" id="L1107">					salePurchaseRetBean.setComm(comm);</span>
<span class="nc" id="L1108">					salePurchaseRetBean.setSoldTickets(soldTickets);</span>
<span class="nc" id="L1109">					salePurchaseRetBean.setGameId(gameId);</span>
<span class="nc" id="L1110">					salePurchaseRetBean.setRemTickets(remTickets);</span>
<span class="nc" id="L1111">					System.out.println(&quot;done 1111111111111 entry &quot;);</span>
<span class="nc" id="L1112">					salegameMap.put(gameId, salePurchaseRetBean);</span>
<span class="nc" id="L1113">					System.out.println(&quot;putting in map  &quot;);</span>
				}

			}
<span class="nc" id="L1117">			prepstatement = con.prepareStatement(saleBookCommDetails);</span>
<span class="nc" id="L1118">			Iterator saleBookItr = salebookList.iterator();</span>
<span class="nc bnc" id="L1119" title="All 2 branches missed.">			while (saleBookItr.hasNext()) {</span>
<span class="nc" id="L1120">				prepstatement.setString(1, (String) saleBookItr.next());</span>
<span class="nc" id="L1121">				resultSet = prepstatement.executeQuery();</span>
<span class="nc bnc" id="L1122" title="All 2 branches missed.">				while (resultSet.next()) {</span>

<span class="nc" id="L1124">					retpurchPrice = resultSet.getDouble(&quot;retpurch&quot;);</span>
<span class="nc" id="L1125">					agtpurchPrice = resultSet.getDouble(&quot;agtpurch&quot;);</span>
<span class="nc" id="L1126">					gameId = resultSet.getInt(&quot;game_id&quot;);</span>
<span class="nc bnc" id="L1127" title="All 2 branches missed.">					if (salegameMap.containsKey(gameId)) {</span>
<span class="nc" id="L1128">						salePurchaseRetBean = (SalePurchaseRetBean) salegameMap</span>
								.get(gameId);
<span class="nc" id="L1130">						salePurchaseRetBean</span>
								.setRetpurchPrice(salePurchaseRetBean.getMrp()
										* retpurchPrice);
<span class="nc" id="L1133">						salePurchaseRetBean</span>
								.setAgtpurchPrice(salePurchaseRetBean.getMrp()
										* agtpurchPrice);
<span class="nc" id="L1136">						salePurchaseRetBean.setComm(salePurchaseRetBean</span>
								.getMrp()
								- salePurchaseRetBean.getMrp() * retpurchPrice);

					}

				}

			}
			/*
			 * this is for draw games
			 */

			/*
			 * draw game sale end
			 */
<span class="nc" id="L1152">			System.out.println(&quot;map size salebookMap &quot; + salegameMap.size());</span>
			/*
			 * saleBookItr = salegameMap.entrySet().iterator(); while
			 * (saleBookItr.hasNext()) { Map.Entry&lt;String,SalePurchaseRetBean&gt;
			 * saleBookItrpair = (Map.Entry&lt;String,SalePurchaseRetBean&gt;)saleBookItr.next();
			 * salePurchaseRetBean=saleBookItrpair.getValue(); }
			 */

<span class="nc" id="L1160">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L1162">			e.printStackTrace();</span>
<span class="nc" id="L1163">		}</span>

<span class="nc" id="L1165">		return salegameMap;</span>
	}

	private List&lt;SalePurchaseBean&gt; getSalePurchBeanTktWiseList(Connection con,
			int retOrgId, Timestamp from, Timestamp toDate) {

		SalePurchaseBean salePurchaseBean;
<span class="nc" id="L1172">		List&lt;SalePurchaseBean&gt; saleList = new ArrayList&lt;SalePurchaseBean&gt;();</span>
		try {
<span class="nc" id="L1174">			statement = con.createStatement();</span>
<span class="nc" id="L1175">			resultSet = statement</span>
					.executeQuery(&quot;select sgm.game_nbr,game_name,sgm.game_id,  sum(mrp_amt) as mrp,type,sum(amt_child) as purchAmount ,sum(mrp-amt_child) as comm from st_lms_ret_recon_ticketwise arb,st_se_game_master sgm where retailer_org_id='&quot;
							+ retOrgId
							+ &quot;' and sgm.game_id=arb.game_id and type='NET_SALE' and recon_date&gt;'&quot;
							+ from
							+ &quot;' and recon_date &lt;='&quot;
							+ toDate
							+ &quot;' group by game_id&quot;);
<span class="nc bnc" id="L1183" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L1184">				salePurchaseBean = new SalePurchaseBean();</span>
<span class="nc" id="L1185">				salePurchaseBean.setGameId(resultSet.getInt(&quot;game_nbr&quot;));</span>
<span class="nc" id="L1186">				salePurchaseBean.setGameName(resultSet.getString(&quot;game_name&quot;));</span>
<span class="nc" id="L1187">				salePurchaseBean.setMrp(resultSet.getDouble(&quot;mrp&quot;));</span>
<span class="nc" id="L1188">				salePurchaseBean.setSalePrice(resultSet.getDouble(&quot;mrp&quot;));</span>
<span class="nc" id="L1189">				salePurchaseBean.setPurchprice(resultSet</span>
						.getDouble(&quot;purchAmount&quot;));
<span class="nc" id="L1191">				salePurchaseBean.setComm(resultSet.getDouble(&quot;comm&quot;));</span>
<span class="nc" id="L1192">				saleList.add(salePurchaseBean);</span>
			}
<span class="nc" id="L1194">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L1196">			e.printStackTrace();</span>
<span class="nc" id="L1197">		}</span>

<span class="nc" id="L1199">		return saleList;</span>
	}

	public Map&lt;String, StockMrpDiscountBean&gt; getStockMrpDiscTktWiseMap(
			Connection con, int retOrgId, Timestamp from, Timestamp toDate) {
<span class="nc" id="L1204">		StockMrpDiscountBean stockMrpDiscBean = null;</span>
<span class="nc" id="L1205">		String stGameName = null;</span>
<span class="nc" id="L1206">		double stPercent = 0;</span>
<span class="nc" id="L1207">		int stGameNo = 0;</span>
<span class="nc" id="L1208">		double stMrp = 0.0;</span>
<span class="nc" id="L1209">		double stDiscPrice = 0.0;</span>
<span class="nc" id="L1210">		int stCountTickets = 0;</span>
		StringBuilder stockRetTicketQuery;
<span class="nc" id="L1212">		System.out</span>
				.println(&quot;Total amount in getStockMrpDiscountBeanList  enter &quot;
						+ totalAmount);
<span class="nc" id="L1215">		Map&lt;String, StockMrpDiscountBean&gt; tktStockMap = new HashMap&lt;String, StockMrpDiscountBean&gt;();</span>
		try {

			/*
			 * new discount method
			 */
<span class="nc" id="L1221">			Map&lt;String, Timestamp&gt; map = new HashMap&lt;String, Timestamp&gt;();</span>

<span class="nc" id="L1223">			statement = con.createStatement();</span>
<span class="nc" id="L1224">			resultSet = statement</span>
					.executeQuery(&quot;select date,book_nbr from st_se_game_ticket_inv_history where  current_owner_id='&quot;
							+ retOrgId + &quot;' and date&lt;='&quot; + toDate + &quot;'&quot;);
<span class="nc bnc" id="L1227" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L1228">				System.out.println(&quot;book_nbr &quot;</span>
						+ resultSet.getString(&quot;book_nbr&quot;));
<span class="nc" id="L1230">				System.out.println(&quot;date  &quot; + resultSet.getTimestamp(&quot;date&quot;));</span>
<span class="nc" id="L1231">				map.put(resultSet.getString(&quot;book_nbr&quot;), resultSet</span>
						.getTimestamp(&quot;date&quot;));
			}
<span class="nc" id="L1234">			statement = con.createStatement();</span>
<span class="nc" id="L1235">			StringBuilder builder = new StringBuilder(</span>
					&quot;select date,book_nbr from st_se_game_ticket_inv_history where  (book_nbr='0' &quot;);
<span class="nc" id="L1237">			Iterator invItr = map.entrySet().iterator();</span>
<span class="nc bnc" id="L1238" title="All 2 branches missed.">			while (invItr.hasNext()) {</span>
<span class="nc" id="L1239">				Map.Entry&lt;String, Timestamp&gt; bookItrpair = (Map.Entry&lt;String, Timestamp&gt;) invItr</span>
						.next();
<span class="nc" id="L1241">				String bookNo = bookItrpair.getKey();</span>
<span class="nc" id="L1242">				Timestamp date = bookItrpair.getValue();</span>
<span class="nc" id="L1243">				builder.append(&quot;or book_nbr='&quot; + bookNo + &quot;'&quot;);</span>
<span class="nc" id="L1244">			}</span>
<span class="nc" id="L1245">			builder.append(&quot;) and date&lt;='&quot; + toDate</span>
					+ &quot;' and current_owner='AGENT'&quot;);
<span class="nc" id="L1247">			System.out.println(&quot;query=======  &quot; + builder.toString());</span>
<span class="nc" id="L1248">			resultSet = statement.executeQuery(builder.toString());</span>
<span class="nc bnc" id="L1249" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L1250">				System.out.println(&quot;book_nbr &quot;</span>
						+ resultSet.getString(&quot;book_nbr&quot;));
<span class="nc" id="L1252">				System.out.println(&quot;date  &quot; + resultSet.getTimestamp(&quot;date&quot;));</span>
<span class="nc bnc" id="L1253" title="All 2 branches missed.">				if (map.containsKey(resultSet.getString(&quot;book_nbr&quot;))) {</span>
<span class="nc bnc" id="L1254" title="All 2 branches missed.">					if (map.get(resultSet.getString(&quot;book_nbr&quot;)).before(</span>
							resultSet.getTimestamp(&quot;date&quot;))) {
<span class="nc" id="L1256">						map.remove(resultSet.getString(&quot;book_nbr&quot;));</span>
					}
				}

			}
<span class="nc" id="L1261">			System.out.println(&quot;map ======= &quot; + map);</span>

			/*
			 * end new method
			 */
<span class="nc" id="L1266">			stockRetTicketQuery = new StringBuilder(</span>
					&quot;select cur_rem_tickets,game_id,game_name,book_nbr,date,sum(sold_tickets) soldTickets,(ticket_price*cur_rem_tickets)as mrp from (select sgtih.cur_rem_tickets,sgtih.game_id,game_name,sgtih.book_nbr,date,sold_tickets,ticket_price  from st_se_game_ticket_inv_history sgtih ,st_se_game_master sgm where   sgtih.game_id=sgm.game_id and  sgtih.current_owner_id='&quot;
							+ retOrgId
							+ &quot;' and date&lt;='&quot;
							+ toDate
							+ &quot;' and sgtih.cur_rem_tickets&gt;0 and (book_nbr='0'&quot;);
<span class="nc" id="L1272">			invItr = map.entrySet().iterator();</span>
<span class="nc bnc" id="L1273" title="All 2 branches missed.">			while (invItr.hasNext()) {</span>
<span class="nc" id="L1274">				Map.Entry&lt;String, Timestamp&gt; bookItrpair = (Map.Entry&lt;String, Timestamp&gt;) invItr</span>
						.next();
<span class="nc" id="L1276">				String bookNo = bookItrpair.getKey();</span>
<span class="nc" id="L1277">				Timestamp date = bookItrpair.getValue();</span>
<span class="nc" id="L1278">				stockRetTicketQuery.append(&quot;or book_nbr='&quot; + bookNo + &quot;'&quot;);</span>
<span class="nc" id="L1279">			}</span>
<span class="nc" id="L1280">			stockRetTicketQuery</span>
					.append(&quot;) order by task_id desc ) aa group by book_nbr,game_id&quot;);
<span class="nc" id="L1282">			System.out.println(&quot;query=======  &quot;</span>
					+ stockRetTicketQuery.toString());
<span class="nc" id="L1284">			statement = con.createStatement();</span>
<span class="nc" id="L1285">			resultSet = statement.executeQuery(stockRetTicketQuery.toString());</span>
<span class="nc bnc" id="L1286" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L1287">				String bookNo = resultSet.getString(&quot;book_nbr&quot;);</span>
<span class="nc" id="L1288">				stGameName = resultSet.getString(&quot;game_name&quot;);</span>
<span class="nc" id="L1289">				stMrp = resultSet.getDouble(&quot;mrp&quot;);</span>
<span class="nc" id="L1290">				stCountTickets = resultSet.getInt(&quot;cur_rem_tickets&quot;);</span>
<span class="nc" id="L1291">				statement2 = con.createStatement();</span>
<span class="nc" id="L1292">				resultSet2 = statement2</span>
						.executeQuery(&quot;select (100-transacrion_sale_comm_rate) as purchrate ,game_id ,book_nbr from st_se_game_inv_detail where book_nbr='&quot;
								+ bookNo
								+ &quot;' order by transaction_date desc limit 1&quot;);
<span class="nc bnc" id="L1296" title="All 2 branches missed.">				while (resultSet2.next()) {</span>
<span class="nc" id="L1297">					stDiscPrice = resultSet2.getDouble(&quot;purchrate&quot;) * 0.01</span>
							* stMrp;
<span class="nc bnc" id="L1299" title="All 2 branches missed.">					if (tktStockMap.containsKey(resultSet2.getInt(&quot;game_id&quot;)</span>
							+ &quot;_&quot; + resultSet2.getDouble(&quot;purchrate&quot;))) {

<span class="nc" id="L1302">						stockMrpDiscBean = (StockMrpDiscountBean) tktStockMap</span>
								.get(resultSet2.getInt(&quot;game_id&quot;) + &quot;_&quot;
										+ resultSet2.getDouble(&quot;purchrate&quot;));
<span class="nc" id="L1305">						stockMrpDiscBean.setStMrp(stockMrpDiscBean.getStMrp()</span>
								+ stMrp);
<span class="nc" id="L1307">						stockMrpDiscBean.setStCountTickets(stockMrpDiscBean</span>
								.getStCountTickets()
								+ stCountTickets);
<span class="nc" id="L1310">						stockMrpDiscBean.setStDiscPrice(stockMrpDiscBean</span>
								.getStDiscPrice()
								+ stDiscPrice);

					} else {
<span class="nc" id="L1315">						stockMrpDiscBean = new StockMrpDiscountBean();</span>
<span class="nc" id="L1316">						stockMrpDiscBean.setStGameName(stGameName);</span>
<span class="nc" id="L1317">						stockMrpDiscBean.setStMrp(stMrp);</span>
<span class="nc" id="L1318">						stockMrpDiscBean.setStCountTickets(stCountTickets);</span>
<span class="nc" id="L1319">						stockMrpDiscBean.setStDiscPrice(stDiscPrice);</span>
<span class="nc" id="L1320">						stockMrpDiscBean.setStPercent(resultSet2</span>
								.getDouble(&quot;purchrate&quot;));

<span class="nc" id="L1323">						tktStockMap.put(resultSet2.getInt(&quot;game_id&quot;) + &quot;_&quot;</span>
								+ resultSet2.getDouble(&quot;purchrate&quot;),
								stockMrpDiscBean);
					}

				}
<span class="nc" id="L1329">			}</span>
<span class="nc" id="L1330">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L1332">			e.printStackTrace();</span>
<span class="nc" id="L1333">		}</span>
<span class="nc" id="L1334">		System.out.println(&quot;Total amount in getStockMrpDiscountBeanList  exit &quot;</span>
				+ totalAmount);
<span class="nc" id="L1336">		return tktStockMap;</span>
	}

	public int getUserId(String retailerName) {
<span class="nc" id="L1340">		Connection con = null;</span>
<span class="nc" id="L1341">		con = DBConnect.getConnection();</span>
<span class="nc" id="L1342">		int retId = 0;</span>
		try {
<span class="nc" id="L1344">			statement = con.createStatement();</span>

<span class="nc" id="L1346">			resultSet = statement</span>
					.executeQuery(&quot;select organization_id  from st_lms_organization_master  where name='&quot;
							+ retailerName + &quot;' &quot;);

<span class="nc bnc" id="L1350" title="All 2 branches missed.">			while (resultSet.next()) {</span>
<span class="nc" id="L1351">				retId = resultSet.getInt(&quot;organization_id&quot;);</span>
			}
<span class="nc" id="L1353">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L1355">			e.printStackTrace();</span>
		} finally {
<span class="nc bnc" id="L1357" title="All 6 branches missed.">			if (con != null) {</span>
				try {
<span class="nc" id="L1359">					con.close();</span>
<span class="nc" id="L1360">				} catch (SQLException e) {</span>
					// TODO Auto-generated catch block
<span class="nc" id="L1362">					e.printStackTrace();</span>
<span class="nc" id="L1363">				}</span>
			}
		}
<span class="nc" id="L1366">		return retId;</span>
	}

	public void insertPaymentDetails(Connection con, int retOrgId,
			Timestamp from, Timestamp toDate, int agentOrgId,
			String reconReportTypeRet) {
<span class="nc" id="L1372">		Map&lt;String, CashChqPmntBean&gt; paymentMap = getPaymentBeanList(con,</span>
				retOrgId, from, toDate);
		CashChqPmntBean chqPmntBean;

<span class="nc" id="L1376">		String insertQuery = &quot;insert into st_lms_ret_recon_ticketwise (agent_org_id,retailer_org_id,recon_date,type,amt_parent,recon_balance) values(?,?,?,?,?,?)&quot;;</span>
		PreparedStatement preparedStatement;
		try {
<span class="nc" id="L1379">			con.setAutoCommit(false);</span>
<span class="nc" id="L1380">			preparedStatement = con.prepareStatement(insertQuery);</span>

<span class="nc" id="L1382">			double prevReconBal = getReconbalance(retOrgId, con,</span>
					reconReportTypeRet);
<span class="nc bnc" id="L1384" title="All 2 branches missed.">			if (paymentMap.size() != 0) {</span>
<span class="nc" id="L1385">				Iterator paymentItr = paymentMap.entrySet().iterator();</span>
<span class="nc bnc" id="L1386" title="All 2 branches missed.">				while (paymentItr.hasNext()) {</span>
<span class="nc" id="L1387">					Map.Entry&lt;String, CashChqPmntBean&gt; paymentItrpair = (Map.Entry&lt;String, CashChqPmntBean&gt;) paymentItr</span>
							.next();
<span class="nc" id="L1389">					chqPmntBean = paymentItrpair.getValue();</span>
<span class="nc" id="L1390">					preparedStatement.setInt(1, agentOrgId);</span>
<span class="nc" id="L1391">					preparedStatement.setInt(2, retOrgId);</span>
<span class="nc" id="L1392">					preparedStatement.setTimestamp(3, toDate);</span>
<span class="nc bnc" id="L1393" title="All 2 branches missed.">					if (chqPmntBean.getPaymentType().equalsIgnoreCase(</span>
							&quot;Cheque Bounce Charges&quot;)) {
<span class="nc" id="L1395">						preparedStatement.setString(4, &quot;ChqBounce Charges&quot;);</span>
					} else {
<span class="nc" id="L1397">						preparedStatement.setString(4, chqPmntBean</span>
								.getPaymentType());
					}
<span class="nc" id="L1400">					preparedStatement.setDouble(5, chqPmntBean</span>
							.getPaymentAmount());
<span class="nc bnc" id="L1402" title="All 4 branches missed.">					if (chqPmntBean.getPaymentType().equalsIgnoreCase(&quot;Cash&quot;)</span>
							|| chqPmntBean.getPaymentType().equalsIgnoreCase(
									&quot;Cheque&quot;)) {
<span class="nc" id="L1405">						preparedStatement</span>
								.setDouble(6, (prevReconBal - chqPmntBean
										.getPaymentAmount()));
<span class="nc" id="L1408">						prevReconBal = prevReconBal</span>
								- chqPmntBean.getPaymentAmount();
<span class="nc bnc" id="L1410" title="All 6 branches missed.">					} else if (chqPmntBean.getPaymentType().equalsIgnoreCase(</span>
							&quot;Cheque Bounce&quot;)
							|| chqPmntBean.getPaymentType().equalsIgnoreCase(
									&quot;Cheque Bounce Charges&quot;)
							|| chqPmntBean.getPaymentType().equalsIgnoreCase(
									&quot;Debit Note&quot;)) {
<span class="nc" id="L1416">						preparedStatement</span>
								.setDouble(6, (prevReconBal + chqPmntBean
										.getPaymentAmount()));
<span class="nc" id="L1419">						prevReconBal = prevReconBal</span>
								+ chqPmntBean.getPaymentAmount();
					}
<span class="nc" id="L1422">					preparedStatement.executeUpdate();</span>
<span class="nc" id="L1423">					con.commit();</span>
<span class="nc" id="L1424">				}</span>
<span class="nc" id="L1425">			} else {</span>
<span class="nc" id="L1426">				preparedStatement.setInt(1, agentOrgId);</span>
<span class="nc" id="L1427">				preparedStatement.setInt(2, retOrgId);</span>
<span class="nc" id="L1428">				preparedStatement.setTimestamp(3, toDate);</span>
<span class="nc" id="L1429">				preparedStatement.setString(4, &quot;N.A.&quot;);</span>
<span class="nc" id="L1430">				preparedStatement.setDouble(5, 0.0);</span>
<span class="nc" id="L1431">				preparedStatement.setDouble(6, prevReconBal);</span>
<span class="nc" id="L1432">				preparedStatement.executeUpdate();</span>
<span class="nc" id="L1433">				con.commit();</span>
			}
<span class="nc" id="L1435">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L1437">			e.printStackTrace();</span>
<span class="nc" id="L1438">		}</span>
<span class="nc" id="L1439">	}</span>

	public void insertPWTDetails(Connection con, int retOrgId, Timestamp from,
			Timestamp toDate, int agentOrgId, String reconReportTypeRet) {
<span class="nc" id="L1443">		List&lt;PWTPaymentsBean&gt; pwtBeanList = getPwtBeanList(con, retOrgId, from,</span>
				toDate);
<span class="nc" id="L1445">		String insertQuery = &quot;insert into st_lms_ret_recon_ticketwise (retailer_org_id,game_id,recon_date,type,amt_parent,amt_child,recon_balance,agent_org_id) values(?,?,?,?,?,?,?,?)&quot;;</span>
		PreparedStatement preparedStatement;
		PWTPaymentsBean pwtPaymentsBean;
		try {
<span class="nc" id="L1449">			con.setAutoCommit(false);</span>
<span class="nc" id="L1450">			preparedStatement = con.prepareStatement(insertQuery);</span>

<span class="nc" id="L1452">			double prevReconBal = getReconbalance(retOrgId, con,</span>
					reconReportTypeRet);
<span class="nc bnc" id="L1454" title="All 2 branches missed.">			if (pwtBeanList.size() != 0) {</span>
<span class="nc" id="L1455">				Iterator pwtBeanListIterator = pwtBeanList.listIterator();</span>
<span class="nc bnc" id="L1456" title="All 2 branches missed.">				while (pwtBeanListIterator.hasNext()) {</span>
<span class="nc" id="L1457">					pwtPaymentsBean = (PWTPaymentsBean) pwtBeanListIterator</span>
							.next();
<span class="nc" id="L1459">					preparedStatement.setInt(1, retOrgId);</span>

<span class="nc" id="L1461">					preparedStatement.setInt(2, pwtPaymentsBean.getGameNo());</span>
<span class="nc" id="L1462">					preparedStatement.setTimestamp(3, toDate);</span>
<span class="nc" id="L1463">					preparedStatement.setString(4, &quot;PWT&quot;);</span>
<span class="nc" id="L1464">					preparedStatement.setDouble(5, pwtPaymentsBean</span>
							.getTotalAmt());
<span class="nc" id="L1466">					preparedStatement.setDouble(6, pwtPaymentsBean.getNetPWT());</span>
<span class="nc" id="L1467">					preparedStatement.setDouble(7,</span>
							(prevReconBal - pwtPaymentsBean.getTotalAmt()));
<span class="nc" id="L1469">					preparedStatement.setDouble(8, agentOrgId);</span>
<span class="nc" id="L1470">					prevReconBal = prevReconBal - pwtPaymentsBean.getTotalAmt();</span>
<span class="nc" id="L1471">					preparedStatement.executeUpdate();</span>
<span class="nc" id="L1472">					con.commit();</span>

				}
<span class="nc" id="L1475">			} else {</span>
<span class="nc" id="L1476">				preparedStatement.setInt(1, retOrgId);</span>

<span class="nc" id="L1478">				preparedStatement.setInt(2, 0);</span>
<span class="nc" id="L1479">				preparedStatement.setTimestamp(3, toDate);</span>
<span class="nc" id="L1480">				preparedStatement.setString(4, &quot;PWT&quot;);</span>
<span class="nc" id="L1481">				preparedStatement.setDouble(5, 0.0);</span>
<span class="nc" id="L1482">				preparedStatement.setDouble(6, 0.0);</span>
<span class="nc" id="L1483">				preparedStatement.setDouble(7, prevReconBal);</span>
<span class="nc" id="L1484">				preparedStatement.setDouble(8, agentOrgId);</span>
<span class="nc" id="L1485">				preparedStatement.executeUpdate();</span>
<span class="nc" id="L1486">				con.commit();</span>
			}
<span class="nc" id="L1488">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L1490">			e.printStackTrace();</span>
<span class="nc" id="L1491">		}</span>
<span class="nc" id="L1492">	}</span>

	public void insertSalePurchaseDetails(Connection con, int retOrgId,
			Timestamp from, Timestamp toDate, int agentOrgId,
			String reconReportTypeRet) {
<span class="nc" id="L1497">		Map&lt;Integer, SalePurchaseRetBean&gt; salegameMap = getSalePurchaseDetails(</span>
				con, retOrgId, from, toDate);
<span class="nc" id="L1499">		String insertQuery = &quot;insert into st_lms_ret_recon_ticketwise (agent_org_id,retailer_org_id,game_id,recon_date,type,amt_parent,amt_child,recon_balance,mrp_amt) values(?,?,?,?,?,?,?,?,?)&quot;;</span>
		PreparedStatement preparedStatement;
		SalePurchaseRetBean salePurchaseRetBean;
<span class="nc" id="L1502">		double prevReconBal = getReconbalance(retOrgId, con, reconReportTypeRet);</span>

		try {
<span class="nc" id="L1505">			con.setAutoCommit(false);</span>
<span class="nc" id="L1506">			preparedStatement = con.prepareStatement(insertQuery);</span>
<span class="nc bnc" id="L1507" title="All 2 branches missed.">			if (salegameMap.size() != 0) {</span>
<span class="nc" id="L1508">				Iterator saleItr = salegameMap.entrySet().iterator();</span>
<span class="nc bnc" id="L1509" title="All 2 branches missed.">				while (saleItr.hasNext()) {</span>
<span class="nc" id="L1510">					Map.Entry&lt;String, SalePurchaseRetBean&gt; saleItrpair = (Map.Entry&lt;String, SalePurchaseRetBean&gt;) saleItr</span>
							.next();
<span class="nc" id="L1512">					salePurchaseRetBean = saleItrpair.getValue();</span>

<span class="nc" id="L1514">					preparedStatement.setInt(1, agentOrgId);</span>
<span class="nc" id="L1515">					preparedStatement.setInt(2, retOrgId);</span>
<span class="nc" id="L1516">					preparedStatement</span>
							.setInt(3, salePurchaseRetBean.getGameId());
<span class="nc" id="L1518">					preparedStatement.setTimestamp(4, toDate);</span>
<span class="nc" id="L1519">					preparedStatement.setString(5, &quot;NET_SALE&quot;);</span>
<span class="nc" id="L1520">					preparedStatement.setDouble(6, salePurchaseRetBean</span>
							.getAgtpurchPrice());
<span class="nc" id="L1522">					preparedStatement.setDouble(7, salePurchaseRetBean</span>
							.getRetpurchPrice());
<span class="nc" id="L1524">					preparedStatement.setDouble(8, (salePurchaseRetBean</span>
							.getRetpurchPrice() + prevReconBal));
<span class="nc" id="L1526">					preparedStatement</span>
							.setDouble(9, salePurchaseRetBean.getMrp());
<span class="nc" id="L1528">					prevReconBal = salePurchaseRetBean.getRetpurchPrice()</span>
							+ prevReconBal;
<span class="nc" id="L1530">					preparedStatement.executeUpdate();</span>
<span class="nc" id="L1531">					con.commit();</span>

<span class="nc" id="L1533">				}</span>
<span class="nc" id="L1534">			} else {</span>
<span class="nc" id="L1535">				preparedStatement.setInt(1, agentOrgId);</span>
<span class="nc" id="L1536">				preparedStatement.setInt(2, retOrgId);</span>
<span class="nc" id="L1537">				preparedStatement.setInt(3, 0);</span>
<span class="nc" id="L1538">				preparedStatement.setTimestamp(4, toDate);</span>
<span class="nc" id="L1539">				preparedStatement.setString(5, &quot;NET_SALE&quot;);</span>
<span class="nc" id="L1540">				preparedStatement.setDouble(6, 0.0);</span>
<span class="nc" id="L1541">				preparedStatement.setDouble(7, 0.0);</span>
<span class="nc" id="L1542">				preparedStatement.setDouble(8, prevReconBal);</span>
<span class="nc" id="L1543">				preparedStatement.setDouble(9, 0.0);</span>
<span class="nc" id="L1544">				preparedStatement.executeUpdate();</span>
<span class="nc" id="L1545">				con.commit();</span>
			}
<span class="nc" id="L1547">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L1549">			e.printStackTrace();</span>
<span class="nc" id="L1550">		}</span>
<span class="nc" id="L1551">	}</span>

	public void reconRetTktwiseEntry(int retOrgId, Timestamp pToDate,
			int userOrgId, String reconReportTypeRet) {
<span class="nc" id="L1555">		Connection con = null;</span>
<span class="nc" id="L1556">		con = DBConnect.getConnection();</span>
<span class="nc" id="L1557">		String dep_Date = new LedgerHelper().getDeployMentDate();</span>
<span class="nc" id="L1558">		DateFormat dateFormat1 = new java.text.SimpleDateFormat(&quot;dd-MM-yyyy&quot;);</span>
<span class="nc" id="L1559">		java.util.Date date = null;</span>
<span class="nc" id="L1560">		List&lt;Timestamp&gt; frTimeList = new ArrayList&lt;Timestamp&gt;();</span>
<span class="nc" id="L1561">		List&lt;Timestamp&gt; toTimeList = new ArrayList&lt;Timestamp&gt;();</span>
<span class="nc" id="L1562">		presentDate = null;</span>
<span class="nc" id="L1563">		toDate = null;</span>
<span class="nc" id="L1564">		prepstatement = null;</span>
<span class="nc" id="L1565">		statement = null;</span>
<span class="nc" id="L1566">		resultSet = null;</span>

		try {
<span class="nc" id="L1569">			prepstatement = con.prepareStatement(QueryManager</span>
					.getRetReconTktwiseDate());
<span class="nc" id="L1571">			prepstatement.setInt(1, userOrgId);</span>
<span class="nc" id="L1572">			prepstatement.setInt(2, retOrgId);</span>
<span class="nc" id="L1573">			toDate = pToDate;</span>
<span class="nc" id="L1574">			resultSet = prepstatement.executeQuery();</span>
<span class="nc bnc" id="L1575" title="All 2 branches missed.">			while (resultSet.next()) {</span>
				// present_date = rs1.getDate(&quot;date&quot;);
<span class="nc" id="L1577">				presentDate = resultSet.getTimestamp(&quot;recon_date&quot;);</span>

				break;
			}
<span class="nc bnc" id="L1581" title="All 4 branches missed.">			if (presentDate == null || presentDate.before(toDate)) {</span>
<span class="nc bnc" id="L1582" title="All 2 branches missed.">				if (presentDate == null) {</span>

<span class="nc" id="L1584">					statement = con.createStatement();</span>
<span class="nc" id="L1585">					resultSet = statement</span>
							.executeQuery(&quot;select transaction_date from st_lms_agent_transaction_master where user_org_id='&quot;
									+ userOrgId
									+ &quot;' and party_id='&quot;
									+ retOrgId
									+ &quot;' order by transaction_date  limit 1&quot;);
<span class="nc bnc" id="L1591" title="All 2 branches missed.">					while (resultSet.next()) {</span>
<span class="nc" id="L1592">						presentDate = resultSet</span>
								.getTimestamp(&quot;transaction_date&quot;);
					}
<span class="nc bnc" id="L1595" title="All 2 branches missed.">					if (presentDate == null) {</span>
<span class="nc" id="L1596">						System.out</span>
								.println(&quot;***********    No transaction between Agent &quot;
										+ userOrgId
										+ &quot; and Retailer &quot;
										+ retOrgId);
						return;
					}
					// date = dateFormat1.parse(dep_Date);
					// presentDate = new java.sql.Timestamp(date.getTime());
<span class="nc" id="L1605">					System.out.println(&quot;Present Date in if  is &quot; + presentDate);</span>

				}

<span class="nc" id="L1609">				Calendar from = Calendar.getInstance();</span>
<span class="nc" id="L1610">				Calendar to = Calendar.getInstance();</span>
<span class="nc" id="L1611">				from.setTimeInMillis(presentDate.getTime());</span>
<span class="nc" id="L1612">				to.setTimeInMillis(toDate.getTime());</span>

<span class="nc" id="L1614">				Calendar manipulatedFrom = Calendar.getInstance();</span>
<span class="nc" id="L1615">				Calendar manipulatedTo = Calendar.getInstance();</span>

<span class="nc" id="L1617">				Calendar tempFrom = Calendar.getInstance();</span>
<span class="nc" id="L1618">				Calendar tempTo = Calendar.getInstance();</span>

<span class="nc" id="L1620">				manipulatedFrom.setTimeInMillis(from.getTimeInMillis());</span>
<span class="nc" id="L1621">				manipulatedTo.setTimeInMillis(to.getTimeInMillis());</span>

<span class="nc" id="L1623">				manipulatedFrom.set(manipulatedFrom.get(Calendar.YEAR),</span>
						manipulatedFrom.get(Calendar.MONTH), manipulatedFrom
								.get(Calendar.DATE), 0, 0, 0);
<span class="nc" id="L1626">				manipulatedTo.set(manipulatedTo.get(Calendar.YEAR),</span>
						manipulatedTo.get(Calendar.MONTH), manipulatedTo
								.get(Calendar.DATE), 0, 0, 0);

<span class="nc" id="L1630">				System.out.println(&quot; from &quot; + from.getTime() + &quot;   to &quot;</span>
						+ to.getTime() + &quot;  manipulatedTo &quot;
						+ manipulatedTo.getTime());

<span class="nc bnc" id="L1634" title="All 12 branches missed.">				if (manipulatedFrom.get(Calendar.YEAR) == manipulatedTo</span>
						.get(Calendar.YEAR)
						&amp;&amp; manipulatedFrom.get(Calendar.MONTH) == manipulatedTo
								.get(Calendar.MONTH)
						&amp;&amp; manipulatedFrom.get(Calendar.DATE) == manipulatedTo
								.get(Calendar.DATE)
						&amp;&amp; manipulatedFrom.get(Calendar.HOUR) == manipulatedTo
								.get(Calendar.HOUR)
						&amp;&amp; manipulatedFrom.get(Calendar.MINUTE) == manipulatedTo
								.get(Calendar.MINUTE)
						&amp;&amp; manipulatedFrom.get(Calendar.SECOND) == manipulatedTo
								.get(Calendar.SECOND)) {
<span class="nc" id="L1646">					to.add(Calendar.DATE, 1);</span>
<span class="nc" id="L1647">					frTimeList.add(new Timestamp(from.getTimeInMillis()));</span>
<span class="nc" id="L1648">					toTimeList.add(new Timestamp(to.getTimeInMillis()));</span>
<span class="nc" id="L1649">					System.out</span>
							.println(retOrgId
									+ &quot; ###reconRetTktwiseEntry  same date 1111 frTimeList &quot;
									+ frTimeList);
<span class="nc" id="L1653">					System.out</span>
							.println(retOrgId
									+ &quot; ###reconRetTktwiseEntry same date  11111toTimeList &quot;
									+ toTimeList);

				} else {

<span class="nc" id="L1660">					tempFrom.setTimeInMillis(from.getTimeInMillis());</span>
<span class="nc" id="L1661">					tempTo.setTimeInMillis(manipulatedFrom.getTimeInMillis());</span>
<span class="nc" id="L1662">					tempTo.add(Calendar.DATE, 1);</span>
<span class="nc" id="L1663">					int j = 0;</span>

<span class="nc bnc" id="L1665" title="All 12 branches missed.">					while (!(tempFrom.get(Calendar.YEAR) == manipulatedTo</span>
							.get(Calendar.YEAR)
							&amp;&amp; tempFrom.get(Calendar.MONTH) == manipulatedTo
									.get(Calendar.MONTH)
							&amp;&amp; tempFrom.get(Calendar.DATE) == manipulatedTo
									.get(Calendar.DATE)
							&amp;&amp; tempFrom.get(Calendar.HOUR) == manipulatedTo
									.get(Calendar.HOUR)
							&amp;&amp; tempFrom.get(Calendar.MINUTE) == manipulatedTo
									.get(Calendar.MINUTE) &amp;&amp; tempFrom
							.get(Calendar.SECOND) == manipulatedTo
							.get(Calendar.SECOND))) {
<span class="nc" id="L1677">						j++;</span>

<span class="nc" id="L1679">						frTimeList</span>
								.add(new Timestamp(tempFrom.getTimeInMillis()));
<span class="nc" id="L1681">						toTimeList.add(new Timestamp(tempTo.getTimeInMillis()));</span>

<span class="nc" id="L1683">						tempFrom.setTimeInMillis(tempTo.getTimeInMillis());</span>
<span class="nc" id="L1684">						tempTo.add(Calendar.DATE, 1);</span>

					}
<span class="nc bnc" id="L1687" title="All 2 branches missed.">					if (tempTo.compareTo(to) &gt; 0) {</span>
<span class="nc" id="L1688">						tempTo.add(Calendar.DATE, -1);</span>
<span class="nc bnc" id="L1689" title="All 12 branches missed.">						if (!(tempTo.get(Calendar.YEAR) == to</span>
								.get(Calendar.YEAR)
								&amp;&amp; tempTo.get(Calendar.MONTH) == to
										.get(Calendar.MONTH)
								&amp;&amp; tempTo.get(Calendar.DATE) == to
										.get(Calendar.DATE)
								&amp;&amp; tempTo.get(Calendar.HOUR) == to
										.get(Calendar.HOUR)
								&amp;&amp; tempTo.get(Calendar.MINUTE) == to
										.get(Calendar.MINUTE) &amp;&amp; tempTo
								.get(Calendar.SECOND) == to
								.get(Calendar.SECOND))) {
<span class="nc" id="L1701">							frTimeList.add(new Timestamp(tempTo</span>
									.getTimeInMillis()));
<span class="nc" id="L1703">							toTimeList.add(new Timestamp(to.getTimeInMillis()));</span>
						}
					}

<span class="nc" id="L1707">					System.out</span>
							.println(retOrgId
									+ &quot;&amp;&amp; frTimeList.size()!=0** ###reconRetTktwiseEntry  Fianal 1111 frTimeList &quot;
									+ frTimeList);
<span class="nc" id="L1711">					System.out</span>
							.println(retOrgId
									+ &quot;** ###reconRetTktwiseEntry Fianal  11111toTimeList &quot;
									+ toTimeList);

				}

<span class="nc bnc" id="L1718" title="All 2 branches missed.">				if (frTimeList != null) {</span>
<span class="nc bnc" id="L1719" title="All 2 branches missed.">					for (int i = 0; i &lt; frTimeList.size(); i++) {</span>
<span class="nc" id="L1720">						insertSalePurchaseDetails(con, retOrgId, frTimeList</span>
								.get(i), toTimeList.get(i), userOrgId,
								reconReportTypeRet);
<span class="nc" id="L1723">						insertPaymentDetails(con, retOrgId, frTimeList.get(i),</span>
								toTimeList.get(i), userOrgId,
								reconReportTypeRet);
<span class="nc" id="L1726">						insertPWTDetails(con, retOrgId, frTimeList.get(i),</span>
								toTimeList.get(i), userOrgId,
								reconReportTypeRet);

					}
				}

			}
<span class="nc" id="L1734">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L1736">			e.printStackTrace();</span>
		} finally {
<span class="nc bnc" id="L1738" title="All 8 branches missed.">			if (con != null) {</span>
				try {
<span class="nc" id="L1740">					con.close();</span>
<span class="nc" id="L1741">				} catch (SQLException e) {</span>
					// TODO Auto-generated catch block
<span class="nc" id="L1743">					e.printStackTrace();</span>
<span class="nc" id="L1744">				}</span>
			}
		}

<span class="nc" id="L1748">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>