<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReportUtility.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.web.reportsMgmt.common</a> &gt; <span class="el_source">ReportUtility.java</span></div><h1>ReportUtility.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.web.reportsMgmt.common;

import java.sql.Connection;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.Time;
import java.sql.Timestamp;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.beans.GameBean;
import com.skilrock.lms.beans.PriviledgeBean;
import com.skilrock.lms.beans.ReportStatusBean;
import com.skilrock.lms.beans.ServiceBean;
import com.skilrock.lms.beans.UserDetailsBean;
import com.skilrock.lms.common.Utility;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.common.db.TableConstants;
import com.skilrock.lms.common.exception.LMSErrors;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.filter.LMSFilterDispatcher;
import com.skilrock.lms.common.utility.CommonMethods;

<span class="nc" id="L37">public class ReportUtility {</span>
<span class="nc" id="L38">	static Log logger = LogFactory.getLog(ReportUtility.class);</span>
	
<span class="nc" id="L40">	public static Map&lt;String, Object&gt; sysPropertiesMap=null;</span>
<span class="nc" id="L41">	public static Boolean isDG=&quot;YES&quot;.equalsIgnoreCase(LMSFilterDispatcher.getIsDraw());</span>
<span class="nc" id="L42">	public static Boolean isSE=&quot;YES&quot;.equalsIgnoreCase(LMSFilterDispatcher.getIsScratch());</span>
<span class="nc" id="L43">	public static Boolean isCS =&quot;YES&quot;.equalsIgnoreCase(LMSFilterDispatcher.getIsCS());</span>
<span class="nc" id="L44">	public static Boolean isOLA =&quot;YES&quot;.equalsIgnoreCase(LMSFilterDispatcher.getIsOLA());</span>
<span class="nc" id="L45">	public static Boolean isSLE = &quot;YES&quot;.equalsIgnoreCase(LMSFilterDispatcher.getIsSLE());</span>
<span class="nc" id="L46">	public static Boolean isIW = &quot;YES&quot;.equalsIgnoreCase(LMSFilterDispatcher.getIsIW());</span>
<span class="nc" id="L47">	public static Boolean isVS = &quot;YES&quot;.equalsIgnoreCase(LMSFilterDispatcher.getIsVS());</span>
<span class="nc" id="L48">	public static HashMap&lt;Integer, String&gt; gameMap=null;</span>
<span class="nc" id="L49">	public static HashMap&lt;Integer, String&gt; gameMapWithoutPromo=null; </span>
	
	//	Map added for Priviledge and Report bean
<span class="nc" id="L52">	public static Map&lt;String, PriviledgeBean&gt; priviledgeMap = null;</span>
<span class="nc" id="L53">	public static Map&lt;String, ReportStatusBean&gt; reportsMap = null;</span>

	public static Object getPropertyValue(String propertyDevName){
<span class="nc" id="L56">		return sysPropertiesMap.get(propertyDevName);</span>
	}
	
	public static void setSysPropertyMap(){
<span class="nc" id="L60">		Connection con=null;</span>
<span class="nc" id="L61">		Statement stmt = null;</span>
<span class="nc" id="L62">		ResultSet rs = null;</span>
		
		try{
<span class="nc" id="L65">			sysPropertiesMap=new HashMap&lt;String, Object&gt;();</span>
<span class="nc" id="L66">			con=DBConnect.getConnection();</span>
<span class="nc" id="L67">			stmt=con.createStatement();</span>
<span class="nc" id="L68">			rs=stmt.executeQuery(&quot;select property_dev_name,value from ge_property_master where status='ACTIVE'&quot;);</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">			while(rs.next()){</span>
<span class="nc" id="L70">				sysPropertiesMap.put(rs.getString(&quot;property_dev_name&quot;), rs.getString(&quot;value&quot;));</span>
			}
			
<span class="nc" id="L73">		}catch (SQLException se) {</span>
<span class="nc" id="L74">			se.printStackTrace();</span>
		}finally{
<span class="nc" id="L76">			try{</span>
<span class="nc" id="L77">				con.close();</span>
<span class="nc" id="L78">			}catch (SQLException se) {</span>
<span class="nc" id="L79">				se.printStackTrace();</span>
<span class="nc" id="L80">			}</span>
<span class="nc" id="L81">		}</span>
<span class="nc" id="L82">	}</span>
	
	
	public static String getSLEGameMapQuery(java.sql.Timestamp fromDate)
			throws LMSException {
<span class="nc" id="L87">		return &quot;select game_id,game_disp_name from st_sle_game_master where game_id not in(select game_id from st_sle_game_master where closing_time &lt;='&quot;</span>
				+ fromDate + &quot;') order by display_order&quot;;

	}

	public static List&lt;Integer&gt; getActiveSLEGameIdList(
			java.sql.Timestamp fromDate, Connection con) throws LMSException {
<span class="nc" id="L94">		List&lt;Integer&gt; gameNoList = new ArrayList&lt;Integer&gt;();</span>
<span class="nc" id="L95">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L96">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L98">			pstmt = con.prepareStatement(getSLEGameMapQuery(fromDate));</span>
<span class="nc" id="L99">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L100">			logger.debug(pstmt);</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L102">				gameNoList.add(rs.getInt(&quot;game_id&quot;));</span>
			}
<span class="nc" id="L104">		} catch (SQLException e) {</span>
<span class="nc" id="L105">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L106">			e.printStackTrace();</span>
<span class="nc" id="L107">			throw new LMSException(e);</span>
<span class="nc" id="L108">		} /*</span>
		 * finally { try { if (pstmt != null &amp;&amp; !pstmt.isClosed()) {
		 * pstmt.close(); } } catch (SQLException e) {
		 * logger.error(&quot;Exception: &quot; + e); e.printStackTrace(); throw new
		 * LMSException(e); } }
		 */
<span class="nc" id="L114">		return gameNoList;</span>
	}
	
	public static String getDrawGameMapQuery(java.sql.Timestamp fromDate) throws LMSException{
		//return &quot;select game_id,game_name from st_dg_game_master where game_nbr not in(select game_nbr from st_dg_game_master where closing_time &lt;='&quot;+fromDate+&quot;') order by display_order&quot;;
<span class="nc" id="L119">		return &quot;select game_id,game_name, game_status, closing_time from st_dg_game_master  where closing_time  &gt; '&quot;+fromDate+&quot;' or  closing_time is null order by display_order;&quot;;</span>
		
	}
	
	public static Map&lt;Integer, String&gt; getActiveGameNumMap(String startDate) throws LMSException {
<span class="nc" id="L124">		Map&lt;Integer, String&gt; gameIdMap = new LinkedHashMap&lt;Integer, String&gt;();</span>
<span class="nc" id="L125">		Connection con = null;</span>
<span class="nc" id="L126">		con = DBConnect.getConnection();</span>
<span class="nc" id="L127">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L128">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L130">			pstmt = con</span>
					.prepareStatement(&quot;select game_id,game_name from st_dg_game_master where game_nbr not in(select game_nbr from st_dg_game_master where closing_time &lt;='&quot;+startDate+&quot;') order by display_order&quot;);
<span class="nc" id="L132">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L133">			logger.debug(pstmt);</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L135">				gameIdMap.put(rs.getInt(&quot;game_id&quot;), rs.getString(&quot;game_name&quot;));</span>
			}
<span class="nc" id="L137">		} catch (SQLException e) {</span>
<span class="nc" id="L138">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L139">			e.printStackTrace();</span>
<span class="nc" id="L140">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L142">			try {</span>
<span class="nc bnc" id="L143" title="All 8 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L144">					con.close();</span>
				}
<span class="nc" id="L146">			} catch (SQLException e) {</span>
<span class="nc" id="L147">				logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L148">				e.printStackTrace();</span>
<span class="nc" id="L149">				throw new LMSException(e);</span>
<span class="nc" id="L150">			}</span>
		}
<span class="nc" id="L152">		return gameIdMap;</span>
	}
	
	
	public static String getScratchGameMapQuery(java.sql.Timestamp fromDate) throws LMSException{
<span class="nc" id="L157">		return &quot;select game_id, game_name from st_se_game_master&quot;;</span>
		
	}
	
	
	
	public static HashMap&lt;Integer, String&gt; fetchDrawDataMenu() throws LMSException{
	
<span class="nc bnc" id="L165" title="All 2 branches missed.">	if(gameMap==null){</span>
<span class="nc" id="L166">		Connection con = null;</span>
<span class="nc" id="L167">		con = DBConnect.getConnection();</span>
<span class="nc" id="L168">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L169">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L171">			pstmt = con</span>
					.prepareStatement(&quot;select game_id,game_name from st_dg_game_master order by display_order&quot;);
			
<span class="nc" id="L174">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L175">			logger.debug(pstmt);</span>
<span class="nc" id="L176">			gameMap=new LinkedHashMap&lt;Integer, String&gt;();</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L178">				gameMap.put(rs.getInt(&quot;game_id&quot;),rs.getString(&quot;game_name&quot;).toUpperCase());</span>
			}
<span class="nc" id="L180">		} catch (SQLException e) {</span>
<span class="nc" id="L181">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L182">			e.printStackTrace();</span>
<span class="nc" id="L183">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L185">			try {</span>
<span class="nc bnc" id="L186" title="All 8 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L187">					con.close();</span>
				}
<span class="nc" id="L189">			} catch (SQLException e) {</span>
<span class="nc" id="L190">				logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L191">				e.printStackTrace();</span>
<span class="nc" id="L192">				throw new LMSException(e);</span>
<span class="nc" id="L193">			}</span>
		}
	}
	
<span class="nc" id="L197">	return gameMap;</span>
	}
	
	
	public static HashMap&lt;Integer, String&gt; fetchActiveGameDrawDataMenu(){
<span class="nc" id="L202">		HashMap&lt;Integer, String&gt; gameMap=null;</span>

<span class="nc" id="L204">		Connection con = null;</span>
<span class="nc" id="L205">		con = DBConnect.getConnection();</span>
<span class="nc" id="L206">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L207">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L209">			pstmt = con</span>
					.prepareStatement(&quot;select game_id,game_name from st_dg_game_master where game_status!= 'SALE_CLOSE' order by display_order&quot;);
			
<span class="nc" id="L212">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L213">			logger.debug(pstmt);</span>
<span class="nc" id="L214">			gameMap=new LinkedHashMap&lt;Integer, String&gt;();</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L216">				gameMap.put(rs.getInt(&quot;game_id&quot;),rs.getString(&quot;game_name&quot;).toUpperCase());</span>
			}
<span class="nc" id="L218">		} catch (SQLException e) {</span>
<span class="nc" id="L219">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L220">			e.printStackTrace();</span>
			
		} finally {
<span class="nc" id="L223">			try {</span>
<span class="nc bnc" id="L224" title="All 12 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L225">					con.close();</span>
				}
<span class="nc" id="L227">			} catch (SQLException e) {</span>
<span class="nc" id="L228">				logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L229">				e.printStackTrace();</span>
				
<span class="nc" id="L231">			}</span>
<span class="nc" id="L232">		}</span>
		
	
<span class="nc" id="L235">		return gameMap;</span>
		
	}
	
	public static HashMap&lt;Integer, String&gt; fetchActiveCategoriesCommSerData(){
		
<span class="nc" id="L241">		ResultSet rs = null;</span>
<span class="nc" id="L242">		Connection con = null;</span>
<span class="nc" id="L243">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L244">		HashMap&lt;Integer, String&gt; catMap=null;</span>
		try {
<span class="nc" id="L246">			con = DBConnect.getConnection();</span>
<span class="nc" id="L247">			pstmt = con.prepareStatement(&quot;select category_id , category_code from st_cs_product_category_master where status='ACTIVE'&quot;);</span>
<span class="nc" id="L248">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L249">			logger.debug(pstmt);</span>
<span class="nc" id="L250">			catMap=new LinkedHashMap&lt;Integer, String&gt;();</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">			while (rs.next()) </span>
<span class="nc" id="L252">				catMap.put(rs.getInt(&quot;category_id&quot;),rs.getString(&quot;category_code&quot;).toUpperCase());</span>
<span class="nc" id="L253">		} catch (SQLException e){</span>
<span class="nc" id="L254">			logger.error(&quot;Exception: &quot; + e);</span>
		} finally {
<span class="nc" id="L256">			DBConnect.closeConnection(con, pstmt, rs); </span>
<span class="nc" id="L257">		 }</span>
<span class="nc" id="L258">		return catMap;</span>
	}
	
	
	
	public static String getOrgAdd(int orgId) throws LMSException {
<span class="nc" id="L264">		String orgAdd = &quot;&quot;;</span>
<span class="nc" id="L265">		Connection con = null;</span>
<span class="nc" id="L266">		con = DBConnect.getConnection();</span>
<span class="nc" id="L267">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L268">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L270">			pstmt = con</span>
					.prepareStatement(&quot;select addr_line1, addr_line2, city from st_lms_organization_master where organization_id = ?&quot;);
<span class="nc" id="L272">			pstmt.setInt(1, orgId);</span>
<span class="nc" id="L273">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L274">			logger.debug(pstmt);</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L276">				orgAdd = rs.getString(&quot;addr_line1&quot;) + &quot;, &quot;</span>
						+ rs.getString(&quot;addr_line2&quot;) + &quot;, &quot;
						+ rs.getString(&quot;city&quot;);
			}
<span class="nc" id="L280">		} catch (SQLException e) {</span>
<span class="nc" id="L281">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L282">			e.printStackTrace();</span>
<span class="nc" id="L283">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L285">			try {</span>
<span class="nc bnc" id="L286" title="All 8 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L287">					con.close();</span>
				}
<span class="nc" id="L289">			} catch (SQLException e) {</span>
<span class="nc" id="L290">				logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L291">				e.printStackTrace();</span>
<span class="nc" id="L292">				throw new LMSException(e);</span>
<span class="nc" id="L293">			}</span>
		}
<span class="nc" id="L295">		return orgAdd;</span>
	}
	
	public static Map&lt;String, String&gt; getOrgMap(String orgType) {
<span class="nc" id="L299">		Connection con = null;</span>
<span class="nc" id="L300">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L301">		Map&lt;String, String&gt; orgMap = new LinkedHashMap&lt;String, String&gt;();</span>
		try {
<span class="nc" id="L303">			con = DBConnect.getConnection();</span>
		//	String chkService = &quot;select name,organization_id from st_lms_organization_master where organization_type=? order by name&quot;;
			
<span class="nc" id="L306">			pstmt = con.prepareStatement(QueryManager.getOrgQry(orgType));</span>
<span class="nc" id="L307">			ResultSet rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L308" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L309">				orgMap.put(rs.getString(&quot;organization_id&quot;), rs</span>
						.getString(&quot;orgCode&quot;));
			}
<span class="nc" id="L312">		} catch (Exception e) {</span>
<span class="nc" id="L313">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L315">			try {</span>
<span class="nc" id="L316">				con.close();</span>
<span class="nc" id="L317">			} catch (SQLException e) {</span>
<span class="nc" id="L318">				e.printStackTrace();</span>
<span class="nc" id="L319">			}</span>
<span class="nc" id="L320">		}</span>
<span class="nc" id="L321">		return orgMap;</span>
	}

	public static Map&lt;String, String&gt; allGameMap() throws LMSException {
<span class="nc" id="L325">		Map&lt;String, String&gt; gameMap = new LinkedHashMap&lt;String, String&gt;();</span>
<span class="nc" id="L326">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L327">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L328">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L330">			String gameQry = &quot;select game_name,'DG' as game_type from st_dg_game_master union all select game_name,'SE' as game_type from st_se_game_master union all select category_code,'CS' as game_type from st_cs_product_category_master where status = 'ACTIVE' union all select wallet_name,'OLA' as game_type from st_ola_wallet_master order by game_type&quot;;</span>
<span class="nc" id="L331">			pstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L332">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L334">				gameMap.put(rs.getString(&quot;game_name&quot;), rs</span>
						.getString(&quot;game_type&quot;));
			}
<span class="nc" id="L337">		} catch (Exception e) {</span>
<span class="nc" id="L338">			e.printStackTrace();</span>
<span class="nc" id="L339">			throw new LMSException(&quot;Error in fetch Game List&quot;);</span>
		} finally {
<span class="nc" id="L341">			DBConnect.closeConnection(con, pstmt, rs);</span>
<span class="nc" id="L342">		}</span>
<span class="nc" id="L343">		return gameMap;</span>
	}
	
	public static Map&lt;String, String&gt; allGameMap(java.sql.Timestamp fromDate) throws LMSException {
<span class="nc" id="L347">		Map&lt;String, String&gt; gameMap = new LinkedHashMap&lt;String, String&gt;();</span>
<span class="nc" id="L348">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L349">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L350">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L352">			String gameQry=&quot;select game_name,'DG' as game_type,display_order  from st_dg_game_master  where closing_time  &gt; '&quot;+fromDate+&quot;' or  closing_time is null union all select game_name,'SE' as game_type,0 display_order from st_se_game_master union all select category_code,'CS' as game_type,0 display_order from st_cs_product_category_master where status = 'ACTIVE' UNION ALL SELECT game_disp_name,'SLE' AS game_type,display_order FROM st_sle_game_master WHERE game_no NOT IN(SELECT game_no FROM st_sle_game_master where closing_time &lt;='&quot;+fromDate+&quot;') union all SELECT game_disp_name, 'IW' AS game_type, display_order FROM st_iw_game_master WHERE game_no NOT IN(SELECT game_no FROM st_iw_game_master where closing_time &lt;='&quot;+fromDate+&quot;') union all SELECT game_disp_name, 'VS' AS game_type, display_order FROM st_vs_game_master WHERE game_no NOT IN(SELECT game_no FROM st_vs_game_master where closing_time &lt;='&quot;+fromDate+&quot;') union all select wallet_name,'OLA' as game_type,0 display_order from st_ola_wallet_master order by game_type,display_order&quot;;</span>
			//String gameQry = &quot;select game_name,'DG' as game_type from st_dg_game_master where game_nbr not in(select game_nbr from st_dg_game_master where closing_time &lt;='&quot;+fromDate+&quot;') union all select game_name,'SE' as game_type from st_se_game_master union all select category_code,'CS' as game_type from st_cs_product_category_master where status = 'ACTIVE' union all select wallet_name,'OLA' as game_type from st_ola_wallet_master order by game_type&quot;;
<span class="nc" id="L354">			pstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L355">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L356" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L357">				gameMap.put(rs.getString(&quot;game_name&quot;), rs</span>
						.getString(&quot;game_type&quot;));
			}
<span class="nc" id="L360">		} catch (Exception e) {</span>
<span class="nc" id="L361">			e.printStackTrace();</span>
<span class="nc" id="L362">			throw new LMSException(&quot;Error in fetch Game List&quot;);</span>
		} finally {
<span class="nc" id="L364">			DBConnect.closeConnection(con, pstmt, rs);</span>
<span class="nc" id="L365">		}</span>
<span class="nc" id="L366">		System.out.println(gameMap);</span>
<span class="nc" id="L367">		return gameMap;</span>
	}
	

	public Map&lt;String, String&gt; allCatMap() throws LMSException {
<span class="nc" id="L372">		Map&lt;String, String&gt; gameMap = new LinkedHashMap&lt;String, String&gt;();</span>
<span class="nc" id="L373">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L374">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L375">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L377">			String gameQry = &quot;select category_code,'CS' as cat_type from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L378">			pstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L379">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L381">				gameMap.put(rs.getString(&quot;category_code&quot;), rs</span>
						.getString(&quot;cat_type&quot;));
			}
<span class="nc" id="L384">		} catch (Exception e) {</span>
<span class="nc" id="L385">			e.printStackTrace();</span>
<span class="nc" id="L386">			throw new LMSException(&quot;Error in fetch Cat List&quot;);</span>
		} finally {
<span class="nc" id="L388">			try {</span>
<span class="nc" id="L389">				con.close();</span>
<span class="nc" id="L390">			} catch (SQLException e) {</span>
<span class="nc" id="L391">				e.printStackTrace();</span>
<span class="nc" id="L392">			}</span>
<span class="nc" id="L393">		}</span>
<span class="nc" id="L394">		return gameMap;</span>
	}

	public Map&lt;String, Boolean&gt; checkAvailableService() {
<span class="nc" id="L398">		Connection con = null;</span>
<span class="nc" id="L399">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L400">		Map&lt;String, Boolean&gt; serMap = new HashMap&lt;String, Boolean&gt;();</span>
		try {
<span class="nc" id="L402">			con = DBConnect.getConnection();</span>
<span class="nc" id="L403">			String chkService = &quot;select service_code,status from st_lms_service_master where service_code!='MGMT'&quot;;</span>
<span class="nc" id="L404">			pstmt = con.prepareStatement(chkService);</span>
<span class="nc" id="L405">			ResultSet rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L407">				serMap.put(rs.getString(&quot;service_code&quot;), &quot;ACTIVE&quot;.equals(rs</span>
						.getString(&quot;status&quot;)));
			}
<span class="nc" id="L410">		} catch (Exception e) {</span>
<span class="nc" id="L411">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L413">			try {</span>
<span class="nc" id="L414">				con.close();</span>
<span class="nc" id="L415">			} catch (SQLException e) {</span>
<span class="nc" id="L416">				e.printStackTrace();</span>
<span class="nc" id="L417">			}</span>
<span class="nc" id="L418">		}</span>
<span class="nc" id="L419">		return serMap;</span>
	}
	
	public static int getOrgIdFromOrgName(String orgName, String type) throws LMSException {

<span class="nc" id="L424">		Connection connection = null;</span>
<span class="nc" id="L425">		Statement statement = null;</span>
<span class="nc" id="L426">		ResultSet resultSet = null;</span>

<span class="nc" id="L428">		int orgId = 0;</span>
		try {

<span class="nc" id="L431">			String query = null;</span>
			 
<span class="nc" id="L433">			connection = DBConnect.getConnection();</span>
<span class="nc" id="L434">			statement = connection.createStatement();</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">			if (type.equals(&quot;AGENT&quot;)) {</span>
<span class="nc" id="L436">				query = QueryManager.getST5PartyTypeQuery() + &quot;and name='&quot;</span>
						+ orgName + &quot;'&quot;;
			}
<span class="nc bnc" id="L439" title="All 2 branches missed.">			if (type.equals(&quot;RETAILER&quot;)) {</span>
<span class="nc" id="L440">				query = QueryManager.getST5PartyTypeForAgentQuery()</span>
						+ &quot;and name='&quot; + orgName + &quot;'&quot;;
			}
<span class="nc" id="L443">			logger.debug(&quot;-----Query----::&quot; + query);</span>
<span class="nc" id="L444">			resultSet = statement.executeQuery(query);</span>

<span class="nc" id="L446">			resultSet.next();</span>
<span class="nc" id="L447">			Integer intx = resultSet.getInt(TableConstants.ORGANIZATION_ID);</span>
<span class="nc" id="L448">			orgId = intx.intValue();</span>
<span class="nc" id="L449">		} catch (SQLException e) {</span>

<span class="nc" id="L451">			e.printStackTrace();</span>
<span class="nc" id="L452">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L454">			try {</span>
<span class="nc bnc" id="L455" title="All 4 branches missed.">				if (resultSet != null) {</span>
<span class="nc" id="L456">					resultSet.close();</span>
				}
<span class="nc bnc" id="L458" title="All 4 branches missed.">				if (statement != null) {</span>
<span class="nc" id="L459">					statement.close();</span>
				}
<span class="nc bnc" id="L461" title="All 4 branches missed.">				if (connection != null) {</span>
<span class="nc" id="L462">					connection.close();</span>
				}
<span class="nc" id="L464">			} catch (Exception ee) {</span>
<span class="nc" id="L465">				logger.error(&quot;Error in closing the Connection&quot;);</span>
<span class="nc" id="L466">				ee.printStackTrace();</span>
<span class="nc" id="L467">				throw new LMSException(ee);</span>

<span class="nc" id="L469">			}</span>

		}
<span class="nc" id="L472">		return orgId;</span>

	}

	public static String getOrgNameFromOrgId(Connection conn, int orgId)
			throws SQLException {
<span class="nc" id="L478">		PreparedStatement pstmt=null;</span>
<span class="nc" id="L479">		String name = null;</span>
<span class="nc" id="L480">		pstmt = conn.prepareStatement(&quot;select name from st_lms_organization_master where organization_id=?&quot;);</span>
<span class="nc" id="L481">		pstmt.setInt(1, orgId);</span>
<span class="nc" id="L482">		ResultSet rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L483" title="All 2 branches missed.">		while (rs.next()) {</span>
<span class="nc" id="L484">			name = rs.getString(&quot;name&quot;);</span>
		}

<span class="nc" id="L487">		return name;</span>
	}
	
	public static int getUserIdFromOrgId(int orgId, Connection con) throws SQLException, LMSException {
<span class="nc" id="L491">		int userId = 0;</span>
<span class="nc" id="L492">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L493">		pstmt = con.prepareStatement(&quot;select user_id  from st_lms_user_master where organization_id=?&quot;);</span>
<span class="nc" id="L494">		pstmt.setInt(1, orgId);</span>
<span class="nc" id="L495">		ResultSet rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">		if (rs.next()) {</span>
<span class="nc" id="L497">			userId = rs.getInt(&quot;user_id&quot;);</span>
		}
<span class="nc" id="L499">		return userId;</span>
	}

	public static void getOrgNameMap(Connection conn,	Map&lt;Integer, String&gt; agtNameOrgIdMap, String orgIds)
			throws SQLException {
<span class="nc" id="L504">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L505">		ResultSet rs=null;</span>
		try{
<span class="nc" id="L507">			String name = null;</span>

		
<span class="nc" id="L510">			String agtOrgQry = &quot;select &quot;+QueryManager.getOrgCodeQuery()+&quot;,organization_id from st_lms_organization_master where organization_id in(&quot;+orgIds+&quot;) order by &quot;+QueryManager.getAppendOrgOrder();</span>
			
		
<span class="nc" id="L513">			pstmt = conn</span>
					.prepareStatement(agtOrgQry);
<span class="nc" id="L515">			 rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L516" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L517">				name = rs.getString(&quot;orgCode&quot;);</span>
<span class="nc" id="L518">				agtNameOrgIdMap.put(rs.getInt(&quot;organization_id&quot;),name);</span>
			}
<span class="nc" id="L520">		}catch(Exception e){</span>
			
<span class="nc" id="L522">			e.printStackTrace();</span>
		}finally {
			
<span class="nc bnc" id="L525" title="All 6 branches missed.">			if(pstmt!=null){</span>
<span class="nc" id="L526">				pstmt.close();</span>
			}
<span class="nc bnc" id="L528" title="All 6 branches missed.">			if(rs!=null){</span>
<span class="nc" id="L529">				rs.close();</span>
			}
			
		}
		
		

	
<span class="nc" id="L537">	}</span>
public static int getDaysBetweenDate(Calendar startDate,Calendar endDate){
	
<span class="nc" id="L540">	long diff = (clearTimeFromDate(endDate)).getTimeInMillis()-(clearTimeFromDate(startDate)).getTimeInMillis();</span>
	try{
<span class="nc" id="L542">		return (int) (diff/86400000);</span>
		
<span class="nc" id="L544">	}catch(Exception e){</span>
		
	}
<span class="nc" id="L547">	return 0;</span>
}	
public static Calendar  clearTimeFromDate(Calendar cal){
	
<span class="nc" id="L551">	cal.set(Calendar.HOUR_OF_DAY, 0);</span>
<span class="nc" id="L552">	cal.set(Calendar.MINUTE, 0);</span>
<span class="nc" id="L553">	cal.set(Calendar.SECOND, 0);</span>
<span class="nc" id="L554">	cal.set(Calendar.MILLISECOND, 0);</span>
<span class="nc" id="L555">	return cal;</span>
}
/**
 * Check if startDate is before or after Last Archiving Date
 * @param startDate
 * @return
 */

	public static boolean isArchData(Date startDate) {
<span class="nc" id="L564">		boolean isArchData = true;</span>

		try {

<span class="nc" id="L568">			String lastDate = CommonMethods.getLastArchDate();</span>
			//SimpleDateFormat formatOld = new SimpleDateFormat(&quot;dd-MM-yyyy&quot;);
<span class="nc" id="L570">			SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L571">			logger.info(&quot;start date&quot; + startDate + &quot;last archieve date&quot;+ lastDate);</span>
<span class="nc" id="L572">			Calendar calStart = Calendar.getInstance();</span>
<span class="nc" id="L573">			Calendar calLast = Calendar.getInstance();</span>
<span class="nc" id="L574">			calStart.setTime(format.parse(lastDate));</span>
<span class="nc" id="L575">			calLast.setTime(startDate);</span>
<span class="nc bnc" id="L576" title="All 2 branches missed.">			if (calStart.compareTo(calLast)&gt;=0) {</span>
<span class="nc" id="L577">				isArchData = true;</span>
			} else {
<span class="nc" id="L579">				isArchData = false;</span>

			}

<span class="nc" id="L583">		} catch (Exception e) {</span>
<span class="nc" id="L584">			e.printStackTrace();</span>

<span class="nc" id="L586">		}</span>

<span class="nc" id="L588">		return isArchData;</span>

	}
	
	/*public static boolean checkDateLessThanArchiveDate(Object fromDate,Connection con){
		PreparedStatement pstmt=null;
		ResultSet rs=null;
		try{
			pstmt=con.prepareStatement(&quot;select if(last_date &gt; ?,'TRUE','FALSE') status from tempdate_history order by id desc limit 1&quot;);
			pstmt.setString(1,fromDate.toString());
			rs=pstmt.executeQuery();
			if(rs.next()){
				if(&quot;TRUE&quot;.equals(rs.getString(&quot;status&quot;))){
					return true;
				}
			}else{
				pstmt = con.prepareStatement(&quot;select if(last_date &gt; ?,'TRUE','FALSE') status from st_lms_property_master where property_code='deployment_date'&quot;);
				pstmt.setString(1,fromDate.toString());
				rs=pstmt.executeQuery();
				if(rs.next()){
					if(&quot;TRUE&quot;.equals(rs.getString(&quot;status&quot;))){
					return true;
					}
				}
			
			}
		}catch (Exception e) {
			e.printStackTrace();
		}
		return false;
	}*/

	public static boolean checkDateLessThanArchiveDate(Object fromDate,Connection con){
<span class="nc" id="L621">		PreparedStatement pstmt=null;</span>
<span class="nc" id="L622">		ResultSet rs=null;</span>
		try{
<span class="nc" id="L624">				SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-mm-dd&quot;);</span>
<span class="nc" id="L625">				SimpleDateFormat sdk = new SimpleDateFormat(&quot;dd-mm-yyyy&quot;);</span>
<span class="nc" id="L626">				java.util.Date startDate=(java.util.Date) sdf.parse(fromDate.toString());</span>
		
<span class="nc" id="L628">			pstmt=con.prepareStatement(&quot;select if(last_date &gt; ?,'TRUE','FALSE') status from tempdate_history order by id desc limit 1&quot;);</span>
<span class="nc" id="L629">			pstmt.setString(1,fromDate.toString());</span>
<span class="nc" id="L630">			rs=pstmt.executeQuery();</span>
<span class="nc bnc" id="L631" title="All 2 branches missed.">			if(rs.next()){</span>
<span class="nc bnc" id="L632" title="All 2 branches missed.">				if(&quot;TRUE&quot;.equals(rs.getString(&quot;status&quot;))){</span>
<span class="nc" id="L633">					return true;</span>
				}
			}else{
<span class="nc" id="L636">				pstmt = con.prepareStatement(&quot;select value from st_lms_property_master where property_code='deployment_date'&quot;);</span>
<span class="nc" id="L637">				rs=pstmt.executeQuery();</span>
<span class="nc bnc" id="L638" title="All 2 branches missed.">				if(rs.next()){</span>
<span class="nc" id="L639">					java.util.Date dbDate = (java.util.Date) sdk.parse(rs.getString(&quot;value&quot;));				    </span>
<span class="nc bnc" id="L640" title="All 2 branches missed.">					 if(startDate.before(dbDate)){</span>
<span class="nc" id="L641">						 return true;					       </span>
					 }
				}
			}
<span class="nc" id="L645">		}catch (Exception e) {</span>
<span class="nc" id="L646">			e.printStackTrace();</span>
<span class="nc" id="L647">		}</span>
<span class="nc" id="L648">		return false;</span>
	}

	public static boolean checkDateLessThanArchiveDate(Object fromDate){
<span class="nc" id="L652">		Connection con=null;</span>
		try{
<span class="nc" id="L654">			 con=DBConnect.getConnection();</span>
<span class="nc" id="L655">			 return checkDateLessThanArchiveDate(fromDate, con);</span>
<span class="nc" id="L656">		}catch (Exception e) {</span>
<span class="nc" id="L657">			e.printStackTrace();</span>
		}finally{
<span class="nc" id="L659">			DBConnect.closeCon(con);</span>
<span class="nc" id="L660">		}</span>
<span class="nc" id="L661">		return false;</span>
		 
	}
	
	public static String getLastArchDate(Connection con) {
		 
<span class="nc" id="L667">		 PreparedStatement pstmt = null;</span>
<span class="nc" id="L668">		 ResultSet rs = null;</span>
<span class="nc" id="L669">		String lastDate=&quot;&quot;;</span>
<span class="nc" id="L670">		String oldLastDate = &quot;&quot;;</span>
		
		try {
<span class="nc" id="L673">			pstmt = con.prepareStatement(&quot;select last_date from tempdate_history order by id desc limit 1&quot;);</span>
<span class="nc" id="L674">			rs=pstmt.executeQuery();</span>
<span class="nc bnc" id="L675" title="All 2 branches missed.">			if(rs.next()){</span>
<span class="nc" id="L676">				lastDate=rs.getDate(&quot;last_date&quot;).toString();	</span>
			}else{
<span class="nc" id="L678">				pstmt = con.prepareStatement(&quot;select value last_date from st_lms_property_master where property_code='deployment_date'&quot;);</span>
<span class="nc" id="L679">				rs=pstmt.executeQuery();</span>
<span class="nc bnc" id="L680" title="All 2 branches missed.">				if(rs.next()){</span>
<span class="nc" id="L681">					oldLastDate=rs.getString(&quot;last_date&quot;);</span>
<span class="nc" id="L682">					SimpleDateFormat formatOld = new SimpleDateFormat(&quot;dd-MM-yyyy&quot;);</span>
<span class="nc" id="L683">					SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L684">					java.util.Date oldDate = formatOld.parse(oldLastDate);</span>
<span class="nc" id="L685">					Calendar cal1 = Calendar.getInstance();</span>
<span class="nc" id="L686">					cal1.setTime(oldDate);</span>
<span class="nc" id="L687">					cal1.add(Calendar.DAY_OF_MONTH, -1);</span>
<span class="nc" id="L688">					lastDate = format.format(cal1.getTime());</span>
				}
			}
<span class="nc" id="L691">		}catch (Exception e) {</span>
<span class="nc" id="L692">			e.printStackTrace();</span>
<span class="nc" id="L693">		}</span>
<span class="nc" id="L694">		return lastDate;</span>
	}
	
	public static Date getLastArchDateInDateFormat(Connection con) {
		 
<span class="nc" id="L699">		 PreparedStatement pstmt = null;</span>
<span class="nc" id="L700">		 ResultSet rs = null;</span>
<span class="nc" id="L701">		 Date lastDate=null;</span>
		
		
		try {
<span class="nc" id="L705">			pstmt = con.prepareStatement(&quot;select last_date from tempdate_history order by id desc limit 1&quot;);</span>
<span class="nc" id="L706">			rs=pstmt.executeQuery();</span>
<span class="nc bnc" id="L707" title="All 2 branches missed.">			if(rs.next()){</span>
<span class="nc" id="L708">				lastDate=rs.getDate(&quot;last_date&quot;);	</span>
			}else{
<span class="nc" id="L710">				pstmt = con.prepareStatement(&quot;select value last_date from st_lms_property_master where property_code='deployment_date'&quot;);</span>
<span class="nc" id="L711">				rs=pstmt.executeQuery();</span>
<span class="nc bnc" id="L712" title="All 2 branches missed.">				if(rs.next()){</span>
<span class="nc" id="L713">					String oldLastDate =rs.getString(&quot;last_date&quot;);</span>
<span class="nc" id="L714">					SimpleDateFormat formatOld = new SimpleDateFormat(&quot;dd-MM-yyyy&quot;);</span>
<span class="nc" id="L715">					java.util.Date oldDate = formatOld.parse(oldLastDate);</span>
<span class="nc" id="L716">					Calendar cal1 = Calendar.getInstance();</span>
<span class="nc" id="L717">					cal1.setTime(oldDate);</span>
<span class="nc" id="L718">					cal1.add(Calendar.DAY_OF_MONTH, -1);</span>
<span class="nc" id="L719">					lastDate =new java.sql.Date(cal1.getTimeInMillis());</span>
				}
			}
<span class="nc" id="L722">		}catch (Exception e) {</span>
<span class="nc" id="L723">			e.printStackTrace();</span>
<span class="nc" id="L724">		}</span>
<span class="nc" id="L725">		return lastDate;</span>
	}

	/**
	 * Game MAP Without Free Games
	 * @return
	 * @throws LMSException
	 */
	public static HashMap&lt;Integer, String&gt; fetchGameMapWithoutPromo() throws LMSException{
		
<span class="nc bnc" id="L735" title="All 2 branches missed.">		if(gameMapWithoutPromo==null){</span>
<span class="nc" id="L736">			Connection con = null;</span>
<span class="nc" id="L737">			con = DBConnect.getConnection();</span>
<span class="nc" id="L738">			PreparedStatement pstmt = null;</span>
<span class="nc" id="L739">			ResultSet rs = null;</span>
			try {
//				pstmt = con
//						.prepareStatement(&quot;select game_id,game_name from st_dg_game_master  left join st_dg_promo_scheme on game_id=promo_game_id where promo_game_id is null  order by display_order&quot;);
<span class="nc" id="L743">				pstmt = con</span>
				.prepareStatement(&quot;select game_id,game_name from st_dg_game_master order by display_order&quot;);
				
<span class="nc" id="L746">				rs = pstmt.executeQuery();</span>
<span class="nc" id="L747">				logger.debug(pstmt);</span>
<span class="nc" id="L748">				gameMapWithoutPromo=new LinkedHashMap&lt;Integer, String&gt;();</span>
<span class="nc bnc" id="L749" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L750">					gameMapWithoutPromo.put(rs.getInt(&quot;game_id&quot;),rs.getString(&quot;game_name&quot;).toUpperCase());</span>
				}
<span class="nc" id="L752">			} catch (SQLException e) {</span>
<span class="nc" id="L753">				logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L754">				e.printStackTrace();</span>
<span class="nc" id="L755">				throw new LMSException(e);</span>
			} finally {
<span class="nc" id="L757">				try {</span>
<span class="nc bnc" id="L758" title="All 4 branches missed.">					if (con != null ) {</span>
<span class="nc" id="L759">						con.close();</span>
					}
<span class="nc" id="L761">				} catch (SQLException e) {</span>
<span class="nc" id="L762">					logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L763">					e.printStackTrace();</span>
<span class="nc" id="L764">					throw new LMSException(e);</span>
<span class="nc" id="L765">				}</span>
			}
		}
		
<span class="nc" id="L769">		return gameMapWithoutPromo;</span>
	}

	public static ReportStatusBean getReportStatus(String actionName) {
<span class="nc" id="L773">		PriviledgeBean priviledgeBean = priviledgeMap.get(actionName);</span>
<span class="nc" id="L774">		ReportStatusBean reportStatusBean = null;</span>

<span class="nc bnc" id="L776" title="All 2 branches missed.">		if(priviledgeBean != null) {</span>
<span class="nc" id="L777">			reportStatusBean =  reportsMap.get(priviledgeBean.getModule()+&quot;#&quot;+priviledgeBean.getGroupName()+&quot;#&quot;+priviledgeBean.getChannel());</span>
<span class="nc bnc" id="L778" title="All 2 branches missed.">			if(reportStatusBean != null) {</span>
<span class="nc" id="L779">				Calendar calendar = Calendar.getInstance();</span>
<span class="nc" id="L780">				long startTime = reportStatusBean.getStartTime().getTime();</span>
<span class="nc" id="L781">				long endTime = reportStatusBean.getEndTime().getTime();</span>
<span class="nc" id="L782">				long nowTime = 0L;</span>
				try {
<span class="nc" id="L784">					nowTime = new Time(new SimpleDateFormat(&quot;HH:mm:ss&quot;).parse(calendar.get(Calendar.HOUR_OF_DAY)+&quot;:&quot;+calendar.get(Calendar.MINUTE)+&quot;:&quot;+calendar.get(Calendar.SECOND)).getTime()).getTime();</span>
<span class="nc" id="L785">				} catch (ParseException ex) {</span>
<span class="nc" id="L786">					logger.error(&quot;Exception: &quot; + ex);</span>
<span class="nc" id="L787">					ex.printStackTrace();</span>
<span class="nc" id="L788">					reportStatusBean = new ReportStatusBean();</span>
<span class="nc" id="L789">					reportStatusBean.setReportStatus(&quot;FAILURE&quot;);</span>
<span class="nc" id="L790">					return reportStatusBean;</span>
<span class="nc" id="L791">				}</span>

<span class="nc bnc" id="L793" title="All 4 branches missed.">				if(!(nowTime&gt;=startTime &amp;&amp; nowTime&lt;=endTime))</span>
<span class="nc" id="L794">					reportStatusBean.setReportStatus(&quot;SUCCESS&quot;);</span>
				else
<span class="nc" id="L796">					reportStatusBean.setReportStatus(&quot;FAILURE&quot;);</span>

<span class="nc" id="L798">				return reportStatusBean;</span>
			}
		}

<span class="nc" id="L802">		reportStatusBean = new ReportStatusBean();</span>
<span class="nc" id="L803">		reportStatusBean.setReportStatus(&quot;SUCCESS&quot;);</span>
<span class="nc" id="L804">		reportStatusBean.setReportingFrom(&quot;MAIN_DB&quot;);</span>
<span class="nc" id="L805">		return reportStatusBean;</span>
	}

	public static void onStartPriviledgeMap(Connection connection) throws LMSException {
<span class="nc" id="L809">		priviledgeMap = new HashMap&lt;String, PriviledgeBean&gt;();</span>

<span class="nc" id="L811">		Statement stmt = null;</span>
<span class="nc" id="L812">		ResultSet rs = null;</span>
<span class="nc" id="L813">		PriviledgeBean priviledgeBean = null;</span>
		try {
<span class="nc" id="L815">			stmt = connection.createStatement();</span>
<span class="nc" id="L816">			rs = stmt.executeQuery(&quot;SELECT action_mapping AS priviledge_key, action_id, priv_id, priv_title, priv_disp_name, action_mapping, parent_priv_id, STATUS, priv_owner, related_to, group_name, is_start, channel, priv_code, hidden, 'MGMT' AS module FROM st_lms_priviledge_rep UNION ALL SELECT action_mapping AS priviledge_key, action_id, priv_id, priv_title, priv_disp_name, action_mapping, parent_priv_id, STATUS, priv_owner, related_to, group_name, is_start, channel, priv_code, hidden, 'DG' AS module FROM st_dg_priviledge_rep UNION ALL SELECT action_mapping AS priviledge_key, action_id, priv_id, priv_title, priv_disp_name, action_mapping, parent_priv_id, STATUS, priv_owner, related_to, group_name, is_start, channel, priv_code, hidden, 'OLA' AS module FROM st_ola_priviledge_rep UNION ALL SELECT action_mapping AS priviledge_key, action_id, priv_id, priv_title, priv_disp_name, action_mapping, parent_priv_id, STATUS, priv_owner, related_to, group_name, is_start, channel, priv_code, hidden, 'SE' AS module FROM st_se_priviledge_rep UNION ALL SELECT action_mapping AS priviledge_key, action_id, priv_id, priv_title, priv_disp_name, action_mapping, parent_priv_id, STATUS, priv_owner, related_to, group_name, is_start, channel, priv_code, hidden, 'IW' AS module FROM st_iw_priviledge_rep;&quot;);</span>
<span class="nc" id="L817">			logger.info(stmt);</span>
<span class="nc bnc" id="L818" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L819">				priviledgeBean = new PriviledgeBean();</span>

<span class="nc" id="L821">				priviledgeBean.setActionId(rs.getInt(&quot;action_id&quot;));</span>
<span class="nc" id="L822">				priviledgeBean.setPrivId(rs.getInt(&quot;priv_id&quot;));</span>
<span class="nc" id="L823">				priviledgeBean.setPrivTitle(rs.getString(&quot;priv_title&quot;));</span>
<span class="nc" id="L824">				priviledgeBean.setPrivDisplayName(rs.getString(&quot;priv_disp_name&quot;));</span>
<span class="nc" id="L825">				priviledgeBean.setActionMapping(rs.getString(&quot;action_mapping&quot;));</span>
<span class="nc" id="L826">				priviledgeBean.setParentPrivId(rs.getInt(&quot;parent_priv_id&quot;));</span>
<span class="nc" id="L827">				priviledgeBean.setStatus(rs.getString(&quot;status&quot;));</span>
<span class="nc" id="L828">				priviledgeBean.setPrivOwner(rs.getString(&quot;priv_owner&quot;));</span>
<span class="nc" id="L829">				priviledgeBean.setRelatedTo(rs.getString(&quot;related_to&quot;));</span>
<span class="nc" id="L830">				priviledgeBean.setGroupName(rs.getString(&quot;group_name&quot;));</span>
<span class="nc" id="L831">				priviledgeBean.setIsStart(rs.getString(&quot;is_start&quot;));</span>
<span class="nc" id="L832">				priviledgeBean.setChannel(rs.getString(&quot;channel&quot;));</span>
<span class="nc" id="L833">				priviledgeBean.setPrivCode(rs.getInt(&quot;priv_code&quot;));</span>
<span class="nc" id="L834">				priviledgeBean.setHidden(rs.getString(&quot;hidden&quot;));</span>
<span class="nc" id="L835">				priviledgeBean.setModule(rs.getString(&quot;module&quot;));</span>

<span class="nc" id="L837">				priviledgeMap.put(rs.getString(&quot;priviledge_key&quot;), priviledgeBean);</span>
			}
<span class="nc" id="L839">		} catch (SQLException se) {</span>
<span class="nc" id="L840">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE,LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L841">		} catch (Exception e) {</span>
<span class="nc" id="L842">			throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE,LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L843">		}</span>
<span class="nc" id="L844">	}</span>

	public static void onStartReportMap(Connection connection) throws LMSException {
<span class="nc" id="L847">		reportsMap = new HashMap&lt;String, ReportStatusBean&gt;();</span>

<span class="nc" id="L849">		Statement stmt = null;</span>
<span class="nc" id="L850">		ResultSet rs = null;</span>
<span class="nc" id="L851">		ReportStatusBean reportStatusBean = null;</span>
		try {
<span class="nc" id="L853">			stmt = connection.createStatement();</span>
<span class="nc" id="L854">			rs = stmt.executeQuery(&quot;SELECT CONCAT(serviceName,'#',report_group_name,'#',interfaceType) report_key, report_id, report_group_name, report_disp_name, reporting_from, report_off_start_time, report_off_end_time, serviceName, interfaceType FROM st_lms_reports_status;&quot;);</span>
<span class="nc" id="L855">			logger.info(stmt);</span>
<span class="nc bnc" id="L856" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L857">				reportStatusBean = new ReportStatusBean();</span>
<span class="nc" id="L858">				reportStatusBean.setReportId(rs.getInt(&quot;report_id&quot;));</span>
<span class="nc" id="L859">				reportStatusBean.setReportGroupName(rs.getString(&quot;report_group_name&quot;));</span>
<span class="nc" id="L860">				reportStatusBean.setReportDisplayName(rs.getString(&quot;report_disp_name&quot;));</span>
<span class="nc" id="L861">				reportStatusBean.setReportingFrom(rs.getString(&quot;reporting_from&quot;));</span>
<span class="nc" id="L862">				reportStatusBean.setStartTime(rs.getTime(&quot;report_off_start_time&quot;));</span>
<span class="nc" id="L863">				reportStatusBean.setEndTime(rs.getTime(&quot;report_off_end_time&quot;));</span>
<span class="nc" id="L864">				reportStatusBean.setServiceName(rs.getString(&quot;serviceName&quot;));</span>
<span class="nc" id="L865">				reportStatusBean.setInterfaceType(rs.getString(&quot;interfaceType&quot;));</span>

<span class="nc" id="L867">				reportsMap.put(rs.getString(&quot;report_key&quot;), reportStatusBean);</span>
			}
<span class="nc" id="L869">		} catch (SQLException se) {</span>
<span class="nc" id="L870">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE,LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L871">		} catch (Exception e) {</span>
<span class="nc" id="L872">			throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE,LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L873">		}</span>
<span class="nc" id="L874">	}</span>

	public static void onStartPriviledgeReportMap() {
<span class="nc" id="L877">		Connection connection = null;</span>
		try {
<span class="nc" id="L879">			connection = DBConnect.getConnection();</span>
<span class="nc" id="L880">			onStartPriviledgeMap(connection);</span>
<span class="nc" id="L881">			onStartReportMap(connection);</span>
<span class="nc" id="L882">		} catch (LMSException se) {</span>
<span class="nc" id="L883">			   logger.error(&quot;Exception&quot;,se);</span>
<span class="nc" id="L884">		} catch (Exception e) {</span>
<span class="nc" id="L885">				logger.error(&quot;Exception&quot;,e);</span>
		} finally {
<span class="nc" id="L887">			DBConnect.closeCon(connection);</span>
<span class="nc" id="L888">		}</span>
<span class="nc" id="L889">	}</span>
	
	public static Map&lt;Integer,UserDetailsBean&gt; getRetUserDetailsMap(Connection con,String stateCode,String cityCode,String areaCode,String startDate,String endDate ) throws LMSException{
<span class="nc" id="L892">		PreparedStatement pstmt =null;</span>
<span class="nc" id="L893">		ResultSet rs = null;</span>
<span class="nc" id="L894">		 Map&lt;Integer,UserDetailsBean&gt;  retUsrDetailsMap = new  HashMap&lt;Integer,UserDetailsBean&gt; ();</span>
		try{
<span class="nc" id="L896">			StringBuilder sb = new StringBuilder();</span>
<span class="nc bnc" id="L897" title="All 4 branches missed.">			if(stateCode!=null&amp;&amp;!stateCode.equalsIgnoreCase(&quot;-1&quot;)){</span>
<span class="nc" id="L898">				sb.append(&quot; and sm.state_code='&quot;+stateCode+&quot;' &quot;);</span>
			}
<span class="nc bnc" id="L900" title="All 4 branches missed.">			if(cityCode!=null&amp;&amp;!cityCode.equalsIgnoreCase(&quot;-1&quot;)){</span>
<span class="nc" id="L901">				sb.append(&quot; and cm.city_code='&quot;+cityCode+&quot;' &quot;);</span>
			}
<span class="nc bnc" id="L903" title="All 4 branches missed.">			if(areaCode!=null&amp;&amp;!areaCode.equalsIgnoreCase(&quot;-1&quot;)){</span>
<span class="nc" id="L904">				sb.append(&quot; and am.area_code='&quot;+areaCode+&quot;' &quot;);</span>
			}
<span class="nc bnc" id="L906" title="All 8 branches missed.">			if((startDate!=null&amp;&amp;!startDate.equalsIgnoreCase(&quot;-1&quot;))&amp;&amp;(endDate!=null&amp;&amp;!endDate.equalsIgnoreCase(&quot;-1&quot;))){</span>
<span class="nc" id="L907">				sb.append(&quot; and (um.termination_date is null or (um.termination_date&gt;='&quot;+startDate+&quot;'  or registration_date&gt;='&quot;+endDate+&quot;' ))&quot; ); </span>
				
			}
<span class="nc" id="L910">			pstmt = con.prepareStatement(&quot; select user_id,area_name,city_name,sm.name state,sm.state_code from st_lms_organization_master om inner join st_lms_user_master um on om.organization_id=um.organization_id &quot;+ </span>
                                         &quot; inner join st_lms_city_master cm on cm.city_name=om.city  inner join st_lms_state_master  sm on sm.state_code=om.state_code  inner join st_lms_area_master  am on  am.area_code=om.area_code where   om.organization_type='RETAILER' &quot;+sb.toString()) ; 
<span class="nc" id="L912">			rs=pstmt.executeQuery();</span>
<span class="nc bnc" id="L913" title="All 2 branches missed.">			while(rs.next()){</span>
<span class="nc" id="L914">				UserDetailsBean usrBean =new UserDetailsBean();</span>
<span class="nc" id="L915">				usrBean.setOrgStateCode(rs.getString(&quot;state_code&quot;));</span>
<span class="nc" id="L916">				usrBean.setOrgState(rs.getString(&quot;state&quot;));</span>
<span class="nc" id="L917">				usrBean.setOrgCity(rs.getString(&quot;city_name&quot;));</span>
<span class="nc" id="L918">				usrBean.setOrgAreaName(rs.getString(&quot;area_name&quot;));</span>
<span class="nc" id="L919">				retUsrDetailsMap.put(rs.getInt(&quot;user_id&quot;), usrBean);</span>
<span class="nc" id="L920">			}</span>
			
			
			
<span class="nc" id="L924">		}catch (SQLException e) {</span>
<span class="nc" id="L925">			logger.error(&quot;SQL Exception &quot;, e);</span>
<span class="nc" id="L926">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE,LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L927">		}catch (Exception e) {</span>
<span class="nc" id="L928">			logger.error(&quot; Exception &quot;, e);</span>
<span class="nc" id="L929">			throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE,LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
		}finally{
<span class="nc" id="L931">			DBConnect.closeRs(rs);</span>
<span class="nc" id="L932">			DBConnect.closePstmt(pstmt);</span>
			
<span class="nc" id="L934">		}</span>
<span class="nc" id="L935">		return retUsrDetailsMap;</span>
		
	}

	public static Timestamp getZeroTimeDate(java.util.Date date) {

<span class="nc" id="L941">		Calendar calendar = Calendar.getInstance();</span>
<span class="nc" id="L942">	    calendar.setTime(date);</span>
<span class="nc" id="L943">	    calendar.set(Calendar.HOUR_OF_DAY, 0);</span>
<span class="nc" id="L944">	    calendar.set(Calendar.MINUTE, 0);</span>
<span class="nc" id="L945">	    calendar.set(Calendar.SECOND, 0);</span>
<span class="nc" id="L946">	    calendar.set(Calendar.MILLISECOND, 0);</span>

<span class="nc" id="L948">	    return new Timestamp(calendar.getTime().getTime());</span>
	}

	public static Timestamp getLastTimeDate(java.util.Date date) {

<span class="nc" id="L953">		Calendar calendar = Calendar.getInstance();</span>
<span class="nc" id="L954">	    calendar.setTime(date);</span>
<span class="nc" id="L955">	    calendar.set(Calendar.HOUR_OF_DAY, 23);</span>
<span class="nc" id="L956">	    calendar.set(Calendar.MINUTE, 59);</span>
<span class="nc" id="L957">	    calendar.set(Calendar.SECOND, 59);</span>
<span class="nc" id="L958">	    calendar.set(Calendar.MILLISECOND, 0);</span>

<span class="nc" id="L960">	    return new Timestamp(calendar.getTime().getTime());</span>
	}
	
	public static String getIWGameMapQuery(java.sql.Timestamp fromDate)
			throws LMSException {
<span class="nc" id="L965">		return &quot;select game_id,game_disp_name game_name from st_iw_game_master where game_id not in(select game_id from st_iw_game_master where closing_time &lt;='&quot;</span>
				+ fromDate + &quot;') order by display_order&quot;;
	}

	public static Map&lt;Integer, String&gt; getIWGameMap(java.sql.Timestamp fromDate)
			throws LMSException {
<span class="nc" id="L971">		Map&lt;Integer, String&gt; gameMap = new HashMap&lt;Integer, String&gt;();</span>

<span class="nc" id="L973">		String query = getIWGameMapQuery(fromDate);</span>

<span class="nc" id="L975">		Connection con = null;</span>
<span class="nc" id="L976">		con = DBConnect.getConnection();</span>
<span class="nc" id="L977">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L978">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L980">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L981">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L982">			logger.debug(pstmt);</span>
<span class="nc bnc" id="L983" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L984">				gameMap.put(rs.getInt(&quot;game_id&quot;), rs.getString(&quot;game_name&quot;));</span>
			}
<span class="nc" id="L986">		} catch (SQLException e) {</span>
<span class="nc" id="L987">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L988">			e.printStackTrace();</span>
<span class="nc" id="L989">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L991">			try {</span>
<span class="nc bnc" id="L992" title="All 8 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L993">					con.close();</span>
				}
<span class="nc" id="L995">			} catch (SQLException e) {</span>
<span class="nc" id="L996">				logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L997">				e.printStackTrace();</span>
<span class="nc" id="L998">				throw new LMSException(e);</span>
<span class="nc" id="L999">			}</span>
		}
		
<span class="nc" id="L1002">		return gameMap;</span>
	}
	
	public static String getVSGameMapQuery(java.sql.Timestamp fromDate) throws LMSException {
<span class="nc" id="L1006">		return &quot;select game_id,game_disp_name game_name from st_vs_game_master where game_id not in(select game_id from st_vs_game_master where closing_time &lt;='&quot;</span>
				+ fromDate + &quot;') order by display_order&quot;;
	}

	public static Map&lt;Integer, String&gt; getVSGameMap(java.sql.Timestamp fromDate)
			throws LMSException {
<span class="nc" id="L1012">		Map&lt;Integer, String&gt; gameMap = new HashMap&lt;Integer, String&gt;();</span>

<span class="nc" id="L1014">		String query = getVSGameMapQuery(fromDate);</span>

<span class="nc" id="L1016">		Connection con = null;</span>
<span class="nc" id="L1017">		con = DBConnect.getConnection();</span>
<span class="nc" id="L1018">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1019">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L1021">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L1022">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L1023">			logger.debug(pstmt);</span>
<span class="nc bnc" id="L1024" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1025">				gameMap.put(rs.getInt(&quot;game_id&quot;), rs.getString(&quot;game_name&quot;));</span>
			}
<span class="nc" id="L1027">		} catch (SQLException e) {</span>
<span class="nc" id="L1028">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L1029">			e.printStackTrace();</span>
<span class="nc" id="L1030">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L1032">			try {</span>
<span class="nc bnc" id="L1033" title="All 8 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L1034">					con.close();</span>
				}
<span class="nc" id="L1036">			} catch (SQLException e) {</span>
<span class="nc" id="L1037">				logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L1038">				e.printStackTrace();</span>
<span class="nc" id="L1039">				throw new LMSException(e);</span>
<span class="nc" id="L1040">			}</span>
		}
<span class="nc" id="L1042">		return gameMap;</span>
	}
	
	public static List&lt;ServiceBean&gt; fetchGameServiceWise() throws LMSException {
<span class="nc" id="L1046">		List&lt;ServiceBean&gt; serviceBeans = new ArrayList&lt;ServiceBean&gt;();</span>
<span class="nc" id="L1047">		ServiceBean serviceBean = null;</span>
<span class="nc" id="L1048">		List&lt;GameBean&gt; gameBeans = null;</span>
<span class="nc" id="L1049">		GameBean gameBean = null;</span>
<span class="nc" id="L1050">		Connection con = null;</span>
		
<span class="nc" id="L1052">		Statement stmt = null;</span>
<span class="nc" id="L1053">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L1055">			con = DBConnect.getConnection();</span>

<span class="nc" id="L1057">			stmt = con.createStatement();</span>

<span class="nc" id="L1059">			rs = stmt.executeQuery(&quot;select service_id, service_code, service_display_name from st_lms_service_master where status = 'ACTIVE';&quot;);</span>
<span class="nc bnc" id="L1060" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc bnc" id="L1061" title="All 2 branches missed.">				if(&quot;MGMT&quot;.equals(rs.getString(&quot;service_code&quot;)))</span>
<span class="nc" id="L1062">					continue;</span>
<span class="nc" id="L1063">				serviceBean = new ServiceBean();</span>
<span class="nc" id="L1064">				serviceBean.setServiceId(rs.getInt(&quot;service_id&quot;));</span>
<span class="nc" id="L1065">				serviceBean.setServiceCode(rs.getString(&quot;service_code&quot;));</span>
<span class="nc" id="L1066">				serviceBean.setServiceDisplayName(rs.getString(&quot;service_display_name&quot;));</span>
<span class="nc" id="L1067">				serviceBeans.add(serviceBean);</span>
			}

<span class="nc bnc" id="L1070" title="All 2 branches missed.">			for(ServiceBean bean : serviceBeans) {</span>
<span class="nc bnc" id="L1071" title="All 2 branches missed.">				if (&quot;IW&quot;.equals(bean.getServiceCode())) {</span>
<span class="nc" id="L1072">					gameBeans = new ArrayList&lt;GameBean&gt;();</span>
<span class="nc" id="L1073">					rs = stmt.executeQuery(&quot;select game_id, game_disp_name from st_iw_game_master where game_status = 'SALE_OPEN';&quot;);</span>
<span class="nc bnc" id="L1074" title="All 2 branches missed.">					while(rs.next()) {</span>
<span class="nc" id="L1075">						gameBean = new GameBean();</span>
<span class="nc" id="L1076">						gameBean.setGameId(rs.getInt(&quot;game_id&quot;));</span>
<span class="nc" id="L1077">						gameBean.setGameName(rs.getString(&quot;game_disp_name&quot;));</span>
<span class="nc" id="L1078">						gameBeans.add(gameBean);</span>
					}
<span class="nc" id="L1080">					bean.setGameBeans(gameBeans);</span>
<span class="nc bnc" id="L1081" title="All 2 branches missed.">				} else if (&quot;DG&quot;.equals(bean.getServiceCode())) {</span>
<span class="nc" id="L1082">					gameBeans = new ArrayList&lt;GameBean&gt;();</span>
<span class="nc" id="L1083">					rs = stmt.executeQuery(&quot;select game_id, game_name from st_dg_game_master where game_status = 'OPEN';&quot;);</span>
<span class="nc bnc" id="L1084" title="All 2 branches missed.">					while(rs.next()) {</span>
<span class="nc" id="L1085">						gameBean = new GameBean();</span>
<span class="nc" id="L1086">						gameBean.setGameId(rs.getInt(&quot;game_id&quot;));</span>
<span class="nc" id="L1087">						gameBean.setGameName(rs.getString(&quot;game_name&quot;));</span>
<span class="nc" id="L1088">						gameBeans.add(gameBean);</span>
					}
<span class="nc" id="L1090">					bean.setGameBeans(gameBeans);</span>
				}
<span class="nc" id="L1092">			}</span>
<span class="nc" id="L1093">			System.out.println(&quot;Service Wise Game Bean is &quot; + serviceBeans);</span>
<span class="nc" id="L1094">		} catch (SQLException e) {</span>
<span class="nc" id="L1095">			logger.error(&quot;SQL Exception &quot;, e);</span>
<span class="nc" id="L1096">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE, LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1097">		} catch (Exception e) {</span>
<span class="nc" id="L1098">			logger.error(&quot; Exception &quot;, e);</span>
<span class="nc" id="L1099">			throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE, LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
		} finally {
<span class="nc" id="L1101">			DBConnect.closeCon(con);</span>
<span class="nc" id="L1102">		}</span>
<span class="nc" id="L1103">		return serviceBeans;</span>
	}
	
	public static boolean checkDateLessThanLastRunDate(Object fromDate, int agentOrgId, String orgType, Connection con) {
<span class="nc" id="L1107">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1108">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L1110">			SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-mm-dd&quot;);</span>
<span class="nc" id="L1111">			SimpleDateFormat sdk = new SimpleDateFormat(&quot;dd-mm-yyyy&quot;);</span>
<span class="nc" id="L1112">			java.util.Date startDate = (java.util.Date) sdf.parse(fromDate.toString());</span>
			
<span class="nc" id="L1114">			String subQuery = &quot; &quot;;</span>
			
<span class="nc bnc" id="L1116" title="All 2 branches missed.">			if(&quot;RETAILER&quot;.equals(orgType))</span>
<span class="nc" id="L1117">				subQuery = &quot; and parent_id = &quot; + agentOrgId;</span>
//				subQuery = &quot; and organization_id = &quot; + retOrgId + &quot; and parent_id = &quot; + agentOrgId;

<span class="nc" id="L1120">			pstmt = con.prepareStatement(&quot;select if(finaldate &gt; ?,'TRUE','FALSE') status from st_rep_org_bal_history where organization_type = '&quot; + orgType + &quot;' &quot; + subQuery + &quot; order by finaldate desc limit 1&quot;);</span>
<span class="nc" id="L1121">			pstmt.setString(1, fromDate.toString());</span>
<span class="nc" id="L1122">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1123" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc bnc" id="L1124" title="All 2 branches missed.">				if (&quot;TRUE&quot;.equals(rs.getString(&quot;status&quot;))) {</span>
<span class="nc" id="L1125">					return true;</span>
				}
			} else {
<span class="nc" id="L1128">				pstmt = con.prepareStatement(&quot;select value from st_lms_property_master where property_code='deployment_date'&quot;);</span>
<span class="nc" id="L1129">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1130" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L1131">					java.util.Date dbDate = (java.util.Date) sdk.parse(rs.getString(&quot;value&quot;));</span>
<span class="nc bnc" id="L1132" title="All 2 branches missed.">					if (startDate.before(dbDate)) {</span>
<span class="nc" id="L1133">						return true;</span>
					}
				}
			}
<span class="nc" id="L1137">		} catch (Exception e) {</span>
<span class="nc" id="L1138">			e.printStackTrace();</span>
<span class="nc" id="L1139">		}</span>
<span class="nc" id="L1140">		return false;</span>
	}
	
	public static String fetchLastRunDate(Connection con) {
<span class="nc" id="L1144">		Statement stmt = null;</span>
<span class="nc" id="L1145">		ResultSet rs = null;</span>

<span class="nc" id="L1147">		String lastRunDate = null;</span>

		try {
<span class="nc" id="L1150">			stmt = con.createStatement();</span>

<span class="nc" id="L1152">			rs = stmt.executeQuery(&quot;select max(finaldate) finaldate from st_rep_org_bal_history;&quot;);</span>
<span class="nc bnc" id="L1153" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc bnc" id="L1154" title="All 2 branches missed.">				if(rs.getString(&quot;finaldate&quot;)!=null){</span>
<span class="nc" id="L1155">					lastRunDate = new SimpleDateFormat(&quot;dd-MM-yyyy&quot;).format(new SimpleDateFormat(&quot;yyyy-MM-dd&quot;).parse(rs.getString(&quot;finaldate&quot;)));</span>
				}else {
<span class="nc" id="L1157">					lastRunDate = Utility.getPropertyValue(&quot;DEPLOYMENT_DATE&quot;);</span>
				}
				
			} else {
<span class="nc" id="L1161">				lastRunDate = Utility.getPropertyValue(&quot;DEPLOYMENT_DATE&quot;);</span>
			}
<span class="nc" id="L1163">		} catch (Exception e) {</span>
<span class="nc" id="L1164">			e.printStackTrace();</span>
<span class="nc" id="L1165">		}</span>
<span class="nc" id="L1166">		return lastRunDate;</span>
	}
	
	public static String fetchLastRunDate(String orgType, int agentId, Connection con) {
<span class="nc" id="L1170">		Statement stmt = null;</span>
<span class="nc" id="L1171">		ResultSet rs = null;</span>

<span class="nc" id="L1173">		String lastRunDate = null;</span>
<span class="nc" id="L1174">		String subQuery = &quot; &quot;;</span>

<span class="nc bnc" id="L1176" title="All 2 branches missed.">		if (&quot;RETAILER&quot;.equals(orgType))</span>
<span class="nc" id="L1177">			subQuery = &quot; and parent_id = &quot; + agentId;</span>
		try {
<span class="nc" id="L1179">			stmt = con.createStatement();</span>

<span class="nc" id="L1181">			rs = stmt.executeQuery(&quot;select ifnull(max(finaldate), 'NA') finaldate from st_rep_org_bal_history where organization_type = '&quot; + orgType + &quot;' &quot; + subQuery + &quot;;&quot;);</span>
<span class="nc bnc" id="L1182" title="All 4 branches missed.">			if (rs.next() &amp;&amp; !&quot;NA&quot;.equals(rs.getString(&quot;finaldate&quot;))) {</span>
<span class="nc" id="L1183">				lastRunDate = new SimpleDateFormat(&quot;dd-MM-yyyy&quot;).format(new SimpleDateFormat(&quot;yyyy-MM-dd&quot;).parse(rs.getString(&quot;finaldate&quot;)));</span>
			} else {
<span class="nc" id="L1185">				lastRunDate = Utility.getPropertyValue(&quot;DEPLOYMENT_DATE&quot;);</span>
			}
<span class="nc" id="L1187">		} catch (Exception e) {</span>
<span class="nc" id="L1188">			e.printStackTrace();</span>
<span class="nc" id="L1189">		}</span>
<span class="nc" id="L1190">		return lastRunDate;</span>
	}
	
	public static java.util.Date fetchLastRunDateifExists(Connection con) {
<span class="nc" id="L1194">		Statement stmt = null;</span>
<span class="nc" id="L1195">		ResultSet rs = null;</span>

<span class="nc" id="L1197">		java.util.Date lastRunDate = null;</span>

		try {
<span class="nc" id="L1200">			stmt = con.createStatement();</span>

<span class="nc" id="L1202">			rs = stmt.executeQuery(&quot;select max(finaldate) finaldate from st_rep_org_bal_history;&quot;);</span>
<span class="nc bnc" id="L1203" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L1204">				lastRunDate = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;).parse(rs.getString(&quot;finaldate&quot;));</span>
			}
<span class="nc" id="L1206">		} catch (Exception e) {</span>
<span class="nc" id="L1207">			e.printStackTrace();</span>
<span class="nc" id="L1208">		}</span>
<span class="nc" id="L1209">		return lastRunDate;</span>
	}
	
	public static Map&lt;Integer, Double&gt; fetchClosingBalAgentExcludingCLAndXCl(Connection con, Timestamp timeStamp) {
<span class="nc" id="L1213">		PreparedStatement pStmt = null;</span>
<span class="nc" id="L1214">		ResultSet rs = null;</span>
		
<span class="nc" id="L1216">		Map&lt;Integer, Double&gt; agentClosingBalMap = new HashMap&lt;Integer, Double&gt;();</span>
		
		try {
<span class="nc" id="L1219">			pStmt = con.prepareStatement(&quot;select organization_id, (opening_bal + net_amount_transaction) open_bal from st_rep_org_bal_history where finaldate = ? and organization_type='AGENT'&quot;);</span>
<span class="nc" id="L1220">			pStmt.setTimestamp(1, timeStamp);</span>
			
<span class="nc" id="L1222">			rs = pStmt.executeQuery();</span>
			
<span class="nc bnc" id="L1224" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1225">				agentClosingBalMap.put(rs.getInt(&quot;organization_id&quot;), rs.getDouble(&quot;open_bal&quot;));</span>
			}
<span class="nc" id="L1227">		} catch (Exception e) {</span>
<span class="nc" id="L1228">			e.printStackTrace();</span>
<span class="nc" id="L1229">		}</span>
<span class="nc" id="L1230">		return agentClosingBalMap;</span>
	}
	
	public static void main(String args[]){
<span class="nc" id="L1234">			Connection con = DBConnect.getConnection();</span>
			//checkDateLessThanArchiveDate2(&quot;2014-11-10 23:59:59.0&quot;,con);
<span class="nc" id="L1236">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>