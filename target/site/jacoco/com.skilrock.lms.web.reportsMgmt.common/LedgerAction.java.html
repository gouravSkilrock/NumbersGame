<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LedgerAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.web.reportsMgmt.common</a> &gt; <span class="el_source">LedgerAction.java</span></div><h1>LedgerAction.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.web.reportsMgmt.common;

import java.io.IOException;
import java.io.OutputStream;
import java.io.PrintWriter;
import java.sql.Timestamp;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import javax.servlet.ServletContext;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.struts2.ServletActionContext;
import org.apache.struts2.interceptor.ServletRequestAware;
import org.apache.struts2.interceptor.ServletResponseAware;

import com.opensymphony.xwork2.ActionSupport;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.coreEngine.reportsMgmt.common.GraphReportHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.LedgerHelper;

/**
 * This class is for generation of Agent and Back Office ledger.
 * 
 * @author Skilrock Technologies
 * 
 */
<span class="nc" id="L39">public class LedgerAction extends ActionSupport implements ServletRequestAware,</span>
		ServletResponseAware {

	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	private String accountName;
	private String accountType;
<span class="nc" id="L48">	String addQuery = null;</span>
	private String agentLedger;
	private String agentName;
<span class="nc" id="L51">	String boAddQuery = null;</span>
<span class="nc" id="L52">	Calendar calendar = Calendar.getInstance();</span>
<span class="nc" id="L53">	String consolidatedAcct = null;</span>
<span class="nc" id="L54">	String consolidatedDay = null;</span>
<span class="nc" id="L55">	String consolidatedDetailed = null;</span>
<span class="nc" id="L56">	List consolidatedList = null;</span>
<span class="nc" id="L57">	Date date5 = null;</span>
<span class="nc" id="L58">	SimpleDateFormat dateformat = null;</span>
<span class="nc" id="L59">	Date dateFrDtParse = null;</span>
<span class="nc" id="L60">	Date dateToDtParse = null;</span>
<span class="nc" id="L61">	Timestamp dt = null;</span>
<span class="nc" id="L62">	String file = null;</span>
<span class="nc" id="L63">	String formatString = null;</span>
	private Date frDate;
	private String fromDate;
<span class="nc" id="L66">	Timestamp fromTimeStamp = null;</span>
<span class="nc" id="L67">	GraphReportHelper graphHelper = new GraphReportHelper();</span>
	// LedgerHelper ledgerHelper=new LedgerHelper();
<span class="nc" id="L69">	LedgerHelper ledger = null;</span>

	private String ledgerType;

<span class="nc" id="L73">	Log logger = LogFactory.getLog(LedgerAction.class);</span>
<span class="nc" id="L74">	String orgAdd = null;</span>
<span class="nc" id="L75">	String orgName = null;</span>
<span class="nc" id="L76">	HashMap parameterMap = null;</span>
<span class="nc" id="L77">	byte[] path = null;</span>
<span class="nc" id="L78">	String query = null;</span>
<span class="nc" id="L79">	String rcptType = &quot;&quot;;</span>
	/*
	 * These were the duplicate variable which have been moved to global
	 * variables 07-03-
	 */
	private HttpServletRequest request;
	private HttpServletResponse response;
	private String retailerName;
<span class="nc" id="L87">	String rootPath = null;</span>
	private List selectedGames;
	private List selectGames;
	private String selectMonth;
<span class="nc" id="L91">	HttpSession session = null;</span>
	private String showAgtLedger;
	private Date tDate;
	private String toDate;
	private String type;
<span class="nc" id="L96">	UserInfoBean userBean = null;</span>
<span class="nc" id="L97">	boolean isReceiptWise = true;</span>

	public String adhocUpdateLedger() {
<span class="nc" id="L100">		ServletContext sc = ServletActionContext.getServletContext();</span>
<span class="nc" id="L101">		Boolean isAdhocRunning = (Boolean) sc.getAttribute(&quot;IS_ADHOC_UPDATE&quot;);</span>

<span class="nc bnc" id="L103" title="All 4 branches missed.">		if (isAdhocRunning == null || isAdhocRunning == false) {</span>
<span class="nc" id="L104">			sc.setAttribute(&quot;IS_ADHOC_UPDATE&quot;, true);</span>
<span class="nc" id="L105">			LedgerHelper ledgerHelper = new LedgerHelper();</span>
<span class="nc" id="L106">			request.setAttribute(&quot;code&quot;, &quot;MGMT&quot;);</span>
<span class="nc" id="L107">			request.setAttribute(&quot;interfaceType&quot;, &quot;WEB&quot;);</span>
<span class="nc" id="L108">			ledgerHelper.adhocUpdateClmBal();</span>
<span class="nc" id="L109">			sc.setAttribute(&quot;IS_ADHOC_UPDATE&quot;, false);</span>

		}
<span class="nc" id="L112">		return SUCCESS;</span>
	}

	/**
	 * This method is for entering the data into agent ledger.
	 * 
	 * @return String
	 * @throws Exception
	 */
	public String agentLedger() throws Exception {
<span class="nc" id="L122">		ServletContext sc = ServletActionContext.getServletContext();</span>
<span class="nc" id="L123">		boolean isReceiptWise = Boolean.parseBoolean((String) sc</span>
				.getAttribute(&quot;IS_RECEIPT_WISE&quot;));
<span class="nc bnc" id="L125" title="All 2 branches missed.">		if (isReceiptWise) {</span>
<span class="nc" id="L126">			rcptType = &quot;Rcpt&quot;;</span>
		}
<span class="nc" id="L128">		ledger = new LedgerHelper();</span>
<span class="nc" id="L129">		int userOrgId = 0;</span>
<span class="nc" id="L130">		String backOffName = null;</span>
<span class="nc" id="L131">		parameterMap = new HashMap();</span>
		// Timestamp dt =null;
		// Timestamp fromTimeStamp=
		// Timestamp.valueOf(dateformat.format(getFromDate()));

<span class="nc" id="L136">		session = request.getSession();</span>
		// (String)session.getAttribute(&quot;date_format&quot;);
<span class="nc" id="L138">		formatString = (String) session.getAttribute(&quot;date_format&quot;);</span>

<span class="nc" id="L140">		dateformat = new SimpleDateFormat(formatString);</span>
<span class="nc" id="L141">		dateFrDtParse = dateformat.parse(getFromDate());</span>
<span class="nc" id="L142">		fromTimeStamp = new Timestamp(dateFrDtParse.getTime());</span>
		// LedgerHelper ledger = new LedgerHelper();
<span class="nc" id="L144">		userBean = (UserInfoBean) session.getAttribute(&quot;USER_INFO&quot;);</span>
<span class="nc" id="L145">		String textForTax = (String) ServletActionContext.getServletContext()</span>
				.getAttribute(&quot;TEXT_FOR_TAX&quot;);
<span class="nc bnc" id="L147" title="All 2 branches missed.">		if (getAgentName() == null) {</span>
<span class="nc" id="L148">			userOrgId = userBean.getUserOrgId();</span>
		} else {
<span class="nc" id="L150">			userOrgId = ledger.id(getAgentName());</span>
		}
<span class="nc" id="L152">		logger.debug(&quot;User Org Id&quot; + userOrgId);</span>
		
<span class="nc" id="L154">		logger.debug(&quot;getLedgerType&quot; + getLedgerType() + &quot;getAccountType&quot;</span>
				+ getAccountType() + &quot;getFromDate&quot; + getFromDate());
		
		// DateFormat dateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);
		// Date dt = null;
<span class="nc" id="L159">		logger.debug(&quot;Formatted From Date &quot; + getFromDate());</span>
		
<span class="nc" id="L161">		accountType = getAccountType();</span>
<span class="nc" id="L162">		rootPath = (String) session.getAttribute(&quot;ROOT_PATH&quot;);</span>
<span class="nc" id="L163">		rootPath = rootPath.replace(&quot;\\&quot;, &quot;/&quot;);</span>
<span class="nc" id="L164">		logger.debug(&quot;Formatted From Date &quot; + getFromDate() + &quot;  to date --&quot;</span>
				+ getToDate());
		
<span class="nc bnc" id="L167" title="All 2 branches missed.">		if (accountType != null) {</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">			if (accountType.equals(&quot;AGNT_BANK_ACC&quot;)) {</span>
<span class="nc" id="L169">				accountName = &quot;Bank Receipts &amp; Payments&quot;;</span>

<span class="nc bnc" id="L171" title="All 2 branches missed.">			} else if (accountType.equals(&quot;AGNT_PWT_PAY&quot;)) {</span>
<span class="nc" id="L172">				accountName = &quot;PWT Payable &quot;;</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">			} else if (accountType.equals(&quot;AGNT_PWT_RCV&quot;)) {</span>
<span class="nc" id="L174">				accountName = &quot;PWT Receivable &quot;;</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">			} else if (accountType.equals(&quot;AGNT_SALE_ACC&quot;)) {</span>
<span class="nc" id="L176">				accountName = &quot;Sale&quot;;</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">			} else if (accountType.equals(&quot;AGNT_SALE_RET_ACC&quot;)) {</span>
<span class="nc" id="L178">				accountName = &quot;Sale Return &quot;;</span>
			}

<span class="nc bnc" id="L181" title="All 2 branches missed.">			else if (accountType.equals(&quot;AGNT_PRCHSE_ACC&quot;)) {</span>
<span class="nc" id="L182">				accountName = &quot;Purchase &quot;;</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">			} else if (accountType.equals(&quot;AGNT_PURCHS_RET_ACC&quot;)) {</span>
<span class="nc" id="L184">				accountName = &quot;Purchase Return &quot;;</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">			} else if (accountType.equals(&quot;AGNT_PWT_CHARGES_RCV&quot;)) {</span>
<span class="nc" id="L186">				accountName = &quot;PWT Charges Receivable&quot;;</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">			} else if (accountType.equals(&quot;AGENT_PWT_CHARGES&quot;)) {</span>
<span class="nc" id="L188">				accountName = &quot;PWT Collection Charges &quot;;</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">			} else if (accountType.equals(&quot;AGENT_VAT_PAY&quot;)) {</span>
<span class="nc" id="L190">				accountName = &quot;VAT Payable &quot;;</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">			} else if (accountType.equals(&quot;AGNT_PLAYER_CAS&quot;)) {</span>
<span class="nc" id="L192">				accountName = &quot;Player Cash &quot;;</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">			} else if (accountType.equals(&quot;AGNT_PLAYER_PWT&quot;)) {</span>
<span class="nc" id="L194">				accountName = &quot;Player PWT &quot;;</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">			} else if (accountType.equals(&quot;AGNT_PLAYER_TDS&quot;)) {</span>
<span class="nc" id="L196">				accountName = &quot;Player &quot; + textForTax;</span>
			}

		}
<span class="nc" id="L200">		addQuery = QueryManager.getST6AddressQuery();</span>
<span class="nc" id="L201">		orgAdd = ledger.getAddress(addQuery, &quot;&quot; + userOrgId, null);</span>

<span class="nc" id="L203">		orgName = userBean.getOrgName();</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">		if (getAgentName() != null) {</span>
<span class="nc" id="L205">			orgName = getAgentName();</span>
<span class="nc" id="L206">			parameterMap.put(&quot;agtLgrAtBo&quot;, &quot;To Be Viewed At Back Office &quot;);</span>

		}
<span class="nc" id="L209">		parameterMap.put(&quot;agentComp&quot;, getAgentName());</span>
<span class="nc" id="L210">		logger.debug(&quot;getAgentName******&quot; + getAgentName());</span>

<span class="nc bnc" id="L212" title="All 2 branches missed.">		if (!getToDate().equals(&quot;&quot;)) {</span>
<span class="nc" id="L213">			dateToDtParse = dateformat.parse(getToDate());</span>
<span class="nc" id="L214">			dt = new Timestamp(dateToDtParse.getTime() + 1000 * 60 * 60 * 24l);</span>
			
		} else {
<span class="nc" id="L217">			date5 = new Date();</span>
<span class="nc" id="L218">			dt = new Timestamp(date5.getTime());</span>
<span class="nc" id="L219">			toDate = dateformat.format(new Date());</span>
		}
<span class="nc" id="L221">		logger.debug(dt);</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">		if (!ledgerType.equalsIgnoreCase(&quot;Retailer Self&quot;)) {</span>
<span class="nc" id="L223">			ledger.ledgerAgentEntry(dt, userOrgId);</span>
		}
<span class="nc" id="L225">		frDate = dateformat.parse(fromDate);</span>
<span class="nc" id="L226">		tDate = dateformat.parse(toDate);</span>
<span class="nc" id="L227">		parameterMap.put(&quot;orgName&quot;, orgName);</span>
<span class="nc" id="L228">		parameterMap.put(&quot;orgAdd&quot;, orgAdd);</span>
<span class="nc" id="L229">		parameterMap.put(&quot;from_date&quot;, frDate);</span>
<span class="nc" id="L230">		parameterMap.put(&quot;to_date&quot;, tDate);</span>
<span class="nc" id="L231">		parameterMap.put(&quot;formatString&quot;, formatString);</span>
<span class="nc" id="L232">		logger.debug(&quot;FROM DATE   &quot; + fromDate + &quot; and TO DATE   &quot; + toDate);</span>
<span class="nc bnc" id="L233" title="All 2 branches missed.">		if (ledgerType.equalsIgnoreCase(&quot;Accountwise&quot;)) {</span>
<span class="nc" id="L234">			backOffName = ledger.getParentOrgName(userOrgId);</span>
<span class="nc" id="L235">			query = QueryManager.getST6AccountWiseLedgerAgt();</span>
<span class="nc" id="L236">			parameterMap.put(&quot;type&quot;, &quot;Accountwise&quot;);</span>
<span class="nc" id="L237">			parameterMap.put(&quot;bo&quot;, accountName);</span>
<span class="nc" id="L238">			parameterMap.put(&quot;backOffName&quot;, backOffName);</span>
<span class="nc" id="L239">			logger.debug(query</span>
					+ &quot;  Account wise *****************  Agent ledger&quot;);
<span class="nc" id="L241">			logger.debug(&quot;accountType &quot; + accountType + &quot; fromTimeStamp &quot;</span>
					+ fromTimeStamp + &quot; dt &quot; + dt + &quot; userId &quot; + userOrgId);
<span class="nc" id="L243">			file = rootPath</span>
					+ &quot;com/skilrock/lms/web/reportsMgmt/compiledReports/agentLedgerAccountWise.jasper&quot;;
<span class="nc" id="L245">			path = graphHelper.generateReport(query, file, parameterMap,</span>
					accountType, fromTimeStamp, dt, &quot;&quot; + userOrgId);
<span class="nc bnc" id="L247" title="All 2 branches missed.">		} else if (ledgerType.equalsIgnoreCase(&quot;RetailerWise&quot;)) {</span>
<span class="nc" id="L248">			parameterMap.put(&quot;type&quot;, &quot;Retailerwise&quot;);</span>
<span class="nc" id="L249">			parameterMap.put(&quot;bo&quot;, getRetailerName());</span>
<span class="nc" id="L250">			query = QueryManager.getST6RetWiseLedgerAgt(isReceiptWise);</span>
<span class="nc" id="L251">			logger.debug(query</span>
					+ &quot;  Retailer wise *****************  Agent ledger&quot;);
<span class="nc" id="L253">			logger.debug(&quot;accountType &quot; + accountType + &quot; fromTimeStamp &quot;</span>
					+ fromTimeStamp + &quot; dt &quot; + dt + &quot; userId &quot; + userOrgId);
<span class="nc" id="L255">			file = rootPath</span>
					+ &quot;com/skilrock/lms/web/reportsMgmt/compiledReports/agentLedgerRetWise&quot;
					+ rcptType + &quot;.jasper&quot;;
<span class="nc" id="L258">			path = graphHelper.generateReport(query, file, parameterMap,</span>
					getRetailerName(), fromTimeStamp, dt, null);
		}

<span class="nc bnc" id="L262" title="All 2 branches missed.">		else if (ledgerType.equalsIgnoreCase(&quot;All&quot;)) {</span>
<span class="nc" id="L263">			parameterMap.put(&quot;type&quot;, &quot;Journal&quot;);</span>
<span class="nc" id="L264">			query = QueryManager.getST6JournalLedgerAgt();</span>
<span class="nc" id="L265">			logger.debug(query + &quot;  All *****************  Agent ledger&quot;);</span>
<span class="nc" id="L266">			logger.debug(&quot;accountType &quot; + accountType + &quot; fromTimeStamp &quot;</span>
					+ fromTimeStamp + &quot; dt &quot; + dt + &quot; userId &quot; + userOrgId);
<span class="nc" id="L268">			file = rootPath</span>
					+ &quot;com/skilrock/lms/web/reportsMgmt/compiledReports/agentledgernew.jasper&quot;;
<span class="nc" id="L270">			path = graphHelper.generateReport(query, file, parameterMap, null,</span>
					fromTimeStamp, dt, &quot;&quot; + userOrgId);
<span class="nc bnc" id="L272" title="All 2 branches missed.">		} else if (ledgerType.equalsIgnoreCase(&quot;Agent Self&quot;)) {</span>
<span class="nc" id="L273">			boLedger();</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">		} else if (ledgerType.equalsIgnoreCase(&quot;Retailer Self&quot;)) {</span>
<span class="nc" id="L275">			String retOrgName = orgName;</span>
<span class="nc" id="L276">			parameterMap.put(&quot;bo&quot;, retOrgName);</span>
<span class="nc" id="L277">			String agtAddressQuery = &quot;select addr_line1,addr_line2,city,st_lms_state_master.name,st_lms_country_master.name from st_lms_organization_master,st_lms_state_master,st_lms_country_master where st_lms_organization_master.organization_id= (select parent_id from st_lms_organization_master where organization_id=?)and st_lms_organization_master.country_code=st_lms_country_master.country_code and  st_lms_organization_master.state_code=st_lms_state_master.state_code &quot;;</span>
<span class="nc" id="L278">			orgAdd = ledger.getAddress(agtAddressQuery, userOrgId + &quot;&quot;, null);</span>
<span class="nc" id="L279">			String agtOrgName = ledger.getParentOrgName(userOrgId);</span>
<span class="nc" id="L280">			int parentOrgId = ledger.getParentOrgId(userOrgId);</span>
<span class="nc" id="L281">			ledger.ledgerAgentEntry(dt, parentOrgId);</span>
<span class="nc" id="L282">			logger.debug(&quot;Retailer Self ++++++++ &quot; + orgAdd + &quot; agtOrgName &quot;</span>
					+ agtOrgName + &quot; parentOrgId &quot; + parentOrgId);
<span class="nc" id="L284">			parameterMap.put(&quot;orgAdd&quot;, orgAdd);</span>
<span class="nc" id="L285">			parameterMap.put(&quot;orgName&quot;, agtOrgName);</span>
<span class="nc" id="L286">			query = QueryManager.getST6RetWiseLedgerAgt(isReceiptWise);</span>
<span class="nc" id="L287">			logger.debug(query</span>
					+ &quot;  Retailer wise *****************  Agent ledger&quot;);
<span class="nc" id="L289">			logger.debug(&quot;accountType &quot; + accountType + &quot; fromTimeStamp &quot;</span>
					+ fromTimeStamp + &quot; dt &quot; + dt + &quot; userId &quot; + userOrgId);
<span class="nc" id="L291">			file = rootPath</span>
					+ &quot;com/skilrock/lms/web/reportsMgmt/compiledReports/agentLedgerRetWise&quot;
					+ rcptType + &quot;.jasper&quot;;
<span class="nc" id="L294">			path = graphHelper.generateReport(query, file, parameterMap,</span>
					retOrgName, fromTimeStamp, dt, null);
<span class="nc bnc" id="L296" title="All 2 branches missed.">		} else if (ledgerType.equalsIgnoreCase(&quot;consolidated&quot;)) {</span>
<span class="nc" id="L297">			consolidatedList = new ArrayList();</span>
<span class="nc" id="L298">			consolidatedList.add(frDate);// 1</span>
<span class="nc" id="L299">			consolidatedList.add(tDate);// 2</span>
<span class="nc" id="L300">			consolidatedList.add(orgName);// 3</span>
<span class="nc" id="L301">			consolidatedList.add(formatString);// 4</span>

<span class="nc" id="L303">			query = QueryManager.getST6RetWiseLedgerAgt(isReceiptWise);</span>
<span class="nc" id="L304">			logger.debug(&quot; Agent Ret Wise Query&quot; + query);</span>
<span class="nc" id="L305">			logger.debug(&quot;accountType &quot; + accountType + &quot; fromTimeStamp &quot;</span>
					+ fromTimeStamp + &quot; dt &quot; + dt);
<span class="nc" id="L307">			consolidatedList = graphHelper.generateConsolidatedReportAgt(query,</span>
					consolidatedList, getRetailerName(), fromTimeStamp, dt);
<span class="nc" id="L309">			consolidatedList.add(getRetailerName()); // 13 15</span>
<span class="nc" id="L310">			session.setAttribute(&quot;CONSOLIDATED_LED_LIST&quot;, consolidatedList);</span>
<span class="nc" id="L311">			return &quot;consolidated&quot;;</span>
		}
<span class="nc" id="L313">		logger.debug(&quot;In Agent Ledger&quot;);</span>
<span class="nc" id="L314">		return generatePDF(path);</span>

	}

	/**
	 * This method is used for fetching data for ajax request from agent ledger
	 * page
	 * 
	 * @throws Exception
	 */

	public void agentLedgerAjax() throws Exception {
<span class="nc" id="L326">		LedgerHelper ledgerHelper = new LedgerHelper();</span>
<span class="nc" id="L327">		PrintWriter out = getResponse().getWriter();</span>
<span class="nc" id="L328">		String ledger = getLedgerType();</span>
<span class="nc" id="L329">		HttpSession session = request.getSession();</span>
<span class="nc" id="L330">		UserInfoBean userBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L332">		String textForTax = (String) ServletActionContext.getServletContext()</span>
				.getAttribute(&quot;TEXT_FOR_TAX&quot;);
<span class="nc" id="L334">		String vat = (String) ServletActionContext.getServletContext()</span>
				.getAttribute(&quot;VAT_APPLICABLE&quot;);

<span class="nc" id="L337">		int id = 0;</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">		if (getAgentName() == null) {</span>
<span class="nc" id="L339">			id = userBean.getUserOrgId();</span>
		} else {
<span class="nc" id="L341">			id = ledgerHelper.id(getAgentName());</span>
		}
<span class="nc" id="L343">		logger.debug(&quot;Agent Name is ----&quot; + getAgentName());</span>
<span class="nc" id="L344">		ArrayList selectedList = ledgerHelper.getList(ledger, &quot;agent&quot;, id);</span>
<span class="nc" id="L345">		logger.debug(&quot;Ledger agent ajax&quot; + selectedList);</span>
<span class="nc" id="L346">		String html = &quot;&quot;;</span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">		if (ledgerType.equals(&quot;Accountwise&quot;)) {</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">			if (vat.trim().equalsIgnoreCase(&quot;yes&quot;)) {</span>
<span class="nc" id="L349">				html = &quot;Select Account: &lt;select class=\&quot;option\&quot; name=\&quot;accountType\&quot;&gt;&lt;OPTION VALUE=-1&gt;--Please Select--&lt;OPTION VALUE=\&quot;AGNT_BANK_ACC\&quot;&gt;Bank Receipts &amp; Payments Account&lt;OPTION VALUE=\&quot;AGNT_PLAYER_CAS\&quot;&gt;Net Paid PWT To Player&lt;OPTION VALUE=\&quot;AGNT_PLAYER_PWT\&quot;&gt;Player PWT	&lt;OPTION VALUE=\&quot;AGNT_PLAYER_TDS\&quot;&gt;Player &quot;</span>
						+ textForTax
						+ &quot;&lt;OPTION VALUE=\&quot;AGNT_PWT_PAY\&quot;&gt;PWT Payable&lt;OPTION VALUE=\&quot;AGNT_PWT_RCV\&quot;&gt;PWT Receivable&lt;OPTION VALUE=\&quot;AGNT_SALE_ACC\&quot;&gt;Sale Account&lt;OPTION class=\&quot;option\&quot; VALUE=\&quot;AGNT_SALE_RET_ACC\&quot;&gt;Sale Return Account	&lt;OPTION class=\&quot;option\&quot; VALUE=\&quot;AGNT_PWT_CHARGES_RCV\&quot;&gt;PWT Charges Receivable&lt;OPTION class=\&quot;option\&quot; VALUE=\&quot;AGENT_PWT_CHARGES\&quot;&gt;PWT Collection Charges&lt;OPTION VALUE=\&quot;AGENT_VAT_PAY\&quot;&gt;VAT Payable&lt;OPTION class=\&quot;option\&quot; VALUE=\&quot;AGNT_PRCHSE_ACC\&quot;&gt;Purchase&lt;OPTION class=\&quot;option\&quot; VALUE=\&quot;AGNT_PURCHS_RET_ACC\&quot;&gt;Purchase Return&lt;/SELECT&gt;&quot;;
			} else {
<span class="nc" id="L353">				html = &quot;Select Account: &lt;select class=\&quot;option\&quot; name=\&quot;accountType\&quot;&gt;&lt;OPTION VALUE=-1&gt;--Please Select--&lt;OPTION VALUE=\&quot;AGNT_BANK_ACC\&quot;&gt;Bank Receipts &amp; Payments Account&lt;OPTION VALUE=\&quot;AGNT_PLAYER_CAS\&quot;&gt;Net Paid PWT To Player&lt;OPTION VALUE=\&quot;AGNT_PLAYER_PWT\&quot;&gt;Player PWT	&lt;OPTION VALUE=\&quot;AGNT_PLAYER_TDS\&quot;&gt;Player &quot;</span>
						+ textForTax
						+ &quot;&lt;OPTION VALUE=\&quot;AGNT_PWT_PAY\&quot;&gt;PWT Payable&lt;OPTION VALUE=\&quot;AGNT_PWT_RCV\&quot;&gt;PWT Receivable&lt;OPTION VALUE=\&quot;AGNT_SALE_ACC\&quot;&gt;Sale Account&lt;OPTION class=\&quot;option\&quot; VALUE=\&quot;AGNT_SALE_RET_ACC\&quot;&gt;Sale Return Account	&lt;OPTION class=\&quot;option\&quot; VALUE=\&quot;AGNT_PWT_CHARGES_RCV\&quot;&gt;PWT Charges Receivable&lt;OPTION class=\&quot;option\&quot; VALUE=\&quot;AGENT_PWT_CHARGES\&quot;&gt;PWT Collection Charges&lt;OPTION class=\&quot;option\&quot; VALUE=\&quot;AGNT_PRCHSE_ACC\&quot;&gt;Purchase&lt;OPTION class=\&quot;option\&quot; VALUE=\&quot;AGNT_PURCHS_RET_ACC\&quot;&gt;Purchase Return&lt;/SELECT&gt;&quot;;
			}
<span class="nc" id="L357">			logger.debug(&quot;htmlllllllllllll&quot; + html);</span>
<span class="nc bnc" id="L358" title="All 4 branches missed.">		} else if (ledgerType.equals(&quot;Retailerwise&quot;)</span>
				|| ledgerType.equals(&quot;consolidated&quot;)) {
<span class="nc" id="L360">			html = &quot;Select &quot;</span>
					+ ((Map&lt;String, String&gt;) ServletActionContext
							.getServletContext().getAttribute(&quot;TIER_MAP&quot;))
							.get(&quot;RETAILER&quot;)
					+ &quot;: &lt;select class=\&quot;option\&quot; name=\&quot;retailerName\&quot;&gt;&lt;OPTION VALUE=-1&gt;--Please Select--&quot;;
<span class="nc" id="L365">			int i = 0;</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">			for (Iterator it = selectedList.iterator(); it.hasNext();) {</span>
<span class="nc" id="L367">				String name = (String) it.next();</span>
<span class="nc" id="L368">				i++;</span>
<span class="nc" id="L369">				html += &quot;&lt;option class=\&quot;option\&quot; value=\&quot;&quot; + name + &quot;\&quot;&gt;&quot;</span>
						+ name + &quot;&lt;/option&gt;&quot;;
<span class="nc" id="L371">			}</span>
<span class="nc" id="L372">			html += &quot;&lt;/select&gt;&quot;;</span>
		}
<span class="nc" id="L374">		response.setContentType(&quot;text/html&quot;);</span>

<span class="nc" id="L376">		out.print(html);</span>
<span class="nc" id="L377">	}</span>

	/**
	 * This method is for entering the data into back office ledger.
	 * 
	 * @return String
	 * @throws Exception
	 */

	public String boLedger() throws Exception {
<span class="nc" id="L387">		ServletContext sc = ServletActionContext.getServletContext();</span>
<span class="nc" id="L388">		boolean isReceiptWise = Boolean.parseBoolean((String) sc</span>
				.getAttribute(&quot;IS_RECEIPT_WISE&quot;));
<span class="nc bnc" id="L390" title="All 2 branches missed.">		if (isReceiptWise) {</span>
<span class="nc" id="L391">			rcptType = &quot;Rcpt&quot;;</span>
		}
<span class="nc" id="L393">		parameterMap = new HashMap();</span>
<span class="nc" id="L394">		logger.info(&quot;Inside boLedger&quot;);</span>
<span class="nc" id="L395">		ledger = new LedgerHelper();</span>
<span class="nc" id="L396">		session = request.getSession();</span>
<span class="nc" id="L397">		formatString = (String) session.getAttribute(&quot;date_format&quot;);</span>
<span class="nc" id="L398">		dateformat = new SimpleDateFormat(formatString);</span>
<span class="nc" id="L399">		userBean = (UserInfoBean) session.getAttribute(&quot;USER_INFO&quot;);</span>
<span class="nc" id="L400">		String textForTax = (String) ServletActionContext.getServletContext()</span>
				.getAttribute(&quot;TEXT_FOR_TAX&quot;);
<span class="nc" id="L402">		int id = userBean.getUserOrgId();</span>
<span class="nc" id="L403">		addQuery = QueryManager.getST6AddressQuery();</span>
<span class="nc" id="L404">		orgAdd = ledger.getAddress(addQuery, &quot;&quot; + id, null);</span>
<span class="nc" id="L405">		orgName = userBean.getOrgName();</span>

<span class="nc" id="L407">		logger.debug(&quot;Ledger Type---&gt;&quot; + getLedgerType()</span>
				+ &quot; Account Type-----&gt;&quot; + getAccountType() + &quot;Agent Name--&quot;
				+ getAgentName());
<span class="nc" id="L410">		logger.debug(&quot;From Date---&gt;&quot; + getFromDate() + &quot;  To Date ---&gt;&quot;</span>
				+ getToDate());
<span class="nc" id="L412">		dateFrDtParse = dateformat.parse(getFromDate());</span>
<span class="nc" id="L413">		fromTimeStamp = new Timestamp(dateFrDtParse.getTime());</span>
<span class="nc" id="L414">		logger.debug(&quot;Formatted From Date &quot; + getFromDate() + &quot;  to date --&quot;</span>
				+ getToDate());
<span class="nc" id="L416">		accountType = getAccountType();</span>
<span class="nc bnc" id="L417" title="All 2 branches missed.">		if (accountType != null) {</span>
<span class="nc bnc" id="L418" title="All 2 branches missed.">			if (accountType.equals(&quot;BANK_ACC&quot;)) {</span>
<span class="nc" id="L419">				accountName = &quot;Bank Receipts &amp; Payments&quot;;</span>

<span class="nc bnc" id="L421" title="All 2 branches missed.">			} else if (accountType.equals(&quot;SALE_ACC&quot;)) {</span>
<span class="nc" id="L422">				accountName = &quot;Sale&quot;;</span>
<span class="nc bnc" id="L423" title="All 2 branches missed.">			} else if (accountType.equals(&quot;SALE_RET&quot;)) {</span>
<span class="nc" id="L424">				accountName = &quot;Sale Return &quot;;</span>
<span class="nc bnc" id="L425" title="All 2 branches missed.">			} else if (accountType.equals(&quot;PLAYER_CAS&quot;)) {</span>
<span class="nc" id="L426">				accountName = &quot;Player Cash &quot;;</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">			} else if (accountType.equals(&quot;PLAYER_PWT&quot;)) {</span>
<span class="nc" id="L428">				accountName = &quot;Player PWT &quot;;</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">			} else if (accountType.equals(&quot;PLAYER_TDS&quot;)) {</span>
<span class="nc" id="L430">				accountName = &quot;Player &quot; + textForTax;</span>
<span class="nc bnc" id="L431" title="All 2 branches missed.">			} else if (accountType.equals(&quot;PWT_PAY&quot;)) {</span>
<span class="nc" id="L432">				accountName = &quot;PWT Payable &quot;;</span>
<span class="nc bnc" id="L433" title="All 2 branches missed.">			} else if (accountType.equals(&quot;TDS_PAY&quot;)) {</span>
<span class="nc" id="L434">				accountName = textForTax + &quot; Payable &quot;;</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">			} else if (accountType.equals(&quot;UNCLM_GOVT&quot;)) {</span>
<span class="nc" id="L436">				accountName = &quot;Unclaimed to Government &quot;;</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">			} else if (accountType.equals(&quot;GOVT_COMM&quot;)) {</span>
<span class="nc" id="L438">				accountName = &quot;Good Cause &quot;;</span>
<span class="nc bnc" id="L439" title="All 2 branches missed.">			} else if (accountType.equals(&quot;VAT_PAY&quot;)) {</span>
<span class="nc" id="L440">				accountName = &quot;VAT Payable &quot;;</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">			} else if (accountType.equals(&quot;PWT_CHARGES&quot;)) {</span>
<span class="nc" id="L442">				accountName = &quot;PWT Collection Charges &quot;;</span>
			}

		}

<span class="nc bnc" id="L447" title="All 2 branches missed.">		if (!getToDate().equals(&quot;&quot;)) {</span>
<span class="nc" id="L448">			dateToDtParse = dateformat.parse(getToDate());</span>
<span class="nc" id="L449">			calendar.setTime(dateToDtParse);</span>
<span class="nc" id="L450">			calendar.add(Calendar.DAY_OF_MONTH, 1);</span>
<span class="nc" id="L451">			dateToDtParse = calendar.getTime();</span>
<span class="nc" id="L452">			dt = new Timestamp(dateToDtParse.getTime());</span>
<span class="nc" id="L453">			logger.debug(&quot;To date&quot; + dt);</span>

		} else {

<span class="nc" id="L457">			Calendar calendar2 = Calendar.getInstance();</span>

<span class="nc" id="L459">			calendar</span>
					.set(calendar2.get(Calendar.YEAR), calendar2
							.get(Calendar.MONTH), calendar2.get(Calendar.DATE),
							0, 0, 0);

<span class="nc" id="L464">			calendar.add(Calendar.DAY_OF_MONTH, 1);</span>

<span class="nc" id="L466">			date5 = calendar.getTime();</span>

<span class="nc" id="L468">			dt = new Timestamp(date5.getTime());</span>
<span class="nc" id="L469">			logger.debug(dt + &quot;TOOOOOOOOOOOOO DATEEEEEEEE 111111111#####&quot;);</span>
<span class="nc" id="L470">			toDate = dateformat.format(new Date());</span>
		}
<span class="nc" id="L472">		ledger.ledgerBoEntry(dt);</span>
<span class="nc" id="L473">		frDate = dateformat.parse(fromDate);</span>
<span class="nc" id="L474">		tDate = dateformat.parse(toDate);</span>
<span class="nc" id="L475">		parameterMap.put(&quot;from_date&quot;, frDate);</span>
<span class="nc" id="L476">		parameterMap.put(&quot;to_date&quot;, tDate);</span>
<span class="nc" id="L477">		parameterMap.put(&quot;orgName&quot;, orgName);</span>
<span class="nc" id="L478">		parameterMap.put(&quot;orgAdd&quot;, orgAdd);</span>
<span class="nc" id="L479">		parameterMap.put(&quot;formatString&quot;, formatString);</span>

<span class="nc" id="L481">		rootPath = (String) session.getAttribute(&quot;ROOT_PATH&quot;);</span>

<span class="nc" id="L483">		rootPath = rootPath.replace(&quot;\\&quot;, &quot;/&quot;);</span>
<span class="nc" id="L484">		logger.debug(&quot;FROM DATE   &quot; + fromDate + &quot; and TO DATE   &quot; + toDate);</span>
<span class="nc bnc" id="L485" title="All 2 branches missed.">		if (ledgerType.equalsIgnoreCase(&quot;Accountwise&quot;)) {</span>
<span class="nc" id="L486">			parameterMap.put(&quot;type&quot;, &quot;Accountwise&quot;);</span>
<span class="nc" id="L487">			parameterMap.put(&quot;bo&quot;, accountName);</span>
<span class="nc" id="L488">			query = QueryManager.getST6AccountWiseLedgerBO();</span>
<span class="nc" id="L489">			logger.debug(&quot;Bo Account Wise Query&quot; + query);</span>
<span class="nc" id="L490">			logger.debug(&quot;accountType &quot; + accountType + &quot; fromTimeStamp &quot;</span>
					+ fromTimeStamp + &quot; dt &quot; + dt);
<span class="nc" id="L492">			file = rootPath</span>
					+ &quot;com/skilrock/lms/web/reportsMgmt/compiledReports/boLedgerAccountWise.jasper&quot;;
<span class="nc" id="L494">			path = graphHelper.generateReport(query, file, parameterMap,</span>
					accountType, fromTimeStamp, dt, null);
<span class="nc bnc" id="L496" title="All 2 branches missed.">		} else if (ledgerType.equalsIgnoreCase(&quot;Agentwise&quot;)) {</span>
<span class="nc" id="L497">			logger.debug(&quot;agtwise++++++++&quot; + orgAdd);</span>
<span class="nc" id="L498">			parameterMap.put(&quot;type&quot;, &quot;Agentwise&quot;);</span>
<span class="nc" id="L499">			parameterMap.put(&quot;bo&quot;, getAgentName());</span>
<span class="nc" id="L500">			parameterMap.put(&quot;orgName&quot;, orgName);</span>
<span class="nc" id="L501">			query = QueryManager.getST6AgentWiseLedgerBO(isReceiptWise);</span>
<span class="nc" id="L502">			logger.debug(&quot;Bo Agent Wise Query&quot; + query);</span>
<span class="nc" id="L503">			logger.debug(&quot;accountType &quot; + accountType + &quot; fromTimeStamp &quot;</span>
					+ fromTimeStamp + &quot; dt &quot; + dt);
<span class="nc" id="L505">			file = rootPath</span>
					+ &quot;com/skilrock/lms/web/reportsMgmt/compiledReports/boLedgerAgentWise&quot;
					+ rcptType + &quot;.jasper&quot;;
<span class="nc" id="L508">			path = graphHelper.generateReport(query, file, parameterMap,</span>
					getAgentName(), fromTimeStamp, dt, null);
		}

<span class="nc bnc" id="L512" title="All 2 branches missed.">		else if (ledgerType.equalsIgnoreCase(&quot;All&quot;)) {</span>
<span class="nc" id="L513">			parameterMap.put(&quot;type&quot;, &quot;Journal&quot;);</span>
<span class="nc" id="L514">			query = QueryManager.getST6JournalLedgerBO();</span>
<span class="nc" id="L515">			logger.debug(&quot;Bo All Query&quot; + query);</span>
<span class="nc" id="L516">			logger.debug(&quot;accountType &quot; + accountType + &quot; fromTimeStamp &quot;</span>
					+ fromTimeStamp + &quot; dt &quot; + dt);
<span class="nc" id="L518">			file = rootPath</span>
					+ &quot;com/skilrock/lms/web/reportsMgmt/compiledReports/ledger.jasper&quot;;
<span class="nc" id="L520">			path = graphHelper.generateReport(query, file, parameterMap, null,</span>
					fromTimeStamp, dt, null);
<span class="nc bnc" id="L522" title="All 2 branches missed.">		} else if (ledgerType.equalsIgnoreCase(&quot;Agent Self&quot;)) {</span>

<span class="nc" id="L524">			boAddQuery = &quot;select addr_line1,addr_line2,city,st_lms_state_master.name,st_lms_country_master.name from st_lms_organization_master,st_lms_state_master,st_lms_country_master where st_lms_organization_master.organization_id= (select parent_id from st_lms_organization_master where organization_id=?)and st_lms_organization_master.country_code=st_lms_country_master.country_code and  st_lms_organization_master.state_code=st_lms_state_master.state_code &quot;;</span>
<span class="nc" id="L525">			orgAdd = ledger.getAddress(boAddQuery, id + &quot;&quot;, null);</span>
<span class="nc" id="L526">			String backOffName = ledger.getParentOrgName(id);</span>
<span class="nc" id="L527">			logger.debug(&quot;agtwise++++++++&quot; + orgAdd);</span>
<span class="nc" id="L528">			parameterMap.put(&quot;orgAdd&quot;, orgAdd);</span>
<span class="nc" id="L529">			parameterMap.put(&quot;bo&quot;, orgName);</span>
<span class="nc" id="L530">			parameterMap.put(&quot;orgName&quot;, backOffName);</span>
<span class="nc" id="L531">			query = QueryManager.getST6AgentWiseLedgerBO(isReceiptWise);</span>
<span class="nc" id="L532">			logger.debug(&quot;Bo Agent Wise Query&quot; + query);</span>
<span class="nc" id="L533">			logger.debug(&quot;accountType &quot; + accountType + &quot; fromTimeStamp &quot;</span>
					+ fromTimeStamp + &quot; dt &quot; + dt);
<span class="nc" id="L535">			file = rootPath</span>
					+ &quot;com/skilrock/lms/web/reportsMgmt/compiledReports/boLedgerAgentWise&quot;
					+ rcptType + &quot;.jasper&quot;;
<span class="nc" id="L538">			path = graphHelper.generateReport(query, file, parameterMap,</span>
					orgName, fromTimeStamp, dt, null);
<span class="nc" id="L540">		}</span>

<span class="nc bnc" id="L542" title="All 2 branches missed.">		else if (ledgerType.equalsIgnoreCase(&quot;consolidated&quot;)) {</span>
<span class="nc" id="L543">			consolidatedList = new ArrayList();</span>
<span class="nc" id="L544">			logger.debug(&quot;agtwise++++++++&quot; + orgAdd);</span>
<span class="nc" id="L545">			consolidatedList.add(frDate);// 1</span>
<span class="nc" id="L546">			consolidatedList.add(tDate);// 2</span>
<span class="nc" id="L547">			consolidatedList.add(orgName);// 3</span>
<span class="nc" id="L548">			consolidatedList.add(formatString);// 4</span>

<span class="nc" id="L550">			query = QueryManager.getST6AgentWiseLedgerBO(isReceiptWise);</span>
<span class="nc" id="L551">			logger.debug(&quot;Bo Agent Wise Query&quot; + query);</span>
<span class="nc" id="L552">			logger.debug(&quot;accountType &quot; + accountType + &quot; fromTimeStamp &quot;</span>
					+ fromTimeStamp + &quot; dt &quot; + dt);
<span class="nc" id="L554">			consolidatedList = graphHelper.generateConsolidatedReport(query,</span>
					consolidatedList, getAgentName(), fromTimeStamp, dt);
<span class="nc" id="L556">			consolidatedList.add(getAgentName()); // 13 15</span>
<span class="nc" id="L557">			session.setAttribute(&quot;CONSOLIDATED_LED_LIST&quot;, consolidatedList);</span>
<span class="nc" id="L558">			return &quot;consolidated&quot;;</span>
		}
<span class="nc" id="L560">		return generatePDF(path);</span>
	}

	/**
	 * This method is used for fetching data for ajax request from back office
	 * ledger page
	 * 
	 * @throws Exception
	 */

	public void boLedgerAjax() throws Exception {
<span class="nc" id="L571">		HttpSession session = request.getSession();</span>
<span class="nc" id="L572">		UserInfoBean userBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L574">		LedgerHelper ledgerHelper = new LedgerHelper();</span>
<span class="nc" id="L575">		String textForTax = (String) ServletActionContext.getServletContext()</span>
				.getAttribute(&quot;TEXT_FOR_TAX&quot;);
<span class="nc" id="L577">		String vat = (String) ServletActionContext.getServletContext()</span>
				.getAttribute(&quot;VAT_APPLICABLE&quot;);

<span class="nc" id="L580">		int id = userBean.getUserOrgId();</span>
<span class="nc" id="L581">		PrintWriter out = getResponse().getWriter();</span>
<span class="nc" id="L582">		String ledger = getLedgerType();</span>

<span class="nc" id="L584">		ArrayList selectedList = ledgerHelper.getList(ledger, &quot;BO&quot;, id);</span>
<span class="nc" id="L585">		logger.debug(&quot;Ledger BO ajax&quot; + selectedList);</span>
<span class="nc" id="L586">		String html = &quot;&quot;;</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">		if (ledgerType.equals(&quot;Accountwise&quot;)) {</span>
<span class="nc bnc" id="L588" title="All 2 branches missed.">			if (vat.trim().equalsIgnoreCase(&quot;yes&quot;)) {</span>
<span class="nc" id="L589">				html = &quot;Select Account: &lt;select class=\&quot;option\&quot; name=\&quot;accountType\&quot;&gt;&lt;OPTION VALUE=-1&gt;--Please Select--&lt;OPTION VALUE=\&quot;BANK_ACC\&quot;&gt;Bank Receipts &amp; Payments Account&lt;OPTION VALUE=\&quot;GOVT_COMM\&quot;&gt;Good Cause&lt;OPTION VALUE=\&quot;PLAYER_CAS\&quot;&gt;Net Paid PWT To Player&lt;OPTION VALUE=\&quot;PLAYER_PWT\&quot;&gt;Player PWT	&lt;OPTION VALUE=\&quot;PLAYER_TDS\&quot;&gt;Player &quot;</span>
						+ textForTax
						+ &quot;&lt;OPTION VALUE=\&quot;PWT_PAY\&quot;&gt;PWT Payable&lt;OPTION VALUE=\&quot;SALE_ACC\&quot;&gt;Sale Account&lt;OPTION VALUE=\&quot;SALE_RET\&quot;&gt;Sale Return Account&lt;OPTION VALUE=\&quot;PWT_CHARGES\&quot;&gt;PWT Collection Charges&lt;OPTION VALUE=\&quot;VAT_PAY\&quot;&gt;VAT Payable&lt;OPTION class=\&quot;option\&quot; VALUE=\&quot;TDS_PAY\&quot;&gt;&quot;
						+ textForTax + &quot;&lt;/SELECT&gt;&quot;;
			} else {
<span class="nc" id="L594">				html = &quot;Select Account: &lt;select class=\&quot;option\&quot; name=\&quot;accountType\&quot;&gt;&lt;OPTION VALUE=-1&gt;--Please Select--&lt;OPTION VALUE=\&quot;BANK_ACC\&quot;&gt;Bank Receipts &amp; Payments Account&lt;OPTION VALUE=\&quot;GOVT_COMM\&quot;&gt;Good Cause&lt;OPTION VALUE=\&quot;PLAYER_CAS\&quot;&gt;Net Paid PWT To Player&lt;OPTION VALUE=\&quot;PLAYER_PWT\&quot;&gt;Player PWT	&lt;OPTION VALUE=\&quot;PLAYER_TDS\&quot;&gt;Player &quot;</span>
						+ textForTax
						+ &quot;&lt;OPTION VALUE=\&quot;PWT_PAY\&quot;&gt;PWT Payable&lt;OPTION VALUE=\&quot;SALE_ACC\&quot;&gt;Sale Account&lt;OPTION VALUE=\&quot;SALE_RET\&quot;&gt;Sale Return Account&lt;OPTION VALUE=\&quot;PWT_CHARGES\&quot;&gt;PWT Collection Charges&lt;OPTION class=\&quot;option\&quot; VALUE=\&quot;TDS_PAY\&quot;&gt;&quot;
						+ textForTax + &quot;&lt;/SELECT&gt;&quot;;
			}
<span class="nc bnc" id="L599" title="All 4 branches missed.">		} else if (ledgerType.equals(&quot;Agentwise&quot;)</span>
				|| ledgerType.equals(&quot;consolidated&quot;)) {
<span class="nc" id="L601">			html = &quot;Select &quot;</span>
					+ ((Map&lt;String, String&gt;) ServletActionContext
							.getServletContext().getAttribute(&quot;TIER_MAP&quot;))
							.get(&quot;AGENT&quot;)
					+ &quot;: &lt;select class=\&quot;option\&quot; name=\&quot;agentName\&quot;&gt;&lt;OPTION VALUE=-1&gt;--Please Select--&quot;;

<span class="nc" id="L607">			int i = 0;</span>
<span class="nc bnc" id="L608" title="All 2 branches missed.">			for (Iterator it = selectedList.iterator(); it.hasNext();) {</span>
<span class="nc" id="L609">				String name = (String) it.next();</span>
<span class="nc" id="L610">				i++;</span>
<span class="nc" id="L611">				html += &quot;&lt;option class=\&quot;option\&quot; value=\&quot;&quot; + name + &quot;\&quot;&gt;&quot;</span>
						+ name + &quot;&lt;/option&gt;&quot;;
<span class="nc" id="L613">			}</span>
<span class="nc" id="L614">			html += &quot;&lt;/select&gt;&quot;;</span>
		}
<span class="nc" id="L616">		response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L617">		out.print(html);</span>
<span class="nc" id="L618">	}</span>

	public String displayLedger() {

<span class="nc" id="L622">		return SUCCESS;</span>
	}

	/**
	 * This method is for Generating the PDF Reports
	 * 
	 * @param data
	 *            Byte Array generated by Jasper Compiler
	 * @return String
	 * @throws Exception
	 */
	public String generatePDF(byte[] data) throws Exception {
<span class="nc" id="L634">		logger.info(&quot;In PDF Generation in Ledger Action&quot;);</span>
<span class="nc" id="L635">		int lengthOfFile = 0;</span>
		try {

<span class="nc" id="L638">			lengthOfFile = data.length;</span>
<span class="nc bnc" id="L639" title="All 2 branches missed.">			if (lengthOfFile &gt; 800) {</span>
<span class="nc" id="L640">				response.setContentType(&quot;application/pdf&quot;);</span>
<span class="nc" id="L641">				OutputStream OutStrm = response.getOutputStream();</span>
<span class="nc" id="L642">				logger.debug(&quot;Written data to stream: &quot; + data);</span>
<span class="nc" id="L643">				OutStrm.write(data);</span>
				// response.sendError (response.SC_UNSUPPORTED_MEDIA_TYPE);

				// response.SC_UNSUPPORTED_MEDIA_TYPE;
<span class="nc" id="L647">				OutStrm.flush();</span>
<span class="nc" id="L648">				OutStrm.close();</span>
<span class="nc" id="L649">				return null;</span>
			}

<span class="nc" id="L652">		} catch (IOException e) {</span>
<span class="nc" id="L653">			e.printStackTrace();</span>
<span class="nc" id="L654">		}</span>
		/*
		 * PrintWriter out = getResponse().getWriter();
		 * response.setContentType(&quot;application/pdf&quot;); out.print(data);
		 * out.flush();
		 */
		/*
		 * if(lengthOfFile&gt;0){ return null; }
		 */
<span class="nc" id="L663">		return SUCCESS;</span>
	}

	public String getAccountType() {
<span class="nc" id="L667">		return accountType;</span>
	}

	/*
	 * public void generatePDF(byte [] data)throws Exception{ PrintWriter out =
	 * getResponse().getWriter(); response.setContentType(&quot;application/pdf&quot;);
	 * out.print(data); }
	 */

	public String getAgentLedger() {
<span class="nc" id="L677">		return agentLedger;</span>
	}

	public String getAgentName() {
<span class="nc" id="L681">		return agentName;</span>
	}

	public String getConsolidatedAcct() {
<span class="nc" id="L685">		return consolidatedAcct;</span>
	}

	public String getConsolidatedDay() {
<span class="nc" id="L689">		return consolidatedDay;</span>
	}

	public String getConsolidatedDetailed() {
<span class="nc" id="L693">		return consolidatedDetailed;</span>
	}

	public List getConsolidatedList() {
<span class="nc" id="L697">		return consolidatedList;</span>
	}

	public String getFromDate() {
<span class="nc" id="L701">		return fromDate;</span>
	}

	public String getLedgerType() {
<span class="nc" id="L705">		return ledgerType;</span>
	}

	public HttpServletRequest getRequest() {
<span class="nc" id="L709">		return request;</span>
	}

	public HttpServletResponse getResponse() {
<span class="nc" id="L713">		return response;</span>
	}

	public String getRetailerName() {
<span class="nc" id="L717">		return retailerName;</span>
	}

	public List getSelectedGames() {
<span class="nc" id="L721">		return selectedGames;</span>
	}

	public List getSelectGames() {
<span class="nc" id="L725">		return selectGames;</span>
	}

	public String getSelectMonth() {
<span class="nc" id="L729">		return selectMonth;</span>
	}

	public String getShowAgtLedger() {
<span class="nc" id="L733">		return showAgtLedger;</span>
	}

	public String getToDate() {
<span class="nc" id="L737">		return toDate;</span>
	}

	public String getType() {
<span class="nc" id="L741">		return type;</span>
	}

	public String retLedger() throws Exception {

<span class="nc bnc" id="L746" title="All 2 branches missed.">		if (ledgerType.equalsIgnoreCase(&quot;Retailer Self&quot;)) {</span>
<span class="nc" id="L747">			agentLedger();</span>

		}
<span class="nc" id="L750">		logger.debug(&quot;In Ret Ledger&quot;);</span>
<span class="nc" id="L751">		return generatePDF(path);</span>

	}

	public void setAccountType(String accountType) {
<span class="nc" id="L756">		this.accountType = accountType;</span>
<span class="nc" id="L757">	}</span>

	public void setAgentLedger(String agentLedger) {
<span class="nc" id="L760">		this.agentLedger = agentLedger;</span>
<span class="nc" id="L761">	}</span>

	public void setAgentName(String agentName) {
<span class="nc" id="L764">		this.agentName = agentName;</span>
<span class="nc" id="L765">	}</span>

	public void setConsolidatedAcct(String consolidatedAcct) {
<span class="nc" id="L768">		this.consolidatedAcct = consolidatedAcct;</span>
<span class="nc" id="L769">	}</span>

	public void setConsolidatedDay(String consolidatedDay) {
<span class="nc" id="L772">		this.consolidatedDay = consolidatedDay;</span>
<span class="nc" id="L773">	}</span>

	public void setConsolidatedDetailed(String consolidatedDetailed) {
<span class="nc" id="L776">		this.consolidatedDetailed = consolidatedDetailed;</span>
<span class="nc" id="L777">	}</span>

	public void setConsolidatedList(List consolidatedList) {
<span class="nc" id="L780">		this.consolidatedList = consolidatedList;</span>
<span class="nc" id="L781">	}</span>

	public void setFromDate(String fromDate) {
<span class="nc" id="L784">		this.fromDate = fromDate;</span>
<span class="nc" id="L785">	}</span>

	public void setLedgerType(String ledgerType) {
<span class="nc" id="L788">		this.ledgerType = ledgerType;</span>
<span class="nc" id="L789">	}</span>

	public void setRequest(HttpServletRequest request) {
<span class="nc" id="L792">		this.request = request;</span>
<span class="nc" id="L793">	}</span>

	public void setRetailerName(String retailerName) {
<span class="nc" id="L796">		this.retailerName = retailerName;</span>
<span class="nc" id="L797">	}</span>

	public void setSelectedGames(List selectedGames) {
<span class="nc" id="L800">		this.selectedGames = selectedGames;</span>
<span class="nc" id="L801">	}</span>

	public void setSelectGames(List selectGames) {
<span class="nc" id="L804">		this.selectGames = selectGames;</span>
<span class="nc" id="L805">	}</span>

	public void setSelectMonth(String selectMonth) {
<span class="nc" id="L808">		this.selectMonth = selectMonth;</span>
<span class="nc" id="L809">	}</span>

	public void setServletRequest(HttpServletRequest request) {
<span class="nc" id="L812">		this.request = request;</span>
<span class="nc" id="L813">	}</span>

	public void setServletResponse(HttpServletResponse response) {
<span class="nc" id="L816">		this.response = response;</span>

<span class="nc" id="L818">	}</span>

	public void setShowAgtLedger(String showAgtLedger) {
<span class="nc" id="L821">		this.showAgtLedger = showAgtLedger;</span>
<span class="nc" id="L822">	}</span>

	public void setToDate(String toDate) {
<span class="nc" id="L825">		this.toDate = toDate;</span>
<span class="nc" id="L826">	}</span>

	public void setType(String type) {
<span class="nc" id="L829">		this.type = type;</span>
<span class="nc" id="L830">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>