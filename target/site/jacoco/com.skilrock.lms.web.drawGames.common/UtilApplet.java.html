<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UtilApplet.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.web.drawGames.common</a> &gt; <span class="el_source">UtilApplet.java</span></div><h1>UtilApplet.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.web.drawGames.common;

import java.sql.Timestamp;
import java.text.NumberFormat;
import java.util.Date;
import java.util.List;
import java.util.Map;

import javax.servlet.ServletContext;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.struts2.ServletActionContext;
import org.apache.struts2.interceptor.ServletRequestAware;

import com.opensymphony.xwork2.ActionSupport;
import com.skilrock.lms.beans.PlayerBean;
import com.skilrock.lms.dge.beans.CommonPurchaseBean;
import com.skilrock.lms.dge.beans.DrawIdBean;
import com.skilrock.lms.dge.beans.FortunePurchaseBean;
import com.skilrock.lms.dge.beans.KenoPurchaseBean;
import com.skilrock.lms.dge.beans.LottoPurchaseBean;
import com.skilrock.lms.dge.beans.PWTDrawBean;
import com.skilrock.lms.dge.beans.PanelIdBean;
import com.skilrock.lms.dge.beans.RaffleDrawIdBean;
import com.skilrock.lms.dge.beans.RafflePurchaseBean;

<span class="nc" id="L29">public class UtilApplet extends ActionSupport implements ServletRequestAware{</span>
	private static final long serialVersionUID = 1L;
	
	private HttpServletRequest request;
	private HttpServletResponse response;
	
	public static int getAdvMsgs(Map&lt;String, List&lt;String&gt;&gt; advMsgMap, StringBuilder topMsgsStr, StringBuilder bottomMsgsStr, int appletHeight) {
<span class="fc" id="L36">		String advtMsgEnable = (String) ServletActionContext.getServletContext().getAttribute(&quot;ADVT_MSG&quot;);</span>
<span class="pc bpc" id="L37" title="5 of 6 branches missed.">		if (advtMsgEnable != null &amp;&amp; !&quot;NULL&quot;.equalsIgnoreCase(advtMsgEnable) &amp;&amp; &quot;YES&quot;.equalsIgnoreCase(advtMsgEnable.trim())) {</span>
<span class="nc bnc" id="L38" title="All 2 branches missed.">			if (advMsgMap != null) {</span>
<span class="nc" id="L39">				List&lt;String&gt; topMsgsList = advMsgMap.get(&quot;TOP&quot;);</span>
<span class="nc" id="L40">				List&lt;String&gt; bottomMsgsList = advMsgMap.get(&quot;BOTTOM&quot;);</span>
<span class="nc" id="L41">				int msgLen = 0;</span>

<span class="nc bnc" id="L43" title="All 2 branches missed.">				if (topMsgsList != null) {</span>
<span class="nc bnc" id="L44" title="All 2 branches missed.">					if (topMsgsStr.length() == 1) {</span>
<span class="nc" id="L45">						topMsgsStr.deleteCharAt(topMsgsStr.length() - 1);</span>
					}
<span class="nc bnc" id="L47" title="All 2 branches missed.">					for (int i = 0; i &lt; topMsgsList.size(); i++) {</span>
<span class="nc" id="L48">						topMsgsStr = topMsgsStr.append(topMsgsList.get(i) + &quot;~&quot;);</span>
<span class="nc" id="L49">						msgLen = topMsgsList.get(i).length();</span>
<span class="nc bnc" id="L50" title="All 2 branches missed.">						if (msgLen &gt; 17) {</span>
<span class="nc" id="L51">							appletHeight = appletHeight + 11 * (msgLen / 17) + 11;</span>
						} else {
<span class="nc" id="L53">							appletHeight = appletHeight + 22;</span>
						}
					}
<span class="nc bnc" id="L56" title="All 2 branches missed.">					if (topMsgsStr.length() &gt; 0) {</span>
<span class="nc" id="L57">						topMsgsStr.deleteCharAt(topMsgsStr.length() - 1);</span>
					}
				}

<span class="nc bnc" id="L61" title="All 2 branches missed.">				if (bottomMsgsList != null) {</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">					if (bottomMsgsStr.length() == 1) {</span>
<span class="nc" id="L63">						bottomMsgsStr.deleteCharAt(bottomMsgsStr.length() - 1);</span>
					}
<span class="nc bnc" id="L65" title="All 2 branches missed.">					for (int i = 0; i &lt; bottomMsgsList.size(); i++) {</span>
<span class="nc" id="L66">						bottomMsgsStr = bottomMsgsStr.append(bottomMsgsList</span>
								.get(i)
								+ &quot;~&quot;);
<span class="nc" id="L69">						msgLen = bottomMsgsList.get(i).length();</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">						if (msgLen &gt; 17) {</span>
<span class="nc" id="L71">							appletHeight = appletHeight + 11 * (msgLen / 17)</span>
									+ 11;
						} else {
<span class="nc" id="L74">							appletHeight = appletHeight + 22;</span>
						}
					}
<span class="nc bnc" id="L77" title="All 2 branches missed.">					if (bottomMsgsStr.length() &gt; 0) {</span>
<span class="nc" id="L78">						bottomMsgsStr.deleteCharAt(bottomMsgsStr.length() - 1);</span>
					}
				}
			}
		}
<span class="fc" id="L83">		return appletHeight;</span>
	}

	public static int getRaffPurchaseData(List&lt;RafflePurchaseBean&gt; rafflePurchaseBeanList, StringBuilder raffleData, int appletHeight) {
<span class="nc bnc" id="L87" title="All 2 branches missed.">		if(rafflePurchaseBeanList != null){</span>
<span class="nc" id="L88">			RafflePurchaseBean bean = null;</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">			if (rafflePurchaseBeanList.size() &gt; 0) {</span>
<span class="nc" id="L90">				raffleData.deleteCharAt(raffleData.length() - 1);</span>
			}

<span class="nc bnc" id="L93" title="All 2 branches missed.">			for (int i = 0; i &lt; rafflePurchaseBeanList.size(); i++) {</span>
<span class="nc" id="L94">				bean = rafflePurchaseBeanList.get(i);</span>
<span class="nc" id="L95">				StringBuilder raffTopAdvMsg = new StringBuilder(&quot; &quot;);</span>
<span class="nc" id="L96">				StringBuilder raffBottomAdvMsg = new StringBuilder(&quot; &quot;);</span>
<span class="nc" id="L97">				appletHeight = getAdvMsgs(bean.getAdvMsg(), raffTopAdvMsg, raffBottomAdvMsg, appletHeight);</span>

<span class="nc" id="L99">				String raffTktType = bean.getRaffleTicketType();</span>
<span class="nc" id="L100">				raffleData.append(&quot;raffTktType-sprtr-&quot; + raffTktType</span>
						+ &quot;#raffTktNo-sprtr-&quot; + bean.getRaffleTicket_no()
						+ &quot;#raffDrawTime-sprtr-&quot; + bean.getDrawDateTime()
						+ &quot;#raffDispName-sprtr-&quot; + bean.getGameDispName()
						+ &quot;#raffTopAdvMsg-sprtr-&quot; + raffTopAdvMsg
						+ &quot;#raffBottomAdvMsg-sprtr-&quot; + raffBottomAdvMsg + &quot;Nxt&quot;);
<span class="nc bnc" id="L106" title="All 2 branches missed.">				if (&quot;ORIGINAL&quot;.equalsIgnoreCase(raffTktType)) {</span>
<span class="nc" id="L107">					appletHeight = appletHeight + 150;</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">				} else if (&quot;REFERENCE&quot;.equalsIgnoreCase(raffTktType)) {</span>
<span class="nc" id="L109">					appletHeight = appletHeight + 44;</span>
				}
			}
<span class="nc bnc" id="L112" title="All 2 branches missed.">			if (bean != null) {</span>
<span class="nc" id="L113">				raffleData.delete(raffleData.length() - 3, raffleData.length());</span>
			}
		}
<span class="nc" id="L116">		return appletHeight;</span>
	}

	public static int getRaffPWTData(List&lt;RaffleDrawIdBean&gt; raffleDrawIdBeanList, StringBuilder raffleData, int appletHeight) {
<span class="nc" id="L120">		RaffleDrawIdBean bean = null;</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">		if (raffleDrawIdBeanList.size() &gt; 0) {</span>
<span class="nc" id="L122">			raffleData.deleteCharAt(raffleData.length() - 1);</span>
		}
<span class="nc bnc" id="L124" title="All 2 branches missed.">		for (int i = 0; i &lt; raffleDrawIdBeanList.size(); i++) {</span>
<span class="nc" id="L125">			bean = raffleDrawIdBeanList.get(i);</span>
<span class="nc" id="L126">			String status = bean.getStatus();</span>
<span class="nc" id="L127">			String pwtStatus = bean.getPwtStatus();</span>
			// double totalRaffleAmount = 0.0;

<span class="nc bnc" id="L130" title="All 2 branches missed.">			if (&quot;FRAUD&quot;.equalsIgnoreCase(status)) {</span>
<span class="nc" id="L131">				raffleData.append(&quot;Cannot Verify.Invalid PWT&quot;);</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">			} else if (&quot;TICKET_EXPIRED&quot;.equalsIgnoreCase(status)) {</span>
<span class="nc" id="L133">				raffleData.append(&quot;Expired or Invalid Ticket&quot;);</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">			} else if (&quot;RES_AWAITED&quot;.equalsIgnoreCase(status)) {</span>
<span class="nc" id="L135">				raffleData.append(&quot;Awaited~&quot; + bean.getDrawDateTime());</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">			} else if (&quot;NON_WIN&quot;.equalsIgnoreCase(status)) {</span>
<span class="nc" id="L137">				raffleData.append(&quot;TRY AGAIN~&quot; + bean.getDrawDateTime());</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">			} else if (&quot;NORMAL_PAY&quot;.equalsIgnoreCase(status)) {</span>
				/*
				 * totalRaffleAmount = totalRaffleAmount +
				 * Double.parseDouble(bean.getWinningAmt());
				 */
<span class="nc" id="L143">				raffleData.append(&quot;WIN &quot; + bean.getWinningAmt() + &quot;~&quot;</span>
						+ bean.getDrawDateTime() + &quot;~&quot; + bean.getWinningAmt());
<span class="nc bnc" id="L145" title="All 2 branches missed.">			} else if (&quot;CLAIMED&quot;.equalsIgnoreCase(status)) {</span>
<span class="nc" id="L146">				raffleData.append(&quot;CLAIMED~&quot; + bean.getDrawDateTime());</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">			} else if (&quot;PND_PAY&quot;.equalsIgnoreCase(pwtStatus)) {</span>
<span class="nc" id="L148">				raffleData.append(&quot;Cannot Verify.High Prize&quot;);</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">			} else if (&quot;HIGH_PRIZE&quot;.equalsIgnoreCase(pwtStatus)) {</span>
<span class="nc" id="L150">				raffleData.append(&quot;Cannot Verify.High Prize&quot;);</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">			} else if (&quot;OUT_VERIFY_LIMIT&quot;.equalsIgnoreCase(pwtStatus)) {</span>
<span class="nc" id="L152">				raffleData.append(&quot;Cannot Verify.High Prize&quot;);</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">			} else if (&quot;OUT_PAY_LIMIT&quot;.equalsIgnoreCase(pwtStatus)) {</span>
<span class="nc" id="L154">				raffleData.append(&quot;Cannot Verify.High Prize&quot;);</span>
			}
<span class="nc" id="L156">			raffleData.append(&quot;Nxt&quot;);</span>
<span class="nc" id="L157">			appletHeight = appletHeight + 55;</span>
		}
<span class="nc bnc" id="L159" title="All 2 branches missed.">		if (bean != null) {</span>
<span class="nc" id="L160">			raffleData.delete(raffleData.length() - 3, raffleData.length());</span>
		}

<span class="nc" id="L163">		return appletHeight;</span>
	}

	public static String getPromoData(Object bean, String promoOriginalData) {
<span class="nc" id="L167">		StringBuilder finalData = new StringBuilder(&quot;&quot;);</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">		if (bean != null) {</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">			if (bean instanceof List) {</span>
				// To Be Implemented Later...
			} else {
<span class="nc" id="L172">				String gameName = &quot;&quot;;</span>
<span class="nc" id="L173">				String tktNo = &quot;&quot;;</span>
<span class="nc" id="L174">				String rpcCount = &quot;&quot;;</span>
<span class="nc" id="L175">				String saleStatus = &quot;&quot;;</span>
<span class="nc" id="L176">				String purchaseTime = &quot;&quot;;</span>
<span class="nc" id="L177">				String gameDispName = &quot;&quot;;</span>
<span class="nc" id="L178">				List drawDateList = null;</span>
<span class="nc" id="L179">				StringBuilder drawDateTime = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L180">				StringBuilder pickNumStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L181">				int expiryPeriod = 0;</span>
<span class="nc" id="L182">				int noOfDraws = 0;</span>
<span class="nc" id="L183">				double totPurchaseAmt = 0.0;</span>
<span class="nc" id="L184">				StringBuilder topMsgsStr = new StringBuilder(&quot; &quot;);</span>
<span class="nc" id="L185">				StringBuilder bottomMsgsStr = new StringBuilder(&quot; &quot;);</span>
<span class="nc" id="L186">				StringBuilder raffleData = new StringBuilder(&quot; &quot;);</span>
<span class="nc" id="L187">				int totalQuantity = 0;</span>
<span class="nc" id="L188">				StringBuilder gameDependentData = new StringBuilder(&quot;&quot;);</span>

<span class="nc bnc" id="L190" title="All 2 branches missed.">				if (bean instanceof FortunePurchaseBean) {</span>
<span class="nc" id="L191">					FortunePurchaseBean fortuneBean = (FortunePurchaseBean) bean;</span>
<span class="nc" id="L192">					gameName = Util.getGameName(fortuneBean.getGame_no());</span>
<span class="nc" id="L193">					tktNo = fortuneBean.getTicket_no();</span>
<span class="nc" id="L194">					rpcCount = fortuneBean.getReprintCount();</span>
<span class="nc" id="L195">					saleStatus = fortuneBean.getSaleStatus();</span>
<span class="nc" id="L196">					purchaseTime = fortuneBean.getPurchaseTime();</span>
<span class="nc" id="L197">					gameDispName = fortuneBean.getGameDispName();</span>
<span class="nc" id="L198">					drawDateList = fortuneBean.getDrawDateTime();</span>

<span class="nc" id="L200">					List&lt;Integer&gt; pickedNumbers = fortuneBean</span>
							.getPickedNumbers();
<span class="nc" id="L202">					pickNumStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">					for (int pickNum : pickedNumbers) {</span>
<span class="nc" id="L204">						pickNumStr.append(pickNum + &quot;,&quot;);</span>
<span class="nc" id="L205">					}</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">					if (pickNumStr.length() &gt; 0) {</span>
<span class="nc" id="L207">						pickNumStr.deleteCharAt(pickNumStr.length() - 1);</span>
					}

<span class="nc" id="L210">					int[] betAmtMulti = fortuneBean.getBetAmountMultiple();</span>
<span class="nc" id="L211">					StringBuilder betAmtStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">					for (int betAmt : betAmtMulti) {</span>
<span class="nc" id="L213">						betAmtStr.append(betAmt + &quot;,&quot;);</span>
<span class="nc" id="L214">						totalQuantity = totalQuantity + betAmt;</span>
					}
<span class="nc bnc" id="L216" title="All 2 branches missed.">					if (betAmtStr.length() &gt; 0) {</span>
<span class="nc" id="L217">						betAmtStr.deleteCharAt(betAmtStr.length() - 1);</span>
					}

<span class="nc" id="L220">					expiryPeriod = Util.getGameMap().get(</span>
							Util.getGameName(fortuneBean.getGame_no()))
							.getTicketExpiryPeriod();
<span class="nc" id="L223">					noOfDraws = fortuneBean.getNoOfDraws();</span>
<span class="nc" id="L224">					totPurchaseAmt = fortuneBean.getTotalPurchaseAmt();</span>

<span class="nc" id="L226">					int appHeight = 0;</span>
<span class="nc" id="L227">					appHeight = getAdvMsgs(fortuneBean.getAdvMsg(),</span>
							topMsgsStr, bottomMsgsStr, appHeight);

<span class="nc bnc" id="L230" title="All 2 branches missed.">					if (fortuneBean.getRafflePurchaseBeanList() != null) {</span>
<span class="nc" id="L231">						appHeight = getRaffPurchaseData(fortuneBean</span>
								.getRafflePurchaseBeanList(), raffleData,
								appHeight);
					}

<span class="nc" id="L236">					gameDependentData.append(&quot;|isQP=&quot; + fortuneBean.getIsQP()</span>
							+ &quot;|betAmountMultiple=&quot; + betAmtStr
							+ &quot;|totalQuantity=&quot; + totalQuantity);

<span class="nc bnc" id="L240" title="All 2 branches missed.">				} else if (bean instanceof LottoPurchaseBean) {</span>
<span class="nc" id="L241">					LottoPurchaseBean lottoBean = (LottoPurchaseBean) bean;</span>
<span class="nc" id="L242">					gameName = Util.getGameName(lottoBean.getGame_no());</span>
<span class="nc" id="L243">					tktNo = lottoBean.getTicket_no();</span>
<span class="nc" id="L244">					rpcCount = lottoBean.getReprintCount();</span>
<span class="nc" id="L245">					saleStatus = lottoBean.getSaleStatus();</span>
<span class="nc" id="L246">					purchaseTime = lottoBean.getPurchaseTime();</span>
<span class="nc" id="L247">					gameDispName = lottoBean.getGameDispName();</span>
<span class="nc" id="L248">					drawDateList = lottoBean.getDrawDateTime();</span>

<span class="nc" id="L250">					List&lt;String&gt; pickedNumbers = lottoBean.getPlayerPicked();</span>
<span class="nc" id="L251">					pickNumStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">					for (String pickNum : pickedNumbers) {</span>
<span class="nc" id="L253">						pickNumStr.append(pickNum + &quot;;&quot;);</span>
<span class="nc" id="L254">					}</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">					if (pickNumStr.length() &gt; 0) {</span>
<span class="nc" id="L256">						pickNumStr.deleteCharAt(pickNumStr.length() - 1);</span>
					}

<span class="nc" id="L259">					expiryPeriod = Util.getGameMap().get(</span>
							Util.getGameName(lottoBean.getGame_no()))
							.getTicketExpiryPeriod();
<span class="nc" id="L262">					noOfDraws = lottoBean.getNoOfDraws();</span>
<span class="nc" id="L263">					totPurchaseAmt = lottoBean.getTotalPurchaseAmt();</span>

<span class="nc" id="L265">					int appHeight = 0;</span>

<span class="nc" id="L267">					appHeight = getAdvMsgs(lottoBean.getAdvMsg(),</span>
							topMsgsStr, bottomMsgsStr, appHeight);

<span class="nc bnc" id="L270" title="All 2 branches missed.">					if (lottoBean.getRafflePurchaseBeanList() != null) {</span>
<span class="nc" id="L271">						appHeight = getRaffPurchaseData(lottoBean</span>
								.getRafflePurchaseBeanList(), raffleData,
								appHeight);
					}

<span class="nc" id="L276">					totalQuantity = lottoBean.getPanel_id().length;</span>

<span class="nc" id="L278">					StringBuilder quickPickStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">					for (int quickPick : lottoBean.getIsQuickPick()) {</span>
<span class="nc" id="L280">						quickPickStr.append(quickPick + &quot;,&quot;);</span>
					}
<span class="nc bnc" id="L282" title="All 2 branches missed.">					if (quickPickStr.length() &gt; 0) {</span>
<span class="nc" id="L283">						quickPickStr.deleteCharAt(quickPickStr.length() - 1);</span>
					}

<span class="nc" id="L286">					gameDependentData.append(&quot;isQuickPickArray=&quot; + quickPickStr</span>
							+ &quot;|totalQuantity=&quot; + totalQuantity);
<span class="nc bnc" id="L288" title="All 2 branches missed.">				} else if (bean instanceof KenoPurchaseBean) {</span>
<span class="nc" id="L289">					KenoPurchaseBean kenoBean = (KenoPurchaseBean) bean;</span>
<span class="nc" id="L290">					gameName = Util.getGameName(kenoBean.getGame_no());</span>
<span class="nc" id="L291">					tktNo = kenoBean.getTicket_no();</span>
<span class="nc" id="L292">					rpcCount = kenoBean.getReprintCount();</span>
<span class="nc" id="L293">					saleStatus = kenoBean.getSaleStatus();</span>
<span class="nc" id="L294">					purchaseTime = kenoBean.getPurchaseTime();</span>
<span class="nc" id="L295">					gameDispName = kenoBean.getGameDispName();</span>
<span class="nc" id="L296">					drawDateList = kenoBean.getDrawDateTime();</span>
<span class="nc" id="L297">					expiryPeriod = Util.getGameMap().get(</span>
							Util.getGameName(kenoBean.getGame_no()))
							.getTicketExpiryPeriod();
<span class="nc" id="L300">					noOfDraws = kenoBean.getNoOfDraws();</span>
<span class="nc" id="L301">					totPurchaseAmt = kenoBean.getTotalPurchaseAmt();</span>

<span class="nc" id="L303">					int appHeight = 0;</span>

<span class="nc" id="L305">					appHeight = getAdvMsgs(kenoBean.getAdvMsg(),</span>
							topMsgsStr, bottomMsgsStr, appHeight);

<span class="nc bnc" id="L308" title="All 2 branches missed.">					if (kenoBean.getRafflePurchaseBeanList() != null) {</span>
<span class="nc" id="L309">						appHeight = getRaffPurchaseData(kenoBean</span>
								.getRafflePurchaseBeanList(), raffleData,
								appHeight);
					}

<span class="nc" id="L314">					String[] playerDataApp = kenoBean.getPlayerData();</span>
<span class="nc" id="L315">					String[] playType = kenoBean.getPlayType();</span>
<span class="nc" id="L316">					int[] noOfLines = kenoBean.getNoOfLines();</span>
<span class="nc" id="L317">					double[] unitPrice = kenoBean.getUnitPrice();</span>
<span class="nc" id="L318">					int[] betAmtMul = kenoBean.getBetAmountMultiple();</span>
<span class="nc" id="L319">					int[] isQP = kenoBean.getIsQuickPick();</span>
<span class="nc" id="L320">					double[] panelPrice = new double[playType.length];</span>

<span class="nc" id="L322">					StringBuilder playerDataStr = new StringBuilder(&quot; &quot;);</span>
<span class="nc" id="L323">					StringBuilder playTypeStr = new StringBuilder(&quot; &quot;);</span>
<span class="nc" id="L324">					StringBuilder noOfLinesStr = new StringBuilder(&quot; &quot;);</span>
<span class="nc" id="L325">					StringBuilder unitPriceStr = new StringBuilder(&quot; &quot;);</span>
<span class="nc" id="L326">					StringBuilder isQPStr = new StringBuilder(&quot; &quot;);</span>
<span class="nc" id="L327">					StringBuilder panelPriceStr = new StringBuilder(&quot; &quot;);</span>

<span class="nc bnc" id="L329" title="All 2 branches missed.">					if (playerDataApp.length &gt; 0) {</span>
<span class="nc" id="L330">						playerDataStr.deleteCharAt(playerDataStr.length() - 1);</span>
<span class="nc" id="L331">						playTypeStr.deleteCharAt(playTypeStr.length() - 1);</span>
<span class="nc" id="L332">						noOfLinesStr.deleteCharAt(noOfLinesStr.length() - 1);</span>
<span class="nc" id="L333">						unitPriceStr.deleteCharAt(unitPriceStr.length() - 1);</span>
<span class="nc" id="L334">						isQPStr.deleteCharAt(isQPStr.length() - 1);</span>
<span class="nc" id="L335">						panelPriceStr.deleteCharAt(panelPriceStr.length() - 1);</span>

<span class="nc bnc" id="L337" title="All 2 branches missed.">						for (int panelId = 0; panelId &lt; playerDataApp.length; panelId++) {</span>
<span class="nc" id="L338">							playerDataStr.append(playerDataApp[panelId] + &quot;~&quot;);</span>
<span class="nc" id="L339">							playTypeStr.append(playType[panelId] + &quot;~&quot;);</span>
<span class="nc" id="L340">							noOfLinesStr.append(noOfLines[panelId] + &quot;~&quot;);</span>
<span class="nc" id="L341">							unitPriceStr</span>
									.append((unitPrice[panelId] * betAmtMul[panelId])
											+ &quot;~&quot;);
<span class="nc" id="L344">							isQPStr.append(isQP[panelId] + &quot;~&quot;);</span>
<span class="nc" id="L345">							panelPriceStr</span>
									.append((unitPrice[panelId]
											* betAmtMul[panelId]
											* noOfLines[panelId] * noOfDraws)
											+ &quot;~&quot;);

						}

<span class="nc" id="L353">						playerDataStr.deleteCharAt(playerDataStr.length() - 1);</span>
<span class="nc" id="L354">						playTypeStr.deleteCharAt(playTypeStr.length() - 1);</span>
<span class="nc" id="L355">						noOfLinesStr.deleteCharAt(noOfLinesStr.length() - 1);</span>
<span class="nc" id="L356">						unitPriceStr.deleteCharAt(unitPriceStr.length() - 1);</span>
<span class="nc" id="L357">						isQPStr.deleteCharAt(isQPStr.length() - 1);</span>
<span class="nc" id="L358">						panelPriceStr.deleteCharAt(panelPriceStr.length() - 1);</span>
					}

<span class="nc" id="L361">					pickNumStr = playerDataStr;</span>

<span class="nc" id="L363">					gameDependentData.append(&quot;|isQP=&quot; + isQPStr</span>
							+ &quot;|totalQuantity=&quot; + noOfLinesStr + &quot;|playType=&quot;
							+ playTypeStr + &quot;|unitPriceStr=&quot; + unitPriceStr
							+ &quot;|panelPriceStr=&quot; + panelPriceStr);
				}
<span class="nc bnc" id="L368" title="All 2 branches missed.">				for (int i = 0; i &lt; drawDateList.size(); i++) {</span>
<span class="nc" id="L369">					drawDateTime.append(drawDateList.get(i) + &quot;,&quot;);</span>
				}
<span class="nc bnc" id="L371" title="All 2 branches missed.">				if (drawDateTime.length() &gt; 0) {</span>
<span class="nc" id="L372">					drawDateTime.deleteCharAt(drawDateTime.length() - 1);</span>
				}

<span class="nc" id="L375">				finalData.append(&quot;data=&quot; + tktNo + rpcCount + &quot;|gameName=&quot;</span>
						+ gameName + &quot;|mode=Buy&quot; + &quot;|saleStatus=&quot; + saleStatus
						+ promoOriginalData + &quot;|reprintCount=&quot; + rpcCount
						+ &quot;|purchaseTime=&quot; + purchaseTime + &quot;|gameDispName=&quot;
						+ gameDispName + &quot;|ticketNumber=&quot; + tktNo
						+ &quot;|drawDateTime=&quot; + drawDateTime + &quot;|pickedNumbers=&quot;
						+ pickNumStr + &quot;|expiryPeriod=&quot; + expiryPeriod
						+ &quot;|noOfDraws=&quot; + noOfDraws + &quot;|totalPurchaseAmt=&quot;
						+ totPurchaseAmt + &quot;|topAdvMsg=&quot; + topMsgsStr
						+ &quot;|bottomAdvMsg=&quot; + bottomMsgsStr + &quot;|raffleData=&quot;
						+ raffleData + gameDependentData);
			}
		}
<span class="nc" id="L388">		return finalData.toString();</span>
	}

	public static int commonPurchaseDataForApplet(StringBuilder commonData, CommonPurchaseBean commonBean, int appletHeight) {
<span class="nc bnc" id="L392" title="All 2 branches missed.">		if (commonBean != null) {</span>
<span class="nc" id="L393">			ServletContext application = ServletActionContext.getServletContext();</span>
<span class="nc" id="L394">			String drawDateTimeStr = null;</span>
<span class="nc" id="L395">			List drawDateList = commonBean.getDrawDateTime();</span>
<span class="nc bnc" id="L396" title="All 2 branches missed.">			if (drawDateList != null) {</span>
<span class="nc" id="L397">				drawDateTimeStr = Util.convertCollToStr(drawDateList).replaceAll(&quot;, &quot;, &quot;,&quot;);</span>
<span class="nc" id="L398">				appletHeight = appletHeight + drawDateList.size() * 11;</span>
<span class="nc" id="L399">				appletHeight = appletHeight + (drawDateTimeStr.split(&quot;\\*&quot;).length - 1) * 11; /* FOR DRAW NAME*/</span>
			}

<span class="nc" id="L402">			StringBuilder topMsgsStr = new StringBuilder(&quot; &quot;);</span>
<span class="nc" id="L403">			StringBuilder bottomMsgsStr = new StringBuilder(&quot; &quot;);</span>

<span class="nc" id="L405">			appletHeight = getAdvMsgs(commonBean.getAdvMsg(), topMsgsStr, bottomMsgsStr, appletHeight);</span>

<span class="nc" id="L407">			StringBuilder raffleData = new StringBuilder(&quot; &quot;);</span>
<span class="nc bnc" id="L408" title="All 2 branches missed.">			if (commonBean.getRafflePurchaseBeanList() != null) {</span>
<span class="nc" id="L409">				appletHeight = getRaffPurchaseData(commonBean.getRafflePurchaseBeanList(), raffleData, appletHeight);</span>
			}

<span class="nc" id="L412">			commonData.append(&quot;data=&quot; + commonBean.getTicket_no() + commonBean.getReprintCount()</span>
					+ &quot;|gameName=&quot; + Util.getGameName(commonBean.getGame_no())
					+ &quot;|mode=Buy|saleStatus=&quot; + commonBean.getSaleStatus()
					+ &quot;|reprintCount=&quot; + commonBean.getReprintCount()
					+ &quot;|purchaseTime=&quot; + commonBean.getPurchaseTime()
					+ &quot;|gameDispName=&quot; + commonBean.getGameDispName()
					+ &quot;|ticketNumber=&quot; + commonBean.getTicket_no()
					+ &quot;|drawDateTime=&quot; + drawDateTimeStr
					+ &quot;|expiryPeriod=&quot; + Util.getGameMap().get(Util.getGameName(commonBean.getGame_no())).getTicketExpiryPeriod()
					+ &quot;|noOfDraws=&quot; + commonBean.getNoOfDraws()
					+ &quot;|totalPurchaseAmt=&quot; + commonBean.getTotalPurchaseAmt()
					+ &quot;|topAdvMsg=&quot; + topMsgsStr
					+ &quot;|bottomAdvMsg=&quot; + bottomMsgsStr
					+ &quot;|raffleData=&quot; + raffleData
					+ &quot;|retailerName=&quot; + Util.getOrgNameFromTktNo((commonBean.getTicket_no() + commonBean.getReprintCount()), (String) application.getAttribute(&quot;ORG_TYPE_ON_TICKET&quot;))
					+ commonContextPurchaseData());
		}
<span class="nc" id="L429">		return appletHeight;</span>
	}

	public static String commonContextPurchaseData() {
<span class="nc" id="L433">		ServletContext application = ServletActionContext.getServletContext();</span>
<span class="nc" id="L434">		StringBuilder commonData = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L435">		commonData.append(&quot;|currSymbol=&quot; + application.getAttribute(&quot;CURRENCY_SYMBOL&quot;) </span>
						+ &quot;|orgName=&quot; + application.getAttribute(&quot;ORG_NAME_JSP&quot;) 
						+ &quot;|advtMsg=&quot; + application.getAttribute(&quot;ADVT_MSG&quot;) 
						+ &quot;|orgAddress=&quot; + application.getAttribute(&quot;ORG_ADDRESS&quot;) 
						+ &quot;|orgMobile=&quot; + application.getAttribute(&quot;ORG_MOBILE&quot;)
						+ &quot;|ticketExpiryEnabled=&quot; + application.getAttribute(&quot;TICKET_EXPIRY_ENABLED&quot;));
<span class="nc" id="L441">		return commonData.toString();</span>
	}
	
	/**
	 *  This method was commented because it was not in use in LMS anywhere - Sumit Date : 16April 2013 (Code Optimization)
	 * @param fmlyWiseData
	 * @param commonBean
	 * @param appletHeight
	 * @return
	 */

	/*public static int fmlyWisePurchaseDataForApplet(StringBuilder fmlyWiseData,
			CommonPurchaseBean commonBean, int appletHeight) {
		if (commonBean != null) {
			String fmlyType = Util.getGameType(commonBean.getGame_no());
			if (&quot;Fortune&quot;.equalsIgnoreCase(fmlyType)) {
				appletHeight = fortuneFmlyPurchaseDataForApplet(fmlyWiseData,
						commonBean, appletHeight);
			} else if (&quot;Lotto&quot;.equalsIgnoreCase(fmlyType)) {
				appletHeight = lottoFmlyPurchaseDataForApplet(fmlyWiseData,
						commonBean, appletHeight);
			} else if (&quot;Keno&quot;.equalsIgnoreCase(fmlyType)) {
				appletHeight = kenoFmlyPurchaseDataForApplet(fmlyWiseData,
						commonBean, appletHeight);
			}
		}
		return appletHeight;
	}*/

	public static int fortuneFmlyPurchaseDataForApplet(
			StringBuilder fmlyWiseData, CommonPurchaseBean commonBean,
			int appletHeight) {
<span class="nc" id="L473">		FortunePurchaseBean fortuneBean = (FortunePurchaseBean) commonBean;</span>
<span class="nc" id="L474">		StringBuilder betMulStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L475">		StringBuilder pickNumStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L476">		int totalQuantity = 0;</span>

<span class="nc" id="L478">		List&lt;Integer&gt; pickNum = fortuneBean.getPickedNumbers();</span>
<span class="nc" id="L479">		int[] betMul = fortuneBean.getBetAmountMultiple();</span>

<span class="nc bnc" id="L481" title="All 2 branches missed.">		for (int i = 0; i &lt; pickNum.size(); i++) {</span>
<span class="nc" id="L482">			pickNumStr.append(pickNum.get(i) + &quot;,&quot;);</span>
<span class="nc" id="L483">			betMulStr.append(betMul[i] + &quot;,&quot;);</span>
<span class="nc" id="L484">			totalQuantity = totalQuantity + betMul[i];</span>
		}

<span class="nc" id="L487">		appletHeight = appletHeight + pickNum.size() * 11;</span>
<span class="nc" id="L488">		fmlyWiseData.append(&quot;|pickedNumbers=&quot; + pickNumStr.toString()</span>
				+ &quot;|betAmountMultiple=&quot; + betMulStr.toString() + &quot;|isQP=&quot;
				+ fortuneBean.getIsQP() + &quot;|totalQuantity=&quot; + totalQuantity);
<span class="nc" id="L491">		return appletHeight;</span>
	}

	public static int lottoFmlyPurchaseDataForApplet(
			StringBuilder fmlyWiseData, CommonPurchaseBean commonBean,
			int appletHeight) {
<span class="nc" id="L497">		LottoPurchaseBean lottoPurchaseBean = (LottoPurchaseBean) commonBean;</span>

<span class="nc" id="L499">		String pickNumStr = Util.convertCollToStr(</span>
				lottoPurchaseBean.getPlayerPicked()).replaceAll(&quot;, &quot;, &quot;;&quot;);
<span class="nc" id="L501">		StringBuilder quickPickArray = new StringBuilder(&quot;&quot;);</span>
<span class="nc bnc" id="L502" title="All 2 branches missed.">		for (int i = 0; i &lt; lottoPurchaseBean.getIsQuickPick().length; i++) {</span>
<span class="nc" id="L503">			quickPickArray.append(lottoPurchaseBean.getIsQuickPick()[i] + &quot;,&quot;);</span>
		}

<span class="nc" id="L506">		int totalQuantity = lottoPurchaseBean.getPanel_id().length;</span>
<span class="nc bnc" id="L507" title="All 2 branches missed.">		if (&quot;Perm6&quot;.equalsIgnoreCase(lottoPurchaseBean.getPlayType())) {</span>
<span class="nc" id="L508">			totalQuantity = lottoPurchaseBean.getNoOfLines();</span>
		}

<span class="nc" id="L511">		appletHeight = appletHeight</span>
				+ lottoPurchaseBean.getPlayerPicked().size() * 11;
<span class="nc" id="L513">		fmlyWiseData.append(&quot;|pickedNumbers=&quot; + pickNumStr</span>
				+ &quot;|isQuickPickArray=&quot; + quickPickArray.toString()
				+ &quot;|playType=&quot; + lottoPurchaseBean.getPlayType()
				+ &quot;|unitPrice=&quot; + lottoPurchaseBean.getUnitPrice()
				+ &quot;|totalQuantity=&quot; + totalQuantity);
<span class="nc" id="L518">		return appletHeight;</span>
	}

	/**
	 *  This method was commented because it was not in use in LMS anywhere - Sumit Date : 16April 2013 (Code Optimization)
	 * @param fmlyWiseData
	 * @param commonBean
	 * @param appletHeight
	 * @return
	 */
/*	public static int kenoFmlyPurchaseDataForApplet(StringBuilder fmlyWiseData,
			CommonPurchaseBean commonBean, int appletHeight) {
		KenoPurchaseBean kenoBean = (KenoPurchaseBean) commonBean;

		int noOfDraws = kenoBean.getNoOfDraws();

		String[] playerDataApp = kenoBean.getPlayerData();
		String[] playType = kenoBean.getPlayType();
		int[] noOfLines = kenoBean.getNoOfLines();
		double[] unitPrice = kenoBean.getUnitPrice();
		int[] betAmtMul = kenoBean.getBetAmountMultiple();
		int[] isQP = kenoBean.getIsQuickPick();

		StringBuilder playerDataStr = new StringBuilder(&quot; &quot;);
		StringBuilder playTypeStr = new StringBuilder(&quot; &quot;);
		StringBuilder noOfLinesStr = new StringBuilder(&quot; &quot;);
		StringBuilder unitPriceStr = new StringBuilder(&quot; &quot;);
		StringBuilder isQPStr = new StringBuilder(&quot; &quot;);
		StringBuilder panelPriceStr = new StringBuilder(&quot; &quot;);

		if (playerDataApp.length &gt; 0) {
			playerDataStr.deleteCharAt(playerDataStr.length() - 1);
			playTypeStr.deleteCharAt(playTypeStr.length() - 1);
			noOfLinesStr.deleteCharAt(noOfLinesStr.length() - 1);
			unitPriceStr.deleteCharAt(unitPriceStr.length() - 1);
			isQPStr.deleteCharAt(isQPStr.length() - 1);
			panelPriceStr.deleteCharAt(panelPriceStr.length() - 1);

			for (int panelId = 0; panelId &lt; playerDataApp.length; panelId++) {
				playerDataStr.append(playerDataApp[panelId] + &quot;~&quot;);
				playTypeStr.append(playType[panelId].replaceAll(&quot;Perm&quot;, &quot;Pick&quot;)
						+ &quot;~&quot;);
				noOfLinesStr.append(noOfLines[panelId] + &quot;~&quot;);
				if(&quot;KenoTwo&quot;.equalsIgnoreCase(Util.getGameName(commonBean.getGame_no()))){
					unitPriceStr.append(new DecimalFormat(&quot;#.#&quot;).format(unitPrice[panelId] * betAmtMul[panelId]) + &quot;~&quot;);
				} else if(&quot;Keno&quot;.equalsIgnoreCase(Util.getGameName(commonBean.getGame_no()))){
					unitPriceStr.append((unitPrice[panelId] * betAmtMul[panelId]) + &quot;~&quot;);
				}
				
				isQPStr.append(isQP[panelId] + &quot;~&quot;);
				panelPriceStr.append((unitPrice[panelId] * betAmtMul[panelId]
						* noOfLines[panelId] * noOfDraws)
						+ &quot;~&quot;);

				appletHeight = appletHeight + 66;
			}

			playerDataStr.deleteCharAt(playerDataStr.length() - 1);
			playTypeStr.deleteCharAt(playTypeStr.length() - 1);
			noOfLinesStr.deleteCharAt(noOfLinesStr.length() - 1);
			unitPriceStr.deleteCharAt(unitPriceStr.length() - 1);
			isQPStr.deleteCharAt(isQPStr.length() - 1);
			panelPriceStr.deleteCharAt(panelPriceStr.length() - 1);
		}

		String finalData = &quot;|pickedNumbers=&quot; + playerDataStr + &quot;|isQP=&quot;
				+ isQPStr + &quot;|totalQuantity=&quot; + noOfLinesStr + &quot;|playType=&quot;
				+ playTypeStr + &quot;|unitPriceStr=&quot; + unitPriceStr
				+ &quot;|panelPriceStr=&quot; + panelPriceStr;
		System.out.println(&quot;KENO TWO PURCHASE DATA: &quot; + finalData);

		String promoData = &quot;&quot;;

		if (kenoBean.getPromoPurchaseBean() != null) {
			finalData = finalData + &quot;|ctr=&quot; + (appletHeight + 100 + 300);
			promoData = getPromoData(kenoBean.getPromoPurchaseBean(),
					commonContextPurchaseData());
			if (promoData.length() &gt; 0) {
				promoData = &quot;PROMO&quot; + promoData + &quot;|ctr=&quot;
						+ (appletHeight + 100 + 300);
			}
		} else {
			finalData = finalData + &quot;|ctr=&quot; + (appletHeight + 100);
		}
		String appData = finalData + promoData;
		System.out.println(&quot;KENO TWO PURCHASE CUM PROMO DATA: &quot; + appData);
		fmlyWiseData.append(appData);
		return appletHeight;
	}
	*/
	public static int getTempReceiptData(HttpSession session, StringBuilder tempRecptData, StringBuilder isTempRcpt, int appletHeight){
<span class="nc" id="L609">		Map pwtAppMap = (Map) session.getAttribute(&quot;plrPwtAppDetMap&quot;);</span>
<span class="nc" id="L610">		boolean isAnonymous = true;</span>
<span class="nc" id="L611">		PlayerBean plrBean = null;</span>
<span class="nc" id="L612">		String recId = null;</span>
<span class="nc" id="L613">		double netAmtToBePaid = 0.0;</span>
				
<span class="nc bnc" id="L615" title="All 4 branches missed.">		if(pwtAppMap != null &amp;&amp; pwtAppMap.size() &gt; 0){</span>
<span class="nc" id="L616">			isAnonymous = (Boolean)pwtAppMap.get(&quot;isAnonymous&quot;);</span>
<span class="nc" id="L617">			plrBean = (PlayerBean)pwtAppMap.get(&quot;plrBean&quot;);</span>
<span class="nc" id="L618">			recId = (String)pwtAppMap.get(&quot;recId&quot;);</span>
<span class="nc" id="L619">			netAmtToBePaid = (Double)pwtAppMap.get(&quot;NET_AMOUNT_PAID&quot;);</span>
		}
<span class="nc bnc" id="L621" title="All 8 branches missed.">		if(!isAnonymous &amp;&amp; plrBean != null &amp;&amp; recId != null &amp;&amp; netAmtToBePaid &gt; 0.0){</span>
<span class="nc" id="L622">			isTempRcpt.delete(0, isTempRcpt.length());</span>
<span class="nc" id="L623">			isTempRcpt.append(&quot;true&quot;);</span>
<span class="nc" id="L624">			tempRecptData.append(&quot;|tempRecptData=true&quot;);</span>
			
<span class="nc" id="L626">			NumberFormat numFrmt = NumberFormat.getInstance();</span>
<span class="nc" id="L627">			numFrmt.setMinimumFractionDigits(2);</span>
						
<span class="nc" id="L629">			tempRecptData.append(&quot;|receiptId=&quot; + recId </span>
							+ &quot;|playerName=&quot; + plrBean.getFirstName() + &quot; &quot; + plrBean.getLastName()
							+ &quot;|netAmtToBePaid=&quot; + numFrmt.format(netAmtToBePaid).replaceAll(&quot;,&quot;, &quot;&quot;)	
							+ &quot;|playerCity=&quot; + plrBean.getPlrCity()
							+ &quot;|playerIdType=&quot; + plrBean.getIdType()
							+ &quot;|playerIdNo=&quot; + plrBean.getIdNumber()
							+ &quot;|rcptGenTime=&quot; + new Timestamp(new Date().getTime()).toString()		
			);
<span class="nc" id="L637">			appletHeight = appletHeight + 225;</span>
<span class="nc" id="L638">		} else {</span>
<span class="nc" id="L639">			tempRecptData.append(&quot;|tempRecptData=false&quot;);</span>
		}
<span class="nc" id="L641">		return appletHeight;</span>
	}
	
	/**
	 * This method was commented because it was not in use in LMS anywhere - Sumit Date : 16April 2013 (Code Optimization)
	 * @param winningBean
	 * @param pwtData
	 * @param isReprint
	 * @param isFortune
	 * @param isTempRcpt
	 * @param appletHeight
	 * @return
	 */
	/*public static int pwtDataForApplet(MainPWTDrawBean mainPWTBean, StringBuilder finalData, int appletHeight){
		if(mainPWTBean != null){
			HttpSession session = new UtilApplet().getRequest().getSession();
			StringBuilder tempRecptData = new StringBuilder(&quot;&quot;);
			StringBuilder isTempRcpt = new StringBuilder(&quot;false&quot;);
			if(session != null){
				appletHeight = getTempReceiptData(session, tempRecptData, isTempRcpt, appletHeight);
			}
			
			boolean isReprint = mainPWTBean.isReprint();
			if(isReprint){
				CommonPurchaseBean commonBean = (CommonPurchaseBean) mainPWTBean.getPurchaseBean();
				StringBuilder purchaseReprintData = new StringBuilder(&quot;&quot;);
				StringBuilder fmlyWiseData = new StringBuilder(&quot;&quot;);
				
				appletHeight = commonPurchaseDataForApplet(purchaseReprintData, commonBean, appletHeight);
				appletHeight = fmlyWisePurchaseDataForApplet(fmlyWiseData, commonBean, appletHeight);
				
				finalData.append(purchaseReprintData);
			}
			
			List&lt;PWTDrawBean&gt; winningBeanList = mainPWTBean.getWinningBeanList();
			if(winningBeanList != null &amp;&amp; winningBeanList.size() &gt; 0){
				boolean isFortune = false;
				String fmlyType = Util.getGameType(2);
				if(&quot;Fortune&quot;.equalsIgnoreCase(fmlyType)){
					isFortune = true;
				}
				for (int k = 0; k &lt; winningBeanList.size(); k++) {
					PWTDrawBean winningBean = winningBeanList.get(k);
					if(winningBean != null){
						String pwtTktType = winningBean.getPwtTicketType();
						if(&quot;DRAW&quot;.equalsIgnoreCase(pwtTktType)){
							StringBuilder pwtData = new StringBuilder(&quot;&quot;);
							appletHeight = commonPwtDataForApplet(winningBean, pwtData, isReprint, isFortune, isTempRcpt, appletHeight);
							finalData.append(pwtData);
						} else if(&quot;RAFFLE&quot;.equalsIgnoreCase(pwtTktType)){
							StringBuilder raffleData = new StringBuilder(&quot; &quot;);
							if (winningBean.getRaffleDrawIdBeanList() != null) {
								appletHeight = getRaffPWTData(winningBean.getRaffleDrawIdBeanList(), raffleData,appletHeight);
							}
							finalData.append(&quot;|raffPWTData=&quot; + raffleData);
						}
					}
				}
			}
			finalData.append(tempRecptData);
		}
		return appletHeight;
	}*/
	
	public static int commonPwtDataForApplet(PWTDrawBean winningBean, StringBuilder pwtData, boolean isReprint, boolean isFortune, StringBuilder isTempRcpt, int appletHeight){
<span class="nc" id="L706">		ServletContext application = ServletActionContext.getServletContext();</span>
		
		
<span class="nc" id="L709">		List&lt;DrawIdBean&gt; drawWinList = winningBean.getDrawWinList();</span>
<span class="nc" id="L710">		int winSize = drawWinList.size();</span>
		
<span class="nc" id="L712">		int[] nonWin = new int[winSize];</span>
<span class="nc" id="L713">		int[] win = new int[winSize];</span>
<span class="nc" id="L714">		int[] register = new int[winSize];</span>
<span class="nc" id="L715">		int[] claim = new int[winSize];</span>
<span class="nc" id="L716">		int[] outVerify = new int[winSize];</span>
<span class="nc" id="L717">		int[] pndPay = new int[winSize];</span>
<span class="nc" id="L718">		double[] drawAmt = new double[winSize];</span>
<span class="nc" id="L719">		boolean[] isResAwaited = new boolean[winSize];</span>
		
<span class="nc" id="L721">		int totRegister = 0;</span>
<span class="nc" id="L722">		double totTktAmt = 0.0;</span>
		
<span class="nc" id="L724">		StringBuilder nonWinStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L725">		StringBuilder winStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L726">		StringBuilder registerStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L727">		StringBuilder claimStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L728">		StringBuilder outVerifyStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L729">		StringBuilder pndPayStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L730">		StringBuilder resultAwaitedStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L731">		StringBuilder drawAmtStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L732">		StringBuilder drawDateTimeStr = new StringBuilder(&quot;&quot;);</span>
		
<span class="nc bnc" id="L734" title="All 2 branches missed.">		for (int i = 0; i &lt; winSize; i++) {</span>
<span class="nc" id="L735">			DrawIdBean drawBean = drawWinList.get(i);</span>
<span class="nc" id="L736">			drawDateTimeStr.append(drawBean.getDrawDateTime() + &quot;,&quot;);</span>
<span class="nc" id="L737">			List&lt;PanelIdBean&gt; panelWinList = drawBean.getPanelWinList();</span>
<span class="nc bnc" id="L738" title="All 2 branches missed.">			if(panelWinList != null){</span>
<span class="nc bnc" id="L739" title="All 2 branches missed.">				for (int j = 0; j &lt; panelWinList.size(); j++) {</span>
<span class="nc" id="L740">					PanelIdBean panelBean = panelWinList.get(j);</span>
<span class="nc bnc" id="L741" title="All 2 branches missed.">					if(panelBean != null){</span>
<span class="nc" id="L742">						String panelStatus = panelBean.getStatus();</span>
<span class="nc" id="L743">						int betMultiple = 1;</span>
						
<span class="nc bnc" id="L745" title="All 2 branches missed.">						if(isFortune){</span>
<span class="nc" id="L746">							betMultiple = panelBean.getBetAmtMultiple();</span>
						}
						
<span class="nc bnc" id="L749" title="All 2 branches missed.">						if(&quot;NON WIN&quot;.equalsIgnoreCase(panelBean.getStatus())) {</span>
<span class="nc" id="L750">							nonWin[i] += betMultiple;</span>
<span class="nc bnc" id="L751" title="All 2 branches missed.">						} else if(&quot;NORMAL_PAY&quot;.equalsIgnoreCase(panelStatus)){</span>
<span class="nc" id="L752">							drawAmt[i] = drawAmt[i] + panelBean.getWinningAmt();</span>
<span class="nc" id="L753">							win[i] += betMultiple;</span>
<span class="nc bnc" id="L754" title="All 2 branches missed.">						} else if(&quot;CLAIMED&quot;.equalsIgnoreCase(panelStatus)){</span>
<span class="nc" id="L755">							claim[i] += betMultiple;</span>
<span class="nc bnc" id="L756" title="All 2 branches missed.">						} else if(&quot;PND_PAY&quot;.equalsIgnoreCase(panelStatus)){</span>
<span class="nc" id="L757">							pndPay[i] += betMultiple;</span>
<span class="nc bnc" id="L758" title="All 2 branches missed.">						} else if(&quot;HIGH_PRIZE&quot;.equalsIgnoreCase(panelStatus)){</span>
<span class="nc" id="L759">							register[i] += betMultiple;</span>
<span class="nc bnc" id="L760" title="All 2 branches missed.">						} else if(&quot;OUT_PAY_LIMIT&quot;.equalsIgnoreCase(panelStatus)){</span>
<span class="nc" id="L761">							register[i] += betMultiple;</span>
<span class="nc bnc" id="L762" title="All 2 branches missed.">						} else if(&quot;OUT_VERIFY_LIMIT&quot;.equalsIgnoreCase(panelStatus)){</span>
<span class="nc" id="L763">							outVerify[i] += betMultiple;</span>
						} 
					}
				}
				
<span class="nc" id="L768">				nonWinStr.append(nonWin[i] + &quot;,&quot;);</span>
<span class="nc" id="L769">				drawAmtStr.append(drawAmt[i] + &quot;,&quot;);</span>
<span class="nc" id="L770">				winStr.append(win[i] + &quot;,&quot;);</span>
<span class="nc" id="L771">				claimStr.append(claim[i] + &quot;,&quot;);</span>
<span class="nc" id="L772">				pndPayStr.append(pndPay[i] + &quot;,&quot;);</span>
<span class="nc" id="L773">				registerStr.append(register[i] + &quot;,&quot;);</span>
<span class="nc" id="L774">				outVerifyStr.append(outVerify[i] + &quot;,&quot;);</span>
<span class="nc" id="L775">				isResAwaited[i] = false;</span>
<span class="nc" id="L776">				resultAwaitedStr.append(isResAwaited[i] + &quot;,&quot;);</span>
<span class="nc" id="L777">				totRegister = totRegister + register[i];</span>
			} else {
<span class="nc" id="L779">				nonWinStr.append(&quot;NA,&quot;);</span>
<span class="nc" id="L780">				drawAmtStr.append(&quot;NA,&quot;);</span>
<span class="nc" id="L781">				winStr.append(&quot;NA,&quot;);</span>
<span class="nc" id="L782">				claimStr.append(&quot;NA,&quot;);</span>
<span class="nc" id="L783">				pndPayStr.append(&quot;NA,&quot;);</span>
<span class="nc" id="L784">				registerStr.append(&quot;NA,&quot;);</span>
<span class="nc" id="L785">				outVerifyStr.append(&quot;NA,&quot;);</span>
<span class="nc" id="L786">				isResAwaited[i] = true;</span>
<span class="nc" id="L787">				resultAwaitedStr.append(isResAwaited[i] + &quot;,&quot;);</span>
				
			}
<span class="nc" id="L790">			totTktAmt = drawAmt[i] + totTktAmt;</span>
		}
		
<span class="nc bnc" id="L793" title="All 2 branches missed.">		if(!&quot;true&quot;.equalsIgnoreCase(isTempRcpt.toString())){</span>
<span class="nc" id="L794">			StringBuilder topMsgsStrPwt = new StringBuilder(&quot; &quot;);</span>
<span class="nc" id="L795">			StringBuilder bottomMsgsStrPwt = new StringBuilder(&quot; &quot;);</span>
<span class="nc" id="L796">			appletHeight = UtilApplet.getAdvMsgs(winningBean.getAdvMsg(), topMsgsStrPwt, bottomMsgsStrPwt, appletHeight);	</span>
			
<span class="nc bnc" id="L798" title="All 2 branches missed.">			if(!isReprint){</span>
<span class="nc" id="L799">				pwtData.append(&quot;data=&quot; + winningBean.getTicketNo() + winningBean.getReprintCount());</span>
			}

<span class="nc" id="L802">			pwtData.append(&quot;|reprintCountPWT=&quot; + winningBean.getReprintCount()</span>
						+ &quot;|mode=PWT|orgName=&quot; + application.getAttribute(&quot;ORG_NAME_JSP&quot;)
						+ &quot;|advtMsg=&quot; + application.getAttribute(&quot;ADVT_MSG&quot;)
						+ &quot;|isValid=&quot; + String.valueOf(winningBean.isValid())
						+ &quot;|isReprint=&quot; + String.valueOf(isReprint)
						+ &quot;|gameName=&quot; + Util.getGameName(winningBean.getGameNo())
						+ &quot;|gameDispName=&quot; + winningBean.getGameDispName()
						+ &quot;|ticketNumber=&quot; + winningBean.getTicketNo()
						+ &quot;|drawDateTime=&quot; + drawDateTimeStr.toString()
						+ &quot;|currSymbol=&quot; + application.getAttribute(&quot;CURRENCY_SYMBOL&quot;)
						+ &quot;|status=&quot; + winningBean.getStatus()
						+ &quot;|topAdvMsgPwt=&quot; + topMsgsStrPwt
						+ &quot;|bottomAdvMsgPwt=&quot; + bottomMsgsStrPwt
						+ &quot;|nonWinStr=&quot; + nonWinStr.toString()
						+ &quot;|winStr=&quot; + winStr.toString()
						+ &quot;|registerStr=&quot; + registerStr.toString()
						+ &quot;|claimStr=&quot; + claimStr.toString()
						+ &quot;|outVerifyStr=&quot; + outVerifyStr.toString()
						+ &quot;|pndPayStr=&quot; + pndPayStr.toString()
						+ &quot;|resultAwaitedStr=&quot; + resultAwaitedStr.toString()
						+ &quot;|retailerName=&quot; + Util.getOrgNameFromTktNo((winningBean.getTicketNo() + winningBean.getReprintCount()), (String)application.getAttribute(&quot;ORG_TYPE_ON_TICKET&quot;))
						+ &quot;|drawAmtStr=&quot; + drawAmtStr.toString());
				
<span class="nc" id="L825">		} else {</span>
<span class="nc bnc" id="L826" title="All 2 branches missed.">			if(!isReprint){</span>
<span class="nc" id="L827">				pwtData.append(&quot;data=&quot; + winningBean.getTicketNo() + winningBean.getReprintCount() + &quot;|&quot;);</span>
				
<span class="nc" id="L829">				pwtData.append(&quot;mode=PWT|gameDispName=&quot; + winningBean.getGameDispName()</span>
						+ &quot;|ticketNumber=&quot; + winningBean.getTicketNo()
						+ &quot;|orgName=&quot; + application.getAttribute(&quot;ORG_NAME_JSP&quot;)
						+ &quot;|currSymbol=&quot; + application.getAttribute(&quot;CURRENCY_SYMBOL&quot;));
			}
			
<span class="nc" id="L835">			pwtData.append(&quot;|reprintCountPWT=&quot; + winningBean.getReprintCount()</span>
					+ &quot;|mode=PWT|isReprint=&quot; + String.valueOf(isReprint)
					+ &quot;|retailerName=&quot; + Util.getOrgNameFromTktNo((winningBean.getTicketNo() + winningBean.getReprintCount()), (String)application.getAttribute(&quot;ORG_TYPE_ON_TICKET&quot;))
					+ &quot;|drawDateTime=&quot; + drawDateTimeStr.toString());
		}
<span class="nc" id="L840">		System.out.println(&quot;**pwtData**isTempRcpt***&quot; + pwtData + &quot;***&quot;);</span>
<span class="nc" id="L841">		return appletHeight;</span>
	}

	public void setServletRequest(HttpServletRequest request) {
<span class="nc" id="L845">		this.request = request;</span>
<span class="nc" id="L846">	}</span>

	public HttpServletRequest getRequest() {
<span class="nc" id="L849">		return request;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>