<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AgentDispatchGameAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.web.scratchService.inventoryMgmt.common</a> &gt; <span class="el_source">AgentDispatchGameAction.java</span></div><h1>AgentDispatchGameAction.java</h1><pre class="source lang-java linenums">/*
 * ï¿½ copyright 2007, SkilRock Technologies, A division of Sugal &amp; Damani Lottery Agency Pvt. Ltd.
 * All Rights Reserved
 * The contents of this file are the property of Sugal &amp; Damani Lottery Agency Pvt. Ltd.
 * and are subject to a License agreement with Sugal &amp; Damani Lottery Agency Pvt. Ltd.; you may
 * not use this file except in compliance with that License.  You may obtain a
 * copy of that license from:
 * Legal Department
 * Sugal &amp; Damani Lottery Agency Pvt. Ltd.
 * 6/35,WEA, Karol Bagh,
 * New Delhi
 * India - 110005
 * This software is distributed under the License and is provided on an ï¿½AS ISï¿½
 * basis, without warranty of any kind, either express or implied, unless
 * otherwise provided in the License.  See the License for governing rights and
 * limitations under the License.
 */

package com.skilrock.lms.web.scratchService.inventoryMgmt.common;

import java.sql.Connection;
import java.sql.SQLException;
import java.text.DecimalFormat;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.StringTokenizer;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.struts2.interceptor.ServletRequestAware;
import org.apache.struts2.interceptor.ServletResponseAware;

import com.opensymphony.xwork2.ActionSupport;
import com.skilrock.lms.GameContants;
import com.skilrock.lms.beans.BookBean;
import com.skilrock.lms.beans.BookSeriesBean;
import com.skilrock.lms.beans.DispatchOrderResponse;
import com.skilrock.lms.beans.InvOrderBean;
import com.skilrock.lms.beans.OrderBean;
import com.skilrock.lms.beans.OrderedGameBean;
import com.skilrock.lms.beans.OrgAddressBean;
import com.skilrock.lms.beans.PackBean;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.TableConstants;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.coreEngine.scratchService.inventoryMgmt.common.AgentDispatchGameHelper;
import com.skilrock.lms.coreEngine.scratchService.inventoryMgmt.common.AgentOrderProcessHelper;
import com.skilrock.lms.coreEngine.scratchService.inventoryMgmt.common.BODispatchGameHelper;
import com.skilrock.lms.coreEngine.scratchService.orderMgmt.common.BOOrderProcessHelper;
import com.skilrock.lms.coreEngine.scratchService.orderMgmt.common.GameDetailsHelper;

/**
 * This class provides methods for handling the order dispatch at Agent end
 * 
 * @author Skilrock Technologies
 * 
 */
<span class="nc" id="L65">public class AgentDispatchGameAction extends ActionSupport implements</span>
		ServletRequestAware, ServletResponseAware {
	public static final String APPLICATION_ERROR = &quot;applicationError&quot;;

<span class="nc" id="L69">	static Log logger = LogFactory.getLog(AgentDispatchGameAction.class);</span>

	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	private int bookCountId;

	private List&lt;BookBean&gt; bookList;

	private String[] bookNbr;
<span class="nc" id="L80">	String[] bookNbrFrmStr = null;</span>
	private Object bookNbrFromArr;
	private Object bookNbrToArr;

<span class="nc" id="L84">	String[] bookNbrToStr = null;</span>
	private String bookNbrToVerify;

	private double bookPrice;

	private List bookSeriesAll;
	private List&lt;BookBean&gt; bookSeriesList;
<span class="nc" id="L91">	private int defaultNbrOfBooks = 2;</span>
	private int gameId;

	private int gameNbr;
	private boolean isAddBookEnabled;

	private boolean isInValidEntry;
	private boolean isProceedNext;

	private int noOfBooksToDispatch;

	private OrderedGameBean orderdedGame;
	private int packCountId;

	private List&lt;PackBean&gt; packList;

	private String[] packNbr;

	private String packNbrToVerify;
	private HttpServletRequest request;

	private HttpServletResponse response;

	/**
	 * This method is called when the Add Book button is pressed
	 * 
	 * @return String
	 */
	public String addBook() {

<span class="nc" id="L121">		System.out.println(&quot;---------I am in ADD Book--------------&quot;);</span>

		// reInitialize();

<span class="nc" id="L125">		HttpServletResponse response = getResponse();</span>
<span class="nc" id="L126">		response.setHeader(&quot;Pragma&quot;, &quot;no-cache&quot;); // HTTP 1.0</span>
<span class="nc" id="L127">		response.setHeader(&quot;Cache-Control&quot;, &quot;no-cache&quot;); // HTTP 1.1</span>
<span class="nc" id="L128">		response.setDateHeader(&quot;Expires&quot;, 0); // prevents caching at the proxy</span>
		// server
<span class="nc" id="L130">		response.setHeader(&quot;Cache-Control&quot;, &quot;private&quot;); // HTTP 1.1</span>
<span class="nc" id="L131">		response.setHeader(&quot;Cache-Control&quot;, &quot;no-store&quot;); // HTTP 1.1</span>
<span class="nc" id="L132">		response.setHeader(&quot;Cache-Control&quot;, &quot;max-stale=0&quot;); // HTTP 1.1</span>

		// System.out.println(&quot;add bookkkkkkkkkkkkk::&quot; +
		// request.getParameter(&quot;hidBookNbr&quot;));

		// System.out.println(&quot;add bookkkkkkkkkkkkk::&quot; + getHidBookNbr());

<span class="nc" id="L139">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L140">		List&lt;BookBean&gt; bookList = (List&lt;BookBean&gt;) session</span>
				.getAttribute(&quot;AGT_BOOK_LIST&quot;);
<span class="nc" id="L142">		List&lt;PackBean&gt; packList = (List&lt;PackBean&gt;) session</span>
				.getAttribute(&quot;AGT_PACK_LIST&quot;);

<span class="nc" id="L145">		BookBean bookBean = null;</span>

		// copy values and add another book to the list
<span class="nc bnc" id="L148" title="All 2 branches missed.">		if (bookList != null) {</span>

<span class="nc" id="L150">			copyBookValues(bookList);</span>
<span class="nc" id="L151">			bookBean = new BookBean();</span>
<span class="nc" id="L152">			bookBean.setValid(true);</span>
<span class="nc" id="L153">			bookList.add(bookBean);</span>
<span class="nc" id="L154">			setBookList(bookList);</span>
		}

		/*
		 * try { PrintWriter out = getResponse().getWriter(); out.write(&quot;This is
		 * Aman Chawla&quot;); } catch (IOException e) { // TODO Auto-generated catch
		 * block e.printStackTrace(); }
		 */

<span class="nc" id="L163">		return SUCCESS;</span>

	}

	private void changeDispatchBooks() {

<span class="nc" id="L169">		HttpSession session = getRequest().getSession();</span>

<span class="nc" id="L171">		List&lt;PackBean&gt; packList = (List&lt;PackBean&gt;) session</span>
				.getAttribute(&quot;AGT_PACK_LIST&quot;);

<span class="nc" id="L174">		List&lt;BookBean&gt; bookList = (List&lt;BookBean&gt;) session</span>
				.getAttribute(&quot;AGT_BOOK_LIST&quot;);

<span class="nc" id="L177">		List&lt;BookBean&gt; bookSeriesList = (List&lt;BookBean&gt;) session</span>
				.getAttribute(&quot;BOOK_SERIES_LIST&quot;);

		// for books
<span class="nc" id="L181">		String bookNbr = null;</span>
<span class="nc" id="L182">		System.out</span>
				.println(&quot;-----:::::::::::::::::::::::::::::::::::::::::::::::::::::::&quot;
						+ getNoOfBooksToDispatch());
<span class="nc bnc" id="L185" title="All 2 branches missed.">		if (bookList != null) {</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">			for (BookBean bean : bookList) {</span>
<span class="nc" id="L187">				bookNbr = bean.getBookNumber();</span>

<span class="nc bnc" id="L189" title="All 4 branches missed.">				if (bookNbr != null &amp;&amp; !bookNbr.trim().equals(&quot;&quot;)) {</span>

<span class="nc bnc" id="L191" title="All 2 branches missed.">					if (bean.getIsValid()) {</span>
<span class="nc" id="L192">						setNoOfBooksToDispatch(getNoOfBooksToDispatch() + 1);</span>
<span class="nc" id="L193">						System.out</span>
								.println(&quot;-----:::::::::::::::::::::::::::::::::::::::::::::::::::::::after add book&quot;
										+ getNoOfBooksToDispatch());
					}
				}

<span class="nc" id="L199">			}</span>
		}

		// for book Series List
<span class="nc bnc" id="L203" title="All 2 branches missed.">		if (bookSeriesList != null) {</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">			for (BookBean bean : bookSeriesList) {</span>
<span class="nc" id="L205">				bookNbr = bean.getBookNumber();</span>

<span class="nc bnc" id="L207" title="All 4 branches missed.">				if (bookNbr != null &amp;&amp; !bookNbr.trim().equals(&quot;&quot;)) {</span>

<span class="nc bnc" id="L209" title="All 2 branches missed.">					if (bean.getIsValid()) {</span>
<span class="nc" id="L210">						setNoOfBooksToDispatch(getNoOfBooksToDispatch() + 1);</span>
					}

				}

<span class="nc" id="L215">			}</span>
		}

		// for packs
<span class="nc" id="L219">		String packNbr = null;</span>
<span class="nc bnc" id="L220" title="All 2 branches missed.">		if (packList != null) {</span>

<span class="nc" id="L222">			OrderedGameBean gameBean = (OrderedGameBean) session</span>
					.getAttribute(&quot;AGT_ORDERED_GAME&quot;);

<span class="nc" id="L225">			int booksPerPack = gameBean.getNbrOfBooksPerPack();</span>

<span class="nc bnc" id="L227" title="All 2 branches missed.">			for (PackBean bean : packList) {</span>
<span class="nc" id="L228">				packNbr = bean.getPackNumber();</span>

<span class="nc bnc" id="L230" title="All 4 branches missed.">				if (packNbr != null &amp;&amp; !packNbr.trim().equals(&quot;&quot;)) {</span>

<span class="nc bnc" id="L232" title="All 2 branches missed.">					if (bean.getIsValid()) {</span>

<span class="nc" id="L234">						setNoOfBooksToDispatch(getNoOfBooksToDispatch()</span>
								+ booksPerPack);
					}
				}

<span class="nc" id="L239">			}</span>
		}
<span class="nc" id="L241">		System.out</span>
				.println(&quot;-----:::::::::::::::::::::::::::::::::::::::::::::::::::::::&quot;
						+ getNoOfBooksToDispatch());

<span class="nc" id="L245">	}</span>

	public void checkValidBookInseries(List&lt;BookBean&gt; bookSeriesList) {
<span class="nc" id="L248">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L249">		List bookSeriesAll = (ArrayList) session</span>
				.getAttribute(&quot;BOOK_SERIES_ALL&quot;);
<span class="nc" id="L251">		String bookNbr = null;</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">		if (bookSeriesList != null) {</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">			for (BookBean bean : bookSeriesList) {</span>
<span class="nc" id="L254">				bookNbr = bean.getBookNumber();</span>

<span class="nc bnc" id="L256" title="All 4 branches missed.">				if (bookNbr != null &amp;&amp; !bookNbr.trim().equals(&quot;&quot;)) {</span>
					// System.out.println(&quot;--in
					// book=series---&quot;+bean.getIsValid());

<span class="nc bnc" id="L260" title="All 2 branches missed.">					if (!bean.getIsValid()) {</span>
<span class="nc" id="L261">						int bookNum = Integer.parseInt(bookNbr.replaceAll(&quot;-&quot;,</span>
								&quot;&quot;));
						BookSeriesBean bookSeBean;
<span class="nc bnc" id="L264" title="All 2 branches missed.">						for (int i = 0; i &lt; bookSeriesAll.size(); i++) {</span>
<span class="nc" id="L265">							bookSeBean = (BookSeriesBean) bookSeriesAll.get(i);</span>
<span class="nc" id="L266">							System.out.println(bookSeBean.getBookNbrFrom()</span>
									+ &quot;--in bookserieslist---&quot; + bookNum
									+ &quot;--------&quot; + bookSeBean.getBookNbrTo());

<span class="nc bnc" id="L270" title="All 4 branches missed.">							if (Integer.parseInt(bookSeBean.getBookNbrFrom()</span>
									.replaceAll(&quot;-&quot;, &quot;&quot;)) &lt;= bookNum
									&amp;&amp; Integer
											.parseInt(bookSeBean.getBookNbrTo()
													.replaceAll(&quot;-&quot;, &quot;&quot;)) &gt;= bookNum) {
								// System.out.println(bookSeBean.getBookNbrFrom()+&quot;--in
								// bookserieslist---&quot;+bookNum);
<span class="nc" id="L277">								bookSeBean</span>
										.setStatus(&quot;Tickets in Series are Already in Pack&quot;);
<span class="nc" id="L279">								setBookSeriesAll(bookSeriesAll);</span>
							}
						}
					}
				}

<span class="nc" id="L285">			}</span>
		}

<span class="nc" id="L288">		session.setAttribute(&quot;BOOK_SERIES_ALL&quot;, bookSeriesAll);</span>
		// System.out.println(&quot;--in bookserieslist-after
		// sett--&quot;+((BookSeriesBean)bookSeriesAll.get(0)).getStatus());
<span class="nc" id="L291">	}</span>

	private void copyBookValues(List&lt;BookBean&gt; bookList) {
<span class="nc" id="L294">		BookBean bookBean = null;</span>

<span class="nc" id="L296">		System.out.println(&quot;Agent BookNbr Array::&quot; + getBookNbr());</span>

<span class="nc" id="L298">		System.out</span>
				.println(&quot;Nbr of boks to dispatch&quot; + getNoOfBooksToDispatch());

<span class="nc" id="L301">		String[] bookNbr = getBookNbr();</span>
<span class="nc" id="L302">		System.out.println(&quot;Agent BookNbr.length:&quot; + bookNbr.length);</span>

<span class="nc" id="L304">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L305">		OrderedGameBean agtOrderedGameBean = (OrderedGameBean) session</span>
				.getAttribute(&quot;AGT_ORDERED_GAME&quot;);

		// create tokens and set values in the book list

<span class="nc bnc" id="L310" title="All 2 branches missed.">		if (bookNbr != null) {</span>

<span class="nc bnc" id="L312" title="All 2 branches missed.">			if (bookNbr.length == 1) {</span>

<span class="nc" id="L314">				String bookVal = null;</span>
<span class="nc" id="L315">				StringTokenizer bookTokens = new StringTokenizer(bookNbr[0],</span>
						&quot;,&quot;);

<span class="nc" id="L318">				System.out.println(&quot;Agent Value Passed::&quot; + bookNbr[0]);</span>
<span class="nc" id="L319">				System.out.println(&quot;Agent BookTokens::&quot;</span>
						+ bookTokens.countTokens());

<span class="nc" id="L322">				int i = 0;</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">				while (bookTokens.hasMoreTokens()) {</span>

<span class="nc" id="L325">					bookVal = bookTokens.nextToken();</span>
<span class="nc" id="L326">					System.out.println(bookVal);</span>

<span class="nc" id="L328">					bookVal = bookVal.trim();</span>
<span class="nc bnc" id="L329" title="All 4 branches missed.">					if (bookVal.indexOf(&quot;-&quot;) == -1</span>
							&amp;&amp; bookVal.length() &gt; agtOrderedGameBean
									.getGameNbrDigits()) {
<span class="nc" id="L332">						bookVal = bookVal.substring(0, agtOrderedGameBean</span>
								.getGameNbrDigits())
								+ &quot;-&quot;
								+ bookVal.substring(agtOrderedGameBean
										.getGameNbrDigits());

<span class="nc" id="L338">						bookBean = new BookBean();</span>
<span class="nc" id="L339">						bookBean.setValid(true);</span>
<span class="nc" id="L340">						bookBean.setBookNumber(bookVal);</span>
<span class="nc" id="L341">						bookList.add(bookBean);</span>
					}
<span class="nc" id="L343">					i = i + 1;</span>
					// bookBean = bookList.get(i++);
					// bookBean.setBookNumber(bookVal);
				}
<span class="nc" id="L347">				setBookList(bookList);</span>
<span class="nc" id="L348">				System.out.println(&quot;After Setting BookList in copyBookValues::&quot;</span>
						+ bookList);
			}
		}

		/*
		 * for(String b : bookNbr) { System.out.println(&quot;Book:::&quot; + b); }
		 * 
		 * 
		 * 
		 * if (bookNbr != null) { System.out.println(&quot;Inside NOt Null ---BookNbr
		 * Array::&quot; + getBookNbr()); for (int i = 0; i &lt; bookNbr.length; i++) {
		 * if (!bookNbr[i].trim().equals(&quot;&quot;)) { bookBean = new BookBean();
		 * bookBean.setBookNumber(bookNbr[i]); bookList.add(bookBean); } } }
		 */

<span class="nc" id="L364">	}</span>

	private void copyPackValues(List&lt;PackBean&gt; packList) {
<span class="nc" id="L367">		PackBean packBean = null;</span>

<span class="nc" id="L369">		System.out.println(&quot;Agent PackNbr Array::&quot; + getPackNbr());</span>

<span class="nc" id="L371">		String[] packNbr = getPackNbr();</span>
<span class="nc" id="L372">		System.out.println(&quot;Agent PackNbr.length:&quot; + packNbr.length);</span>

<span class="nc" id="L374">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L375">		OrderedGameBean agtOrderedGameBean = (OrderedGameBean) session</span>
				.getAttribute(&quot;AGT_ORDERED_GAME&quot;);

		// create tokens and set values in the pack list
<span class="nc bnc" id="L379" title="All 2 branches missed.">		if (packNbr != null) {</span>

<span class="nc bnc" id="L381" title="All 2 branches missed.">			if (packNbr.length == 1) {</span>

<span class="nc" id="L383">				String packVal = null;</span>
<span class="nc" id="L384">				StringTokenizer packTokens = new StringTokenizer(packNbr[0],</span>
						&quot;,&quot;);

<span class="nc" id="L387">				System.out.println(&quot;Agent Value Passed::&quot; + packNbr[0]);</span>
<span class="nc" id="L388">				System.out.println(&quot;Agent PackTokens::&quot;</span>
						+ packTokens.countTokens());

<span class="nc" id="L391">				int i = 0;</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">				while (packTokens.hasMoreTokens()) {</span>

<span class="nc" id="L394">					packVal = packTokens.nextToken();</span>

<span class="nc" id="L396">					packVal = packVal.trim();</span>

<span class="nc bnc" id="L398" title="All 4 branches missed.">					if (packVal.indexOf(&quot;-&quot;) == -1</span>
							&amp;&amp; packVal.length() &gt; agtOrderedGameBean
									.getGameNbrDigits()) {
<span class="nc" id="L401">						packVal = packVal.substring(0, agtOrderedGameBean</span>
								.getGameNbrDigits())
								+ &quot;-&quot;
								+ packVal.substring(agtOrderedGameBean
										.getGameNbrDigits());
					}

<span class="nc" id="L408">					System.out.println(packVal);</span>
<span class="nc" id="L409">					packBean = packList.get(i++);</span>
<span class="nc" id="L410">					packBean.setPackNumber(packVal);</span>
				}
			}
		}
<span class="nc" id="L414">	}</span>

	/**
	 * This method is used to display the dispatch game page
	 * 
	 * @return String
	 */
	public String assignAgentGame() {
<span class="nc" id="L422">		HttpSession session = getRequest().getSession();</span>

		// get the ordered game from session

<span class="nc" id="L426">		OrderedGameBean bean = (OrderedGameBean) session</span>
				.getAttribute(&quot;AGT_ORDERED_GAME&quot;);
<span class="nc" id="L428">		double remainingAvailableCreditLimit = ((Double) session</span>
				.getAttribute(&quot;REMAINING_AVAILABLE_CREDIT_AMT_AGT&quot;))
				.doubleValue();
<span class="nc" id="L431">		remainingAvailableCreditLimit = remainingAvailableCreditLimit</span>
				- getBookPrice() * getNoOfBooksToDispatch();
<span class="nc" id="L433">		session.setAttribute(&quot;REMAINING_AVAILABLE_CREDIT_AMT_AGT&quot;,</span>
				remainingAvailableCreditLimit);
<span class="nc" id="L435">		System.out.println(&quot;ramaining amount is &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;   &quot;</span>
				+ remainingAvailableCreditLimit);

<span class="nc" id="L438">		List&lt;PackBean&gt; packList = null;</span>
<span class="nc" id="L439">		List&lt;BookBean&gt; bookList = null;</span>
<span class="nc" id="L440">		List&lt;BookBean&gt; bookSeriesList = new ArrayList&lt;BookBean&gt;();</span>
<span class="nc" id="L441">		List bookSeriesAll = new ArrayList();</span>

		int nbrOfAppBooks;
		int nbrOfBooksPerPack;
		int nbrOfAppBooksRemain;

<span class="nc bnc" id="L447" title="All 2 branches missed.">		if (bean != null) {</span>
<span class="nc" id="L448">			setOrderdedGame(bean);</span>
<span class="nc" id="L449">			nbrOfAppBooks = bean.getNbrOfBooksApp();</span>
<span class="nc" id="L450">			nbrOfAppBooksRemain = bean.getRemainingBooksToDispatch();</span>
<span class="nc" id="L451">			nbrOfBooksPerPack = bean.getNbrOfBooksPerPack();</span>

			// create the pack list and set packs

<span class="nc bnc" id="L455" title="All 2 branches missed.">			if (nbrOfAppBooksRemain &gt;= nbrOfBooksPerPack) {</span>
<span class="nc" id="L456">				int nbrOfPacks = nbrOfAppBooksRemain / nbrOfBooksPerPack;</span>

<span class="nc bnc" id="L458" title="All 2 branches missed.">				if (nbrOfPacks &gt; 0) {</span>

<span class="nc" id="L460">					packList = new ArrayList&lt;PackBean&gt;();</span>

					/*
					 * if (nbrOfPacks &gt; defaultNbrOfPacks) { nbrOfPacks =
					 * defaultNbrOfPacks; }
					 */

<span class="nc" id="L467">					PackBean packBean = null;</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">					for (int i = 0; i &lt; nbrOfPacks; i++) {</span>
<span class="nc" id="L469">						packBean = new PackBean();</span>
<span class="nc" id="L470">						packBean.setValid(true);</span>
<span class="nc" id="L471">						packList.add(packBean);</span>

					}

<span class="nc" id="L475">					setPackList(packList);</span>
					// session.setAttribute(&quot;AGT_PACK_LIST&quot;, packList);
				}
			}
			/*
			 * List&lt;BookBean&gt; bookList = new ArrayList&lt;BookBean&gt;(); BookBean
			 * bookBean = null; for (int i = 0; i &lt; defaultNbrOfBooks; i++) {
			 * bookBean = new BookBean(); //bookBean.setValid(true);
			 * 
			 * bookList.add(bookBean); } setBookList(bookList);
			 * session.setAttribute(&quot;AGT_BOOK_LIST&quot;, bookList);
			 */

			// create the book list and set books
<span class="nc" id="L489">			bookList = new ArrayList&lt;BookBean&gt;();</span>
<span class="nc" id="L490">			BookBean bookBean = null;</span>

<span class="nc" id="L492">			int nbrOfBooksToAdd = 0;</span>
<span class="nc bnc" id="L493" title="All 2 branches missed.">			if (nbrOfAppBooks &gt; defaultNbrOfBooks) {</span>
<span class="nc" id="L494">				nbrOfBooksToAdd = defaultNbrOfBooks;</span>
<span class="nc" id="L495">				setAddBookEnabled(true);</span>

			} else {
<span class="nc" id="L498">				nbrOfBooksToAdd = nbrOfAppBooks;</span>
			}

<span class="nc bnc" id="L501" title="All 2 branches missed.">			for (int i = 0; i &lt; nbrOfBooksToAdd; i++) {</span>
<span class="nc" id="L502">				bookBean = new BookBean();</span>
<span class="nc" id="L503">				bookBean.setValid(true);</span>

<span class="nc" id="L505">				bookList.add(bookBean);</span>
			}

<span class="nc" id="L508">			setBookList(bookList);</span>
			// session.setAttribute(&quot;AGT_BOOK_LIST&quot;, bookList);

		}

<span class="nc" id="L513">		setNoOfBooksToDispatch(0);</span>
<span class="nc" id="L514">		session.setAttribute(&quot;AGT_PACK_LIST&quot;, packList);</span>
<span class="nc" id="L515">		session.setAttribute(&quot;AGT_BOOK_LIST&quot;, bookList);</span>
<span class="nc" id="L516">		session.setAttribute(&quot;BOOK_SERIES_LIST&quot;, bookSeriesList);</span>
<span class="nc" id="L517">		session.setAttribute(&quot;BOOK_SERIES_ALL&quot;, bookSeriesAll);</span>
<span class="nc" id="L518">		return SUCCESS;</span>

	}

	public int getBookCountId() {
<span class="nc" id="L523">		return bookCountId;</span>
	}

	/*
	 * public String addBook() {
	 * 
	 * reInitialize(); System.out.println(&quot;add bookkkkkkkkkkkkk&quot;); HttpSession
	 * session = getRequest().getSession(); List&lt;BookBean&gt; bookList = (List&lt;BookBean&gt;)
	 * session .getAttribute(&quot;AGT_BOOK_LIST&quot;); List&lt;PackBean&gt; packList = (List&lt;PackBean&gt;)
	 * session .getAttribute(&quot;AGT_AGT_PACK_LIST&quot;);
	 * 
	 * BookBean bookBean = null; if (bookList != null) {
	 * 
	 * copyBookValues(bookList); bookBean = new BookBean();
	 * //bookBean.setValid(true); bookList.add(bookBean); setBookList(bookList); }
	 * 
	 * if (packList != null) {
	 * 
	 * copyPackValues(packList); setPackList(packList); }
	 * 
	 * return SUCCESS; }
	 * 
	 * public String addPack() {
	 * 
	 * reInitialize(); System.out.println(&quot;add bookkkkkkkkkkkkk&quot;); HttpSession
	 * session = getRequest().getSession(); List&lt;PackBean&gt; packList = (List&lt;PackBean&gt;)
	 * session .getAttribute(&quot;AGT_PACK_LIST&quot;); List&lt;BookBean&gt; bookList = (List&lt;BookBean&gt;)
	 * session .getAttribute(&quot;AGT_BOOK_LIST&quot;);
	 * 
	 * if (packList != null) {
	 * 
	 * copyPackValues(packList); packList.add(new PackBean());
	 * setPackList(packList); }
	 * 
	 * if (bookList != null) { copyBookValues(bookList); setBookList(bookList); }
	 * 
	 * return SUCCESS; }
	 * 
	 * 
	 * 
	 * private void reInitialize() { HttpSession session =
	 * getRequest().getSession(); OrderedGameBean bean = (OrderedGameBean)
	 * session .getAttribute(&quot;AGT_ORDERED_GAME&quot;); if (bean != null) {
	 * setOrderdedGame(bean); }
	 * 
	 * List&lt;PackBean&gt; packList = (List&lt;PackBean&gt;) session
	 * .getAttribute(&quot;AGT_PACK_LIST&quot;); List&lt;BookBean&gt; bookList = (List&lt;BookBean&gt;)
	 * session .getAttribute(&quot;AGT_BOOK_LIST&quot;);
	 * 
	 * if (packList != null) { setPackList(packList); } if (bookList != null) {
	 * setBookList(bookList); } }
	 */

	public List&lt;BookBean&gt; getBookList() {
<span class="nc" id="L577">		return bookList;</span>
	}

	/*
	 * 
	 * public String verifyBook() throws Exception {
	 * 
	 * HttpSession session = getRequest().getSession(); boolean isValid = false;
	 * int gameId = getGameId(); String bookNbr = getBookNbrToVerify(); //
	 * ********* remove this hard-coded value*********** UserInfoBean
	 * userInfoBean = (UserInfoBean) session .getAttribute(&quot;USER_INFO&quot;); int
	 * agtOrgId = userInfoBean.getUserOrgId(); //int agtOrgId = 2;
	 * //****************************************************
	 * 
	 * //System.out.println(&quot;BookNbr:::::::&quot; + getBookNbrToVerify());
	 * 
	 * //try { if (bookNbr != null &amp;&amp; !bookNbr.trim().equals(&quot;&quot;)) {
	 * //System.out.println(&quot;Inside eee BookNbr:::::::&quot; + getBookNbrToVerify());
	 * AgentDispatchGameHelper helper = new AgentDispatchGameHelper(); isValid =
	 * helper.verifyBook(gameId, agtOrgId, bookNbr); } else { isValid = true; }
	 * 
	 * //} catch (LMSException le) { //return APPLICATION_ERROR; //}
	 * 
	 * try { PrintWriter out = getResponse().getWriter(); if (isValid) {
	 * out.write(&quot;valid&quot;); } } catch (IOException e) { // TODO Auto-generated
	 * catch block e.printStackTrace(); }
	 * 
	 * return null; }
	 */

	public String[] getBookNbr() {
<span class="nc" id="L608">		return bookNbr;</span>
	}

	public String[] getBookNbrFrmStr() {
<span class="nc" id="L612">		return bookNbrFrmStr;</span>
	}

	public Object getBookNbrFromArr() {
<span class="nc" id="L616">		return bookNbrFromArr;</span>
	}

	public Object getBookNbrToArr() {
<span class="nc" id="L620">		return bookNbrToArr;</span>
	}

	public String[] getBookNbrToStr() {
<span class="nc" id="L624">		return bookNbrToStr;</span>
	}

	public String getBookNbrToVerify() {
<span class="nc" id="L628">		return bookNbrToVerify;</span>
	}

	/*
	 * public String verifyPack() throws Exception {
	 * 
	 * boolean isValid = false; int gameId = getGameId(); String packNbr =
	 * getPackNbrToVerify(); HttpSession session = getRequest().getSession(); //
	 * ********* remove this hard-coded value*********** UserInfoBean
	 * userInfoBean = (UserInfoBean) session .getAttribute(&quot;USER_INFO&quot;); int
	 * agtOrgId = userInfoBean.getUserOrgId(); //int agtOrgId = 2;
	 * //****************************************************
	 * 
	 * //try { if (packNbr != null &amp;&amp; !packNbr.trim().equals(&quot;&quot;)) {
	 * AgentDispatchGameHelper helper = new AgentDispatchGameHelper(); isValid =
	 * helper.verifyPack(gameId, agtOrgId, packNbr); } else { isValid = true; }
	 * //*} catch (LMSException le) { // return APPLICATION_ERROR; //}
	 * 
	 * try { PrintWriter out = getResponse().getWriter(); if (isValid) {
	 * out.write(&quot;valid&quot;); } } catch (IOException e) { // TODO Auto-generated
	 * catch block e.printStackTrace(); }
	 * 
	 * return null; }
	 */

	/*
	 * private void copyBookValues(List&lt;BookBean&gt; bookList) { BookBean bookBean =
	 * null;
	 * 
	 * String[] bookNbr = getBookNbr();
	 * 
	 * if (bookNbr != null) { for (int i = 0; i &lt; bookNbr.length; i++) { if
	 * (!bookNbr[i].trim().equals(&quot;&quot;)) { bookBean = new BookBean();
	 * bookBean.setBookNumber(bookNbr[i]); bookList.add(bookBean); } } } }
	 * 
	 */

	/*
	 * private void copyPackValues(List&lt;PackBean&gt; packList) { PackBean packBean =
	 * null; System.out.println(&quot;---&quot; + getPackNbr()); for (int i = 0; i &lt;
	 * packList.size(); i++) { packBean = packList.get(i);
	 * System.out.println(&quot;PackBean::&quot; + packBean);
	 * packBean.setPackNumber(getPackNbr()[i]);
	 * System.out.println(&quot;PackBean11::&quot; + packBean); } }
	 */

	public double getBookPrice() {
<span class="nc" id="L675">		return bookPrice;</span>
	}

	public List getBookSeriesAll() {
<span class="nc" id="L679">		return bookSeriesAll;</span>
	}

	/*
	 * public String verifyAgentDispatchEntry() throws Exception {
	 * 
	 * boolean isVerified = false; setProceedNext(true); System.out.println(&quot;In
	 * Verify Dispatch--------------------@@@&quot;); HttpSession session =
	 * getRequest().getSession(); List&lt;PackBean&gt; packList = (List&lt;PackBean&gt;)
	 * session .getAttribute(&quot;AGT_PACK_LIST&quot;); //List&lt;BookBean&gt; bookList =
	 * (List&lt;BookBean&gt;) session // .getAttribute(&quot;AGT_BOOK_LIST&quot;); //
	 * 
	 * List&lt;BookBean&gt; bookList = new ArrayList&lt;BookBean&gt;();
	 * 
	 * if (packList != null) { copyPackValues(packList); setPackList(packList); }
	 * if (bookList != null) { copyBookValues(bookList); setBookList(bookList); }
	 * 
	 * OrderedGameBean orderedGameBean = (OrderedGameBean) session
	 * .getAttribute(&quot;AGT_ORDERED_GAME&quot;); System.out.println(&quot;OrderedGameBean::&quot; +
	 * orderedGameBean); if (orderedGameBean != null) {
	 * orderedGameBean.setNbrOfBooksToDispatch(getNoOfBooksToDispatch()); } //
	 * ********* remove this hard-coded value*********** UserInfoBean
	 * userInfoBean = (UserInfoBean) session .getAttribute(&quot;USER_INFO&quot;); int
	 * agtOrgId = userInfoBean.getUserOrgId(); //int agtOrgId = 2;
	 * //****************************************************
	 * 
	 * AgentDispatchGameHelper helper = new AgentDispatchGameHelper();
	 * 
	 * //try { if (orderedGameBean != null &amp;&amp; bookList != null) { isVerified =
	 * helper.verifyDispatchEntry(orderedGameBean, packList, bookList,
	 * agtOrgId);
	 * 
	 * System.out.println(&quot;IsVerified::&quot; + isVerified); } //} catch
	 * (LMSException le) { return APPLICATION_ERROR; //}
	 * 
	 * if (isVerified) { saveInvData(orderedGameBean, bookList, packList);
	 * return SUCCESS; } else { //reInitialize(); return ERROR; } /* if(packList !=
	 * null &amp;&amp; packList.size() &gt; 0){ for(int i=0;i&lt;packList.size();i++){
	 * PackBean b = packList.get(i); System.out.println(&quot;Packnum:&quot; +
	 * b.getPackNbr()); System.out.println(&quot;Packnum Valid:&quot; + b.getIsValid()); } }
	 * 
	 * if(bookList != null &amp;&amp; bookList.size() &gt; 0){ for(int i=0;i&lt;bookList.size();i++){
	 * BookBean b = bookList.get(i); System.out.println(&quot;Booknum:&quot; +
	 * b.getBookNbr()); System.out.println(&quot;Booknum Valid:&quot; + b.getIsValid()); } }
	 */
	/*
	 * }
	 */

	public List&lt;BookBean&gt; getBookSeriesList() {
<span class="nc" id="L729">		return bookSeriesList;</span>
	}

	public int getGameId() {
<span class="nc" id="L733">		return gameId;</span>
	}

	public int getGameNbr() {
<span class="nc" id="L737">		return gameNbr;</span>
	}

	public boolean getIsAddBookEnabled() {
<span class="nc" id="L741">		return isAddBookEnabled;</span>
	}

	public boolean getIsInValidEntry() {
<span class="nc" id="L745">		return isInValidEntry;</span>
	}

	public boolean getIsProceedNext() {
<span class="nc" id="L749">		return isProceedNext;</span>
	}

	public int getNoOfBooksToDispatch() {
<span class="nc" id="L753">		return noOfBooksToDispatch;</span>
	}

	public OrderedGameBean getOrderdedGame() {
<span class="nc" id="L757">		return orderdedGame;</span>
	}

	public int getPackCountId() {
<span class="nc" id="L761">		return packCountId;</span>
	}

	public List&lt;PackBean&gt; getPackList() {
<span class="nc" id="L765">		return packList;</span>
	}

	public String[] getPackNbr() {
<span class="nc" id="L769">		return packNbr;</span>
	}

	public String getPackNbrToVerify() {
<span class="nc" id="L773">		return packNbrToVerify;</span>
	}

	public HttpServletRequest getRequest() {
<span class="nc" id="L777">		return request;</span>
	}

	public HttpServletResponse getResponse() {
<span class="nc" id="L781">		return response;</span>
	}

	private void reInitialize() {

		// re-initialize all the values displayed on the page

<span class="nc" id="L788">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L789">		OrderedGameBean bean = (OrderedGameBean) session</span>
				.getAttribute(&quot;AGT_ORDERED_GAME&quot;);
<span class="nc bnc" id="L791" title="All 2 branches missed.">		if (bean != null) {</span>
<span class="nc" id="L792">			setOrderdedGame(bean);</span>
		}

<span class="nc" id="L795">		List&lt;PackBean&gt; packList = (List&lt;PackBean&gt;) session</span>
				.getAttribute(&quot;AGT_PACK_LIST&quot;);
<span class="nc" id="L797">		List&lt;BookBean&gt; bookList = (List&lt;BookBean&gt;) session</span>
				.getAttribute(&quot;AGT_BOOK_LIST&quot;);

<span class="nc" id="L800">		System.out.println(&quot;-----booklist---&quot; + bookList);</span>

<span class="nc bnc" id="L802" title="All 2 branches missed.">		if (packList != null) {</span>
<span class="nc" id="L803">			setPackList(packList);</span>
		}
<span class="nc bnc" id="L805" title="All 2 branches missed.">		if (bookList != null) {</span>

<span class="nc bnc" id="L807" title="All 2 branches missed.">			if (bookList.size() == 0) {</span>
<span class="nc" id="L808">				OrderedGameBean orderedGameBean = (OrderedGameBean) session</span>
						.getAttribute(&quot;AGT_ORDERED_GAME&quot;);

<span class="nc" id="L811">				int nbrOfAppBooks = orderedGameBean.getNbrOfBooksApp();</span>

<span class="nc" id="L813">				int nbrOfBooksToAdd = 0;</span>
<span class="nc bnc" id="L814" title="All 2 branches missed.">				if (nbrOfAppBooks &gt; defaultNbrOfBooks) {</span>
<span class="nc" id="L815">					nbrOfBooksToAdd = defaultNbrOfBooks;</span>
<span class="nc" id="L816">					setAddBookEnabled(true);</span>

				} else {
<span class="nc" id="L819">					nbrOfBooksToAdd = nbrOfAppBooks;</span>
				}
<span class="nc" id="L821">				BookBean bookBean = null;</span>
<span class="nc bnc" id="L822" title="All 2 branches missed.">				for (int i = 0; i &lt; nbrOfBooksToAdd; i++) {</span>
<span class="nc" id="L823">					bookBean = new BookBean();</span>
<span class="nc" id="L824">					bookBean.setValid(true);</span>

<span class="nc" id="L826">					bookList.add(bookBean);</span>
				}
			}

<span class="nc" id="L830">			setBookList(bookList);</span>
		}
<span class="nc" id="L832">	}</span>

	private void saveInvData(OrderedGameBean orderedGameBean,
			List&lt;BookBean&gt; bookList, List&lt;PackBean&gt; packList) {

<span class="nc" id="L837">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L838">		List&lt;InvOrderBean&gt; invOrderList = (List&lt;InvOrderBean&gt;) session</span>
				.getAttribute(&quot;AGT_INV_ORDER_LIST&quot;);
<span class="nc" id="L840">		orderedGameBean.setReadyForDispatch(true);</span>
<span class="nc" id="L841">		InvOrderBean invOrderBean = null;</span>
<span class="nc bnc" id="L842" title="All 2 branches missed.">		if (invOrderList != null) {</span>
<span class="nc" id="L843">			invOrderBean = new InvOrderBean();</span>
<span class="nc" id="L844">			invOrderBean.setOrderedGameBean(orderedGameBean);</span>
<span class="nc bnc" id="L845" title="All 2 branches missed.">			if (bookList != null) {</span>
<span class="nc" id="L846">				invOrderBean.setBookList(bookList);</span>
			}
<span class="nc bnc" id="L848" title="All 2 branches missed.">			if (packList != null) {</span>
<span class="nc" id="L849">				invOrderBean.setPackList(packList);</span>
			}

<span class="nc" id="L852">			invOrderList.add(invOrderBean);</span>

		}

<span class="nc" id="L856">	}</span>

	public void setAddBookEnabled(boolean isAddBookEnabled) {
<span class="nc" id="L859">		this.isAddBookEnabled = isAddBookEnabled;</span>
<span class="nc" id="L860">	}</span>

	public void setBookCountId(int bookCountId) {
<span class="nc" id="L863">		this.bookCountId = bookCountId;</span>
<span class="nc" id="L864">	}</span>

	public void setBookList(List&lt;BookBean&gt; bookList) {
<span class="nc" id="L867">		this.bookList = bookList;</span>
<span class="nc" id="L868">	}</span>

	public void setBookNbr(String[] bookNbr) {
<span class="nc" id="L871">		this.bookNbr = bookNbr;</span>
<span class="nc" id="L872">	}</span>

	public void setBookNbrFrmStr(String[] bookNbrFrmStr) {
<span class="nc" id="L875">		this.bookNbrFrmStr = bookNbrFrmStr;</span>
<span class="nc" id="L876">	}</span>

	public void setBookNbrFromArr(Object bookNbrFromArr) {
<span class="nc" id="L879">		this.bookNbrFromArr = bookNbrFromArr;</span>
<span class="nc" id="L880">	}</span>

	public void setBookNbrToArr(Object bookNbrToArr) {
<span class="nc" id="L883">		this.bookNbrToArr = bookNbrToArr;</span>
<span class="nc" id="L884">	}</span>

	public void setBookNbrToStr(String[] bookNbrToStr) {
<span class="nc" id="L887">		this.bookNbrToStr = bookNbrToStr;</span>
<span class="nc" id="L888">	}</span>

	public void setBookNbrToVerify(String bookNbrToVerify) {
<span class="nc" id="L891">		this.bookNbrToVerify = bookNbrToVerify;</span>
<span class="nc" id="L892">	}</span>

	public void setBookPrice(double bookPrice) {
<span class="nc" id="L895">		this.bookPrice = bookPrice;</span>
<span class="nc" id="L896">	}</span>

	public void setBookSeriesAll(List bookSeriesAll) {
<span class="nc" id="L899">		this.bookSeriesAll = bookSeriesAll;</span>
<span class="nc" id="L900">	}</span>

	public void setBookSeriesList(List&lt;BookBean&gt; bookSeriesList) {
<span class="nc" id="L903">		this.bookSeriesList = bookSeriesList;</span>
<span class="nc" id="L904">	}</span>

	public void setGameId(int gameId) {
<span class="nc" id="L907">		this.gameId = gameId;</span>
<span class="nc" id="L908">	}</span>

	public void setGameNbr(int gameNbr) {
<span class="nc" id="L911">		this.gameNbr = gameNbr;</span>
<span class="nc" id="L912">	}</span>

	public void setInValidEntry(boolean isInValidEntry) {
<span class="nc" id="L915">		this.isInValidEntry = isInValidEntry;</span>
<span class="nc" id="L916">	}</span>

	public void setNoOfBooksToDispatch(int noOfBooksToDispatch) {
<span class="nc" id="L919">		this.noOfBooksToDispatch = noOfBooksToDispatch;</span>
<span class="nc" id="L920">	}</span>

	public void setOrderdedGame(OrderedGameBean orderdedGame) {
<span class="nc" id="L923">		this.orderdedGame = orderdedGame;</span>
<span class="nc" id="L924">	}</span>

	public void setPackCountId(int packCountId) {
<span class="nc" id="L927">		this.packCountId = packCountId;</span>
<span class="nc" id="L928">	}</span>

	public void setPackList(List&lt;PackBean&gt; packList) {
<span class="nc" id="L931">		this.packList = packList;</span>
<span class="nc" id="L932">	}</span>

	public void setPackNbr(String[] packNbr) {
<span class="nc" id="L935">		this.packNbr = packNbr;</span>
<span class="nc" id="L936">	}</span>

	public void setPackNbrToVerify(String packNbrToVerify) {
<span class="nc" id="L939">		this.packNbrToVerify = packNbrToVerify;</span>
<span class="nc" id="L940">	}</span>

	public void setProceedNext(boolean isProceedNext) {
<span class="nc" id="L943">		this.isProceedNext = isProceedNext;</span>
<span class="nc" id="L944">	}</span>

	public void setServletRequest(HttpServletRequest request) {
<span class="nc" id="L947">		this.request = request;</span>

<span class="nc" id="L949">	}</span>

	public void setServletResponse(HttpServletResponse response) {
<span class="nc" id="L952">		this.response = response;</span>
<span class="nc" id="L953">	}</span>

	/**
	 * This method is used for verifying the book and pack entries and
	 * dispatching the game if entries are correct
	 * 
	 * @return String
	 * @throws Exception
	 */
	public String verifyAgentDispatchEntry() throws Exception {

<span class="nc" id="L964">		boolean isVerified = false;</span>

<span class="nc" id="L966">		System.out.println(&quot;In Agent Verify Dispatch--------------------@@@&quot;);</span>
<span class="nc" id="L967">		HttpSession session = getRequest().getSession();</span>

<span class="nc" id="L969">		List&lt;PackBean&gt; packList = (List&lt;PackBean&gt;) session</span>
				.getAttribute(&quot;AGT_PACK_LIST&quot;);

<span class="nc" id="L972">		List&lt;BookBean&gt; bookList = (List&lt;BookBean&gt;) session</span>
				.getAttribute(&quot;AGT_BOOK_LIST&quot;);
<span class="nc" id="L974">		List&lt;BookBean&gt; bookSeriesList = (List&lt;BookBean&gt;) session</span>
				.getAttribute(&quot;BOOK_SERIES_LIST&quot;);

		// List&lt;PackBean&gt; packList = new ArrayList&lt;PackBean&gt;();
		// List&lt;BookBean&gt; bookList = new ArrayList&lt;BookBean&gt;();

		// ********* remove this hard-coded value***********
<span class="nc" id="L981">		UserInfoBean userInfoBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L983">		int agtOrgId = userInfoBean.getUserOrgId();</span>
		// int agtOrgId = 2;
		// ****************************************************

<span class="nc bnc" id="L987" title="All 2 branches missed.">		if (packList != null) {</span>
			// copyPackValues(packList);
<span class="nc" id="L989">			setPackList(packList);</span>

		}

<span class="nc bnc" id="L993" title="All 2 branches missed.">		if (bookList != null) {</span>
			// copyBookValues(bookList);
<span class="nc" id="L995">			setBookList(bookList);</span>

		}

<span class="nc bnc" id="L999" title="All 2 branches missed.">		if (bookSeriesList != null) {</span>
<span class="nc" id="L1000">			setBookSeriesList(bookSeriesList);</span>
			/*
			 * if(!bookList.containsAll(bookSeriesList)){
			 * bookList.addAll(bookSeriesList); }
			 * setBookSeriesList(bookSeriesList);
			 */
		}

<span class="nc" id="L1008">		System.out.println(&quot;Nbr of Books to dispatch::&quot; + noOfBooksToDispatch);</span>

<span class="nc" id="L1010">		OrderedGameBean orderedGameBean = (OrderedGameBean) session</span>
				.getAttribute(&quot;AGT_ORDERED_GAME&quot;);
<span class="nc" id="L1012">		System.out.println(&quot;OrderedGameBean::&quot; + orderedGameBean);</span>

<span class="nc bnc" id="L1014" title="All 2 branches missed.">		if (orderedGameBean != null) {</span>
<span class="nc" id="L1015">			orderedGameBean.setNbrOfBooksToDispatch(getNoOfBooksToDispatch());</span>
		}

<span class="nc" id="L1018">		AgentDispatchGameHelper helper = new AgentDispatchGameHelper();</span>

		// try {

		// validate book and pack data
<span class="nc bnc" id="L1023" title="All 4 branches missed.">		if (orderedGameBean != null &amp;&amp; bookList != null) {</span>

<span class="nc" id="L1025">			isVerified = helper.isBookAndPackValid(packList, bookList,</span>
					bookSeriesList);
<span class="nc" id="L1027">			System.out.println(&quot;First IsVerified::&quot; + isVerified);</span>
<span class="nc bnc" id="L1028" title="All 2 branches missed.">			if (isVerified) {</span>
<span class="nc" id="L1029">				isVerified = helper.verifyDispatchEntry(orderedGameBean,</span>
						packList, bookList, agtOrgId, bookSeriesList);

<span class="nc" id="L1032">				System.out.println(&quot;2nd IsVerified::&quot; + isVerified);</span>
			}

<span class="nc" id="L1035">			System.out.println(&quot;IsVerified::&quot; + isVerified);</span>
		}
		/*
		 * } catch (LMSException le) { return APPLICATION_ERROR; }
		 */

		// if data is valid, save the inventory data
<span class="nc bnc" id="L1042" title="All 2 branches missed.">		if (isVerified) {</span>
<span class="nc" id="L1043">			setProceedNext(true);</span>
<span class="nc" id="L1044">			bookList.addAll(bookSeriesList);</span>
<span class="nc" id="L1045">			setBookList(bookList);</span>
<span class="nc" id="L1046">			saveInvData(orderedGameBean, bookList, packList);</span>
<span class="nc" id="L1047">			return SUCCESS;</span>

		} else {
<span class="nc" id="L1050">			reInitialize();</span>
<span class="nc" id="L1051">			checkValidBookInseries(bookSeriesList);</span>
<span class="nc" id="L1052">			int validBookCount = helper.recalculateDispatchBooks(packList,</span>
					bookList, bookSeriesList, orderedGameBean
							.getNbrOfBooksPerPack());
<span class="nc" id="L1055">			setNoOfBooksToDispatch(validBookCount);</span>

<span class="nc bnc" id="L1057" title="All 2 branches missed.">			if (orderedGameBean != null) {</span>
<span class="nc bnc" id="L1058" title="All 2 branches missed.">				if (validBookCount &lt; orderedGameBean.getNbrOfBooksApp()) {</span>
<span class="nc" id="L1059">					setAddBookEnabled(true);</span>

				}
			}

<span class="nc" id="L1064">			setInValidEntry(true);</span>
<span class="nc" id="L1065">			return ERROR;</span>
		}

		/*
		 * if(packList != null &amp;&amp; packList.size() &gt; 0){ for(int i=0;i&lt;packList.size();i++){
		 * PackBean b = packList.get(i); System.out.println(&quot;Packnum:&quot; +
		 * b.getPackNbr()); System.out.println(&quot;Packnum Valid:&quot; +
		 * b.getIsValid()); } }
		 * 
		 * if(bookList != null &amp;&amp; bookList.size() &gt; 0){ for(int i=0;i&lt;bookList.size();i++){
		 * BookBean b = bookList.get(i); System.out.println(&quot;Booknum:&quot; +
		 * b.getBookNbr()); System.out.println(&quot;Booknum Valid:&quot; +
		 * b.getIsValid()); } }
		 */

	}

	/**
	 * This method verifies the book entered by the user
	 * 
	 * @return String
	 * @throws Exception
	 */
	public String verifyBook() throws Exception {

<span class="nc" id="L1090">		boolean isValid = false;</span>
<span class="nc" id="L1091">		int gameId = getGameId();</span>
<span class="nc" id="L1092">		boolean isBlank = false;</span>
<span class="nc" id="L1093">		boolean isDuplicate = false;</span>

<span class="nc" id="L1095">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L1096">		List&lt;BookBean&gt; bookList = (List&lt;BookBean&gt;) session</span>
				.getAttribute(&quot;AGT_BOOK_LIST&quot;);

<span class="nc" id="L1099">		String bookNbr = getBookNbrToVerify();</span>

<span class="nc" id="L1101">		System.out</span>
				.println(&quot;Bokkkkkkkk To verify::::::::::::::::::::::::::::::::&quot;
						+ bookNbr);

		// ********* remove this hard-coded value***********
<span class="nc" id="L1106">		UserInfoBean userInfoBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L1108">		int agtOrgId = userInfoBean.getUserOrgId();</span>
		// int agtOrgId = 2;
		// ****************************************************

		// try {

		// verify if the entered book is valid

<span class="nc bnc" id="L1116" title="All 4 branches missed.">		if (bookNbr != null &amp;&amp; !bookNbr.trim().equals(&quot;&quot;)) {</span>
			// System.out.println(&quot;Inside eee BookNbr:::::::&quot; +
			// getBookNbrToVerify());

<span class="nc" id="L1120">			System.out.println(&quot;:::::::::&quot; + bookNbr.indexOf(&quot;-&quot;));</span>

<span class="nc bnc" id="L1122" title="All 2 branches missed.">			if (bookNbr.indexOf(&quot;-&quot;) == -1) {</span>
<span class="nc" id="L1123">				OrderedGameBean orderedGameBean = (OrderedGameBean) session</span>
						.getAttribute(&quot;AGT_ORDERED_GAME&quot;);

<span class="nc" id="L1126">				bookNbr = bookNbr.substring(0, orderedGameBean</span>
						.getGameNbrDigits())
						+ &quot;-&quot;
						+ bookNbr.substring(orderedGameBean.getGameNbrDigits());

<span class="nc" id="L1131">				System.out.println(&quot;New book nbr:::&quot; + bookNbr);</span>

			}

<span class="nc" id="L1135">			AgentDispatchGameHelper helper = new AgentDispatchGameHelper();</span>
<span class="nc" id="L1136">			Connection conn = DBConnect.getConnection();</span>
			try {
<span class="nc" id="L1138">				isValid = helper.verifyBook(gameId, agtOrgId, bookNbr, conn,</span>
						gameNbr);
			} finally {
<span class="nc" id="L1141">				conn.close();</span>
<span class="nc" id="L1142">			}</span>
<span class="nc" id="L1143">		} else {</span>
<span class="nc" id="L1144">			isValid = true;</span>
		}

		// when the user changes the bookNbr to blanks
<span class="nc bnc" id="L1148" title="All 4 branches missed.">		if (bookNbr != null &amp;&amp; bookNbr.trim().equals(&quot;&quot;)) {</span>
<span class="nc" id="L1149">			System.out.println(&quot;--For Blank--------&quot;);</span>
<span class="nc" id="L1150">			isBlank = true;</span>
<span class="nc" id="L1151">			BookBean blankBean = bookList.get(bookCountId - 1);</span>
<span class="nc" id="L1152">			blankBean.setBookNumber(&quot;&quot;);</span>
<span class="nc" id="L1153">			blankBean.setValid(true);</span>
<span class="nc" id="L1154">			blankBean.setStatus(null);</span>

		}

		/*
		 * } catch (LMSException le) { return APPLICATION_ERROR; }
		 */

<span class="nc bnc" id="L1162" title="All 2 branches missed.">		if (!isBlank) {</span>

<span class="nc" id="L1164">			System.out.println(&quot;--Agent Book If Not Blank--------&quot;);</span>
<span class="nc bnc" id="L1165" title="All 2 branches missed.">			if (bookList != null) {</span>
<span class="nc" id="L1166">				copyBookValues(bookList);</span>

				// for duplicate check

<span class="nc" id="L1170">				int dupCount = 0;</span>

<span class="nc" id="L1172">				int bookCountId = getBookCountId();</span>
<span class="nc" id="L1173">				System.out</span>
						.println(&quot;Agent BookCountId:::::::::::&quot; + bookCountId);

<span class="nc bnc" id="L1176" title="All 2 branches missed.">				for (BookBean bean : bookList) {</span>
<span class="nc bnc" id="L1177" title="All 2 branches missed.">					if (bookNbr.equals(bean.getBookNumber())) {</span>
<span class="nc" id="L1178">						dupCount++;</span>
					}

<span class="nc bnc" id="L1181" title="All 2 branches missed.">					if (dupCount &gt; 1) {</span>
<span class="nc" id="L1182">						isDuplicate = true;</span>
<span class="nc" id="L1183">						BookBean dupBean = bookList.get(bookCountId - 1);</span>
<span class="nc" id="L1184">						dupBean.setValid(false);</span>
<span class="nc" id="L1185">						dupBean.setStatus(&quot;Duplicate Book&quot;);</span>
<span class="nc" id="L1186">						break;</span>
					}
<span class="nc" id="L1188">				}</span>

<span class="nc bnc" id="L1190" title="All 2 branches missed.">				if (dupCount &lt;= 1) {</span>
<span class="nc" id="L1191">					BookBean dupBean = bookList.get(bookCountId - 1);</span>
<span class="nc" id="L1192">					dupBean.setValid(true);</span>
<span class="nc" id="L1193">					dupBean.setStatus(null);</span>
				}

<span class="nc bnc" id="L1196" title="All 2 branches missed.">				if (!isDuplicate) {</span>
<span class="nc bnc" id="L1197" title="All 2 branches missed.">					for (BookBean bean : bookList) {</span>
<span class="nc bnc" id="L1198" title="All 2 branches missed.">						if (bookNbr.equals(bean.getBookNumber())) {</span>
<span class="nc bnc" id="L1199" title="All 2 branches missed.">							if (!isValid) {</span>
<span class="nc" id="L1200">								bean.setValid(false);</span>
<span class="nc" id="L1201">								bean.setStatus(&quot;Wrong Book Number&quot;);</span>
<span class="nc" id="L1202">								break;</span>
							} else {
<span class="nc" id="L1204">								bean.setValid(true);</span>
<span class="nc" id="L1205">								bean.setStatus(null);</span>
<span class="nc" id="L1206">								break;</span>
							}
						}
<span class="nc" id="L1209">					}</span>
				}

			}
		}

<span class="nc" id="L1215">		setBookList(bookList);</span>

		// change the value of no of books to dispatch
<span class="nc" id="L1218">		changeDispatchBooks();</span>

<span class="nc" id="L1220">		System.out</span>
				.println(&quot;---------Agent Book Trying to prevent caching------&quot;);
<span class="nc" id="L1222">		HttpServletResponse response = getResponse();</span>
<span class="nc" id="L1223">		response.setHeader(&quot;Pragma&quot;, &quot;no-cache&quot;); // HTTP 1.0</span>
<span class="nc" id="L1224">		response.setHeader(&quot;Cache-Control&quot;, &quot;no-cache&quot;); // HTTP 1.1</span>
<span class="nc" id="L1225">		response.setDateHeader(&quot;Expires&quot;, 0); // prevents caching at the proxy</span>
		// server
<span class="nc" id="L1227">		response.setHeader(&quot;Cache-Control&quot;, &quot;private&quot;); // HTTP 1.1</span>
<span class="nc" id="L1228">		response.setHeader(&quot;Cache-Control&quot;, &quot;no-store&quot;); // HTTP 1.1</span>
<span class="nc" id="L1229">		response.setHeader(&quot;Cache-Control&quot;, &quot;max-stale=0&quot;); // HTTP 1.1</span>

<span class="nc" id="L1231">		return SUCCESS;</span>

	}

	/**
	 * This method verifies the book entered by the user
	 * 
	 * @param bookList
	 * 
	 * @return String
	 * @throws Exception
	 */
	public void verifyBook(String bookNbr, List&lt;BookBean&gt; bookList,
			Connection conn) throws Exception {

<span class="nc" id="L1246">		boolean isValid = false;</span>
<span class="nc" id="L1247">		int gameId = getGameId();</span>
<span class="nc" id="L1248">		boolean isBlank = false;</span>
<span class="nc" id="L1249">		boolean isDuplicate = false;</span>

<span class="nc" id="L1251">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L1252">		List&lt;BookBean&gt; bookSeriesList = (List&lt;BookBean&gt;) session</span>
				.getAttribute(&quot;BOOK_SERIES_LIST&quot;);
<span class="nc" id="L1254">		UserInfoBean userBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L1256">		int agtOrgId = userBean.getUserOrgId();</span>
<span class="nc" id="L1257">		System.out</span>
				.println(&quot;Bokkkkkkkk To verify::::::::::::::::::::::::::::::::&quot;
						+ bookNbr);

		// try {
<span class="nc bnc" id="L1262" title="All 4 branches missed.">		if (bookNbr != null &amp;&amp; !bookNbr.trim().equals(&quot;&quot;)) {</span>

			// add hyphens if necessary

<span class="nc" id="L1266">			System.out.println(&quot;:::::::::&quot; + bookNbr.indexOf(&quot;-&quot;));</span>

<span class="nc bnc" id="L1268" title="All 2 branches missed.">			if (bookNbr.indexOf(&quot;-&quot;) == -1) {</span>
<span class="nc" id="L1269">				OrderedGameBean orderedGameBean = (OrderedGameBean) session</span>
						.getAttribute(&quot;ORDERED_GAME&quot;);

<span class="nc" id="L1272">				bookNbr = bookNbr.substring(0, orderedGameBean</span>
						.getGameNbrDigits())
						+ &quot;-&quot;
						+ bookNbr.substring(orderedGameBean.getGameNbrDigits());

<span class="nc" id="L1277">				System.out.println(&quot;New book nbr:::&quot; + bookNbr);</span>

			}

<span class="nc" id="L1281">			System.out.println(&quot;---------------vvvvvvvvvvvvv----------&quot;</span>
					+ bookNbr);
<span class="nc" id="L1283">			AgentDispatchGameHelper helper = new AgentDispatchGameHelper();</span>

<span class="nc" id="L1285">			isValid = helper.verifyBook(gameId, agtOrgId, bookNbr, conn,</span>
					gameNbr);

<span class="nc" id="L1288">		}</span>

		else {
<span class="nc" id="L1291">			System.out.println(&quot;---------------vvvvvvvvvvvvv----------&quot;);</span>
<span class="nc" id="L1292">			isValid = true;</span>
		}

		// when the user changes the bookNbr to blanks
		/*
		 * if (bookNbr != null &amp;&amp; bookNbr.trim().equals(&quot;&quot;)) {
		 * System.out.println(&quot;--For Blank--------&quot;); isBlank = true; BookBean
		 * blankBean = bookList.get(bookCountId - 1);
		 * blankBean.setBookNumber(&quot;&quot;); blankBean.setValid(true);
		 * blankBean.setStatus(null); }
		 */

		/*
		 * } catch (LMSException le) { return APPLICATION_ERROR; }
		 */

<span class="nc bnc" id="L1308" title="All 2 branches missed.">		if (!isBlank) {</span>

<span class="nc" id="L1310">			System.out.println(&quot;--If Not Blank--------&quot;);</span>
<span class="nc bnc" id="L1311" title="All 2 branches missed.">			if (bookList != null) {</span>
				// copyBookValues(bookList);

				// for duplicate check

<span class="nc" id="L1316">				int dupCount = 0;</span>

<span class="nc" id="L1318">				int bookCountId = getBookCountId();</span>
<span class="nc" id="L1319">				System.out.println(&quot;BookCountId:::::::::::&quot; + bookCountId);</span>

<span class="nc bnc" id="L1321" title="All 2 branches missed.">				for (BookBean bean : bookList) {</span>
<span class="nc bnc" id="L1322" title="All 2 branches missed.">					if (bookNbr.equals(bean.getBookNumber())) {</span>
<span class="nc" id="L1323">						dupCount++;</span>
<span class="nc" id="L1324">						System.out.println(&quot;----in dup counter----&quot; + dupCount);</span>
					}

<span class="nc bnc" id="L1327" title="All 2 branches missed.">					if (dupCount &gt; 1) {</span>
<span class="nc" id="L1328">						isDuplicate = true;</span>
<span class="nc" id="L1329">						bean.setValid(false);</span>
<span class="nc" id="L1330">						bean.setStatus(&quot;Duplicate Book&quot;);</span>
<span class="nc" id="L1331">						System.out.println(&quot;----in dup counter-if block---&quot;</span>
								+ dupCount);
<span class="nc" id="L1333">						break;</span>
					}
<span class="nc" id="L1335">				}</span>

				/*
				 * if (dupCount &lt;= 1) { BookBean dupBean =
				 * bookList.get(bookCountId - 1); dupBean.setValid(true);
				 * dupBean.setStatus(null); }
				 */

<span class="nc bnc" id="L1343" title="All 2 branches missed.">				if (!isDuplicate) {</span>
<span class="nc bnc" id="L1344" title="All 2 branches missed.">					for (BookBean bean : bookList) {</span>
<span class="nc bnc" id="L1345" title="All 2 branches missed.">						if (bookNbr.equals(bean.getBookNumber())) {</span>
<span class="nc bnc" id="L1346" title="All 2 branches missed.">							if (!isValid) {</span>
<span class="nc" id="L1347">								bean.setValid(false);</span>
<span class="nc" id="L1348">								bean.setStatus(&quot;Wrong Book Number&quot;);</span>
<span class="nc" id="L1349">								break;</span>
							} else {
<span class="nc" id="L1351">								bean.setValid(true);</span>
<span class="nc" id="L1352">								bean.setStatus(null);</span>
<span class="nc" id="L1353">								break;</span>
							}
						}

<span class="nc" id="L1357">					}</span>

				}

			}
		}

<span class="nc" id="L1364">		setBookList(bookList);</span>
		// changeDispatchBooks();
<span class="nc" id="L1366">	}</span>

	public String verifyBookSeries() throws Exception {
		// update by arun
<span class="nc" id="L1370">		Connection conn = DBConnect.getConnection();</span>
		try {
<span class="nc" id="L1372">			boolean isValid = false;</span>
<span class="nc" id="L1373">			boolean isSeriesValid = true;</span>
<span class="nc" id="L1374">			int gameId = getGameId();</span>
<span class="nc" id="L1375">			HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L1376">			UserInfoBean userInfoBean = (UserInfoBean) session</span>
					.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L1378">			int agtOrgId = userInfoBean.getUserOrgId();</span>
<span class="nc" id="L1379">			List&lt;BookBean&gt; bookList = new ArrayList();</span>
<span class="nc" id="L1380">			List&lt;BookBean&gt; bookSeriesList = new ArrayList();</span>
<span class="nc" id="L1381">			List bookSeriesAll = new ArrayList();</span>
<span class="nc" id="L1382">			session.setAttribute(&quot;BOOK_SERIES_ALL&quot;, bookSeriesAll);</span>
<span class="nc" id="L1383">			session.setAttribute(&quot;AGT_BOOK_LIST&quot;, bookList);</span>
<span class="nc" id="L1384">			session.setAttribute(&quot;BOOK_SERIES_LIST&quot;, bookSeriesList);</span>
<span class="nc" id="L1385">			StringTokenizer bookNbrFrmTok = new StringTokenizer(</span>
					((String[]) bookNbrFromArr)[0], &quot;,&quot;);
<span class="nc" id="L1387">			StringTokenizer bookNbrToTok = new StringTokenizer(</span>
					((String[]) bookNbrToArr)[0], &quot;,&quot;);
<span class="nc" id="L1389">			bookNbrFrmStr = new String[bookNbrFrmTok.countTokens()];</span>
<span class="nc" id="L1390">			bookNbrToStr = new String[bookNbrToTok.countTokens()];</span>
<span class="nc" id="L1391">			int frmTok = 0;</span>
<span class="nc bnc" id="L1392" title="All 2 branches missed.">			while (bookNbrFrmTok.hasMoreTokens()) {</span>
<span class="nc" id="L1393">				bookNbrFrmStr[frmTok] = bookNbrFrmTok.nextToken();</span>
<span class="nc" id="L1394">				bookNbrToStr[frmTok] = bookNbrToTok.nextToken();</span>
<span class="nc" id="L1395">				frmTok = frmTok + 1;</span>
			}
<span class="nc" id="L1397">			System.out.println(&quot;---Series length&quot; + bookNbrFrmStr);</span>

<span class="nc bnc" id="L1399" title="All 2 branches missed.">			if (bookNbrFrmStr != null) {</span>
<span class="nc bnc" id="L1400" title="All 2 branches missed.">				for (int seriesNo = 0; seriesNo &lt; bookNbrFrmStr.length; seriesNo++) {</span>
<span class="nc bnc" id="L1401" title="All 2 branches missed.">					if (bookNbrFrmStr[seriesNo] != &quot;&quot;) {</span>

<span class="nc" id="L1403">						String bookNbrFrom = bookNbrFrmStr[seriesNo];</span>
<span class="nc" id="L1404">						String bookNbrTo = bookNbrToStr[seriesNo];</span>

<span class="nc" id="L1406">						int bookNbrFrmInt = Integer.parseInt(bookNbrFrom</span>
								.replaceAll(&quot;-&quot;, &quot;&quot;));
<span class="nc" id="L1408">						int bookNbrToInt = Integer.parseInt(bookNbrTo</span>
								.replaceAll(&quot;-&quot;, &quot;&quot;));
<span class="nc" id="L1410">						int noOfbooks = bookNbrToInt - bookNbrFrmInt;</span>
<span class="nc" id="L1411">						BookSeriesBean bookSeBean = new BookSeriesBean();</span>
<span class="nc" id="L1412">						bookSeBean.setBookNbrFrom(bookNbrFrom);</span>
<span class="nc" id="L1413">						bookSeBean.setBookNbrTo(bookNbrTo);</span>
<span class="nc" id="L1414">						bookSeBean.setStatus(&quot;&quot;);</span>
<span class="nc" id="L1415">						bookSeBean.setValid(isValid);</span>

<span class="nc bnc" id="L1417" title="All 2 branches missed.">						for (int i = 0; i &lt; noOfbooks + 1; i++) {</span>
<span class="nc" id="L1418">							String bookNbr = String.valueOf(bookNbrFrmInt);</span>

<span class="nc bnc" id="L1420" title="All 4 branches missed.">							if (bookNbr != null &amp;&amp; !bookNbr.trim().equals(&quot;&quot;)) {</span>
								// add hyphens if necessary

<span class="nc" id="L1423">								System.out.println(&quot;:::::::::&quot;</span>
										+ bookNbr.indexOf(&quot;-&quot;));

<span class="nc bnc" id="L1426" title="All 2 branches missed.">								if (bookNbr.indexOf(&quot;-&quot;) == -1) {</span>
<span class="nc" id="L1427">									OrderedGameBean orderedGameBean = (OrderedGameBean) session</span>
											.getAttribute(&quot;AGT_ORDERED_GAME&quot;);

<span class="nc" id="L1430">									bookNbr = bookNbr.substring(0,</span>
											orderedGameBean.getGameNbrDigits())
											+ &quot;-&quot;
											+ bookNbr.substring(orderedGameBean
													.getGameNbrDigits());

<span class="nc" id="L1436">									System.out.println(&quot;New book nbr:::&quot;</span>
											+ bookNbr);

								}

<span class="nc" id="L1441">								System.out</span>
										.println(&quot;---------------vvvvvvvvvvvvv----------&quot;
												+ bookNbr);
<span class="nc" id="L1444">								AgentDispatchGameHelper helper = new AgentDispatchGameHelper();</span>
<span class="nc" id="L1445">								isValid = helper.verifyBook(gameId, agtOrgId,</span>
										bookNbr, conn, gameNbr);

<span class="nc bnc" id="L1448" title="All 2 branches missed.">								if (isValid) {</span>
<span class="nc" id="L1449">									BookBean bookBean = new BookBean();</span>
<span class="nc" id="L1450">									bookBean.setValid(true);</span>
<span class="nc" id="L1451">									bookBean.setBookNumber(bookNbr);</span>
<span class="nc bnc" id="L1452" title="All 2 branches missed.">									for (BookBean bean : bookSeriesList) {</span>
<span class="nc bnc" id="L1453" title="All 2 branches missed.">										if (bookNbr</span>
												.equals(bean.getBookNumber())) {
<span class="nc" id="L1455">											isSeriesValid = false;</span>
<span class="nc" id="L1456">											bookSeBean</span>
													.setStatus(&quot;Series Contains Tickets of Another Series&quot;);
<span class="nc" id="L1458">											break;// New series contains</span>
											// ticket of old series
										}
<span class="nc" id="L1461">									}</span>
<span class="nc bnc" id="L1462" title="All 2 branches missed.">									if (isSeriesValid) {</span>
<span class="nc" id="L1463">										bookSeriesList.add(bookBean);</span>
									}

<span class="nc" id="L1466">								} else {</span>
<span class="nc" id="L1467">									isSeriesValid = false;</span>
<span class="nc" id="L1468">									bookSeBean.setStatus(&quot;Series Not Valid&quot;);</span>
<span class="nc" id="L1469">									break;// Series not valid</span>
								}
							}
<span class="nc" id="L1472">							System.out</span>
									.println(&quot;inside for of verifyBookSeries&quot;);

<span class="nc" id="L1475">							bookNbrFrmInt++;</span>

						}

<span class="nc bnc" id="L1479" title="All 2 branches missed.">						if (isSeriesValid) {</span>
<span class="nc" id="L1480">							bookSeBean.setValid(true);</span>
<span class="nc" id="L1481">							session.setAttribute(&quot;BOOK_SERIES_LIST&quot;,</span>
									bookSeriesList);
						}
<span class="nc" id="L1484">						bookSeriesAll.add(bookSeBean);</span>
<span class="nc" id="L1485">						session.setAttribute(&quot;BOOK_SERIES_ALL&quot;, bookSeriesAll);</span>
						// changeDispatchBooks();
						// System.out.println(&quot;@@@@@@@@@@@@@################$$$$$$$$$$$$$%%%%%%%%%%%%%%%%&quot;);
					}
				}
			}
<span class="nc" id="L1491">			verifyIndividualBooks(bookList);</span>

<span class="nc bnc" id="L1493" title="All 2 branches missed.">			for (int i = 0; i &lt; bookSeriesList.size(); i++) {</span>
<span class="nc bnc" id="L1494" title="All 2 branches missed.">				for (int j = 0; j &lt; bookList.size(); j++) {</span>
					// System.out.println(bookSeriesList.size()+&quot;-Gaura
					// Test--&quot;+bookList.size());
<span class="nc bnc" id="L1497" title="All 2 branches missed.">					if (((BookBean) bookList.get(j)).getBookNumber().equals(</span>
							((BookBean) bookSeriesList.get(i)).getBookNumber())) {
<span class="nc" id="L1499">						BookBean bean = (BookBean) bookList.get(j);</span>
<span class="nc" id="L1500">						bean.setValid(false);</span>
<span class="nc" id="L1501">						bean.setStatus(&quot;Book Number already in Book Series&quot;);</span>
					}
				}
			}
<span class="nc" id="L1505">			setBookList(bookList);</span>
<span class="nc" id="L1506">			session.setAttribute(&quot;AGT_BOOK_LIST&quot;, bookList);</span>
<span class="nc" id="L1507">			changeDispatchBooks();</span>
<span class="nc" id="L1508">			System.out.println(&quot;---------Trying to prevent caching------&quot;</span>
					+ bookList);
<span class="nc" id="L1510">			HttpServletResponse response = getResponse();</span>
<span class="nc" id="L1511">			response.setHeader(&quot;Pragma&quot;, &quot;no-cache&quot;); // HTTP 1.0</span>
<span class="nc" id="L1512">			response.setHeader(&quot;Cache-Control&quot;, &quot;no-cache&quot;); // HTTP 1.1</span>
<span class="nc" id="L1513">			response.setDateHeader(&quot;Expires&quot;, 0); // prevents caching at the</span>
			// proxy server
<span class="nc" id="L1515">			response.setHeader(&quot;Cache-Control&quot;, &quot;private&quot;); // HTTP 1.1</span>
<span class="nc" id="L1516">			response.setHeader(&quot;Cache-Control&quot;, &quot;no-store&quot;); // HTTP 1.1</span>
<span class="nc" id="L1517">			response.setHeader(&quot;Cache-Control&quot;, &quot;max-stale=0&quot;); // HTTP 1.1</span>

<span class="nc" id="L1519">			return SUCCESS;</span>
		} finally {
<span class="nc" id="L1521">			conn.close();</span>
		}

	}

	public void verifyIndividualBooks(List&lt;BookBean&gt; bookList)
			throws SQLException {
		// updated by arun
<span class="nc" id="L1529">		Connection conn = DBConnect.getConnection();</span>
		try {
<span class="nc" id="L1531">			copyBookValues(bookList);</span>
<span class="nc bnc" id="L1532" title="All 2 branches missed.">			for (BookBean bean : bookList) {</span>
				try {
<span class="nc" id="L1534">					verifyBook(bean.getBookNumber(), bookList, conn);</span>
<span class="nc" id="L1535">				} catch (Exception e) {</span>
					// TODO Auto-generated catch block
<span class="nc" id="L1537">					e.printStackTrace();</span>
<span class="nc" id="L1538">				}</span>
<span class="nc" id="L1539">			}</span>
		} finally {
<span class="nc" id="L1541">			conn.close();</span>
<span class="nc" id="L1542">		}</span>
<span class="nc" id="L1543">	}</span>

	/**
	 * This method verifies the pack entered by the user
	 * 
	 * @return String
	 * @throws Exception
	 */
	public String verifyPack() throws Exception {

<span class="nc" id="L1553">		boolean isValid = false;</span>
<span class="nc" id="L1554">		int gameId = getGameId();</span>
<span class="nc" id="L1555">		boolean isBlank = false;</span>
<span class="nc" id="L1556">		boolean isDuplicate = false;</span>

<span class="nc" id="L1558">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L1559">		List&lt;PackBean&gt; packList = (List&lt;PackBean&gt;) session</span>
				.getAttribute(&quot;AGT_PACK_LIST&quot;);

<span class="nc" id="L1562">		String packNbr = getPackNbrToVerify();</span>

<span class="nc" id="L1564">		System.out.println(&quot;============== &quot; + getPackNbrToVerify() + &quot;===&quot;</span>
				+ gameNbr);
<span class="nc bnc" id="L1566" title="All 4 branches missed.">		if (packNbr.indexOf(gameNbr + &quot;&quot;) != -1 &amp;&amp; packNbr.indexOf(&quot;-&quot;) == -1) {</span>
<span class="nc" id="L1567">			String str = packNbr.substring((&quot;&quot; + gameNbr).length(), packNbr</span>
					.length());
<span class="nc" id="L1569">			packNbr = gameNbr + &quot;-&quot; + str;</span>
<span class="nc" id="L1570">			System.out.println(&quot;str == &quot; + packNbr);</span>

<span class="nc" id="L1572">		} else {</span>
<span class="nc" id="L1573">			System.out.println(&quot;=======================else&quot;);</span>
		}

		// ********* remove this hard-coded value***********
<span class="nc" id="L1577">		UserInfoBean userInfoBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L1579">		int agtOrgId = userInfoBean.getUserOrgId();</span>
		// int agtOrgId = 2;
		// ****************************************************

		// try {

		// check if the entered pack is valid
<span class="nc bnc" id="L1586" title="All 4 branches missed.">		if (packNbr != null &amp;&amp; !packNbr.trim().equals(&quot;&quot;)) {</span>
<span class="nc" id="L1587">			AgentDispatchGameHelper helper = new AgentDispatchGameHelper();</span>
<span class="nc" id="L1588">			isValid = helper.verifyPack(gameId, agtOrgId, packNbr, gameNbr);</span>
<span class="nc" id="L1589">		} else {</span>
<span class="nc" id="L1590">			isValid = true;</span>
		}

		// when the user changes the packNbr to blanks
<span class="nc bnc" id="L1594" title="All 4 branches missed.">		if (packNbr != null &amp;&amp; packNbr.trim().equals(&quot;&quot;)) {</span>
<span class="nc" id="L1595">			System.out.println(&quot;--For Blank--------&quot;);</span>
<span class="nc" id="L1596">			isBlank = true;</span>
<span class="nc" id="L1597">			PackBean blankBean = packList.get(packCountId - 1);</span>
<span class="nc" id="L1598">			blankBean.setPackNumber(&quot;&quot;);</span>
<span class="nc" id="L1599">			blankBean.setValid(true);</span>
<span class="nc" id="L1600">			blankBean.setStatus(null);</span>

		}

		/*
		 * } catch (LMSException le) { return APPLICATION_ERROR; }
		 */

		/*
		 * try { PrintWriter out = getResponse().getWriter(); if (isValid) {
		 * out.write(&quot;valid&quot;); } } catch (IOException e) { // TODO
		 * Auto-generated catch block e.printStackTrace(); }
		 */

<span class="nc bnc" id="L1614" title="All 2 branches missed.">		if (!isBlank) {</span>

<span class="nc" id="L1616">			System.out.println(&quot;--Agent If Not Blank--------&quot;);</span>
<span class="nc bnc" id="L1617" title="All 2 branches missed.">			if (packList != null) {</span>
<span class="nc" id="L1618">				copyPackValues(packList);</span>

				// for duplicate check

<span class="nc" id="L1622">				int dupCount = 0;</span>

<span class="nc" id="L1624">				int packCountId = getPackCountId();</span>
<span class="nc" id="L1625">				System.out</span>
						.println(&quot;Agent PackCountId:::::::::::&quot; + packCountId);

<span class="nc bnc" id="L1628" title="All 2 branches missed.">				for (PackBean bean : packList) {</span>
<span class="nc bnc" id="L1629" title="All 2 branches missed.">					if (packNbr.equals(bean.getPackNumber())) {</span>
<span class="nc" id="L1630">						dupCount++;</span>
					}

<span class="nc bnc" id="L1633" title="All 2 branches missed.">					if (dupCount &gt; 1) {</span>
<span class="nc" id="L1634">						isDuplicate = true;</span>
<span class="nc" id="L1635">						PackBean dupBean = packList.get(packCountId - 1);</span>
<span class="nc" id="L1636">						dupBean.setValid(false);</span>
<span class="nc" id="L1637">						dupBean.setStatus(&quot;Duplicate Pack&quot;);</span>
<span class="nc" id="L1638">						break;</span>
					}
<span class="nc" id="L1640">				}</span>

<span class="nc bnc" id="L1642" title="All 2 branches missed.">				if (dupCount &lt;= 1) {</span>
<span class="nc" id="L1643">					PackBean dupBean = packList.get(packCountId - 1);</span>
<span class="nc" id="L1644">					dupBean.setValid(true);</span>
<span class="nc" id="L1645">					dupBean.setStatus(null);</span>
				}

<span class="nc bnc" id="L1648" title="All 2 branches missed.">				if (!isDuplicate) {</span>
<span class="nc bnc" id="L1649" title="All 2 branches missed.">					for (PackBean bean : packList) {</span>
<span class="nc" id="L1650">						System.out.println(isValid + &quot;==&quot;</span>
								+ bean.getPackNumber() + &quot;===&quot;
								+ packNbr.equals(bean.getPackNumber()));
<span class="nc bnc" id="L1653" title="All 2 branches missed.">						if (packNbr.equals(bean.getPackNumber())) {</span>
<span class="nc bnc" id="L1654" title="All 2 branches missed.">							if (!isValid) {</span>
<span class="nc" id="L1655">								bean.setValid(false);</span>
<span class="nc" id="L1656">								bean.setStatus(&quot;Wrong Pack Number&quot;);</span>
<span class="nc" id="L1657">								break;</span>
							} else {
<span class="nc" id="L1659">								bean.setValid(true);</span>
<span class="nc" id="L1660">								bean.setStatus(null);</span>
<span class="nc" id="L1661">								break;</span>
							}
						}
<span class="nc" id="L1664">					}</span>
				}

			}
		}

<span class="nc" id="L1670">		setPackList(packList);</span>

		// change the value of no of books to dispatch
<span class="nc" id="L1673">		changeDispatchBooks();</span>

<span class="nc" id="L1675">		System.out.println(&quot;---------Trying to prevent caching------&quot;);</span>
<span class="nc" id="L1676">		HttpServletResponse response = getResponse();</span>
<span class="nc" id="L1677">		response.setHeader(&quot;Pragma&quot;, &quot;no-cache&quot;); // HTTP 1.0</span>
<span class="nc" id="L1678">		response.setHeader(&quot;Cache-Control&quot;, &quot;no-cache&quot;); // HTTP 1.1</span>
<span class="nc" id="L1679">		response.setDateHeader(&quot;Expires&quot;, 0); // prevents caching at the proxy</span>
		// server
<span class="nc" id="L1681">		response.setHeader(&quot;Cache-Control&quot;, &quot;private&quot;); // HTTP 1.1</span>
<span class="nc" id="L1682">		response.setHeader(&quot;Cache-Control&quot;, &quot;no-store&quot;); // HTTP 1.1</span>
<span class="nc" id="L1683">		response.setHeader(&quot;Cache-Control&quot;, &quot;max-stale=0&quot;); // HTTP 1.1</span>

<span class="nc" id="L1685">		return SUCCESS;</span>
	}

	/*	Agent Dispatch Order Starts	*/
	private String gameNumber;
	private String gameName;
	private String challanId;
	private int retailerOrgId;
	private String retailerOrgName;
	private int orderId;
	private String orderNumber;
	private String orderDate;
	private String end;
	private String searchResultsAvailable;

	public String getGameNumber() {
<span class="nc" id="L1701">		return gameNumber;</span>
	}

	public void setGameNumber(String gameNumber) {
<span class="nc" id="L1705">		this.gameNumber = gameNumber;</span>
<span class="nc" id="L1706">	}</span>

	public String getGameName() {
<span class="nc" id="L1709">		return gameName;</span>
	}

	public void setGameName(String gameName) {
<span class="nc" id="L1713">		this.gameName = gameName;</span>
<span class="nc" id="L1714">	}</span>
	
	public String getChallanId() {
<span class="nc" id="L1717">		return challanId;</span>
	}

	public void setChallanId(String challanId) {
<span class="nc" id="L1721">		this.challanId = challanId;</span>
<span class="nc" id="L1722">	}</span>
	public int getRetailerOrgId() {
<span class="nc" id="L1724">		return retailerOrgId;</span>
	}

	public void setRetailerOrgId(int retailerOrgId) {
<span class="nc" id="L1728">		this.retailerOrgId = retailerOrgId;</span>
<span class="nc" id="L1729">	}</span>

	public String getRetailerOrgName() {
<span class="nc" id="L1732">		return retailerOrgName;</span>
	}

	public void setRetailerOrgName(String retailerOrgName) {
<span class="nc" id="L1736">		this.retailerOrgName = retailerOrgName;</span>
<span class="nc" id="L1737">	}</span>

	public int getOrderId() {
<span class="nc" id="L1740">		return orderId;</span>
	}

	public void setOrderId(int orderId) {
<span class="nc" id="L1744">		this.orderId = orderId;</span>
<span class="nc" id="L1745">	}</span>

	public String getOrderNumber() {
<span class="nc" id="L1748">		return orderNumber;</span>
	}

	public void setOrderNumber(String orderNumber) {
<span class="nc" id="L1752">		this.orderNumber = orderNumber;</span>
<span class="nc" id="L1753">	}</span>

	public String getOrderDate() {
<span class="nc" id="L1756">		return orderDate;</span>
	}

	public void setOrderDate(String orderDate) {
<span class="nc" id="L1760">		this.orderDate = orderDate;</span>
<span class="nc" id="L1761">	}</span>

	public String getEnd() {
<span class="nc" id="L1764">		return end;</span>
	}

	public void setEnd(String end) {
<span class="nc" id="L1768">		this.end = end;</span>
<span class="nc" id="L1769">	}</span>

	public String getSearchResultsAvailable() {
<span class="nc" id="L1772">		return searchResultsAvailable;</span>
	}

	public void setSearchResultsAvailable(String searchResultsAvailable) {
<span class="nc" id="L1776">		this.searchResultsAvailable = searchResultsAvailable;</span>
<span class="nc" id="L1777">	}</span>

	public String dispatchOrderMenu() throws LMSException {
<span class="nc" id="L1780">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L1781">		session.setAttribute(&quot;APP_ORDER_LIST1&quot;, null);</span>
<span class="nc" id="L1782">		session.setAttribute(&quot;APP_ORDER_LIST&quot;, null);</span>
<span class="nc" id="L1783">		session.setAttribute(&quot;SearchResultsAvailable&quot;, null);</span>
<span class="nc" id="L1784">		session.setAttribute(&quot;CREDIT_LIMIT&quot;, null);</span>
<span class="nc" id="L1785">		session.setAttribute(&quot;CREDIT_AMT&quot;, null);</span>

<span class="nc" id="L1787">		return SUCCESS;</span>
	}

	public String dispatchOrderSearch() throws LMSException {
<span class="nc" id="L1791">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L1792">		session.setAttribute(&quot;APP_ORDER_LIST1&quot;, null);</span>
<span class="nc" id="L1793">		session.setAttribute(&quot;APP_ORDER_LIST&quot;, null);</span>
<span class="nc" id="L1794">		session.setAttribute(&quot;SearchResultsAvailable&quot;, null);</span>
<span class="nc" id="L1795">		session.setAttribute(&quot;Total_Approve_books&quot;, null);</span>
<span class="nc" id="L1796">		session.setAttribute(&quot;CREDIT_LIMIT&quot;, null);</span>
<span class="nc" id="L1797">		session.setAttribute(&quot;CREDIT_AMT&quot;, null);</span>
<span class="nc" id="L1798">		session.setAttribute(&quot;REMAINING_AVAILABLE_CREDIT_AMT&quot;, null);</span>
		
<span class="nc" id="L1800">		UserInfoBean userInfoBean = (UserInfoBean) session.getAttribute(&quot;USER_INFO&quot;);</span>

<span class="nc" id="L1802">		Map&lt;String, String&gt; searchMap = new HashMap&lt;String, String&gt;();</span>
<span class="nc" id="L1803">		searchMap.put(GameContants.GAME_NAME, gameName);</span>
<span class="nc" id="L1804">		searchMap.put(GameContants.GAME_NBR, gameNumber);</span>
<span class="nc" id="L1805">		searchMap.put(TableConstants.ORG_NAME, retailerOrgName);</span>
<span class="nc" id="L1806">		searchMap.put(GameContants.ORDER_ID, orderNumber);</span>

<span class="nc" id="L1808">		List&lt;OrderBean&gt; searchResults = new AgentDispatchGameHelper().dispatchOrderSearch(gameName, gameNumber, retailerOrgName, orderNumber, userInfoBean.getUserOrgId(),challanId);</span>

<span class="nc bnc" id="L1810" title="All 4 branches missed.">		if (searchResults != null &amp;&amp; searchResults.size() &gt; 0) {</span>
<span class="nc" id="L1811">			session.setAttribute(&quot;APP_ORDER_LIST1&quot;, searchResults);</span>
<span class="nc" id="L1812">			session.setAttribute(&quot;startValueOrderSearch&quot;, new Integer(0));</span>
<span class="nc" id="L1813">			session.setAttribute(&quot;SearchResultsAvailable&quot;, &quot;Yes&quot;);</span>
		} else {
<span class="nc" id="L1815">			session.setAttribute(&quot;SearchResultsAvailable&quot;, &quot;No&quot;);</span>
		}
<span class="nc" id="L1817">		searchAjax();</span>

<span class="nc" id="L1819">		return SUCCESS;</span>
	}

	@SuppressWarnings(&quot;unchecked&quot;)
	public String searchAjax() {
<span class="nc" id="L1824">		int startValue = 0;</span>
<span class="nc" id="L1825">		int endValue = 0;</span>
<span class="nc" id="L1826">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L1827">		List ajaxList = (List) session.getAttribute(&quot;APP_ORDER_LIST1&quot;);</span>
<span class="nc" id="L1828">		List ajaxSearchList = new ArrayList();</span>
<span class="nc bnc" id="L1829" title="All 2 branches missed.">		if (ajaxList != null) {</span>
<span class="nc bnc" id="L1830" title="All 2 branches missed.">			if (getEnd() != null)</span>
<span class="nc" id="L1831">				end = getEnd();</span>
			else
<span class="nc" id="L1833">				end = &quot;first&quot;;</span>

<span class="nc" id="L1835">			startValue = (Integer) session.getAttribute(&quot;startValueOrderSearch&quot;);</span>
<span class="nc bnc" id="L1836" title="All 2 branches missed.">			if (end.equals(&quot;first&quot;)) {</span>
<span class="nc" id="L1837">				startValue = 0;</span>
<span class="nc" id="L1838">				endValue = startValue + 5;</span>
<span class="nc bnc" id="L1839" title="All 2 branches missed.">				if (endValue &gt; ajaxList.size()) {</span>
<span class="nc" id="L1840">					endValue = ajaxList.size();</span>
				}
<span class="nc bnc" id="L1842" title="All 2 branches missed.">			} else if (end.equals(&quot;Previous&quot;)) {</span>
<span class="nc" id="L1843">				startValue = startValue - 5;</span>
<span class="nc bnc" id="L1844" title="All 2 branches missed.">				if (startValue &lt; 5) {</span>
<span class="nc" id="L1845">					startValue = 0;</span>
				}
<span class="nc" id="L1847">				endValue = startValue + 5;</span>
<span class="nc bnc" id="L1848" title="All 2 branches missed.">				if (endValue &gt; ajaxList.size()) {</span>
<span class="nc" id="L1849">					endValue = ajaxList.size();</span>
				}
<span class="nc bnc" id="L1851" title="All 2 branches missed.">			} else if (end.equals(&quot;Next&quot;)) {</span>
<span class="nc" id="L1852">				startValue = startValue + 5;</span>
<span class="nc" id="L1853">				endValue = startValue + 5;</span>
<span class="nc bnc" id="L1854" title="All 2 branches missed.">				if (endValue &gt; ajaxList.size()) {</span>
<span class="nc" id="L1855">					endValue = ajaxList.size();</span>
				}
<span class="nc bnc" id="L1857" title="All 2 branches missed.">				if (startValue &gt; ajaxList.size()) {</span>
<span class="nc" id="L1858">					startValue = ajaxList.size() - ajaxList.size() % 5;</span>
				}
<span class="nc bnc" id="L1860" title="All 2 branches missed.">			} else if (end.equals(&quot;last&quot;)) {</span>
<span class="nc" id="L1861">				endValue = ajaxList.size();</span>
<span class="nc" id="L1862">				startValue = endValue - endValue % 5;</span>
			}
<span class="nc bnc" id="L1864" title="All 2 branches missed.">			if (startValue == endValue) {</span>
<span class="nc" id="L1865">				startValue = endValue - 5;</span>
			}
<span class="nc bnc" id="L1867" title="All 2 branches missed.">			for (int i = startValue; i &lt; endValue; i++) {</span>
<span class="nc" id="L1868">				ajaxSearchList.add(ajaxList.get(i));</span>
			}
<span class="nc" id="L1870">			session.setAttribute(&quot;APP_ORDER_LIST&quot;, ajaxSearchList);</span>
<span class="nc" id="L1871">			session.setAttribute(&quot;startValueOrderSearch&quot;, startValue);</span>
<span class="nc" id="L1872">			setSearchResultsAvailable(&quot;Yes&quot;);</span>
		}

<span class="nc" id="L1875">		return SUCCESS;</span>
	}

	public String dispatchOrderDetails() throws LMSException {
<span class="nc" id="L1879"> 		HttpSession session = getRequest().getSession();</span>

<span class="nc" id="L1881">		OrgAddressBean addrBean = new AgentOrderProcessHelper().fetchAddress(retailerOrgId);</span>
<span class="nc bnc" id="L1882" title="All 2 branches missed.">		if (addrBean != null)</span>
<span class="nc" id="L1883">			session.setAttribute(&quot;ORG_ADDR&quot;, addrBean);</span>

<span class="nc" id="L1885">		DispatchOrderResponse dispatchOrderResponse = new AgentDispatchGameHelper().getBookListFromOrderId(orderId);</span>
<span class="nc" id="L1886">		session.setAttribute(&quot;ORDER_ID&quot;, getOrderId());</span>
<span class="nc" id="L1887">		session.setAttribute(&quot;ORDER_DATE&quot;, getOrderDate());</span>
<span class="nc" id="L1888">		session.setAttribute(&quot;RET_ORG_NAME&quot;, getRetailerOrgName());</span>
<span class="nc" id="L1889">		session.setAttribute(&quot;RET_ORG_ID&quot;, retailerOrgId);</span>
<span class="nc" id="L1890">		session.setAttribute(&quot;CHALLAN_ID&quot;, getChallanId());</span>
<span class="nc" id="L1891">		session.setAttribute(&quot;BOOK_LIST&quot;, dispatchOrderResponse);</span>

<span class="nc" id="L1893">		return SUCCESS;</span>
	}

	@SuppressWarnings(&quot;unchecked&quot;)
	public String dispatchOrderSave() throws Exception {
<span class="nc" id="L1898">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L1899">		UserInfoBean userInfoBean = (UserInfoBean) session.getAttribute(&quot;USER_INFO&quot;);</span>

<span class="nc" id="L1901">		int orderId = (Integer) session.getAttribute(&quot;ORDER_ID&quot;);</span>
<span class="nc" id="L1902">		Map&lt;String, Map&lt;String, List&lt;String&gt;&gt;&gt; gameMap = ((DispatchOrderResponse) session.getAttribute(&quot;BOOK_LIST&quot;)).getOrderData();</span>
<span class="nc" id="L1903">		new AgentDispatchGameHelper().dispatchOrder(orderId, userInfoBean.getUserOrgId(), userInfoBean.getUserType(), gameMap);</span>

<span class="nc" id="L1905">		return SUCCESS;</span>
	}

	/*private static String roundTo2DecimalPlaces(double value) {
		DecimalFormat df = new DecimalFormat(&quot;0.000&quot;);
		String doublevalue = df.format(value);
		return doublevalue;
	}*/
	/*		BO Dispatch Order End		*/
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>