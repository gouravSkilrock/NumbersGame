<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UpdateBookNVirnStatusAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.web.scratchService.inventoryMgmt.common</a> &gt; <span class="el_source">UpdateBookNVirnStatusAction.java</span></div><h1>UpdateBookNVirnStatusAction.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.web.scratchService.inventoryMgmt.common;

import java.io.PrintWriter;
import java.util.List;
import java.util.Map;
import java.util.Set;

import javax.servlet.ServletContext;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.struts2.ServletActionContext;
import org.apache.struts2.interceptor.ServletRequestAware;
import org.apache.struts2.interceptor.ServletResponseAware;

import com.opensymphony.xwork2.ActionSupport;
import com.skilrock.lms.beans.BookSeriesBean;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.coreEngine.scratchService.inventoryMgmt.common.UpdateBookNVirnStatusHelper;

<span class="nc" id="L25">public class UpdateBookNVirnStatusAction extends ActionSupport implements</span>
		ServletRequestAware, ServletResponseAware {
<span class="nc" id="L27">	static Log logger = LogFactory.getLog(UpdateBookNVirnStatusAction.class);</span>

	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;

	private String[] bookNbr;
	private String[] bookSeriesFrom;
	private String[] bookSeriesTo;

	private String fileName;
	private int gameId;
	private String[] packNbr;
	private String[] packSeriesFrom;
	private String[] packSeriesTo;
	private String remarks;
	private HttpServletRequest request;
	private HttpServletResponse response;
	private HttpSession session;
	private String statusType;

	// common function to be called
	public void fetchGameDetailsAjax() {
<span class="nc" id="L51">		PrintWriter pw = null;</span>
		try {
<span class="nc" id="L53">			pw = response.getWriter();</span>
<span class="nc" id="L54">			UpdateBookNVirnStatusHelper helper = new UpdateBookNVirnStatusHelper();</span>
<span class="nc" id="L55">			String gameDetails = helper.fetchPwtGameDetails();</span>
<span class="nc" id="L56">			System.out.println(&quot;game details String on retailer PWT == &quot;</span>
					+ gameDetails);
<span class="nc" id="L58">			pw.print(gameDetails);</span>
<span class="nc" id="L59">		} catch (LMSException e) {</span>
<span class="nc" id="L60">			e.printStackTrace();</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">			if (pw != null) {</span>
<span class="nc" id="L62">				pw.print(&quot;&quot;);</span>
			}
<span class="nc" id="L64">		} catch (Exception e) {</span>
<span class="nc" id="L65">			e.printStackTrace();</span>
<span class="nc" id="L66">		}</span>

<span class="nc" id="L68">	}</span>

	public String[] getBookNbr() {
<span class="nc" id="L71">		return bookNbr;</span>
	}

	public String[] getBookSeriesFrom() {
<span class="nc" id="L75">		return bookSeriesFrom;</span>
	}

	public String[] getBookSeriesTo() {
<span class="nc" id="L79">		return bookSeriesTo;</span>
	}

	public String getFileName() {
<span class="nc" id="L83">		return fileName;</span>
	}

	public int getGameId() {
<span class="nc" id="L87">		return gameId;</span>
	}

	public String[] getPackNbr() {
<span class="nc" id="L91">		return packNbr;</span>
	}

	public String[] getPackSeriesFrom() {
<span class="nc" id="L95">		return packSeriesFrom;</span>
	}

	public String[] getPackSeriesTo() {
<span class="nc" id="L99">		return packSeriesTo;</span>
	}

	public String getRemarks() {
<span class="nc" id="L103">		return remarks;</span>
	}

	public String getStatusType() {
<span class="nc" id="L107">		return statusType;</span>
	}

	public void setBookNbr(String[] bookNbr) {
<span class="nc" id="L111">		this.bookNbr = bookNbr;</span>
<span class="nc" id="L112">	}</span>

	public void setBookSeriesFrom(String[] bookSeriesFrom) {
<span class="nc" id="L115">		this.bookSeriesFrom = bookSeriesFrom;</span>
<span class="nc" id="L116">	}</span>

	public void setBookSeriesTo(String[] bookSeriesTo) {
<span class="nc" id="L119">		this.bookSeriesTo = bookSeriesTo;</span>
<span class="nc" id="L120">	}</span>

	public void setFileName(String fileName) {
<span class="nc" id="L123">		this.fileName = fileName;</span>
<span class="nc" id="L124">	}</span>

	public void setGameId(int gameId) {
<span class="nc" id="L127">		this.gameId = gameId;</span>
<span class="nc" id="L128">	}</span>

	public void setPackNbr(String[] packNbr) {
<span class="nc" id="L131">		this.packNbr = packNbr;</span>
<span class="nc" id="L132">	}</span>

	public void setPackSeriesFrom(String[] packSeriesFrom) {
<span class="nc" id="L135">		this.packSeriesFrom = packSeriesFrom;</span>
<span class="nc" id="L136">	}</span>

	public void setPackSeriesTo(String[] packSeriesTo) {
<span class="nc" id="L139">		this.packSeriesTo = packSeriesTo;</span>
<span class="nc" id="L140">	}</span>

	public void setRemarks(String remarks) {
<span class="nc" id="L143">		this.remarks = remarks;</span>
<span class="nc" id="L144">	}</span>

	public void setServletRequest(HttpServletRequest req) {
<span class="nc" id="L147">		this.request = req;</span>
<span class="nc" id="L148">	}</span>

	public void setServletResponse(HttpServletResponse res) {
<span class="nc" id="L151">		this.response = res;</span>

<span class="nc" id="L153">	}</span>

	public void setStatusType(String statusType) {
<span class="nc" id="L156">		this.statusType = statusType;</span>
<span class="nc" id="L157">		System.out.println(&quot;statusType ============================ &quot;</span>
				+ statusType);
<span class="nc" id="L159">	}</span>

	public String updBookNVirnStatus() throws LMSException {

<span class="nc" id="L163">		session = request.getSession();</span>
<span class="nc" id="L164">		UserInfoBean userBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);

<span class="nc" id="L167">		UpdateBookNVirnStatusHelper helper = new UpdateBookNVirnStatusHelper();</span>

<span class="nc" id="L169">		String errMes = &quot;&quot;;</span>
<span class="nc" id="L170">		errMes = helper.validateBookNVirnEntries(fileName, gameId, bookNbr,</span>
				bookSeriesFrom, bookSeriesTo, packNbr, packSeriesFrom,
				packSeriesTo, remarks);
<span class="nc bnc" id="L173" title="All 4 branches missed.">		if (errMes != null &amp;&amp; !&quot;&quot;.equals(errMes.trim())) {</span>
<span class="nc" id="L174">			addActionError(errMes);</span>
<span class="nc" id="L175">			return INPUT;</span>
		}
<span class="nc" id="L177">		ServletContext sc = ServletActionContext.getServletContext();</span>
<span class="nc" id="L178">		String activateAt = (String) sc.getAttribute(&quot;BOOK_ACTIVATION_AT&quot;);</span>
<span class="nc" id="L179">		Map bookMap = helper.updateBookNVirnStatus(fileName, gameId, bookNbr,</span>
				bookSeriesFrom, bookSeriesTo, packNbr, packSeriesFrom,
				packSeriesTo, userBean.getUserId(), userBean.getUserOrgId(),
				userBean.getUserType(), statusType, remarks, activateAt);

		// Set&lt;String&gt; validBooks = (Set&lt;String&gt;)bookMap.get(&quot;validBooks&quot;);;
<span class="nc" id="L185">		Set&lt;String&gt; inValidBooks = (Set&lt;String&gt;) bookMap.get(&quot;inValidBooks&quot;);</span>
<span class="nc" id="L186">		Set&lt;String&gt; invalidPacks = (Set&lt;String&gt;) bookMap.get(&quot;invalidPacks&quot;);</span>
<span class="nc" id="L187">		List&lt;BookSeriesBean&gt; invalidBkSerList = (List&lt;BookSeriesBean&gt;) bookMap</span>
				.get(&quot;invalidBkSerList&quot;);
<span class="nc" id="L189">		List&lt;BookSeriesBean&gt; invalidPkSerList = (List&lt;BookSeriesBean&gt;) bookMap</span>
				.get(&quot;invalidPkSerList&quot;);

<span class="nc" id="L192">		Set&lt;String&gt; inValidVirnCodeSet = (Set&lt;String&gt;) bookMap</span>
				.get(&quot;inValidVirnCodeSet&quot;);
		// Set&lt;String&gt; virnCodeSetToUpdate =
		// (Set&lt;String&gt;)bookMap.get(&quot;virnCodeSetToUpdate&quot;);

<span class="nc" id="L197">		session = request.getSession();</span>
<span class="nc" id="L198">		session.setAttribute(&quot;miss_inv_bk&quot;, inValidBooks);</span>
<span class="nc" id="L199">		session.setAttribute(&quot;miss_inv_pk&quot;, invalidPacks);</span>
<span class="nc" id="L200">		session.setAttribute(&quot;miss_inv_bkser&quot;, invalidBkSerList);</span>
<span class="nc" id="L201">		session.setAttribute(&quot;miss_inv_pkser&quot;, invalidPkSerList);</span>
<span class="nc" id="L202">		session.setAttribute(&quot;miss_inv_virn&quot;, inValidVirnCodeSet);</span>

<span class="nc" id="L204">		return SUCCESS;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>