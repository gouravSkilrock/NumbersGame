<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CSProductRegistrationHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.commercialService.productMgmt</a> &gt; <span class="el_source">CSProductRegistrationHelper.java</span></div><h1>CSProductRegistrationHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.commercialService.productMgmt;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.beans.CSProductBean;
import com.skilrock.lms.common.db.DBConnect;

<span class="nc" id="L16">public class CSProductRegistrationHelper {</span>
<span class="nc" id="L17">	static Log logger = LogFactory.getLog(CSProductRegistrationHelper.class);</span>
	public String getActiveProductCategories(){
<span class="nc" id="L19">		String html = &quot;&lt;select class=\&quot;option\&quot; name=\&quot;catId\&quot; id=\&quot;catId\&quot;&gt;&lt;option value=\&quot;-1\&quot;&gt;--please select--&lt;/option&gt;&quot;;</span>
<span class="nc" id="L20">		Connection con = DBConnect.getConnection();</span>
		PreparedStatement pstmt;
		ResultSet rs;
		try{
<span class="nc" id="L24">			String query = &quot;select category_id, category_code, description from st_cs_product_category_master where status = 'Active'&quot;;</span>
<span class="nc" id="L25">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L26">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L27" title="All 2 branches missed.">			while(rs.next()){</span>
<span class="nc" id="L28">				html += &quot;&lt;option value=\&quot;&quot;+ rs.getInt(&quot;category_id&quot;) +&quot;\&quot;&gt;&quot;+ rs.getString(&quot;category_code&quot;) +&quot;&lt;/option&gt;&quot;;</span>
			}
<span class="nc" id="L30">			html += &quot;&lt;/select&gt;&quot;;</span>
		}
<span class="nc" id="L32">		catch(SQLException e){</span>
<span class="nc" id="L33">			e.printStackTrace();</span>
<span class="nc" id="L34">		}</span>
<span class="nc" id="L35">		return html;</span>
	}
	
	public String getActiveOperators(){
<span class="nc" id="L39">		String html = &quot;&lt;select class=\&quot;option\&quot; name=\&quot;operatorCode\&quot; id=\&quot;operatorCode\&quot;&gt;&lt;option value=\&quot;-1\&quot;&gt;--please select--&lt;/option&gt;&quot;;</span>
<span class="nc" id="L40">		Connection con = DBConnect.getConnection();</span>
		PreparedStatement pstmt;
		ResultSet rs;
		try{
<span class="nc" id="L44">			String query = &quot;select operator_code, operator_name from st_cs_operator_master where status = 'Active'&quot;;</span>
<span class="nc" id="L45">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L46">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L47" title="All 2 branches missed.">			while(rs.next()){</span>
<span class="nc" id="L48">				html += &quot;&lt;option value=\&quot;&quot;+ rs.getString(&quot;operator_code&quot;) +&quot;\&quot;&gt;&quot;+ rs.getString(&quot;operator_name&quot;) +&quot;&lt;/option&gt;&quot;;</span>
			}
<span class="nc" id="L50">			html += &quot;&lt;/select&gt;&quot;;</span>
		}
<span class="nc" id="L52">		catch(SQLException e){</span>
<span class="nc" id="L53">			e.printStackTrace();</span>
<span class="nc" id="L54">		}</span>
<span class="nc" id="L55">		return html;</span>
	}
	
	public String getActiveCircles(){
<span class="nc" id="L59">		String html = &quot;&lt;select class=\&quot;option\&quot; name=\&quot;circleCode\&quot; id=\&quot;circleCode\&quot;&gt;&lt;option value=\&quot;-1\&quot;&gt;--please select--&lt;/option&gt;&quot;;</span>
<span class="nc" id="L60">		Connection con = DBConnect.getConnection();</span>
		PreparedStatement pstmt;
		ResultSet rs;
		try{
<span class="nc" id="L64">			String query = &quot;select circle_code, circle_name from st_cs_circle_master where status = 'Active'&quot;;</span>
<span class="nc" id="L65">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L66">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L67" title="All 2 branches missed.">			while(rs.next()){</span>
<span class="nc" id="L68">				html += &quot;&lt;option value=\&quot;&quot;+ rs.getString(&quot;circle_code&quot;) +&quot;\&quot;&gt;&quot;+ rs.getString(&quot;circle_name&quot;) +&quot;&lt;/option&gt;&quot;;</span>
			}
<span class="nc" id="L70">			html += &quot;&lt;/select&gt;&quot;;</span>
		}
<span class="nc" id="L72">		catch(SQLException e){</span>
<span class="nc" id="L73">			e.printStackTrace();</span>
<span class="nc" id="L74">		}</span>
<span class="nc" id="L75">		return html;</span>
	}
	
	public static List&lt;Integer&gt; getActiveCategoriesList(){
<span class="nc" id="L79">		List&lt;Integer&gt; catList = new ArrayList&lt;Integer&gt;();</span>
<span class="nc" id="L80">		Connection con = DBConnect.getConnection();</span>
		PreparedStatement pstmt;
		ResultSet rs;
		try{
<span class="nc" id="L84">			String query = &quot;select category_id, category_code, description from st_cs_product_category_master where status = 'Active'&quot;;</span>
<span class="nc" id="L85">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L86">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">			while(rs.next()){</span>
<span class="nc" id="L88">				catList.add(rs.getInt(&quot;category_id&quot;));</span>
			}
		}
<span class="nc" id="L91">		catch(SQLException e){</span>
<span class="nc" id="L92">			e.printStackTrace();</span>
<span class="nc" id="L93">		}</span>
<span class="nc" id="L94">		return catList; </span>
	}
	
	public CSProductBean registerProductInDb(CSProductBean prodBean){
<span class="nc" id="L98">		Connection con = null;</span>
<span class="nc" id="L99">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L100">		ResultSet rs = null;</span>
		try{
<span class="nc" id="L102">			con = DBConnect.getConnection();</span>
<span class="nc" id="L103">			con.setAutoCommit(false);</span>
			//check if product already exists
<span class="nc" id="L105">			pstmt = con.prepareStatement(&quot;select product_id from st_cs_product_master where product_code = ? and operator_code = ? and circle_code = ? and denomination = ?&quot;);</span>
<span class="nc" id="L106">			pstmt.setString(1, prodBean.getProductCode());</span>
<span class="nc" id="L107">			pstmt.setString(2, prodBean.getOperatorCode());</span>
<span class="nc" id="L108">			pstmt.setString(3, prodBean.getCircleCode());</span>
<span class="nc" id="L109">			pstmt.setDouble(4, prodBean.getDenomination());</span>
<span class="nc" id="L110">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">			if(rs.next()){</span>
<span class="nc" id="L112">				prodBean.setStatus(&quot;DUP_PROD_NUM&quot;);</span>
<span class="nc" id="L113">				return prodBean;</span>
			}
			// insert into st_cs_product_master
<span class="nc" id="L116">			pstmt = con.prepareStatement(&quot;insert into st_cs_product_master(product_code, category_id, description,operator_code, circle_code, denomination, country_code, supplier_name, unit_price, retailer_comm, agent_comm, jv_comm, good_cause_comm, vat_comm, status) values ('&quot;</span>
					                       + prodBean.getProductCode() +&quot;','&quot;
					                       + prodBean.getCategoryId() +&quot;','&quot;
					                       + prodBean.getDesc() +&quot;','&quot;
					                       + prodBean.getOperatorCode() +&quot;','&quot;
					                       + prodBean.getCircleCode() +&quot;','&quot;
					                       + prodBean.getDenomination() +&quot;','KEN','&quot;
					                       + prodBean.getSupplierName() +&quot;','&quot;
					                       + prodBean.getUnitPrice() +&quot;','&quot;
					                       + prodBean.getRetailerComm() +&quot;','&quot;
					                       + prodBean.getAgentComm() +&quot;','&quot;
					                       + prodBean.getJvComm() +&quot;','&quot;
					                       + prodBean.getGoodCause() +&quot;','&quot;
					                       + prodBean.getVat() +&quot;','ACTIVE')&quot;);
<span class="nc" id="L130">			logger.debug(&quot;insert in product master: &quot;+pstmt);</span>
<span class="nc" id="L131">			pstmt.executeUpdate();</span>
<span class="nc" id="L132">			rs = pstmt.getGeneratedKeys();</span>
<span class="nc" id="L133">			int prodId = -1;</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">			if(rs.next()){</span>
<span class="nc" id="L135">				prodId = rs.getInt(1);</span>
			}
<span class="nc" id="L137">			prodBean.setProductId(prodId);</span>
			
			//insert into product details
<span class="nc" id="L140">			pstmt = con.prepareStatement(&quot;insert into st_cs_product_details (product_id,talktime,validity,admin_fee,service_tax, recharge_instructions) values (&quot;</span>
											+ prodBean.getProductId() +&quot;,&quot;
											+ prodBean.getTalktime() +&quot;,&quot;
											+ prodBean.getValidity() +&quot;,&quot;
											+ prodBean.getAdminFee() +&quot;,&quot;
											+ prodBean.getServiceTax()+&quot;,'&quot;
											+ prodBean.getRechargeInstruction() +&quot;')&quot;);
<span class="nc" id="L147">			pstmt.executeUpdate();</span>
<span class="nc" id="L148">			con.commit();</span>
<span class="nc" id="L149">			prodBean.setStatus(&quot;SUCCESS&quot;); //SUCCESS: product registered successfully</span>
<span class="nc" id="L150">		}catch(Exception e){</span>
			try{
<span class="nc" id="L152">				con.rollback();</span>
<span class="nc" id="L153">				e.printStackTrace();</span>
<span class="nc" id="L154">			}catch(SQLException sqe){</span>
<span class="nc" id="L155">				sqe.printStackTrace();</span>
<span class="nc" id="L156">			}</span>
			
		}finally{
<span class="nc" id="L159">			try{</span>
<span class="nc" id="L160">				con.close();</span>
<span class="nc" id="L161">			}catch(SQLException sqe){</span>
<span class="nc" id="L162">				sqe.printStackTrace();</span>
<span class="nc" id="L163">			}</span>
<span class="nc" id="L164">		}</span>
<span class="nc" id="L165">		return prodBean;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>