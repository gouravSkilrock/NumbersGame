<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CreditNoteAgentAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.web.accMgmt.common</a> &gt; <span class="el_source">CreditNoteAgentAction.java</span></div><h1>CreditNoteAgentAction.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.web.accMgmt.common;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import org.apache.struts2.interceptor.ServletRequestAware;

import com.opensymphony.xwork2.ActionSupport;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.common.db.TableConstants;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.utility.GenerateRecieptNo;
import com.skilrock.lms.common.utility.OrgCreditUpdation;
import com.skilrock.lms.coreEngine.accMgmt.common.CreditNoteAgentHelper;
import com.skilrock.lms.coreEngine.drawGames.playMgmt.DrawGameOfflineHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.GraphReportHelper;
import com.skilrock.lms.web.drawGames.common.Util;

<span class="nc" id="L29">public class CreditNoteAgentAction extends ActionSupport implements</span>
		ServletRequestAware {
	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	private HttpServletRequest request;
	private String partyType;
	private double amount;
	private String remarks;
	//private String retName;
	private int  orgName;// Org Id
	private String orgNameValue;


	private List retList;

	public String creditNoteAgt() throws LMSException {
<span class="nc" id="L47">		return SUCCESS;</span>

		// get the agents list
/*		HttpSession session = getRequest().getSession();
		UserInfoBean userBean = (UserInfoBean) session
				.getAttribute(&quot;USER_INFO&quot;);
		int agtOrgId = userBean.getUserOrgId();
		Connection con = DBConnect.getConnection();
		Statement stmt = null;
		try {
			retList = new ArrayList();
			stmt = con.createStatement();
			String retListQuery = &quot;select name from st_lms_organization_master where organization_type='RETAILER' and parent_id=&quot;
					+ agtOrgId + &quot; order by name&quot;;
			ResultSet rs = stmt.executeQuery(retListQuery);
			while (rs.next()) {

				String orgName = rs.getString(TableConstants.SOM_ORG_NAME);
				retList.add(orgName);

			}
			
		} catch (SQLException e) {
			e.printStackTrace();
			throw new LMSException(e);
		}

		finally {
			try {
		//		con.close();
			} catch (Exception ee) {
				System.out.println(&quot;Error in closing the Connection&quot;);
				ee.printStackTrace();
				throw new LMSException(ee);

			}

		}
*/
	}
	
	// @ amit 
	public String doCreditNoteAgt(){
		
<span class="nc" id="L91">		Connection con =null;</span>
		try {
<span class="nc" id="L93">			con= DBConnect.getConnection();</span>
<span class="nc" id="L94">			con.setAutoCommit(false);</span>
<span class="nc" id="L95">			HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L96">			UserInfoBean userBean = (UserInfoBean) session</span>
					.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L98">			String parentOrgName = userBean.getOrgName();</span>
<span class="nc" id="L99">			int agtOrgId = userBean.getUserOrgId();</span>
<span class="nc" id="L100">			int agtId = userBean.getUserId();</span>
<span class="nc" id="L101">			int retOrgId = 0;</span>
<span class="nc" id="L102">			retOrgId = orgName;</span>
			
<span class="nc" id="L104">			CreditNoteAgentHelper helper=new CreditNoteAgentHelper();</span>
<span class="nc" id="L105">			String autoGeneratedReceiptNoAndId=helper.doCreditNoteAgt(retOrgId,agtOrgId,agtId,amount,remarks,userBean.getUserType(),con);</span>
<span class="nc" id="L106">			con.commit();</span>
			
<span class="nc" id="L108">			session.setAttribute(&quot;amount&quot;, amount);</span>
<span class="nc" id="L109">			GraphReportHelper graphReportHelper = new GraphReportHelper();</span>

<span class="nc" id="L111">			graphReportHelper.createTextReportAgent(Integer.parseInt(autoGeneratedReceiptNoAndId.split(&quot;#&quot;)[1]), (String) session</span>
					.getAttribute(&quot;ROOT_PATH&quot;), agtOrgId, parentOrgName);
			
<span class="nc" id="L114">			return SUCCESS;</span>

<span class="nc" id="L116">		} catch (SQLException e) {</span>
<span class="nc" id="L117">			e.printStackTrace();</span>
<span class="nc" id="L118">		} catch(Exception e){</span>
<span class="nc" id="L119">			e.printStackTrace();</span>
		}finally {
<span class="nc" id="L121">			DBConnect.closeCon(con);</span>
<span class="nc" id="L122">		}</span>

<span class="nc" id="L124">		return null;</span>

	}
	
	public String creditNoteAgtDesciption(){
<span class="nc" id="L129">		return SUCCESS;</span>
	}

	public HttpServletRequest getRequest() {
<span class="nc" id="L133">		return request;</span>
	}
//
//	public void setRequest(HttpServletRequest request) {
//		this.request = request;
//	}

	public String getPartyType() {
<span class="nc" id="L141">		return partyType;</span>
	}

	public void setPartyType(String partyType) {
<span class="nc" id="L145">		this.partyType = partyType;</span>
<span class="nc" id="L146">	}</span>

	public double getAmount() {
<span class="nc" id="L149">		return amount;</span>
	}

	public void setAmount(double amount) {
<span class="nc" id="L153">		this.amount = amount;</span>
<span class="nc" id="L154">	}</span>

	public String getRemarks() {
<span class="nc" id="L157">		return remarks;</span>
	}

	public void setRemarks(String remarks) {
<span class="nc" id="L161">		this.remarks = remarks;</span>
<span class="nc" id="L162">	}</span>

	public int getOrgName() {
<span class="nc" id="L165">		return orgName;</span>
	}

	public void setOrgName(int orgName) {
<span class="nc" id="L169">		this.orgName = orgName;</span>
<span class="nc" id="L170">	}</span>
	public List getRetList() {
<span class="nc" id="L172">		return retList;</span>
	}

	public void setRetList(List retList) {
<span class="nc" id="L176">		this.retList = retList;</span>
<span class="nc" id="L177">	}</span>

	public void setServletRequest(HttpServletRequest request) {
<span class="nc" id="L180">		this.request = request;</span>
<span class="nc" id="L181">	}</span>

	public String getOrgNameValue() {
<span class="nc" id="L184">		return orgNameValue;</span>
	}

	public void setOrgNameValue(String orgNameValue) {
<span class="nc" id="L188">		this.orgNameValue = orgNameValue;</span>
<span class="nc" id="L189">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>