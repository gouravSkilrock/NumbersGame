<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RetailerOpeningBalanceHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.web.accMgmt.common</a> &gt; <span class="el_source">RetailerOpeningBalanceHelper.java</span></div><h1>RetailerOpeningBalanceHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.web.accMgmt.common;

import java.sql.Connection;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.Statement;
import java.sql.Timestamp;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Iterator;
import java.util.Map;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.beans.AgentCollectionReportOverAllBean;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.filter.LMSFilterDispatcher;
import com.skilrock.lms.web.instantWin.reportsMgmt.beans.IWOrgReportRequestBean;
import com.skilrock.lms.web.instantWin.reportsMgmt.beans.IWOrgReportResponseBean;
import com.skilrock.lms.web.instantWin.reportsMgmt.controller.IWRetailerReportsControllerImpl;
import com.skilrock.lms.web.reportsMgmt.common.ReportUtility;
import com.skilrock.lms.web.sportsLottery.reportsMgmt.beans.SLEOrgReportRequestBean;
import com.skilrock.lms.web.sportsLottery.reportsMgmt.beans.SLEOrgReportResponseBean;
import com.skilrock.lms.web.sportsLottery.reportsMgmt.controller.SLERetailerReportsControllerImpl;
import com.skilrock.lms.web.virtualSports.reportsMgmt.beans.VSOrgReportRequestBean;
import com.skilrock.lms.web.virtualSports.reportsMgmt.beans.VSOrgReportResponseBean;
import com.skilrock.lms.web.virtualSports.reportsMgmt.controller.VSRetailerReportsControllerImpl;

<span class="nc" id="L31">public class RetailerOpeningBalanceHelper {</span>
<span class="nc" id="L32">	Log logger = LogFactory.getLog(RetailerOpeningBalanceHelper.class);</span>

	public Double getRetailerOpeningBal(Timestamp tartDate, Timestamp endDate, int retOrgId, int agentOrgId, Connection con) {

<span class="nc" id="L36">		Date lastArchDate = null;</span>
<span class="nc" id="L37">		String saleTranDG = null;</span>
<span class="nc" id="L38">		String cancelTranDG = null;</span>
<span class="nc" id="L39">		String pwtTranDG = null;</span>
<span class="nc" id="L40">		String saleTranCS = null;</span>
<span class="nc" id="L41">		String cancelTranCS = null;</span>
<span class="nc" id="L42">		double RetOpenBal = 0.0;</span>
<span class="nc" id="L43">		double archivedRetOpenBal = 0.0;</span>
<span class="nc" id="L44">		ResultSet rs = null;</span>
<span class="nc" id="L45">		logger.info(&quot;Retailer Org Id &quot; + retOrgId);</span>

<span class="nc" id="L47">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L48">		Statement stmt = null;</span>

<span class="nc" id="L50">		Calendar checkCal = Calendar.getInstance();</span>
<span class="nc" id="L51">		checkCal.setTimeInMillis(endDate.getTime());</span>
<span class="nc" id="L52">		checkCal.add(Calendar.DAY_OF_MONTH, -1);</span>
		try {
<span class="nc" id="L54">			String lastRunDate = ReportUtility.fetchLastRunDate(con);</span>
<span class="nc" id="L55">			Calendar lastRunCal = Calendar.getInstance();</span>
<span class="nc" id="L56">			lastRunCal.setTimeInMillis(new SimpleDateFormat(&quot;dd-MM-yyyy&quot;).parse(lastRunDate).getTime());</span>
<span class="nc bnc" id="L57" title="All 2 branches missed.">			if (lastRunCal.getTimeInMillis() &gt;= checkCal.getTimeInMillis()) {</span>
<span class="nc" id="L58">				pstmt = con.prepareStatement(&quot;select organization_id,(opening_bal+net_amount_transaction)open_bal from st_rep_org_bal_history where finaldate=? and organization_id =? and organization_type='RETAILER'&quot;);</span>
<span class="nc" id="L59">				pstmt.setTimestamp(1, new Timestamp(checkCal.getTimeInMillis()));</span>
<span class="nc" id="L60">				pstmt.setInt(2, retOrgId);</span>
<span class="nc" id="L61">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L63">					archivedRetOpenBal = rs.getDouble(&quot;open_bal&quot;);</span>
				}
<span class="nc" id="L65">				return archivedRetOpenBal;</span>
			} else {
<span class="nc" id="L67">				pstmt = con.prepareStatement(&quot;select organization_id,(opening_bal+net_amount_transaction)open_bal from st_rep_org_bal_history where finaldate=? and organization_id =? and organization_type='RETAILER'&quot;);</span>
<span class="nc" id="L68">				pstmt.setTimestamp(1, new Timestamp(lastRunCal.getTimeInMillis()));</span>
<span class="nc" id="L69">				pstmt.setInt(2, retOrgId);</span>
<span class="nc" id="L70">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L72">					archivedRetOpenBal = rs.getDouble(&quot;open_bal&quot;);</span>
				}
			}

//			boolean isDataFromArch = ReportUtility.checkDateLessThanLastRunDate(endDate, agentOrgId, &quot;RETAILER&quot;, con);
//			if(isDataFromArch){
//				Calendar cal1=Calendar.getInstance();
//				cal1.setTimeInMillis(endDate.getTime());
//				cal1.add(Calendar.DAY_OF_MONTH, 1);
//				ReportUtility.clearTimeFromDate(cal1);
//				
//				pstmt=con.prepareStatement(&quot;select organization_id,opening_bal from st_rep_org_bal_history where finaldate=? and organization_type='RETAILER' and organization_id=?&quot;);
//				pstmt.setDate(1, new Date(cal1.getTimeInMillis()));
//				pstmt.setInt(2, retOrgId);
//				
//				rs=pstmt.executeQuery();
//				if(rs.next()){
//					archivedRetOpenBal=rs.getDouble(&quot;opening_bal&quot;);
//					
//				}
//				return archivedRetOpenBal;
//				
//			}else{
//				lastArchDate=ReportUtility.getLastArchDateInDateFormat(con);
//				pstmt=con.prepareStatement(&quot;select organization_id,(opening_bal+net_amount_transaction)open_bal from st_rep_org_bal_history where finaldate=? and organization_type='RETAILER' and organization_id=?&quot;);
//				pstmt.setDate(1, lastArchDate);
//				pstmt.setInt(2, retOrgId);
//				rs=pstmt.executeQuery();
//				if(rs.next()){
//					archivedRetOpenBal=rs.getDouble(&quot;open_bal&quot;);
//					
//				}
//			}

<span class="nc" id="L106">			Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L107">			cal.setTimeInMillis(lastRunCal.getTimeInMillis());</span>
<span class="nc" id="L108">			cal.add(Calendar.DAY_OF_MONTH, 1);</span>
<span class="nc" id="L109">			ReportUtility.clearTimeFromDate(cal);</span>
					
<span class="nc" id="L111">			Timestamp fromDate=new Timestamp(cal.getTimeInMillis());</span>
			
<span class="nc" id="L113">				int partyid = retOrgId;</span>
<span class="nc" id="L114">				String accCollectionDetail=&quot;select aa.a 'cash', bb.b 'cheque', cc.c 'cheque_ret', gg.debit_amt 'debit', kk.credit_amt 'credit'  from  (( select ifnull(sum(cash.amount),0) 'a' from st_lms_agent_cash_transaction cash, st_lms_agent_transaction_master btm where cash.agent_org_id=? and cash.retailer_org_id = ? and ( btm.transaction_date &gt;=? and btm.transaction_date&lt;= ?) and cash.transaction_id=btm.transaction_id ) aa, ( select ifnull(sum(chq.cheque_amt),0) 'b' from  st_lms_agent_sale_chq chq, st_lms_agent_transaction_master btm where chq.transaction_type IN ('CHEQUE','CLOSED') and chq.agent_org_id=? and chq.retailer_org_id = ? and ( btm.transaction_date&gt;=? and btm.transaction_date&lt;= ?) and chq.transaction_id=btm.transaction_id  ) bb, ( select ifnull(sum(chq.cheque_amt),0) 'c' from  st_lms_agent_sale_chq chq, st_lms_agent_transaction_master btm where chq.transaction_type='CHQ_BOUNCE' and chq.agent_org_id=? and chq.retailer_org_id =? and (btm.transaction_date&gt;=? and btm.transaction_date&lt;=?) and chq.transaction_id=btm.transaction_id  ) cc,  ( select ifnull(sum(bo.amount),0) 'debit_amt'  from st_lms_agent_debit_note bo, st_lms_agent_transaction_master btm where btm.transaction_id=bo.transaction_id and (bo.transaction_type ='DR_NOTE_CASH' or bo.transaction_type ='DR_NOTE') and agent_org_id =? and retailer_org_id = ? and ( btm.transaction_date&gt;=? and btm.transaction_date&lt;=?) )gg, ( select ifnull(sum(bo.amount),0) 'credit_amt'  from st_lms_agent_credit_note bo, st_lms_agent_transaction_master btm where btm.transaction_id=bo.transaction_id and (bo.transaction_type ='CR_NOTE_CASH' or bo.transaction_type ='CR_NOTE') and agent_org_id =? and retailer_org_id = ? and ( btm.transaction_date&gt;=? and btm.transaction_date&lt;=?) )kk)&quot;;</span>
				/*if (LMSFilterDispatcher.isRepFrmSP) {
					
					String cashCHqCollectionArchQry=&quot;union all select sum(cash_amt) as cash ,sum(cheque_amt) as chq,sum(cheque_bounce_amt) as chq_ret,sum(debit_note) as debit ,sum(credit_note) as credit from st_rep_agent_payments where finaldate&gt;='&quot;+fromDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and retailer_org_id=&quot;+retOrgId+&quot; group by retailer_org_id&quot;;
					
					accCollectionDetail=accCollectionDetail+cashCHqCollectionArchQry;
				
				}*/
				
<span class="nc" id="L123">				pstmt = con.prepareStatement(accCollectionDetail);</span>
<span class="nc" id="L124">				pstmt.setInt(1, agentOrgId);</span>
<span class="nc" id="L125">				pstmt.setInt(2, partyid);</span>
<span class="nc" id="L126">				pstmt.setTimestamp(3, fromDate);</span>
<span class="nc" id="L127">				pstmt.setTimestamp(4, endDate);</span>

<span class="nc" id="L129">				pstmt.setInt(5, agentOrgId);</span>
<span class="nc" id="L130">				pstmt.setInt(6, partyid);</span>
<span class="nc" id="L131">				pstmt.setTimestamp(7, fromDate);</span>
<span class="nc" id="L132">				pstmt.setTimestamp(8, endDate);</span>

<span class="nc" id="L134">				pstmt.setInt(9, agentOrgId);</span>
<span class="nc" id="L135">				pstmt.setInt(10, partyid);</span>
<span class="nc" id="L136">				pstmt.setTimestamp(11, fromDate);</span>
<span class="nc" id="L137">				pstmt.setTimestamp(12, endDate);</span>

<span class="nc" id="L139">				pstmt.setInt(13, agentOrgId);</span>
<span class="nc" id="L140">				pstmt.setInt(14, partyid);</span>
<span class="nc" id="L141">				pstmt.setTimestamp(15, fromDate);</span>
<span class="nc" id="L142">				pstmt.setTimestamp(16, endDate);</span>
				
<span class="nc" id="L144">				pstmt.setInt(17, agentOrgId);</span>
<span class="nc" id="L145">				pstmt.setInt(18, partyid);</span>
<span class="nc" id="L146">				pstmt.setTimestamp(19, fromDate);</span>
<span class="nc" id="L147">				pstmt.setTimestamp(20, endDate);</span>

<span class="nc" id="L149">				rs = pstmt.executeQuery();</span>
<span class="nc" id="L150">				logger</span>
						.debug(&quot;get Agent accounts collections details query- ==== -&quot;
								+ pstmt);
				
				
				
<span class="nc" id="L156">				double recTotal = 0.0;</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L158">					double cash = rs.getDouble(&quot;cash&quot;);</span>
<span class="nc" id="L159">					double cheque = rs.getDouble(&quot;cheque&quot;);</span>
<span class="nc" id="L160">					double credit = rs.getDouble(&quot;credit&quot;);</span>
<span class="nc" id="L161">					double debit = rs.getDouble(&quot;debit&quot;);</span>
<span class="nc" id="L162">					double chqRet = rs.getDouble(&quot;cheque_ret&quot;);</span>
<span class="nc" id="L163">					recTotal =recTotal+ cash + cheque +credit - debit - chqRet;</span>
										
<span class="nc" id="L165">				}</span>
<span class="nc" id="L166">				double scratchTotal = 0.0;</span>
<span class="nc" id="L167">				double drawTotal = 0.0;</span>
<span class="nc" id="L168">				double csTotal=0.0;</span>
<span class="nc" id="L169">				double olaTotal=0.0;</span>
<span class="nc" id="L170">				double sleTotal = 0.0;</span>
<span class="nc" id="L171">				double iwTotal = 0.0;</span>
<span class="nc" id="L172">				double vsTotal = 0.0;</span>
				
<span class="nc bnc" id="L174" title="All 2 branches missed.">				if(ReportUtility.isDG){</span>
<span class="nc" id="L175">					double dgSale=0.0;</span>
<span class="nc" id="L176">					double dgSaleRefund =0.0;</span>
<span class="nc" id="L177">					double dgPwt=0.0;</span>
<span class="nc" id="L178">					saleTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_SALE','DG_SALE_OFFLINE') and transaction_date&gt;='&quot;</span>
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id ='&quot;+retOrgId+&quot;'&quot;;
<span class="nc" id="L183">				cancelTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;='&quot;</span>
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id ='&quot;+retOrgId+&quot;'&quot;;
<span class="nc" id="L188">				pwtTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and transaction_date&gt;='&quot;</span>
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id ='&quot;+retOrgId+&quot;'&quot;;

				// Game Master Query
<span class="nc" id="L195">				String gameQry = &quot;select game_id from st_dg_game_master&quot;;</span>
<span class="nc" id="L196">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L197">				ResultSet rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L198">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select retailer_org_id,ifnull(sum(sale),0.0) as sale from (&quot;);
<span class="nc" id="L200">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select retailer_org_id,ifnull(sum(cancel),0.0) as cancel from (&quot;);
<span class="nc" id="L202">				StringBuilder pwtQry = new StringBuilder(</span>
						&quot;select retailer_org_id,ifnull(sum(pwt),0.0) as pwt from (&quot;);
<span class="nc bnc" id="L204" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L205">					saleQry</span>
							.append(&quot; (select drs.retailer_org_id,sum(net_amt) as sale from st_dg_ret_sale_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; drs where transaction_id in (&quot;
									+ saleTranDG
									+ &quot;) group by drs.retailer_org_id)  union all&quot;);

<span class="nc" id="L212">					cancelQry</span>
							.append(&quot;(select drs.retailer_org_id,sum(net_amt) as cancel from st_dg_ret_sale_refund_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; drs where transaction_id in (&quot;
									+ cancelTranDG
									+ &quot;) group by drs.retailer_org_id)  union all&quot;);

<span class="nc" id="L219">					pwtQry</span>
							.append(&quot;(select drs.retailer_org_id,sum(pwt_amt+retailer_claim_comm-govt_claim_comm) as pwt from st_dg_ret_pwt_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; drs where transaction_id in (&quot;
									+ pwtTranDG
									+ &quot;) group by drs.retailer_org_id)  union all&quot;);

				}

<span class="nc" id="L228">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;), saleQry</span>
						.length());
<span class="nc" id="L230">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;), cancelQry</span>
						.length());
<span class="nc" id="L232">				pwtQry.delete(pwtQry.lastIndexOf(&quot;union all&quot;), pwtQry.length());</span>

<span class="nc" id="L234">				saleQry</span>
						.append(&quot;) saleTlb group by retailer_org_id&quot;);
<span class="nc" id="L236">				cancelQry</span>
						.append(&quot;) cancelTlb group by retailer_org_id&quot;);
<span class="nc" id="L238">				pwtQry</span>
						.append(&quot;) pwtTlb group by retailer_org_id&quot;);
				
<span class="nc bnc" id="L241" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L242">					String saleArchQry=&quot; union all select organization_id,sum(sale_net) as sale from st_rep_dg_retailer where finaldate&gt;='&quot;+fromDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by organization_id&quot;;</span>
<span class="nc" id="L243">					String cancelDebitArchQry=&quot; union all select organization_id,sum(ref_net_amt) as cancel from st_rep_dg_retailer where finaldate&gt;='&quot;+fromDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by organization_id&quot;;</span>
<span class="nc" id="L244">					String pwtArchQry=&quot; union all select organization_id,sum(pwt_net_amt) as pwt  from st_rep_dg_retailer where finaldate&gt;='&quot;+fromDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by organization_id&quot;;</span>
<span class="nc" id="L245">				 saleQry.append(saleArchQry);</span>
<span class="nc" id="L246">				 cancelQry.append(cancelDebitArchQry);</span>
<span class="nc" id="L247">				 pwtQry.append(pwtArchQry);</span>
											
				}
<span class="nc" id="L250">				logger.debug(&quot;-------Draw Sale Qurey------\n&quot; + saleQry);</span>
<span class="nc" id="L251">				logger.debug(&quot;-------Draw Cancel Qurey------\n&quot; + cancelQry);</span>
<span class="nc" id="L252">				logger.debug(&quot;-------Draw Pwt Qurey------\n&quot; + pwtQry);</span>

				// Draw Sale Query
<span class="nc" id="L255">				pstmt = con.prepareStatement(saleQry.toString());</span>
<span class="nc" id="L256">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">				while (rs.next()) {</span>
					
<span class="nc" id="L259">						dgSale=dgSale+	rs.getDouble(&quot;sale&quot;);</span>
				}
				// Draw Cancel Query
<span class="nc" id="L262">				pstmt = con.prepareStatement(cancelQry.toString());</span>
<span class="nc" id="L263">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">				while (rs.next()) {</span>
					
<span class="nc" id="L266">							dgSaleRefund=dgSaleRefund+ rs.getDouble(&quot;cancel&quot;);</span>
				}
				// Draw Pwt Query
<span class="nc" id="L269">				pstmt = con.prepareStatement(pwtQry.toString());</span>
<span class="nc" id="L270">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">				while (rs.next()) {</span>
					
<span class="nc" id="L273">						dgPwt=dgPwt+rs.getDouble(&quot;pwt&quot;);</span>
				}
<span class="nc" id="L275">				drawTotal = dgSale - dgSaleRefund - dgPwt;</span>
			
			}
<span class="nc bnc" id="L278" title="All 2 branches missed.">				if(ReportUtility.isCS){</span>

<span class="nc" id="L280">					double csSale=0.0;</span>
<span class="nc" id="L281">					double csSaleRefund=0.0;</span>
<span class="nc" id="L282">					saleTranCS = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('CS_SALE') and transaction_date&gt;='&quot;</span>
							+ fromDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and retailer_org_id ='&quot;+retOrgId+&quot;'&quot;;
<span class="nc" id="L287">					cancelTranCS = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('CS_CANCEL_SERVER','CS_CANCEL_RET') and transaction_date&gt;='&quot;</span>
							+ fromDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and retailer_org_id ='&quot;+retOrgId+&quot;'&quot;;

					// Category Master Query
<span class="nc" id="L294">					String catQry = &quot;select category_id from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L295">					PreparedStatement gamePstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L296">					ResultSet rsProduct = gamePstmt.executeQuery();</span>
<span class="nc" id="L297">					StringBuilder saleQry = new StringBuilder(</span>
							&quot;select retailer_org_id,ifnull(sum(sale),0.0) as sale from (&quot;);
<span class="nc" id="L299">					StringBuilder cancelQry = new StringBuilder(</span>
							&quot;select retailer_org_id,ifnull(sum(cancel),0.0) as cancel from (&quot;);
<span class="nc bnc" id="L301" title="All 2 branches missed.">					while (rsProduct.next()) {</span>
<span class="nc" id="L302">						saleQry</span>
								.append(&quot; (select drs.retailer_org_id,sum(net_amt) as sale from st_cs_sale_&quot;
										+ rsProduct.getInt(&quot;category_id&quot;)
										+ &quot; drs where transaction_id in (&quot;
										+ saleTranCS
										+ &quot;) group by drs.retailer_org_id)  union all&quot;);

<span class="nc" id="L309">						cancelQry</span>
								.append(&quot;(select drs.retailer_org_id,sum(net_amt) as cancel from st_cs_refund_&quot;
										+ rsProduct.getInt(&quot;category_id&quot;)
										+ &quot; drs where transaction_id in (&quot;
										+ cancelTranCS
										+ &quot;) group by drs.retailer_org_id) union all&quot;);

					}

<span class="nc" id="L318">					saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;), saleQry</span>
							.length());
<span class="nc" id="L320">					cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;), cancelQry</span>
							.length());

<span class="nc" id="L323">					saleQry</span>
							.append(&quot;) saleTlb group by retailer_org_id&quot;);
<span class="nc" id="L325">					cancelQry</span>
							.append(&quot;) cancelTlb group by retailer_org_id&quot;);

<span class="nc bnc" id="L328" title="All 2 branches missed.">					if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L329">						String saleArchQry=&quot; union all select organization_id,sum(sale_net) as sale from st_rep_cs_retailer where finaldate&gt;='&quot;+fromDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by organization_id&quot;;</span>
<span class="nc" id="L330">						String cancelDebitArchQry=&quot; union all select organization_id,sum(ref_net_amt) as cancel from st_rep_cs_retailer where finaldate&gt;='&quot;+fromDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by organization_id&quot;;</span>
						
<span class="nc" id="L332">					 saleQry.append(saleArchQry);</span>
<span class="nc" id="L333">					 cancelQry.append(cancelDebitArchQry);</span>
					}
<span class="nc" id="L335">					logger.debug(&quot;-------CS Sale Query------\n&quot; + saleQry);</span>
<span class="nc" id="L336">					logger.debug(&quot;-------CS Cancel Query------\n&quot; + cancelQry);</span>

					// CS Sale Query
<span class="nc" id="L339">					pstmt = con.prepareStatement(saleQry.toString());</span>
<span class="nc" id="L340">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">					while (rs.next()) {</span>
						
<span class="nc" id="L343">								 csSale=csSale+rs.getDouble(&quot;sale&quot;);</span>
					}
					// CS Cancel Query
<span class="nc" id="L346">					pstmt = con.prepareStatement(cancelQry.toString());</span>
<span class="nc" id="L347">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">					while (rs.next()) {</span>
						
<span class="nc" id="L350">								 csSaleRefund=csSaleRefund+rs.getDouble(&quot;cancel&quot;);</span>
					}
<span class="nc" id="L352">					csTotal=csSale-csSaleRefund;</span>
				}
<span class="nc bnc" id="L354" title="All 2 branches missed.">				if(ReportUtility.isSE){</span>

					// Calculate Scratch Sale
<span class="nc" id="L357">					double seSale=0.0;</span>
<span class="nc" id="L358">					double seSaleRefund=0.0;</span>
<span class="nc" id="L359">					double sePwt=0.0;</span>
<span class="nc" id="L360">					String saleQry = &quot;&quot;;</span>
<span class="nc" id="L361">					String cancelQry=&quot;&quot;;</span>
<span class="nc" id="L362">					logger.info(&quot;----Type Select ---&quot;</span>
							+ LMSFilterDispatcher.seSaleReportType);
<span class="nc bnc" id="L364" title="All 2 branches missed.">					if (&quot;BOOK_WISE&quot;.equals(LMSFilterDispatcher.seSaleReportType)) {</span>
						
<span class="nc" id="L366">						saleQry = &quot;select retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(netAmt),0.0) netAmt from((select art.retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(net_amt),0.0) netAmt  from st_se_agent_retailer_transaction art,st_lms_agent_transaction_master atm where art.transaction_id=atm.transaction_id and atm.transaction_type ='SALE' and transaction_date&gt;='&quot;+fromDate+&quot;' and transaction_date&lt;='&quot;+endDate+&quot;' and art.retailer_org_id='&quot;+retOrgId+&quot;' group by retailer_org_id ) &quot; </span>
						          +	&quot;union all (select art.retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(net_amt),0.0) netAmt  from st_se_agent_ret_loose_book_transaction art,st_lms_agent_transaction_master atm where art.transaction_id=atm.transaction_id and atm.transaction_type ='LOOSE_SALE' and transaction_date&gt;='&quot;+fromDate+&quot;' and transaction_date&lt;='&quot;+endDate+&quot;' and art.retailer_org_id='&quot;+retOrgId+&quot;' group by retailer_org_id))saleTlb group by retailer_org_id &quot;;
						
<span class="nc" id="L369">						cancelQry = &quot;select retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(netAmt),0.0) netAmt from ((select art.retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(net_amt),0.0) netAmt  from st_se_agent_retailer_transaction art,st_lms_agent_transaction_master atm where art.transaction_id=atm.transaction_id and atm.transaction_type ='SALE_RET' and transaction_date&gt;='&quot;+fromDate+&quot;' and transaction_date&lt;='&quot;+endDate+&quot;' and art.retailer_org_id='&quot;+retOrgId+&quot;' group by retailer_org_id) union all&quot; +</span>
								&quot; (select art.retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(net_amt),0.0) netAmt  from st_se_agent_ret_loose_book_transaction art,st_lms_agent_transaction_master atm where art.transaction_id=atm.transaction_id and atm.transaction_type ='LOOSE_SALE_RET' and transaction_date&gt;='&quot;+fromDate+&quot;' and transaction_date&lt;='&quot;+endDate+&quot;' and art.retailer_org_id='&quot;+retOrgId+&quot;' group by retailer_org_id))cancelTlb group by retailer_org_id&quot;;

						
						/*saleQry = &quot;select sale.organization_id,(ifnull(mrpAmt,0.0)-ifnull(mrpAmtRet,0.0)) mrpAmt,(ifnull(netAmt,0.0)-ifnull(netAmtRet,0.0)) netAmt from (select organization_id,name,ifnull(mrpAmt,0.0) mrpAmt,ifnull(netAmt,0.0) netAmt from st_lms_organization_master left outer join (select agent_org_id,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_bo_agent_transaction right outer join st_lms_organization_master on organization_id=agent_org_id where transaction_id in (select transaction_id from st_lms_bo_transaction_master where transaction_type='SALE' and transaction_date&gt;='&quot;
								+ startDate
								+ &quot;' and transaction_date&lt;='&quot;
								+ endDate
								+ &quot;') group by agent_org_id) sale on organization_id=agent_org_id where organization_type='AGENT' and organization_id=&quot;+agtOrgId+&quot;) sale inner join (select organization_id,name,ifnull(mrpAmtRet,0.0) mrpAmtRet,ifnull(netAmtRet,0.0) netAmtRet from st_lms_organization_master left outer join (select agent_org_id,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_bo_agent_transaction where transaction_id in (select transaction_id from st_lms_bo_transaction_master where transaction_type='SALE_RET' and transaction_date&gt;='&quot;
								+ startDate
								+ &quot;' and transaction_date&lt;='&quot;
								+ endDate
								+ &quot;') group by agent_org_id ) saleRet on organization_id=agent_org_id where organization_type='AGENT' and organization_id=&quot;+agtOrgId+&quot;) saleRet on sale.organization_id=saleRet.organization_id&quot;;
				
						
						 cancelQry=&quot;select sbt.agent_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(net_amt),0.0) netAmt,date(btm.transaction_date) date from st_se_bo_agent_transaction sbt,st_lms_bo_transaction_master btm where sbt.transaction_id=btm.transaction_id and btm.transaction_type ='SALE_RET' and transaction_date&gt;='&quot; 
								+ startDate
							    +&quot;' and transaction_date&lt;='&quot; 
							    + endDate
							    +&quot;' and sbt.agent_org_id=&quot;+agtOrgId +&quot; group by date(transaction_date)&quot;;
					
					*/
					
					
					
<span class="nc bnc" id="L394" title="All 2 branches missed.">					} else if (&quot;TICKET_WISE&quot;</span>
							.equals(LMSFilterDispatcher.seSaleReportType)) {
						/*saleQry = &quot;select organization_id,name,ifnull(mrpAmt,0.0) mrpAmt,ifnull(netAmt,0.0) netAmt from st_lms_organization_master left outer join (select current_owner_id,sum(soldTkt*ticket_price) mrpAmt,sum((soldTkt*ticket_price)-(soldTkt*ticket_price*transacrion_sale_comm_rate*0.01)) netAmt from st_se_game_master gm,st_se_game_inv_detail gid,(select game_id,book_nbr,sum(sold_tickets) soldTkt from st_se_game_ticket_inv_history where date&gt;='&quot;
								+ startDate
								+ &quot;' and date&lt;='&quot;
								+ endDate
								+ &quot;' and current_owner='RETAILER' group by book_nbr) TktTlb where gm.game_id=TktTlb.game_id and TktTlb.book_nbr=gid.book_nbr and gid.current_owner='AGENT' group by current_owner_id) saleTlb on organization_id=current_owner_id where organization_type='AGENT' and organization_id=&quot;+agtOrgId;
				*/	}
					
<span class="nc bnc" id="L403" title="All 2 branches missed.">					if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L404">						String saleArchQry=&quot; union all select organization_id,sum(sale_book_mrp),sum(sale_book_net) as sale from st_rep_se_retailer where finaldate&gt;='&quot;+fromDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by organization_id&quot;;</span>
<span class="nc" id="L405">						String cancelDebitArchQry=&quot; union all select organization_id,sum(ref_sale_mrp),sum(ref_net_amt) as cancel from st_rep_se_retailer where finaldate&gt;='&quot;+fromDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by organization_id&quot;;</span>
						//String cancelDebitArchQry=&quot;union all select finaldate,sum(pwt_net_amt) as pwt from st_rep_se_retailer where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by finaldate&quot;;
<span class="nc" id="L407">					 saleQry=saleQry+saleArchQry;</span>
<span class="nc" id="L408">					 cancelQry=cancelQry+cancelDebitArchQry;</span>
					}
					
<span class="nc" id="L411">					pstmt = con.prepareStatement(saleQry);</span>
<span class="nc" id="L412">					logger.debug(&quot;***Scratch Sale Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L413">					rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L415" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L416">						seSale=seSale+	rs.getDouble(&quot;netAmt&quot;);</span>
					}

<span class="nc" id="L419">					pstmt = con.prepareStatement(cancelQry);</span>
<span class="nc" id="L420">					logger.debug(&quot;***Scratch Cancel Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L421">					rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L423" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L424">						seSaleRefund=seSaleRefund+	rs.getDouble(&quot;netAmt&quot;);</span>
					}

					
					// Calculate Scratch Pwt
<span class="nc" id="L429">					String pwtQry = &quot;select &quot;+retOrgId+&quot;,ifnull(sum(pwt_amt+(pwt_amt*claim_comm*0.01)),0.0) pwt  from st_lms_retailer_transaction_master rtm,st_se_retailer_pwt srw where rtm.transaction_id=srw.transaction_id and rtm.transaction_type in('PWT','PWT_AUTO') and transaction_date&gt;='&quot;+fromDate+&quot;' and transaction_date&lt;='&quot;+endDate+&quot;' and &quot; </span>
					+ &quot;srw.retailer_org_id='&quot;+retOrgId+&quot;' &quot;;
<span class="nc bnc" id="L431" title="All 2 branches missed.">					if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L432">						String pwtArchQry=&quot;union all select organization_id,sum(pwt_net_amt) as pwt from st_rep_se_retailer where finaldate&gt;='&quot;+fromDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by organization_id&quot;;</span>
<span class="nc" id="L433">						pwtQry=pwtQry+pwtArchQry;</span>
					 
					}
<span class="nc" id="L436">					stmt = con.createStatement();</span>
<span class="nc" id="L437">					logger.debug(&quot;***Scratch Pwt Query*** \n&quot; + pwtQry);</span>
<span class="nc" id="L438">					rs = stmt.executeQuery(pwtQry);</span>
//					pstmt = con.prepareStatement(pwtQry);
//					logger.debug(&quot;***Scratch Pwt Query*** \n&quot; + pstmt);
//					rs = pstmt.executeQuery();

<span class="nc bnc" id="L443" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L444">						sePwt=sePwt+rs.getDouble(&quot;pwt&quot;);</span>
					}

<span class="nc" id="L447">				scratchTotal=seSale-seSaleRefund-sePwt;</span>
				
				}
<span class="nc bnc" id="L450" title="All 2 branches missed.">				if(ReportUtility.isOLA){</span>

<span class="nc" id="L452">					double olaDeposit=0.0;</span>
<span class="nc" id="L453">					double olaDepositRefund=0.0;</span>
<span class="nc" id="L454">					double olaWithdrawal=0.0;</span>
<span class="nc" id="L455">					double olaWithdrawalRefund=0.0;</span>
<span class="nc" id="L456">					double netGaming = 0.0;</span>
					

<span class="nc" id="L459">				StringBuilder wdQry = new StringBuilder(</span>
						&quot;select drs.retailer_org_id,sum(net_amt) as wdraw &quot;);
<span class="nc" id="L461">				StringBuilder wdRefQry = new StringBuilder(</span>
						&quot;select drs.retailer_org_id,sum(net_amt) as wdrawRef from &quot;);
<span class="nc" id="L463">				StringBuilder depQry = new StringBuilder(</span>
						&quot;select drs.retailer_org_id,sum(net_amt) as depoAmt&quot;);
<span class="nc" id="L465">				StringBuilder depRefQry = new StringBuilder(</span>
						&quot;select drs.retailer_org_id,sum(net_amt) as depoRefAmt from &quot;);

<span class="nc" id="L468">				wdQry</span>
						.append(&quot;from st_ola_ret_withdrawl drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_WITHDRAWL') and transaction_date&gt;='&quot;+fromDate+&quot;' and transaction_date&lt;='&quot;+endDate+&quot;' and retailer_org_id =&quot;+retOrgId+&quot;) group by drs.retailer_org_id&quot;);

<span class="nc" id="L471">				wdRefQry</span>
						.append(&quot;st_ola_ret_withdrawl_refund drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_WITHDRAWL_REFUND') and transaction_date&gt;='&quot;+fromDate+&quot;' and transaction_date&lt;='&quot;+endDate+&quot;' and retailer_org_id =&quot;+retOrgId+&quot;) group by drs.retailer_org_id&quot;);
<span class="nc" id="L473">				depQry</span>
						.append(&quot; from st_ola_ret_deposit drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_DEPOSIT') and transaction_date&gt;='&quot;+fromDate+&quot;' and transaction_date&lt;='&quot;+endDate+&quot;' and retailer_org_id =&quot;+retOrgId+&quot;) group by drs.retailer_org_id&quot;);

<span class="nc" id="L476">				depRefQry</span>
						.append(&quot;st_ola_ret_deposit_refund drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_DEPOSIT_REFUND') and transaction_date&gt;='&quot;+fromDate+&quot;' and transaction_date&lt;='&quot;+endDate+&quot;' and retailer_org_id =&quot;+retOrgId+&quot;) group by drs.retailer_org_id&quot;);

<span class="nc" id="L479">				String netGamingQry = &quot;select drs.retailer_org_id,sum(retailer_net_claim_comm) as netAmt from st_ola_ret_comm drs inner join st_lms_retailer_transaction_master rtm on drs.transaction_id=rtm.transaction_id where transaction_type in('OLA_COMMISSION') and transaction_date&gt;='&quot;+fromDate+&quot;' and transaction_date&lt;='&quot;+endDate+&quot;' and drs.retailer_org_id =&quot;+retOrgId+&quot; group by drs.retailer_org_id&quot;;</span>
<span class="nc" id="L480">				logger.debug(&quot;-------Withdrawal Query------\n&quot; + wdQry);</span>
<span class="nc" id="L481">				logger.debug(&quot;-------WithDrawal Refund Query------\n&quot;</span>
						+ wdRefQry);
<span class="nc" id="L483">				logger.debug(&quot;-------Deposit Query------\n&quot; + depQry);</span>
<span class="nc" id="L484">				logger.debug(&quot;-------Deposit Refund Query------\n&quot; + depRefQry);</span>
<span class="nc" id="L485">				logger.debug(&quot;-------Net Gaming Query------\n&quot; + netGamingQry);</span>

					// OLA Deposit Query
<span class="nc" id="L488">					pstmt = con.prepareStatement(depQry.toString());</span>
<span class="nc" id="L489">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L490" title="All 2 branches missed.">					while (rs.next()) {</span>
						
<span class="nc" id="L492">						olaDeposit=olaDeposit+rs.getDouble(&quot;depoAmt&quot;);</span>
					}
					// OLA Deposit Refund Query
<span class="nc" id="L495">					pstmt = con.prepareStatement(depRefQry.toString());</span>
<span class="nc" id="L496">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">					while (rs.next()) {</span>
						
<span class="nc" id="L499">						olaDepositRefund=olaDepositRefund+rs.getDouble(&quot;depoRefAmt&quot;);</span>
					}
					// OLA Withdrawal Query
<span class="nc" id="L502">					pstmt = con.prepareStatement(wdQry.toString());</span>
<span class="nc" id="L503">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L504" title="All 2 branches missed.">					while (rs.next()) {</span>
						
<span class="nc" id="L506">						olaWithdrawal=olaWithdrawal+rs.getDouble(&quot;wdraw&quot;);</span>
					}
					// OLA Withdrawal Refund Query
<span class="nc" id="L509">					pstmt = con.prepareStatement(wdRefQry.toString());</span>
<span class="nc" id="L510">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L511" title="All 2 branches missed.">					while (rs.next()) {</span>
						
<span class="nc" id="L513">						olaWithdrawalRefund=olaWithdrawalRefund+rs.getDouble(&quot;wdrawRef&quot;);</span>
					}
					// OLA Net Gaming Query
<span class="nc" id="L516">					pstmt = con.prepareStatement(netGamingQry.toString());</span>
<span class="nc" id="L517">					rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L518" title="All 2 branches missed.">					while (rs.next()) {</span>
						
<span class="nc" id="L520">						netGaming=netGaming+rs.getDouble(&quot;netAmt&quot;);</span>
					}
<span class="nc" id="L522">					olaTotal=olaDeposit-olaDepositRefund-olaWithdrawal-olaWithdrawalRefund-netGaming;</span>
				}
				
<span class="nc bnc" id="L525" title="All 2 branches missed.">				if(ReportUtility.isSLE){</span>
<span class="nc" id="L526">					double sleSale=0.0;</span>
<span class="nc" id="L527">					double sleSaleRefund =0.0;</span>
<span class="nc" id="L528">					double slePwt=0.0;</span>
<span class="nc" id="L529">					SLEOrgReportRequestBean requestBean = new SLEOrgReportRequestBean();</span>
<span class="nc" id="L530">					requestBean.setFromDate(fromDate);</span>
<span class="nc" id="L531">					requestBean.setToDate(endDate);</span>
<span class="nc" id="L532">					requestBean.setOrgId(agentOrgId);</span>
<span class="nc" id="L533">					Map&lt;Integer, SLEOrgReportResponseBean&gt; sleResponseBeanMap = SLERetailerReportsControllerImpl</span>
							.fetchSaleCancelPwtMultipleRetailer(requestBean, con);
<span class="nc bnc" id="L535" title="All 2 branches missed.">					for (Map.Entry&lt;Integer, SLEOrgReportResponseBean&gt; entry : sleResponseBeanMap</span>
							.entrySet()) {
<span class="nc" id="L537">						SLEOrgReportResponseBean sleResponseBean = entry.getValue();</span>
<span class="nc" id="L538">						sleSale += sleResponseBean.getSaleAmt();</span>
<span class="nc" id="L539">						sleSaleRefund += sleResponseBean.getCancelAmt();</span>
<span class="nc" id="L540">						slePwt += sleResponseBean.getPwtAmt();</span>
<span class="nc" id="L541">					}</span>
<span class="nc" id="L542">					sleTotal = sleSale - sleSaleRefund - slePwt;</span>
			
				}
<span class="nc bnc" id="L545" title="All 2 branches missed.">				if(ReportUtility.isIW){</span>
<span class="nc" id="L546">					double iwSale=0.0;</span>
<span class="nc" id="L547">					double iwSaleRefund =0.0;</span>
<span class="nc" id="L548">					double iwPwt=0.0;</span>
<span class="nc" id="L549">					IWOrgReportRequestBean requestBean = new IWOrgReportRequestBean();</span>
<span class="nc" id="L550">					requestBean.setFromDate(fromDate);</span>
<span class="nc" id="L551">					requestBean.setToDate(endDate);</span>
<span class="nc" id="L552">					requestBean.setOrgId(retOrgId);</span>
<span class="nc" id="L553">					Map&lt;Integer, IWOrgReportResponseBean&gt; iwResponseBeanMap = IWRetailerReportsControllerImpl</span>
							.fetchSaleCancelPwtSingleRetailer(requestBean, con);
<span class="nc bnc" id="L555" title="All 2 branches missed.">					for (Map.Entry&lt;Integer, IWOrgReportResponseBean&gt; entry : iwResponseBeanMap</span>
							.entrySet()) {
<span class="nc" id="L557">						IWOrgReportResponseBean iwResponseBean = entry.getValue();</span>
<span class="nc" id="L558">						iwSale += iwResponseBean.getSaleAmt();</span>
<span class="nc" id="L559">						iwSaleRefund += iwResponseBean.getCancelAmt();</span>
<span class="nc" id="L560">						iwPwt += iwResponseBean.getPwtAmt();</span>
<span class="nc" id="L561">					}</span>
<span class="nc" id="L562">					iwTotal = iwSale - iwSaleRefund - iwPwt;</span>
			
				}
				
<span class="nc bnc" id="L566" title="All 2 branches missed.">			if (ReportUtility.isVS) {</span>
<span class="nc" id="L567">				double vsSale = 0.0;</span>
<span class="nc" id="L568">				double vsSaleRefund = 0.0;</span>
<span class="nc" id="L569">				double vsPwt = 0.0;</span>
<span class="nc" id="L570">				VSOrgReportRequestBean requestBean = new VSOrgReportRequestBean();</span>
<span class="nc" id="L571">				requestBean.setFromDate(fromDate);</span>
<span class="nc" id="L572">				requestBean.setToDate(endDate);</span>
<span class="nc" id="L573">				requestBean.setOrgId(retOrgId);</span>
<span class="nc" id="L574">				Map&lt;Integer, VSOrgReportResponseBean&gt; vsResponseBeanMap = VSRetailerReportsControllerImpl</span>
						.fetchSaleCancelPwtSingleRetailer(requestBean, con);
<span class="nc bnc" id="L576" title="All 2 branches missed.">				for (Map.Entry&lt;Integer, VSOrgReportResponseBean&gt; entry : vsResponseBeanMap</span>
						.entrySet()) {
<span class="nc" id="L578">					VSOrgReportResponseBean vsResponseBean = entry.getValue();</span>
<span class="nc" id="L579">					vsSale += vsResponseBean.getSaleAmt();</span>
<span class="nc" id="L580">					vsSaleRefund += vsResponseBean.getCancelAmt();</span>
<span class="nc" id="L581">					vsPwt += vsResponseBean.getPwtAmt();</span>
<span class="nc" id="L582">				}</span>
<span class="nc" id="L583">				vsTotal = vsSale - vsSaleRefund - vsPwt;</span>
			}
<span class="nc" id="L585">			RetOpenBal = drawTotal + scratchTotal + csTotal + olaTotal + sleTotal + iwTotal - recTotal + archivedRetOpenBal + vsTotal;</span>
		}
<span class="nc" id="L587">		catch (Exception e) {</span>
<span class="nc" id="L588">			e.printStackTrace();</span>
<span class="nc" id="L589">		}</span>
<span class="nc" id="L590">		return RetOpenBal;</span>
	}
	
	
	public Double getRetailerOpeningBalIncludingCLXCL(Timestamp tartDate, Timestamp endDate, int retOrgId, int agentOrgId, Connection con) {
<span class="nc" id="L595">		Date lastArchDate = null;</span>
<span class="nc" id="L596">		String saleTranDG = null;</span>
<span class="nc" id="L597">		String cancelTranDG = null;</span>
<span class="nc" id="L598">		String pwtTranDG = null;</span>
<span class="nc" id="L599">		String saleTranCS = null;</span>
<span class="nc" id="L600">		String cancelTranCS = null;</span>
<span class="nc" id="L601">		double RetOpenBal = 0.0;</span>
<span class="nc" id="L602">		double archivedRetOpenBal = 0.0;</span>
<span class="nc" id="L603">		ResultSet rs = null;</span>
<span class="nc" id="L604">		logger.info(con + &quot;Retailer Org Id &quot; + retOrgId);</span>

<span class="nc" id="L606">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L607">		Calendar checkCal = Calendar.getInstance();</span>
<span class="nc" id="L608">		checkCal.setTimeInMillis(endDate.getTime());</span>
<span class="nc" id="L609">		checkCal.add(Calendar.DAY_OF_MONTH, -1);</span>
		try {
//			boolean isDataFromArch=ReportUtility.checkDateLessThanLastRunDate(endDate, agentOrgId, &quot;RETAILER&quot;, con);
//			if(isDataFromArch){
//				Calendar cal1=Calendar.getInstance();
//				cal1.setTimeInMillis(endDate.getTime());
//				cal1.add(Calendar.DAY_OF_MONTH, 1);
//				ReportUtility.clearTimeFromDate(cal1);
//				
//				pstmt=con.prepareStatement(&quot;select organization_id,opening_bal_cl_inc from st_rep_org_bal_history where finaldate=? and organization_type='RETAILER' and organization_id=?&quot;);
//				pstmt.setDate(1, new Date(cal1.getTimeInMillis()));
//				pstmt.setInt(2, retOrgId);
//				rs=pstmt.executeQuery();
//				if(rs.next()){
//					archivedRetOpenBal=rs.getDouble(&quot;opening_bal_cl_inc&quot;);
//					
//				}
//				return archivedRetOpenBal;
//				
//			}else{
//				lastArchDate=ReportUtility.getLastArchDateInDateFormat(con);
//				pstmt=con.prepareStatement(&quot;select organization_id,(opening_bal_cl_inc-net_amount_transaction+cl+xcl)open_bal from st_rep_org_bal_history where finaldate=? and organization_type='RETAILER' and organization_id=?&quot;);
//				pstmt.setDate(1, lastArchDate);
//				pstmt.setInt(2, retOrgId);
//				rs=pstmt.executeQuery();
//				if(rs.next()){
//					archivedRetOpenBal=rs.getDouble(&quot;open_bal&quot;);
//					
//				}
//			}

<span class="nc" id="L640">			String lastRunDate = ReportUtility.fetchLastRunDate(con);</span>
<span class="nc" id="L641">			Calendar lastRunCal = Calendar.getInstance();</span>
<span class="nc" id="L642">			lastRunCal.setTimeInMillis(new SimpleDateFormat(&quot;dd-MM-yyyy&quot;).parse(lastRunDate).getTime());</span>
<span class="nc bnc" id="L643" title="All 2 branches missed.">			if (lastRunCal.getTimeInMillis() &gt;= checkCal.getTimeInMillis()) {</span>
<span class="nc" id="L644">				pstmt = con.prepareStatement(&quot;select organization_id,(opening_bal_cl_inc-net_amount_transaction+cl+xcl)open_bal from st_rep_org_bal_history where finaldate=? and organization_id =? and organization_type='RETAILER'&quot;);</span>
<span class="nc" id="L645">				pstmt.setDate(1, new Date(checkCal.getTimeInMillis()));</span>
<span class="nc" id="L646">				pstmt.setInt(2, retOrgId);</span>
<span class="nc" id="L647">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L649">					archivedRetOpenBal = rs.getDouble(&quot;open_bal&quot;);</span>
				}
<span class="nc" id="L651">				return archivedRetOpenBal;</span>
			} else {
<span class="nc" id="L653">				pstmt = con.prepareStatement(&quot;select organization_id,(opening_bal_cl_inc-net_amount_transaction+cl+xcl)open_bal from st_rep_org_bal_history where finaldate=? and organization_id =? and organization_type='RETAILER'&quot;);</span>
<span class="nc" id="L654">				pstmt.setDate(1, new Date(lastRunCal.getTimeInMillis()));</span>
<span class="nc" id="L655">				pstmt.setInt(2, retOrgId);</span>
<span class="nc" id="L656">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L657" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L658">					archivedRetOpenBal = rs.getDouble(&quot;open_bal&quot;);</span>
				}
			}

<span class="nc" id="L662">			Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L663">			cal.setTimeInMillis(lastRunCal.getTimeInMillis());</span>
<span class="nc" id="L664">			cal.add(Calendar.DAY_OF_MONTH, 1);</span>
<span class="nc" id="L665">			ReportUtility.clearTimeFromDate(cal);</span>

//			Calendar cal=Calendar.getInstance();
//			cal.setTimeInMillis(lastArchDate.getTime());
//			cal.add(Calendar.DAY_OF_MONTH, 1);
//			ReportUtility.clearTimeFromDate(cal);
					
<span class="nc" id="L672">			Timestamp fromDate=new Timestamp(cal.getTimeInMillis());</span>

<span class="nc" id="L674">			int partyid = retOrgId;</span>
<span class="nc" id="L675">			String accCollectionDetail = &quot;select aa.a 'cash', bb.b 'cheque', cc.c 'cheque_ret', gg.debit_amt 'debit', kk.credit_amt 'credit',ll.bank_depo 'bank_depo'  from  (( select ifnull(sum(cash.amount),0) 'a' from st_lms_agent_cash_transaction cash, st_lms_agent_transaction_master btm where cash.agent_org_id=? and cash.retailer_org_id = ? and ( btm.transaction_date &gt;=? and btm.transaction_date&lt;= ?) and cash.transaction_id=btm.transaction_id ) aa, ( select ifnull(sum(chq.cheque_amt),0) 'b' from  st_lms_agent_sale_chq chq, st_lms_agent_transaction_master btm where chq.transaction_type IN ('CHEQUE','CLOSED') and chq.agent_org_id=? and chq.retailer_org_id = ? and ( btm.transaction_date&gt;=? and btm.transaction_date&lt;= ?) and chq.transaction_id=btm.transaction_id  ) bb, ( select ifnull(sum(chq.cheque_amt),0) 'c' from  st_lms_agent_sale_chq chq, st_lms_agent_transaction_master btm where chq.transaction_type='CHQ_BOUNCE' and chq.agent_org_id=? and chq.retailer_org_id =? and (btm.transaction_date&gt;=? and btm.transaction_date&lt;=?) and chq.transaction_id=btm.transaction_id  ) cc,  ( select ifnull(sum(bo.amount),0) 'debit_amt'  from st_lms_agent_debit_note bo, st_lms_agent_transaction_master btm where btm.transaction_id=bo.transaction_id and (bo.transaction_type ='DR_NOTE_CASH' or bo.transaction_type ='DR_NOTE') and agent_org_id =? and retailer_org_id = ? and ( btm.transaction_date&gt;=? and btm.transaction_date&lt;=?) )gg, ( select ifnull(sum(bo.amount),0) 'credit_amt'  from st_lms_agent_credit_note bo, st_lms_agent_transaction_master btm where btm.transaction_id=bo.transaction_id and (bo.transaction_type ='CR_NOTE_CASH' or bo.transaction_type ='CR_NOTE') and agent_org_id =? and retailer_org_id = ? and ( btm.transaction_date&gt;=? and btm.transaction_date&lt;=?) )kk,(select ifnull(sum(bdt.amount),0) 'bank_depo' from st_lms_agent_bank_deposit_transaction bdt, st_lms_agent_transaction_master btm where bdt.retailer_org_id = ? and ( btm.transaction_date &gt;=? and btm.transaction_date&lt;= ?) and bdt.transaction_id=btm.transaction_id )ll)&quot;;</span>
			/*if (LMSFilterDispatcher.isRepFrmSP) {
			
			String cashCHqCollectionArchQry=&quot;union all select sum(cash_amt) as cash ,sum(cheque_amt) as chq,sum(cheque_bounce_amt) as chq_ret,sum(debit_note) as debit ,sum(credit_note) as credit from st_rep_agent_payments where finaldate&gt;='&quot;+fromDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and retailer_org_id=&quot;+retOrgId+&quot; group by retailer_org_id&quot;;
			
			accCollectionDetail=accCollectionDetail+cashCHqCollectionArchQry;
		
		}*/

<span class="nc" id="L684">			pstmt = con.prepareStatement(accCollectionDetail);</span>
<span class="nc" id="L685">			pstmt.setInt(1, agentOrgId);</span>
<span class="nc" id="L686">			pstmt.setInt(2, partyid);</span>
<span class="nc" id="L687">			pstmt.setTimestamp(3, fromDate);</span>
<span class="nc" id="L688">			pstmt.setTimestamp(4, endDate);</span>

<span class="nc" id="L690">			pstmt.setInt(5, agentOrgId);</span>
<span class="nc" id="L691">			pstmt.setInt(6, partyid);</span>
<span class="nc" id="L692">			pstmt.setTimestamp(7, fromDate);</span>
<span class="nc" id="L693">			pstmt.setTimestamp(8, endDate);</span>

<span class="nc" id="L695">			pstmt.setInt(9, agentOrgId);</span>
<span class="nc" id="L696">			pstmt.setInt(10, partyid);</span>
<span class="nc" id="L697">			pstmt.setTimestamp(11, fromDate);</span>
<span class="nc" id="L698">			pstmt.setTimestamp(12, endDate);</span>

<span class="nc" id="L700">			pstmt.setInt(13, agentOrgId);</span>
<span class="nc" id="L701">			pstmt.setInt(14, partyid);</span>
<span class="nc" id="L702">			pstmt.setTimestamp(15, fromDate);</span>
<span class="nc" id="L703">			pstmt.setTimestamp(16, endDate);</span>

<span class="nc" id="L705">			pstmt.setInt(17, agentOrgId);</span>
<span class="nc" id="L706">			pstmt.setInt(18, partyid);</span>
<span class="nc" id="L707">			pstmt.setTimestamp(19, fromDate);</span>
<span class="nc" id="L708">			pstmt.setTimestamp(20, endDate);</span>

<span class="nc" id="L710">			pstmt.setInt(21, partyid);</span>
<span class="nc" id="L711">			pstmt.setTimestamp(22, fromDate);</span>
<span class="nc" id="L712">			pstmt.setTimestamp(23, endDate);</span>
<span class="nc" id="L713">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L714">			logger.debug(&quot;get Agent accounts collections details query- ==== -&quot;</span>
					+ pstmt);

<span class="nc" id="L717">			double recTotal = 0.0;</span>
<span class="nc bnc" id="L718" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L719">				double cash = rs.getDouble(&quot;cash&quot;);</span>
<span class="nc" id="L720">				double cheque = rs.getDouble(&quot;cheque&quot;);</span>
<span class="nc" id="L721">				double credit = rs.getDouble(&quot;credit&quot;);</span>
<span class="nc" id="L722">				double debit = rs.getDouble(&quot;debit&quot;);</span>
<span class="nc" id="L723">				double chqRet = rs.getDouble(&quot;cheque_ret&quot;);</span>
<span class="nc" id="L724">				double bankDepo = rs.getDouble(&quot;bank_depo&quot;);</span>
<span class="nc" id="L725">				recTotal = recTotal + cash + cheque + credit + bankDepo - debit</span>
						- chqRet;

<span class="nc" id="L728">			}</span>
<span class="nc" id="L729">			double scratchTotal = 0.0;</span>
<span class="nc" id="L730">			double drawTotal = 0.0;</span>
<span class="nc" id="L731">			double csTotal = 0.0;</span>
<span class="nc" id="L732">			double olaTotal = 0.0;</span>
<span class="nc" id="L733">			double sleTotal = 0.0;</span>
<span class="nc" id="L734">			double iwTotal = 0.0;</span>
<span class="nc" id="L735">			double vsTotal = 0.0;</span>

<span class="nc bnc" id="L737" title="All 2 branches missed.">			if (ReportUtility.isSLE) {</span>
<span class="nc" id="L738">				double sleSale = 0.0;</span>
<span class="nc" id="L739">				double sleSaleRefund = 0.0;</span>
<span class="nc" id="L740">				double slePwt = 0.0;</span>

				// String gameQry = &quot;select game_id from st_sle_game_master&quot;;
				// PreparedStatement gamePstmt = con.prepareStatement(gameQry);
				// ResultSet rsGame = gamePstmt.executeQuery();
<span class="nc" id="L745">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select retailer_org_id,ifnull(sum(sale),0.0) as sale from (&quot;);
<span class="nc" id="L747">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select retailer_org_id,ifnull(sum(cancel),0.0) as cancel from (&quot;);
<span class="nc" id="L749">				StringBuilder pwtQry = new StringBuilder(</span>
						&quot;select retailer_org_id,ifnull(sum(pwt),0.0) as pwt from (&quot;);
				// while (rsGame.next()) {
<span class="nc" id="L752">				saleQry.append(&quot; (select  drs.retailer_org_id,sum(retailer_net_amt) as sale from st_sle_ret_sale&quot;</span>
						+ &quot; drs  inner join	st_lms_retailer_transaction_master rtm  on drs.transaction_id=rtm.transaction_id where &quot;
						+ &quot;	rtm.retailer_org_id =&quot;
						+ retOrgId
						+ &quot; and rtm.transaction_date&gt;='&quot;
						+ fromDate
						+ &quot;'  and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;'  and transaction_type in('SLE_SALE','SLE_SALE_OFFLINE') group by rtm.retailer_org_id)  union all&quot;);

<span class="nc" id="L762">				cancelQry</span>
						.append(&quot;(select drs.retailer_org_id,sum(retailer_net_amt) as cancel from st_sle_ret_sale_refund&quot;
								+ &quot; drs  inner join	st_lms_retailer_transaction_master rtm  on drs.transaction_id=rtm.transaction_id where &quot;
								+ &quot;	rtm.retailer_org_id =&quot;
								+ retOrgId
								+ &quot; and rtm.transaction_date&gt;='&quot;
								+ fromDate
								+ &quot;'  and rtm.transaction_date&lt;='&quot;
								+ endDate
								+ &quot;'  and transaction_type in('SLE_REFUND_CANCEL','SLE_REFUND_FAILED') group by rtm.retailer_org_id)  union all&quot;);

<span class="nc" id="L773">				pwtQry.append(&quot;(select drs.retailer_org_id,sum(pwt_amt+retailer_claim_comm) as pwt from st_sle_ret_pwt&quot;</span>
						+ &quot; drs  inner join	st_lms_retailer_transaction_master rtm  on drs.transaction_id=rtm.transaction_id where &quot;
						+ &quot;	rtm.retailer_org_id =&quot;
						+ retOrgId
						+ &quot; and rtm.transaction_date&gt;='&quot;
						+ fromDate
						+ &quot;'  and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;'  and transaction_type in('SLE_PWT_AUTO','SLE_PWT_PLR','SLE_PWT') group by rtm.retailer_org_id)  union all&quot;);

				// }

<span class="nc" id="L785">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;),</span>
						saleQry.length());
<span class="nc" id="L787">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;),</span>
						cancelQry.length());
<span class="nc" id="L789">				pwtQry.delete(pwtQry.lastIndexOf(&quot;union all&quot;), pwtQry.length());</span>

<span class="nc" id="L791">				saleQry.append(&quot;) saleTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L792">				cancelQry.append(&quot;) cancelTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L793">				pwtQry.append(&quot;) pwtTlb group by retailer_org_id&quot;);</span>

<span class="nc" id="L795">				logger.debug(&quot;-------SLE Sale Qurey------\n&quot; + saleQry);</span>
<span class="nc" id="L796">				logger.debug(&quot;-------SLE Cancel Qurey------\n&quot; + cancelQry);</span>
<span class="nc" id="L797">				logger.debug(&quot;-------SLE Pwt Qurey------\n&quot; + pwtQry);</span>

<span class="nc" id="L799">				Statement stmt = con.createStatement();</span>

<span class="nc" id="L801">				rs = stmt.executeQuery(saleQry.toString());</span>
				// sle sale Query
<span class="nc bnc" id="L803" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L804">					sleSale = sleSale + rs.getDouble(&quot;sale&quot;);</span>
				}
				// sle Cancel Query
<span class="nc" id="L807">				rs = stmt.executeQuery(cancelQry.toString());</span>
				/*
				 * pstmt = con.prepareStatement(cancelQry.toString()); rs =
				 * pstmt.executeQuery();
				 */
<span class="nc bnc" id="L812" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L813">					sleSaleRefund = sleSaleRefund + rs.getDouble(&quot;cancel&quot;);</span>
				}
				// sle Pwt Query
<span class="nc" id="L816">				rs = stmt.executeQuery(pwtQry.toString());</span>

<span class="nc bnc" id="L818" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L819">					slePwt = slePwt + rs.getDouble(&quot;pwt&quot;);</span>
				}
<span class="nc" id="L821">				sleTotal = sleSale - sleSaleRefund - slePwt;</span>
			}

<span class="nc bnc" id="L824" title="All 2 branches missed.">			if (ReportUtility.isIW) {</span>
<span class="nc" id="L825">				double iwSale = 0.0;</span>
<span class="nc" id="L826">				double iwSaleRefund = 0.0;</span>
<span class="nc" id="L827">				double iwPwt = 0.0;</span>

				// String gameQry = &quot;select game_id from st_sle_game_master&quot;;
				// PreparedStatement gamePstmt = con.prepareStatement(gameQry);
				// ResultSet rsGame = gamePstmt.executeQuery();
<span class="nc" id="L832">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select retailer_org_id,ifnull(sum(sale),0.0) as sale from (&quot;);
<span class="nc" id="L834">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select retailer_org_id,ifnull(sum(cancel),0.0) as cancel from (&quot;);
<span class="nc" id="L836">				StringBuilder pwtQry = new StringBuilder(</span>
						&quot;select retailer_org_id,ifnull(sum(pwt),0.0) as pwt from (&quot;);
				// while (rsGame.next()) {
<span class="nc" id="L839">				saleQry.append(&quot; (select  drs.retailer_org_id,sum(retailer_net_amt) as sale from st_iw_ret_sale&quot;</span>
						+ &quot; drs  inner join	st_lms_retailer_transaction_master rtm  on drs.transaction_id=rtm.transaction_id where &quot;
						+ &quot;	rtm.retailer_org_id =&quot;
						+ retOrgId
						+ &quot; and rtm.transaction_date&gt;='&quot;
						+ fromDate
						+ &quot;'  and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;'  and transaction_type in('IW_SALE','IW_SALE_OFFLINE') group by rtm.retailer_org_id)  union all&quot;);

<span class="nc" id="L849">				cancelQry</span>
						.append(&quot;(select drs.retailer_org_id,sum(retailer_net_amt) as cancel from st_iw_ret_sale_refund&quot;
								+ &quot; drs  inner join	st_lms_retailer_transaction_master rtm  on drs.transaction_id=rtm.transaction_id where &quot;
								+ &quot;	rtm.retailer_org_id =&quot;
								+ retOrgId
								+ &quot; and rtm.transaction_date&gt;='&quot;
								+ fromDate
								+ &quot;'  and rtm.transaction_date&lt;='&quot;
								+ endDate
								+ &quot;'  and transaction_type in('IW_REFUND_CANCEL','IW_REFUND_FAILED') group by rtm.retailer_org_id)  union all&quot;);

<span class="nc" id="L860">				pwtQry.append(&quot;(select drs.retailer_org_id,sum(pwt_amt+retailer_claim_comm) as pwt from st_iw_ret_pwt&quot;</span>
						+ &quot; drs  inner join	st_lms_retailer_transaction_master rtm  on drs.transaction_id=rtm.transaction_id where &quot;
						+ &quot;	rtm.retailer_org_id =&quot;
						+ retOrgId
						+ &quot; and rtm.transaction_date&gt;='&quot;
						+ fromDate
						+ &quot;'  and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;'  and transaction_type in('IW_PWT_AUTO','IW_PWT_PLR','IW_PWT') group by rtm.retailer_org_id)  union all&quot;);

				// }

<span class="nc" id="L872">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;),</span>
						saleQry.length());
<span class="nc" id="L874">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;),</span>
						cancelQry.length());
<span class="nc" id="L876">				pwtQry.delete(pwtQry.lastIndexOf(&quot;union all&quot;), pwtQry.length());</span>

<span class="nc" id="L878">				saleQry.append(&quot;) saleTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L879">				cancelQry.append(&quot;) cancelTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L880">				pwtQry.append(&quot;) pwtTlb group by retailer_org_id&quot;);</span>

<span class="nc" id="L882">				logger.debug(&quot;-------IW Sale Qurey------\n&quot; + saleQry);</span>
<span class="nc" id="L883">				logger.debug(&quot;-------IW Cancel Qurey------\n&quot; + cancelQry);</span>
<span class="nc" id="L884">				logger.debug(&quot;-------IW Pwt Qurey------\n&quot; + pwtQry);</span>

<span class="nc" id="L886">				Statement stmt = con.createStatement();</span>

<span class="nc" id="L888">				rs = stmt.executeQuery(saleQry.toString());</span>
				// sle sale Query
<span class="nc bnc" id="L890" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L891">					iwSale = iwSale + rs.getDouble(&quot;sale&quot;);</span>
				}
				// sle Cancel Query
<span class="nc" id="L894">				rs = stmt.executeQuery(cancelQry.toString());</span>
				/*
				 * pstmt = con.prepareStatement(cancelQry.toString()); rs =
				 * pstmt.executeQuery();
				 */
<span class="nc bnc" id="L899" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L900">					iwSaleRefund = iwSaleRefund + rs.getDouble(&quot;cancel&quot;);</span>
				}
				// sle Pwt Query
<span class="nc" id="L903">				rs = stmt.executeQuery(pwtQry.toString());</span>

<span class="nc bnc" id="L905" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L906">					iwPwt = iwPwt + rs.getDouble(&quot;pwt&quot;);</span>
				}
<span class="nc" id="L908">				iwTotal = iwSale - iwSaleRefund - iwPwt;</span>
			}

<span class="nc bnc" id="L911" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L912">				double dgSale = 0.0;</span>
<span class="nc" id="L913">				double dgSaleRefund = 0.0;</span>
<span class="nc" id="L914">				double dgPwt = 0.0;</span>
				/*
				 * saleTranDG =
				 * &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_SALE','DG_SALE_OFFLINE') and transaction_date&gt;='&quot;
				 * + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate +
				 * &quot;' and retailer_org_id ='&quot;+retOrgId+&quot;'&quot;; cancelTranDG =
				 * &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;='&quot;
				 * + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate +
				 * &quot;' and retailer_org_id ='&quot;+retOrgId+&quot;'&quot;; pwtTranDG =
				 * &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and transaction_date&gt;='&quot;
				 * + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate +
				 * &quot;' and retailer_org_id ='&quot;+retOrgId+&quot;'&quot;;
				 */

				// Game Master Query
<span class="nc" id="L929">				String gameQry = &quot;select game_id from st_dg_game_master&quot;;</span>
<span class="nc" id="L930">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L931">				ResultSet rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L932">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select retailer_org_id,ifnull(sum(sale),0.0) as sale from (&quot;);
<span class="nc" id="L934">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select retailer_org_id,ifnull(sum(cancel),0.0) as cancel from (&quot;);
<span class="nc" id="L936">				StringBuilder pwtQry = new StringBuilder(</span>
						&quot;select retailer_org_id,ifnull(sum(pwt),0.0) as pwt from (&quot;);
<span class="nc bnc" id="L938" title="All 2 branches missed.">				while (rsGame.next()) {</span>
					/*
					 * saleQry .append(
					 * &quot; (select drs.retailer_org_id,sum(net_amt) as sale from st_dg_ret_sale_&quot;
					 * + rsGame.getInt(&quot;game_id&quot;) +
					 * &quot; drs where transaction_id in (&quot; + saleTranDG +
					 * &quot;) group by drs.retailer_org_id)  union all&quot;);
					 * 
					 * cancelQry .append(
					 * &quot;(select drs.retailer_org_id,sum(net_amt) as cancel from st_dg_ret_sale_refund_&quot;
					 * + rsGame.getInt(&quot;game_id&quot;) +
					 * &quot; drs where transaction_id in (&quot; + cancelTranDG +
					 * &quot;) group by drs.retailer_org_id)  union all&quot;);
					 * 
					 * pwtQry .append(
					 * &quot;(select drs.retailer_org_id,sum(pwt_amt+retailer_claim_comm) as pwt from st_dg_ret_pwt_&quot;
					 * + rsGame.getInt(&quot;game_id&quot;) +
					 * &quot; drs where transaction_id in (&quot; + pwtTranDG +
					 * &quot;) group by drs.retailer_org_id)  union all&quot;);
					 */
<span class="nc" id="L958">					saleQry.append(&quot; (select  drs.retailer_org_id,sum(net_amt) as sale from st_dg_ret_sale_&quot;</span>
							+ rsGame.getInt(&quot;game_id&quot;)
							+ &quot; drs  inner join	st_lms_retailer_transaction_master rtm  on drs.transaction_id=rtm.transaction_id where &quot;
							+ &quot;	rtm.retailer_org_id =&quot;
							+ retOrgId
							+ &quot; and transaction_date&gt;='&quot;
							+ fromDate
							+ &quot;'  and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;'  and transaction_type in('DG_SALE','DG_SALE_OFFLINE') group by rtm.retailer_org_id)  union all&quot;);

<span class="nc" id="L969">					cancelQry</span>
							.append(&quot;(select drs.retailer_org_id,sum(net_amt) as cancel from st_dg_ret_sale_refund_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; drs  inner join	st_lms_retailer_transaction_master rtm  on drs.transaction_id=rtm.transaction_id where &quot;
									+ &quot;	rtm.retailer_org_id =&quot;
									+ retOrgId
									+ &quot; and transaction_date&gt;='&quot;
									+ fromDate
									+ &quot;'  and transaction_date&lt;='&quot;
									+ endDate
									+ &quot;'  and transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') group by rtm.retailer_org_id)  union all&quot;);

<span class="nc" id="L981">					pwtQry.append(&quot;(select drs.retailer_org_id,sum(pwt_amt+retailer_claim_comm) as pwt from st_dg_ret_pwt_&quot;</span>
							+ rsGame.getInt(&quot;game_id&quot;)
							+ &quot; drs  inner join	st_lms_retailer_transaction_master rtm  on drs.transaction_id=rtm.transaction_id where &quot;
							+ &quot;	rtm.retailer_org_id =&quot;
							+ retOrgId
							+ &quot; and transaction_date&gt;='&quot;
							+ fromDate
							+ &quot;'  and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;'  and transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') group by rtm.retailer_org_id)  union all&quot;);

				}

<span class="nc" id="L994">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;),</span>
						saleQry.length());
<span class="nc" id="L996">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;),</span>
						cancelQry.length());
<span class="nc" id="L998">				pwtQry.delete(pwtQry.lastIndexOf(&quot;union all&quot;), pwtQry.length());</span>

<span class="nc" id="L1000">				saleQry.append(&quot;) saleTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L1001">				cancelQry.append(&quot;) cancelTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L1002">				pwtQry.append(&quot;) pwtTlb group by retailer_org_id&quot;);</span>

				/*
				 * if (LMSFilterDispatcher.isRepFrmSP) { String saleArchQry=
				 * &quot; union all select organization_id,sum(sale_net) as sale from st_rep_dg_retailer where finaldate&gt;='&quot;
				 * +
				 * fromDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;
				 * +retOrgId+&quot; group by organization_id&quot;; String
				 * cancelDebitArchQry=
				 * &quot; union all select organization_id,sum(ref_net_amt) as cancel from st_rep_dg_retailer where finaldate&gt;='&quot;
				 * +
				 * fromDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;
				 * +retOrgId+&quot; group by organization_id&quot;; String pwtArchQry=
				 * &quot; union all select organization_id,sum(pwt_net_amt) as pwt  from st_rep_dg_retailer where finaldate&gt;='&quot;
				 * +
				 * fromDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;
				 * +retOrgId+&quot; group by organization_id&quot;;
				 * saleQry.append(saleArchQry);
				 * cancelQry.append(cancelDebitArchQry);
				 * pwtQry.append(pwtArchQry);
				 * 
				 * }
				 */
<span class="nc" id="L1025">				logger.debug(&quot;-------Draw Sale Qurey------\n&quot; + saleQry);</span>
<span class="nc" id="L1026">				logger.debug(&quot;-------Draw Cancel Qurey------\n&quot; + cancelQry);</span>
<span class="nc" id="L1027">				logger.debug(&quot;-------Draw Pwt Qurey------\n&quot; + pwtQry);</span>

				// Draw Sale Query
				// pstmt = con.prepareStatement(saleQry.toString());
				// rs = pstmt.executeQuery();

<span class="nc" id="L1033">				Statement stmt = con.createStatement();</span>
<span class="nc" id="L1034">				rs = stmt.executeQuery(saleQry.toString());</span>
<span class="nc bnc" id="L1035" title="All 2 branches missed.">				while (rs.next()) {</span>

<span class="nc" id="L1037">					dgSale = dgSale + rs.getDouble(&quot;sale&quot;);</span>
				}
				// Draw Cancel Query
<span class="nc" id="L1040">				rs = stmt.executeQuery(cancelQry.toString());</span>
				/*
				 * pstmt = con.prepareStatement(cancelQry.toString()); rs =
				 * pstmt.executeQuery();
				 */
<span class="nc bnc" id="L1045" title="All 2 branches missed.">				while (rs.next()) {</span>

<span class="nc" id="L1047">					dgSaleRefund = dgSaleRefund + rs.getDouble(&quot;cancel&quot;);</span>
				}
				// Draw Pwt Query
<span class="nc" id="L1050">				rs = stmt.executeQuery(pwtQry.toString());</span>
				/*
				 * pstmt = con.prepareStatement(pwtQry.toString()); rs =
				 * pstmt.executeQuery();
				 */
<span class="nc bnc" id="L1055" title="All 2 branches missed.">				while (rs.next()) {</span>

<span class="nc" id="L1057">					dgPwt = dgPwt + rs.getDouble(&quot;pwt&quot;);</span>
				}
<span class="nc" id="L1059">				drawTotal = dgSale - dgSaleRefund - dgPwt;</span>

			}
<span class="nc bnc" id="L1062" title="All 2 branches missed.">			if (ReportUtility.isCS) {</span>

<span class="nc" id="L1064">				double csSale = 0.0;</span>
<span class="nc" id="L1065">				double csSaleRefund = 0.0;</span>
<span class="nc" id="L1066">				saleTranCS = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('CS_SALE') and transaction_date&gt;='&quot;</span>
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id ='&quot; + retOrgId + &quot;'&quot;;
<span class="nc" id="L1071">				cancelTranCS = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('CS_CANCEL_SERVER','CS_CANCEL_RET') and transaction_date&gt;='&quot;</span>
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id ='&quot; + retOrgId + &quot;'&quot;;

				// Category Master Query
<span class="nc" id="L1078">				String catQry = &quot;select category_id from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L1079">				PreparedStatement gamePstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L1080">				ResultSet rsProduct = gamePstmt.executeQuery();</span>
<span class="nc" id="L1081">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select retailer_org_id,ifnull(sum(sale),0.0) as sale from (&quot;);
<span class="nc" id="L1083">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select retailer_org_id,ifnull(sum(cancel),0.0) as cancel from (&quot;);
<span class="nc bnc" id="L1085" title="All 2 branches missed.">				while (rsProduct.next()) {</span>
<span class="nc" id="L1086">					saleQry.append(&quot; (select drs.retailer_org_id,sum(net_amt) as sale from st_cs_sale_&quot;</span>
							+ rsProduct.getInt(&quot;category_id&quot;)
							+ &quot; drs where transaction_id in (&quot;
							+ saleTranCS
							+ &quot;) group by drs.retailer_org_id)  union all&quot;);

<span class="nc" id="L1092">					cancelQry</span>
							.append(&quot;(select drs.retailer_org_id,sum(net_amt) as cancel from st_cs_refund_&quot;
									+ rsProduct.getInt(&quot;category_id&quot;)
									+ &quot; drs where transaction_id in (&quot;
									+ cancelTranCS
									+ &quot;) group by drs.retailer_org_id) union all&quot;);

				}

<span class="nc" id="L1101">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;),</span>
						saleQry.length());
<span class="nc" id="L1103">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;),</span>
						cancelQry.length());

<span class="nc" id="L1106">				saleQry.append(&quot;) saleTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L1107">				cancelQry.append(&quot;) cancelTlb group by retailer_org_id&quot;);</span>

<span class="nc bnc" id="L1109" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1110">					String saleArchQry = &quot; union all select organization_id,sum(sale_net) as sale from st_rep_cs_retailer where finaldate&gt;='&quot;</span>
							+ fromDate
							+ &quot;' and finaldate&lt;='&quot;
							+ endDate
							+ &quot;' and organization_id=&quot;
							+ retOrgId
							+ &quot; group by organization_id&quot;;
<span class="nc" id="L1117">					String cancelDebitArchQry = &quot; union all select organization_id,sum(ref_net_amt) as cancel from st_rep_cs_retailer where finaldate&gt;='&quot;</span>
							+ fromDate
							+ &quot;' and finaldate&lt;='&quot;
							+ endDate
							+ &quot;' and organization_id=&quot;
							+ retOrgId
							+ &quot; group by organization_id&quot;;

<span class="nc" id="L1125">					saleQry.append(saleArchQry);</span>
<span class="nc" id="L1126">					cancelQry.append(cancelDebitArchQry);</span>
				}
<span class="nc" id="L1128">				logger.debug(&quot;-------CS Sale Query------\n&quot; + saleQry);</span>
<span class="nc" id="L1129">				logger.debug(&quot;-------CS Cancel Query------\n&quot; + cancelQry);</span>

				// CS Sale Query
<span class="nc" id="L1132">				pstmt = con.prepareStatement(saleQry.toString());</span>
<span class="nc" id="L1133">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1134" title="All 2 branches missed.">				while (rs.next()) {</span>

<span class="nc" id="L1136">					csSale = csSale + rs.getDouble(&quot;sale&quot;);</span>
				}
				// CS Cancel Query
<span class="nc" id="L1139">				pstmt = con.prepareStatement(cancelQry.toString());</span>
<span class="nc" id="L1140">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1141" title="All 2 branches missed.">				while (rs.next()) {</span>

<span class="nc" id="L1143">					csSaleRefund = csSaleRefund + rs.getDouble(&quot;cancel&quot;);</span>
				}
<span class="nc" id="L1145">				csTotal = csSale - csSaleRefund;</span>
			}
<span class="nc bnc" id="L1147" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>

				// Calculate Scratch Sale
<span class="nc" id="L1150">				double seSale = 0.0;</span>
<span class="nc" id="L1151">				double seSaleRefund = 0.0;</span>
<span class="nc" id="L1152">				double sePwt = 0.0;</span>
<span class="nc" id="L1153">				String saleQry = &quot;&quot;;</span>
<span class="nc" id="L1154">				String cancelQry = &quot;&quot;;</span>
<span class="nc" id="L1155">				logger.info(&quot;----Type Select ---&quot;</span>
						+ LMSFilterDispatcher.seSaleReportType);
<span class="nc bnc" id="L1157" title="All 2 branches missed.">				if (&quot;BOOK_WISE&quot;.equals(LMSFilterDispatcher.seSaleReportType)) {</span>

<span class="nc" id="L1159">					saleQry = &quot;select retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(netAmt),0.0) netAmt from((select art.retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(net_amt),0.0) netAmt  from st_se_agent_retailer_transaction art,st_lms_agent_transaction_master atm where art.transaction_id=atm.transaction_id and atm.transaction_type ='SALE' and transaction_date&gt;='&quot;</span>
							+ fromDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and art.retailer_org_id='&quot;
							+ retOrgId
							+ &quot;' group by retailer_org_id ) &quot;
							+ &quot;union all (select art.retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(net_amt),0.0) netAmt  from st_se_agent_ret_loose_book_transaction art,st_lms_agent_transaction_master atm where art.transaction_id=atm.transaction_id and atm.transaction_type ='LOOSE_SALE' and transaction_date&gt;='&quot;
							+ fromDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and art.retailer_org_id='&quot;
							+ retOrgId
							+ &quot;' group by retailer_org_id))saleTlb group by retailer_org_id &quot;;

<span class="nc" id="L1174">					cancelQry = &quot;select retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(netAmt),0.0) netAmt from ((select art.retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(net_amt),0.0) netAmt  from st_se_agent_retailer_transaction art,st_lms_agent_transaction_master atm where art.transaction_id=atm.transaction_id and atm.transaction_type ='SALE_RET' and transaction_date&gt;='&quot;</span>
							+ fromDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and art.retailer_org_id='&quot;
							+ retOrgId
							+ &quot;' group by retailer_org_id) union all&quot;
							+ &quot; (select art.retailer_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(net_amt),0.0) netAmt  from st_se_agent_ret_loose_book_transaction art,st_lms_agent_transaction_master atm where art.transaction_id=atm.transaction_id and atm.transaction_type ='LOOSE_SALE_RET' and transaction_date&gt;='&quot;
							+ fromDate
							+ &quot;' and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;' and art.retailer_org_id='&quot;
							+ retOrgId
							+ &quot;' group by retailer_org_id))cancelTlb group by retailer_org_id&quot;;

					/*
					 * saleQry =
					 * &quot;select sale.organization_id,(ifnull(mrpAmt,0.0)-ifnull(mrpAmtRet,0.0)) mrpAmt,(ifnull(netAmt,0.0)-ifnull(netAmtRet,0.0)) netAmt from (select organization_id,name,ifnull(mrpAmt,0.0) mrpAmt,ifnull(netAmt,0.0) netAmt from st_lms_organization_master left outer join (select agent_org_id,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_bo_agent_transaction right outer join st_lms_organization_master on organization_id=agent_org_id where transaction_id in (select transaction_id from st_lms_bo_transaction_master where transaction_type='SALE' and transaction_date&gt;='&quot;
					 * + startDate + &quot;' and transaction_date&lt;='&quot; + endDate +
					 * &quot;') group by agent_org_id) sale on organization_id=agent_org_id where organization_type='AGENT' and organization_id=&quot;
					 * +agtOrgId+
					 * &quot;) sale inner join (select organization_id,name,ifnull(mrpAmtRet,0.0) mrpAmtRet,ifnull(netAmtRet,0.0) netAmtRet from st_lms_organization_master left outer join (select agent_org_id,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_bo_agent_transaction where transaction_id in (select transaction_id from st_lms_bo_transaction_master where transaction_type='SALE_RET' and transaction_date&gt;='&quot;
					 * + startDate + &quot;' and transaction_date&lt;='&quot; + endDate +
					 * &quot;') group by agent_org_id ) saleRet on organization_id=agent_org_id where organization_type='AGENT' and organization_id=&quot;
					 * +agtOrgId+
					 * &quot;) saleRet on sale.organization_id=saleRet.organization_id&quot;
					 * ;
					 * 
					 * 
					 * cancelQry=
					 * &quot;select sbt.agent_org_id,ifnull(sum(mrp_amt),0.0) as mrp_amt,ifnull(sum(net_amt),0.0) netAmt,date(btm.transaction_date) date from st_se_bo_agent_transaction sbt,st_lms_bo_transaction_master btm where sbt.transaction_id=btm.transaction_id and btm.transaction_type ='SALE_RET' and transaction_date&gt;='&quot;
					 * + startDate +&quot;' and transaction_date&lt;='&quot; + endDate
					 * +&quot;' and sbt.agent_org_id=&quot;+agtOrgId
					 * +&quot; group by date(transaction_date)&quot;;
					 */

<span class="nc bnc" id="L1210" title="All 2 branches missed.">				} else if (&quot;TICKET_WISE&quot;</span>
						.equals(LMSFilterDispatcher.seSaleReportType)) {
					/*
					 * saleQry =
					 * &quot;select organization_id,name,ifnull(mrpAmt,0.0) mrpAmt,ifnull(netAmt,0.0) netAmt from st_lms_organization_master left outer join (select current_owner_id,sum(soldTkt*ticket_price) mrpAmt,sum((soldTkt*ticket_price)-(soldTkt*ticket_price*transacrion_sale_comm_rate*0.01)) netAmt from st_se_game_master gm,st_se_game_inv_detail gid,(select game_id,book_nbr,sum(sold_tickets) soldTkt from st_se_game_ticket_inv_history where date&gt;='&quot;
					 * + startDate + &quot;' and date&lt;='&quot; + endDate +
					 * &quot;' and current_owner='RETAILER' group by book_nbr) TktTlb where gm.game_id=TktTlb.game_id and TktTlb.book_nbr=gid.book_nbr and gid.current_owner='AGENT' group by current_owner_id) saleTlb on organization_id=current_owner_id where organization_type='AGENT' and organization_id=&quot;
					 * +agtOrgId;
					 */}

<span class="nc bnc" id="L1220" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1221">					String saleArchQry = &quot; union all select organization_id,sum(sale_book_mrp),sum(sale_book_net) as sale from st_rep_se_retailer where finaldate&gt;='&quot;</span>
							+ fromDate
							+ &quot;' and finaldate&lt;='&quot;
							+ endDate
							+ &quot;' and organization_id=&quot;
							+ retOrgId
							+ &quot; group by organization_id&quot;;
<span class="nc" id="L1228">					String cancelDebitArchQry = &quot; union all select organization_id,sum(ref_sale_mrp),sum(ref_net_amt) as cancel from st_rep_se_retailer where finaldate&gt;='&quot;</span>
							+ fromDate
							+ &quot;' and finaldate&lt;='&quot;
							+ endDate
							+ &quot;' and organization_id=&quot;
							+ retOrgId
							+ &quot; group by organization_id&quot;;
					// String
					// cancelDebitArchQry=&quot;union all select finaldate,sum(pwt_net_amt) as pwt from st_rep_se_retailer where finaldate&gt;='&quot;+startDate+&quot;' and finaldate&lt;='&quot;+endDate+&quot;' and organization_id=&quot;+retOrgId+&quot; group by finaldate&quot;;
<span class="nc" id="L1237">					saleQry = saleQry + saleArchQry;</span>
<span class="nc" id="L1238">					cancelQry = cancelQry + cancelDebitArchQry;</span>
				}

<span class="nc" id="L1241">				pstmt = con.prepareStatement(saleQry);</span>
<span class="nc" id="L1242">				logger.debug(&quot;***Scratch Sale Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L1243">				rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L1245" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1246">					seSale = seSale + rs.getDouble(&quot;netAmt&quot;);</span>
				}

<span class="nc" id="L1249">				pstmt = con.prepareStatement(cancelQry);</span>
<span class="nc" id="L1250">				logger.debug(&quot;***Scratch Cancel Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L1251">				rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L1253" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1254">					seSaleRefund = seSaleRefund + rs.getDouble(&quot;netAmt&quot;);</span>
				}

				// Calculate Scratch Pwt
<span class="nc" id="L1258">				String pwtQry = &quot;select &quot;</span>
						+ retOrgId
						+ &quot;,ifnull(sum(pwt_amt+(pwt_amt*claim_comm*0.01)),0.0) pwt  from st_lms_retailer_transaction_master rtm,st_se_retailer_pwt srw where rtm.transaction_id=srw.transaction_id and rtm.transaction_type in('PWT','PWT_AUTO') and transaction_date&gt;='&quot;
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and &quot;
						+ &quot;srw.retailer_org_id='&quot;
						+ retOrgId
						+ &quot;' union all select &quot;
						+ retOrgId
						+ &quot;,ifnull(sum(pwt_amt+(pwt_amt*claim_comm*0.01)),0.0) pwt  from st_lms_agent_transaction_master atm,st_se_agent_pwt saw where atm.transaction_id=saw.transaction_id and atm.transaction_type in('PWT','PWT_AUTO') and transaction_date&gt;='&quot;
						+ fromDate + &quot;' and transaction_date&lt;='&quot; + endDate
						+ &quot;' and &quot; + &quot;saw.retailer_org_id='&quot; + retOrgId + &quot;'&quot;;
<span class="nc bnc" id="L1272" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1273">					String pwtArchQry = &quot;union all select organization_id,sum(pwt_net_amt) as pwt from st_rep_se_retailer where finaldate&gt;='&quot;</span>
							+ fromDate
							+ &quot;' and finaldate&lt;='&quot;
							+ endDate
							+ &quot;' and organization_id=&quot;
							+ retOrgId
							+ &quot; group by organization_id&quot;;
<span class="nc" id="L1280">					pwtQry = pwtQry + pwtArchQry;</span>

				}
<span class="nc" id="L1283">				pstmt = con.prepareStatement(pwtQry);</span>
<span class="nc" id="L1284">				logger.debug(&quot;***Scratch Pwt Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L1285">				rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L1287" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1288">					sePwt = sePwt + rs.getDouble(&quot;pwt&quot;);</span>
				}
<span class="nc" id="L1290">				scratchTotal = seSale - seSaleRefund - sePwt;</span>
			}
<span class="nc bnc" id="L1292" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>
<span class="nc" id="L1293">				double olaDeposit = 0.0;</span>
<span class="nc" id="L1294">				double olaDepositRefund = 0.0;</span>
<span class="nc" id="L1295">				double olaWithdrawal = 0.0;</span>
<span class="nc" id="L1296">				double olaWithdrawalRefund = 0.0;</span>
<span class="nc" id="L1297">				double netGaming = 0.0;</span>

<span class="nc" id="L1299">				StringBuilder wdQry = new StringBuilder(</span>
						&quot;select drs.retailer_org_id,sum(net_amt) as wdraw &quot;);
<span class="nc" id="L1301">				StringBuilder wdRefQry = new StringBuilder(</span>
						&quot;select drs.retailer_org_id,sum(net_amt) as wdrawRef from &quot;);
<span class="nc" id="L1303">				StringBuilder depQry = new StringBuilder(</span>
						&quot;select drs.retailer_org_id,sum(net_amt) as depoAmt&quot;);
<span class="nc" id="L1305">				StringBuilder depRefQry = new StringBuilder(</span>
						&quot;select drs.retailer_org_id,sum(net_amt) as depoRefAmt from &quot;);

<span class="nc" id="L1308">				wdQry.append(&quot;from st_ola_ret_withdrawl drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_WITHDRAWL') and transaction_date&gt;='&quot;</span>
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id =&quot;
						+ retOrgId
						+ &quot;) group by drs.retailer_org_id&quot;);

<span class="nc" id="L1316">				wdRefQry.append(&quot;st_ola_ret_withdrawl_refund drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_WITHDRAWL_REFUND') and transaction_date&gt;='&quot;</span>
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id =&quot;
						+ retOrgId
						+ &quot;) group by drs.retailer_org_id&quot;);
<span class="nc" id="L1323">				depQry.append(&quot; from st_ola_ret_deposit drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_DEPOSIT') and transaction_date&gt;='&quot;</span>
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id =&quot;
						+ retOrgId
						+ &quot;) group by drs.retailer_org_id&quot;);

<span class="nc" id="L1331">				depRefQry</span>
						.append(&quot;st_ola_ret_deposit_refund drs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type in('OLA_DEPOSIT_REFUND') and transaction_date&gt;='&quot;
								+ fromDate
								+ &quot;' and transaction_date&lt;='&quot;
								+ endDate
								+ &quot;' and retailer_org_id =&quot;
								+ retOrgId + &quot;) group by drs.retailer_org_id&quot;);

<span class="nc" id="L1339">				String netGamingQry = &quot;select drs.retailer_org_id,sum(retailer_net_claim_comm) as netAmt from st_ola_ret_comm drs inner join st_lms_retailer_transaction_master rtm on drs.transaction_id=rtm.transaction_id where transaction_type in('OLA_COMMISSION') and transaction_date&gt;='&quot;</span>
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and drs.retailer_org_id =&quot;
						+ retOrgId
						+ &quot; group by drs.retailer_org_id&quot;;
<span class="nc" id="L1346">				logger.debug(&quot;-------Withdrawal Query------\n&quot; + wdQry);</span>
<span class="nc" id="L1347">				logger.debug(&quot;-------WithDrawal Refund Query------\n&quot;</span>
						+ wdRefQry);
<span class="nc" id="L1349">				logger.debug(&quot;-------Deposit Query------\n&quot; + depQry);</span>
<span class="nc" id="L1350">				logger.debug(&quot;-------Deposit Refund Query------\n&quot; + depRefQry);</span>
<span class="nc" id="L1351">				logger.debug(&quot;-------Net Gaming Query------\n&quot; + netGamingQry);</span>

				// OLA Deposit Query
<span class="nc" id="L1354">				pstmt = con.prepareStatement(depQry.toString());</span>
<span class="nc" id="L1355">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1356" title="All 2 branches missed.">				while (rs.next()) {</span>

<span class="nc" id="L1358">					olaDeposit = olaDeposit + rs.getDouble(&quot;depoAmt&quot;);</span>
				}
				// OLA Deposit Refund Query
<span class="nc" id="L1361">				pstmt = con.prepareStatement(depRefQry.toString());</span>
<span class="nc" id="L1362">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1363" title="All 2 branches missed.">				while (rs.next()) {</span>

<span class="nc" id="L1365">					olaDepositRefund = olaDepositRefund</span>
							+ rs.getDouble(&quot;depoRefAmt&quot;);
				}
				// OLA Withdrawal Query
<span class="nc" id="L1369">				pstmt = con.prepareStatement(wdQry.toString());</span>
<span class="nc" id="L1370">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1371" title="All 2 branches missed.">				while (rs.next()) {</span>

<span class="nc" id="L1373">					olaWithdrawal = olaWithdrawal + rs.getDouble(&quot;wdraw&quot;);</span>
				}
				// OLA Withdrawal Refund Query
<span class="nc" id="L1376">				pstmt = con.prepareStatement(wdRefQry.toString());</span>
<span class="nc" id="L1377">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1378" title="All 2 branches missed.">				while (rs.next()) {</span>

<span class="nc" id="L1380">					olaWithdrawalRefund = olaWithdrawalRefund</span>
							+ rs.getDouble(&quot;wdrawRef&quot;);
				}
				// OLA Net Gaming Query
<span class="nc" id="L1384">				pstmt = con.prepareStatement(netGamingQry.toString());</span>
<span class="nc" id="L1385">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1386" title="All 2 branches missed.">				while (rs.next()) {</span>

<span class="nc" id="L1388">					netGaming = netGaming + rs.getDouble(&quot;netAmt&quot;);</span>
				}
<span class="nc" id="L1390">				olaTotal = olaDeposit - olaDepositRefund - olaWithdrawal</span>
						- olaWithdrawalRefund - netGaming;
			}
			
			
<span class="nc bnc" id="L1395" title="All 2 branches missed.">			if (ReportUtility.isVS) {</span>
<span class="nc" id="L1396">				double vsSale = 0.0;</span>
<span class="nc" id="L1397">				double vsSaleRefund = 0.0;</span>
<span class="nc" id="L1398">				double vsPwt = 0.0;</span>

<span class="nc" id="L1400">				StringBuilder saleQry = new StringBuilder(&quot;select retailer_org_id,ifnull(sum(sale),0.0) as sale from (&quot;);</span>
<span class="nc" id="L1401">				StringBuilder cancelQry = new StringBuilder(&quot;select retailer_org_id,ifnull(sum(cancel),0.0) as cancel from (&quot;);</span>
<span class="nc" id="L1402">				StringBuilder pwtQry = new StringBuilder(&quot;select retailer_org_id,ifnull(sum(pwt),0.0) as pwt from (&quot;);</span>
				// while (rsGame.next()) {
<span class="nc" id="L1404">				saleQry.append(&quot; (select  drs.retailer_org_id,sum(retailer_net_amt) as sale from st_vs_ret_sale&quot;</span>
						+ &quot; drs  inner join	st_lms_retailer_transaction_master rtm  on drs.transaction_id=rtm.transaction_id where &quot;
						+ &quot;	rtm.retailer_org_id =&quot;
						+ retOrgId
						+ &quot; and rtm.transaction_date&gt;='&quot;
						+ fromDate
						+ &quot;'  and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;'  and transaction_type in('VS_SALE','VS_SALE_OFFLINE') group by rtm.retailer_org_id)  union all&quot;);

<span class="nc" id="L1414">				cancelQry</span>
						.append(&quot;(select drs.retailer_org_id,sum(retailer_net_amt) as cancel from st_vs_ret_sale_refund&quot;
								+ &quot; drs  inner join	st_lms_retailer_transaction_master rtm  on drs.transaction_id=rtm.transaction_id where &quot;
								+ &quot;	rtm.retailer_org_id =&quot;
								+ retOrgId
								+ &quot; and rtm.transaction_date&gt;='&quot;
								+ fromDate
								+ &quot;'  and rtm.transaction_date&lt;='&quot;
								+ endDate
								+ &quot;'  and transaction_type in('VS_SALE_REFUND') group by rtm.retailer_org_id)  union all&quot;);

<span class="nc" id="L1425">				pwtQry.append(&quot;(select drs.retailer_org_id,sum(pwt_amt+retailer_claim_comm) as pwt from st_vs_ret_pwt&quot;</span>
						+ &quot; drs  inner join	st_lms_retailer_transaction_master rtm  on drs.transaction_id=rtm.transaction_id where &quot;
						+ &quot;	rtm.retailer_org_id =&quot;
						+ retOrgId
						+ &quot; and rtm.transaction_date&gt;='&quot;
						+ fromDate
						+ &quot;'  and rtm.transaction_date&lt;='&quot;
						+ endDate
						+ &quot;'  and transaction_type in('VS_PWT_AUTO','VS_PWT_PLR','VS_PWT') group by rtm.retailer_org_id)  union all&quot;);

<span class="nc" id="L1435">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;), saleQry.length());</span>
<span class="nc" id="L1436">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;), cancelQry.length());</span>
<span class="nc" id="L1437">				pwtQry.delete(pwtQry.lastIndexOf(&quot;union all&quot;), pwtQry.length());</span>

<span class="nc" id="L1439">				saleQry.append(&quot;) saleTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L1440">				cancelQry.append(&quot;) cancelTlb group by retailer_org_id&quot;);</span>
<span class="nc" id="L1441">				pwtQry.append(&quot;) pwtTlb group by retailer_org_id&quot;);</span>

<span class="nc" id="L1443">				logger.debug(&quot;-------VS Sale Qurey------\n&quot; + saleQry);</span>
<span class="nc" id="L1444">				logger.debug(&quot;-------VS Cancel Qurey------\n&quot; + cancelQry);</span>
<span class="nc" id="L1445">				logger.debug(&quot;-------VS Pwt Qurey------\n&quot; + pwtQry);</span>

<span class="nc" id="L1447">				Statement stmt = con.createStatement();</span>

<span class="nc" id="L1449">				rs = stmt.executeQuery(saleQry.toString());</span>
				// sle sale Query
<span class="nc bnc" id="L1451" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1452">					vsSale = vsSale + rs.getDouble(&quot;sale&quot;);</span>
				}
				// sle Cancel Query
<span class="nc" id="L1455">				rs = stmt.executeQuery(cancelQry.toString());</span>
				/*
				 * pstmt = con.prepareStatement(cancelQry.toString()); rs =
				 * pstmt.executeQuery();
				 */
<span class="nc bnc" id="L1460" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1461">					vsSaleRefund = vsSaleRefund + rs.getDouble(&quot;cancel&quot;);</span>
				}
				// sle Pwt Query
<span class="nc" id="L1464">				rs = stmt.executeQuery(pwtQry.toString());</span>

<span class="nc bnc" id="L1466" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1467">					vsPwt = vsPwt + rs.getDouble(&quot;pwt&quot;);</span>
				}
<span class="nc" id="L1469">				vsTotal = vsSale - vsSaleRefund - vsPwt;</span>
			}
			
<span class="nc" id="L1472">			RetOpenBal = sleTotal + drawTotal + scratchTotal + csTotal + olaTotal + iwTotal - recTotal + vsTotal;</span>
<span class="nc" id="L1473">			double clXclToatl = 0.0;</span>
<span class="nc" id="L1474">			String clXclamt = &quot;select ifnull(sum(amount),0.0) as amount from st_lms_cl_xcl_update_history where organization_id=? and date_time&gt;=? and date_time&lt; ? &quot;;</span>
<span class="nc" id="L1475">			pstmt = con.prepareStatement(clXclamt);</span>
<span class="nc" id="L1476">			pstmt.setInt(1, retOrgId);</span>
<span class="nc" id="L1477">			pstmt.setTimestamp(2, fromDate);</span>
<span class="nc" id="L1478">			pstmt.setTimestamp(3, endDate);</span>
<span class="nc" id="L1479">			ResultSet rs3 = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1480" title="All 2 branches missed.">			while (rs3.next()) {</span>
<span class="nc" id="L1481">				clXclToatl = rs3.getDouble(&quot;amount&quot;);</span>
			}
<span class="nc" id="L1483">			RetOpenBal = (-RetOpenBal) + clXclToatl + archivedRetOpenBal;</span>
		}
<span class="nc" id="L1485">		catch (Exception e) {</span>
<span class="nc" id="L1486">			e.printStackTrace();</span>
<span class="nc" id="L1487">		}</span>
<span class="nc" id="L1488">		return RetOpenBal;</span>
	}
	
	public void collectionRetailerWiseOpenBal(int userId, Timestamp startDate, Timestamp endDate, Connection con,Map&lt;String, AgentCollectionReportOverAllBean&gt; agtMap, int count) throws LMSException {
<span class="nc" id="L1492">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1493">		ResultSet rs = null;</span>
<span class="nc" id="L1494">		String saleTranDG = null;</span>
<span class="nc" id="L1495">		String cancelTranDG = null;</span>
<span class="nc" id="L1496">		String pwtTranDG = null;</span>
<span class="nc" id="L1497">		String saleTranCS = null;</span>
<span class="nc" id="L1498">		String cancelTranCS = null;</span>
<span class="nc" id="L1499">		Date lastArchDate=null;</span>
<span class="nc bnc" id="L1500" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L1501">			return;</span>
		}

<span class="nc" id="L1504">		Calendar checkCal = Calendar.getInstance();</span>
<span class="nc" id="L1505">		checkCal.setTimeInMillis(endDate.getTime());</span>
<span class="nc" id="L1506">		checkCal.add(Calendar.DAY_OF_MONTH, -1);</span>

		try {
//			boolean isDataFromArch=ReportUtility.checkDateLessThanLastRunDate(endDate, userId, &quot;RETAILER&quot;, con);
//			if(isDataFromArch){
//				Calendar cal1=Calendar.getInstance();
//				cal1.setTimeInMillis(endDate.getTime());
//				cal1.add(Calendar.DAY_OF_MONTH, 1);
//				ReportUtility.clearTimeFromDate(cal1);
//				
//				pstmt=con.prepareStatement(&quot;select organization_id,opening_bal from st_rep_org_bal_history where finaldate=? and organization_type='RETAILER'&quot;);
//				pstmt.setDate(1, new Date(cal1.getTimeInMillis()));
//				
//				rs=pstmt.executeQuery();
//				while(rs.next()){
//					if(agtMap.get(rs.getString(&quot;organization_id&quot;)) !=null){
//						agtMap.get(rs.getString(&quot;organization_id&quot;)).setOpeningBal(rs.getDouble(&quot;opening_bal&quot;));
//					}
//				}
//				return;
//				
//			}else{
//				lastArchDate=ReportUtility.getLastArchDateInDateFormat(con);
//				pstmt=con.prepareStatement(&quot;select organization_id,(opening_bal+net_amount_transaction)open_bal from st_rep_org_bal_history where finaldate=? and organization_type='RETAILER'&quot;);
//				pstmt.setDate(1, lastArchDate);
//				
//				rs=pstmt.executeQuery();
//				while(rs.next()){
//					if(agtMap.get(rs.getString(&quot;organization_id&quot;)) !=null){
//						agtMap.get(rs.getString(&quot;organization_id&quot;)).setOpeningBal(rs.getDouble(&quot;open_bal&quot;));
//					}
//				}
//			}

<span class="nc" id="L1540">			String lastRunDate = ReportUtility.fetchLastRunDate(con);</span>
<span class="nc" id="L1541">			Calendar lastRunCal = Calendar.getInstance();</span>
<span class="nc" id="L1542">			lastRunCal.setTimeInMillis(new SimpleDateFormat(&quot;dd-MM-yyyy&quot;).parse(lastRunDate).getTime());</span>
<span class="nc bnc" id="L1543" title="All 2 branches missed.">			if (lastRunCal.getTimeInMillis() &gt;= checkCal.getTimeInMillis()) {</span>
<span class="nc" id="L1544">				pstmt = con.prepareStatement(&quot;select organization_id,(opening_bal+net_amount_transaction)open_bal from st_rep_org_bal_history where finaldate=? and organization_type='RETAILER'&quot;);</span>
<span class="nc" id="L1545">				pstmt.setTimestamp(1, new Timestamp(checkCal.getTimeInMillis()));</span>
<span class="nc" id="L1546">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1547" title="All 2 branches missed.">				while(rs.next()){</span>
<span class="nc bnc" id="L1548" title="All 2 branches missed.">					if(agtMap.get(rs.getString(&quot;organization_id&quot;)) !=null){</span>
<span class="nc" id="L1549">						agtMap.get(rs.getString(&quot;organization_id&quot;)).setOpeningBal(rs.getDouble(&quot;opening_bal&quot;));</span>
					}
				}
<span class="nc" id="L1552">				return;</span>
			} else {
<span class="nc" id="L1554">				pstmt = con.prepareStatement(&quot;select organization_id,(opening_bal+net_amount_transaction)open_bal from st_rep_org_bal_history where finaldate=? and organization_type='RETAILER'&quot;);</span>
<span class="nc" id="L1555">				pstmt.setTimestamp(1, new Timestamp(lastRunCal.getTimeInMillis()));</span>
<span class="nc" id="L1556">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1557" title="All 2 branches missed.">				while(rs.next()){</span>
<span class="nc bnc" id="L1558" title="All 2 branches missed.">					if(agtMap.get(rs.getString(&quot;organization_id&quot;)) !=null){</span>
<span class="nc" id="L1559">						agtMap.get(rs.getString(&quot;organization_id&quot;)).setOpeningBal(rs.getDouble(&quot;open_bal&quot;));</span>
					}
				}
			}

<span class="nc" id="L1564">			Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L1565">			cal.setTimeInMillis(lastRunCal.getTimeInMillis());</span>
<span class="nc" id="L1566">			cal.add(Calendar.DAY_OF_MONTH, 1);</span>
<span class="nc" id="L1567">			ReportUtility.clearTimeFromDate(cal);</span>

//			Calendar cal=Calendar.getInstance();
//			cal.setTimeInMillis(lastArchDate.getTime());
//			cal.add(Calendar.DAY_OF_MONTH, 1);
//			ReportUtility.clearTimeFromDate(cal);

<span class="nc" id="L1574">			Timestamp fromDate = new Timestamp(cal.getTimeInMillis());</span>
			
			// Get Account Details
			String accQry;
			String unionQuery;
			StringBuilder accountArchQry;
			StringBuilder saleRefundArchQry;
			StringBuilder saleArchQry;
			StringBuilder pwtArchQry;

<span class="nc" id="L1584">			String addOrgQry = &quot;right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;</span>
					+ userId + &quot;) om on party_id=organization_id&quot;;
<span class="nc" id="L1586">			String cashQry = &quot;(select organization_id,cash from (select party_id,sum(amount) cash from st_lms_agent_cash_transaction cash,st_lms_agent_transaction_master btm where cash.transaction_id=btm.transaction_id and transaction_date&gt;='&quot;</span>
					+ fromDate
					+ &quot;' and transaction_date&lt;='&quot;
					+ endDate
					+ &quot;' group by party_id) cash &quot; + addOrgQry + &quot;) cash&quot;;
<span class="nc" id="L1591">			String chqQry = &quot;(select organization_id,chq from (select party_id,sum(cheque_amt) chq from st_lms_agent_sale_chq chq,st_lms_agent_transaction_master btm where chq.transaction_id=btm.transaction_id and chq.transaction_type IN ('CHEQUE','CLOSED') and transaction_date&gt;='&quot;</span>
					+ fromDate
					+ &quot;' and transaction_date&lt;='&quot;
					+ endDate
					+ &quot;' group by party_id) chq &quot; + addOrgQry + &quot;) chq&quot;;
<span class="nc" id="L1596">			String chqRetQry = &quot;(select organization_id,chq_ret from (select party_id,sum(cheque_amt) chq_ret from st_lms_agent_sale_chq  chq,st_lms_agent_transaction_master btm where chq.transaction_id=btm.transaction_id and chq.transaction_type IN ('CHQ_BOUNCE') and transaction_date&gt;='&quot;</span>
					+ fromDate
					+ &quot;' and transaction_date&lt;='&quot;
					+ endDate
					+ &quot;' group by party_id) chq_ret &quot; + addOrgQry + &quot;) chq_ret&quot;;
<span class="nc" id="L1601">			String debitQry = &quot;(select organization_id,debit from (select party_id,sum(amount) debit from st_lms_agent_debit_note debit,st_lms_agent_transaction_master btm where debit.transaction_id=btm.transaction_id and debit.transaction_type IN ('DR_NOTE_CASH','DR_NOTE') and transaction_date&gt;='&quot;</span>
					+ fromDate
					+ &quot;' and transaction_date&lt;='&quot;
					+ endDate
					+ &quot;' group by party_id) debit &quot; + addOrgQry + &quot;) debit&quot;;
<span class="nc" id="L1606">			String creditQry = &quot;(select organization_id,credit from (select party_id,sum(amount) credit from st_lms_agent_credit_note credit,st_lms_agent_transaction_master btm where credit.transaction_id=btm.transaction_id and credit.transaction_type IN ('CR_NOTE_CASH','CR_NOTE') and transaction_date&gt;='&quot;</span>
					+ fromDate
					+ &quot;' and transaction_date&lt;='&quot;
					+ endDate
					+ &quot;' group by party_id) credit &quot; + addOrgQry + &quot;) credit&quot;;

<span class="nc" id="L1612">			accQry = &quot;select cash.organization_id,ifnull(cash,0.0) cash,ifnull(chq,0.0) chq,ifnull(chq_ret,0.0) chq_ret,ifnull(debit,0.0) debit,ifnull(credit,0.0) credit from &quot;</span>
					+ cashQry
					+ &quot;,&quot;
					+ chqQry
					+ &quot;,&quot;
					+ chqRetQry
					+ &quot;,&quot;
					+ debitQry
					+ &quot;,&quot;
					+ creditQry
					+ &quot; where cash.organization_id=chq.organization_id and cash.organization_id=chq_ret.organization_id and cash.organization_id=debit.organization_id and cash.organization_id=credit.organization_id and chq.organization_id=chq_ret.organization_id and chq.organization_id=debit.organization_id and chq.organization_id=credit.organization_id and chq_ret.organization_id=debit.organization_id and chq_ret.organization_id=credit.organization_id and debit.organization_id=credit.organization_id&quot;;

<span class="nc bnc" id="L1624" title="All 2 branches missed.">			if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1625">				accountArchQry = new StringBuilder(</span>
						&quot;select FINAL.organization_id, sum(FINAL.cash) cash, sum(FINAL.chq) chq, sum(FINAL.chq_ret) chq_ret, sum(FINAL.debit) debit, sum(FINAL.credit) credit from (&quot;);
<span class="nc" id="L1627">				unionQuery = &quot; union all select retailer_org_id organization_id, sum(cash_amt) as cash ,sum(cheque_amt) as chq,sum(cheque_bounce_amt) as chq_ret,sum(debit_note) as debit ,sum(credit_note) as credit from st_rep_agent_payments where finaldate&gt;='&quot;</span>
						+ fromDate
						+ &quot;' and finaldate&lt;='&quot;
						+ endDate
						+ &quot;' and  parent_id=&quot;
						+ userId
						+ &quot; group by retailer_org_id ) FINAL group by organization_id&quot;;
<span class="nc" id="L1634">				accountArchQry.append(accQry).append(unionQuery);</span>
<span class="nc" id="L1635">				pstmt = con.prepareStatement(accountArchQry.toString());</span>
			} else {
<span class="nc" id="L1637">				pstmt = con.prepareStatement(accQry);</span>
			}

<span class="nc" id="L1640">			logger.debug(&quot;---Account Detail Query At Agents End---&quot; + pstmt);</span>
<span class="nc" id="L1641">			rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L1643" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1644">				String agtOrgId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L1645">				agtMap.get(agtOrgId).setCash(rs.getDouble(&quot;cash&quot;));</span>
<span class="nc" id="L1646">				agtMap.get(agtOrgId).setCheque(rs.getDouble(&quot;chq&quot;));</span>
<span class="nc" id="L1647">				agtMap.get(agtOrgId).setChequeReturn(rs.getDouble(&quot;chq_ret&quot;));</span>
<span class="nc" id="L1648">				agtMap.get(agtOrgId).setCredit(rs.getDouble(&quot;credit&quot;));</span>
<span class="nc" id="L1649">				agtMap.get(agtOrgId).setDebit(rs.getDouble(&quot;debit&quot;));</span>
<span class="nc" id="L1650">			}</span>

<span class="nc bnc" id="L1652" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L1653">				saleTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_SALE','DG_SALE_OFFLINE') and transaction_date&gt;='&quot;</span>
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ userId + &quot;)&quot;;
<span class="nc" id="L1659">				cancelTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;='&quot;</span>
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ userId + &quot;)&quot;;
<span class="nc" id="L1665">				pwtTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and transaction_date&gt;='&quot;</span>
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ userId + &quot;)&quot;;

				// Game Master Query
<span class="nc" id="L1673">				String gameQry = &quot;select game_id from st_dg_game_master&quot;;</span>
<span class="nc" id="L1674">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L1675">				ResultSet rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L1676">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select om.organization_id,ifnull(FINAL_TABLE.sale,0.0) sale from (select m.retailer_org_id,sum(m.sale) as sale from (&quot;);
<span class="nc" id="L1678">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select om.organization_id,ifnull(FINAL_TABLE.cancel,0.0) cancel from (select m.retailer_org_id,sum(m.cancel) as cancel from (&quot;);
<span class="nc" id="L1680">				StringBuilder pwtQry = new StringBuilder(</span>
						&quot;select om.organization_id,ifnull(FINAL_TABLE.pwt,0.0) pwt from (select m.retailer_org_id,sum(m.pwt) as pwt from (&quot;);
<span class="nc bnc" id="L1682" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L1683">					saleQry</span>
							.append(&quot;(select aa.retailer_org_id,aa.sale as sale from (select drs.retailer_org_id,sum(net_amt) as sale from st_dg_ret_sale_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; drs inner join (&quot;
									+ saleTranDG
									+ &quot;)tx on tx.transaction_id=drs.transaction_id group by drs.retailer_org_id) aa) union all&quot;);

<span class="nc" id="L1690">					cancelQry</span>
							.append(&quot;(select aa.retailer_org_id,aa.cancel as cancel from(select drs.retailer_org_id,sum(net_amt) as cancel from st_dg_ret_sale_refund_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; drs inner join (&quot;
									+ cancelTranDG
									+ &quot;)tx on tx.transaction_id=drs.transaction_id group by drs.retailer_org_id) aa) union all&quot;);

<span class="nc" id="L1697">					pwtQry</span>
							.append(&quot;(select aa.retailer_org_id,aa.pwt as pwt from(select drs.retailer_org_id,sum(pwt_amt+retailer_claim_comm) as pwt from st_dg_ret_pwt_&quot;
									+ rsGame.getInt(&quot;game_id&quot;)
									+ &quot; drs inner join (&quot;
									+ pwtTranDG
									+ &quot;)tx on tx.transaction_id=drs.transaction_id group by drs.retailer_org_id) aa) union all&quot;);
				}

<span class="nc" id="L1705">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;), saleQry</span>
						.length());
<span class="nc" id="L1707">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;), cancelQry</span>
						.length());
<span class="nc" id="L1709">				pwtQry.delete(pwtQry.lastIndexOf(&quot;union all&quot;), pwtQry.length());</span>

<span class="nc" id="L1711">				saleQry</span>
						.append(&quot;) m group by retailer_org_id )FINAL_TABLE right join (select organization_id from st_lms_organization_master where parent_id=&quot;
								+ userId
								+ &quot;) om on FINAL_TABLE.retailer_org_id=om.organization_id&quot;);
<span class="nc" id="L1715">				cancelQry</span>
						.append(&quot;) m group by retailer_org_id )FINAL_TABLE right join (select organization_id from st_lms_organization_master where parent_id=&quot;
								+ userId
								+ &quot;) om on FINAL_TABLE.retailer_org_id=om.organization_id&quot;);
<span class="nc" id="L1719">				pwtQry</span>
						.append(&quot;) m group by retailer_org_id )FINAL_TABLE right join (select organization_id from st_lms_organization_master where parent_id=&quot;
								+ userId
								+ &quot;) om on FINAL_TABLE.retailer_org_id=om.organization_id&quot;);

<span class="nc bnc" id="L1724" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1725">					unionQuery = null;</span>
<span class="nc" id="L1726">					saleArchQry = new StringBuilder(</span>
							&quot;select organization_id,sum(sale) sale from (&quot;);
<span class="nc" id="L1728">					unionQuery = &quot; union all select organization_id,sum(sale_net) as sale from st_rep_dg_retailer where finaldate&gt;='&quot;</span>
							+ fromDate
							+ &quot;'  and finaldate&lt;='&quot;
							+ endDate
							+ &quot;'  and parent_id=&quot;
							+ userId
							+ &quot;  group by organization_id ) Final group by organization_id&quot;;
<span class="nc" id="L1735">					saleArchQry.append(saleQry).append(unionQuery);</span>
<span class="nc" id="L1736">					pstmt = con.prepareStatement(saleArchQry.toString());</span>
				} else {
<span class="nc" id="L1738">					pstmt = con.prepareStatement(saleQry.toString());</span>
				}
<span class="nc" id="L1740">				logger.debug(&quot;-------Draw Sale Query------\n&quot; + pstmt);</span>

				// Draw Sale Query
<span class="nc" id="L1743">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1744" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1745">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setDgSale(</span>
							rs.getDouble(&quot;sale&quot;));
				}

<span class="nc bnc" id="L1749" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1750">					unionQuery = null;</span>
<span class="nc" id="L1751">					saleRefundArchQry = new StringBuilder(</span>
							&quot;select organization_id,sum(cancel) cancel from (&quot;);
<span class="nc" id="L1753">					unionQuery = &quot; union all select organization_id,sum(ref_net_amt) as cancel from st_rep_dg_retailer where finaldate&gt;='&quot;</span>
							+ fromDate
							+ &quot;'  and finaldate&lt;='&quot;
							+ endDate
							+ &quot;'  and parent_id=&quot;
							+ userId
							+ &quot;  group by organization_id ) Final group by organization_id&quot;;
<span class="nc" id="L1760">					saleRefundArchQry.append(cancelQry).append(unionQuery);</span>
<span class="nc" id="L1761">					pstmt = con.prepareStatement(saleRefundArchQry.toString());</span>
				} else {
<span class="nc" id="L1763">					pstmt = con.prepareStatement(cancelQry.toString());</span>
				}
<span class="nc" id="L1765">				logger.debug(&quot;-------Draw Cancel Qurey------\n&quot; + pstmt);</span>

				// Draw Cancel Query
<span class="nc" id="L1768">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1769" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1770">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setDgCancel(</span>
							rs.getDouble(&quot;cancel&quot;));
				}

<span class="nc bnc" id="L1774" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1775">					unionQuery = null;</span>
<span class="nc" id="L1776">					pwtArchQry = new StringBuilder(</span>
							&quot;select organization_id,sum(pwt) pwt from (&quot;);
<span class="nc" id="L1778">					unionQuery = &quot; union all select organization_id,sum(pwt_net_amt) as pwt from st_rep_dg_retailer where finaldate&gt;='&quot;</span>
							+ fromDate
							+ &quot;'  and finaldate&lt;='&quot;
							+ endDate
							+ &quot;'  and parent_id=&quot;
							+ userId
							+ &quot;  group by organization_id ) Final group by organization_id&quot;;
<span class="nc" id="L1785">					pwtArchQry.append(pwtQry).append(unionQuery);</span>
<span class="nc" id="L1786">					pstmt = con.prepareStatement(pwtArchQry.toString());</span>
				} else {
<span class="nc" id="L1788">					pstmt = con.prepareStatement(pwtQry.toString());</span>
				}
<span class="nc" id="L1790">				logger.debug(&quot;-------Draw Pwt Qurey------\n&quot; + pstmt);</span>

				// Draw Pwt Query
<span class="nc" id="L1793">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1794" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1795">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setDgPwt(</span>
							rs.getDouble(&quot;pwt&quot;));
				}
		}

<span class="nc bnc" id="L1800" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
				// Calculate Scratch Sale
<span class="nc" id="L1802">				String saleQry = &quot;&quot;;</span>
<span class="nc" id="L1803">				logger.info(&quot;----Type Select ---&quot;</span>
						+ LMSFilterDispatcher.seSaleReportType);
<span class="nc bnc" id="L1805" title="All 2 branches missed.">				if (&quot;BOOK_WISE&quot;.equals(LMSFilterDispatcher.seSaleReportType)) {</span>
<span class="nc" id="L1806">					saleQry = &quot;select sale.retailer_org_id organization_id ,mrpAmt-mrpAmtRet  mrpAmt,  netAmt-netAmtRet netAmt from (select om.retailer_org_id,ifnull(mrpAmt,0) mrpAmt ,ifnull(netAmt,0) netAmt from (select organization_id retailer_org_id from st_lms_organization_master where parent_id=&quot;+userId+&quot;) om left join  (select retailer_org_id,sum(mrpAmt) mrpAmt,sum(netAmt) netAmt from (select retailer_org_id,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_agent_retailer_transaction artx inner join (select transaction_id from st_lms_agent_transaction_master where transaction_type='SALE' and transaction_date&gt;='&quot;</span>
							+ fromDate
							+ &quot;'  and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;'  and user_org_id=&quot;
							+ userId
							+ &quot; )tx  on  artx.transaction_id= tx.transaction_id group by retailer_org_id union all select retailer_org_id,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_agent_ret_loose_book_transaction artx inner join (select transaction_id from st_lms_agent_transaction_master where transaction_type='LOOSE_SALE' and transaction_date&gt;='&quot;
							+ fromDate
							+ &quot;'  and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;'  and user_org_id=&quot;
							+ userId
							+ &quot; )tx  on  artx.transaction_id= tx.transaction_id group by retailer_org_id) sale group by retailer_org_id) sale on om.retailer_org_id=sale.retailer_org_id) sale , (select om.retailer_org_id,ifnull(mrpAmtRet,0) mrpAmtRet ,ifnull(netAmtRet,0) netAmtRet from (select organization_id retailer_org_id from st_lms_organization_master where parent_id=&quot;+userId+&quot;) om left join (select retailer_org_id,sum(mrpAmtRet) mrpAmtRet,sum(netAmtRet) netAmtRet from (select retailer_org_id,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_agent_retailer_transaction artx inner join (select transaction_id from st_lms_agent_transaction_master where transaction_type='SALE_RET' and transaction_date&gt;='&quot;
							+ fromDate
							+ &quot;'  and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;'  and user_org_id=&quot;
							+ userId
							+ &quot; )tx  on  artx.transaction_id= tx.transaction_id group by retailer_org_id union all select retailer_org_id,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_agent_ret_loose_book_transaction artx inner join (select transaction_id from st_lms_agent_transaction_master where transaction_type='LOOSE_SALE_RET' and transaction_date&gt;='&quot;
							+ fromDate
							+ &quot;'  and transaction_date&lt;='&quot;
							+ endDate
							+ &quot;'  and user_org_id=&quot;
							+ userId
							+ &quot; )tx  on  artx.transaction_id= tx.transaction_id group by retailer_org_id) sale group by retailer_org_id) saleRet on om.retailer_org_id=saleRet.retailer_org_id) saleRet where saleRet.retailer_org_id=sale.retailer_org_id&quot;;
<span class="nc bnc" id="L1831" title="All 2 branches missed.">				} else if (&quot;TICKET_WISE&quot;</span>
						.equals(LMSFilterDispatcher.seSaleReportType)) {
<span class="nc" id="L1833">					saleQry = &quot;select om.organization_id,FINAL_TABLE.name,FINAL_TABLE.mrpAmt,FINAL_TABLE.netAmt from (select organization_id from st_lms_organization_master where parent_id=&quot;</span>
							+ userId
							+ &quot;) om left join (select organization_id,name,ifnull(mrpAmt,0.0) mrpAmt,ifnull(netAmt,0.0) netAmt from st_lms_organization_master left outer join (select current_owner_id,sum(soldTkt*ticket_price) mrpAmt,sum((soldTkt*ticket_price)-(soldTkt*ticket_price*transacrion_sale_comm_rate*0.01)) netAmt from st_se_game_master gm,st_se_game_inv_detail gid,(select game_id,book_nbr,sum(sold_tickets) soldTkt from st_se_game_ticket_inv_history where date&gt;='&quot;
							+ fromDate
							+ &quot;' and date&lt;='&quot;
							+ endDate
							+ &quot;' and current_owner='RETAILER' group by book_nbr) TktTlb where gm.game_id=TktTlb.game_id and TktTlb.book_nbr=gid.book_nbr and gid.current_owner='RETAILER' group by current_owner_id) saleTlb on organization_id=current_owner_id where organization_type='RETAILER') FINAL_TABLE on om.organization_id=FINAL_TABLE.organization_id&quot;;

				}

<span class="nc bnc" id="L1843" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1844">					unionQuery = null;</span>
<span class="nc" id="L1845">					saleArchQry = new StringBuilder(</span>
							&quot;select organization_id,sum(mrpAmt) mrpAmt, sum(netAmt) netAmt from (&quot;);
<span class="nc" id="L1847">					unionQuery = &quot; union all select organization_id,sum(sale_book_mrp)-sum(ref_sale_mrp) mrpAmt ,sum(sale_book_net) -sum(ref_net_amt) as netAmt from st_rep_se_retailer where finaldate&gt;='&quot;</span>
							+ fromDate
							+ &quot;'  and finaldate&lt;='&quot;
							+ endDate
							+ &quot;'  and parent_id=&quot;
							+ userId
							+ &quot; group by organization_id) FINAL group by organization_id&quot;;
<span class="nc" id="L1854">					saleArchQry.append(saleQry).append(unionQuery);</span>
<span class="nc" id="L1855">					pstmt = con.prepareStatement(saleArchQry.toString());</span>
				} else {
<span class="nc" id="L1857">					pstmt = con.prepareStatement(saleQry);</span>
				}
<span class="nc" id="L1859">				logger.debug(&quot;***Scratch Sale Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L1860">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1861" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1862">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setSeSale(</span>
							rs.getDouble(&quot;netAmt&quot;));
				}

				// Calculate Scratch Pwt
<span class="nc" id="L1867">				String transactionType = null;</span>
<span class="nc bnc" id="L1868" title="All 2 branches missed.">				if (count == 0)</span>
<span class="nc" id="L1869">					transactionType = &quot;transaction_type in ('PWT','PWT_AUTO')&quot;;</span>
				else
<span class="nc" id="L1871">					transactionType = &quot;transaction_type='PWT'&quot;;</span>

<span class="nc" id="L1873">				String pwtQry = &quot;select retailer_org_id organization_id, sum(pwt) pwt from (select om.organization_id retailer_org_id,ifnull(tx.pwt,0) pwt from (select organization_id from st_lms_organization_master where parent_id=&quot;</span>
						+ userId
						+ &quot; ) om left join (select retailer_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwt from st_se_retailer_pwt pwt inner join (select transaction_id from st_lms_retailer_transaction_master where transaction_date&gt;='&quot;
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;'  and &quot;
						+ transactionType
						+ &quot; and retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ userId
						+ &quot; )) tx on  tx.transaction_id=pwt.transaction_id group by retailer_org_id) tx on om.organization_id=tx.retailer_org_id union all select retailer_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwt from st_se_agent_pwt pwt inner join (select transaction_id from st_lms_agent_transaction_master where transaction_date&gt;='&quot;
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;'  and &quot;
						+ transactionType
						+ &quot; and party_id in (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ userId
						+ &quot; )) tx on  tx.transaction_id=pwt.transaction_id group by retailer_org_id) pwt group by retailer_org_id&quot;;
<span class="nc bnc" id="L1892" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1893">					unionQuery = null;</span>
<span class="nc" id="L1894">					pwtArchQry = new StringBuilder(</span>
							&quot;select organization_id,sum(pwt) pwt from (&quot;);
<span class="nc" id="L1896">					unionQuery = &quot; union all select organization_id,sum(pwt_net_amt) as pwt from st_rep_se_retailer where finaldate&gt;='&quot;</span>
							+ fromDate
							+ &quot;' and finaldate&lt;='&quot;
							+ endDate
							+ &quot;'  and parent_id=&quot;
							+ userId
							+ &quot; group by organization_id ) FINAL group by organization_id&quot;;
<span class="nc" id="L1903">					pwtArchQry.append(pwtQry).append(unionQuery);</span>
<span class="nc" id="L1904">					pstmt = con.prepareStatement(pwtArchQry.toString());</span>
				} else {
<span class="nc" id="L1906">					pstmt = con.prepareStatement(pwtQry);</span>
				}
<span class="nc" id="L1908">				logger.debug(&quot;***Scratch Pwt Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L1909">				rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L1911" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1912">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setSePwt(</span>
							rs.getDouble(&quot;pwt&quot;));
				}
			}

<span class="nc bnc" id="L1917" title="All 2 branches missed.">			if (ReportUtility.isCS) {</span>

<span class="nc" id="L1919">				saleTranCS = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('CS_SALE') and transaction_date&gt;='&quot;</span>
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ userId + &quot;)&quot;;
<span class="nc" id="L1925">				cancelTranCS = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('CS_CANCEL_SERVER','CS_CANCEL_RET') and transaction_date&gt;='&quot;</span>
						+ fromDate
						+ &quot;' and transaction_date&lt;='&quot;
						+ endDate
						+ &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ userId + &quot;)&quot;;

				// Category Master Query
<span class="nc" id="L1933">				String catQry = &quot;select category_id from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L1934">				PreparedStatement gamePstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L1935">				ResultSet rsProduct = gamePstmt.executeQuery();</span>
<span class="nc" id="L1936">				StringBuilder saleQry = new StringBuilder(</span>
						&quot;select om.organization_id,ifnull(FINAL_TABLE.sale,0.0) sale from (select m.retailer_org_id,sum(m.sale) as sale from (&quot;);
<span class="nc" id="L1938">				StringBuilder cancelQry = new StringBuilder(</span>
						&quot;select om.organization_id,ifnull(FINAL_TABLE.cancel,0.0) cancel from (select m.retailer_org_id,sum(m.cancel) as cancel from (&quot;);
<span class="nc bnc" id="L1940" title="All 2 branches missed.">				while (rsProduct.next()) {</span>
<span class="nc" id="L1941">					saleQry</span>
							.append(&quot;(select aa.retailer_org_id,aa.sale as sale from (select drs.retailer_org_id,sum(net_amt) as sale from st_cs_sale_&quot;
									+ rsProduct.getInt(&quot;category_id&quot;)
									+ &quot; drs inner join (&quot;
									+ saleTranCS
									+ &quot;)tx on drs.transaction_id=tx.transaction_id group by drs.retailer_org_id) aa) union all&quot;);

<span class="nc" id="L1948">					cancelQry</span>
							.append(&quot;(select aa.retailer_org_id,aa.cancel as cancel from(select drs.retailer_org_id,sum(net_amt) as cancel from st_cs_refund_&quot;
									+ rsProduct.getInt(&quot;category_id&quot;)
									+ &quot; drs inner join (&quot;
									+ cancelTranCS
									+ &quot;)tx on drs.transaction_id=tx.transaction_id group by drs.retailer_org_id) aa) union all&quot;);

				}

<span class="nc" id="L1957">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;), saleQry</span>
						.length());
<span class="nc" id="L1959">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;), cancelQry</span>
						.length());

<span class="nc" id="L1962">				saleQry</span>
						.append(&quot;) m group by retailer_org_id )FINAL_TABLE right join (select organization_id from st_lms_organization_master where parent_id=&quot;
								+ userId
								+ &quot;) om on FINAL_TABLE.retailer_org_id=om.organization_id&quot;);
<span class="nc" id="L1966">				cancelQry</span>
						.append(&quot;) m group by retailer_org_id )FINAL_TABLE right join (select organization_id from st_lms_organization_master where parent_id=&quot;
								+ userId
								+ &quot;) om on FINAL_TABLE.retailer_org_id=om.organization_id&quot;);

<span class="nc bnc" id="L1971" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1972">					unionQuery = null;</span>
<span class="nc" id="L1973">					saleArchQry = new StringBuilder(</span>
							&quot;select organization_id,sum(sale) sale from (&quot;);
<span class="nc" id="L1975">					unionQuery = &quot; union all select organization_id,sum(sale_net) as sale from st_rep_cs_retailer where finaldate&gt;='&quot;</span>
							+ fromDate
							+ &quot;'  and finaldate&lt;='&quot;
							+ endDate
							+ &quot;'  and parent_id=&quot;
							+ userId
							+ &quot;  group by organization_id ) Final group by organization_id&quot;;
<span class="nc" id="L1982">					saleArchQry.append(saleQry).append(unionQuery);</span>
<span class="nc" id="L1983">					pstmt = con.prepareStatement(saleArchQry.toString());</span>
				} else {
<span class="nc" id="L1985">					pstmt = con.prepareStatement(saleQry.toString());</span>
				}
<span class="nc" id="L1987">				logger.debug(&quot;-------CS Sale Query------\n&quot; + pstmt);</span>
				// CS Sale Query
<span class="nc" id="L1989">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1990" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1991">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setCSSale(</span>
							rs.getDouble(&quot;sale&quot;));
				}

<span class="nc bnc" id="L1995" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1996">					unionQuery = null;</span>
<span class="nc" id="L1997">					saleRefundArchQry = new StringBuilder(</span>
							&quot;select organization_id,sum(cancel) cancel from (&quot;);
<span class="nc" id="L1999">					unionQuery = &quot; union all select organization_id,sum(ref_net_amt) as cancel from st_rep_cs_retailer where finaldate&gt;='&quot;</span>
							+ fromDate
							+ &quot;'  and finaldate&lt;='&quot;
							+ endDate
							+ &quot;'  and parent_id=&quot;
							+ userId
							+ &quot;  group by organization_id ) Final group by organization_id&quot;;
<span class="nc" id="L2006">					saleRefundArchQry.append(cancelQry).append(unionQuery);</span>
<span class="nc" id="L2007">					pstmt = con.prepareStatement(saleRefundArchQry.toString());</span>
				} else {
<span class="nc" id="L2009">					pstmt = con.prepareStatement(cancelQry.toString());</span>
				}
<span class="nc" id="L2011">				logger.debug(&quot;-------CS Cancel Query------\n&quot; + pstmt);</span>

				// CS Cancel Query
<span class="nc" id="L2014">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2015" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2016">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setCSCancel(</span>
							rs.getDouble(&quot;cancel&quot;));
				}
			}
<span class="nc bnc" id="L2020" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>

<span class="nc" id="L2022">				StringBuilder wdQry = new StringBuilder(</span>
						&quot;select om.organization_id agtOrgId, ifnull(sum(wd), 0.0) wdraw from &quot;);
<span class="nc" id="L2024">				StringBuilder wdRefQry = new StringBuilder(</span>
						&quot;select om.organization_id agtOrgId, ifnull(sum(wdRef), 0.0) wdrawRef from&quot;);
<span class="nc" id="L2026">				StringBuilder depQry = new StringBuilder(</span>
						&quot;select om.organization_id agtOrgId, ifnull(sum(depo), 0.0) depoAmt from&quot;);
<span class="nc" id="L2028">				StringBuilder depRefQry = new StringBuilder(</span>
						&quot;select om.organization_id agtOrgId, ifnull(sum(depoRef), 0.0) depoRefAmt from&quot;);

<span class="nc" id="L2031">				wdQry</span>
						.append(&quot;(select wrs.retailer_org_id, net_amt as wd from st_ola_ret_withdrawl wrs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type = 'OLA_WITHDRAWL' and transaction_date&gt;='&quot;
								+ fromDate
								+ &quot;' and transaction_date&lt;='&quot;
								+ endDate
								+ &quot;')) wdret right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
								+ userId
								+ &quot;)om on om.organization_id = wdret.retailer_org_id group by om.organization_id&quot;);

<span class="nc" id="L2040">				wdRefQry</span>
						.append(&quot;(select wrs.retailer_org_id,net_amt as wdRef from st_ola_ret_withdrawl_refund wrs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type = 'OLA_WITHDRAWL_REFUND' and transaction_date&gt;='&quot;
								+ fromDate
								+ &quot;' and transaction_date&lt;='&quot;
								+ endDate
								+ &quot;')) wdret right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
								+ userId
								+ &quot;)om on om.organization_id = wdret.retailer_org_id group by om.organization_id&quot;);
<span class="nc" id="L2048">				depQry</span>
						.append(&quot;(select wrs.retailer_org_id, net_amt as depo from st_ola_ret_deposit wrs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type = 'OLA_DEPOSIT' and transaction_date&gt;='&quot;
								+ fromDate
								+ &quot;' and transaction_date&lt;='&quot;
								+ endDate
								+ &quot;')) wdret right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
								+ userId
								+ &quot;)om on om.organization_id = wdret.retailer_org_id group by om.organization_id&quot;);

<span class="nc" id="L2057">				depRefQry</span>
						.append(&quot;(select wrs.retailer_org_id, net_amt as depoRef from st_ola_ret_deposit_refund wrs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type = 'OLA_DEPOSIT_REFUND' and transaction_date&gt;='&quot;
								+ fromDate
								+ &quot;' and transaction_date&lt;='&quot;
								+ endDate
								+ &quot;')) wdret right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
								+ userId
								+ &quot;)om on om.organization_id = wdret.retailer_org_id group by om.organization_id&quot;);

<span class="nc" id="L2066">				String netGamingQry = &quot;select om.organization_id agtOrgId, ifnull(sum(commission_calculated),0.0) netAmt from (select ret_org_id, plr_net_gaming, commission_calculated from st_ola_agt_ret_commission where transaction_id in (select transaction_id from st_lms_agent_transaction_master where transaction_type = 'OLA_COMMISSION' and transaction_date &gt;= '&quot;</span>
						+ fromDate
						+ &quot;' and transaction_date &lt;= '&quot;
						+ endDate
						+ &quot;')) bac right outer join (select organization_id from st_lms_organization_master where parent_id=&quot;
						+ userId
						+ &quot;)om on bac.ret_org_id = om.organization_id group by om.organization_id&quot;;

<span class="nc bnc" id="L2074" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
					// WRITE CODE FOR REP TABLES FOR OLA
				}

<span class="nc" id="L2078">				logger.debug(&quot;-------Withdrawal Query------\n&quot; + wdQry);</span>
<span class="nc" id="L2079">				logger.debug(&quot;-------WithDrawal Refund Query------\n&quot;</span>
						+ wdRefQry);
<span class="nc" id="L2081">				logger.debug(&quot;-------Deposit Query------\n&quot; + depQry);</span>
<span class="nc" id="L2082">				logger.debug(&quot;-------Deposit Refund Query------\n&quot; + depRefQry);</span>
<span class="nc" id="L2083">				logger.debug(&quot;-------Net Gaming Query------\n&quot; + netGamingQry);</span>

				// Withdrawal Query
<span class="nc" id="L2086">				pstmt = con.prepareStatement(wdQry.toString());</span>
<span class="nc" id="L2087">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2088" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2089">					agtMap.get(rs.getString(&quot;agtOrgId&quot;)).setWithdrawal(</span>
							rs.getDouble(&quot;wdraw&quot;));
				}
				// WithDrawal Refund Query
<span class="nc" id="L2093">				pstmt = con.prepareStatement(wdRefQry.toString());</span>
<span class="nc" id="L2094">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2095" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2096">					agtMap.get(rs.getString(&quot;agtOrgId&quot;)).setWithdrawalRefund(</span>
							rs.getDouble(&quot;wdrawRef&quot;));
				}

				// Deposit Query
<span class="nc" id="L2101">				pstmt = con.prepareStatement(depQry.toString());</span>
<span class="nc" id="L2102">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2103" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2104">					agtMap.get(rs.getString(&quot;agtOrgId&quot;)).setDeposit(</span>
							rs.getDouble(&quot;depoAmt&quot;));
				}
				// Deposit Refund Query
<span class="nc" id="L2108">				pstmt = con.prepareStatement(depRefQry.toString());</span>
<span class="nc" id="L2109">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2110" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2111">					agtMap.get(rs.getString(&quot;agtOrgId&quot;)).setDepositRefund(</span>
							rs.getDouble(&quot;depoRefAmt&quot;));
				}

				// net gaming commission query
<span class="nc" id="L2116">				pstmt = con.prepareStatement(netGamingQry);</span>
<span class="nc" id="L2117">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2118" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2119">					agtMap.get(rs.getString(&quot;agtOrgId&quot;)).setNetGamingComm(</span>
							rs.getDouble(&quot;netAmt&quot;));
				}
			}
<span class="nc" id="L2123">			Iterator&lt;Map.Entry&lt;String, AgentCollectionReportOverAllBean&gt;&gt; itr = agtMap</span>
			.entrySet().iterator();
<span class="nc bnc" id="L2125" title="All 2 branches missed.">	while (itr.hasNext()) {</span>
<span class="nc" id="L2126">		Map.Entry&lt;String, AgentCollectionReportOverAllBean&gt; pair = itr</span>
				.next();
<span class="nc" id="L2128">		AgentCollectionReportOverAllBean bean = pair.getValue();</span>
<span class="nc" id="L2129">		double openingBal = bean.getDgSale()</span>
				- bean.getDgCancel()
				- bean.getDgPwt()
				- bean.getDgDirPlyPwt()
				+ bean.getSeSale()
				- bean.getSePwt()
				- bean.getSeDirPlyPwt()
				+ bean.getCSSale()
				- bean.getCSCancel()
				+ bean.getDeposit()
				- bean.getDepositRefund()
				- bean.getWithdrawal()
				- bean.getNetGamingComm()
				- (bean.getCash() + bean.getCheque() + bean.getCredit()
						+ bean.getBankDep() - bean.getDebit() - bean
						.getChequeReturn());
<span class="nc" id="L2145">		bean.setOpeningBal(bean.getOpeningBal()+openingBal);</span>
<span class="nc" id="L2146">	}</span>

		
<span class="nc" id="L2149">		} catch (Exception e) {</span>
<span class="nc" id="L2150">			e.printStackTrace();</span>
<span class="nc" id="L2151">			throw new LMSException(&quot;Error in report collectionRetailerWise&quot;);</span>
<span class="nc" id="L2152">		}</span>
<span class="nc" id="L2153">	}</span>
	
	public void collectionRetailerWiseOpenBalData(int userId, Timestamp startDate, Timestamp endDate, Connection con, Map&lt;String, AgentCollectionReportOverAllBean&gt; agtMap, int count) throws LMSException {
<span class="nc" id="L2156">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L2157">		ResultSet rs = null;</span>
<span class="nc" id="L2158">		String saleTranDG = null;</span>
<span class="nc" id="L2159">		String cancelTranDG = null;</span>
<span class="nc" id="L2160">		String pwtTranDG = null;</span>
<span class="nc" id="L2161">		String saleTranCS = null;</span>
<span class="nc" id="L2162">		String cancelTranCS = null;</span>
		
<span class="nc" id="L2164">		Date lastArchDate = null;</span>
<span class="nc bnc" id="L2165" title="All 2 branches missed.">		if (startDate.after(endDate)) {</span>
<span class="nc" id="L2166">			return;</span>
		}

		try {
//			boolean isDataFromArch = ReportUtility.checkDateLessThanArchiveDate(endDate, con);
//			if (isDataFromArch) {
//				Calendar cal1 = Calendar.getInstance();
//				cal1.setTimeInMillis(endDate.getTime());
//				cal1.add(Calendar.DAY_OF_MONTH, 1);
//				ReportUtility.clearTimeFromDate(cal1);
//
//				pstmt = con
//						.prepareStatement(&quot;select organization_id, opening_bal_cl_inc,opening_bal from st_rep_org_bal_history where finaldate=? and organization_type='RETAILER'&quot;);
//				pstmt.setDate(1, new Date(cal1.getTimeInMillis()));
//
//				rs = pstmt.executeQuery();
//				while (rs.next()) {
//					if (agtMap.get(rs.getString(&quot;organization_id&quot;)) != null) {
//						agtMap.get(rs.getString(&quot;organization_id&quot;)).setOpeningBal(rs.getDouble(&quot;opening_bal&quot;));
//						agtMap.get(rs.getString(&quot;organization_id&quot;)).setLiveOpeningBal(rs.getDouble(&quot;opening_bal_cl_inc&quot;));
//					}
//				}
//				return;
//
//			} else {
//				lastArchDate = ReportUtility.getLastArchDateInDateFormat(con);
//				pstmt = con
//						.prepareStatement(&quot;select organization_id,(opening_bal_cl_inc-net_amount_transaction+cl+xcl) live_open_bal,(opening_bal+net_amount_transaction)open_bal from st_rep_org_bal_history where finaldate=? and organization_type='RETAILER'&quot;);
//				pstmt.setDate(1, lastArchDate);
//
//				rs = pstmt.executeQuery();
//				while (rs.next()) {
//					if (agtMap.get(rs.getString(&quot;organization_id&quot;)) != null) {
//						agtMap.get(rs.getString(&quot;organization_id&quot;)).setOpeningBal(rs.getDouble(&quot;open_bal&quot;));
//						agtMap.get(rs.getString(&quot;organization_id&quot;)).setLiveOpeningBal(rs.getDouble(&quot;live_open_bal&quot;));
//					}
//				}
//			}
//
//			Timestamp fromDate = startDate;

<span class="nc" id="L2207">			Timestamp fromDate = null;</span>
<span class="nc" id="L2208">			SimpleDateFormat sdf = new SimpleDateFormat(&quot;dd-MM-yyyy&quot;);</span>
<span class="nc" id="L2209">			Calendar lastRunDateCal = Calendar.getInstance();</span>

<span class="nc" id="L2211">			String date = ReportUtility.fetchLastRunDate(&quot;RETAILER&quot;, userId, con);</span>
<span class="nc" id="L2212">			lastRunDateCal.setTimeInMillis(sdf.parse(date).getTime());</span>
			
<span class="nc" id="L2214">			pstmt = con.prepareStatement(&quot;select organization_id,(opening_bal_cl_inc-net_amount_transaction+cl+xcl) live_open_bal,(opening_bal+net_amount_transaction)open_bal from st_rep_org_bal_history where finaldate=? and organization_type='RETAILER'&quot;);</span>
<span class="nc" id="L2215">			pstmt.setTimestamp(1, new Timestamp(lastRunDateCal.getTimeInMillis()));</span>
<span class="nc" id="L2216">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2217" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc bnc" id="L2218" title="All 2 branches missed.">				if (agtMap.get(rs.getString(&quot;organization_id&quot;)) != null) {</span>
<span class="nc" id="L2219">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setOpeningBal(rs.getDouble(&quot;open_bal&quot;));</span>
<span class="nc" id="L2220">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setLiveOpeningBal(rs.getDouble(&quot;live_open_bal&quot;));</span>
				}
			}
			
<span class="nc bnc" id="L2224" title="All 2 branches missed.">			if(lastRunDateCal.getTimeInMillis() &lt; startDate.getTime()) {</span>
<span class="nc" id="L2225">				lastRunDateCal.add(Calendar.DAY_OF_MONTH, 1);</span>
<span class="nc" id="L2226">				fromDate = new Timestamp(lastRunDateCal.getTimeInMillis());</span>
<span class="nc bnc" id="L2227" title="All 4 branches missed.">			} else if(lastRunDateCal.getTimeInMillis() &gt;= startDate.getTime() &amp;&amp; lastRunDateCal.getTimeInMillis() &lt; endDate.getTime()) {</span>
<span class="nc" id="L2228">				fromDate = startDate;</span>
			} else {
<span class="nc" id="L2230">				return;</span>
			}

			// Get Account Details
			String accQry;
			String unionQuery;
			StringBuilder accountArchQry;
			StringBuilder saleRefundArchQry;
			StringBuilder saleArchQry;
			StringBuilder pwtArchQry;

<span class="nc" id="L2241">			String addOrgQry = &quot;right outer join (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;) om on party_id=organization_id&quot;;</span>
<span class="nc" id="L2242">			String cashQry = &quot;(select organization_id,cash from (select party_id,sum(amount) cash from st_lms_agent_cash_transaction cash,st_lms_agent_transaction_master btm where cash.transaction_id=btm.transaction_id and transaction_date&gt;='&quot; + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;' group by party_id) cash &quot; + addOrgQry + &quot;) cash&quot;;</span>
<span class="nc" id="L2243">			String chqQry = &quot;(select organization_id,chq from (select party_id,sum(cheque_amt) chq from st_lms_agent_sale_chq chq,st_lms_agent_transaction_master btm where chq.transaction_id=btm.transaction_id and chq.transaction_type IN ('CHEQUE','CLOSED') and transaction_date&gt;='&quot; + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;' group by party_id) chq &quot; + addOrgQry + &quot;) chq&quot;;</span>
<span class="nc" id="L2244">			String chqRetQry = &quot;(select organization_id,chq_ret from (select party_id,sum(cheque_amt) chq_ret from st_lms_agent_sale_chq  chq,st_lms_agent_transaction_master btm where chq.transaction_id=btm.transaction_id and chq.transaction_type IN ('CHQ_BOUNCE') and transaction_date&gt;='&quot; + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;' group by party_id) chq_ret &quot; + addOrgQry + &quot;) chq_ret&quot;;</span>
<span class="nc" id="L2245">			String debitQry = &quot;(select organization_id,debit from (select party_id,sum(amount) debit from st_lms_agent_debit_note debit,st_lms_agent_transaction_master btm where debit.transaction_id=btm.transaction_id and debit.transaction_type IN ('DR_NOTE_CASH','DR_NOTE') and transaction_date&gt;='&quot; + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;' group by party_id) debit &quot; + addOrgQry + &quot;) debit&quot;;</span>
<span class="nc" id="L2246">			String creditQry = &quot;(select organization_id,credit from (select party_id,sum(amount) credit from st_lms_agent_credit_note credit,st_lms_agent_transaction_master btm where credit.transaction_id=btm.transaction_id and credit.transaction_type IN ('CR_NOTE_CASH','CR_NOTE') and transaction_date&gt;='&quot; + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;' group by party_id) credit &quot; + addOrgQry + &quot;) credit&quot;;</span>

<span class="nc" id="L2248">			accQry = &quot;select cash.organization_id,ifnull(cash,0.0) cash,ifnull(chq,0.0) chq,ifnull(chq_ret,0.0) chq_ret,ifnull(debit,0.0) debit,ifnull(credit,0.0) credit from &quot; + cashQry + &quot;,&quot; + chqQry + &quot;,&quot; + chqRetQry + &quot;,&quot; + debitQry + &quot;,&quot; + creditQry + &quot; where cash.organization_id=chq.organization_id and cash.organization_id=chq_ret.organization_id and cash.organization_id=debit.organization_id and cash.organization_id=credit.organization_id and chq.organization_id=chq_ret.organization_id and chq.organization_id=debit.organization_id and chq.organization_id=credit.organization_id and chq_ret.organization_id=debit.organization_id and chq_ret.organization_id=credit.organization_id and debit.organization_id=credit.organization_id&quot;;</span>

<span class="nc bnc" id="L2250" title="All 2 branches missed.">			if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L2251">				accountArchQry = new StringBuilder(&quot;select FINAL.organization_id, sum(FINAL.cash) cash, sum(FINAL.chq) chq, sum(FINAL.chq_ret) chq_ret, sum(FINAL.debit) debit, sum(FINAL.credit) credit from (&quot;);</span>
<span class="nc" id="L2252">				unionQuery = &quot; union all select retailer_org_id organization_id, sum(cash_amt) as cash ,sum(cheque_amt) as chq,sum(cheque_bounce_amt) as chq_ret,sum(debit_note) as debit ,sum(credit_note) as credit from st_rep_agent_payments where finaldate&gt;='&quot; + fromDate + &quot;' and finaldate&lt;='&quot; + endDate + &quot;' and  parent_id=&quot; + userId + &quot; group by retailer_org_id ) FINAL group by organization_id&quot;;</span>
<span class="nc" id="L2253">				accountArchQry.append(accQry).append(unionQuery);</span>
<span class="nc" id="L2254">				pstmt = con.prepareStatement(accountArchQry.toString());</span>
			} else {
<span class="nc" id="L2256">				pstmt = con.prepareStatement(accQry);</span>
			}

<span class="nc" id="L2259">			logger.debug(&quot;---Account Detail Query At Agents End---&quot; + pstmt);</span>
<span class="nc" id="L2260">			rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L2262" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L2263">				String agtOrgId = rs.getString(&quot;organization_id&quot;);</span>
<span class="nc" id="L2264">				agtMap.get(agtOrgId).setCash(rs.getDouble(&quot;cash&quot;));</span>
<span class="nc" id="L2265">				agtMap.get(agtOrgId).setCheque(rs.getDouble(&quot;chq&quot;));</span>
<span class="nc" id="L2266">				agtMap.get(agtOrgId).setChequeReturn(rs.getDouble(&quot;chq_ret&quot;));</span>
<span class="nc" id="L2267">				agtMap.get(agtOrgId).setCredit(rs.getDouble(&quot;credit&quot;));</span>
<span class="nc" id="L2268">				agtMap.get(agtOrgId).setDebit(rs.getDouble(&quot;debit&quot;));</span>
<span class="nc" id="L2269">			}</span>

<span class="nc bnc" id="L2271" title="All 2 branches missed.">			if (ReportUtility.isDG) {</span>
<span class="nc" id="L2272">				saleTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_SALE','DG_SALE_OFFLINE') and transaction_date&gt;='&quot; + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;)&quot;;</span>
<span class="nc" id="L2273">				cancelTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_REFUND_CANCEL','DG_REFUND_FAILED') and transaction_date&gt;='&quot; + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;)&quot;;</span>
<span class="nc" id="L2274">				pwtTranDG = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('DG_PWT_AUTO','DG_PWT_PLR','DG_PWT') and transaction_date&gt;='&quot; + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;)&quot;;</span>

				// Game Master Query
<span class="nc" id="L2277">				String gameQry = &quot;select game_id from st_dg_game_master&quot;;</span>
<span class="nc" id="L2278">				PreparedStatement gamePstmt = con.prepareStatement(gameQry);</span>
<span class="nc" id="L2279">				ResultSet rsGame = gamePstmt.executeQuery();</span>
<span class="nc" id="L2280">				StringBuilder saleQry = new StringBuilder(&quot;select om.organization_id,ifnull(FINAL_TABLE.sale,0.0) sale from (select m.retailer_org_id,sum(m.sale) as sale from (&quot;);</span>
<span class="nc" id="L2281">				StringBuilder cancelQry = new StringBuilder(&quot;select om.organization_id,ifnull(FINAL_TABLE.cancel,0.0) cancel from (select m.retailer_org_id,sum(m.cancel) as cancel from (&quot;);</span>
<span class="nc" id="L2282">				StringBuilder pwtQry = new StringBuilder(&quot;select om.organization_id,ifnull(FINAL_TABLE.pwt,0.0) pwt from (select m.retailer_org_id,sum(m.pwt) as pwt from (&quot;);</span>
<span class="nc bnc" id="L2283" title="All 2 branches missed.">				while (rsGame.next()) {</span>
<span class="nc" id="L2284">					saleQry.append(&quot;(select aa.retailer_org_id,aa.sale as sale from (select drs.retailer_org_id,sum(net_amt) as sale from st_dg_ret_sale_&quot; + rsGame.getInt(&quot;game_id&quot;) + &quot; drs inner join (&quot; + saleTranDG + &quot;)tx on tx.transaction_id=drs.transaction_id group by drs.retailer_org_id) aa) union all&quot;);</span>
<span class="nc" id="L2285">					cancelQry.append(&quot;(select aa.retailer_org_id,aa.cancel as cancel from(select drs.retailer_org_id,sum(net_amt) as cancel from st_dg_ret_sale_refund_&quot; + rsGame.getInt(&quot;game_id&quot;) + &quot; drs inner join (&quot; + cancelTranDG + &quot;)tx on tx.transaction_id=drs.transaction_id group by drs.retailer_org_id) aa) union all&quot;);</span>
<span class="nc" id="L2286">					pwtQry.append(&quot;(select aa.retailer_org_id,aa.pwt as pwt from(select drs.retailer_org_id,sum(pwt_amt+retailer_claim_comm) as pwt from st_dg_ret_pwt_&quot; + rsGame.getInt(&quot;game_id&quot;) + &quot; drs inner join (&quot; + pwtTranDG + &quot;)tx on tx.transaction_id=drs.transaction_id group by drs.retailer_org_id) aa) union all&quot;);</span>
				}

<span class="nc" id="L2289">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;), saleQry.length());</span>
<span class="nc" id="L2290">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;), cancelQry.length());</span>
<span class="nc" id="L2291">				pwtQry.delete(pwtQry.lastIndexOf(&quot;union all&quot;), pwtQry.length());</span>

<span class="nc" id="L2293">				saleQry.append(&quot;) m group by retailer_org_id )FINAL_TABLE right join (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;) om on FINAL_TABLE.retailer_org_id=om.organization_id&quot;);</span>
<span class="nc" id="L2294">				cancelQry.append(&quot;) m group by retailer_org_id )FINAL_TABLE right join (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;) om on FINAL_TABLE.retailer_org_id=om.organization_id&quot;);</span>
<span class="nc" id="L2295">				pwtQry.append(&quot;) m group by retailer_org_id )FINAL_TABLE right join (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;) om on FINAL_TABLE.retailer_org_id=om.organization_id&quot;);</span>

<span class="nc bnc" id="L2297" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L2298">					unionQuery = null;</span>
<span class="nc" id="L2299">					saleArchQry = new StringBuilder(&quot;select organization_id,sum(sale) sale from (&quot;);</span>
<span class="nc" id="L2300">					unionQuery = &quot; union all select organization_id,sum(sale_net) as sale from st_rep_dg_retailer where finaldate&gt;='&quot; + fromDate + &quot;'  and finaldate&lt;='&quot; + endDate + &quot;'  and parent_id=&quot; + userId + &quot;  group by organization_id ) Final group by organization_id&quot;;</span>
<span class="nc" id="L2301">					saleArchQry.append(saleQry).append(unionQuery);</span>
<span class="nc" id="L2302">					pstmt = con.prepareStatement(saleArchQry.toString());</span>
				} else {
<span class="nc" id="L2304">					pstmt = con.prepareStatement(saleQry.toString());</span>
				}
<span class="nc" id="L2306">				logger.debug(&quot;-------Draw Sale Query------\n&quot; + pstmt);</span>

				// Draw Sale Query
<span class="nc" id="L2309">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2310" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2311">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setDgSale(rs.getDouble(&quot;sale&quot;));</span>
				}

<span class="nc bnc" id="L2314" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L2315">					unionQuery = null;</span>
<span class="nc" id="L2316">					saleRefundArchQry = new StringBuilder(&quot;select organization_id,sum(cancel) cancel from (&quot;);</span>
<span class="nc" id="L2317">					unionQuery = &quot; union all select organization_id,sum(ref_net_amt) as cancel from st_rep_dg_retailer where finaldate&gt;='&quot; + fromDate + &quot;'  and finaldate&lt;='&quot; + endDate + &quot;'  and parent_id=&quot; + userId + &quot;  group by organization_id ) Final group by organization_id&quot;;</span>
<span class="nc" id="L2318">					saleRefundArchQry.append(cancelQry).append(unionQuery);</span>
<span class="nc" id="L2319">					pstmt = con.prepareStatement(saleRefundArchQry.toString());</span>
				} else {
<span class="nc" id="L2321">					pstmt = con.prepareStatement(cancelQry.toString());</span>
				}
<span class="nc" id="L2323">				logger.debug(&quot;-------Draw Cancel Qurey------\n&quot; + pstmt);</span>

				// Draw Cancel Query
<span class="nc" id="L2326">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2327" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2328">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setDgCancel(rs.getDouble(&quot;cancel&quot;));</span>
				}

<span class="nc bnc" id="L2331" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L2332">					unionQuery = null;</span>
<span class="nc" id="L2333">					pwtArchQry = new StringBuilder(&quot;select organization_id,sum(pwt) pwt from (&quot;);</span>
<span class="nc" id="L2334">					unionQuery = &quot; union all select organization_id,sum(pwt_net_amt) as pwt from st_rep_dg_retailer where finaldate&gt;='&quot; + fromDate + &quot;'  and finaldate&lt;='&quot; + endDate + &quot;'  and parent_id=&quot; + userId + &quot;  group by organization_id ) Final group by organization_id&quot;;</span>
<span class="nc" id="L2335">					pwtArchQry.append(pwtQry).append(unionQuery);</span>
<span class="nc" id="L2336">					pstmt = con.prepareStatement(pwtArchQry.toString());</span>
				} else {
<span class="nc" id="L2338">					pstmt = con.prepareStatement(pwtQry.toString());</span>
				}
<span class="nc" id="L2340">				logger.debug(&quot;-------Draw Pwt Qurey------\n&quot; + pstmt);</span>

				// Draw Pwt Query
<span class="nc" id="L2343">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2344" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2345">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setDgPwt(rs.getDouble(&quot;pwt&quot;));</span>
				}
			}

<span class="nc bnc" id="L2349" title="All 2 branches missed.">			if (ReportUtility.isSE) {</span>
				// Calculate Scratch Sale
<span class="nc" id="L2351">				String saleQry = &quot;&quot;;</span>
<span class="nc" id="L2352">				logger.info(&quot;----Type Select ---&quot; + LMSFilterDispatcher.seSaleReportType);</span>
<span class="nc bnc" id="L2353" title="All 2 branches missed.">				if (&quot;BOOK_WISE&quot;.equals(LMSFilterDispatcher.seSaleReportType)) {</span>
<span class="nc" id="L2354">					saleQry = &quot;select sale.retailer_org_id organization_id ,mrpAmt-mrpAmtRet  mrpAmt,  netAmt-netAmtRet netAmt from (select om.retailer_org_id,ifnull(mrpAmt,0) mrpAmt ,ifnull(netAmt,0) netAmt from (select organization_id retailer_org_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;) om left join  (select retailer_org_id,sum(mrpAmt) mrpAmt,sum(netAmt) netAmt from (select retailer_org_id,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_agent_retailer_transaction artx inner join (select transaction_id from st_lms_agent_transaction_master where transaction_type='SALE' and transaction_date&gt;='&quot; + fromDate + &quot;'  and transaction_date&lt;='&quot; + endDate + &quot;'  and user_org_id=&quot; + userId + &quot; )tx  on  artx.transaction_id= tx.transaction_id group by retailer_org_id union all select retailer_org_id,sum(mrp_amt) mrpAmt,sum(net_amt) netAmt from st_se_agent_ret_loose_book_transaction artx inner join (select transaction_id from st_lms_agent_transaction_master where transaction_type='LOOSE_SALE' and transaction_date&gt;='&quot; + fromDate + &quot;'  and transaction_date&lt;='&quot; + endDate + &quot;'  and user_org_id=&quot; + userId + &quot; )tx  on  artx.transaction_id= tx.transaction_id group by retailer_org_id) sale group by retailer_org_id) sale on om.retailer_org_id=sale.retailer_org_id) sale , (select om.retailer_org_id,ifnull(mrpAmtRet,0) mrpAmtRet ,ifnull(netAmtRet,0) netAmtRet from (select organization_id retailer_org_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;) om left join (select retailer_org_id,sum(mrpAmtRet) mrpAmtRet,sum(netAmtRet) netAmtRet from (select retailer_org_id,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_agent_retailer_transaction artx inner join (select transaction_id from st_lms_agent_transaction_master where transaction_type='SALE_RET' and transaction_date&gt;='&quot; + fromDate + &quot;'  and transaction_date&lt;='&quot; + endDate + &quot;'  and user_org_id=&quot; + userId + &quot; )tx  on  artx.transaction_id= tx.transaction_id group by retailer_org_id union all select retailer_org_id,sum(mrp_amt) mrpAmtRet,sum(net_amt) netAmtRet from st_se_agent_ret_loose_book_transaction artx inner join (select transaction_id from st_lms_agent_transaction_master where transaction_type='LOOSE_SALE_RET' and transaction_date&gt;='&quot; + fromDate + &quot;'  and transaction_date&lt;='&quot; + endDate + &quot;'  and user_org_id=&quot; + userId + &quot; )tx  on  artx.transaction_id= tx.transaction_id group by retailer_org_id) sale group by retailer_org_id) saleRet on om.retailer_org_id=saleRet.retailer_org_id) saleRet where saleRet.retailer_org_id=sale.retailer_org_id&quot;;</span>
<span class="nc bnc" id="L2355" title="All 2 branches missed.">				} else if (&quot;TICKET_WISE&quot;.equals(LMSFilterDispatcher.seSaleReportType)) {</span>
<span class="nc" id="L2356">					saleQry = &quot;select om.organization_id,FINAL_TABLE.name,FINAL_TABLE.mrpAmt,FINAL_TABLE.netAmt from (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;) om left join (select organization_id,name,ifnull(mrpAmt,0.0) mrpAmt,ifnull(netAmt,0.0) netAmt from st_lms_organization_master left outer join (select current_owner_id,sum(soldTkt*ticket_price) mrpAmt,sum((soldTkt*ticket_price)-(soldTkt*ticket_price*transacrion_sale_comm_rate*0.01)) netAmt from st_se_game_master gm,st_se_game_inv_detail gid,(select game_id,book_nbr,sum(sold_tickets) soldTkt from st_se_game_ticket_inv_history where date&gt;='&quot; + fromDate + &quot;' and date&lt;='&quot; + endDate + &quot;' and current_owner='RETAILER' group by book_nbr) TktTlb where gm.game_id=TktTlb.game_id and TktTlb.book_nbr=gid.book_nbr and gid.current_owner='RETAILER' group by current_owner_id) saleTlb on organization_id=current_owner_id where organization_type='RETAILER') FINAL_TABLE on om.organization_id=FINAL_TABLE.organization_id&quot;;</span>
				}

<span class="nc bnc" id="L2359" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L2360">					unionQuery = null;</span>
<span class="nc" id="L2361">					saleArchQry = new StringBuilder(&quot;select organization_id,sum(mrpAmt) mrpAmt, sum(netAmt) netAmt from (&quot;);</span>
<span class="nc" id="L2362">					unionQuery = &quot; union all select organization_id,sum(sale_book_mrp)-sum(ref_sale_mrp) mrpAmt ,sum(sale_book_net) -sum(ref_net_amt) as netAmt from st_rep_se_retailer where finaldate&gt;='&quot; + fromDate + &quot;'  and finaldate&lt;='&quot; + endDate + &quot;'  and parent_id=&quot; + userId + &quot; group by organization_id) FINAL group by organization_id&quot;;</span>
<span class="nc" id="L2363">					saleArchQry.append(saleQry).append(unionQuery);</span>
<span class="nc" id="L2364">					pstmt = con.prepareStatement(saleArchQry.toString());</span>
				} else {
<span class="nc" id="L2366">					pstmt = con.prepareStatement(saleQry);</span>
				}
<span class="nc" id="L2368">				logger.debug(&quot;***Scratch Sale Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L2369">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2370" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2371">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setSeSale(rs.getDouble(&quot;netAmt&quot;));</span>
				}

				// Calculate Scratch Pwt
<span class="nc" id="L2375">				String transactionType = null;</span>
<span class="nc bnc" id="L2376" title="All 2 branches missed.">				if (count == 0)</span>
<span class="nc" id="L2377">					transactionType = &quot;transaction_type in ('PWT','PWT_AUTO')&quot;;</span>
				else
<span class="nc" id="L2379">					transactionType = &quot;transaction_type='PWT'&quot;;</span>

<span class="nc" id="L2381">				String pwtQry = &quot;select retailer_org_id organization_id, sum(pwt) pwt from (select om.organization_id retailer_org_id,ifnull(tx.pwt,0) pwt from (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot; ) om left join (select retailer_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwt from st_se_retailer_pwt pwt inner join (select transaction_id from st_lms_retailer_transaction_master where transaction_date&gt;='&quot; + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;'  and &quot; + transactionType + &quot; and retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot; )) tx on  tx.transaction_id=pwt.transaction_id group by retailer_org_id) tx on om.organization_id=tx.retailer_org_id union all select retailer_org_id,sum(pwt_amt+(pwt_amt*claim_comm*0.01)) pwt from st_se_agent_pwt pwt inner join (select transaction_id from st_lms_agent_transaction_master where transaction_date&gt;='&quot; + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;'  and &quot; + transactionType + &quot; and party_id in (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot; )) tx on  tx.transaction_id=pwt.transaction_id group by retailer_org_id) pwt group by retailer_org_id&quot;;</span>
<span class="nc bnc" id="L2382" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L2383">					unionQuery = null;</span>
<span class="nc" id="L2384">					pwtArchQry = new StringBuilder(&quot;select organization_id,sum(pwt) pwt from (&quot;);</span>
<span class="nc" id="L2385">					unionQuery = &quot; union all select organization_id,sum(pwt_net_amt) as pwt from st_rep_se_retailer where finaldate&gt;='&quot; + fromDate + &quot;' and finaldate&lt;='&quot; + endDate + &quot;'  and parent_id=&quot; + userId + &quot; group by organization_id ) FINAL group by organization_id&quot;;</span>
<span class="nc" id="L2386">					pwtArchQry.append(pwtQry).append(unionQuery);</span>
<span class="nc" id="L2387">					pstmt = con.prepareStatement(pwtArchQry.toString());</span>
				} else {
<span class="nc" id="L2389">					pstmt = con.prepareStatement(pwtQry);</span>
				}
<span class="nc" id="L2391">				logger.debug(&quot;***Scratch Pwt Query*** \n&quot; + pstmt);</span>
<span class="nc" id="L2392">				rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L2394" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2395">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setSePwt(rs.getDouble(&quot;pwt&quot;));</span>
				}
			}

<span class="nc bnc" id="L2399" title="All 2 branches missed.">			if (ReportUtility.isCS) {</span>

<span class="nc" id="L2401">				saleTranCS = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('CS_SALE') and transaction_date&gt;='&quot; + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;)&quot;;</span>
<span class="nc" id="L2402">				cancelTranCS = &quot;select transaction_id from st_lms_retailer_transaction_master where transaction_type in('CS_CANCEL_SERVER','CS_CANCEL_RET') and transaction_date&gt;='&quot; + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;' and retailer_org_id in (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;)&quot;;</span>

				// Category Master Query
<span class="nc" id="L2405">				String catQry = &quot;select category_id from st_cs_product_category_master where status = 'ACTIVE'&quot;;</span>
<span class="nc" id="L2406">				PreparedStatement gamePstmt = con.prepareStatement(catQry);</span>
<span class="nc" id="L2407">				ResultSet rsProduct = gamePstmt.executeQuery();</span>
<span class="nc" id="L2408">				StringBuilder saleQry = new StringBuilder(&quot;select om.organization_id,ifnull(FINAL_TABLE.sale,0.0) sale from (select m.retailer_org_id,sum(m.sale) as sale from (&quot;);</span>
<span class="nc" id="L2409">				StringBuilder cancelQry = new StringBuilder(&quot;select om.organization_id,ifnull(FINAL_TABLE.cancel,0.0) cancel from (select m.retailer_org_id,sum(m.cancel) as cancel from (&quot;);</span>
<span class="nc bnc" id="L2410" title="All 2 branches missed.">				while (rsProduct.next()) {</span>
<span class="nc" id="L2411">					saleQry.append(&quot;(select aa.retailer_org_id,aa.sale as sale from (select drs.retailer_org_id,sum(net_amt) as sale from st_cs_sale_&quot; + rsProduct.getInt(&quot;category_id&quot;) + &quot; drs inner join (&quot; + saleTranCS + &quot;)tx on drs.transaction_id=tx.transaction_id group by drs.retailer_org_id) aa) union all&quot;);</span>
<span class="nc" id="L2412">					cancelQry.append(&quot;(select aa.retailer_org_id,aa.cancel as cancel from(select drs.retailer_org_id,sum(net_amt) as cancel from st_cs_refund_&quot; + rsProduct.getInt(&quot;category_id&quot;) + &quot; drs inner join (&quot; + cancelTranCS + &quot;)tx on drs.transaction_id=tx.transaction_id group by drs.retailer_org_id) aa) union all&quot;);</span>
				}

<span class="nc" id="L2415">				saleQry.delete(saleQry.lastIndexOf(&quot;union all&quot;), saleQry.length());</span>
<span class="nc" id="L2416">				cancelQry.delete(cancelQry.lastIndexOf(&quot;union all&quot;), cancelQry.length());</span>

<span class="nc" id="L2418">				saleQry.append(&quot;) m group by retailer_org_id )FINAL_TABLE right join (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;) om on FINAL_TABLE.retailer_org_id=om.organization_id&quot;);</span>
<span class="nc" id="L2419">				cancelQry.append(&quot;) m group by retailer_org_id )FINAL_TABLE right join (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;) om on FINAL_TABLE.retailer_org_id=om.organization_id&quot;);</span>

<span class="nc bnc" id="L2421" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L2422">					unionQuery = null;</span>
<span class="nc" id="L2423">					saleArchQry = new StringBuilder(&quot;select organization_id,sum(sale) sale from (&quot;);</span>
<span class="nc" id="L2424">					unionQuery = &quot; union all select organization_id,sum(sale_net) as sale from st_rep_cs_retailer where finaldate&gt;='&quot; + fromDate + &quot;'  and finaldate&lt;='&quot; + endDate + &quot;'  and parent_id=&quot; + userId + &quot;  group by organization_id ) Final group by organization_id&quot;;</span>
<span class="nc" id="L2425">					saleArchQry.append(saleQry).append(unionQuery);</span>
<span class="nc" id="L2426">					pstmt = con.prepareStatement(saleArchQry.toString());</span>
				} else {
<span class="nc" id="L2428">					pstmt = con.prepareStatement(saleQry.toString());</span>
				}
<span class="nc" id="L2430">				logger.debug(&quot;-------CS Sale Query------\n&quot; + pstmt);</span>
				// CS Sale Query
<span class="nc" id="L2432">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2433" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2434">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setCSSale(rs.getDouble(&quot;sale&quot;));</span>
				}

<span class="nc bnc" id="L2437" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L2438">					unionQuery = null;</span>
<span class="nc" id="L2439">					saleRefundArchQry = new StringBuilder(&quot;select organization_id,sum(cancel) cancel from (&quot;);</span>
<span class="nc" id="L2440">					unionQuery = &quot; union all select organization_id,sum(ref_net_amt) as cancel from st_rep_cs_retailer where finaldate&gt;='&quot; + fromDate + &quot;'  and finaldate&lt;='&quot; + endDate + &quot;'  and parent_id=&quot; + userId + &quot;  group by organization_id ) Final group by organization_id&quot;;</span>
<span class="nc" id="L2441">					saleRefundArchQry.append(cancelQry).append(unionQuery);</span>
<span class="nc" id="L2442">					pstmt = con.prepareStatement(saleRefundArchQry.toString());</span>
				} else {
<span class="nc" id="L2444">					pstmt = con.prepareStatement(cancelQry.toString());</span>
				}
<span class="nc" id="L2446">				logger.debug(&quot;-------CS Cancel Query------\n&quot; + pstmt);</span>

				// CS Cancel Query
<span class="nc" id="L2449">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2450" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2451">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setCSCancel(rs.getDouble(&quot;cancel&quot;));</span>
				}
			}
<span class="nc bnc" id="L2454" title="All 2 branches missed.">			if (ReportUtility.isOLA) {</span>
<span class="nc" id="L2455">				StringBuilder wdQry = new StringBuilder(&quot;select om.organization_id agtOrgId, ifnull(sum(wd), 0.0) wdraw from &quot;);</span>
<span class="nc" id="L2456">				StringBuilder wdRefQry = new StringBuilder(&quot;select om.organization_id agtOrgId, ifnull(sum(wdRef), 0.0) wdrawRef from&quot;);</span>
<span class="nc" id="L2457">				StringBuilder depQry = new StringBuilder(&quot;select om.organization_id agtOrgId, ifnull(sum(depo), 0.0) depoAmt from&quot;);</span>
<span class="nc" id="L2458">				StringBuilder depRefQry = new StringBuilder(&quot;select om.organization_id agtOrgId, ifnull(sum(depoRef), 0.0) depoRefAmt from&quot;);</span>

<span class="nc" id="L2460">				wdQry.append(&quot;(select wrs.retailer_org_id, net_amt as wd from st_ola_ret_withdrawl wrs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type = 'OLA_WITHDRAWL' and transaction_date&gt;='&quot; + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;')) wdret right outer join (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;)om on om.organization_id = wdret.retailer_org_id group by om.organization_id&quot;);</span>

<span class="nc" id="L2462">				wdRefQry.append(&quot;(select wrs.retailer_org_id,net_amt as wdRef from st_ola_ret_withdrawl_refund wrs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type = 'OLA_WITHDRAWL_REFUND' and transaction_date&gt;='&quot; + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;')) wdret right outer join (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;)om on om.organization_id = wdret.retailer_org_id group by om.organization_id&quot;);</span>
<span class="nc" id="L2463">				depQry.append(&quot;(select wrs.retailer_org_id, net_amt as depo from st_ola_ret_deposit wrs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type = 'OLA_DEPOSIT' and transaction_date&gt;='&quot; + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;')) wdret right outer join (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;)om on om.organization_id = wdret.retailer_org_id group by om.organization_id&quot;);</span>

<span class="nc" id="L2465">				depRefQry.append(&quot;(select wrs.retailer_org_id, net_amt as depoRef from st_ola_ret_deposit_refund wrs where transaction_id in (select transaction_id from st_lms_retailer_transaction_master where transaction_type = 'OLA_DEPOSIT_REFUND' and transaction_date&gt;='&quot; + fromDate + &quot;' and transaction_date&lt;='&quot; + endDate + &quot;')) wdret right outer join (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;)om on om.organization_id = wdret.retailer_org_id group by om.organization_id&quot;);</span>

<span class="nc" id="L2467">				String netGamingQry = &quot;select om.organization_id agtOrgId, ifnull(sum(commission_calculated),0.0) netAmt from (select ret_org_id, plr_net_gaming, commission_calculated from st_ola_agt_ret_commission where transaction_id in (select transaction_id from st_lms_agent_transaction_master where transaction_type = 'OLA_COMMISSION' and transaction_date &gt;= '&quot; + fromDate + &quot;' and transaction_date &lt;= '&quot; + endDate + &quot;')) bac right outer join (select organization_id from st_lms_organization_master where parent_id=&quot; + userId + &quot;)om on bac.ret_org_id = om.organization_id group by om.organization_id&quot;;</span>

<span class="nc bnc" id="L2469" title="All 2 branches missed.">				if (LMSFilterDispatcher.isRepFrmSP) {</span>
					// WRITE CODE FOR REP TABLES FOR OLA
				}

<span class="nc" id="L2473">				logger.debug(&quot;-------Withdrawal Query------\n&quot; + wdQry);</span>
<span class="nc" id="L2474">				logger.debug(&quot;-------WithDrawal Refund Query------\n&quot;</span>
						+ wdRefQry);
<span class="nc" id="L2476">				logger.debug(&quot;-------Deposit Query------\n&quot; + depQry);</span>
<span class="nc" id="L2477">				logger.debug(&quot;-------Deposit Refund Query------\n&quot; + depRefQry);</span>
<span class="nc" id="L2478">				logger.debug(&quot;-------Net Gaming Query------\n&quot; + netGamingQry);</span>

				// Withdrawal Query
<span class="nc" id="L2481">				pstmt = con.prepareStatement(wdQry.toString());</span>
<span class="nc" id="L2482">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2483" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2484">					agtMap.get(rs.getString(&quot;agtOrgId&quot;)).setWithdrawal(rs.getDouble(&quot;wdraw&quot;));</span>
				}
				// WithDrawal Refund Query
<span class="nc" id="L2487">				pstmt = con.prepareStatement(wdRefQry.toString());</span>
<span class="nc" id="L2488">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2489" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2490">					agtMap.get(rs.getString(&quot;agtOrgId&quot;)).setWithdrawalRefund(rs.getDouble(&quot;wdrawRef&quot;));</span>
				}

				// Deposit Query
<span class="nc" id="L2494">				pstmt = con.prepareStatement(depQry.toString());</span>
<span class="nc" id="L2495">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2496" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2497">					agtMap.get(rs.getString(&quot;agtOrgId&quot;)).setDeposit(rs.getDouble(&quot;depoAmt&quot;));</span>
				}
				// Deposit Refund Query
<span class="nc" id="L2500">				pstmt = con.prepareStatement(depRefQry.toString());</span>
<span class="nc" id="L2501">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2502" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2503">					agtMap.get(rs.getString(&quot;agtOrgId&quot;)).setDepositRefund(rs.getDouble(&quot;depoRefAmt&quot;));</span>
				}

				// net gaming commission query
<span class="nc" id="L2507">				pstmt = con.prepareStatement(netGamingQry);</span>
<span class="nc" id="L2508">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2509" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L2510">					agtMap.get(rs.getString(&quot;agtOrgId&quot;)).setNetGamingComm(rs.getDouble(&quot;netAmt&quot;));</span>
				}
			}
			
<span class="nc bnc" id="L2514" title="All 2 branches missed.">			if (ReportUtility.isIW) {</span>
<span class="nc" id="L2515">				IWOrgReportRequestBean requestBean = new IWOrgReportRequestBean();</span>
<span class="nc" id="L2516">				requestBean.setFromDate(fromDate);</span>
<span class="nc" id="L2517">				requestBean.setToDate(endDate);</span>
<span class="nc" id="L2518">				requestBean.setOrgId(userId);</span>
<span class="nc" id="L2519">				Map&lt;Integer, IWOrgReportResponseBean&gt; iwResponseBeanMap = IWRetailerReportsControllerImpl.fetchSaleCancelPwtMultipleRetailer(requestBean, con);</span>
<span class="nc bnc" id="L2520" title="All 2 branches missed.">				for (Map.Entry&lt;Integer, IWOrgReportResponseBean&gt; entry : iwResponseBeanMap.entrySet()) {</span>
<span class="nc" id="L2521">					String key = String.valueOf(entry.getKey());</span>
<span class="nc bnc" id="L2522" title="All 2 branches missed.">					if(agtMap.containsKey(key)) {</span>
<span class="nc" id="L2523">						agtMap.get(key).setIwSale(entry.getValue().getSaleAmt());</span>
<span class="nc" id="L2524">						agtMap.get(key).setIwCancel(entry.getValue().getCancelAmt());</span>
<span class="nc" id="L2525">						agtMap.get(key).setIwPwt(entry.getValue().getPwtAmt());</span>
					}
<span class="nc" id="L2527">				}</span>
			}
			
<span class="nc bnc" id="L2530" title="All 2 branches missed.">			if (ReportUtility.isVS) {</span>
<span class="nc" id="L2531">				VSOrgReportRequestBean requestBean = new VSOrgReportRequestBean();</span>
<span class="nc" id="L2532">				requestBean.setFromDate(fromDate);</span>
<span class="nc" id="L2533">				requestBean.setToDate(endDate);</span>
<span class="nc" id="L2534">				requestBean.setOrgId(userId);</span>
<span class="nc" id="L2535">				Map&lt;Integer, VSOrgReportResponseBean&gt; vsResponseBeanMap = VSRetailerReportsControllerImpl.fetchSaleCancelPwtMultipleRetailer(requestBean, con);</span>
<span class="nc bnc" id="L2536" title="All 2 branches missed.">				for (Map.Entry&lt;Integer, VSOrgReportResponseBean&gt; entry : vsResponseBeanMap.entrySet()) {</span>
<span class="nc" id="L2537">					String key = String.valueOf(entry.getKey());</span>
<span class="nc bnc" id="L2538" title="All 2 branches missed.">					if(agtMap.containsKey(key)) {</span>
<span class="nc" id="L2539">						agtMap.get(key).setVsSale(entry.getValue().getSaleAmt());</span>
<span class="nc" id="L2540">						agtMap.get(key).setVsCancel(entry.getValue().getCancelAmt());</span>
<span class="nc" id="L2541">						agtMap.get(key).setVsPwt(entry.getValue().getPwtAmt());</span>
					}
<span class="nc" id="L2543">				}</span>
			}

<span class="nc" id="L2546">			pstmt = con.prepareStatement(&quot;select CL.organization_id, sum(amount)amount, type from st_lms_cl_xcl_update_history CL inner join st_lms_organization_master om on CL.organization_id=om.organization_id where organization_type='RETAILER' and om.parent_id = &quot; + userId + &quot; and date_time&gt;=? and date_time&lt;=? group by CL.organization_id, CL.type&quot;);</span>
<span class="nc" id="L2547">			pstmt.setTimestamp(1, fromDate);</span>
<span class="nc" id="L2548">			pstmt.setTimestamp(2, endDate);</span>
<span class="nc" id="L2549">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L2550" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc bnc" id="L2551" title="All 2 branches missed.">				if (&quot;CL&quot;.equals(rs.getString(&quot;type&quot;)))</span>
<span class="nc" id="L2552">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setClLimit(rs.getDouble(&quot;amount&quot;));</span>
<span class="nc bnc" id="L2553" title="All 2 branches missed.">				else if (&quot;XCL&quot;.equals(rs.getString(&quot;type&quot;)))</span>
<span class="nc" id="L2554">					agtMap.get(rs.getString(&quot;organization_id&quot;)).setXclLimit(rs.getDouble(&quot;amount&quot;));</span>
			}
			
//			Iterator&lt;Map.Entry&lt;String, AgentCollectionReportOverAllBean&gt;&gt; itr = agtMap
//					.entrySet().iterator();
//			while (itr.hasNext()) {
//				Map.Entry&lt;String, AgentCollectionReportOverAllBean&gt; pair = itr
//						.next();
<span class="nc bnc" id="L2562" title="All 2 branches missed.">			for(Map.Entry&lt;String, AgentCollectionReportOverAllBean&gt; entrySet : agtMap.entrySet()) {</span>
<span class="nc" id="L2563">				AgentCollectionReportOverAllBean bean = entrySet.getValue();</span>
					
<span class="nc" id="L2565">				double openingBal = bean.getDgSale()</span>
						- bean.getDgCancel()
						- bean.getDgPwt()
						- bean.getDgDirPlyPwt()
						+ bean.getSeSale()
						- bean.getSePwt()
						- bean.getSeDirPlyPwt()
						+ bean.getCSSale()
						- bean.getCSCancel()
						+ bean.getIwSale()
						- bean.getIwCancel()
						- bean.getIwPwt()
						- bean.getIwDirPlyPwt()
						+ bean.getVsSale()
						- bean.getVsCancel()
						- bean.getVsPwt()
						- bean.getVsDirPlyPwt()
						+ bean.getDeposit()
						- bean.getDepositRefund()
						- bean.getWithdrawal()
						- bean.getNetGamingComm()
						- (bean.getCash() + bean.getCheque() + bean.getCredit()
								+ bean.getBankDep() - bean.getDebit() - bean
									.getChequeReturn());
<span class="nc" id="L2589">				bean.setNetTxnAmt(openingBal);</span>
//				bean.setOpeningBal(bean.getOpeningBal() + openingBal);
//				bean.setLiveOpeningBal(bean.getClLimit() + bean.getXclLimit() - openingBal + bean.getLiveOpeningBal());
<span class="nc" id="L2592">				bean.setOpeningBal(bean.getOpeningBal());</span>
<span class="nc" id="L2593">				bean.setLiveOpeningBal(bean.getLiveOpeningBal());</span>
<span class="nc" id="L2594">			}</span>
<span class="nc" id="L2595">		} catch (Exception e) {</span>
<span class="nc" id="L2596">			e.printStackTrace();</span>
<span class="nc" id="L2597">			throw new LMSException(&quot;Error in report collectionRetailerWise&quot;);</span>
<span class="nc" id="L2598">		}</span>
<span class="nc" id="L2599">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>