<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PwtBOHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.scratchService.pwtMgmt.common</a> &gt; <span class="el_source">PwtBOHelper.java</span></div><h1>PwtBOHelper.java</h1><pre class="source lang-java linenums">/*
 * ï¿½ copyright 2007, SkilRock Technologies, A division of Sugal &amp; Damani Lottery Agency Pvt. Ltd.
 * All Rights Reserved
 * The contents of this file are the property of Sugal &amp; Damani Lottery Agency Pvt. Ltd.
 * and are subject to a License agreement with Sugal &amp; Damani Lottery Agency Pvt. Ltd.; you may
 * not use this file except in compliance with that License.  You may obtain a
 * copy of that license from:
 * Legal Department
 * Sugal &amp; Damani Lottery Agency Pvt. Ltd.
 * 6/35,WEA, Karol Bagh,
 * New Delhi
 * India - 110005
 * This software is distributed under the License and is provided on an ï¿½AS ISï¿½
 * basis, without warranty of any kind, either express or implied, unless
 * otherwise provided in the License.  See the License for governing rights and
 * limitations under the License.
 */

package com.skilrock.lms.coreEngine.scratchService.pwtMgmt.common;

import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStreamReader;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.TreeMap;

import com.skilrock.lms.beans.ActiveGameBean;
import com.skilrock.lms.beans.OrgBean;
import com.skilrock.lms.beans.PwtBean;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.common.db.TableConstants;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.utility.GameUtilityHelper;
import com.skilrock.lms.common.utility.MD5Encoder;

/**
 * This is a helper class providing methods for handing PWT at BO's end
 * 
 * @author Skilrock Technologies
 * 
 */
<span class="nc" id="L54">public class PwtBOHelper {</span>

	List&lt;ActiveGameBean&gt; activeGameList;
	/**
	 * This method returns a list of the active games
	 * 
	 * @return List
	 * @throws LMSException
	 */
<span class="nc" id="L63">	String receiptNum = null;</span>
<span class="nc" id="L64">	StringBuilder virn = null;</span>

	public List&lt;ActiveGameBean&gt; getActiveGameList() {
<span class="nc" id="L67">		return activeGameList;</span>
	}

	public List getActiveGames() throws LMSException {

<span class="nc" id="L72">		Connection connection = null;</span>
<span class="nc" id="L73">		Statement statement = null;</span>
<span class="nc" id="L74">		ResultSet resultSet = null;</span>
<span class="nc" id="L75">		String delimiter = new String(&quot;-&quot;);</span>

		try {

<span class="nc" id="L79">			ActiveGameBean gameBean = null;</span>
<span class="nc" id="L80">			List&lt;ActiveGameBean&gt; searchResults = new ArrayList&lt;ActiveGameBean&gt;();</span>

<span class="nc" id="L82">			DBConnect dbConnect = new DBConnect();</span>
<span class="nc" id="L83">			connection = dbConnect.getConnection();</span>

<span class="nc" id="L85">			statement = connection.createStatement();</span>

<span class="nc" id="L87">			String query = QueryManager.getST1ActiveGamesQuery();</span>

<span class="nc" id="L89">			resultSet = statement.executeQuery(query);</span>
			int gameNbr;
			String gameName;

<span class="nc bnc" id="L93" title="All 2 branches missed.">			while (resultSet.next()) {</span>

<span class="nc" id="L95">				gameBean = new ActiveGameBean();</span>
<span class="nc" id="L96">				gameBean</span>
						.setGameId(resultSet.getInt(TableConstants.SGM_GAME_ID));
<span class="nc" id="L98">				gameBean.setAgentPwtCommRate(resultSet</span>
						.getDouble(TableConstants.SGM_AGT_PWT_RATE));
<span class="nc" id="L100">				gameNbr = resultSet.getInt(TableConstants.SGM_GAME_NBR);</span>
<span class="nc" id="L101">				gameName = resultSet.getString(TableConstants.SGM_GAME_NAME);</span>
<span class="nc" id="L102">				gameBean.setGameNbr_Name(gameNbr + delimiter + gameName);</span>

<span class="nc" id="L104">				searchResults.add(gameBean);</span>

			}

<span class="nc" id="L108">			return searchResults;</span>

<span class="nc" id="L110">		} catch (SQLException e) {</span>
<span class="nc" id="L111">			e.printStackTrace();</span>
<span class="nc" id="L112">			throw new LMSException(e);</span>
		} finally {

<span class="nc" id="L115">			try {</span>

<span class="nc bnc" id="L117" title="All 4 branches missed.">				if (statement != null) {</span>
<span class="nc" id="L118">					statement.close();</span>
				}
<span class="nc bnc" id="L120" title="All 4 branches missed.">				if (connection != null) {</span>
<span class="nc" id="L121">					connection.close();</span>
				}
<span class="nc" id="L123">			} catch (SQLException se) {</span>
<span class="nc" id="L124">				se.printStackTrace();</span>
<span class="nc" id="L125">			}</span>
		}

		// return null;

	}

	/**
	 * This method returns a list of all agents registered under the BO
	 * 
	 * @return List
	 * @throws LMSException
	 */
	public List getAgents(UserInfoBean userInfo) throws LMSException {

<span class="nc" id="L140">		Connection connection = null;</span>
<span class="nc" id="L141">		PreparedStatement statement = null;</span>
<span class="nc" id="L142">		ResultSet resultSet = null;</span>
<span class="nc" id="L143">		String delimiter = new String(&quot;-&quot;);</span>
<span class="nc" id="L144">		List&lt;OrgBean&gt; searchResults = new ArrayList&lt;OrgBean&gt;();</span>
		try {

<span class="nc" id="L147">			OrgBean agentOrgBean = null;</span>

<span class="nc" id="L149">			DBConnect dbConnect = new DBConnect();</span>
<span class="nc" id="L150">			connection = dbConnect.getConnection();</span>

<span class="nc" id="L152">			String query = QueryManager.getST1AgtOrgQueryPwt();// + &quot; group by</span>
			// name&quot;;
<span class="nc" id="L154">			statement = connection.prepareStatement(query);</span>
<span class="nc" id="L155">			statement.setInt(1, userInfo.getUserOrgId());</span>
<span class="nc" id="L156">			resultSet = statement.executeQuery();</span>

<span class="nc bnc" id="L158" title="All 2 branches missed.">			while (resultSet.next()) {</span>

<span class="nc" id="L160">				agentOrgBean = new OrgBean();</span>
<span class="nc" id="L161">				agentOrgBean.setOrgId(resultSet</span>
						.getInt(TableConstants.SOM_ORG_ID));
<span class="nc" id="L163">				agentOrgBean.setOrgName(resultSet</span>
						.getString(TableConstants.SOM_ORG_NAME));
<span class="nc" id="L165">				agentOrgBean.setUserId(resultSet</span>
						.getInt(TableConstants.SUM_USER_ID));

<span class="nc" id="L168">				searchResults.add(agentOrgBean);</span>

			}

<span class="nc" id="L172">		} catch (SQLException e) {</span>

<span class="nc" id="L174">			e.printStackTrace();</span>
<span class="nc" id="L175">			throw new LMSException(e);</span>
		} finally {

<span class="nc" id="L178">			try {</span>

<span class="nc bnc" id="L180" title="All 4 branches missed.">				if (statement != null) {</span>
<span class="nc" id="L181">					statement.close();</span>
				}
<span class="nc bnc" id="L183" title="All 4 branches missed.">				if (connection != null) {</span>
<span class="nc" id="L184">					connection.close();</span>
				}
<span class="nc" id="L186">			} catch (SQLException se) {</span>
<span class="nc" id="L187">				se.printStackTrace();</span>
<span class="nc" id="L188">			}</span>
<span class="nc" id="L189">		}</span>

<span class="nc" id="L191">		return searchResults;</span>

	}

	private String getEncodedVirnCode(String[] virnCode) {

<span class="nc" id="L197">		StringBuilder encodedVirnCode = new StringBuilder(&quot;&quot;);</span>

<span class="nc bnc" id="L199" title="All 2 branches missed.">		for (String element : virnCode) {</span>

<span class="nc" id="L201">			encodedVirnCode.append(&quot;'&quot;);</span>
<span class="nc" id="L202">			encodedVirnCode.append(MD5Encoder.encode(element));</span>
<span class="nc" id="L203">			encodedVirnCode.append(&quot;'&quot;);</span>
<span class="nc" id="L204">			encodedVirnCode.append(&quot;,&quot;);</span>

		}
<span class="nc" id="L207">		int length = encodedVirnCode.length();</span>
<span class="nc" id="L208">		encodedVirnCode.deleteCharAt(length - 1);</span>

<span class="nc" id="L210">		return encodedVirnCode.toString();</span>
	}

	// Temporary Receipt ENds
	/**
	 * This method returns the sum of PWT amount for the valid entries
	 * 
	 * @param pwtList
	 * @return double
	 */
	public double getPwtAmount(List&lt;PwtBean&gt; pwtList) {

<span class="nc" id="L222">		double amount = 0.0;</span>

<span class="nc bnc" id="L224" title="All 2 branches missed.">		if (pwtList != null) {</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">			for (PwtBean pwtBean : pwtList) {</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">				if (pwtBean.getIsValid()) {</span>
<span class="nc" id="L227">					amount += Double.parseDouble(pwtBean.getPwtAmount());</span>
				}
<span class="nc" id="L229">			}</span>
		}
<span class="nc" id="L231">		return amount;</span>
	}

	public String getReceiptNum() {
<span class="nc" id="L235">		return receiptNum;</span>
	}

	/*
	 * //Temporary virn to final receipt
	 * 
	 * private int saveBOPwtTicketsTmpReceipt(List&lt;PwtBean&gt; pwtList, int
	 * gameId, String boOrgName,int userID,int userOrgID,int agentOrgId, int
	 * agtUserId, double agtPwtCommRate,Connection connection, StringBuilder
	 * virn,int gameNbr) throws LMSException{ try{ PreparedStatement masterPstmt =
	 * null; PreparedStatement detailPstmt = null; PreparedStatement invPstmt =
	 * null; PreparedStatement agtGameCommVarPstmt = null;
	 * 
	 * ResultSet resultSet = null; ResultSet resultSetCommVar = null;
	 * 
	 * int trnId = -1;
	 * 
	 * if (pwtList != null) { int size = pwtList.size(); QueryManager
	 * queryManager = null;
	 * 
	 * PwtBean pwtBean = null;
	 * 
	 * String masterQuery = null; String detailQuery = null; String invQuery =
	 * null;
	 * 
	 * String agtGameCommVarQuery=null; double agtGameCommVariance=0.0;
	 * 
	 * double pwtAmt = 0.0; double commAmt = 0.0; double netAmt = 0.0; double
	 * creditAmt = 0.0;
	 * 
	 * if (size &gt; 0) {
	 * 
	 * //added by yogesh to gat agent game commission variance
	 * agtGameCommVarQuery=&quot;select pwt_comm_variance from
	 * st_se_bo_agent_sale_pwt_comm_variance where agent_org_id=? and
	 * game_id=?&quot;;
	 * agtGameCommVarPstmt=connection.prepareStatement(agtGameCommVarQuery);
	 * agtGameCommVarPstmt.setInt(1, agentOrgId); agtGameCommVarPstmt.setInt(2,
	 * gameId); resultSetCommVar=agtGameCommVarPstmt.executeQuery();
	 * while(resultSetCommVar.next()){
	 * agtGameCommVariance=resultSetCommVar.getDouble(&quot;pwt_comm_variance&quot;); }
	 * agtPwtCommRate=agtPwtCommRate+agtGameCommVariance;
	 * 
	 * 
	 * 
	 * 
	 * masterPstmt =
	 * connection.prepareStatement(QueryManager.insertInLMSTransactionMaster());
	 * masterPstmt.setString(1, &quot;AGENT&quot;);
	 * 
	 * 
	 * 
	 * masterPstmt.executeUpdate(); resultSet = masterPstmt.getGeneratedKeys();
	 * if(resultSet.next()) { trnId = resultSet.getInt(1);
	 * System.out.println(&quot;Transaction Id:&quot; + trnId);
	 * 
	 * 
	 * masterQuery = QueryManager.getST1BOMasterQuery(); masterPstmt =
	 * connection.prepareStatement(masterQuery);
	 * 
	 * detailQuery = QueryManager.getST1PwtBODetailQuery(); detailPstmt =
	 * connection.prepareStatement(detailQuery);
	 * 
	 * invQuery = QueryManager.getST1PWTBOUpdateQuery(); invPstmt =
	 * connection.prepareStatement(invQuery);
	 * System.out.println(userOrgID+&quot;--userOrg---userId-&quot;+userID+&quot;-saveBOPwtTicketsTmpReceipt--agtOrgId-***&quot;+agentOrgId);
	 * 
	 * 
	 * 
	 * masterPstmt.setInt(1, trnId); masterPstmt.setString(2, &quot;AGENT&quot;);
	 * masterPstmt.setInt(3, agentOrgId); masterPstmt.setTimestamp(4, new
	 * java.sql.Timestamp(new Date() .getTime())); masterPstmt.setString(5,
	 * &quot;PWT&quot;); masterPstmt.setInt(6,userID); masterPstmt.setInt(7,userOrgID);
	 * 
	 * masterPstmt.executeUpdate();
	 * 
	 * System.out.println(&quot;OrderId::&quot; + trnId);
	 * 
	 * for (int i = 0; i &lt; size; i++) { pwtBean = (PwtBean) pwtList.get(i);
	 * 
	 * if (pwtBean.getIsValid()) {
	 * 
	 * String encodedVirn = pwtBean.getVirnCode(); detailPstmt.setString(1,
	 * encodedVirn); detailPstmt.setInt(2, trnId); detailPstmt.setInt(3,
	 * gameId); detailPstmt.setInt(4, agtUserId); detailPstmt.setInt(5,
	 * agentOrgId);
	 * 
	 * pwtAmt = Double.parseDouble(pwtBean.getPwtAmount()); commAmt = pwtAmt *
	 * agtPwtCommRate * 0.01; netAmt = pwtAmt + commAmt; //for current credit
	 * amt updation creditAmt += netAmt;
	 * 
	 * detailPstmt.setDouble(6, pwtAmt); detailPstmt.setDouble(7, commAmt);
	 * detailPstmt.setDouble(8, netAmt);
	 * 
	 * detailPstmt.execute(); // arun //by yogeh game nbr
	 * GameUtilityHelper.updateNoOfPrizeRem(gameId, pwtAmt, &quot;CLAIM_AGT&quot;,
	 * encodedVirn, connection,gameNbr);
	 * 
	 * invPstmt.setInt(1, gameNbr); invPstmt.setInt(2, gameId);
	 * invPstmt.setString(3, encodedVirn); invPstmt.execute();
	 * virn.append(&quot;'&quot;+encodedVirn+&quot;',&quot;); } }
	 * 
	 * //for current credit amt updation boolean isUpdateDone =
	 * OrgCreditUpdation .updateCreditLimitForAgent(agentOrgId, &quot;PWT&quot;,
	 * creditAmt, connection);
	 * System.out.println(&quot;---saveBOPwtTicketsTmpReceipt--virn-&quot;+virn); } } }
	 * 
	 * return trnId; }catch(SQLException sqle){ throw new LMSException(sqle); } }
	 * 
	 */

	/*
	 * public List&lt;PwtBean&gt; saveBOPwtTicketsDataTmpReceipt(String boOrgName,int
	 * userID,int userOrgID,OrgBean agtOrgBean, List&lt;ActiveGameBean&gt;
	 * activeGameList,String rootPath,double HighPrizeAmount,String
	 * highPrizeCriteria, List verifiedData, String receiptNum) throws
	 * LMSException{
	 * 
	 * 
	 * setReceiptNum(receiptNum); setActiveGameList(activeGameList); virn = new
	 * StringBuilder(); Connection connection = null; boolean isCommitable =
	 * false; List&lt;PwtBean&gt; pwtCompleteReceiptList= new ArrayList&lt;PwtBean&gt;();
	 * 
	 * PreparedStatement boReceiptPstmt = null; PreparedStatement
	 * boReceiptMappingPstmt = null; String boReceiptQuery = null; String
	 * boReceiptMappingQuery = null;
	 * 
	 * 
	 * int boReceiptId = -1;
	 * 
	 * double agtPwtCommRate = 0.0; int gameNbr=0;;
	 * 
	 * ActiveGameBean activeGameBean = null;
	 * 
	 * 
	 * int agentOrgId = agtOrgBean.getOrgId(); int agtUserId =
	 * agtOrgBean.getUserId();
	 * 
	 * System.out.println(agtOrgBean.getOrgName()+&quot;-saveBOPwtTicketsDataTmpReceipt--agtOrgId-**&quot;+agentOrgId);
	 * try{ DBConnect dbConnect = new DBConnect(); connection =
	 * dbConnect.getConnection(); connection.setAutoCommit(false);
	 * 
	 * 
	 * 
	 * 
	 * List transactionId = new ArrayList(); String receiptArr=null;
	 * 
	 * Map gameVirnCode = (Map)verifiedData.get(1); PwtBean pwtBean = null; int
	 * game_id = 0; Iterator itVirn = gameVirnCode.entrySet().iterator(); while
	 * (itVirn.hasNext()) { List&lt;PwtBean&gt; pwtList= new ArrayList&lt;PwtBean&gt;();
	 * Map.Entry pairsVirn = (Map.Entry)itVirn.next();
	 * game_id=(Integer)pairsVirn.getKey(); System.out.println(&quot;VIRN
	 * Map--game_id&quot;+game_id); List virnList = (List)pairsVirn.getValue();
	 * if(!virnList.isEmpty()){ String[] virnArray =
	 * (String[])virnList.toArray(new String[virnList.size()]);
	 * 
	 * 
	 * for(int i=0; i&lt;virnArray.length; i++){ if(virnArray[i]!=null &amp;&amp;
	 * !virnArray[i].trim().equals(&quot;&quot;)){ pwtBean= new PwtBean();
	 * pwtBean.setVirnCode(virnArray[i]); pwtBean.setValid(true);
	 * pwtList.add(pwtBean); } }
	 * 
	 * if (activeGameList != null) { for (int i = 0; i &lt; activeGameList.size();
	 * i++) { activeGameBean = activeGameList.get(i); if
	 * (game_id==activeGameBean.getGameId()) { agtPwtCommRate =
	 * activeGameBean.getAgentPwtCommRate();
	 * gameNbr=Integer.parseInt(activeGameBean.getGameNbr_Name().split(&quot;-&quot;)[0]);
	 * break; } } }
	 * 
	 * //pwt verification not need to be done here so remove it
	 * 
	 * CommonFunctionsHelper commonHelper=new CommonFunctionsHelper(); boolean
	 * isVerified = verifyPwtTicketsTmpReceipt(game_id, virnArray,
	 * pwtList,HighPrizeAmount,highPrizeCriteria,gameNbr);
	 * 
	 * //at tje time of payment for unclaimed virn account update if
	 * (isVerified) { int transactionID = saveBOPwtTicketsTmpReceipt(pwtList,
	 * game_id,boOrgName,userID,userOrgID, agentOrgId,
	 * agtUserId,agtPwtCommRate,connection,virn,gameNbr);
	 * receiptArr=commonHelper.boEndAgtPWTPaymentProcess(pwtList, game_id,
	 * boOrgName, userOrgID, agentOrgId, agtUserId, rootPath, userID, gameNbr);
	 * if(transactionID!=0 &amp;&amp; transactionID!=-1)
	 * transactionId.add(transactionID);
	 * 
	 * pwtCompleteReceiptList.addAll(pwtList); } } }
	 * 
	 * 
	 * System.out.println(&quot;---List of Tx Id--&quot;+transactionId);
	 * System.out.println(&quot;---virn-&quot;+virn); //get auto generated reciept number
	 * 
	 * if(receiptArr!=null){
	 * 
	 * String generatedReceiptNumber =
	 * commonHelper.generateReceiptBo(connection, agentOrgId, &quot;AGENT&quot;,
	 * transactionId); if(generatedReceiptNumber!=null) isCommitable=true;
	 * boReceiptId=Integer.parseInt(receiptArr.split(&quot;-&quot;)[0]); PreparedStatement
	 * autoGenRecptPstmtBO = null; // String getLatestRecieptNumberBO=&quot;SELECT *
	 * from st_bo_receipt_gen_mapping where receipt_type=? ORDER BY generated_id
	 * DESC LIMIT 1 &quot;;
	 * autoGenRecptPstmtBO=connection.prepareStatement(QueryManager.getBOLatestReceiptNb());
	 * autoGenRecptPstmtBO.setString(1,&quot;RECEIPT&quot;); ResultSet
	 * recieptRsBO=autoGenRecptPstmtBO.executeQuery(); String
	 * lastRecieptNoGeneratedBO=null;
	 * 
	 * while(recieptRsBO.next()){
	 * lastRecieptNoGeneratedBO=recieptRsBO.getString(&quot;generated_id&quot;); }
	 * 
	 * String autoGeneRecieptNoBO=GenerateRecieptNo.getRecieptNo(&quot;RECEIPT&quot;,
	 * lastRecieptNoGeneratedBO,&quot;BO&quot;); // for generating
	 * receipt********************
	 * 
	 * boReceiptPstmt=connection.prepareStatement(QueryManager.insertInReceiptMaster());
	 * boReceiptPstmt.setString(1,&quot;BO&quot;); boReceiptPstmt.executeUpdate();
	 * 
	 * ResultSet boRSet = boReceiptPstmt.getGeneratedKeys(); while
	 * (boRSet.next()) { boReceiptId = boRSet.getInt(1); System.out.println(&quot;BO
	 * Receipt Id:&quot; + boReceiptId); }
	 * 
	 * boReceiptQuery = QueryManager.insertInBOReceipts(); boReceiptPstmt =
	 * connection.prepareStatement(boReceiptQuery);
	 * 
	 * boReceiptPstmt.setInt(1, boReceiptId); boReceiptPstmt.setString(2,
	 * &quot;RECEIPT&quot;); boReceiptPstmt.setInt(3, agentOrgId);
	 * boReceiptPstmt.setString(4,&quot;AGENT&quot;);
	 * boReceiptPstmt.setString(5,autoGeneRecieptNoBO);
	 * 
	 * //boReceiptPstmt.setString(1, autoGeneRecieptNoBO);
	 * boReceiptPstmt.setString(1, &quot;RECEIPT&quot;); boReceiptPstmt.setInt(2,
	 * agentOrgId);
	 * 
	 * boReceiptPstmt.execute();
	 * 
	 * 
	 * 
	 * for (int trx=0 ;trx&lt;transactionId.size();trx++){ int transId =
	 * (Integer)transactionId.get(trx); if(transId!=0||transId!=-1){
	 * boReceiptMappingQuery = QueryManager.insertBOReceiptTrnMapping();
	 * boReceiptMappingPstmt =
	 * connection.prepareStatement(boReceiptMappingQuery);
	 * 
	 * boReceiptMappingPstmt.setInt(1, boReceiptId);
	 * boReceiptMappingPstmt.setInt(2,transId); boReceiptMappingPstmt.execute();
	 * isCommitable =true; } }
	 * 
	 * //insert into receipt gen reciept mapping
	 * 
	 * if(isCommitable){ String
	 * updateBoRecieptGenMapping=QueryManager.updateST5BOReceiptGenMapping();
	 * boReceiptGenMappingPstmt=connection.prepareStatement(updateBoRecieptGenMapping);
	 * boReceiptGenMappingPstmt.setInt(1,boReceiptId);
	 * boReceiptGenMappingPstmt.setString(2,autoGeneRecieptNoBO);
	 * boReceiptGenMappingPstmt.setString(3,&quot;RECEIPT&quot;);
	 * boReceiptGenMappingPstmt.executeUpdate();
	 * 
	 * 
	 * 
	 * 
	 * //******************************************* virn.append(&quot;''&quot;);
	 * verifiedData.add(virn);
	 * System.out.println(&quot;---verifiedData-&quot;+verifiedData);
	 * 
	 * 
	 * //*************************************** //Temporary receipt tables
	 * entries
	 * updateTempReceiptTables(verifiedData,boReceiptId+&quot;&quot;,connection,userID,userOrgID);
	 * 
	 * 
	 * //*************************************** //Entries in pwt Table
	 * equivalent to PwtTicketHelper.saveTicketsData(game_id,VerifyTicketList)
	 * List&lt;TicketBean&gt; VerifyTicketList = new ArrayList&lt;TicketBean&gt;(); int
	 * game_id_tk =0; PwtTicketHelper pwtTicketHelper = new PwtTicketHelper();
	 * System.out.println(&quot;Ticket Map--&quot;+verifiedData.get(2)); Map gameTickNum =
	 * (HashMap)verifiedData.get(2); Iterator it =
	 * gameTickNum.entrySet().iterator(); while (it.hasNext()) { Map.Entry pairs =
	 * (Map.Entry)it.next(); game_id_tk=(Integer)pairs.getKey();
	 * VerifyTicketList = pwtTicketHelper.getVerifiedTickets((List&lt;TicketBean&gt;)pairs.getValue(),game_id_tk,gameNbr);
	 * VerifyTicketList =
	 * pwtTicketHelper.getGameWiseVerifiedTickets(ticketListString, gameNbr);
	 * saveTicketsData(game_id_tk,VerifyTicketList,connection); }
	 * 
	 * 
	 * 
	 * connection.commit(); if (boReceiptId &gt; -1) { GraphReportHelper
	 * graphReportHelper = new GraphReportHelper();
	 * graphReportHelper.createTextReportBO(boReceiptId,boOrgName,userOrgID,rootPath); }
	 * 
	 * }else{ throw new LMSException(&quot;There are no Valid Transaction done for
	 * these specified PWT&quot;); } } } catch (SQLException e) { try {
	 * connection.rollback(); } catch (SQLException e1) { // TODO Auto-generated
	 * catch block e1.printStackTrace(); } e.printStackTrace(); throw new
	 * LMSException(e); } finally {
	 * 
	 * try {
	 * 
	 * if (connection != null) { connection.close(); } } catch (SQLException se) {
	 * se.printStackTrace(); } }
	 * 
	 * return pwtCompleteReceiptList; }
	 */

	/*
	 * private boolean verifyPwtTicketsTmpReceipt(int gameId, String[] virnCode,
	 * List&lt;PwtBean&gt; pwtList,double HighPrizeAmount,String
	 * highPrizeCriteria,int gameNbr) throws LMSException {
	 * System.out.println(&quot;verify fumction called &quot;); String encodedVirnCode =
	 * getEncodedVirnCodeTmpReceipt(virnCode); System.out.println(&quot;---((((((::&quot; +
	 * encodedVirnCode);
	 * 
	 * Connection connection = null; Statement statement = null; Statement
	 * statement2 = null; Statement statement3 = null;
	 * 
	 * ResultSet resultSet = null; ResultSet resultSet2 = null; ResultSet
	 * resultSet3 = null;
	 * 
	 * 
	 * 
	 * boolean isVerified = false; //int orderId = -1;
	 * 
	 * if (pwtList != null) { int size = pwtList.size();
	 * 
	 * PwtBean pwtBean = null;
	 * 
	 * StringBuffer query = new StringBuffer();
	 * 
	 * if (size &gt; 0) { try { DBConnect dbConnect = new DBConnect(); connection =
	 * dbConnect.getConnection();
	 * 
	 * statement = connection.createStatement();
	 * query.append(QueryManager.getST1PWTBOCheckQuery()); query.append(&quot;
	 * st_se_pwt_inv_&quot;+gameNbr+&quot; where &quot;); query.append(&quot; game_id = &quot;);
	 * query.append(&quot;&quot; + gameId); query.append(&quot; and virn_code in (&quot;);
	 * query.append(encodedVirnCode); query.append(&quot;)&quot;);
	 * 
	 * System.out.println(&quot;GameId:&quot; + gameId); System.out.println(&quot;Query:: &quot; +
	 * query); resultSet = statement.executeQuery(query.toString());
	 * System.out.println(&quot;ResultSet:&quot; + resultSet + &quot;---&quot; +
	 * resultSet.getFetchSize());
	 * 
	 * String vCode = null; String pwtAmount = null; String enVirnCode = null;
	 * String prizeLevel = null; String prizeStatus=null;
	 * 
	 * while (resultSet.next()) {
	 * 
	 * vCode = resultSet .getString(TableConstants.SPI_VIRN_CODE);
	 * System.out.println(&quot;Vcode:&quot; + vCode); pwtAmount = resultSet
	 * .getString(TableConstants.SPI_PWT_AMT); prizeLevel = resultSet
	 * .getString(TableConstants.SPI_PRIZE_LEVEL);
	 * prizeStatus=resultSet.getString(&quot;status&quot;);
	 * 
	 * for (int j = 0; j &lt; pwtList.size(); j++) {
	 * 
	 * pwtBean = (PwtBean) pwtList.get(j); enVirnCode = pwtBean.getVirnCode();
	 * //System.out.println(&quot;for loop running &quot; + j+ &quot; times &quot; +
	 * pwtBean.getVirnCode()); // check for entry into temp table
	 * 
	 * if(enVirnCode.equals(vCode)) { if
	 * (prizeStatus.equalsIgnoreCase(&quot;CLAIM_RET&quot;)) { if
	 * (enVirnCode.equals(vCode)) {
	 * 
	 * isVerified = true; pwtBean.setValid(true);
	 * pwtBean.setPwtAmount(pwtAmount); pwtBean.setMessage(&quot;Credited to
	 * Concerned Party&quot;); pwtBean.setMessageCode(&quot;111001&quot;); } break; }else if
	 * (prizeStatus.equalsIgnoreCase(&quot;CLAIM_AGT_TEMP&quot;)) { if
	 * (enVirnCode.equals(vCode)) { isVerified = true; pwtBean.setValid(true);
	 * pwtBean.setPwtAmount(pwtAmount); pwtBean.setMessage(&quot;AAlready Verified in
	 * Bulk Receipt at BO, Fianl Payment Pending&quot;);
	 * pwtBean.setMessageCode(&quot;112001&quot;); } break; } else if
	 * (prizeStatus.equalsIgnoreCase(&quot;CLAIM_RET_AGT_TEMP&quot;)) { if
	 * (enVirnCode.equals(vCode)) { isVerified = true; pwtBean.setValid(true);
	 * pwtBean.setPwtAmount(pwtAmount); pwtBean.setMessage(&quot;Already Verified in
	 * Bulk Receipt at BO, Fianl Payment Pending&quot;);
	 * pwtBean.setMessageCode(&quot;112001&quot;); } break; } else if (prizeStatus
	 * .equalsIgnoreCase(&quot;CLAIM_AGT&quot;)) { if (enVirnCode.equals(vCode)) {
	 * 
	 * String orgname=null; statement2=connection.createStatement(); String
	 * agtDetailsQuery=&quot;select name from st_lms_organization_master where
	 * organization_id in (select agent_org_id from st_se_bo_pwt where
	 * virn_code='&quot;+enVirnCode+&quot;' and game_id=&quot;+gameId+&quot;)&quot;;
	 * System.out.println(&quot;query for get org name &quot; + agtDetailsQuery);
	 * resultSet2=statement2.executeQuery(agtDetailsQuery);
	 * while(resultSet2.next()){ orgname= resultSet2.getString(&quot;name&quot;); }
	 * pwtBean.setValid(false); //pwtBean.setMessage(&quot;This Ticket has been paid
	 * to Agent:: &quot; + orgname); pwtBean.setMessage(&quot;Already Paid to Agent[&quot; +
	 * orgname+&quot;]&quot;); pwtBean.setMessageCode(&quot;112003&quot;); } break; }else if
	 * (prizeStatus .equalsIgnoreCase(&quot;CLAIM_PLR_TEMP&quot;)){ if
	 * (enVirnCode.equals(vCode)) { isVerified = true; pwtBean.setValid(true);
	 * pwtBean.setPwtAmount(pwtAmount); pwtBean.setMessage(&quot;Already in Process
	 * for Direct Player PWT,Payment/Approval Pending&quot;);
	 * pwtBean.setMessageCode(&quot;112004&quot;); } break; }else if(prizeStatus
	 * .equalsIgnoreCase(&quot;CLAIM_PLR&quot;)){ if (enVirnCode.equals(vCode)) {
	 * 
	 * String playerFirstName=null; String playerLastName=null; String
	 * playercity=null; statement3=connection.createStatement(); String
	 * plrDetailsQuery=&quot;select first_name,last_name,city from
	 * st_lms_player_master where player_id in (select player_id from
	 * st_se_direct_player_pwt where virn_code='&quot;+enVirnCode+&quot;' and
	 * game_id=&quot;+gameId+&quot;)&quot;; System.out.println(&quot;query for get player name &quot; +
	 * plrDetailsQuery); resultSet3=statement3.executeQuery(plrDetailsQuery);
	 * while(resultSet3.next()){ playerFirstName=
	 * resultSet3.getString(&quot;first_name&quot;); playerLastName=
	 * resultSet3.getString(&quot;last_name&quot;); playercity=
	 * resultSet3.getString(&quot;city&quot;); } pwtBean.setValid(false);
	 * //pwtBean.setMessage(&quot;This Ticket has been paid to Player::
	 * &quot;+playerFirstName+&quot; &quot;+playerLastName+ &quot; &quot; +playercity);
	 * pwtBean.setMessage(&quot;Already Paid as Direct Player PWT to Player:
	 * &quot;+playerFirstName+&quot; &quot;+playerLastName+ &quot; &quot; +playercity);
	 * pwtBean.setMessageCode(&quot;112005&quot;); }
	 * 
	 * break; }else if(prizeStatus .equalsIgnoreCase(&quot;CLAIM_PLR_RET&quot;)){ if
	 * (enVirnCode.equals(vCode)) { pwtBean.setValid(false);
	 * pwtBean.setMessage(&quot;This Ticket has been paid to Player but not claimed
	 * by retailer &quot;); }
	 * 
	 * break; }else if(prizeStatus .equalsIgnoreCase(&quot;CLAIM_RET_TEMP&quot;)){ if
	 * (enVirnCode.equals(vCode)) { pwtBean.setValid(false);
	 * //pwtBean.setMessage(&quot;This Ticket is in process between Retailer and
	 * Agent &quot;); pwtBean.setMessage(&quot;Already Verified in Bulk Receipt at
	 * Agent,Final Payment Pending&quot;); pwtBean.setMessageCode(&quot;112006&quot;); } break;
	 * }else if(prizeStatus .equalsIgnoreCase(&quot;CLAIM_PLR_RET_TEMP&quot;)){ if
	 * (enVirnCode.equals(vCode)) { pwtBean.setValid(false);
	 * //pwtBean.setMessage(&quot;This Ticket is in process between Retailer and
	 * Agent &quot;); pwtBean.setMessage(&quot;Already Verified in Bulk Receipt at
	 * Agent,Final Payment Pending&quot;); pwtBean.setMessageCode(&quot;112007&quot;); } break;
	 * }else if(prizeStatus.equalsIgnoreCase(&quot;UNCLM_PWT&quot;)){ if
	 * (enVirnCode.equals(vCode)) {
	 * 
	 * if ((highPrizeCriteria.equals(&quot;level&quot;) &amp;&amp; prizeLevel.equals(&quot;HIGH&quot;)) ||
	 * (highPrizeCriteria.equals(&quot;amt&quot;) &amp;&amp;
	 * (Double.parseDouble(pwtAmount)&gt;=HighPrizeAmount))) {
	 * System.out.println(&quot;inside high prize&quot;); System.out.println(&quot;criteria is &quot; +
	 * highPrizeCriteria); pwtBean.setHighLevel(true); pwtBean.setValid(false);
	 * //pwtBean.setMessage(&quot;This ticket is high prize ticket so please go for
	 * direct player PWT&quot;); pwtBean.setMessage(&quot;High prize VIRN can't be Paid to
	 * Agent.It is to be paid as Direct Player PWT&quot;);
	 * pwtBean.setMessageCode(&quot;112008&quot;); }else{ isVerified = true;
	 * pwtBean.setValid(true); pwtBean.setPwtAmount(pwtAmount);
	 * //pwtBean.setMessage(&quot;This ticket is valid and should be paid to Agent&quot;);
	 * pwtBean.setMessage(&quot;Credited to Concerned Party&quot;);
	 * pwtBean.setMessageCode(&quot;111002&quot;); } }
	 * 
	 * break; }else if(prizeStatus.equalsIgnoreCase(&quot;UNCLM_CANCELLED&quot;)){ if
	 * (enVirnCode.equals(vCode)) {
	 * 
	 * if ((highPrizeCriteria.equals(&quot;level&quot;) &amp;&amp; prizeLevel.equals(&quot;HIGH&quot;)) ||
	 * (highPrizeCriteria.equals(&quot;amt&quot;) &amp;&amp;
	 * (Double.parseDouble(pwtAmount)&gt;=HighPrizeAmount))) {
	 * System.out.println(&quot;inside high prize&quot;); System.out.println(&quot;criteria is &quot; +
	 * highPrizeCriteria); pwtBean.setHighLevel(true); pwtBean.setValid(false);
	 * //pwtBean.setMessage(&quot;This ticket is high prize ticket so please go for
	 * direct player PWT&quot;); pwtBean.setMessage(&quot;High prize VIRN can't be paid to
	 * Agent.It is to be paid as Direct Player PWT&quot;);
	 * pwtBean.setMessageCode(&quot;112011&quot;); }else{ isVerified = true;
	 * pwtBean.setValid(true); pwtBean.setPwtAmount(pwtAmount);
	 * //pwtBean.setMessage(&quot;This ticket is valid and hs been cancelled by BO so
	 * please check it&quot;); pwtBean.setMessage(&quot;Credited to Concerned Party&quot;);
	 * pwtBean.setMessageCode(&quot;111003&quot;); } } break; } else if(prizeStatus
	 * .equalsIgnoreCase(&quot;CANCELLED_PERMANENT&quot;)){ if (enVirnCode.equals(vCode)) {
	 * pwtBean.setValid(false); pwtBean.setMessage(&quot;Tampered/Damaged/Defaced
	 * VIRN as noted at BO&quot;); pwtBean.setMessageCode(&quot;112009&quot;); } break; } } } } }
	 * catch (SQLException e) {
	 * 
	 * e.printStackTrace(); throw new LMSException(e); } finally {
	 * 
	 * try {
	 * 
	 * if (statement != null) { statement.close(); } if (connection != null) {
	 * connection.close(); } } catch (SQLException se) { se.printStackTrace(); } } } }
	 * return isVerified; }
	 */

	/*
	 * private String getEncodedVirnCodeTmpReceipt(String[] virnCode) {
	 * 
	 * StringBuffer encodedVirnCode = new StringBuffer(&quot;&quot;);
	 * 
	 * for (int i = 0; i &lt; virnCode.length; i++) {
	 * 
	 * encodedVirnCode.append(&quot;'&quot;); encodedVirnCode.append(virnCode[i]);
	 * encodedVirnCode.append(&quot;'&quot;); encodedVirnCode.append(&quot;,&quot;); } int length =
	 * encodedVirnCode.length(); encodedVirnCode.deleteCharAt(length - 1);
	 * 
	 * return encodedVirnCode.toString(); }
	 */

	public Map getVirnList(String[] virnCode, String virnFile)
			throws LMSException {
<span class="nc" id="L721">		Map map = new TreeMap();</span>
<span class="nc" id="L722">		List&lt;PwtBean&gt; pwtList = new ArrayList&lt;PwtBean&gt;();</span>
<span class="nc" id="L723">		PwtBean pwtBean = null;</span>
<span class="nc" id="L724">		List&lt;String&gt; virnStringList = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L725">		List&lt;PwtBean&gt; duplicateVirnList = new ArrayList&lt;PwtBean&gt;();</span>
<span class="nc bnc" id="L726" title="All 2 branches missed.">		for (int i = 0; i &lt; virnCode.length; i++) {</span>
<span class="nc bnc" id="L727" title="All 4 branches missed.">			if (virnCode[i] != null &amp;&amp; !virnCode[i].trim().equals(&quot;&quot;)) {</span>
<span class="nc bnc" id="L728" title="All 2 branches missed.">				if (virnStringList.contains(virnCode[i].trim())) {</span>
<span class="nc" id="L729">					pwtBean = new PwtBean();</span>
<span class="nc" id="L730">					pwtBean.setVirnCode(virnCode[i].trim());</span>
<span class="nc" id="L731">					pwtBean.setValid(false);</span>
<span class="nc" id="L732">					pwtBean.setVerificationStatus(&quot;InValid VIRN&quot;);</span>
<span class="nc" id="L733">					pwtBean.setMessage(&quot;Duplicate Virn Entry in File&quot;);</span>
<span class="nc" id="L734">					pwtBean.setMessageCode(&quot;112013&quot;);</span>
<span class="nc" id="L735">					duplicateVirnList.add(pwtBean);</span>

				} else {
<span class="nc" id="L738">					virnStringList.add(virnCode[i].trim());</span>
				}
			}
		}
		// code added here by yogesh to read virn from text file also
		try {
<span class="nc" id="L744">			InputStreamReader fileStreamReader = new InputStreamReader(</span>
					new FileInputStream(virnFile));
<span class="nc" id="L746">			BufferedReader br = new BufferedReader(fileStreamReader);</span>
<span class="nc" id="L747">			String strVirnLine = null;</span>
<span class="nc" id="L748">			int fileVirnLimit = 0;</span>
<span class="nc bnc" id="L749" title="All 2 branches missed.">			while ((strVirnLine = br.readLine()) != null) {</span>
<span class="nc bnc" id="L750" title="All 2 branches missed.">				if (&quot;&quot;.equals(strVirnLine.trim())) {</span>
<span class="nc" id="L751">					continue;</span>
				}
<span class="nc bnc" id="L753" title="All 2 branches missed.">				if (fileVirnLimit &gt; 5000) {</span>
<span class="nc" id="L754">					map.put(&quot;error&quot;, &quot;Data In File Exceeds limit &quot;);</span>
<span class="nc" id="L755">					return map;</span>
				}
<span class="nc bnc" id="L757" title="All 2 branches missed.">				if (virnStringList.contains(strVirnLine.trim())) {</span>
<span class="nc" id="L758">					pwtBean = new PwtBean();</span>
<span class="nc" id="L759">					pwtBean.setVirnCode(strVirnLine.trim());</span>
<span class="nc" id="L760">					pwtBean.setValid(false);</span>
<span class="nc" id="L761">					pwtBean</span>
							.setVerificationStatus(&quot;Duplicate Virn Entry in File&quot;);
<span class="nc" id="L763">					pwtBean.setMessage(&quot;InValid VIRN&quot;);</span>
<span class="nc" id="L764">					pwtBean.setMessageCode(&quot;112013&quot;);</span>
<span class="nc" id="L765">					duplicateVirnList.add(pwtBean);</span>
				} else {
<span class="nc" id="L767">					virnStringList.add(strVirnLine.trim());</span>
				}
<span class="nc" id="L769">				fileVirnLimit++;</span>

			}

<span class="nc" id="L773">		} catch (FileNotFoundException fe) {</span>
			// fe.printStackTrace();
			// throw new LMSException(&quot;file not found exception&quot;,fe);
<span class="nc" id="L776">		} catch (IOException ioe) {</span>
<span class="nc" id="L777">			ioe.printStackTrace();</span>
<span class="nc" id="L778">		}</span>
<span class="nc" id="L779">		map.put(&quot;duplicateVirnList&quot;, duplicateVirnList);</span>
<span class="nc" id="L780">		map.put(&quot;virnStringList&quot;, virnStringList);</span>
<span class="nc" id="L781">		return map;</span>

	}

	public String saveBOPwtTicketsData(String gameNbr_Name, String boOrgName,
			int userOrgID, String agtOrgName, List&lt;OrgBean&gt; agtOrgList,
			List&lt;ActiveGameBean&gt; activeGameList, String[] virnCode,
			List&lt;PwtBean&gt; pwtList, String rootPath, double HighPrizeAmount,
			String highPrizeCriteria, int userId, String enc_scheme_type,
			String pwt_verification_type) throws LMSException {

<span class="nc" id="L792">		int gameId = -1;</span>
<span class="nc" id="L793">		int gameNbr = 0;</span>
<span class="nc" id="L794">		String autoGeneratedReceiptNumber = null;</span>
		// double agtPwtCommRate = 0.0;

<span class="nc" id="L797">		ActiveGameBean activeGameBean = null;</span>
<span class="nc" id="L798">		OrgBean agtOrgBean = null;</span>

		// we appending game id with gameId-gameNbr-Name on JSP
<span class="nc bnc" id="L801" title="All 2 branches missed.">		if (activeGameList != null) {</span>
<span class="nc bnc" id="L802" title="All 2 branches missed.">			for (int i = 0; i &lt; activeGameList.size(); i++) {</span>
<span class="nc" id="L803">				activeGameBean = activeGameList.get(i);</span>
<span class="nc bnc" id="L804" title="All 2 branches missed.">				if (gameNbr_Name.equals(activeGameBean.getGameNbr_Name())) {</span>
<span class="nc" id="L805">					gameId = activeGameBean.getGameId();</span>
					// agtPwtCommRate = activeGameBean.getAgentPwtCommRate();
<span class="nc" id="L807">					break;</span>

				}
			}
		}

<span class="nc" id="L813">		int agtOrgId = -1;</span>
<span class="nc" id="L814">		int agtUserId = -1;</span>
		// get the AGENT org id from JSP
<span class="nc bnc" id="L816" title="All 2 branches missed.">		if (agtOrgList != null) {</span>
<span class="nc bnc" id="L817" title="All 2 branches missed.">			for (int i = 0; i &lt; agtOrgList.size(); i++) {</span>
<span class="nc" id="L818">				agtOrgBean = agtOrgList.get(i);</span>
<span class="nc bnc" id="L819" title="All 2 branches missed.">				if (agtOrgName.equals(agtOrgBean.getOrgName())) {</span>
<span class="nc" id="L820">					agtOrgId = agtOrgBean.getOrgId();</span>
<span class="nc" id="L821">					agtUserId = agtOrgBean.getUserId();</span>
<span class="nc" id="L822">					break;</span>

				}
			}
		}

		// get game nbr from game name number
<span class="nc" id="L829">		String[] gameNameNbrArr = gameNbr_Name.split(&quot;-&quot;);</span>
<span class="nc" id="L830">		gameNbr = Integer.parseInt(gameNameNbrArr[0]);</span>

<span class="nc" id="L832">		boolean isVerified = verifyPwtTickets(gameId, virnCode, pwtList,</span>
				HighPrizeAmount, highPrizeCriteria, gameNbr, agtOrgId);

<span class="nc bnc" id="L835" title="All 2 branches missed.">		if (isVerified) {</span>
			/*
			 * saveBOPwtTickets(pwtList, gameId,boOrgName, userOrgID, agtOrgId,
			 * agtUserId, rootPath,userId,gameNbr);
			 */
<span class="nc" id="L840">			CommonFunctionsHelper commonHelper = new CommonFunctionsHelper();</span>
<span class="nc" id="L841">			autoGeneratedReceiptNumber = commonHelper</span>
					.boEndAgtPWTPaymentProcess(pwtList, gameId, boOrgName,
							userOrgID, agtOrgId, agtUserId, rootPath, userId,
							gameNbr);
		}
<span class="nc" id="L846">		return autoGeneratedReceiptNumber;</span>

	}

	private void saveTmpPwtVirn(List&lt;PwtBean&gt; pwtList, int gameId,
			String receiptId, int agtUserId, int agtOrgId, int gameNbr)
			throws LMSException {

<span class="nc" id="L854">		Connection connection = null;</span>
<span class="nc" id="L855">		PreparedStatement detailPstmt = null;</span>
<span class="nc" id="L856">		PreparedStatement detailPstmtPwtInv = null;</span>
<span class="nc" id="L857">		PreparedStatement agentPstmtPwtInv = null;</span>

<span class="nc bnc" id="L859" title="All 2 branches missed.">		if (pwtList != null) {</span>
<span class="nc" id="L860">			int size = pwtList.size();</span>
<span class="nc" id="L861">			PwtBean pwtBean = null;</span>

<span class="nc bnc" id="L863" title="All 2 branches missed.">			if (size &gt; 0) {</span>
				try {
<span class="nc" id="L865">					DBConnect dbConnect = new DBConnect();</span>
<span class="nc" id="L866">					connection = dbConnect.getConnection();</span>
<span class="nc" id="L867">					connection.setAutoCommit(false);</span>
<span class="nc" id="L868">					detailPstmt = connection</span>
							.prepareStatement(&quot;insert into st_se_tmp_pwt_inv(virn_code,game_id,receipt_id,user_id,status,date_entered) values(?,?,?,?,?,?)&quot;);
<span class="nc" id="L870">					Timestamp dateEntered = new Timestamp(new java.util.Date()</span>
							.getTime());
<span class="nc" id="L872">					CommonFunctionsHelper commonHelper = new CommonFunctionsHelper();</span>
<span class="nc bnc" id="L873" title="All 2 branches missed.">					for (int i = 0; i &lt; size; i++) {</span>
<span class="nc" id="L874">						pwtBean = (PwtBean) pwtList.get(i);</span>

<span class="nc bnc" id="L876" title="All 2 branches missed.">						if (pwtBean.getIsValid()) {</span>

<span class="nc" id="L878">							String encodedVirn = MD5Encoder.encode(pwtBean</span>
									.getVirnCode());
							// get the current pwt status of virn
<span class="nc" id="L881">							String pwtCurStatus = GameUtilityHelper</span>
									.getPwtStatusOfVirn(gameId, encodedVirn,
											connection, gameNbr);
							// update the pwt status
<span class="nc" id="L885">							detailPstmtPwtInv = connection</span>
									.prepareStatement(&quot;update st_se_pwt_inv_? set status=? where virn_code =? and game_id=?&quot;);

<span class="nc" id="L888">							detailPstmtPwtInv.setInt(1, gameNbr);</span>
<span class="nc bnc" id="L889" title="All 2 branches missed.">							if (&quot;UNCLM_PWT&quot;.equalsIgnoreCase(pwtCurStatus)) {</span>
<span class="nc" id="L890">								detailPstmtPwtInv</span>
										.setString(2, &quot;CLAIM_AGT_TEMP&quot;);
<span class="nc bnc" id="L892" title="All 2 branches missed.">							} else if (&quot;UNCLM_CANCELLED&quot;</span>
									.equalsIgnoreCase(pwtCurStatus)) {
<span class="nc" id="L894">								detailPstmtPwtInv</span>
										.setString(2, &quot;CLAIM_AGT_TEMP&quot;);
<span class="nc bnc" id="L896" title="All 2 branches missed.">							} else if (&quot;CLAIM_RET&quot;</span>
									.equalsIgnoreCase(pwtCurStatus.trim())) {
<span class="nc" id="L898">								detailPstmtPwtInv.setString(2,</span>
										&quot;CLAIM_RET_AGT_TEMP&quot;);
<span class="nc bnc" id="L900" title="All 2 branches missed.">							} else if (&quot;CLAIM_RET_UNCLM&quot;</span>
									.equalsIgnoreCase(pwtCurStatus.trim())) {
<span class="nc" id="L902">								detailPstmtPwtInv.setString(2,</span>
										&quot;CLAIM_RET_AGT_TEMP&quot;);
<span class="nc bnc" id="L904" title="All 2 branches missed.">							} else if (&quot;CLAIM_PLR_AGT_UNCLM_DIR&quot;</span>
									.equalsIgnoreCase(pwtCurStatus.trim())) {
<span class="nc" id="L906">								detailPstmtPwtInv.setString(2,</span>
										&quot;CLAIM_PLR_AGT_TEMP&quot;);
							}

							/*
							 * else
							 * if(!&quot;NONE&quot;.equalsIgnoreCase(pwtBean.getInUnclmed()) &amp;&amp;
							 * &quot;IN_PLR_UNCLM&quot;.equalsIgnoreCase(pwtBean.getInUnclmed()))
							 * detailPstmtPwtInv.setString(2,
							 * &quot;CLAIM_AGT_TEMP_UNCLM_PLR&quot;); else
							 * if(!&quot;NONE&quot;.equalsIgnoreCase(pwtBean.getInUnclmed()) &amp;&amp;
							 * &quot;IN_AGENT_UNCLM&quot;.equalsIgnoreCase(pwtBean.getInUnclmed()))
							 * detailPstmtPwtInv.setString(2,
							 * &quot;CLAIM_AGT_TEMP_UNCLM_AGT&quot;);
							 */

<span class="nc" id="L922">							detailPstmtPwtInv.setString(3, encodedVirn);</span>
<span class="nc" id="L923">							detailPstmtPwtInv.setInt(4, gameId);</span>
<span class="nc" id="L924">							detailPstmtPwtInv.execute();</span>

							// update status to BULK_BO in agent_pwt or agent
							// direct player PWT for which isunclaimed true
<span class="nc bnc" id="L928" title="All 2 branches missed.">							if (!&quot;NONE&quot;</span>
									.equalsIgnoreCase(pwtBean.getInUnclmed())) {// 
								String tableType;
<span class="nc bnc" id="L931" title="All 2 branches missed.">								if (&quot;IN_PLR_UNCLM&quot;.equalsIgnoreCase(pwtBean</span>
										.getInUnclmed())) {
<span class="nc" id="L933">									tableType = &quot;PLAYER&quot;;</span>
								} else {
<span class="nc" id="L935">									tableType = &quot;AGENT&quot;;</span>
								}

<span class="nc" id="L938">								commonHelper.updateOrgForUnClaimedVirn(</span>
										agtOrgId, &quot;AGENT&quot;, encodedVirn,
										&quot;BULK_BO&quot;, gameId, tableType,
										connection, pwtBean.getTicketNumber());
							}

<span class="nc" id="L944">							detailPstmt.setString(1, encodedVirn);</span>
<span class="nc" id="L945">							detailPstmt.setInt(2, gameId);</span>
<span class="nc" id="L946">							detailPstmt.setString(3, receiptId);</span>
<span class="nc" id="L947">							detailPstmt.setInt(4, agtUserId);</span>
<span class="nc" id="L948">							detailPstmt.setString(5, &quot;OPEN&quot;);</span>
<span class="nc" id="L949">							detailPstmt.setTimestamp(6, dateEntered);</span>

<span class="nc" id="L951">							detailPstmt.execute();</span>

						}

					}
<span class="nc" id="L956">					connection.commit();</span>

<span class="nc" id="L958">				} catch (SQLException e) {</span>

<span class="nc" id="L960">					e.printStackTrace();</span>
<span class="nc" id="L961">					throw new LMSException(e);</span>

				} finally {

<span class="nc" id="L965">					try {</span>
<span class="nc bnc" id="L966" title="All 4 branches missed.">						if (detailPstmt != null) {</span>
<span class="nc" id="L967">							detailPstmt.close();</span>
						}
<span class="nc bnc" id="L969" title="All 4 branches missed.">						if (detailPstmtPwtInv != null) {</span>
<span class="nc" id="L970">							detailPstmtPwtInv.close();</span>
						}
<span class="nc bnc" id="L972" title="All 4 branches missed.">						if (connection != null) {</span>
<span class="nc" id="L973">							connection.close();</span>
						}
<span class="nc" id="L975">					} catch (SQLException se) {</span>
<span class="nc" id="L976">						se.printStackTrace();</span>
<span class="nc" id="L977">					}</span>
<span class="nc" id="L978">				}</span>

			}
		}

<span class="nc" id="L983">	}</span>

	/*
	 * private void updateTempReceiptTables(List verifiedData, String
	 * autoGeneRecieptNoBO, Connection connection,int userID,int userOrgID)
	 * throws SQLException{ Statement statementTmpTable = null;
	 * 
	 * StringBuilder virn = new StringBuilder(); StringBuilder ticket = new
	 * StringBuilder();
	 * 
	 * statementTmpTable = connection.createStatement();
	 * 
	 * System.out.println(&quot;---in updateTempReceiptTables&quot;+verifiedData);
	 * ticket.append((((List)verifiedData.get(0)).toString().replace(&quot;[&quot;,&quot;'&quot;)).replace(&quot;]&quot;,&quot;'&quot;).replaceAll(&quot;,&quot;,&quot;','&quot;).replaceAll(&quot;
	 * &quot;,&quot;&quot;)); System.out.println(verifiedData.get(3)+&quot;Buffer---&quot;+ticket); virn =
	 * ((StringBuilder)verifiedData.get(3));
	 * System.out.println(&quot;Buffer--virn-&quot;+virn);
	 * 
	 * String tmpVirnUpdateQuery = &quot;update st_se_tmp_pwt_inv set
	 * status='CLOSE',final_receipt_num='&quot;+autoGeneRecieptNoBO+&quot;' where
	 * virn_code in (&quot;+virn.toString()+&quot;)&quot;; String tmpTicketUpdateQuery =
	 * &quot;update st_se_tmp_pwt_tickets_inv set
	 * status='CLOSE',final_receipt_num='&quot;+autoGeneRecieptNoBO+&quot;' where
	 * ticket_nbr in (&quot;+ticket.toString()+&quot;)&quot;; String insertTmpReceiptMaping =
	 * &quot;insert into st_se_tmp_pwt_receipt_mapping values
	 * ('&quot;+getReceiptNum()+&quot;','&quot;+autoGeneRecieptNoBO+&quot;')&quot;;
	 * 
	 * System.out.println(&quot;--tmpVirnUpdateQuery-&quot;+tmpVirnUpdateQuery);
	 * System.out.println(&quot;--tmpTicketUpdateQuery-&quot;+tmpTicketUpdateQuery);
	 * System.out.println(&quot;--insertTmpReceiptMaping--&quot;+insertTmpReceiptMaping);
	 * 
	 * statementTmpTable.executeUpdate(tmpVirnUpdateQuery);
	 * statementTmpTable.executeUpdate(tmpTicketUpdateQuery);
	 * statementTmpTable.executeUpdate(insertTmpReceiptMaping);
	 * 
	 * String game_nbr=null; ActiveGameBean activeGameBean =null; int game_id =
	 * 0;
	 * 
	 * String insertPwtTktQry = null; String updPwtTktQry = null; String
	 * tktNbrStr = null;
	 * tktNbrStr=(((List)verifiedData.get(0)).toString().replace(&quot;[&quot;,&quot;'&quot;)).replace(&quot;]&quot;,&quot;'&quot;).replaceAll(&quot;,&quot;,&quot;','&quot;).replaceAll(&quot;
	 * &quot;,&quot;&quot;); Map gameTickNum = (Map)verifiedData.get(2); Iterator itTkt =
	 * gameTickNum.entrySet().iterator(); while (itTkt.hasNext()) { Map.Entry
	 * pairsTkt = (Map.Entry)itTkt.next(); game_id=(Integer)pairsTkt.getKey();
	 * System.out.println(&quot;Tkt Map--game_id&quot;+game_id); if (activeGameList !=
	 * null) { for (int i = 0; i &lt; activeGameList.size(); i++) { activeGameBean =
	 * activeGameList.get(i); if (game_id==activeGameBean.getGameId()) {
	 * game_nbr=activeGameBean.getGameNbr_Name().split(&quot;-&quot;)[0]; break; } } }
	 * 
	 * updPwtTktQry=&quot;update st_se_pwt_tickets_inv_&quot;+game_nbr+&quot; aa,
	 * st_se_tmp_pwt_tickets_inv bb set aa.status='CLAIM_AGT',
	 * aa.verify_by_user='&quot;+userID+&quot;', aa.verify_by_org='&quot;+userOrgID+&quot;' where
	 * aa.status='CLAIM_RET' and aa.ticket_nbr in (&quot;+tktNbrStr+&quot;) and
	 * aa.ticket_nbr = bb.ticket_nbr&quot;; System.out.println(&quot;********PWT
	 * Update********&quot;+updPwtTktQry);
	 * statementTmpTable.executeUpdate(updPwtTktQry);
	 * 
	 * insertPwtTktQry =&quot;insert into st_se_pwt_tickets_inv_&quot;+game_nbr+&quot; select
	 * bb.ticket_nbr, bb.game_id, bb.book_nbr,'CLAIM_AGT' as status
	 * ,'&quot;+userID+&quot;' as verify_by_user,'&quot;+userOrgID+&quot;' as verify_by_org from
	 * st_se_tmp_pwt_tickets_inv bb where bb.receipt_id='&quot;+receiptNum+&quot;' and
	 * bb.game_id=&quot;+game_id+&quot; and bb.ticket_nbr in (&quot;+tktNbrStr+&quot;) and
	 * bb.ticket_nbr not in (select ticket_nbr from
	 * st_se_pwt_tickets_inv_&quot;+game_nbr+&quot;)&quot;; //insertPwtTktQry = &quot;insert into
	 * st_se_pwt_tickets_inv_&quot;+game_nbr+&quot; select
	 * ticket_nbr,game_id,book_nbr,'CLAIM_AGT' as status ,'&quot;+userID+&quot;' as
	 * verify_by_user,'&quot;+userOrgID+&quot;'verify_by_org from
	 * st_se_tmp_pwt_tickets_inv where receipt_id='&quot;+getReceiptNum()+&quot;' and
	 * game_id=&quot;+game_id+&quot; and ticket_nbr in (&quot;+ticket.toString()+&quot;)&quot;;
	 * 
	 * System.out.println(&quot;********PWT Insert********&quot;+insertPwtTktQry);
	 * statementTmpTable.executeUpdate(insertPwtTktQry); } }
	 */

	/*
	 * private void saveTicketsData(int game_id, List&lt;TicketBean&gt;
	 * verifiedTicketList, Connection connection) throws SQLException{
	 * 
	 * ServletContext servletContext = ServletActionContext.getServletContext();
	 * String retOnline=(String)servletContext.getAttribute(&quot;RET_ONLINE&quot;);
	 * PwtTicketHelper pwtTicketHelper = new PwtTicketHelper();
	 * 
	 * PreparedStatement Pstmt = null;
	 * 
	 * String query=null;
	 * 
	 * if(retOnline.equals(&quot;NO&quot;)) query=QueryManager.updateIntoPwtTicketsInv();
	 * else query=&quot;update st_pwt_tickets_inv set status=? where ticket_nbr=? and
	 * game_id =?&quot;;
	 * 
	 * Pstmt=connection.prepareStatement(query); Iterator&lt;TicketBean&gt;
	 * iterator=verifiedTicketList.iterator(); while(iterator.hasNext()){ String
	 * ticket_nbr=null; boolean isValid=false; TicketBean
	 * ticketBean=(TicketBean)iterator.next(); isValid=ticketBean.getIsValid();
	 * if(isValid==true){ ticket_nbr=ticketBean.getTicketNumber(); String
	 * book_nbr=pwtTicketHelper.getBookNbrFromTicketNo(ticket_nbr);
	 * if(retOnline.equals(&quot;NO&quot;)) { Pstmt.setString(1, ticket_nbr);
	 * Pstmt.setInt(2,game_id); Pstmt.setString(3, book_nbr); Pstmt.setString(4,
	 * &quot;CLAIM_RET&quot;); Pstmt.executeUpdate(); } else {
	 * 
	 * Pstmt.setString(1, &quot;CLAIM_RET&quot;); Pstmt.setString(2, ticket_nbr);
	 * Pstmt.setInt(3,game_id); Pstmt.executeUpdate(); } } } }
	 */

	public void saveTmpPwtVirnData(String gameNbr_Name, String receiptId,
			int agentId, String boOrgName, int userOrgID, String agtOrgName,
			List&lt;OrgBean&gt; agtOrgList, List&lt;ActiveGameBean&gt; activeGameList,
			String[] virnCode, List&lt;PwtBean&gt; pwtList, String rootPath,
			double HighPrizeAmount, String highPrizeCriteria)
			throws LMSException {
<span class="nc" id="L1093">		System.out.println(&quot;Afterrrrrrrrr saveTmpPwtVirnData&quot;);</span>
<span class="nc" id="L1094">		int gameId = -1;</span>
<span class="nc" id="L1095">		int gameNbr = 0;</span>
<span class="nc" id="L1096">		double agtPwtCommRate = 0.0;</span>

<span class="nc" id="L1098">		ActiveGameBean activeGameBean = null;</span>
<span class="nc" id="L1099">		OrgBean agtOrgBean = null;</span>

<span class="nc bnc" id="L1101" title="All 2 branches missed.">		if (activeGameList != null) {</span>
<span class="nc bnc" id="L1102" title="All 2 branches missed.">			for (int i = 0; i &lt; activeGameList.size(); i++) {</span>
<span class="nc" id="L1103">				activeGameBean = activeGameList.get(i);</span>
<span class="nc bnc" id="L1104" title="All 2 branches missed.">				if (gameNbr_Name.equals(activeGameBean.getGameNbr_Name())) {</span>
<span class="nc" id="L1105">					gameId = activeGameBean.getGameId();</span>
<span class="nc" id="L1106">					agtPwtCommRate = activeGameBean.getAgentPwtCommRate();</span>
<span class="nc" id="L1107">					break;</span>

				}
			}
		}
<span class="nc" id="L1112">		System.out.println(&quot;Afterrrrrrrrr---if&quot; + gameId);</span>
<span class="nc" id="L1113">		int agtOrgId = -1;</span>
<span class="nc" id="L1114">		int agtUserId = -1;</span>

<span class="nc bnc" id="L1116" title="All 2 branches missed.">		if (agtOrgList != null) {</span>
<span class="nc bnc" id="L1117" title="All 2 branches missed.">			for (int i = 0; i &lt; agtOrgList.size(); i++) {</span>
<span class="nc" id="L1118">				agtOrgBean = agtOrgList.get(i);</span>
<span class="nc bnc" id="L1119" title="All 2 branches missed.">				if (agtOrgName.equals(agtOrgBean.getOrgName())) {</span>
<span class="nc" id="L1120">					agtOrgId = agtOrgBean.getOrgId();</span>
<span class="nc" id="L1121">					agtUserId = agtOrgBean.getUserId();</span>
<span class="nc" id="L1122">					break;</span>

				}
			}
		}
<span class="nc" id="L1127">		agtUserId = agentId;</span>

		// get game nbr from game name number
<span class="nc" id="L1130">		String[] gameNameNbrArr = gameNbr_Name.split(&quot;-&quot;);</span>
<span class="nc" id="L1131">		gameNbr = Integer.parseInt(gameNameNbrArr[0]);</span>

<span class="nc" id="L1133">		boolean isVerified = verifyPwtTickets(gameId, virnCode, pwtList,</span>
				HighPrizeAmount, highPrizeCriteria, gameNbr, agtOrgId);

<span class="nc bnc" id="L1136" title="All 2 branches missed.">		if (isVerified) {</span>
<span class="nc" id="L1137">			saveTmpPwtVirn(pwtList, gameId, receiptId, agtUserId, agtOrgId,</span>
					gameNbr);
		}
<span class="nc" id="L1140">	}</span>

	public void setActiveGameList(List&lt;ActiveGameBean&gt; activeGameList) {
<span class="nc" id="L1143">		this.activeGameList = activeGameList;</span>
<span class="nc" id="L1144">	}</span>

	public void setReceiptNum(String receiptNum) {
<span class="nc" id="L1147">		this.receiptNum = receiptNum;</span>
<span class="nc" id="L1148">	}</span>

	/**
	 * This method saves the PWT data entered by the BO user
	 * 
	 * @param gameNbr_Name
	 * @param agtOrgName
	 * @param agtOrgList
	 * @param activeGameList
	 * @param virnCode
	 * @param pwtList
	 * @param pwt_verification_type
	 * @param enc_scheme_type
	 * @param rootPath
	 * @throws LMSException
	 */

	private boolean verifyPwtTickets(int gameId, String[] virnCode,
			List&lt;PwtBean&gt; pwtList, double HighPrizeAmount,
			String highPrizeCriteria, int gameNbr, int agtOrgId)
			throws LMSException {

<span class="nc" id="L1170">		System.out.println(&quot;verify function called &quot;);</span>
<span class="nc" id="L1171">		String encodedVirnCode = getEncodedVirnCode(virnCode);</span>
<span class="nc" id="L1172">		System.out.println(&quot;encoded virn list&quot; + encodedVirnCode);</span>

<span class="nc" id="L1174">		Connection connection = null;</span>
<span class="nc" id="L1175">		Statement statement = null;</span>
<span class="nc" id="L1176">		Statement statement2 = null;</span>
<span class="nc" id="L1177">		Statement statement3 = null;</span>
<span class="nc" id="L1178">		Statement statement4 = null;</span>

<span class="nc" id="L1180">		ResultSet resultSet = null;</span>
<span class="nc" id="L1181">		ResultSet resultSet2 = null;</span>
<span class="nc" id="L1182">		ResultSet resultSet3 = null;</span>
<span class="nc" id="L1183">		ResultSet resultSet4 = null;</span>

<span class="nc" id="L1185">		boolean isVerified = false;</span>
		// int orderId = -1;

<span class="nc bnc" id="L1188" title="All 2 branches missed.">		if (pwtList != null) {</span>
<span class="nc" id="L1189">			int size = pwtList.size();</span>
			// QueryManager queryManager = null;
<span class="nc" id="L1191">			PwtBean pwtBean = null;</span>

<span class="nc" id="L1193">			StringBuffer query = new StringBuffer();</span>

<span class="nc bnc" id="L1195" title="All 2 branches missed.">			if (size &gt; 0) {</span>
				try {
<span class="nc" id="L1197">					DBConnect dbConnect = new DBConnect();</span>
<span class="nc" id="L1198">					connection = dbConnect.getConnection();</span>

<span class="nc" id="L1200">					statement = connection.createStatement();</span>
					// query.append(QueryManager.getST1PWTBOCheckQuery());
<span class="nc" id="L1202">					System.out.println(&quot;hello       &quot;</span>
							+ QueryManager.getST1PWTBOCheckQuery());
<span class="nc" id="L1204">					query.append(QueryManager.getST1PWTBOCheckQuery());</span>
<span class="nc" id="L1205">					query.append(&quot; st_se_pwt_inv_&quot; + gameNbr + &quot; where &quot;);</span>
<span class="nc" id="L1206">					query.append(&quot;  game_id = &quot;);</span>
<span class="nc" id="L1207">					query.append(&quot;&quot; + gameId);</span>
<span class="nc" id="L1208">					query.append(&quot; and virn_code in (&quot;);</span>
<span class="nc" id="L1209">					query.append(encodedVirnCode);</span>
<span class="nc" id="L1210">					query.append(&quot;)&quot;);</span>

<span class="nc" id="L1212">					System.out.println(&quot;GameId:&quot; + gameId);</span>
<span class="nc" id="L1213">					System.out.println(&quot;Query:: &quot; + query);</span>
<span class="nc" id="L1214">					resultSet = statement.executeQuery(query.toString());</span>
<span class="nc" id="L1215">					System.out.println(&quot;ResultSet:&quot; + resultSet + &quot;---&quot;</span>
							+ resultSet.getFetchSize());

<span class="nc" id="L1218">					String vCode = null;</span>
<span class="nc" id="L1219">					String pwtAmount = null;</span>
<span class="nc" id="L1220">					String enVirnCode = null;</span>
<span class="nc" id="L1221">					String prizeLevel = null;</span>
<span class="nc" id="L1222">					String prizeStatus = null;</span>
					// boolean pwtTempTableStatus=false;

<span class="nc bnc" id="L1225" title="All 2 branches missed.">					while (resultSet.next()) {</span>

<span class="nc" id="L1227">						vCode = resultSet</span>
								.getString(TableConstants.SPI_VIRN_CODE);

<span class="nc" id="L1230">						System.out.println(&quot;Vcode:&quot; + vCode);</span>
<span class="nc" id="L1231">						pwtAmount = resultSet</span>
								.getString(TableConstants.SPI_PWT_AMT);
<span class="nc" id="L1233">						prizeLevel = resultSet</span>
								.getString(TableConstants.SPI_PRIZE_LEVEL);
<span class="nc" id="L1235">						prizeStatus = resultSet.getString(&quot;status&quot;);</span>
<span class="nc" id="L1236">						System.out</span>
								.println(&quot;^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ === &quot;
										+ vCode + &quot; == &quot; + prizeStatus);

<span class="nc bnc" id="L1240" title="All 2 branches missed.">						for (int j = 0; j &lt; pwtList.size(); j++) {</span>

<span class="nc" id="L1242">							pwtBean = (PwtBean) pwtList.get(j);</span>
<span class="nc" id="L1243">							enVirnCode = MD5Encoder.encode(pwtBean</span>
									.getVirnCode());
<span class="nc" id="L1245">							pwtBean.setEncVirnCode(enVirnCode);</span>
<span class="nc bnc" id="L1246" title="All 2 branches missed.">							if (enVirnCode.equals(vCode)) {</span>
<span class="nc" id="L1247">								System.out.println(&quot;status is &quot; + prizeStatus);</span>
<span class="nc bnc" id="L1248" title="All 2 branches missed.">								if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_RET_UNCLM&quot;)) {
<span class="nc" id="L1250">									CommonFunctionsHelper commHelper = new CommonFunctionsHelper();</span>
<span class="nc" id="L1251">									String flag = commHelper</span>
											.verifyOrgForUnClaimedVirn(
													agtOrgId, &quot;AGENT&quot;,
													enVirnCode, &quot;UNCLAIM_BAL&quot;,
													gameId, connection);
<span class="nc bnc" id="L1256" title="All 2 branches missed.">									if (!&quot;NONE&quot;.equalsIgnoreCase(flag)) {</span>
<span class="nc" id="L1257">										String orgname = null;</span>
<span class="nc" id="L1258">										String receiptNumber = null;</span>
<span class="nc" id="L1259">										Timestamp receiptTime = null;</span>
<span class="nc" id="L1260">										statement4 = connection</span>
												.createStatement();
										// String agtDetailsQuery=&quot;select name
										// from st_lms_organization_master where
										// organization_id in (select
										// agent_org_id from st_se_bo_pwt where
										// virn_code='&quot;+enVirnCode+&quot;' and
										// game_id=&quot;+gameId+&quot;)&quot;;
<span class="nc" id="L1268">										String retDetailsQuery = &quot;select a.name,c.generated_id,e.transaction_date from st_lms_organization_master a,st_se_agent_pwt b,st_lms_agent_receipts c,st_lms_agent_transaction_master e where b.virn_code='&quot;</span>
												+ enVirnCode
												+ &quot;' and b.game_id=&quot;
												+ gameId
												+ &quot; and a.organization_id=b.retailer_org_id and b.transaction_id=e.transaction_id and c.receipt_id=(select receipt_id from st_lms_agent_receipts_trn_mapping where transaction_id=e.transaction_id)&quot;;

<span class="nc" id="L1274">										System.out</span>
												.println(&quot;query for get org name &quot;
														+ retDetailsQuery);
<span class="nc" id="L1277">										resultSet4 = statement4</span>
												.executeQuery(retDetailsQuery);
<span class="nc bnc" id="L1279" title="All 2 branches missed.">										while (resultSet4.next()) {</span>
<span class="nc" id="L1280">											orgname = resultSet4</span>
													.getString(&quot;name&quot;);
<span class="nc" id="L1282">											receiptNumber = resultSet4</span>
													.getString(&quot;generated_id&quot;);
<span class="nc" id="L1284">											receiptTime = resultSet4</span>
													.getTimestamp(&quot;transaction_date&quot;);
										}

<span class="nc" id="L1288">										isVerified = true;</span>
<span class="nc" id="L1289">										pwtBean.setValid(true);</span>
<span class="nc" id="L1290">										pwtBean</span>
												.setVerificationStatus(&quot;Valid Virn&quot;);
<span class="nc" id="L1292">										pwtBean.setPwtAmount(pwtAmount);</span>
										// pwtBean.setMessage(&quot;Credited to
										// Concerned Party&quot;);
<span class="nc" id="L1295">										pwtBean</span>
												.setMessage(&quot;Already Paid to Retailer: &quot;
														+ orgname
														+ &quot; on Voucher Number: &quot;
														+ receiptNumber
														+ &quot; at &quot; + receiptTime);
<span class="nc" id="L1301">										pwtBean.setInUnclmed(flag);</span>
<span class="nc" id="L1302">										pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L1303">									} else {</span>
<span class="nc" id="L1304">										pwtBean.setValid(false);</span>
<span class="nc" id="L1305">										pwtBean</span>
												.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1307">										pwtBean</span>
												.setMessage(&quot;VIRN To be Claimed by Another Agent.&quot;);
<span class="nc" id="L1309">										pwtBean.setMessageCode(&quot;TBD&quot;);</span>

									}
<span class="nc" id="L1312">									break;</span>
<span class="nc bnc" id="L1313" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;UNCLM_PWT&quot;)) {
<span class="nc bnc" id="L1315" title="All 8 branches missed.">									if (highPrizeCriteria.equals(&quot;level&quot;)</span>
											&amp;&amp; prizeLevel.equals(&quot;HIGH&quot;)
											|| highPrizeCriteria.equals(&quot;amt&quot;)
											&amp;&amp; Double.parseDouble(pwtAmount) &gt; HighPrizeAmount) {
<span class="nc" id="L1319">										System.out.println(&quot;inside high prize&quot;);</span>
<span class="nc" id="L1320">										System.out.println(&quot;criteria is &quot;</span>
												+ highPrizeCriteria);
<span class="nc" id="L1322">										pwtBean.setHighLevel(true);</span>
<span class="nc" id="L1323">										pwtBean.setValid(false);</span>
<span class="nc" id="L1324">										pwtBean</span>
												.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1326">										pwtBean</span>
												.setMessage(&quot;High prize VIRN can't be Paid to Agent.It is to be paid as Direct Player PWT&quot;);
<span class="nc" id="L1328">										pwtBean.setMessageCode(&quot;112008&quot;);</span>
									} else {
<span class="nc" id="L1330">										isVerified = true;</span>
<span class="nc" id="L1331">										pwtBean.setValid(true);</span>
<span class="nc" id="L1332">										pwtBean</span>
												.setVerificationStatus(&quot;Valid Virn&quot;);
<span class="nc" id="L1334">										pwtBean.setPwtAmount(pwtAmount);</span>
<span class="nc" id="L1335">										pwtBean</span>
												.setMessage(&quot;Credited to Concerned Party&quot;);
<span class="nc" id="L1337">										pwtBean.setMessageCode(&quot;111002&quot;);</span>
									}
<span class="nc" id="L1339">									break;</span>
<span class="nc bnc" id="L1340" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;UNCLM_CANCELLED&quot;)) {
<span class="nc bnc" id="L1342" title="All 8 branches missed.">									if (highPrizeCriteria.equals(&quot;level&quot;)</span>
											&amp;&amp; prizeLevel.equals(&quot;HIGH&quot;)
											|| highPrizeCriteria.equals(&quot;amt&quot;)
											&amp;&amp; Double.parseDouble(pwtAmount) &gt; HighPrizeAmount) {
<span class="nc" id="L1346">										System.out.println(&quot;inside high prize&quot;);</span>
<span class="nc" id="L1347">										System.out.println(&quot;criteria is &quot;</span>
												+ highPrizeCriteria);
<span class="nc" id="L1349">										pwtBean.setHighLevel(true);</span>
<span class="nc" id="L1350">										pwtBean.setValid(false);</span>
<span class="nc" id="L1351">										pwtBean</span>
												.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1353">										pwtBean</span>
												.setMessage(&quot;High prize VIRN can't be paid to Agent.It is to be paid as Direct Player PWT&quot;);
<span class="nc" id="L1355">										pwtBean.setMessageCode(&quot;112011&quot;);</span>
									} else {
<span class="nc" id="L1357">										isVerified = true;</span>
<span class="nc" id="L1358">										pwtBean.setValid(true);</span>
<span class="nc" id="L1359">										pwtBean</span>
												.setVerificationStatus(&quot;Valid Virn&quot;);
<span class="nc" id="L1361">										pwtBean.setPwtAmount(pwtAmount);</span>
<span class="nc" id="L1362">										pwtBean</span>
												.setMessage(&quot;Credited to Concerned Party&quot;);
<span class="nc" id="L1364">										pwtBean.setMessageCode(&quot;111003&quot;);</span>
									}
<span class="nc" id="L1366">									break;</span>
<span class="nc bnc" id="L1367" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_PLR_AGT_UNCLM_DIR&quot;)) {
<span class="nc" id="L1369">									CommonFunctionsHelper commHelper = new CommonFunctionsHelper();</span>
<span class="nc" id="L1370">									String flag = commHelper</span>
											.verifyOrgForUnClaimedVirn(
													agtOrgId, &quot;AGENT&quot;,
													enVirnCode, &quot;UNCLAIM_BAL&quot;,
													gameId, connection);
<span class="nc bnc" id="L1375" title="All 2 branches missed.">									if (!&quot;NONE&quot;.equalsIgnoreCase(flag)) {</span>
										// get player details from st Agent
										// direct player details************8

<span class="nc" id="L1379">										String agtOrgNAme = null;</span>
<span class="nc" id="L1380">										String playerFirstName = null;</span>
<span class="nc" id="L1381">										String playerLastName = null;</span>
<span class="nc" id="L1382">										String playercity = null;</span>
<span class="nc" id="L1383">										String receiptNumber = null;</span>
<span class="nc" id="L1384">										Timestamp receiptTime = null;</span>
<span class="nc" id="L1385">										statement3 = connection</span>
												.createStatement();
										// String plrDetailsQuery=&quot;select
										// first_name,last_name,city from
										// st_lms_player_master where player_id
										// in (select player_id from
										// st_se_direct_player_pwt where
										// virn_code='&quot;+enVirnCode+&quot;' and
										// game_id=&quot;+gameId+&quot;)&quot;;
										// String plrDetailsQuery=&quot;select
										// b.first_name,b.last_name,b.city,a.transaction_date,c.generated_id
										// from st_se_direct_player_pwt
										// a,st_lms_player_master
										// b,st_lms_bo_receipts c where
										// a.virn_code='&quot;+enVirnCode+&quot;' and
										// a.game_id=&quot;+gameId+&quot; and
										// a.player_id=b.player_id and
										// c.receipt_id=(select receipt_id from
										// st_lms_bo_receipts_trn_mapping where
										// transaction_id=a.transaction_id)&quot;;
<span class="nc" id="L1405">										String plrDetailsQuery = &quot;select b.first_name,b.last_name,b.city,a.transaction_date,c.generated_id,d.name from st_se_agt_direct_player_pwt a,st_lms_player_master b,st_lms_agent_receipts c,st_lms_organization_master d where a.virn_code='&quot;</span>
												+ enVirnCode
												+ &quot;' and a.game_id=&quot;
												+ gameId
												+ &quot; and a.player_id=b.player_id and c.receipt_id=(select receipt_id from st_lms_agent_receipts_trn_mapping where transaction_id=a.transaction_id) and d.organization_id=a.agent_org_id&quot;;
<span class="nc" id="L1410">										System.out</span>
												.println(&quot;query for get player name &quot;
														+ plrDetailsQuery);
<span class="nc" id="L1413">										resultSet3 = statement3</span>
												.executeQuery(plrDetailsQuery);
<span class="nc bnc" id="L1415" title="All 2 branches missed.">										while (resultSet3.next()) {</span>
<span class="nc" id="L1416">											playerFirstName = resultSet3</span>
													.getString(&quot;first_name&quot;);
<span class="nc" id="L1418">											playerLastName = resultSet3</span>
													.getString(&quot;last_name&quot;);
<span class="nc" id="L1420">											playercity = resultSet3</span>
													.getString(&quot;city&quot;);
<span class="nc" id="L1422">											receiptNumber = resultSet3</span>
													.getString(&quot;generated_id&quot;);
<span class="nc" id="L1424">											receiptTime = resultSet3</span>
													.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L1426">											agtOrgNAme = resultSet3</span>
													.getString(&quot;name&quot;);
										}

<span class="nc" id="L1430">										isVerified = true;</span>
<span class="nc" id="L1431">										pwtBean.setValid(true);</span>
<span class="nc" id="L1432">										pwtBean</span>
												.setVerificationStatus(&quot;Valid Virn&quot;);
<span class="nc" id="L1434">										pwtBean.setPwtAmount(pwtAmount);</span>
										// pwtBean.setMessage(&quot;Credited to
										// Concerned Party&quot;);
<span class="nc" id="L1437">										pwtBean</span>
												.setMessage(&quot;Already Paid to Player &quot;
														+ playerFirstName
														+ &quot; &quot;
														+ playerLastName
														+ &quot; &quot;
														+ playercity
														+ &quot; By Agent: &quot;
														+ agtOrgNAme
														+ &quot; on Voucher Number: &quot;
														+ receiptNumber
														+ &quot; at &quot; + receiptTime);
<span class="nc" id="L1449">										pwtBean.setInUnclmed(flag);</span>
<span class="nc" id="L1450">										pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L1451">									} else {</span>
<span class="nc" id="L1452">										pwtBean.setValid(false);</span>
<span class="nc" id="L1453">										pwtBean</span>
												.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1455">										pwtBean</span>
												.setMessage(&quot;VIRN To be Claimed by Another Agent.&quot;);
<span class="nc" id="L1457">										pwtBean.setMessageCode(&quot;TBD&quot;);</span>
									}
<span class="nc" id="L1459">									break;</span>
<span class="nc bnc" id="L1460" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_PLR_AGT_CLM_DIR&quot;)) {
									// show the agent details and player details
<span class="nc" id="L1463">									String agtOrgNAme = null;</span>
<span class="nc" id="L1464">									String playerFirstName = null;</span>
<span class="nc" id="L1465">									String playerLastName = null;</span>
<span class="nc" id="L1466">									String playercity = null;</span>
<span class="nc" id="L1467">									String receiptNumber = null;</span>
<span class="nc" id="L1468">									Timestamp receiptTime = null;</span>
<span class="nc" id="L1469">									statement3 = connection.createStatement();</span>
									// String plrDetailsQuery=&quot;select
									// first_name,last_name,city from
									// st_lms_player_master where player_id in
									// (select player_id from
									// st_se_direct_player_pwt where
									// virn_code='&quot;+enVirnCode+&quot;' and
									// game_id=&quot;+gameId+&quot;)&quot;;
									// String plrDetailsQuery=&quot;select
									// b.first_name,b.last_name,b.city,a.transaction_date,c.generated_id
									// from st_se_direct_player_pwt
									// a,st_lms_player_master
									// b,st_lms_bo_receipts c where
									// a.virn_code='&quot;+enVirnCode+&quot;' and
									// a.game_id=&quot;+gameId+&quot; and
									// a.player_id=b.player_id and
									// c.receipt_id=(select receipt_id from
									// st_lms_bo_receipts_trn_mapping where
									// transaction_id=a.transaction_id)&quot;;
<span class="nc" id="L1488">									String plrDetailsQuery = &quot;select b.first_name,b.last_name,b.city,a.transaction_date,c.generated_id,d.name from st_se_agt_direct_player_pwt a,st_lms_player_master b,st_lms_agent_receipts c,st_lms_organization_master d where a.virn_code='&quot;</span>
											+ enVirnCode
											+ &quot;' and a.game_id=&quot;
											+ gameId
											+ &quot; and a.player_id=b.player_id and c.receipt_id=(select receipt_id from st_lms_agent_receipts_trn_mapping where transaction_id=a.transaction_id) and d.organization_id=a.agent_org_id&quot;;
<span class="nc" id="L1493">									System.out</span>
											.println(&quot;query for get player name &quot;
													+ plrDetailsQuery);
<span class="nc" id="L1496">									resultSet3 = statement3</span>
											.executeQuery(plrDetailsQuery);
<span class="nc bnc" id="L1498" title="All 2 branches missed.">									while (resultSet3.next()) {</span>
<span class="nc" id="L1499">										playerFirstName = resultSet3</span>
												.getString(&quot;first_name&quot;);
<span class="nc" id="L1501">										playerLastName = resultSet3</span>
												.getString(&quot;last_name&quot;);
<span class="nc" id="L1503">										playercity = resultSet3</span>
												.getString(&quot;city&quot;);
<span class="nc" id="L1505">										receiptNumber = resultSet3</span>
												.getString(&quot;generated_id&quot;);
<span class="nc" id="L1507">										receiptTime = resultSet3</span>
												.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L1509">										agtOrgNAme = resultSet3</span>
												.getString(&quot;name&quot;);
									}

<span class="nc" id="L1513">									pwtBean.setValid(false);</span>
<span class="nc" id="L1514">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1516">									pwtBean</span>
											.setMessage(&quot;Already Paid to Player &quot;
													+ playerFirstName
													+ &quot; &quot;
													+ playerLastName
													+ &quot; &quot;
													+ playercity
													+ &quot; By Agent: &quot;
													+ agtOrgNAme
													+ &quot; In Claimable Balance on Voucher Number: &quot;
													+ receiptNumber
													+ &quot; at &quot;
													+ receiptTime);
									// pwtBean.setMessage(&quot;Paid to Player By
									// Agent In Claimable Balance&quot;);
<span class="nc" id="L1531">									pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L1532">									break;</span>
<span class="nc bnc" id="L1533" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_AGT_TEMP&quot;)) {
<span class="nc" id="L1535">									System.out</span>
											.println(&quot;---------inside claim_agt_ auto--------------&quot;);
<span class="nc" id="L1537">									String orgname = null;</span>
<span class="nc" id="L1538">									String receiptNumber = null;</span>
<span class="nc" id="L1539">									Timestamp receiptTime = null;</span>
<span class="nc" id="L1540">									statement4 = connection.createStatement();</span>
									// String agtDetailsQuery=&quot;select name from
									// st_lms_organization_master where
									// organization_id in (select agent_org_id
									// from st_se_bo_pwt where
									// virn_code='&quot;+enVirnCode+&quot;' and
									// game_id=&quot;+gameId+&quot;)&quot;;

<span class="nc" id="L1548">									String partyDetailsQuery = &quot;select a.receipt_id,a.date_entered ,b.name from st_se_tmp_pwt_inv a,st_lms_organization_master b  where virn_code='&quot;</span>
											+ enVirnCode
											+ &quot;' and game_id=&quot;
											+ gameId
											+ &quot; and organization_id=(select organization_id from st_lms_user_master where user_id=a.user_id)&quot;;

<span class="nc" id="L1554">									System.out</span>
											.println(&quot;query for get org name &quot;
													+ partyDetailsQuery);
<span class="nc" id="L1557">									resultSet4 = statement4</span>
											.executeQuery(partyDetailsQuery);
<span class="nc bnc" id="L1559" title="All 2 branches missed.">									while (resultSet4.next()) {</span>
<span class="nc" id="L1560">										orgname = resultSet4.getString(&quot;name&quot;);</span>
<span class="nc" id="L1561">										receiptNumber = resultSet4</span>
												.getString(&quot;receipt_id&quot;);
<span class="nc" id="L1563">										receiptTime = resultSet4</span>
												.getTimestamp(&quot;date_entered&quot;);
									}
<span class="nc" id="L1566">									pwtBean.setValid(false);</span>
<span class="nc" id="L1567">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1569">									pwtBean</span>
											.setMessage(&quot;Already Verified in Bulk Receipt at BO for agent: &quot;
													+ orgname
													+ &quot; on Bulk Receipt Number: &quot;
													+ receiptNumber
													+ &quot; at &quot;
													+ receiptTime
													+ &quot;, Final Payment Pending&quot;);
<span class="nc" id="L1577">									pwtBean.setMessageCode(&quot;112001&quot;);</span>
<span class="nc" id="L1578">									break;</span>
<span class="nc bnc" id="L1579" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_PLR_AGT_TEMP&quot;)) {

<span class="nc" id="L1582">									String orgname = null;</span>
<span class="nc" id="L1583">									String receiptNumber = null;</span>
<span class="nc" id="L1584">									Timestamp receiptTime = null;</span>
<span class="nc" id="L1585">									statement4 = connection.createStatement();</span>
									// String agtDetailsQuery=&quot;select name from
									// st_lms_organization_master where
									// organization_id in (select agent_org_id
									// from st_se_bo_pwt where
									// virn_code='&quot;+enVirnCode+&quot;' and
									// game_id=&quot;+gameId+&quot;)&quot;;

<span class="nc" id="L1593">									String partyDetailsQuery = &quot;select a.receipt_id,a.date_entered ,b.name from st_se_tmp_pwt_inv a,st_lms_organization_master b  where virn_code='&quot;</span>
											+ enVirnCode
											+ &quot;' and game_id=&quot;
											+ gameId
											+ &quot; and organization_id=(select organization_id from st_lms_user_master where user_id=a.user_id)&quot;;

<span class="nc" id="L1599">									System.out</span>
											.println(&quot;query for get org name &quot;
													+ partyDetailsQuery);
<span class="nc" id="L1602">									resultSet4 = statement4</span>
											.executeQuery(partyDetailsQuery);
<span class="nc bnc" id="L1604" title="All 2 branches missed.">									while (resultSet4.next()) {</span>
<span class="nc" id="L1605">										orgname = resultSet4.getString(&quot;name&quot;);</span>
<span class="nc" id="L1606">										receiptNumber = resultSet4</span>
												.getString(&quot;receipt_id&quot;);
<span class="nc" id="L1608">										receiptTime = resultSet4</span>
												.getTimestamp(&quot;date_entered&quot;);
									}
<span class="nc" id="L1611">									pwtBean.setValid(false);</span>
<span class="nc" id="L1612">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1614">									pwtBean</span>
											.setMessage(&quot;Already Verified in Bulk Receipt at BO for agent: &quot;
													+ orgname
													+ &quot; on Bulk Receipt Number: &quot;
													+ receiptNumber
													+ &quot; at &quot;
													+ receiptTime
													+ &quot;, Final Payment Pending&quot;);
<span class="nc" id="L1622">									pwtBean.setMessageCode(&quot;112001&quot;);</span>

<span class="nc" id="L1624">									break;</span>
<span class="nc bnc" id="L1625" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_RET_AGT_TEMP&quot;)) {
<span class="nc" id="L1627">									String orgname = null;</span>
<span class="nc" id="L1628">									String receiptNumber = null;</span>
<span class="nc" id="L1629">									Timestamp receiptTime = null;</span>
<span class="nc" id="L1630">									statement4 = connection.createStatement();</span>
									// String agtDetailsQuery=&quot;select name from
									// st_lms_organization_master where
									// organization_id in (select agent_org_id
									// from st_se_bo_pwt where
									// virn_code='&quot;+enVirnCode+&quot;' and
									// game_id=&quot;+gameId+&quot;)&quot;;

<span class="nc" id="L1638">									String partyDetailsQuery = &quot;select a.receipt_id,a.date_entered ,b.name from st_se_tmp_pwt_inv a,st_lms_organization_master b  where virn_code='&quot;</span>
											+ enVirnCode
											+ &quot;' and game_id=&quot;
											+ gameId
											+ &quot; and organization_id=(select organization_id from st_lms_user_master where user_id=a.user_id)&quot;;

<span class="nc" id="L1644">									System.out</span>
											.println(&quot;query for get org name &quot;
													+ partyDetailsQuery);
<span class="nc" id="L1647">									resultSet4 = statement4</span>
											.executeQuery(partyDetailsQuery);
<span class="nc bnc" id="L1649" title="All 2 branches missed.">									while (resultSet4.next()) {</span>
<span class="nc" id="L1650">										orgname = resultSet4.getString(&quot;name&quot;);</span>
<span class="nc" id="L1651">										receiptNumber = resultSet4</span>
												.getString(&quot;receipt_id&quot;);
<span class="nc" id="L1653">										receiptTime = resultSet4</span>
												.getTimestamp(&quot;date_entered&quot;);
									}
<span class="nc" id="L1656">									pwtBean.setValid(false);</span>
<span class="nc" id="L1657">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1659">									pwtBean</span>
											.setMessage(&quot;Already Verified in Bulk Receipt at BO for agent: &quot;
													+ orgname
													+ &quot; on Bulk Receipt Number: &quot;
													+ receiptNumber
													+ &quot; at &quot;
													+ receiptTime
													+ &quot;, Final Payment Pending&quot;);
<span class="nc" id="L1667">									pwtBean.setMessageCode(&quot;112001&quot;);</span>

<span class="nc" id="L1669">									break;</span>
<span class="nc bnc" id="L1670" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_AGT&quot;)) {
<span class="nc" id="L1672">									System.out</span>
											.println(&quot;---------inside alaim_agt--------------&quot;);
<span class="nc" id="L1674">									String orgname = null;</span>
<span class="nc" id="L1675">									String receiptNumber = null;</span>
<span class="nc" id="L1676">									Timestamp receiptTime = null;</span>
<span class="nc" id="L1677">									statement2 = connection.createStatement();</span>
									// String agtDetailsQuery=&quot;select name from
									// st_lms_organization_master where
									// organization_id in (select agent_org_id
									// from st_se_bo_pwt where
									// virn_code='&quot;+enVirnCode+&quot;' and
									// game_id=&quot;+gameId+&quot;)&quot;;

<span class="nc" id="L1685">									String agtDetailsQuery = &quot;select a.name,c.generated_id,e.transaction_date from st_lms_organization_master a,st_se_bo_pwt b,st_lms_bo_receipts c,st_lms_bo_transaction_master e where b.virn_code='&quot;</span>
											+ enVirnCode
											+ &quot;' and b.game_id=&quot;
											+ gameId
											+ &quot; and a.organization_id=b.agent_org_id and b.transaction_id=e.transaction_id and c.receipt_id=(select receipt_id from st_lms_bo_receipts_trn_mapping where transaction_id=e.transaction_id)&quot;;

<span class="nc" id="L1691">									System.out</span>
											.println(&quot;query for get org name &quot;
													+ agtDetailsQuery);
<span class="nc" id="L1694">									resultSet2 = statement2</span>
											.executeQuery(agtDetailsQuery);
<span class="nc bnc" id="L1696" title="All 2 branches missed.">									while (resultSet2.next()) {</span>
<span class="nc" id="L1697">										orgname = resultSet2.getString(&quot;name&quot;);</span>
<span class="nc" id="L1698">										receiptNumber = resultSet2</span>
												.getString(&quot;generated_id&quot;);
<span class="nc" id="L1700">										receiptTime = resultSet2</span>
												.getTimestamp(&quot;transaction_date&quot;);
									}
<span class="nc" id="L1703">									pwtBean.setValid(false);</span>
<span class="nc" id="L1704">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1706">									pwtBean</span>
											.setMessage(&quot;Already Paid to Agent: &quot;
													+ orgname
													+ &quot; on Voucher Number: &quot;
													+ receiptNumber
													+ &quot; at &quot;
													+ receiptTime);
<span class="nc" id="L1713">									pwtBean.setMessageCode(&quot;112003&quot;);</span>

<span class="nc" id="L1715">									break;</span>
<span class="nc bnc" id="L1716" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_AGT_AUTO&quot;)) {
<span class="nc" id="L1718">									String orgname = null;</span>
<span class="nc" id="L1719">									String receiptNumber = null;</span>
<span class="nc" id="L1720">									Timestamp receiptTime = null;</span>
<span class="nc" id="L1721">									statement2 = connection.createStatement();</span>
									// String agtDetailsQuery=&quot;select name from
									// st_lms_organization_master where
									// organization_id in (select agent_org_id
									// from st_se_bo_pwt where
									// virn_code='&quot;+enVirnCode+&quot;' and
									// game_id=&quot;+gameId+&quot;)&quot;;

<span class="nc" id="L1729">									String agtDetailsQuery = &quot;select a.name,c.generated_id,e.transaction_date from st_lms_organization_master a,st_se_bo_pwt b,st_lms_bo_receipts c,st_lms_bo_transaction_master e where b.virn_code='&quot;</span>
											+ enVirnCode
											+ &quot;' and b.game_id=&quot;
											+ gameId
											+ &quot; and a.organization_id=b.agent_org_id and b.transaction_id=e.transaction_id and c.receipt_id=(select receipt_id from st_lms_bo_receipts_trn_mapping where transaction_id=e.transaction_id)&quot;;

<span class="nc" id="L1735">									System.out</span>
											.println(&quot;query for get org name &quot;
													+ agtDetailsQuery);
<span class="nc" id="L1738">									resultSet2 = statement2</span>
											.executeQuery(agtDetailsQuery);
<span class="nc bnc" id="L1740" title="All 2 branches missed.">									while (resultSet2.next()) {</span>
<span class="nc" id="L1741">										orgname = resultSet2.getString(&quot;name&quot;);</span>
<span class="nc" id="L1742">										receiptNumber = resultSet2</span>
												.getString(&quot;generated_id&quot;);
<span class="nc" id="L1744">										receiptTime = resultSet2</span>
												.getTimestamp(&quot;transaction_date&quot;);
									}
<span class="nc" id="L1747">									pwtBean.setValid(false);</span>
<span class="nc" id="L1748">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1750">									pwtBean</span>
											.setMessage(&quot;Already Paid As Auto Scrap to Agent: &quot;
													+ orgname
													+ &quot; on Voucher Number: &quot;
													+ receiptNumber
													+ &quot; at &quot;
													+ receiptTime);
<span class="nc" id="L1757">									pwtBean.setMessageCode(&quot;112003&quot;);</span>

<span class="nc" id="L1759">									break;</span>
<span class="nc bnc" id="L1760" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_PLR_BO&quot;)) {
<span class="nc" id="L1762">									String playerFirstName = null;</span>
<span class="nc" id="L1763">									String playerLastName = null;</span>
<span class="nc" id="L1764">									String playercity = null;</span>
<span class="nc" id="L1765">									String receiptNumber = null;</span>
<span class="nc" id="L1766">									Timestamp receiptTime = null;</span>
<span class="nc" id="L1767">									statement3 = connection.createStatement();</span>
									// String plrDetailsQuery=&quot;select
									// first_name,last_name,city from
									// st_lms_player_master where player_id in
									// (select player_id from
									// st_se_direct_player_pwt where
									// virn_code='&quot;+enVirnCode+&quot;' and
									// game_id=&quot;+gameId+&quot;)&quot;;
<span class="nc" id="L1775">									String plrDetailsQuery = &quot;select b.first_name,b.last_name,b.city,a.transaction_date,c.generated_id from st_se_direct_player_pwt a,st_lms_player_master b,st_lms_bo_receipts c where a.virn_code='&quot;</span>
											+ enVirnCode
											+ &quot;' and a.game_id=&quot;
											+ gameId
											+ &quot; and a.player_id=b.player_id and c.receipt_id=(select receipt_id from st_lms_bo_receipts_trn_mapping where transaction_id=a.transaction_id)&quot;;
<span class="nc" id="L1780">									System.out</span>
											.println(&quot;query for get player name &quot;
													+ plrDetailsQuery);
<span class="nc" id="L1783">									resultSet3 = statement3</span>
											.executeQuery(plrDetailsQuery);
<span class="nc bnc" id="L1785" title="All 2 branches missed.">									while (resultSet3.next()) {</span>
<span class="nc" id="L1786">										playerFirstName = resultSet3</span>
												.getString(&quot;first_name&quot;);
<span class="nc" id="L1788">										playerLastName = resultSet3</span>
												.getString(&quot;last_name&quot;);
<span class="nc" id="L1790">										playercity = resultSet3</span>
												.getString(&quot;city&quot;);
<span class="nc" id="L1792">										receiptNumber = resultSet3</span>
												.getString(&quot;generated_id&quot;);
<span class="nc" id="L1794">										receiptTime = resultSet3</span>
												.getTimestamp(&quot;transaction_date&quot;);
									}
<span class="nc" id="L1797">									pwtBean.setValid(false);</span>
<span class="nc" id="L1798">									pwtBean</span>
											.setMessage(&quot;Already Paid By BO as Direct Player PWT to Player: &quot;
													+ playerFirstName
													+ &quot; &quot;
													+ playerLastName
													+ &quot;,&quot;
													+ playercity
													+ &quot; on Voucher Number &quot;
													+ receiptNumber
													+ &quot; at &quot;
													+ receiptTime);
<span class="nc" id="L1809">									pwtBean.setMessageCode(&quot;112005&quot;);</span>
<span class="nc" id="L1810">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1812">									break;</span>
<span class="nc bnc" id="L1813" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_PLR_RET_UNCLM&quot;)) {
									// show info of retailer if available from
									// at retailer PWT
<span class="nc" id="L1817">									String orgname = null;</span>
<span class="nc" id="L1818">									Timestamp receiptTime = null;</span>
<span class="nc" id="L1819">									statement2 = connection.createStatement();</span>
									// String agtDetailsQuery=&quot;select name from
									// st_lms_organization_master where
									// organization_id in (select agent_org_id
									// from st_se_bo_pwt where
									// virn_code='&quot;+enVirnCode+&quot;' and
									// game_id=&quot;+gameId+&quot;)&quot;;

									// String agtDetailsQuery=&quot;select
									// a.name,c.generated_id,e.transaction_date
									// from st_lms_organization_master
									// a,st_se_bo_pwt b,st_lms_bo_receipts
									// c,st_lms_bo_transaction_master e where
									// b.virn_code='&quot;+enVirnCode+&quot;' and
									// b.game_id=&quot;+gameId+&quot; and
									// a.organization_id=b.agent_org_id and
									// b.transaction_id=e.transaction_id and
									// c.receipt_id=(select receipt_id from
									// st_lms_bo_receipts_trn_mapping where
									// transaction_id=e.transaction_id)&quot;;
<span class="nc" id="L1839">									String retDetailsQuery = &quot;select a.name,e.transaction_date from st_lms_organization_master a,st_se_retailer_pwt b,st_lms_retailer_transaction_master e where b.virn_code='&quot;</span>
											+ enVirnCode
											+ &quot;' and b.game_id=&quot;
											+ gameId
											+ &quot; and a.organization_id=b.retailer_org_id and b.transaction_id=e.transaction_id&quot;;

<span class="nc" id="L1845">									System.out</span>
											.println(&quot;query for get org name &quot;
													+ retDetailsQuery);
<span class="nc" id="L1848">									resultSet2 = statement2</span>
											.executeQuery(retDetailsQuery);
<span class="nc bnc" id="L1850" title="All 2 branches missed.">									while (resultSet2.next()) {</span>
<span class="nc" id="L1851">										orgname = resultSet2.getString(&quot;name&quot;);</span>
<span class="nc" id="L1852">										receiptTime = resultSet2</span>
												.getTimestamp(&quot;transaction_date&quot;);
									}

<span class="nc" id="L1856">									pwtBean.setValid(false);</span>
<span class="nc" id="L1857">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1859">									pwtBean</span>
											.setMessage(&quot;This VIRN No. has been paid to Player by retailer:&quot;
													+ orgname
													+ &quot; on Voucher &quot;
													+ receiptTime
													+ &quot; but not claimed by retailer to agent &quot;);
<span class="nc" id="L1865">									break;</span>
<span class="nc bnc" id="L1866" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_PLR_RET_CLM&quot;)) {
									// show info of retailer if available from
									// at retailer PWT

<span class="nc" id="L1871">									String orgname = null;</span>
<span class="nc" id="L1872">									Timestamp receiptTime = null;</span>
<span class="nc" id="L1873">									statement2 = connection.createStatement();</span>
									// String agtDetailsQuery=&quot;select name from
									// st_lms_organization_master where
									// organization_id in (select agent_org_id
									// from st_se_bo_pwt where
									// virn_code='&quot;+enVirnCode+&quot;' and
									// game_id=&quot;+gameId+&quot;)&quot;;

									// String agtDetailsQuery=&quot;select
									// a.name,c.generated_id,e.transaction_date
									// from st_lms_organization_master
									// a,st_se_bo_pwt b,st_lms_bo_receipts
									// c,st_lms_bo_transaction_master e where
									// b.virn_code='&quot;+enVirnCode+&quot;' and
									// b.game_id=&quot;+gameId+&quot; and
									// a.organization_id=b.agent_org_id and
									// b.transaction_id=e.transaction_id and
									// c.receipt_id=(select receipt_id from
									// st_lms_bo_receipts_trn_mapping where
									// transaction_id=e.transaction_id)&quot;;
<span class="nc" id="L1893">									String retDetailsQuery = &quot;select a.name,e.transaction_date from st_lms_organization_master a,st_se_retailer_pwt b,st_lms_retailer_transaction_master e where b.virn_code='&quot;</span>
											+ enVirnCode
											+ &quot;' and b.game_id=&quot;
											+ gameId
											+ &quot; and a.organization_id=b.retailer_org_id and b.transaction_id=e.transaction_id&quot;;

<span class="nc" id="L1899">									System.out</span>
											.println(&quot;query for get org name &quot;
													+ retDetailsQuery);
<span class="nc" id="L1902">									resultSet2 = statement2</span>
											.executeQuery(retDetailsQuery);
<span class="nc bnc" id="L1904" title="All 2 branches missed.">									while (resultSet2.next()) {</span>
<span class="nc" id="L1905">										orgname = resultSet2.getString(&quot;name&quot;);</span>
<span class="nc" id="L1906">										receiptTime = resultSet2</span>
												.getTimestamp(&quot;transaction_date&quot;);
									}

<span class="nc" id="L1910">									pwtBean.setValid(false);</span>
<span class="nc" id="L1911">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1913">									pwtBean</span>
											.setMessage(&quot;This VIRN No. has been paid to Player by retailer:&quot;
													+ orgname
													+ &quot; on Voucher &quot;
													+ receiptTime
													+ &quot;  As Claimmable &quot;);
<span class="nc" id="L1919">									break;</span>
<span class="nc bnc" id="L1920" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_PLR_RET_UNCLM_DIR&quot;)) {
									// show info of retailer if available from
									// at retailer direct player
<span class="nc" id="L1924">									pwtBean.setValid(false);</span>
<span class="nc" id="L1925">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1927">									pwtBean</span>
											.setMessage(&quot;This VIRN No. has been paid to Player by retailer but not claimed by retailer to agent &quot;);
<span class="nc" id="L1929">									break;</span>
<span class="nc bnc" id="L1930" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_PLR_RET_CLM_DIR&quot;)) {
									// show info of retailer if available from
									// at retailer derect palyer PWT

<span class="nc" id="L1935">									pwtBean.setValid(false);</span>
<span class="nc" id="L1936">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1938">									pwtBean</span>
											.setMessage(&quot;This VIRN No. has been paid to Player by retailer As Claimmable &quot;);
<span class="nc" id="L1940">									break;</span>
<span class="nc bnc" id="L1941" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_RET_TEMP&quot;)) {
<span class="nc" id="L1943">									pwtBean.setValid(false);</span>
<span class="nc" id="L1944">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1946">									pwtBean</span>
											.setMessage(&quot;Already Verified in Bulk Receipt at Agent,Final Payment Pending&quot;);
<span class="nc" id="L1948">									pwtBean.setMessageCode(&quot;112006&quot;);</span>
<span class="nc" id="L1949">									break;</span>
<span class="nc bnc" id="L1950" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_RET_CLM&quot;)) {
<span class="nc" id="L1952">									String agtOrgname = null;</span>
<span class="nc" id="L1953">									String retOrgName = null;</span>
<span class="nc" id="L1954">									String receiptNumber = null;</span>
<span class="nc" id="L1955">									Timestamp receiptTime = null;</span>
<span class="nc" id="L1956">									statement2 = connection.createStatement();</span>
<span class="nc" id="L1957">									String agtDetailsQuery = &quot;select  b.transaction_date,c.generated_id,(select name from st_lms_organization_master where organization_id=a.retailer_org_id) 'agt_name' ,(select name from st_lms_organization_master where organization_id=a.retailer_org_id) 'ret_name'  from st_se_agent_pwt a,st_lms_agent_transaction_master b,st_lms_agent_receipts c where a.virn_code='&quot;</span>
											+ enVirnCode
											+ &quot;' and a.game_id=&quot;
											+ gameId
											+ &quot; and a.transaction_id=b.transaction_id  and c.receipt_id=(select receipt_id from st_lms_agent_receipts_trn_mapping where transaction_id=b.transaction_id)&quot;;

<span class="nc" id="L1963">									System.out</span>
											.println(&quot;query for get org name &quot;
													+ agtDetailsQuery);
<span class="nc" id="L1966">									resultSet2 = statement2</span>
											.executeQuery(agtDetailsQuery);
<span class="nc bnc" id="L1968" title="All 2 branches missed.">									while (resultSet2.next()) {</span>
<span class="nc" id="L1969">										agtOrgname = resultSet2</span>
												.getString(&quot;agt_name&quot;);
<span class="nc" id="L1971">										retOrgName = resultSet2</span>
												.getString(&quot;ret_name&quot;);
<span class="nc" id="L1973">										receiptNumber = resultSet2</span>
												.getString(&quot;generated_id&quot;);
<span class="nc" id="L1975">										receiptTime = resultSet2</span>
												.getTimestamp(&quot;transaction_date&quot;);
									}
<span class="nc" id="L1978">									pwtBean.setValid(false);</span>
<span class="nc" id="L1979">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1981">									pwtBean</span>
											.setMessage(&quot;Paid to retailer: &quot;
													+ retOrgName
													+ &quot; By Agent: &quot;
													+ agtOrgname
													+ &quot; Voucher Number:&quot;
													+ receiptNumber
													+ &quot; on &quot;
													+ receiptTime
													+ &quot; and pending to claim at bo by agent as uato sarap&quot;);
<span class="nc" id="L1991">									pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L1992">									break;</span>
<span class="nc bnc" id="L1993" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_RET_CLM_AUTO&quot;)) {
									// show agent and retailers name
<span class="nc" id="L1996">									String agtOrgname = null;</span>
<span class="nc" id="L1997">									String retOrgName = null;</span>
<span class="nc" id="L1998">									String receiptNumber = null;</span>
<span class="nc" id="L1999">									Timestamp receiptTime = null;</span>
<span class="nc" id="L2000">									statement2 = connection.createStatement();</span>
<span class="nc" id="L2001">									String agtDetailsQuery = &quot;select  b.transaction_date,c.generated_id,(select name from st_lms_organization_master where organization_id=a.retailer_org_id) 'agt_name' ,(select name from st_lms_organization_master where organization_id=a.retailer_org_id) 'ret_name'  from st_se_agent_pwt a,st_lms_agent_transaction_master b,st_lms_agent_receipts c where a.virn_code='&quot;</span>
											+ enVirnCode
											+ &quot;' and a.game_id=&quot;
											+ gameId
											+ &quot; and a.transaction_id=b.transaction_id  and c.receipt_id=(select receipt_id from st_lms_agent_receipts_trn_mapping where transaction_id=b.transaction_id)&quot;;

<span class="nc" id="L2007">									System.out</span>
											.println(&quot;query for get org name &quot;
													+ agtDetailsQuery);
<span class="nc" id="L2010">									resultSet2 = statement2</span>
											.executeQuery(agtDetailsQuery);
<span class="nc bnc" id="L2012" title="All 2 branches missed.">									while (resultSet2.next()) {</span>
<span class="nc" id="L2013">										agtOrgname = resultSet2</span>
												.getString(&quot;agt_name&quot;);
<span class="nc" id="L2015">										retOrgName = resultSet2</span>
												.getString(&quot;ret_name&quot;);
<span class="nc" id="L2017">										receiptNumber = resultSet2</span>
												.getString(&quot;generated_id&quot;);
<span class="nc" id="L2019">										receiptTime = resultSet2</span>
												.getTimestamp(&quot;transaction_date&quot;);
									}
<span class="nc" id="L2022">									pwtBean.setValid(false);</span>
<span class="nc" id="L2023">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2025">									pwtBean</span>
											.setMessage(&quot;Paid to retailer: &quot;
													+ retOrgName
													+ &quot; By Agent: &quot;
													+ agtOrgname
													+ &quot; Voucher Number:&quot;
													+ receiptNumber
													+ &quot; on &quot;
													+ receiptTime
													+ &quot; As Auto Scrap and pending to claim at bo as AUTO Scrap&quot;);
<span class="nc" id="L2035">									pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L2036">									break;</span>
<span class="nc bnc" id="L2037" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CLAIM_PLR_RET_TEMP&quot;)) {
<span class="nc" id="L2039">									pwtBean.setValid(false);</span>
<span class="nc" id="L2040">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2042">									pwtBean</span>
											.setMessage(&quot;Already Verified in Bulk Receipt at Agent,Final Payment Pending&quot;);
<span class="nc" id="L2044">									pwtBean.setMessageCode(&quot;112007&quot;);</span>
<span class="nc" id="L2045">									break;</span>
<span class="nc bnc" id="L2046" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;REQUESTED&quot;)) {
									// show request details from request table
									// with history

<span class="nc" id="L2051">									String reqByOrgName = null;</span>
<span class="nc" id="L2052">									String reqToOrgName = null;</span>
<span class="nc" id="L2053">									String reqByType = null;</span>
<span class="nc" id="L2054">									String reqToType = null;</span>
<span class="nc" id="L2055">									String receiptNumber = null;</span>
<span class="nc" id="L2056">									Timestamp receiptTime = null;</span>
<span class="nc" id="L2057">									statement2 = connection.createStatement();</span>
<span class="nc" id="L2058">									String reqDetailsQuery = &quot;select a.requester_type,a.requested_to_type,a.request_id,a.request_date,(select name from st_lms_organization_master where organization_id=a.requested_by_org_id) as reqByName,(select name from st_lms_organization_master where organization_id=a.requested_to_org_id) as reqToName from st_se_pwt_approval_request_master a where a.virn_code='&quot;</span>
											+ enVirnCode
											+ &quot;' and a.game_id=&quot;
											+ gameId
											+ &quot; and a.req_status='REQUESTED'&quot;;

<span class="nc" id="L2064">									System.out</span>
											.println(&quot;query for get org name &quot;
													+ reqDetailsQuery);
<span class="nc" id="L2067">									resultSet2 = statement2</span>
											.executeQuery(reqDetailsQuery);
<span class="nc bnc" id="L2069" title="All 2 branches missed.">									while (resultSet2.next()) {</span>
<span class="nc" id="L2070">										reqByOrgName = resultSet2</span>
												.getString(&quot;reqByName&quot;);
<span class="nc" id="L2072">										reqToOrgName = resultSet2</span>
												.getString(&quot;reqToName&quot;);
<span class="nc" id="L2074">										reqByType = resultSet2</span>
												.getString(&quot;requester_type&quot;);
<span class="nc" id="L2076">										reqToType = resultSet2</span>
												.getString(&quot;requested_to_type&quot;);
<span class="nc" id="L2078">										receiptNumber = resultSet2</span>
												.getString(&quot;request_id&quot;);
<span class="nc" id="L2080">										receiptTime = resultSet2</span>
												.getTimestamp(&quot;request_date&quot;);
									}

<span class="nc" id="L2084">									pwtBean.setValid(false);</span>
<span class="nc" id="L2085">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2087">									pwtBean</span>
											.setMessage(&quot;This VIRN is requested by &quot;
													+ reqByType
													+ &quot;: &quot;
													+ reqByOrgName
													+ &quot;To &quot;
													+ reqToType
													+ &quot;: &quot;
													+ reqToOrgName
													+ &quot; for Approval with Voucher id: &quot;
													+ receiptNumber
													+ &quot; on &quot;
													+ receiptTime);
<span class="nc" id="L2100">									pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L2101">									break;</span>
<span class="nc bnc" id="L2102" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;PND_MAS&quot;)) {
									// details of by and to and date and voucher

<span class="nc" id="L2106">									String reqByOrgName = null;</span>
<span class="nc" id="L2107">									String reqToOrgName = null;</span>
<span class="nc" id="L2108">									String reqByType = null;</span>
<span class="nc" id="L2109">									String reqToType = null;</span>
<span class="nc" id="L2110">									String receiptNumber = null;</span>
<span class="nc" id="L2111">									Timestamp receiptTime = null;</span>
<span class="nc" id="L2112">									statement2 = connection.createStatement();</span>
<span class="nc" id="L2113">									String reqDetailsQuery = &quot;select a.requester_type,a.requested_to_type,a.request_id,a.request_date,(select name from st_lms_organization_master where organization_id=a.requested_by_org_id) as reqByName,(select name from st_lms_organization_master where organization_id=a.requested_to_org_id) as reqToName from st_se_pwt_approval_request_master a where a.virn_code='&quot;</span>
											+ enVirnCode
											+ &quot;' and a.game_id=&quot;
											+ gameId
											+ &quot; and a.req_status='PND_MAS'&quot;;

<span class="nc" id="L2119">									System.out</span>
											.println(&quot;query for get org name &quot;
													+ reqDetailsQuery);
<span class="nc" id="L2122">									resultSet2 = statement2</span>
											.executeQuery(reqDetailsQuery);
<span class="nc bnc" id="L2124" title="All 2 branches missed.">									while (resultSet2.next()) {</span>
<span class="nc" id="L2125">										reqByOrgName = resultSet2</span>
												.getString(&quot;reqByName&quot;);
<span class="nc" id="L2127">										reqToOrgName = resultSet2</span>
												.getString(&quot;reqToName&quot;);
<span class="nc" id="L2129">										reqByType = resultSet2</span>
												.getString(&quot;requester_type&quot;);
<span class="nc" id="L2131">										reqToType = resultSet2</span>
												.getString(&quot;requested_to_type&quot;);
<span class="nc" id="L2133">										receiptNumber = resultSet2</span>
												.getString(&quot;request_id&quot;);
<span class="nc" id="L2135">										receiptTime = resultSet2</span>
												.getTimestamp(&quot;request_date&quot;);
									}

<span class="nc" id="L2139">									pwtBean.setValid(false);</span>
<span class="nc" id="L2140">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2142">									pwtBean</span>
											.setMessage(&quot;This VIRN is requested by &quot;
													+ reqByType
													+ &quot;: &quot;
													+ reqByOrgName
													+ &quot;To &quot;
													+ reqToType
													+ &quot;: &quot;
													+ reqToOrgName
													+ &quot; for master Approval with Voucher id: &quot;
													+ receiptNumber
													+ &quot; on &quot;
													+ receiptTime);
<span class="nc" id="L2155">									pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L2156">									break;</span>
<span class="nc bnc" id="L2157" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;PND_PAY&quot;)) {
									// show details for payment by and to

<span class="nc" id="L2161">									String reqToOrgName = null;</span>
<span class="nc" id="L2162">									String reqToType = null;</span>
<span class="nc" id="L2163">									String receiptNumber = null;</span>
<span class="nc" id="L2164">									statement2 = connection.createStatement();</span>
<span class="nc" id="L2165">									String reqDetailsQuery = &quot;select a.request_id,a.pay_req_for_org_type,(select name from st_lms_organization_master where organization_id=a.pay_request_for_org_id) as payByName from st_se_pwt_approval_request_master a where a.virn_code='&quot;</span>
											+ enVirnCode
											+ &quot;' and a.game_id=&quot;
											+ gameId
											+ &quot; and a.req_status='PND_PAY'&quot;;

<span class="nc" id="L2171">									System.out</span>
											.println(&quot;query for get org name &quot;
													+ reqDetailsQuery);
<span class="nc" id="L2174">									resultSet2 = statement2</span>
											.executeQuery(reqDetailsQuery);
<span class="nc bnc" id="L2176" title="All 2 branches missed.">									while (resultSet2.next()) {</span>

<span class="nc" id="L2178">										reqToOrgName = resultSet2</span>
												.getString(&quot;payByName&quot;);
<span class="nc" id="L2180">										reqToType = resultSet2</span>
												.getString(&quot;pay_req_for_org_type&quot;);
<span class="nc" id="L2182">										receiptNumber = resultSet2</span>
												.getString(&quot;request_id&quot;);
									}

<span class="nc" id="L2186">									pwtBean.setValid(false);</span>
<span class="nc" id="L2187">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2189">									pwtBean</span>
											.setMessage(&quot;This VIRN is requested To &quot;
													+ reqToType
													+ &quot;: &quot;
													+ reqToOrgName
													+ &quot;for payment with Voucher id: &quot;
													+ receiptNumber);
<span class="nc" id="L2196">									pwtBean.setMessageCode(&quot;112009&quot;);</span>
<span class="nc" id="L2197">									break;</span>
<span class="nc bnc" id="L2198" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;CANCELLED_PERMANENT&quot;)) {
<span class="nc" id="L2200">									pwtBean.setValid(false);</span>
<span class="nc" id="L2201">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2203">									pwtBean</span>
											.setMessage(&quot;Tampered/Damaged/Defaced VIRN as noted at BO&quot;);
<span class="nc" id="L2205">									pwtBean.setMessageCode(&quot;112009&quot;);</span>
<span class="nc" id="L2206">									break;</span>
<span class="nc bnc" id="L2207" title="All 2 branches missed.">								} else if (prizeStatus</span>
										.equalsIgnoreCase(&quot;MISSING&quot;)) {
<span class="nc" id="L2209">									pwtBean.setValid(false);</span>
<span class="nc" id="L2210">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2212">									pwtBean</span>
											.setMessage(&quot;VIRN is from MISSING Status&quot;);
<span class="nc" id="L2214">									pwtBean.setMessageCode(&quot;&quot;);</span>

								} else {
<span class="nc" id="L2217">									pwtBean.setValid(false);</span>
<span class="nc" id="L2218">									pwtBean</span>
											.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2220">									pwtBean</span>
											.setMessage(&quot;UNDEFINED STATUS OF PWT:: &quot;
													+ prizeStatus);
<span class="nc" id="L2223">									pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L2224">									break;</span>
								}

							}

						}

					}

<span class="nc" id="L2233">				} catch (SQLException e) {</span>

<span class="nc" id="L2235">					e.printStackTrace();</span>
<span class="nc" id="L2236">					throw new LMSException(e);</span>
				} finally {

<span class="nc" id="L2239">					try {</span>

<span class="nc bnc" id="L2241" title="All 4 branches missed.">						if (statement != null) {</span>
<span class="nc" id="L2242">							statement.close();</span>
						}
<span class="nc bnc" id="L2244" title="All 4 branches missed.">						if (connection != null) {</span>
<span class="nc" id="L2245">							connection.close();</span>
						}
<span class="nc" id="L2247">					} catch (SQLException se) {</span>
<span class="nc" id="L2248">						se.printStackTrace();</span>
<span class="nc" id="L2249">					}</span>
<span class="nc" id="L2250">				}</span>

			}
		}

<span class="nc" id="L2255">		return isVerified;</span>

	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>