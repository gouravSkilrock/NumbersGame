<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PwtBOHelperTNV.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.scratchService.pwtMgmt.common</a> &gt; <span class="el_source">PwtBOHelperTNV.java</span></div><h1>PwtBOHelperTNV.java</h1><pre class="source lang-java linenums">/*
 * ï¿½ copyright 2007, SkilRock Technologies, A division of Sugal &amp; Damani Lottery Agency Pvt. Ltd.
 * All Rights Reserved
 * The contents of this file are the property of Sugal &amp; Damani Lottery Agency Pvt. Ltd.
 * and are subject to a License agreement with Sugal &amp; Damani Lottery Agency Pvt. Ltd.; you may
 * not use this file except in compliance with that License.  You may obtain a
 * copy of that license from:
 * Legal Department
 * Sugal &amp; Damani Lottery Agency Pvt. Ltd.
 * 6/35,WEA, Karol Bagh,
 * New Delhi
 * India - 110005
 * This software is distributed under the License and is provided on an ï¿½AS ISï¿½
 * basis, without warranty of any kind, either express or implied, unless
 * otherwise provided in the License.  See the License for governing rights and
 * limitations under the License.
 */

package com.skilrock.lms.coreEngine.scratchService.pwtMgmt.common;

import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStreamReader;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.TreeMap;

import com.skilrock.lms.beans.ActiveGameBean;
import com.skilrock.lms.beans.OrgBean;
import com.skilrock.lms.beans.PwtBean;
import com.skilrock.lms.beans.TicketBean;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.common.db.TableConstants;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.utility.GameUtilityHelper;
import com.skilrock.lms.common.utility.MD5Encoder;

/**
 * This is a helper class providing methods for handing PWT at BO's end
 * 
 * @author Skilrock Technologies
 * 
 */
<span class="nc" id="L55">public class PwtBOHelperTNV {</span>

	List&lt;ActiveGameBean&gt; activeGameList;
	/**
	 * This method returns a list of the active games
	 * 
	 * @return List
	 * @throws LMSException
	 */
<span class="nc" id="L64">	String receiptNum = null;</span>
<span class="nc" id="L65">	StringBuilder virn = null;</span>

	public List&lt;ActiveGameBean&gt; getActiveGameList() {
<span class="nc" id="L68">		return activeGameList;</span>
	}

	public List getActiveGames() throws LMSException {

<span class="nc" id="L73">		Connection connection = null;</span>
<span class="nc" id="L74">		Statement statement = null;</span>
<span class="nc" id="L75">		ResultSet resultSet = null;</span>
<span class="nc" id="L76">		String delimiter = new String(&quot;-&quot;);</span>

		try {

<span class="nc" id="L80">			ActiveGameBean gameBean = null;</span>
<span class="nc" id="L81">			List&lt;ActiveGameBean&gt; searchResults = new ArrayList&lt;ActiveGameBean&gt;();</span>

<span class="nc" id="L83">			DBConnect dbConnect = new DBConnect();</span>
<span class="nc" id="L84">			connection = dbConnect.getConnection();</span>

<span class="nc" id="L86">			statement = connection.createStatement();</span>

<span class="nc" id="L88">			String query = QueryManager.getST1ActiveGamesQuery();</span>

<span class="nc" id="L90">			resultSet = statement.executeQuery(query);</span>
			int gameNbr;
			String gameName;

<span class="nc bnc" id="L94" title="All 2 branches missed.">			while (resultSet.next()) {</span>

<span class="nc" id="L96">				gameBean = new ActiveGameBean();</span>
<span class="nc" id="L97">				gameBean</span>
						.setGameId(resultSet.getInt(TableConstants.SGM_GAME_ID));
<span class="nc" id="L99">				gameBean.setAgentPwtCommRate(resultSet</span>
						.getDouble(TableConstants.SGM_AGT_PWT_RATE));
<span class="nc" id="L101">				gameNbr = resultSet.getInt(TableConstants.SGM_GAME_NBR);</span>
<span class="nc" id="L102">				gameName = resultSet.getString(TableConstants.SGM_GAME_NAME);</span>
<span class="nc" id="L103">				gameBean.setGameNbr_Name(gameNbr + delimiter + gameName);</span>

<span class="nc" id="L105">				searchResults.add(gameBean);</span>

			}

<span class="nc" id="L109">			return searchResults;</span>

<span class="nc" id="L111">		} catch (SQLException e) {</span>
<span class="nc" id="L112">			e.printStackTrace();</span>
<span class="nc" id="L113">			throw new LMSException(e);</span>
		} finally {

<span class="nc" id="L116">			try {</span>

<span class="nc bnc" id="L118" title="All 4 branches missed.">				if (statement != null) {</span>
<span class="nc" id="L119">					statement.close();</span>
				}
<span class="nc bnc" id="L121" title="All 4 branches missed.">				if (connection != null) {</span>
<span class="nc" id="L122">					connection.close();</span>
				}
<span class="nc" id="L124">			} catch (SQLException se) {</span>
<span class="nc" id="L125">				se.printStackTrace();</span>
<span class="nc" id="L126">			}</span>
		}

		// return null;

	}

	/**
	 * This method returns a list of all agents registered under the BO
	 * 
	 * @return List
	 * @throws LMSException
	 */
	public List getAgents(UserInfoBean userInfo) throws LMSException {

<span class="nc" id="L141">		Connection connection = null;</span>
<span class="nc" id="L142">		PreparedStatement statement = null;</span>
<span class="nc" id="L143">		ResultSet resultSet = null;</span>
<span class="nc" id="L144">		String delimiter = new String(&quot;-&quot;);</span>
<span class="nc" id="L145">		List&lt;OrgBean&gt; searchResults = new ArrayList&lt;OrgBean&gt;();</span>
		try {

<span class="nc" id="L148">			OrgBean agentOrgBean = null;</span>

<span class="nc" id="L150">			DBConnect dbConnect = new DBConnect();</span>
<span class="nc" id="L151">			connection = dbConnect.getConnection();</span>

<span class="nc" id="L153">			String query = QueryManager.getST1AgtOrgQueryPwt();// + &quot; group by</span>
			// name&quot;;
<span class="nc" id="L155">			statement = connection.prepareStatement(query);</span>
<span class="nc" id="L156">			statement.setInt(1, userInfo.getUserOrgId());</span>
<span class="nc" id="L157">			resultSet = statement.executeQuery();</span>

<span class="nc bnc" id="L159" title="All 2 branches missed.">			while (resultSet.next()) {</span>

<span class="nc" id="L161">				agentOrgBean = new OrgBean();</span>
<span class="nc" id="L162">				agentOrgBean.setOrgId(resultSet</span>
						.getInt(TableConstants.SOM_ORG_ID));
<span class="nc" id="L164">				agentOrgBean.setOrgName(resultSet</span>
						.getString(TableConstants.SOM_ORG_NAME));
<span class="nc" id="L166">				agentOrgBean.setUserId(resultSet</span>
						.getInt(TableConstants.SUM_USER_ID));

<span class="nc" id="L169">				searchResults.add(agentOrgBean);</span>

			}

<span class="nc" id="L173">		} catch (SQLException e) {</span>

<span class="nc" id="L175">			e.printStackTrace();</span>
<span class="nc" id="L176">			throw new LMSException(e);</span>
		} finally {

<span class="nc" id="L179">			try {</span>

<span class="nc bnc" id="L181" title="All 4 branches missed.">				if (statement != null) {</span>
<span class="nc" id="L182">					statement.close();</span>
				}
<span class="nc bnc" id="L184" title="All 4 branches missed.">				if (connection != null) {</span>
<span class="nc" id="L185">					connection.close();</span>
				}
<span class="nc" id="L187">			} catch (SQLException se) {</span>
<span class="nc" id="L188">				se.printStackTrace();</span>
<span class="nc" id="L189">			}</span>
<span class="nc" id="L190">		}</span>

<span class="nc" id="L192">		return searchResults;</span>

	}

	private String getEncodedVirnCode(String[] virnCode) {

<span class="nc" id="L198">		StringBuilder encodedVirnCode = new StringBuilder(&quot;&quot;);</span>

<span class="nc bnc" id="L200" title="All 2 branches missed.">		for (String element : virnCode) {</span>

<span class="nc" id="L202">			encodedVirnCode.append(&quot;'&quot;);</span>
<span class="nc" id="L203">			encodedVirnCode.append(MD5Encoder.encode(element));</span>
<span class="nc" id="L204">			encodedVirnCode.append(&quot;'&quot;);</span>
<span class="nc" id="L205">			encodedVirnCode.append(&quot;,&quot;);</span>

		}
<span class="nc" id="L208">		int length = encodedVirnCode.length();</span>
<span class="nc" id="L209">		encodedVirnCode.deleteCharAt(length - 1);</span>

<span class="nc" id="L211">		return encodedVirnCode.toString();</span>
	}

	private String getEncodedTktNbr(String[] tktNbr) {

<span class="nc" id="L216">		StringBuilder encodedVirnCode = new StringBuilder(&quot;&quot;);</span>

<span class="nc bnc" id="L218" title="All 2 branches missed.">		for (String element : tktNbr) {</span>

<span class="nc" id="L220">			encodedVirnCode.append(&quot;'&quot;);</span>
<span class="nc" id="L221">			encodedVirnCode.append(MD5Encoder.encode(element));</span>
<span class="nc" id="L222">			encodedVirnCode.append(&quot;'&quot;);</span>
<span class="nc" id="L223">			encodedVirnCode.append(&quot;,&quot;);</span>

		}
<span class="nc" id="L226">		int length = encodedVirnCode.length();</span>
<span class="nc" id="L227">		encodedVirnCode.deleteCharAt(length - 1);</span>

<span class="nc" id="L229">		return encodedVirnCode.toString();</span>
	}

	// Temporary Receipt ENds
	/**
	 * This method returns the sum of PWT amount for the valid entries
	 * 
	 * @param pwtList
	 * @return double
	 */
	public double getPwtAmount(List&lt;PwtBean&gt; pwtList) {

<span class="nc" id="L241">		double amount = 0.0;</span>

<span class="nc bnc" id="L243" title="All 2 branches missed.">		if (pwtList != null) {</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">			for (PwtBean pwtBean : pwtList) {</span>
<span class="nc bnc" id="L245" title="All 2 branches missed.">				if (pwtBean.getIsValid()) {</span>
<span class="nc" id="L246">					amount += Double.parseDouble(pwtBean.getPwtAmount());</span>
				}
<span class="nc" id="L248">			}</span>
		}
<span class="nc" id="L250">		return amount;</span>
	}

	public String getReceiptNum() {
<span class="nc" id="L254">		return receiptNum;</span>
	}

	/*
	 * //Temporary virn to final receipt
	 * 
	 * private int saveBOPwtTicketsTmpReceipt(List&lt;PwtBean&gt; pwtList, int
	 * gameId, String boOrgName,int userID,int userOrgID,int agentOrgId, int
	 * agtUserId, double agtPwtCommRate,Connection connection, StringBuilder
	 * virn,int gameNbr) throws LMSException{ try{ PreparedStatement masterPstmt =
	 * null; PreparedStatement detailPstmt = null; PreparedStatement invPstmt =
	 * null; PreparedStatement agtGameCommVarPstmt = null;
	 * 
	 * ResultSet resultSet = null; ResultSet resultSetCommVar = null;
	 * 
	 * int trnId = -1;
	 * 
	 * if (pwtList != null) { int size = pwtList.size(); QueryManager
	 * queryManager = null;
	 * 
	 * PwtBean pwtBean = null;
	 * 
	 * String masterQuery = null; String detailQuery = null; String invQuery =
	 * null;
	 * 
	 * String agtGameCommVarQuery=null; double agtGameCommVariance=0.0;
	 * 
	 * double pwtAmt = 0.0; double commAmt = 0.0; double netAmt = 0.0; double
	 * creditAmt = 0.0;
	 * 
	 * if (size &gt; 0) {
	 * 
	 * //added by yogesh to gat agent game commission variance
	 * agtGameCommVarQuery=&quot;select pwt_comm_variance from
	 * st_se_bo_agent_sale_pwt_comm_variance where agent_org_id=? and
	 * game_id=?&quot;;
	 * agtGameCommVarPstmt=connection.prepareStatement(agtGameCommVarQuery);
	 * agtGameCommVarPstmt.setInt(1, agentOrgId); agtGameCommVarPstmt.setInt(2,
	 * gameId); resultSetCommVar=agtGameCommVarPstmt.executeQuery();
	 * while(resultSetCommVar.next()){
	 * agtGameCommVariance=resultSetCommVar.getDouble(&quot;pwt_comm_variance&quot;); }
	 * agtPwtCommRate=agtPwtCommRate+agtGameCommVariance;
	 * 
	 * 
	 * 
	 * 
	 * masterPstmt =
	 * connection.prepareStatement(QueryManager.insertInLMSTransactionMaster());
	 * masterPstmt.setString(1, &quot;AGENT&quot;);
	 * 
	 * 
	 * 
	 * masterPstmt.executeUpdate(); resultSet = masterPstmt.getGeneratedKeys();
	 * if(resultSet.next()) { trnId = resultSet.getInt(1);
	 * System.out.println(&quot;Transaction Id:&quot; + trnId);
	 * 
	 * 
	 * masterQuery = QueryManager.getST1BOMasterQuery(); masterPstmt =
	 * connection.prepareStatement(masterQuery);
	 * 
	 * detailQuery = QueryManager.getST1PwtBODetailQuery(); detailPstmt =
	 * connection.prepareStatement(detailQuery);
	 * 
	 * invQuery = QueryManager.getST1PWTBOUpdateQuery(); invPstmt =
	 * connection.prepareStatement(invQuery);
	 * System.out.println(userOrgID+&quot;--userOrg---userId-&quot;+userID+&quot;-saveBOPwtTicketsTmpReceipt--agtOrgId-***&quot;+agentOrgId);
	 * 
	 * 
	 * 
	 * masterPstmt.setInt(1, trnId); masterPstmt.setString(2, &quot;AGENT&quot;);
	 * masterPstmt.setInt(3, agentOrgId); masterPstmt.setTimestamp(4, new
	 * java.sql.Timestamp(new Date() .getTime())); masterPstmt.setString(5,
	 * &quot;PWT&quot;); masterPstmt.setInt(6,userID); masterPstmt.setInt(7,userOrgID);
	 * 
	 * masterPstmt.executeUpdate();
	 * 
	 * System.out.println(&quot;OrderId::&quot; + trnId);
	 * 
	 * for (int i = 0; i &lt; size; i++) { pwtBean = (PwtBean) pwtList.get(i);
	 * 
	 * if (pwtBean.getIsValid()) {
	 * 
	 * String encodedVirn = pwtBean.getVirnCode(); detailPstmt.setString(1,
	 * encodedVirn); detailPstmt.setInt(2, trnId); detailPstmt.setInt(3,
	 * gameId); detailPstmt.setInt(4, agtUserId); detailPstmt.setInt(5,
	 * agentOrgId);
	 * 
	 * pwtAmt = Double.parseDouble(pwtBean.getPwtAmount()); commAmt = pwtAmt *
	 * agtPwtCommRate * 0.01; netAmt = pwtAmt + commAmt; //for current credit
	 * amt updation creditAmt += netAmt;
	 * 
	 * detailPstmt.setDouble(6, pwtAmt); detailPstmt.setDouble(7, commAmt);
	 * detailPstmt.setDouble(8, netAmt);
	 * 
	 * detailPstmt.execute(); // arun //by yogeh game nbr
	 * GameUtilityHelper.updateNoOfPrizeRem(gameId, pwtAmt, &quot;CLAIM_AGT&quot;,
	 * encodedVirn, connection,gameNbr);
	 * 
	 * invPstmt.setInt(1, gameNbr); invPstmt.setInt(2, gameId);
	 * invPstmt.setString(3, encodedVirn); invPstmt.execute();
	 * virn.append(&quot;'&quot;+encodedVirn+&quot;',&quot;); } }
	 * 
	 * //for current credit amt updation boolean isUpdateDone =
	 * OrgCreditUpdation .updateCreditLimitForAgent(agentOrgId, &quot;PWT&quot;,
	 * creditAmt, connection);
	 * System.out.println(&quot;---saveBOPwtTicketsTmpReceipt--virn-&quot;+virn); } } }
	 * 
	 * return trnId; }catch(SQLException sqle){ throw new LMSException(sqle); } }
	 * 
	 */

	/*
	 * public List&lt;PwtBean&gt; saveBOPwtTicketsDataTmpReceipt(String boOrgName,int
	 * userID,int userOrgID,OrgBean agtOrgBean, List&lt;ActiveGameBean&gt;
	 * activeGameList,String rootPath,double HighPrizeAmount,String
	 * highPrizeCriteria, List verifiedData, String receiptNum) throws
	 * LMSException{
	 * 
	 * 
	 * setReceiptNum(receiptNum); setActiveGameList(activeGameList); virn = new
	 * StringBuilder(); Connection connection = null; boolean isCommitable =
	 * false; List&lt;PwtBean&gt; pwtCompleteReceiptList= new ArrayList&lt;PwtBean&gt;();
	 * 
	 * PreparedStatement boReceiptPstmt = null; PreparedStatement
	 * boReceiptMappingPstmt = null; String boReceiptQuery = null; String
	 * boReceiptMappingQuery = null;
	 * 
	 * 
	 * int boReceiptId = -1;
	 * 
	 * double agtPwtCommRate = 0.0; int gameNbr=0;;
	 * 
	 * ActiveGameBean activeGameBean = null;
	 * 
	 * 
	 * int agentOrgId = agtOrgBean.getOrgId(); int agtUserId =
	 * agtOrgBean.getUserId();
	 * 
	 * System.out.println(agtOrgBean.getOrgName()+&quot;-saveBOPwtTicketsDataTmpReceipt--agtOrgId-**&quot;+agentOrgId);
	 * try{ DBConnect dbConnect = new DBConnect(); connection =
	 * dbConnect.getConnection(); connection.setAutoCommit(false);
	 * 
	 * 
	 * 
	 * 
	 * List transactionId = new ArrayList(); String receiptArr=null;
	 * 
	 * Map gameVirnCode = (Map)verifiedData.get(1); PwtBean pwtBean = null; int
	 * game_id = 0; Iterator itVirn = gameVirnCode.entrySet().iterator(); while
	 * (itVirn.hasNext()) { List&lt;PwtBean&gt; pwtList= new ArrayList&lt;PwtBean&gt;();
	 * Map.Entry pairsVirn = (Map.Entry)itVirn.next();
	 * game_id=(Integer)pairsVirn.getKey(); System.out.println(&quot;VIRN
	 * Map--game_id&quot;+game_id); List virnList = (List)pairsVirn.getValue();
	 * if(!virnList.isEmpty()){ String[] virnArray =
	 * (String[])virnList.toArray(new String[virnList.size()]);
	 * 
	 * 
	 * for(int i=0; i&lt;virnArray.length; i++){ if(virnArray[i]!=null &amp;&amp;
	 * !virnArray[i].trim().equals(&quot;&quot;)){ pwtBean= new PwtBean();
	 * pwtBean.setVirnCode(virnArray[i]); pwtBean.setValid(true);
	 * pwtList.add(pwtBean); } }
	 * 
	 * if (activeGameList != null) { for (int i = 0; i &lt; activeGameList.size();
	 * i++) { activeGameBean = activeGameList.get(i); if
	 * (game_id==activeGameBean.getGameId()) { agtPwtCommRate =
	 * activeGameBean.getAgentPwtCommRate();
	 * gameNbr=Integer.parseInt(activeGameBean.getGameNbr_Name().split(&quot;-&quot;)[0]);
	 * break; } } }
	 * 
	 * //pwt verification not need to be done here so remove it
	 * 
	 * CommonFunctionsHelper commonHelper=new CommonFunctionsHelper(); boolean
	 * isVerified = verifyPwtTicketsTmpReceipt(game_id, virnArray,
	 * pwtList,HighPrizeAmount,highPrizeCriteria,gameNbr);
	 * 
	 * //at tje time of payment for unclaimed virn account update if
	 * (isVerified) { int transactionID = saveBOPwtTicketsTmpReceipt(pwtList,
	 * game_id,boOrgName,userID,userOrgID, agentOrgId,
	 * agtUserId,agtPwtCommRate,connection,virn,gameNbr);
	 * receiptArr=commonHelper.boEndAgtPWTPaymentProcess(pwtList, game_id,
	 * boOrgName, userOrgID, agentOrgId, agtUserId, rootPath, userID, gameNbr);
	 * if(transactionID!=0 &amp;&amp; transactionID!=-1)
	 * transactionId.add(transactionID);
	 * 
	 * pwtCompleteReceiptList.addAll(pwtList); } } }
	 * 
	 * 
	 * System.out.println(&quot;---List of Tx Id--&quot;+transactionId);
	 * System.out.println(&quot;---virn-&quot;+virn); //get auto generated reciept number
	 * 
	 * if(receiptArr!=null){
	 * 
	 * String generatedReceiptNumber =
	 * commonHelper.generateReceiptBo(connection, agentOrgId, &quot;AGENT&quot;,
	 * transactionId); if(generatedReceiptNumber!=null) isCommitable=true;
	 * boReceiptId=Integer.parseInt(receiptArr.split(&quot;-&quot;)[0]); PreparedStatement
	 * autoGenRecptPstmtBO = null; // String getLatestRecieptNumberBO=&quot;SELECT *
	 * from st_bo_receipt_gen_mapping where receipt_type=? ORDER BY generated_id
	 * DESC LIMIT 1 &quot;;
	 * autoGenRecptPstmtBO=connection.prepareStatement(QueryManager.getBOLatestReceiptNb());
	 * autoGenRecptPstmtBO.setString(1,&quot;RECEIPT&quot;); ResultSet
	 * recieptRsBO=autoGenRecptPstmtBO.executeQuery(); String
	 * lastRecieptNoGeneratedBO=null;
	 * 
	 * while(recieptRsBO.next()){
	 * lastRecieptNoGeneratedBO=recieptRsBO.getString(&quot;generated_id&quot;); }
	 * 
	 * String autoGeneRecieptNoBO=GenerateRecieptNo.getRecieptNo(&quot;RECEIPT&quot;,
	 * lastRecieptNoGeneratedBO,&quot;BO&quot;); // for generating
	 * receipt********************
	 * 
	 * boReceiptPstmt=connection.prepareStatement(QueryManager.insertInReceiptMaster());
	 * boReceiptPstmt.setString(1,&quot;BO&quot;); boReceiptPstmt.executeUpdate();
	 * 
	 * ResultSet boRSet = boReceiptPstmt.getGeneratedKeys(); while
	 * (boRSet.next()) { boReceiptId = boRSet.getInt(1); System.out.println(&quot;BO
	 * Receipt Id:&quot; + boReceiptId); }
	 * 
	 * boReceiptQuery = QueryManager.insertInBOReceipts(); boReceiptPstmt =
	 * connection.prepareStatement(boReceiptQuery);
	 * 
	 * boReceiptPstmt.setInt(1, boReceiptId); boReceiptPstmt.setString(2,
	 * &quot;RECEIPT&quot;); boReceiptPstmt.setInt(3, agentOrgId);
	 * boReceiptPstmt.setString(4,&quot;AGENT&quot;);
	 * boReceiptPstmt.setString(5,autoGeneRecieptNoBO);
	 * 
	 * //boReceiptPstmt.setString(1, autoGeneRecieptNoBO);
	 * boReceiptPstmt.setString(1, &quot;RECEIPT&quot;); boReceiptPstmt.setInt(2,
	 * agentOrgId);
	 * 
	 * boReceiptPstmt.execute();
	 * 
	 * 
	 * 
	 * for (int trx=0 ;trx&lt;transactionId.size();trx++){ int transId =
	 * (Integer)transactionId.get(trx); if(transId!=0||transId!=-1){
	 * boReceiptMappingQuery = QueryManager.insertBOReceiptTrnMapping();
	 * boReceiptMappingPstmt =
	 * connection.prepareStatement(boReceiptMappingQuery);
	 * 
	 * boReceiptMappingPstmt.setInt(1, boReceiptId);
	 * boReceiptMappingPstmt.setInt(2,transId); boReceiptMappingPstmt.execute();
	 * isCommitable =true; } }
	 * 
	 * //insert into receipt gen reciept mapping
	 * 
	 * if(isCommitable){ String
	 * updateBoRecieptGenMapping=QueryManager.updateST5BOReceiptGenMapping();
	 * boReceiptGenMappingPstmt=connection.prepareStatement(updateBoRecieptGenMapping);
	 * boReceiptGenMappingPstmt.setInt(1,boReceiptId);
	 * boReceiptGenMappingPstmt.setString(2,autoGeneRecieptNoBO);
	 * boReceiptGenMappingPstmt.setString(3,&quot;RECEIPT&quot;);
	 * boReceiptGenMappingPstmt.executeUpdate();
	 * 
	 * 
	 * 
	 * 
	 * //******************************************* virn.append(&quot;''&quot;);
	 * verifiedData.add(virn);
	 * System.out.println(&quot;---verifiedData-&quot;+verifiedData);
	 * 
	 * 
	 * //*************************************** //Temporary receipt tables
	 * entries
	 * updateTempReceiptTables(verifiedData,boReceiptId+&quot;&quot;,connection,userID,userOrgID);
	 * 
	 * 
	 * //*************************************** //Entries in pwt Table
	 * equivalent to PwtTicketHelper.saveTicketsData(game_id,VerifyTicketList)
	 * List&lt;TicketBean&gt; VerifyTicketList = new ArrayList&lt;TicketBean&gt;(); int
	 * game_id_tk =0; PwtTicketHelper pwtTicketHelper = new PwtTicketHelper();
	 * System.out.println(&quot;Ticket Map--&quot;+verifiedData.get(2)); Map gameTickNum =
	 * (HashMap)verifiedData.get(2); Iterator it =
	 * gameTickNum.entrySet().iterator(); while (it.hasNext()) { Map.Entry pairs =
	 * (Map.Entry)it.next(); game_id_tk=(Integer)pairs.getKey();
	 * VerifyTicketList = pwtTicketHelper.getVerifiedTickets((List&lt;TicketBean&gt;)pairs.getValue(),game_id_tk,gameNbr);
	 * VerifyTicketList =
	 * pwtTicketHelper.getGameWiseVerifiedTickets(ticketListString, gameNbr);
	 * saveTicketsData(game_id_tk,VerifyTicketList,connection); }
	 * 
	 * 
	 * 
	 * connection.commit(); if (boReceiptId &gt; -1) { GraphReportHelper
	 * graphReportHelper = new GraphReportHelper();
	 * graphReportHelper.createTextReportBO(boReceiptId,boOrgName,userOrgID,rootPath); }
	 * 
	 * }else{ throw new LMSException(&quot;There are no Valid Transaction done for
	 * these specified PWT&quot;); } } } catch (SQLException e) { try {
	 * connection.rollback(); } catch (SQLException e1) { // TODO Auto-generated
	 * catch block e1.printStackTrace(); } e.printStackTrace(); throw new
	 * LMSException(e); } finally {
	 * 
	 * try {
	 * 
	 * if (connection != null) { connection.close(); } } catch (SQLException se) {
	 * se.printStackTrace(); } }
	 * 
	 * return pwtCompleteReceiptList; }
	 */

	/*
	 * private boolean verifyPwtTicketsTmpReceipt(int gameId, String[] virnCode,
	 * List&lt;PwtBean&gt; pwtList,double HighPrizeAmount,String
	 * highPrizeCriteria,int gameNbr) throws LMSException {
	 * System.out.println(&quot;verify fumction called &quot;); String encodedVirnCode =
	 * getEncodedVirnCodeTmpReceipt(virnCode); System.out.println(&quot;---((((((::&quot; +
	 * encodedVirnCode);
	 * 
	 * Connection connection = null; Statement statement = null; Statement
	 * statement2 = null; Statement statement3 = null;
	 * 
	 * ResultSet resultSet = null; ResultSet resultSet2 = null; ResultSet
	 * resultSet3 = null;
	 * 
	 * 
	 * 
	 * boolean isVerified = false; //int orderId = -1;
	 * 
	 * if (pwtList != null) { int size = pwtList.size();
	 * 
	 * PwtBean pwtBean = null;
	 * 
	 * StringBuffer query = new StringBuffer();
	 * 
	 * if (size &gt; 0) { try { DBConnect dbConnect = new DBConnect(); connection =
	 * dbConnect.getConnection();
	 * 
	 * statement = connection.createStatement();
	 * query.append(QueryManager.getST1PWTBOCheckQuery()); query.append(&quot;
	 * st_se_pwt_inv_&quot;+gameNbr+&quot; where &quot;); query.append(&quot; game_id = &quot;);
	 * query.append(&quot;&quot; + gameId); query.append(&quot; and virn_code in (&quot;);
	 * query.append(encodedVirnCode); query.append(&quot;)&quot;);
	 * 
	 * System.out.println(&quot;GameId:&quot; + gameId); System.out.println(&quot;Query:: &quot; +
	 * query); resultSet = statement.executeQuery(query.toString());
	 * System.out.println(&quot;ResultSet:&quot; + resultSet + &quot;---&quot; +
	 * resultSet.getFetchSize());
	 * 
	 * String vCode = null; String pwtAmount = null; String enVirnCode = null;
	 * String prizeLevel = null; String prizeStatus=null;
	 * 
	 * while (resultSet.next()) {
	 * 
	 * vCode = resultSet .getString(TableConstants.SPI_VIRN_CODE);
	 * System.out.println(&quot;Vcode:&quot; + vCode); pwtAmount = resultSet
	 * .getString(TableConstants.SPI_PWT_AMT); prizeLevel = resultSet
	 * .getString(TableConstants.SPI_PRIZE_LEVEL);
	 * prizeStatus=resultSet.getString(&quot;status&quot;);
	 * 
	 * for (int j = 0; j &lt; pwtList.size(); j++) {
	 * 
	 * pwtBean = (PwtBean) pwtList.get(j); enVirnCode = pwtBean.getVirnCode();
	 * //System.out.println(&quot;for loop running &quot; + j+ &quot; times &quot; +
	 * pwtBean.getVirnCode()); // check for entry into temp table
	 * 
	 * if(enVirnCode.equals(vCode)) { if
	 * (prizeStatus.equalsIgnoreCase(&quot;CLAIM_RET&quot;)) { if
	 * (enVirnCode.equals(vCode)) {
	 * 
	 * isVerified = true; pwtBean.setValid(true);
	 * pwtBean.setPwtAmount(pwtAmount); pwtBean.setMessage(&quot;Credited to
	 * Concerned Party&quot;); pwtBean.setMessageCode(&quot;111001&quot;); } break; }else if
	 * (prizeStatus.equalsIgnoreCase(&quot;CLAIM_AGT_TEMP&quot;)) { if
	 * (enVirnCode.equals(vCode)) { isVerified = true; pwtBean.setValid(true);
	 * pwtBean.setPwtAmount(pwtAmount); pwtBean.setMessage(&quot;AAlready Verified in
	 * Bulk Receipt at BO, Fianl Payment Pending&quot;);
	 * pwtBean.setMessageCode(&quot;112001&quot;); } break; } else if
	 * (prizeStatus.equalsIgnoreCase(&quot;CLAIM_RET_AGT_TEMP&quot;)) { if
	 * (enVirnCode.equals(vCode)) { isVerified = true; pwtBean.setValid(true);
	 * pwtBean.setPwtAmount(pwtAmount); pwtBean.setMessage(&quot;Already Verified in
	 * Bulk Receipt at BO, Fianl Payment Pending&quot;);
	 * pwtBean.setMessageCode(&quot;112001&quot;); } break; } else if (prizeStatus
	 * .equalsIgnoreCase(&quot;CLAIM_AGT&quot;)) { if (enVirnCode.equals(vCode)) {
	 * 
	 * String orgname=null; statement2=connection.createStatement(); String
	 * agtDetailsQuery=&quot;select name from st_lms_organization_master where
	 * organization_id in (select agent_org_id from st_se_bo_pwt where
	 * virn_code='&quot;+enVirnCode+&quot;' and game_id=&quot;+gameId+&quot;)&quot;;
	 * System.out.println(&quot;query for get org name &quot; + agtDetailsQuery);
	 * resultSet2=statement2.executeQuery(agtDetailsQuery);
	 * while(resultSet2.next()){ orgname= resultSet2.getString(&quot;name&quot;); }
	 * pwtBean.setValid(false); //pwtBean.setMessage(&quot;This Ticket has been paid
	 * to Agent:: &quot; + orgname); pwtBean.setMessage(&quot;Already Paid to Agent[&quot; +
	 * orgname+&quot;]&quot;); pwtBean.setMessageCode(&quot;112003&quot;); } break; }else if
	 * (prizeStatus .equalsIgnoreCase(&quot;CLAIM_PLR_TEMP&quot;)){ if
	 * (enVirnCode.equals(vCode)) { isVerified = true; pwtBean.setValid(true);
	 * pwtBean.setPwtAmount(pwtAmount); pwtBean.setMessage(&quot;Already in Process
	 * for Direct Player PWT,Payment/Approval Pending&quot;);
	 * pwtBean.setMessageCode(&quot;112004&quot;); } break; }else if(prizeStatus
	 * .equalsIgnoreCase(&quot;CLAIM_PLR&quot;)){ if (enVirnCode.equals(vCode)) {
	 * 
	 * String playerFirstName=null; String playerLastName=null; String
	 * playercity=null; statement3=connection.createStatement(); String
	 * plrDetailsQuery=&quot;select first_name,last_name,city from
	 * st_lms_player_master where player_id in (select player_id from
	 * st_se_direct_player_pwt where virn_code='&quot;+enVirnCode+&quot;' and
	 * game_id=&quot;+gameId+&quot;)&quot;; System.out.println(&quot;query for get player name &quot; +
	 * plrDetailsQuery); resultSet3=statement3.executeQuery(plrDetailsQuery);
	 * while(resultSet3.next()){ playerFirstName=
	 * resultSet3.getString(&quot;first_name&quot;); playerLastName=
	 * resultSet3.getString(&quot;last_name&quot;); playercity=
	 * resultSet3.getString(&quot;city&quot;); } pwtBean.setValid(false);
	 * //pwtBean.setMessage(&quot;This Ticket has been paid to Player::
	 * &quot;+playerFirstName+&quot; &quot;+playerLastName+ &quot; &quot; +playercity);
	 * pwtBean.setMessage(&quot;Already Paid as Direct Player PWT to Player:
	 * &quot;+playerFirstName+&quot; &quot;+playerLastName+ &quot; &quot; +playercity);
	 * pwtBean.setMessageCode(&quot;112005&quot;); }
	 * 
	 * break; }else if(prizeStatus .equalsIgnoreCase(&quot;CLAIM_PLR_RET&quot;)){ if
	 * (enVirnCode.equals(vCode)) { pwtBean.setValid(false);
	 * pwtBean.setMessage(&quot;This Ticket has been paid to Player but not claimed
	 * by retailer &quot;); }
	 * 
	 * break; }else if(prizeStatus .equalsIgnoreCase(&quot;CLAIM_RET_TEMP&quot;)){ if
	 * (enVirnCode.equals(vCode)) { pwtBean.setValid(false);
	 * //pwtBean.setMessage(&quot;This Ticket is in process between Retailer and
	 * Agent &quot;); pwtBean.setMessage(&quot;Already Verified in Bulk Receipt at
	 * Agent,Final Payment Pending&quot;); pwtBean.setMessageCode(&quot;112006&quot;); } break;
	 * }else if(prizeStatus .equalsIgnoreCase(&quot;CLAIM_PLR_RET_TEMP&quot;)){ if
	 * (enVirnCode.equals(vCode)) { pwtBean.setValid(false);
	 * //pwtBean.setMessage(&quot;This Ticket is in process between Retailer and
	 * Agent &quot;); pwtBean.setMessage(&quot;Already Verified in Bulk Receipt at
	 * Agent,Final Payment Pending&quot;); pwtBean.setMessageCode(&quot;112007&quot;); } break;
	 * }else if(prizeStatus.equalsIgnoreCase(&quot;UNCLM_PWT&quot;)){ if
	 * (enVirnCode.equals(vCode)) {
	 * 
	 * if ((highPrizeCriteria.equals(&quot;level&quot;) &amp;&amp; prizeLevel.equals(&quot;HIGH&quot;)) ||
	 * (highPrizeCriteria.equals(&quot;amt&quot;) &amp;&amp;
	 * (Double.parseDouble(pwtAmount)&gt;=HighPrizeAmount))) {
	 * System.out.println(&quot;inside high prize&quot;); System.out.println(&quot;criteria is &quot; +
	 * highPrizeCriteria); pwtBean.setHighLevel(true); pwtBean.setValid(false);
	 * //pwtBean.setMessage(&quot;This ticket is high prize ticket so please go for
	 * direct player PWT&quot;); pwtBean.setMessage(&quot;High prize VIRN can't be Paid to
	 * Agent.It is to be paid as Direct Player PWT&quot;);
	 * pwtBean.setMessageCode(&quot;112008&quot;); }else{ isVerified = true;
	 * pwtBean.setValid(true); pwtBean.setPwtAmount(pwtAmount);
	 * //pwtBean.setMessage(&quot;This ticket is valid and should be paid to Agent&quot;);
	 * pwtBean.setMessage(&quot;Credited to Concerned Party&quot;);
	 * pwtBean.setMessageCode(&quot;111002&quot;); } }
	 * 
	 * break; }else if(prizeStatus.equalsIgnoreCase(&quot;UNCLM_CANCELLED&quot;)){ if
	 * (enVirnCode.equals(vCode)) {
	 * 
	 * if ((highPrizeCriteria.equals(&quot;level&quot;) &amp;&amp; prizeLevel.equals(&quot;HIGH&quot;)) ||
	 * (highPrizeCriteria.equals(&quot;amt&quot;) &amp;&amp;
	 * (Double.parseDouble(pwtAmount)&gt;=HighPrizeAmount))) {
	 * System.out.println(&quot;inside high prize&quot;); System.out.println(&quot;criteria is &quot; +
	 * highPrizeCriteria); pwtBean.setHighLevel(true); pwtBean.setValid(false);
	 * //pwtBean.setMessage(&quot;This ticket is high prize ticket so please go for
	 * direct player PWT&quot;); pwtBean.setMessage(&quot;High prize VIRN can't be paid to
	 * Agent.It is to be paid as Direct Player PWT&quot;);
	 * pwtBean.setMessageCode(&quot;112011&quot;); }else{ isVerified = true;
	 * pwtBean.setValid(true); pwtBean.setPwtAmount(pwtAmount);
	 * //pwtBean.setMessage(&quot;This ticket is valid and hs been cancelled by BO so
	 * please check it&quot;); pwtBean.setMessage(&quot;Credited to Concerned Party&quot;);
	 * pwtBean.setMessageCode(&quot;111003&quot;); } } break; } else if(prizeStatus
	 * .equalsIgnoreCase(&quot;CANCELLED_PERMANENT&quot;)){ if (enVirnCode.equals(vCode)) {
	 * pwtBean.setValid(false); pwtBean.setMessage(&quot;Tampered/Damaged/Defaced
	 * VIRN as noted at BO&quot;); pwtBean.setMessageCode(&quot;112009&quot;); } break; } } } } }
	 * catch (SQLException e) {
	 * 
	 * e.printStackTrace(); throw new LMSException(e); } finally {
	 * 
	 * try {
	 * 
	 * if (statement != null) { statement.close(); } if (connection != null) {
	 * connection.close(); } } catch (SQLException se) { se.printStackTrace(); } } } }
	 * return isVerified; }
	 */

	/*
	 * private String getEncodedVirnCodeTmpReceipt(String[] virnCode) {
	 * 
	 * StringBuffer encodedVirnCode = new StringBuffer(&quot;&quot;);
	 * 
	 * for (int i = 0; i &lt; virnCode.length; i++) {
	 * 
	 * encodedVirnCode.append(&quot;'&quot;); encodedVirnCode.append(virnCode[i]);
	 * encodedVirnCode.append(&quot;'&quot;); encodedVirnCode.append(&quot;,&quot;); } int length =
	 * encodedVirnCode.length(); encodedVirnCode.deleteCharAt(length - 1);
	 * 
	 * return encodedVirnCode.toString(); }
	 */

	public Map getVirnList(String[] virnCode, String virnFile)
			throws LMSException {
<span class="nc" id="L740">		Map map = new TreeMap();</span>
<span class="nc" id="L741">		List&lt;PwtBean&gt; pwtList = new ArrayList&lt;PwtBean&gt;();</span>
<span class="nc" id="L742">		PwtBean pwtBean = null;</span>
<span class="nc" id="L743">		List&lt;String&gt; virnStringList = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L744">		List&lt;PwtBean&gt; duplicateVirnList = new ArrayList&lt;PwtBean&gt;();</span>
<span class="nc bnc" id="L745" title="All 2 branches missed.">		for (int i = 0; i &lt; virnCode.length; i++) {</span>
<span class="nc bnc" id="L746" title="All 4 branches missed.">			if (virnCode[i] != null &amp;&amp; !virnCode[i].trim().equals(&quot;&quot;)) {</span>
<span class="nc bnc" id="L747" title="All 2 branches missed.">				if (virnStringList.contains(virnCode[i].trim())) {</span>
<span class="nc" id="L748">					pwtBean = new PwtBean();</span>
<span class="nc" id="L749">					pwtBean.setVirnCode(virnCode[i].trim());</span>
<span class="nc" id="L750">					pwtBean.setValid(false);</span>
<span class="nc" id="L751">					pwtBean.setVerificationStatus(&quot;InValid VIRN&quot;);</span>
<span class="nc" id="L752">					pwtBean.setMessage(&quot;Duplicate Virn Entry in File&quot;);</span>
<span class="nc" id="L753">					pwtBean.setMessageCode(&quot;112013&quot;);</span>
<span class="nc" id="L754">					duplicateVirnList.add(pwtBean);</span>

				} else {
<span class="nc" id="L757">					virnStringList.add(virnCode[i].trim());</span>
				}
			}
		}
		// code added here by yogesh to read virn from text file also
		try {
<span class="nc" id="L763">			InputStreamReader fileStreamReader = new InputStreamReader(</span>
					new FileInputStream(virnFile));
<span class="nc" id="L765">			BufferedReader br = new BufferedReader(fileStreamReader);</span>
<span class="nc" id="L766">			String strVirnLine = null;</span>
<span class="nc" id="L767">			int fileVirnLimit = 0;</span>
<span class="nc bnc" id="L768" title="All 2 branches missed.">			while ((strVirnLine = br.readLine()) != null) {</span>
<span class="nc bnc" id="L769" title="All 2 branches missed.">				if (&quot;&quot;.equals(strVirnLine.trim())) {</span>
<span class="nc" id="L770">					continue;</span>
				}
<span class="nc bnc" id="L772" title="All 2 branches missed.">				if (fileVirnLimit &gt; 5000) {</span>
<span class="nc" id="L773">					map.put(&quot;error&quot;, &quot;Data In File Exceeds limit &quot;);</span>
<span class="nc" id="L774">					return map;</span>
				}
<span class="nc bnc" id="L776" title="All 2 branches missed.">				if (virnStringList.contains(strVirnLine.trim())) {</span>
<span class="nc" id="L777">					pwtBean = new PwtBean();</span>
<span class="nc" id="L778">					pwtBean.setVirnCode(strVirnLine.trim());</span>
<span class="nc" id="L779">					pwtBean.setValid(false);</span>
<span class="nc" id="L780">					pwtBean</span>
							.setVerificationStatus(&quot;Duplicate Virn Entry in File&quot;);
<span class="nc" id="L782">					pwtBean.setMessage(&quot;InValid VIRN&quot;);</span>
<span class="nc" id="L783">					pwtBean.setMessageCode(&quot;112013&quot;);</span>
<span class="nc" id="L784">					duplicateVirnList.add(pwtBean);</span>
				} else {
<span class="nc" id="L786">					virnStringList.add(strVirnLine.trim());</span>
				}
<span class="nc" id="L788">				fileVirnLimit++;</span>

			}

<span class="nc" id="L792">		} catch (FileNotFoundException fe) {</span>
			// fe.printStackTrace();
			// throw new LMSException(&quot;file not found exception&quot;,fe);
<span class="nc" id="L795">		} catch (IOException ioe) {</span>
<span class="nc" id="L796">			ioe.printStackTrace();</span>
<span class="nc" id="L797">		}</span>
<span class="nc" id="L798">		map.put(&quot;duplicateVirnList&quot;, duplicateVirnList);</span>
<span class="nc" id="L799">		map.put(&quot;virnStringList&quot;, virnStringList);</span>
<span class="nc" id="L800">		return map;</span>

	}

	public String saveBOPwtTicketsData(String gameNbr_Name, String boOrgName,
			int userOrgID, String agtOrgName, List&lt;OrgBean&gt; agtOrgList,
			List&lt;ActiveGameBean&gt; activeGameList, String[] virnCode,
			List&lt;PwtBean&gt; pwtList, String rootPath, double HighPrizeAmount,
			String highPrizeCriteria, int userId, String enc_scheme_type,
			String pwt_verification_type) throws LMSException {

<span class="nc" id="L811">		int gameId = -1;</span>
<span class="nc" id="L812">		int gameNbr = 0;</span>
<span class="nc" id="L813">		String autoGeneratedReceiptNumber = null;</span>
		// double agtPwtCommRate = 0.0;

<span class="nc" id="L816">		ActiveGameBean activeGameBean = null;</span>
<span class="nc" id="L817">		OrgBean agtOrgBean = null;</span>

		// we appending game id with gameId-gameNbr-Name on JSP
<span class="nc bnc" id="L820" title="All 2 branches missed.">		if (activeGameList != null) {</span>
<span class="nc bnc" id="L821" title="All 2 branches missed.">			for (int i = 0; i &lt; activeGameList.size(); i++) {</span>
<span class="nc" id="L822">				activeGameBean = activeGameList.get(i);</span>
<span class="nc bnc" id="L823" title="All 2 branches missed.">				if (gameNbr_Name.equals(activeGameBean.getGameNbr_Name())) {</span>
<span class="nc" id="L824">					gameId = activeGameBean.getGameId();</span>
					// agtPwtCommRate = activeGameBean.getAgentPwtCommRate();
<span class="nc" id="L826">					break;</span>

				}
			}
		}

<span class="nc" id="L832">		int agtOrgId = -1;</span>
<span class="nc" id="L833">		int agtUserId = -1;</span>
		// get the AGENT org id from JSP
<span class="nc bnc" id="L835" title="All 2 branches missed.">		if (agtOrgList != null) {</span>
<span class="nc bnc" id="L836" title="All 2 branches missed.">			for (int i = 0; i &lt; agtOrgList.size(); i++) {</span>
<span class="nc" id="L837">				agtOrgBean = agtOrgList.get(i);</span>
<span class="nc bnc" id="L838" title="All 2 branches missed.">				if (agtOrgName.equals(agtOrgBean.getOrgName())) {</span>
<span class="nc" id="L839">					agtOrgId = agtOrgBean.getOrgId();</span>
<span class="nc" id="L840">					agtUserId = agtOrgBean.getUserId();</span>
<span class="nc" id="L841">					break;</span>

				}
			}
		}
<span class="nc" id="L846">		 String[] tktNbr=new String[pwtList.size()];</span>
		// get game nbr from game name number
<span class="nc" id="L848">		String[] gameNameNbrArr = gameNbr_Name.split(&quot;-&quot;);</span>
<span class="nc" id="L849">		gameNbr = Integer.parseInt(gameNameNbrArr[0]);</span>
		try {
<span class="nc" id="L851">			DBConnect dbConnect = new DBConnect();</span>
<span class="nc" id="L852">			Connection connection = dbConnect.getConnection();</span>
<span class="nc" id="L853">			connection.setAutoCommit(false);</span>
<span class="nc" id="L854">			CommonFunctionsHelper commHelper = new CommonFunctionsHelper();</span>
			// verify the ticket list here
<span class="nc" id="L856">			PwtBean pwtBean = null;</span>
<span class="nc bnc" id="L857" title="All 2 branches missed.">			for (int i = 0; i &lt; pwtList.size(); i++) {</span>
<span class="nc" id="L858">				pwtBean = pwtList.get(i);</span>

<span class="nc" id="L860">				pwtBean.setMessage(&quot;Invalid Virn&quot;);</span>
<span class="nc" id="L861">				pwtBean.setVerificationStatus(&quot;InValid VIRN&quot;);</span>

				// check the format of these tickets
				// CommonFunctionsHelper commHelper = new
				// CommonFunctionsHelper();
				TicketBean tktBean;

<span class="nc" id="L868">				tktBean = commHelper.isTicketFormatValid(pwtBean</span>
						.getTicketNumber(), gameId, connection);

<span class="nc" id="L871">				BOPwtProcessHelper boPwtHelper = new BOPwtProcessHelper();</span>
<span class="nc" id="L872">				String tktNbrArr[] = null;</span>
				// TicketBean bean = null;

<span class="nc bnc" id="L875" title="All 2 branches missed.">				if (tktBean.getIsValid()) {</span>
<span class="nc" id="L876">					tktNbrArr = tktBean.getTicketNumber().split(&quot;-&quot;);</span>
<span class="nc" id="L877">					tktBean = boPwtHelper.checkTicketStatus(gameNbr + &quot;&quot;,</span>
							tktNbrArr[0] + &quot;-&quot; + tktNbrArr[1], tktNbrArr[2],
							gameId, connection, false);
				}
<span class="nc" id="L881">				tktNbr[i] = tktBean.getTicketNumber();</span>
<span class="nc" id="L882">				pwtBean.setTicketNumber(tktBean.getTicketNumber());</span>
<span class="nc" id="L883">				pwtBean.setTicketValid(tktBean.getIsValid());</span>
<span class="nc" id="L884">				pwtBean.setTicketMessage(tktBean.getStatus());</span>
<span class="nc" id="L885">				pwtBean.setTicketVerificationStatus(tktBean.getValidity());</span>
<span class="nc" id="L886">				pwtBean.setUpdateTicketType(tktBean.getUpdateTicketType());</span>
<span class="nc" id="L887">				pwtBean.setBookNumber(tktBean.getBook_nbr());</span>
<span class="nc" id="L888">				pwtBean.setBookStatus(tktBean.getBookStatus());</span>

			}

<span class="nc" id="L892">			boolean isVerified = verifyPwtTickets(gameId, virnCode, pwtList,</span>
					HighPrizeAmount, highPrizeCriteria, gameNbr, agtOrgId,
					connection,tktNbr);

			// updtae ticket status here by paasing teh same connection to the
			// pwt payments as well

<span class="nc bnc" id="L899" title="All 2 branches missed.">			for (int i = 0; i &lt; pwtList.size(); i++) {</span>
<span class="nc" id="L900">				pwtBean = pwtList.get(i);</span>

				// if both the ticket and virn are valid then update the ticket
				// status
<span class="nc bnc" id="L904" title="All 4 branches missed.">				if (pwtBean.isTicketValid() &amp;&amp; pwtBean.getIsValid()) {</span>

<span class="nc" id="L906">					commHelper.updateTicketInvTable(pwtBean.getTicketNumber(),</span>
							pwtBean.getBookNumber(), gameNbr, gameId,
							&quot;CLAIM_AGT&quot;, userId, userOrgID, pwtBean
									.getUpdateTicketType(), agtOrgId, &quot;RETAIL&quot;,
							&quot;WEB&quot;, connection);

					// update book status from active to claimed in table
					// st_se_game_inv_status table here
<span class="nc bnc" id="L914" title="All 2 branches missed.">					if (&quot;ACTIVE&quot;.equalsIgnoreCase(pwtBean.getBookStatus())) {</span>
<span class="nc" id="L915">						commHelper.updateBookStatus(gameId, pwtBean</span>
								.getBookNumber(), connection, &quot;CLAIMED&quot;);
					}

				}

			}

<span class="nc bnc" id="L923" title="All 2 branches missed.">			if (isVerified) {</span>
				/*
				 * saveBOPwtTickets(pwtList, gameId,boOrgName, userOrgID,
				 * agtOrgId, agtUserId, rootPath,userId,gameNbr);
				 */
<span class="nc" id="L928">				CommonFunctionsHelper commonHelper = new CommonFunctionsHelper();</span>
<span class="nc" id="L929">				autoGeneratedReceiptNumber = commonHelper</span>
						.boEndAgtPWTPaymentProcess(pwtList, gameId, boOrgName,
								userOrgID, agtOrgId, agtUserId, rootPath,
								userId, gameNbr, connection);
				// connection.commit();
			}
<span class="nc" id="L935">		} catch (SQLException e) {</span>
<span class="nc" id="L936">			e.printStackTrace();</span>
<span class="nc" id="L937">		}</span>
<span class="nc" id="L938">		return autoGeneratedReceiptNumber;</span>

	}

	private void saveTmpPwtVirn(List&lt;PwtBean&gt; pwtList, int gameId,
			String receiptId, int agtUserId, int agtOrgId, int gameNbr)
			throws LMSException {

<span class="nc" id="L946">		Connection connection = null;</span>
<span class="nc" id="L947">		PreparedStatement detailPstmt = null;</span>
<span class="nc" id="L948">		PreparedStatement detailPstmtPwtInv = null;</span>
<span class="nc" id="L949">		PreparedStatement agentPstmtPwtInv = null;</span>

<span class="nc bnc" id="L951" title="All 2 branches missed.">		if (pwtList != null) {</span>
<span class="nc" id="L952">			int size = pwtList.size();</span>
<span class="nc" id="L953">			PwtBean pwtBean = null;</span>

<span class="nc bnc" id="L955" title="All 2 branches missed.">			if (size &gt; 0) {</span>
				try {
<span class="nc" id="L957">					DBConnect dbConnect = new DBConnect();</span>
<span class="nc" id="L958">					connection = dbConnect.getConnection();</span>
<span class="nc" id="L959">					connection.setAutoCommit(false);</span>
<span class="nc" id="L960">					detailPstmt = connection</span>
							.prepareStatement(&quot;insert into st_se_tmp_pwt_inv(virn_code,game_id,receipt_id,user_id,status,date_entered) values(?,?,?,?,?,?)&quot;);
<span class="nc" id="L962">					Timestamp dateEntered = new Timestamp(new java.util.Date()</span>
							.getTime());
<span class="nc" id="L964">					CommonFunctionsHelper commonHelper = new CommonFunctionsHelper();</span>
<span class="nc bnc" id="L965" title="All 2 branches missed.">					for (int i = 0; i &lt; size; i++) {</span>
<span class="nc" id="L966">						pwtBean = (PwtBean) pwtList.get(i);</span>

<span class="nc bnc" id="L968" title="All 2 branches missed.">						if (pwtBean.getIsValid()) {</span>

<span class="nc" id="L970">							String encodedVirn = MD5Encoder.encode(pwtBean</span>
									.getVirnCode());
							// get the current pwt status of virn
<span class="nc" id="L973">							String pwtCurStatus = GameUtilityHelper</span>
									.getPwtStatusOfVirn(gameId, encodedVirn,
											connection, gameNbr);
							// update the pwt status
<span class="nc" id="L977">							detailPstmtPwtInv = connection</span>
									.prepareStatement(&quot;update st_se_pwt_inv_? set status=? where virn_code =? and game_id=?&quot;);

<span class="nc" id="L980">							detailPstmtPwtInv.setInt(1, gameNbr);</span>
<span class="nc bnc" id="L981" title="All 2 branches missed.">							if (&quot;UNCLM_PWT&quot;.equalsIgnoreCase(pwtCurStatus)) {</span>
<span class="nc" id="L982">								detailPstmtPwtInv</span>
										.setString(2, &quot;CLAIM_AGT_TEMP&quot;);
<span class="nc bnc" id="L984" title="All 2 branches missed.">							} else if (&quot;UNCLM_CANCELLED&quot;</span>
									.equalsIgnoreCase(pwtCurStatus)) {
<span class="nc" id="L986">								detailPstmtPwtInv</span>
										.setString(2, &quot;CLAIM_AGT_TEMP&quot;);
<span class="nc bnc" id="L988" title="All 2 branches missed.">							} else if (&quot;CLAIM_RET&quot;</span>
									.equalsIgnoreCase(pwtCurStatus.trim())) {
<span class="nc" id="L990">								detailPstmtPwtInv.setString(2,</span>
										&quot;CLAIM_RET_AGT_TEMP&quot;);
<span class="nc bnc" id="L992" title="All 2 branches missed.">							} else if (&quot;CLAIM_RET_UNCLM&quot;</span>
									.equalsIgnoreCase(pwtCurStatus.trim())) {
<span class="nc" id="L994">								detailPstmtPwtInv.setString(2,</span>
										&quot;CLAIM_RET_AGT_TEMP&quot;);
<span class="nc bnc" id="L996" title="All 2 branches missed.">							} else if (&quot;CLAIM_PLR_AGT_UNCLM_DIR&quot;</span>
									.equalsIgnoreCase(pwtCurStatus.trim())) {
<span class="nc" id="L998">								detailPstmtPwtInv.setString(2,</span>
										&quot;CLAIM_PLR_AGT_TEMP&quot;);
							}

							/*
							 * else
							 * if(!&quot;NONE&quot;.equalsIgnoreCase(pwtBean.getInUnclmed()) &amp;&amp;
							 * &quot;IN_PLR_UNCLM&quot;.equalsIgnoreCase(pwtBean.getInUnclmed()))
							 * detailPstmtPwtInv.setString(2,
							 * &quot;CLAIM_AGT_TEMP_UNCLM_PLR&quot;); else
							 * if(!&quot;NONE&quot;.equalsIgnoreCase(pwtBean.getInUnclmed()) &amp;&amp;
							 * &quot;IN_AGENT_UNCLM&quot;.equalsIgnoreCase(pwtBean.getInUnclmed()))
							 * detailPstmtPwtInv.setString(2,
							 * &quot;CLAIM_AGT_TEMP_UNCLM_AGT&quot;);
							 */

<span class="nc" id="L1014">							detailPstmtPwtInv.setString(3, encodedVirn);</span>
<span class="nc" id="L1015">							detailPstmtPwtInv.setInt(4, gameId);</span>
<span class="nc" id="L1016">							detailPstmtPwtInv.execute();</span>

							// update status to BULK_BO in agent_pwt or agent
							// direct player PWT for which isunclaimed true
<span class="nc bnc" id="L1020" title="All 2 branches missed.">							if (!&quot;NONE&quot;</span>
									.equalsIgnoreCase(pwtBean.getInUnclmed())) {// 
								String tableType;
<span class="nc bnc" id="L1023" title="All 2 branches missed.">								if (&quot;IN_PLR_UNCLM&quot;.equalsIgnoreCase(pwtBean</span>
										.getInUnclmed())) {
<span class="nc" id="L1025">									tableType = &quot;PLAYER&quot;;</span>
								} else {
<span class="nc" id="L1027">									tableType = &quot;AGENT&quot;;</span>
								}

								//commented because temp not in use
								/*commonHelper.updateOrgForUnClaimedVirn(
										agtOrgId, &quot;AGENT&quot;, encodedVirn,
										&quot;BULK_BO&quot;, gameId, tableType,
										connection);*/
							}

<span class="nc" id="L1037">							detailPstmt.setString(1, encodedVirn);</span>
<span class="nc" id="L1038">							detailPstmt.setInt(2, gameId);</span>
<span class="nc" id="L1039">							detailPstmt.setString(3, receiptId);</span>
<span class="nc" id="L1040">							detailPstmt.setInt(4, agtUserId);</span>
<span class="nc" id="L1041">							detailPstmt.setString(5, &quot;OPEN&quot;);</span>
<span class="nc" id="L1042">							detailPstmt.setTimestamp(6, dateEntered);</span>

<span class="nc" id="L1044">							detailPstmt.execute();</span>

						}

					}
<span class="nc" id="L1049">					connection.commit();</span>

<span class="nc" id="L1051">				} catch (SQLException e) {</span>

<span class="nc" id="L1053">					e.printStackTrace();</span>
<span class="nc" id="L1054">					throw new LMSException(e);</span>

				} finally {

<span class="nc" id="L1058">					try {</span>
<span class="nc bnc" id="L1059" title="All 4 branches missed.">						if (detailPstmt != null) {</span>
<span class="nc" id="L1060">							detailPstmt.close();</span>
						}
<span class="nc bnc" id="L1062" title="All 4 branches missed.">						if (detailPstmtPwtInv != null) {</span>
<span class="nc" id="L1063">							detailPstmtPwtInv.close();</span>
						}
<span class="nc bnc" id="L1065" title="All 4 branches missed.">						if (connection != null) {</span>
<span class="nc" id="L1066">							connection.close();</span>
						}
<span class="nc" id="L1068">					} catch (SQLException se) {</span>
<span class="nc" id="L1069">						se.printStackTrace();</span>
<span class="nc" id="L1070">					}</span>
<span class="nc" id="L1071">				}</span>

			}
		}

<span class="nc" id="L1076">	}</span>

	/*
	 * private void updateTempReceiptTables(List verifiedData, String
	 * autoGeneRecieptNoBO, Connection connection,int userID,int userOrgID)
	 * throws SQLException{ Statement statementTmpTable = null;
	 * 
	 * StringBuilder virn = new StringBuilder(); StringBuilder ticket = new
	 * StringBuilder();
	 * 
	 * statementTmpTable = connection.createStatement();
	 * 
	 * System.out.println(&quot;---in updateTempReceiptTables&quot;+verifiedData);
	 * ticket.append((((List)verifiedData.get(0)).toString().replace(&quot;[&quot;,&quot;'&quot;)).replace(&quot;]&quot;,&quot;'&quot;).replaceAll(&quot;,&quot;,&quot;','&quot;).replaceAll(&quot;
	 * &quot;,&quot;&quot;)); System.out.println(verifiedData.get(3)+&quot;Buffer---&quot;+ticket); virn =
	 * ((StringBuilder)verifiedData.get(3));
	 * System.out.println(&quot;Buffer--virn-&quot;+virn);
	 * 
	 * String tmpVirnUpdateQuery = &quot;update st_se_tmp_pwt_inv set
	 * status='CLOSE',final_receipt_num='&quot;+autoGeneRecieptNoBO+&quot;' where
	 * virn_code in (&quot;+virn.toString()+&quot;)&quot;; String tmpTicketUpdateQuery =
	 * &quot;update st_se_tmp_pwt_tickets_inv set
	 * status='CLOSE',final_receipt_num='&quot;+autoGeneRecieptNoBO+&quot;' where
	 * ticket_nbr in (&quot;+ticket.toString()+&quot;)&quot;; String insertTmpReceiptMaping =
	 * &quot;insert into st_se_tmp_pwt_receipt_mapping values
	 * ('&quot;+getReceiptNum()+&quot;','&quot;+autoGeneRecieptNoBO+&quot;')&quot;;
	 * 
	 * System.out.println(&quot;--tmpVirnUpdateQuery-&quot;+tmpVirnUpdateQuery);
	 * System.out.println(&quot;--tmpTicketUpdateQuery-&quot;+tmpTicketUpdateQuery);
	 * System.out.println(&quot;--insertTmpReceiptMaping--&quot;+insertTmpReceiptMaping);
	 * 
	 * statementTmpTable.executeUpdate(tmpVirnUpdateQuery);
	 * statementTmpTable.executeUpdate(tmpTicketUpdateQuery);
	 * statementTmpTable.executeUpdate(insertTmpReceiptMaping);
	 * 
	 * String game_nbr=null; ActiveGameBean activeGameBean =null; int game_id =
	 * 0;
	 * 
	 * String insertPwtTktQry = null; String updPwtTktQry = null; String
	 * tktNbrStr = null;
	 * tktNbrStr=(((List)verifiedData.get(0)).toString().replace(&quot;[&quot;,&quot;'&quot;)).replace(&quot;]&quot;,&quot;'&quot;).replaceAll(&quot;,&quot;,&quot;','&quot;).replaceAll(&quot;
	 * &quot;,&quot;&quot;); Map gameTickNum = (Map)verifiedData.get(2); Iterator itTkt =
	 * gameTickNum.entrySet().iterator(); while (itTkt.hasNext()) { Map.Entry
	 * pairsTkt = (Map.Entry)itTkt.next(); game_id=(Integer)pairsTkt.getKey();
	 * System.out.println(&quot;Tkt Map--game_id&quot;+game_id); if (activeGameList !=
	 * null) { for (int i = 0; i &lt; activeGameList.size(); i++) { activeGameBean =
	 * activeGameList.get(i); if (game_id==activeGameBean.getGameId()) {
	 * game_nbr=activeGameBean.getGameNbr_Name().split(&quot;-&quot;)[0]; break; } } }
	 * 
	 * updPwtTktQry=&quot;update st_se_pwt_tickets_inv_&quot;+game_nbr+&quot; aa,
	 * st_se_tmp_pwt_tickets_inv bb set aa.status='CLAIM_AGT',
	 * aa.verify_by_user='&quot;+userID+&quot;', aa.verify_by_org='&quot;+userOrgID+&quot;' where
	 * aa.status='CLAIM_RET' and aa.ticket_nbr in (&quot;+tktNbrStr+&quot;) and
	 * aa.ticket_nbr = bb.ticket_nbr&quot;; System.out.println(&quot;********PWT
	 * Update********&quot;+updPwtTktQry);
	 * statementTmpTable.executeUpdate(updPwtTktQry);
	 * 
	 * insertPwtTktQry =&quot;insert into st_se_pwt_tickets_inv_&quot;+game_nbr+&quot; select
	 * bb.ticket_nbr, bb.game_id, bb.book_nbr,'CLAIM_AGT' as status
	 * ,'&quot;+userID+&quot;' as verify_by_user,'&quot;+userOrgID+&quot;' as verify_by_org from
	 * st_se_tmp_pwt_tickets_inv bb where bb.receipt_id='&quot;+receiptNum+&quot;' and
	 * bb.game_id=&quot;+game_id+&quot; and bb.ticket_nbr in (&quot;+tktNbrStr+&quot;) and
	 * bb.ticket_nbr not in (select ticket_nbr from
	 * st_se_pwt_tickets_inv_&quot;+game_nbr+&quot;)&quot;; //insertPwtTktQry = &quot;insert into
	 * st_se_pwt_tickets_inv_&quot;+game_nbr+&quot; select
	 * ticket_nbr,game_id,book_nbr,'CLAIM_AGT' as status ,'&quot;+userID+&quot;' as
	 * verify_by_user,'&quot;+userOrgID+&quot;'verify_by_org from
	 * st_se_tmp_pwt_tickets_inv where receipt_id='&quot;+getReceiptNum()+&quot;' and
	 * game_id=&quot;+game_id+&quot; and ticket_nbr in (&quot;+ticket.toString()+&quot;)&quot;;
	 * 
	 * System.out.println(&quot;********PWT Insert********&quot;+insertPwtTktQry);
	 * statementTmpTable.executeUpdate(insertPwtTktQry); } }
	 */

	/*
	 * private void saveTicketsData(int game_id, List&lt;TicketBean&gt;
	 * verifiedTicketList, Connection connection) throws SQLException{
	 * 
	 * ServletContext servletContext = ServletActionContext.getServletContext();
	 * String retOnline=(String)servletContext.getAttribute(&quot;RET_ONLINE&quot;);
	 * PwtTicketHelper pwtTicketHelper = new PwtTicketHelper();
	 * 
	 * PreparedStatement Pstmt = null;
	 * 
	 * String query=null;
	 * 
	 * if(retOnline.equals(&quot;NO&quot;)) query=QueryManager.updateIntoPwtTicketsInv();
	 * else query=&quot;update st_pwt_tickets_inv set status=? where ticket_nbr=? and
	 * game_id =?&quot;;
	 * 
	 * Pstmt=connection.prepareStatement(query); Iterator&lt;TicketBean&gt;
	 * iterator=verifiedTicketList.iterator(); while(iterator.hasNext()){ String
	 * ticket_nbr=null; boolean isValid=false; TicketBean
	 * ticketBean=(TicketBean)iterator.next(); isValid=ticketBean.getIsValid();
	 * if(isValid==true){ ticket_nbr=ticketBean.getTicketNumber(); String
	 * book_nbr=pwtTicketHelper.getBookNbrFromTicketNo(ticket_nbr);
	 * if(retOnline.equals(&quot;NO&quot;)) { Pstmt.setString(1, ticket_nbr);
	 * Pstmt.setInt(2,game_id); Pstmt.setString(3, book_nbr); Pstmt.setString(4,
	 * &quot;CLAIM_RET&quot;); Pstmt.executeUpdate(); } else {
	 * 
	 * Pstmt.setString(1, &quot;CLAIM_RET&quot;); Pstmt.setString(2, ticket_nbr);
	 * Pstmt.setInt(3,game_id); Pstmt.executeUpdate(); } } } }
	 */

	public void saveTmpPwtVirnData(String gameNbr_Name, String receiptId,
			int agentId, String boOrgName, int userOrgID, String agtOrgName,
			List&lt;OrgBean&gt; agtOrgList, List&lt;ActiveGameBean&gt; activeGameList,
			String[] virnCode, List&lt;PwtBean&gt; pwtList, String rootPath,
			double HighPrizeAmount, String highPrizeCriteria)
			throws LMSException {
<span class="nc" id="L1186">		System.out.println(&quot;Afterrrrrrrrr saveTmpPwtVirnData&quot;);</span>
<span class="nc" id="L1187">		int gameId = -1;</span>
<span class="nc" id="L1188">		int gameNbr = 0;</span>
<span class="nc" id="L1189">		double agtPwtCommRate = 0.0;</span>

<span class="nc" id="L1191">		ActiveGameBean activeGameBean = null;</span>
<span class="nc" id="L1192">		OrgBean agtOrgBean = null;</span>

<span class="nc bnc" id="L1194" title="All 2 branches missed.">		if (activeGameList != null) {</span>
<span class="nc bnc" id="L1195" title="All 2 branches missed.">			for (int i = 0; i &lt; activeGameList.size(); i++) {</span>
<span class="nc" id="L1196">				activeGameBean = activeGameList.get(i);</span>
<span class="nc bnc" id="L1197" title="All 2 branches missed.">				if (gameNbr_Name.equals(activeGameBean.getGameNbr_Name())) {</span>
<span class="nc" id="L1198">					gameId = activeGameBean.getGameId();</span>
<span class="nc" id="L1199">					agtPwtCommRate = activeGameBean.getAgentPwtCommRate();</span>
<span class="nc" id="L1200">					break;</span>

				}
			}
		}
<span class="nc" id="L1205">		System.out.println(&quot;Afterrrrrrrrr---if&quot; + gameId);</span>
<span class="nc" id="L1206">		int agtOrgId = -1;</span>
<span class="nc" id="L1207">		int agtUserId = -1;</span>

<span class="nc bnc" id="L1209" title="All 2 branches missed.">		if (agtOrgList != null) {</span>
<span class="nc bnc" id="L1210" title="All 2 branches missed.">			for (int i = 0; i &lt; agtOrgList.size(); i++) {</span>
<span class="nc" id="L1211">				agtOrgBean = agtOrgList.get(i);</span>
<span class="nc bnc" id="L1212" title="All 2 branches missed.">				if (agtOrgName.equals(agtOrgBean.getOrgName())) {</span>
<span class="nc" id="L1213">					agtOrgId = agtOrgBean.getOrgId();</span>
<span class="nc" id="L1214">					agtUserId = agtOrgBean.getUserId();</span>
<span class="nc" id="L1215">					break;</span>

				}
			}
		}
<span class="nc" id="L1220">		agtUserId = agentId;</span>

		// get game nbr from game name number
<span class="nc" id="L1223">		String[] gameNameNbrArr = gameNbr_Name.split(&quot;-&quot;);</span>
<span class="nc" id="L1224">		gameNbr = Integer.parseInt(gameNameNbrArr[0]);</span>
<span class="nc" id="L1225">		DBConnect dbConnect = new DBConnect();</span>
<span class="nc" id="L1226">		Connection connection = dbConnect.getConnection();</span>
	
		//commented because temporary not in use
		/*	boolean isVerified = verifyPwtTickets(gameId, virnCode, pwtList,
				HighPrizeAmount, highPrizeCriteria, gameNbr, agtOrgId,
				connection);

		if (isVerified) {
			saveTmpPwtVirn(pwtList, gameId, receiptId, agtUserId, agtOrgId,
					gameNbr);
		}*/
<span class="nc" id="L1237">	}</span>

	public void setActiveGameList(List&lt;ActiveGameBean&gt; activeGameList) {
<span class="nc" id="L1240">		this.activeGameList = activeGameList;</span>
<span class="nc" id="L1241">	}</span>

	public void setReceiptNum(String receiptNum) {
<span class="nc" id="L1244">		this.receiptNum = receiptNum;</span>
<span class="nc" id="L1245">	}</span>

	/**
	 * This method saves the PWT data entered by the BO user
	 * 
	 * @param gameNbr_Name
	 * @param agtOrgName
	 * @param agtOrgList
	 * @param activeGameList
	 * @param virnCode
	 * @param pwtList
	 * @param pwt_verification_type
	 * @param enc_scheme_type
	 * @param rootPath
	 * @throws LMSException
	 */

	private boolean verifyPwtTickets(int gameId, String[] virnCode,
			List&lt;PwtBean&gt; pwtList, double HighPrizeAmount,
			String highPrizeCriteria, int gameNbr, int agtOrgId,
			Connection connection,String[] tktNbr) throws LMSException {

<span class="nc" id="L1267">		System.out.println(&quot;verify function called &quot;);</span>
		//String encodedVirnCode = getEncodedVirnCode(virnCode);
<span class="nc" id="L1269">		String encodedTktNbr = getEncodedTktNbr(tktNbr);</span>
<span class="nc" id="L1270">		System.out.println(&quot;encoded Tkt list&quot; + encodedTktNbr);</span>

		// Connection connection = null;
<span class="nc" id="L1273">		Statement statement = null;</span>
<span class="nc" id="L1274">		Statement statement2 = null;</span>
<span class="nc" id="L1275">		Statement statement3 = null;</span>
<span class="nc" id="L1276">		Statement statement4 = null;</span>

<span class="nc" id="L1278">		ResultSet resultSet = null;</span>
<span class="nc" id="L1279">		ResultSet resultSet2 = null;</span>
<span class="nc" id="L1280">		ResultSet resultSet3 = null;</span>
<span class="nc" id="L1281">		ResultSet resultSet4 = null;</span>

<span class="nc" id="L1283">		boolean isVerified = false;</span>
		// int orderId = -1;

<span class="nc bnc" id="L1286" title="All 2 branches missed.">		if (pwtList != null) {</span>
			//int size = pwtList.size();
			// QueryManager queryManager = null;
<span class="nc" id="L1289">			PwtBean pwtBean = null;</span>

<span class="nc" id="L1291">			StringBuffer query = new StringBuffer();</span>

<span class="nc bnc" id="L1293" title="All 2 branches missed.">			if (pwtList.size() &gt; 0) {</span>
				try {
					// DBConnect dbConnect = new DBConnect();
					// connection = dbConnect.getConnection();

<span class="nc" id="L1298">					statement = connection.createStatement();</span>
					// query.append(QueryManager.getST1PWTBOCheckQuery());
<span class="nc" id="L1300">					System.out.println(&quot;hello       &quot;</span>
							+ QueryManager.getST1PWTBOCheckQuery());
<span class="nc" id="L1302">					query.append(QueryManager.getST1PWTBOCheckQuery());</span>
<span class="nc" id="L1303">					query.append(&quot; st_se_pwt_inv_&quot; + gameNbr + &quot; where &quot;);</span>
<span class="nc" id="L1304">					query.append(&quot;  game_id = &quot;);</span>
<span class="nc" id="L1305">					query.append(&quot;&quot; + gameId);</span>
<span class="nc" id="L1306">					query.append(&quot; and id1 in (&quot;);</span>
<span class="nc" id="L1307">					query.append(encodedTktNbr);</span>
<span class="nc" id="L1308">					query.append(&quot;)&quot;);</span>

<span class="nc" id="L1310">					System.out.println(&quot;GameId:&quot; + gameId);</span>
<span class="nc" id="L1311">					System.out.println(&quot;Query:: &quot; + query);</span>
<span class="nc" id="L1312">					resultSet = statement.executeQuery(query.toString());</span>
					

<span class="nc" id="L1315">					String vCode = null;</span>
<span class="nc" id="L1316">					String pwtAmount = null;</span>
<span class="nc" id="L1317">					String enVirnCode = null;</span>
<span class="nc" id="L1318">					String prizeLevel = null;</span>
<span class="nc" id="L1319">					String prizeStatus = null;</span>
<span class="nc" id="L1320">					String tNumber = null;</span>
<span class="nc" id="L1321">					String enticketNumber = null;</span>
					// boolean pwtTempTableStatus=false;

<span class="nc bnc" id="L1324" title="All 2 branches missed.">					while (resultSet.next()) {</span>

<span class="nc" id="L1326">						vCode = resultSet</span>
								.getString(TableConstants.SPI_VIRN_CODE);

<span class="nc" id="L1329">						pwtAmount = resultSet</span>
								.getString(TableConstants.SPI_PWT_AMT);
<span class="nc" id="L1331">						prizeLevel = resultSet</span>
								.getString(TableConstants.SPI_PRIZE_LEVEL);
<span class="nc" id="L1333">						prizeStatus = resultSet.getString(&quot;status&quot;);</span>
<span class="nc" id="L1334">						tNumber = resultSet.getString(&quot;id1&quot;);</span>
<span class="nc" id="L1335">						System.out.println(&quot;DB:: Vcode:&quot; + vCode</span>
								+ &quot;:ticket nbr &quot; + tNumber);
						

<span class="nc bnc" id="L1339" title="All 2 branches missed.">						for (int j = 0; j &lt; pwtList.size(); j++) {</span>

<span class="nc" id="L1341">							pwtBean = (PwtBean) pwtList.get(j);</span>
<span class="nc" id="L1342">							enVirnCode = MD5Encoder.encode(pwtBean.getVirnCode());</span>
							
<span class="nc" id="L1344">							pwtBean.setEncVirnCode(enVirnCode);</span>
<span class="nc" id="L1345">							enticketNumber = MD5Encoder.encode(pwtBean</span>
									.getTicketNumber());
														
<span class="nc bnc" id="L1348" title="All 2 branches missed.">							if(enticketNumber.equalsIgnoreCase(tNumber)){</span>
<span class="nc bnc" id="L1349" title="All 2 branches missed.">								if (pwtBean.isTicketValid()) {</span>
<span class="nc bnc" id="L1350" title="All 2 branches missed.">									if (enticketNumber.equalsIgnoreCase(tNumber)) {</span>
<span class="nc bnc" id="L1351" title="All 2 branches missed.">									 if (enVirnCode.equals(vCode)){										 </span>
<span class="nc bnc" id="L1352" title="All 2 branches missed.">										if (prizeStatus.equalsIgnoreCase(&quot;CLAIM_RET_UNCLM&quot;)) {</span>
<span class="nc" id="L1353">											CommonFunctionsHelper commHelper = new CommonFunctionsHelper();</span>
<span class="nc" id="L1354">											String flag = commHelper.verifyOrgForUnClaimedVirn(agtOrgId, &quot;AGENT&quot;,enVirnCode,&quot;UNCLAIM_BAL&quot;,gameId, connection);</span>
<span class="nc bnc" id="L1355" title="All 2 branches missed.">											if (!&quot;NONE&quot;.equalsIgnoreCase(flag)) {</span>
<span class="nc" id="L1356">												String orgname = null;</span>
<span class="nc" id="L1357">												String receiptNumber = null;</span>
<span class="nc" id="L1358">												Timestamp receiptTime = null;</span>
<span class="nc" id="L1359">												statement4 = connection.createStatement();</span>
												
<span class="nc" id="L1361">												String retDetailsQuery = &quot;select a.name,c.generated_id,e.transaction_date from st_lms_organization_master a,st_se_agent_pwt b,st_lms_agent_receipts c,st_lms_agent_transaction_master e where b.virn_code='&quot;</span>
														+ enVirnCode
														+ &quot;' and b.game_id=&quot;
														+ gameId
														+ &quot; and a.organization_id=b.retailer_org_id and b.transaction_id=e.transaction_id and c.receipt_id=(select receipt_id from st_lms_agent_receipts_trn_mapping where transaction_id=e.transaction_id)&quot;;

<span class="nc" id="L1367">												System.out</span>
														.println(&quot;query for get org name &quot;
																+ retDetailsQuery);
<span class="nc" id="L1370">												resultSet4 = statement4</span>
														.executeQuery(retDetailsQuery);
<span class="nc bnc" id="L1372" title="All 2 branches missed.">												while (resultSet4.next()) {</span>
<span class="nc" id="L1373">													orgname = resultSet4</span>
															.getString(&quot;name&quot;);
<span class="nc" id="L1375">													receiptNumber = resultSet4</span>
															.getString(&quot;generated_id&quot;);
<span class="nc" id="L1377">													receiptTime = resultSet4</span>
															.getTimestamp(&quot;transaction_date&quot;);
												}

<span class="nc" id="L1381">												isVerified = true;</span>
<span class="nc" id="L1382">												pwtBean.setValid(true);</span>
<span class="nc" id="L1383">												pwtBean</span>
														.setVerificationStatus(&quot;Valid Virn&quot;);
<span class="nc" id="L1385">												pwtBean.setPwtAmount(pwtAmount);</span>
												// pwtBean.setMessage(&quot;Credited
												// to
												// Concerned Party&quot;);
<span class="nc" id="L1389">												pwtBean</span>
														.setMessage(&quot;Already Paid to Retailer: &quot;
																+ orgname
																+ &quot; on Voucher Number: &quot;
																+ receiptNumber
																+ &quot; at &quot;
																+ receiptTime);
<span class="nc" id="L1396">												pwtBean.setInUnclmed(flag);</span>
<span class="nc" id="L1397">												pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L1398">											} else {</span>
<span class="nc" id="L1399">												pwtBean.setValid(false);</span>
<span class="nc" id="L1400">												pwtBean</span>
														.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1402">												pwtBean</span>
														.setMessage(&quot;VIRN To be Claimed by Another Agent.&quot;);
<span class="nc" id="L1404">												pwtBean.setMessageCode(&quot;TBD&quot;);</span>

											}
<span class="nc" id="L1407">											break;</span>
<span class="nc bnc" id="L1408" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;UNCLM_PWT&quot;)) {
<span class="nc bnc" id="L1410" title="All 8 branches missed.">											if (highPrizeCriteria</span>
													.equals(&quot;level&quot;)
													&amp;&amp; prizeLevel
															.equals(&quot;HIGH&quot;)
													|| highPrizeCriteria
															.equals(&quot;amt&quot;)
													&amp;&amp; Double
															.parseDouble(pwtAmount) &gt; HighPrizeAmount) {
<span class="nc" id="L1418">												System.out</span>
														.println(&quot;inside high prize&quot;);
<span class="nc" id="L1420">												System.out</span>
														.println(&quot;criteria is &quot;
																+ highPrizeCriteria);
<span class="nc" id="L1423">												pwtBean.setHighLevel(true);</span>
<span class="nc" id="L1424">												pwtBean.setValid(false);</span>
<span class="nc" id="L1425">												pwtBean</span>
														.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1427">												pwtBean</span>
														.setMessage(&quot;High prize VIRN can't be Paid to Agent.It is to be paid as Direct Player PWT&quot;);
<span class="nc" id="L1429">												pwtBean</span>
														.setMessageCode(&quot;112008&quot;);
											} else {
<span class="nc" id="L1432">												isVerified = true;</span>
<span class="nc" id="L1433">												pwtBean.setValid(true);</span>
<span class="nc" id="L1434">												pwtBean</span>
														.setVerificationStatus(&quot;Valid Virn&quot;);
<span class="nc" id="L1436">												pwtBean.setPwtAmount(pwtAmount);</span>
<span class="nc" id="L1437">												pwtBean</span>
														.setMessage(&quot;Credited to Concerned Party&quot;);
<span class="nc" id="L1439">												pwtBean</span>
														.setMessageCode(&quot;111002&quot;);
											}
<span class="nc" id="L1442">											break;</span>
<span class="nc bnc" id="L1443" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;UNCLM_CANCELLED&quot;)) {
<span class="nc bnc" id="L1445" title="All 8 branches missed.">											if (highPrizeCriteria</span>
													.equals(&quot;level&quot;)
													&amp;&amp; prizeLevel
															.equals(&quot;HIGH&quot;)
													|| highPrizeCriteria
															.equals(&quot;amt&quot;)
													&amp;&amp; Double
															.parseDouble(pwtAmount) &gt; HighPrizeAmount) {
<span class="nc" id="L1453">												System.out</span>
														.println(&quot;inside high prize&quot;);
<span class="nc" id="L1455">												System.out</span>
														.println(&quot;criteria is &quot;
																+ highPrizeCriteria);
<span class="nc" id="L1458">												pwtBean.setHighLevel(true);</span>
<span class="nc" id="L1459">												pwtBean.setValid(false);</span>
<span class="nc" id="L1460">												pwtBean</span>
														.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1462">												pwtBean</span>
														.setMessage(&quot;High prize VIRN can't be paid to Agent.It is to be paid as Direct Player PWT&quot;);
<span class="nc" id="L1464">												pwtBean</span>
														.setMessageCode(&quot;112011&quot;);
											} else {
<span class="nc" id="L1467">												isVerified = true;</span>
<span class="nc" id="L1468">												pwtBean.setValid(true);</span>
<span class="nc" id="L1469">												pwtBean</span>
														.setVerificationStatus(&quot;Valid Virn&quot;);
<span class="nc" id="L1471">												pwtBean.setPwtAmount(pwtAmount);</span>
<span class="nc" id="L1472">												pwtBean</span>
														.setMessage(&quot;Credited to Concerned Party&quot;);
<span class="nc" id="L1474">												pwtBean</span>
														.setMessageCode(&quot;111003&quot;);
											}
<span class="nc" id="L1477">											break;</span>
<span class="nc bnc" id="L1478" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CLAIM_PLR_AGT_UNCLM_DIR&quot;)) {
<span class="nc" id="L1480">											CommonFunctionsHelper commHelper = new CommonFunctionsHelper();</span>
<span class="nc" id="L1481">											String flag = commHelper</span>
													.verifyOrgForUnClaimedVirn(
															agtOrgId, &quot;AGENT&quot;,
															enVirnCode,
															&quot;UNCLAIM_BAL&quot;,
															gameId, connection);
<span class="nc bnc" id="L1487" title="All 2 branches missed.">											if (!&quot;NONE&quot;.equalsIgnoreCase(flag)) {</span>
												// get player details from st
												// Agent
												// direct player
												// details************8

<span class="nc" id="L1493">												String agtOrgNAme = null;</span>
<span class="nc" id="L1494">												String playerFirstName = null;</span>
<span class="nc" id="L1495">												String playerLastName = null;</span>
<span class="nc" id="L1496">												String playercity = null;</span>
<span class="nc" id="L1497">												String receiptNumber = null;</span>
<span class="nc" id="L1498">												Timestamp receiptTime = null;</span>
<span class="nc" id="L1499">												statement3 = connection</span>
														.createStatement();
												// String
												// plrDetailsQuery=&quot;select
												// first_name,last_name,city
												// from
												// st_lms_player_master where
												// player_id
												// in (select player_id from
												// st_se_direct_player_pwt where
												// virn_code='&quot;+enVirnCode+&quot;'
												// and
												// game_id=&quot;+gameId+&quot;)&quot;;
												// String
												// plrDetailsQuery=&quot;select
												// b.first_name,b.last_name,b.city,a.transaction_date,c.generated_id
												// from st_se_direct_player_pwt
												// a,st_lms_player_master
												// b,st_lms_bo_receipts c where
												// a.virn_code='&quot;+enVirnCode+&quot;'
												// and
												// a.game_id=&quot;+gameId+&quot; and
												// a.player_id=b.player_id and
												// c.receipt_id=(select
												// receipt_id from
												// st_lms_bo_receipts_trn_mapping
												// where
												// transaction_id=a.transaction_id)&quot;;
<span class="nc" id="L1527">												String plrDetailsQuery = &quot;select b.first_name,b.last_name,b.city,a.transaction_date,c.generated_id,d.name from st_se_agt_direct_player_pwt a,st_lms_player_master b,st_lms_agent_receipts c,st_lms_organization_master d where a.virn_code='&quot;</span>
														+ enVirnCode
														+ &quot;' and a.game_id=&quot;
														+ gameId
														+ &quot; and a.player_id=b.player_id and c.receipt_id=(select receipt_id from st_lms_agent_receipts_trn_mapping where transaction_id=a.transaction_id) and d.organization_id=a.agent_org_id&quot;;
<span class="nc" id="L1532">												System.out</span>
														.println(&quot;query for get player name &quot;
																+ plrDetailsQuery);
<span class="nc" id="L1535">												resultSet3 = statement3</span>
														.executeQuery(plrDetailsQuery);
<span class="nc bnc" id="L1537" title="All 2 branches missed.">												while (resultSet3.next()) {</span>
<span class="nc" id="L1538">													playerFirstName = resultSet3</span>
															.getString(&quot;first_name&quot;);
<span class="nc" id="L1540">													playerLastName = resultSet3</span>
															.getString(&quot;last_name&quot;);
<span class="nc" id="L1542">													playercity = resultSet3</span>
															.getString(&quot;city&quot;);
<span class="nc" id="L1544">													receiptNumber = resultSet3</span>
															.getString(&quot;generated_id&quot;);
<span class="nc" id="L1546">													receiptTime = resultSet3</span>
															.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L1548">													agtOrgNAme = resultSet3</span>
															.getString(&quot;name&quot;);
												}

<span class="nc" id="L1552">												isVerified = true;</span>
<span class="nc" id="L1553">												pwtBean.setValid(true);</span>
<span class="nc" id="L1554">												pwtBean</span>
														.setVerificationStatus(&quot;Valid Virn&quot;);
<span class="nc" id="L1556">												pwtBean.setPwtAmount(pwtAmount);</span>
												// pwtBean.setMessage(&quot;Credited
												// to
												// Concerned Party&quot;);
<span class="nc" id="L1560">												pwtBean</span>
														.setMessage(&quot;Already Paid to Player &quot;
																+ playerFirstName
																+ &quot; &quot;
																+ playerLastName
																+ &quot; &quot;
																+ playercity
																+ &quot; By Agent: &quot;
																+ agtOrgNAme
																+ &quot; on Voucher Number: &quot;
																+ receiptNumber
																+ &quot; at &quot;
																+ receiptTime);
<span class="nc" id="L1573">												pwtBean.setInUnclmed(flag);</span>
<span class="nc" id="L1574">												pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L1575">											} else {</span>
<span class="nc" id="L1576">												pwtBean.setValid(false);</span>
<span class="nc" id="L1577">												pwtBean</span>
														.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1579">												pwtBean</span>
														.setMessage(&quot;VIRN To be Claimed by Another Agent.&quot;);
<span class="nc" id="L1581">												pwtBean.setMessageCode(&quot;TBD&quot;);</span>
											}
<span class="nc" id="L1583">											break;</span>
<span class="nc bnc" id="L1584" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CLAIM_PLR_AGT_CLM_DIR&quot;)) {
											// show the agent details and player
											// details
<span class="nc" id="L1588">											String agtOrgNAme = null;</span>
<span class="nc" id="L1589">											String playerFirstName = null;</span>
<span class="nc" id="L1590">											String playerLastName = null;</span>
<span class="nc" id="L1591">											String playercity = null;</span>
<span class="nc" id="L1592">											String receiptNumber = null;</span>
<span class="nc" id="L1593">											Timestamp receiptTime = null;</span>
<span class="nc" id="L1594">											statement3 = connection</span>
													.createStatement();
											// String plrDetailsQuery=&quot;select
											// first_name,last_name,city from
											// st_lms_player_master where
											// player_id in
											// (select player_id from
											// st_se_direct_player_pwt where
											// virn_code='&quot;+enVirnCode+&quot;' and
											// game_id=&quot;+gameId+&quot;)&quot;;
											// String plrDetailsQuery=&quot;select
											// b.first_name,b.last_name,b.city,a.transaction_date,c.generated_id
											// from st_se_direct_player_pwt
											// a,st_lms_player_master
											// b,st_lms_bo_receipts c where
											// a.virn_code='&quot;+enVirnCode+&quot;' and
											// a.game_id=&quot;+gameId+&quot; and
											// a.player_id=b.player_id and
											// c.receipt_id=(select receipt_id
											// from
											// st_lms_bo_receipts_trn_mapping
											// where
											// transaction_id=a.transaction_id)&quot;;
<span class="nc" id="L1617">											String plrDetailsQuery = &quot;select b.first_name,b.last_name,b.city,a.transaction_date,c.generated_id,d.name from st_se_agt_direct_player_pwt a,st_lms_player_master b,st_lms_agent_receipts c,st_lms_organization_master d where a.virn_code='&quot;</span>
													+ enVirnCode
													+ &quot;' and a.game_id=&quot;
													+ gameId
													+ &quot; and a.player_id=b.player_id and c.receipt_id=(select receipt_id from st_lms_agent_receipts_trn_mapping where transaction_id=a.transaction_id) and d.organization_id=a.agent_org_id&quot;;
<span class="nc" id="L1622">											System.out</span>
													.println(&quot;query for get player name &quot;
															+ plrDetailsQuery);
<span class="nc" id="L1625">											resultSet3 = statement3</span>
													.executeQuery(plrDetailsQuery);
<span class="nc bnc" id="L1627" title="All 2 branches missed.">											while (resultSet3.next()) {</span>
<span class="nc" id="L1628">												playerFirstName = resultSet3</span>
														.getString(&quot;first_name&quot;);
<span class="nc" id="L1630">												playerLastName = resultSet3</span>
														.getString(&quot;last_name&quot;);
<span class="nc" id="L1632">												playercity = resultSet3</span>
														.getString(&quot;city&quot;);
<span class="nc" id="L1634">												receiptNumber = resultSet3</span>
														.getString(&quot;generated_id&quot;);
<span class="nc" id="L1636">												receiptTime = resultSet3</span>
														.getTimestamp(&quot;transaction_date&quot;);
<span class="nc" id="L1638">												agtOrgNAme = resultSet3</span>
														.getString(&quot;name&quot;);
											}

<span class="nc" id="L1642">											pwtBean.setValid(false);</span>
<span class="nc" id="L1643">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1645">											pwtBean</span>
													.setMessage(&quot;Already Paid to Player &quot;
															+ playerFirstName
															+ &quot; &quot;
															+ playerLastName
															+ &quot; &quot;
															+ playercity
															+ &quot; By Agent: &quot;
															+ agtOrgNAme
															+ &quot; In Claimable Balance on Voucher Number: &quot;
															+ receiptNumber
															+ &quot; at &quot;
															+ receiptTime);
											// pwtBean.setMessage(&quot;Paid to
											// Player By
											// Agent In Claimable Balance&quot;);
<span class="nc" id="L1661">											pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L1662">											break;</span>
<span class="nc bnc" id="L1663" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CLAIM_AGT_TEMP&quot;)) {
<span class="nc" id="L1665">											System.out</span>
													.println(&quot;---------inside claim_agt_ auto--------------&quot;);
<span class="nc" id="L1667">											String orgname = null;</span>
<span class="nc" id="L1668">											String receiptNumber = null;</span>
<span class="nc" id="L1669">											Timestamp receiptTime = null;</span>
<span class="nc" id="L1670">											statement4 = connection</span>
													.createStatement();
											// String agtDetailsQuery=&quot;select
											// name from
											// st_lms_organization_master where
											// organization_id in (select
											// agent_org_id
											// from st_se_bo_pwt where
											// virn_code='&quot;+enVirnCode+&quot;' and
											// game_id=&quot;+gameId+&quot;)&quot;;

<span class="nc" id="L1681">											String partyDetailsQuery = &quot;select a.receipt_id,a.date_entered ,b.name from st_se_tmp_pwt_inv a,st_lms_organization_master b  where virn_code='&quot;</span>
													+ enVirnCode
													+ &quot;' and game_id=&quot;
													+ gameId
													+ &quot; and organization_id=(select organization_id from st_lms_user_master where user_id=a.user_id)&quot;;

<span class="nc" id="L1687">											System.out</span>
													.println(&quot;query for get org name &quot;
															+ partyDetailsQuery);
<span class="nc" id="L1690">											resultSet4 = statement4</span>
													.executeQuery(partyDetailsQuery);
<span class="nc bnc" id="L1692" title="All 2 branches missed.">											while (resultSet4.next()) {</span>
<span class="nc" id="L1693">												orgname = resultSet4</span>
														.getString(&quot;name&quot;);
<span class="nc" id="L1695">												receiptNumber = resultSet4</span>
														.getString(&quot;receipt_id&quot;);
<span class="nc" id="L1697">												receiptTime = resultSet4</span>
														.getTimestamp(&quot;date_entered&quot;);
											}
<span class="nc" id="L1700">											pwtBean.setValid(false);</span>
<span class="nc" id="L1701">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1703">											pwtBean</span>
													.setMessage(&quot;Already Verified in Bulk Receipt at BO for agent: &quot;
															+ orgname
															+ &quot; on Bulk Receipt Number: &quot;
															+ receiptNumber
															+ &quot; at &quot;
															+ receiptTime
															+ &quot;, Final Payment Pending&quot;);
<span class="nc" id="L1711">											pwtBean.setMessageCode(&quot;112001&quot;);</span>
<span class="nc" id="L1712">											break;</span>
<span class="nc bnc" id="L1713" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CLAIM_PLR_AGT_TEMP&quot;)) {

<span class="nc" id="L1716">											String orgname = null;</span>
<span class="nc" id="L1717">											String receiptNumber = null;</span>
<span class="nc" id="L1718">											Timestamp receiptTime = null;</span>
<span class="nc" id="L1719">											statement4 = connection</span>
													.createStatement();
											// String agtDetailsQuery=&quot;select
											// name from
											// st_lms_organization_master where
											// organization_id in (select
											// agent_org_id
											// from st_se_bo_pwt where
											// virn_code='&quot;+enVirnCode+&quot;' and
											// game_id=&quot;+gameId+&quot;)&quot;;

<span class="nc" id="L1730">											String partyDetailsQuery = &quot;select a.receipt_id,a.date_entered ,b.name from st_se_tmp_pwt_inv a,st_lms_organization_master b  where virn_code='&quot;</span>
													+ enVirnCode
													+ &quot;' and game_id=&quot;
													+ gameId
													+ &quot; and organization_id=(select organization_id from st_lms_user_master where user_id=a.user_id)&quot;;

<span class="nc" id="L1736">											System.out</span>
													.println(&quot;query for get org name &quot;
															+ partyDetailsQuery);
<span class="nc" id="L1739">											resultSet4 = statement4</span>
													.executeQuery(partyDetailsQuery);
<span class="nc bnc" id="L1741" title="All 2 branches missed.">											while (resultSet4.next()) {</span>
<span class="nc" id="L1742">												orgname = resultSet4</span>
														.getString(&quot;name&quot;);
<span class="nc" id="L1744">												receiptNumber = resultSet4</span>
														.getString(&quot;receipt_id&quot;);
<span class="nc" id="L1746">												receiptTime = resultSet4</span>
														.getTimestamp(&quot;date_entered&quot;);
											}
<span class="nc" id="L1749">											pwtBean.setValid(false);</span>
<span class="nc" id="L1750">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1752">											pwtBean</span>
													.setMessage(&quot;Already Verified in Bulk Receipt at BO for agent: &quot;
															+ orgname
															+ &quot; on Bulk Receipt Number: &quot;
															+ receiptNumber
															+ &quot; at &quot;
															+ receiptTime
															+ &quot;, Final Payment Pending&quot;);
<span class="nc" id="L1760">											pwtBean.setMessageCode(&quot;112001&quot;);</span>

<span class="nc" id="L1762">											break;</span>
<span class="nc bnc" id="L1763" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CLAIM_RET_AGT_TEMP&quot;)) {
<span class="nc" id="L1765">											String orgname = null;</span>
<span class="nc" id="L1766">											String receiptNumber = null;</span>
<span class="nc" id="L1767">											Timestamp receiptTime = null;</span>
<span class="nc" id="L1768">											statement4 = connection</span>
													.createStatement();
											// String agtDetailsQuery=&quot;select
											// name from
											// st_lms_organization_master where
											// organization_id in (select
											// agent_org_id
											// from st_se_bo_pwt where
											// virn_code='&quot;+enVirnCode+&quot;' and
											// game_id=&quot;+gameId+&quot;)&quot;;

<span class="nc" id="L1779">											String partyDetailsQuery = &quot;select a.receipt_id,a.date_entered ,b.name from st_se_tmp_pwt_inv a,st_lms_organization_master b  where virn_code='&quot;</span>
													+ enVirnCode
													+ &quot;' and game_id=&quot;
													+ gameId
													+ &quot; and organization_id=(select organization_id from st_lms_user_master where user_id=a.user_id)&quot;;

<span class="nc" id="L1785">											System.out</span>
													.println(&quot;query for get org name &quot;
															+ partyDetailsQuery);
<span class="nc" id="L1788">											resultSet4 = statement4</span>
													.executeQuery(partyDetailsQuery);
<span class="nc bnc" id="L1790" title="All 2 branches missed.">											while (resultSet4.next()) {</span>
<span class="nc" id="L1791">												orgname = resultSet4</span>
														.getString(&quot;name&quot;);
<span class="nc" id="L1793">												receiptNumber = resultSet4</span>
														.getString(&quot;receipt_id&quot;);
<span class="nc" id="L1795">												receiptTime = resultSet4</span>
														.getTimestamp(&quot;date_entered&quot;);
											}
<span class="nc" id="L1798">											pwtBean.setValid(false);</span>
<span class="nc" id="L1799">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1801">											pwtBean</span>
													.setMessage(&quot;Already Verified in Bulk Receipt at BO for agent: &quot;
															+ orgname
															+ &quot; on Bulk Receipt Number: &quot;
															+ receiptNumber
															+ &quot; at &quot;
															+ receiptTime
															+ &quot;, Final Payment Pending&quot;);
<span class="nc" id="L1809">											pwtBean.setMessageCode(&quot;112001&quot;);</span>

<span class="nc" id="L1811">											break;</span>
<span class="nc bnc" id="L1812" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CLAIM_AGT&quot;)) {
<span class="nc" id="L1814">											System.out</span>
													.println(&quot;---------inside alaim_agt--------------&quot;);
<span class="nc" id="L1816">											String orgname = null;</span>
<span class="nc" id="L1817">											String receiptNumber = null;</span>
<span class="nc" id="L1818">											Timestamp receiptTime = null;</span>
<span class="nc" id="L1819">											statement2 = connection</span>
													.createStatement();
											// String agtDetailsQuery=&quot;select
											// name from
											// st_lms_organization_master where
											// organization_id in (select
											// agent_org_id
											// from st_se_bo_pwt where
											// virn_code='&quot;+enVirnCode+&quot;' and
											// game_id=&quot;+gameId+&quot;)&quot;;

<span class="nc" id="L1830">											String agtDetailsQuery = &quot;select a.name,c.generated_id,e.transaction_date from st_lms_organization_master a,st_se_bo_pwt b,st_lms_bo_receipts c,st_lms_bo_transaction_master e where b.virn_code='&quot;</span>
													+ enVirnCode
													+ &quot;' and b.game_id=&quot;
													+ gameId
													+ &quot; and a.organization_id=b.agent_org_id and b.transaction_id=e.transaction_id and c.receipt_id=(select receipt_id from st_lms_bo_receipts_trn_mapping where transaction_id=e.transaction_id)&quot;;

<span class="nc" id="L1836">											System.out</span>
													.println(&quot;query for get org name &quot;
															+ agtDetailsQuery);
<span class="nc" id="L1839">											resultSet2 = statement2</span>
													.executeQuery(agtDetailsQuery);
<span class="nc bnc" id="L1841" title="All 2 branches missed.">											while (resultSet2.next()) {</span>
<span class="nc" id="L1842">												orgname = resultSet2</span>
														.getString(&quot;name&quot;);
<span class="nc" id="L1844">												receiptNumber = resultSet2</span>
														.getString(&quot;generated_id&quot;);
<span class="nc" id="L1846">												receiptTime = resultSet2</span>
														.getTimestamp(&quot;transaction_date&quot;);
											}
<span class="nc" id="L1849">											pwtBean.setValid(false);</span>
<span class="nc" id="L1850">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1852">											pwtBean</span>
													.setMessage(&quot;Already Paid to Agent: &quot;
															+ orgname
															+ &quot; on Voucher Number: &quot;
															+ receiptNumber
															+ &quot; at &quot;
															+ receiptTime);
<span class="nc" id="L1859">											pwtBean.setMessageCode(&quot;112003&quot;);</span>

<span class="nc" id="L1861">											break;</span>
<span class="nc bnc" id="L1862" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CLAIM_AGT_AUTO&quot;)) {
<span class="nc" id="L1864">											String orgname = null;</span>
<span class="nc" id="L1865">											String receiptNumber = null;</span>
<span class="nc" id="L1866">											Timestamp receiptTime = null;</span>
<span class="nc" id="L1867">											statement2 = connection</span>
													.createStatement();
											// String agtDetailsQuery=&quot;select
											// name from
											// st_lms_organization_master where
											// organization_id in (select
											// agent_org_id
											// from st_se_bo_pwt where
											// virn_code='&quot;+enVirnCode+&quot;' and
											// game_id=&quot;+gameId+&quot;)&quot;;

<span class="nc" id="L1878">											String agtDetailsQuery = &quot;select a.name,c.generated_id,e.transaction_date from st_lms_organization_master a,st_se_bo_pwt b,st_lms_bo_receipts c,st_lms_bo_transaction_master e where b.virn_code='&quot;</span>
													+ enVirnCode
													+ &quot;' and b.game_id=&quot;
													+ gameId
													+ &quot; and a.organization_id=b.agent_org_id and b.transaction_id=e.transaction_id and c.receipt_id=(select receipt_id from st_lms_bo_receipts_trn_mapping where transaction_id=e.transaction_id)&quot;;

<span class="nc" id="L1884">											System.out</span>
													.println(&quot;query for get org name &quot;
															+ agtDetailsQuery);
<span class="nc" id="L1887">											resultSet2 = statement2</span>
													.executeQuery(agtDetailsQuery);
<span class="nc bnc" id="L1889" title="All 2 branches missed.">											while (resultSet2.next()) {</span>
<span class="nc" id="L1890">												orgname = resultSet2</span>
														.getString(&quot;name&quot;);
<span class="nc" id="L1892">												receiptNumber = resultSet2</span>
														.getString(&quot;generated_id&quot;);
<span class="nc" id="L1894">												receiptTime = resultSet2</span>
														.getTimestamp(&quot;transaction_date&quot;);
											}
<span class="nc" id="L1897">											pwtBean.setValid(false);</span>
<span class="nc" id="L1898">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1900">											pwtBean</span>
													.setMessage(&quot;Already Paid As Auto Scrap to Agent: &quot;
															+ orgname
															+ &quot; on Voucher Number: &quot;
															+ receiptNumber
															+ &quot; at &quot;
															+ receiptTime);
<span class="nc" id="L1907">											pwtBean.setMessageCode(&quot;112003&quot;);</span>

<span class="nc" id="L1909">											break;</span>
<span class="nc bnc" id="L1910" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CLAIM_PLR_BO&quot;)) {
<span class="nc" id="L1912">											String playerFirstName = null;</span>
<span class="nc" id="L1913">											String playerLastName = null;</span>
<span class="nc" id="L1914">											String playercity = null;</span>
<span class="nc" id="L1915">											String receiptNumber = null;</span>
<span class="nc" id="L1916">											Timestamp receiptTime = null;</span>
<span class="nc" id="L1917">											statement3 = connection</span>
													.createStatement();
											// String plrDetailsQuery=&quot;select
											// first_name,last_name,city from
											// st_lms_player_master where
											// player_id in
											// (select player_id from
											// st_se_direct_player_pwt where
											// virn_code='&quot;+enVirnCode+&quot;' and
											// game_id=&quot;+gameId+&quot;)&quot;;
<span class="nc" id="L1927">											String plrDetailsQuery = &quot;select b.first_name,b.last_name,b.city,a.transaction_date,c.generated_id from st_se_direct_player_pwt a,st_lms_player_master b,st_lms_bo_receipts c where a.virn_code='&quot;</span>
													+ enVirnCode
													+ &quot;' and a.game_id=&quot;
													+ gameId
													+ &quot; and a.player_id=b.player_id and c.receipt_id=(select receipt_id from st_lms_bo_receipts_trn_mapping where transaction_id=a.transaction_id)&quot;;
<span class="nc" id="L1932">											System.out</span>
													.println(&quot;query for get player name &quot;
															+ plrDetailsQuery);
<span class="nc" id="L1935">											resultSet3 = statement3</span>
													.executeQuery(plrDetailsQuery);
<span class="nc bnc" id="L1937" title="All 2 branches missed.">											while (resultSet3.next()) {</span>
<span class="nc" id="L1938">												playerFirstName = resultSet3</span>
														.getString(&quot;first_name&quot;);
<span class="nc" id="L1940">												playerLastName = resultSet3</span>
														.getString(&quot;last_name&quot;);
<span class="nc" id="L1942">												playercity = resultSet3</span>
														.getString(&quot;city&quot;);
<span class="nc" id="L1944">												receiptNumber = resultSet3</span>
														.getString(&quot;generated_id&quot;);
<span class="nc" id="L1946">												receiptTime = resultSet3</span>
														.getTimestamp(&quot;transaction_date&quot;);
											}
<span class="nc" id="L1949">											pwtBean.setValid(false);</span>
<span class="nc" id="L1950">											pwtBean</span>
													.setMessage(&quot;Already Paid By BO as Direct Player PWT to Player: &quot;
															+ playerFirstName
															+ &quot; &quot;
															+ playerLastName
															+ &quot;,&quot;
															+ playercity
															+ &quot; on Voucher Number &quot;
															+ receiptNumber
															+ &quot; at &quot;
															+ receiptTime);
<span class="nc" id="L1961">											pwtBean.setMessageCode(&quot;112005&quot;);</span>
<span class="nc" id="L1962">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L1964">											break;</span>
<span class="nc bnc" id="L1965" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CLAIM_PLR_RET_UNCLM&quot;)) {
											// show info of retailer if
											// available from
											// at retailer PWT
<span class="nc" id="L1970">											String orgname = null;</span>
<span class="nc" id="L1971">											Timestamp receiptTime = null;</span>
<span class="nc" id="L1972">											statement2 = connection</span>
													.createStatement();
											// String agtDetailsQuery=&quot;select
											// name from
											// st_lms_organization_master where
											// organization_id in (select
											// agent_org_id
											// from st_se_bo_pwt where
											// virn_code='&quot;+enVirnCode+&quot;' and
											// game_id=&quot;+gameId+&quot;)&quot;;

											// String agtDetailsQuery=&quot;select
											// a.name,c.generated_id,e.transaction_date
											// from st_lms_organization_master
											// a,st_se_bo_pwt
											// b,st_lms_bo_receipts
											// c,st_lms_bo_transaction_master e
											// where
											// b.virn_code='&quot;+enVirnCode+&quot;' and
											// b.game_id=&quot;+gameId+&quot; and
											// a.organization_id=b.agent_org_id
											// and
											// b.transaction_id=e.transaction_id
											// and
											// c.receipt_id=(select receipt_id
											// from
											// st_lms_bo_receipts_trn_mapping
											// where
											// transaction_id=e.transaction_id)&quot;;
<span class="nc" id="L2001">											String retDetailsQuery = &quot;select a.name,e.transaction_date from st_lms_organization_master a,st_se_retailer_pwt b,st_lms_retailer_transaction_master e where b.virn_code='&quot;</span>
													+ enVirnCode
													+ &quot;' and b.game_id=&quot;
													+ gameId
													+ &quot; and a.organization_id=b.retailer_org_id and b.transaction_id=e.transaction_id&quot;;

<span class="nc" id="L2007">											System.out</span>
													.println(&quot;query for get org name &quot;
															+ retDetailsQuery);
<span class="nc" id="L2010">											resultSet2 = statement2</span>
													.executeQuery(retDetailsQuery);
<span class="nc bnc" id="L2012" title="All 2 branches missed.">											while (resultSet2.next()) {</span>
<span class="nc" id="L2013">												orgname = resultSet2</span>
														.getString(&quot;name&quot;);
<span class="nc" id="L2015">												receiptTime = resultSet2</span>
														.getTimestamp(&quot;transaction_date&quot;);
											}

<span class="nc" id="L2019">											pwtBean.setValid(false);</span>
<span class="nc" id="L2020">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2022">											pwtBean</span>
													.setMessage(&quot;This VIRN No. has been paid to Player by retailer:&quot;
															+ orgname
															+ &quot; on Voucher &quot;
															+ receiptTime
															+ &quot; but not claimed by retailer to agent &quot;);
<span class="nc" id="L2028">											break;</span>
<span class="nc bnc" id="L2029" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CLAIM_PLR_RET_CLM&quot;)) {
											// show info of retailer if
											// available from
											// at retailer PWT

<span class="nc" id="L2035">											String orgname = null;</span>
<span class="nc" id="L2036">											Timestamp receiptTime = null;</span>
<span class="nc" id="L2037">											statement2 = connection</span>
													.createStatement();
											// String agtDetailsQuery=&quot;select
											// name from
											// st_lms_organization_master where
											// organization_id in (select
											// agent_org_id
											// from st_se_bo_pwt where
											// virn_code='&quot;+enVirnCode+&quot;' and
											// game_id=&quot;+gameId+&quot;)&quot;;

											// String agtDetailsQuery=&quot;select
											// a.name,c.generated_id,e.transaction_date
											// from st_lms_organization_master
											// a,st_se_bo_pwt
											// b,st_lms_bo_receipts
											// c,st_lms_bo_transaction_master e
											// where
											// b.virn_code='&quot;+enVirnCode+&quot;' and
											// b.game_id=&quot;+gameId+&quot; and
											// a.organization_id=b.agent_org_id
											// and
											// b.transaction_id=e.transaction_id
											// and
											// c.receipt_id=(select receipt_id
											// from
											// st_lms_bo_receipts_trn_mapping
											// where
											// transaction_id=e.transaction_id)&quot;;
<span class="nc" id="L2066">											String retDetailsQuery = &quot;select a.name,e.transaction_date from st_lms_organization_master a,st_se_retailer_pwt b,st_lms_retailer_transaction_master e where b.virn_code='&quot;</span>
													+ enVirnCode
													+ &quot;' and b.game_id=&quot;
													+ gameId
													+ &quot; and a.organization_id=b.retailer_org_id and b.transaction_id=e.transaction_id&quot;;

<span class="nc" id="L2072">											System.out</span>
													.println(&quot;query for get org name &quot;
															+ retDetailsQuery);
<span class="nc" id="L2075">											resultSet2 = statement2</span>
													.executeQuery(retDetailsQuery);
<span class="nc bnc" id="L2077" title="All 2 branches missed.">											while (resultSet2.next()) {</span>
<span class="nc" id="L2078">												orgname = resultSet2</span>
														.getString(&quot;name&quot;);
<span class="nc" id="L2080">												receiptTime = resultSet2</span>
														.getTimestamp(&quot;transaction_date&quot;);
											}

<span class="nc" id="L2084">											pwtBean.setValid(false);</span>
<span class="nc" id="L2085">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2087">											pwtBean</span>
													.setMessage(&quot;This VIRN No. has been paid to Player by retailer:&quot;
															+ orgname
															+ &quot; on Voucher &quot;
															+ receiptTime
															+ &quot;  As Claimmable &quot;);
<span class="nc" id="L2093">											break;</span>
<span class="nc bnc" id="L2094" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CLAIM_PLR_RET_UNCLM_DIR&quot;)) {
											// show info of retailer if
											// available from
											// at retailer direct player
<span class="nc" id="L2099">											pwtBean.setValid(false);</span>
<span class="nc" id="L2100">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2102">											pwtBean</span>
													.setMessage(&quot;This VIRN No. has been paid to Player by retailer but not claimed by retailer to agent &quot;);
<span class="nc" id="L2104">											break;</span>
<span class="nc bnc" id="L2105" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CLAIM_PLR_RET_CLM_DIR&quot;)) {
											// show info of retailer if
											// available from
											// at retailer derect palyer PWT

<span class="nc" id="L2111">											pwtBean.setValid(false);</span>
<span class="nc" id="L2112">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2114">											pwtBean</span>
													.setMessage(&quot;This VIRN No. has been paid to Player by retailer As Claimmable &quot;);
<span class="nc" id="L2116">											break;</span>
<span class="nc bnc" id="L2117" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CLAIM_RET_TEMP&quot;)) {
<span class="nc" id="L2119">											pwtBean.setValid(false);</span>
<span class="nc" id="L2120">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2122">											pwtBean</span>
													.setMessage(&quot;Already Verified in Bulk Receipt at Agent,Final Payment Pending&quot;);
<span class="nc" id="L2124">											pwtBean.setMessageCode(&quot;112006&quot;);</span>
<span class="nc" id="L2125">											break;</span>
<span class="nc bnc" id="L2126" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CLAIM_RET_CLM&quot;)) {
<span class="nc" id="L2128">											String agtOrgname = null;</span>
<span class="nc" id="L2129">											String retOrgName = null;</span>
<span class="nc" id="L2130">											String receiptNumber = null;</span>
<span class="nc" id="L2131">											Timestamp receiptTime = null;</span>
<span class="nc" id="L2132">											statement2 = connection</span>
													.createStatement();
<span class="nc" id="L2134">											String agtDetailsQuery = &quot;select  b.transaction_date,c.generated_id,(select name from st_lms_organization_master where organization_id=a.retailer_org_id) 'agt_name' ,(select name from st_lms_organization_master where organization_id=a.retailer_org_id) 'ret_name'  from st_se_agent_pwt a,st_lms_agent_transaction_master b,st_lms_agent_receipts c where a.virn_code='&quot;</span>
													+ enVirnCode
													+ &quot;' and a.game_id=&quot;
													+ gameId
													+ &quot; and a.transaction_id=b.transaction_id  and c.receipt_id=(select receipt_id from st_lms_agent_receipts_trn_mapping where transaction_id=b.transaction_id)&quot;;

<span class="nc" id="L2140">											System.out</span>
													.println(&quot;query for get org name &quot;
															+ agtDetailsQuery);
<span class="nc" id="L2143">											resultSet2 = statement2</span>
													.executeQuery(agtDetailsQuery);
<span class="nc bnc" id="L2145" title="All 2 branches missed.">											while (resultSet2.next()) {</span>
<span class="nc" id="L2146">												agtOrgname = resultSet2</span>
														.getString(&quot;agt_name&quot;);
<span class="nc" id="L2148">												retOrgName = resultSet2</span>
														.getString(&quot;ret_name&quot;);
<span class="nc" id="L2150">												receiptNumber = resultSet2</span>
														.getString(&quot;generated_id&quot;);
<span class="nc" id="L2152">												receiptTime = resultSet2</span>
														.getTimestamp(&quot;transaction_date&quot;);
											}
<span class="nc" id="L2155">											pwtBean.setValid(false);</span>
<span class="nc" id="L2156">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2158">											pwtBean</span>
													.setMessage(&quot;Paid to retailer: &quot;
															+ retOrgName
															+ &quot; By Agent: &quot;
															+ agtOrgname
															+ &quot; Voucher Number:&quot;
															+ receiptNumber
															+ &quot; on &quot;
															+ receiptTime
															+ &quot; and pending to claim at bo by agent as uato sarap&quot;);
<span class="nc" id="L2168">											pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L2169">											break;</span>
<span class="nc bnc" id="L2170" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CLAIM_RET_CLM_AUTO&quot;)) {
											// show agent and retailers name
<span class="nc" id="L2173">											String agtOrgname = null;</span>
<span class="nc" id="L2174">											String retOrgName = null;</span>
<span class="nc" id="L2175">											String receiptNumber = null;</span>
<span class="nc" id="L2176">											Timestamp receiptTime = null;</span>
<span class="nc" id="L2177">											statement2 = connection</span>
													.createStatement();
<span class="nc" id="L2179">											String agtDetailsQuery = &quot;select  b.transaction_date,c.generated_id,(select name from st_lms_organization_master where organization_id=a.retailer_org_id) 'agt_name' ,(select name from st_lms_organization_master where organization_id=a.retailer_org_id) 'ret_name'  from st_se_agent_pwt a,st_lms_agent_transaction_master b,st_lms_agent_receipts c where a.virn_code='&quot;</span>
													+ enVirnCode
													+ &quot;' and a.game_id=&quot;
													+ gameId
													+ &quot; and a.transaction_id=b.transaction_id  and c.receipt_id=(select receipt_id from st_lms_agent_receipts_trn_mapping where transaction_id=b.transaction_id)&quot;;

<span class="nc" id="L2185">											System.out</span>
													.println(&quot;query for get org name &quot;
															+ agtDetailsQuery);
<span class="nc" id="L2188">											resultSet2 = statement2</span>
													.executeQuery(agtDetailsQuery);
<span class="nc bnc" id="L2190" title="All 2 branches missed.">											while (resultSet2.next()) {</span>
<span class="nc" id="L2191">												agtOrgname = resultSet2</span>
														.getString(&quot;agt_name&quot;);
<span class="nc" id="L2193">												retOrgName = resultSet2</span>
														.getString(&quot;ret_name&quot;);
<span class="nc" id="L2195">												receiptNumber = resultSet2</span>
														.getString(&quot;generated_id&quot;);
<span class="nc" id="L2197">												receiptTime = resultSet2</span>
														.getTimestamp(&quot;transaction_date&quot;);
											}
<span class="nc" id="L2200">											pwtBean.setValid(false);</span>
<span class="nc" id="L2201">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2203">											pwtBean</span>
													.setMessage(&quot;Paid to retailer: &quot;
															+ retOrgName
															+ &quot; By Agent: &quot;
															+ agtOrgname
															+ &quot; Voucher Number:&quot;
															+ receiptNumber
															+ &quot; on &quot;
															+ receiptTime
															+ &quot; As Auto Scrap and pending to claim at bo as AUTO Scrap&quot;);
<span class="nc" id="L2213">											pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L2214">											break;</span>
<span class="nc bnc" id="L2215" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CLAIM_PLR_RET_TEMP&quot;)) {
<span class="nc" id="L2217">											pwtBean.setValid(false);</span>
<span class="nc" id="L2218">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2220">											pwtBean</span>
													.setMessage(&quot;Already Verified in Bulk Receipt at Agent,Final Payment Pending&quot;);
<span class="nc" id="L2222">											pwtBean.setMessageCode(&quot;112007&quot;);</span>
<span class="nc" id="L2223">											break;</span>
<span class="nc bnc" id="L2224" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;REQUESTED&quot;)) {
											// show request details from request
											// table
											// with history

<span class="nc" id="L2230">											String reqByOrgName = null;</span>
<span class="nc" id="L2231">											String reqToOrgName = null;</span>
<span class="nc" id="L2232">											String reqByType = null;</span>
<span class="nc" id="L2233">											String reqToType = null;</span>
<span class="nc" id="L2234">											String receiptNumber = null;</span>
<span class="nc" id="L2235">											Timestamp receiptTime = null;</span>
<span class="nc" id="L2236">											statement2 = connection</span>
													.createStatement();
<span class="nc" id="L2238">											String reqDetailsQuery = &quot;select a.requester_type,a.requested_to_type,a.request_id,a.request_date,(select name from st_lms_organization_master where organization_id=a.requested_by_org_id) as reqByName,(select name from st_lms_organization_master where organization_id=a.requested_to_org_id) as reqToName from st_se_pwt_approval_request_master a where a.virn_code='&quot;</span>
													+ enVirnCode
													+ &quot;' and a.game_id=&quot;
													+ gameId
													+ &quot; and a.req_status='REQUESTED'&quot;;

<span class="nc" id="L2244">											System.out</span>
													.println(&quot;query for get org name &quot;
															+ reqDetailsQuery);
<span class="nc" id="L2247">											resultSet2 = statement2</span>
													.executeQuery(reqDetailsQuery);
<span class="nc bnc" id="L2249" title="All 2 branches missed.">											while (resultSet2.next()) {</span>
<span class="nc" id="L2250">												reqByOrgName = resultSet2</span>
														.getString(&quot;reqByName&quot;);
<span class="nc" id="L2252">												reqToOrgName = resultSet2</span>
														.getString(&quot;reqToName&quot;);
<span class="nc" id="L2254">												reqByType = resultSet2</span>
														.getString(&quot;requester_type&quot;);
<span class="nc" id="L2256">												reqToType = resultSet2</span>
														.getString(&quot;requested_to_type&quot;);
<span class="nc" id="L2258">												receiptNumber = resultSet2</span>
														.getString(&quot;request_id&quot;);
<span class="nc" id="L2260">												receiptTime = resultSet2</span>
														.getTimestamp(&quot;request_date&quot;);
											}

<span class="nc" id="L2264">											pwtBean.setValid(false);</span>
<span class="nc" id="L2265">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2267">											pwtBean</span>
													.setMessage(&quot;This VIRN is requested by &quot;
															+ reqByType
															+ &quot;: &quot;
															+ reqByOrgName
															+ &quot;To &quot;
															+ reqToType
															+ &quot;: &quot;
															+ reqToOrgName
															+ &quot; for Approval with Voucher id: &quot;
															+ receiptNumber
															+ &quot; on &quot;
															+ receiptTime);
<span class="nc" id="L2280">											pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L2281">											break;</span>
<span class="nc bnc" id="L2282" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;PND_MAS&quot;)) {
											// details of by and to and date and
											// voucher

<span class="nc" id="L2287">											String reqByOrgName = null;</span>
<span class="nc" id="L2288">											String reqToOrgName = null;</span>
<span class="nc" id="L2289">											String reqByType = null;</span>
<span class="nc" id="L2290">											String reqToType = null;</span>
<span class="nc" id="L2291">											String receiptNumber = null;</span>
<span class="nc" id="L2292">											Timestamp receiptTime = null;</span>
<span class="nc" id="L2293">											statement2 = connection</span>
													.createStatement();
<span class="nc" id="L2295">											String reqDetailsQuery = &quot;select a.requester_type,a.requested_to_type,a.request_id,a.request_date,(select name from st_lms_organization_master where organization_id=a.requested_by_org_id) as reqByName,(select name from st_lms_organization_master where organization_id=a.requested_to_org_id) as reqToName from st_se_pwt_approval_request_master a where a.virn_code='&quot;</span>
													+ enVirnCode
													+ &quot;' and a.game_id=&quot;
													+ gameId
													+ &quot; and a.req_status='PND_MAS'&quot;;

<span class="nc" id="L2301">											System.out</span>
													.println(&quot;query for get org name &quot;
															+ reqDetailsQuery);
<span class="nc" id="L2304">											resultSet2 = statement2</span>
													.executeQuery(reqDetailsQuery);
<span class="nc bnc" id="L2306" title="All 2 branches missed.">											while (resultSet2.next()) {</span>
<span class="nc" id="L2307">												reqByOrgName = resultSet2</span>
														.getString(&quot;reqByName&quot;);
<span class="nc" id="L2309">												reqToOrgName = resultSet2</span>
														.getString(&quot;reqToName&quot;);
<span class="nc" id="L2311">												reqByType = resultSet2</span>
														.getString(&quot;requester_type&quot;);
<span class="nc" id="L2313">												reqToType = resultSet2</span>
														.getString(&quot;requested_to_type&quot;);
<span class="nc" id="L2315">												receiptNumber = resultSet2</span>
														.getString(&quot;request_id&quot;);
<span class="nc" id="L2317">												receiptTime = resultSet2</span>
														.getTimestamp(&quot;request_date&quot;);
											}

<span class="nc" id="L2321">											pwtBean.setValid(false);</span>
<span class="nc" id="L2322">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2324">											pwtBean</span>
													.setMessage(&quot;This VIRN is requested by &quot;
															+ reqByType
															+ &quot;: &quot;
															+ reqByOrgName
															+ &quot;To &quot;
															+ reqToType
															+ &quot;: &quot;
															+ reqToOrgName
															+ &quot; for master Approval with Voucher id: &quot;
															+ receiptNumber
															+ &quot; on &quot;
															+ receiptTime);
<span class="nc" id="L2337">											pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L2338">											break;</span>
<span class="nc bnc" id="L2339" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;PND_PAY&quot;)) {
											// show details for payment by and
											// to

<span class="nc" id="L2344">											String reqToOrgName = null;</span>
<span class="nc" id="L2345">											String reqToType = null;</span>
<span class="nc" id="L2346">											String receiptNumber = null;</span>
<span class="nc" id="L2347">											statement2 = connection</span>
													.createStatement();
<span class="nc" id="L2349">											String reqDetailsQuery = &quot;select a.request_id,a.pay_req_for_org_type,(select name from st_lms_organization_master where organization_id=a.pay_request_for_org_id) as payByName from st_se_pwt_approval_request_master a where a.virn_code='&quot;</span>
													+ enVirnCode
													+ &quot;' and a.game_id=&quot;
													+ gameId
													+ &quot; and a.req_status='PND_PAY'&quot;;

<span class="nc" id="L2355">											System.out</span>
													.println(&quot;query for get org name &quot;
															+ reqDetailsQuery);
<span class="nc" id="L2358">											resultSet2 = statement2</span>
													.executeQuery(reqDetailsQuery);
<span class="nc bnc" id="L2360" title="All 2 branches missed.">											while (resultSet2.next()) {</span>

<span class="nc" id="L2362">												reqToOrgName = resultSet2</span>
														.getString(&quot;payByName&quot;);
<span class="nc" id="L2364">												reqToType = resultSet2</span>
														.getString(&quot;pay_req_for_org_type&quot;);
<span class="nc" id="L2366">												receiptNumber = resultSet2</span>
														.getString(&quot;request_id&quot;);
											}

<span class="nc" id="L2370">											pwtBean.setValid(false);</span>
<span class="nc" id="L2371">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2373">											pwtBean</span>
													.setMessage(&quot;This VIRN is requested To &quot;
															+ reqToType
															+ &quot;: &quot;
															+ reqToOrgName
															+ &quot;for payment with Voucher id: &quot;
															+ receiptNumber);
<span class="nc" id="L2380">											pwtBean.setMessageCode(&quot;112009&quot;);</span>
<span class="nc" id="L2381">											break;</span>
<span class="nc bnc" id="L2382" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;CANCELLED_PERMANENT&quot;)) {
<span class="nc" id="L2384">											pwtBean.setValid(false);</span>
<span class="nc" id="L2385">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2387">											pwtBean</span>
													.setMessage(&quot;Tampered/Damaged/Defaced VIRN as noted at BO&quot;);
<span class="nc" id="L2389">											pwtBean.setMessageCode(&quot;112009&quot;);</span>
<span class="nc" id="L2390">											break;</span>
<span class="nc bnc" id="L2391" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;NO_PRIZE_PWT&quot;)) {
<span class="nc" id="L2393">											pwtBean.setValid(false);</span>
<span class="nc" id="L2394">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2396">											pwtBean</span>
													.setMessage(&quot;Non Winning PWT&quot;);
<span class="nc" id="L2398">											pwtBean.setMessageCode(&quot;112009&quot;);</span>
<span class="nc" id="L2399">											break;</span>
<span class="nc bnc" id="L2400" title="All 2 branches missed.">										} else if (prizeStatus</span>
												.equalsIgnoreCase(&quot;MISSING&quot;)) {
<span class="nc" id="L2402">											pwtBean.setValid(false);</span>
<span class="nc" id="L2403">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2405">											pwtBean</span>
													.setMessage(&quot;VIRN is from MISSING Status&quot;);
<span class="nc" id="L2407">											pwtBean.setMessageCode(&quot;&quot;);</span>

										} else {
<span class="nc" id="L2410">											pwtBean.setValid(false);</span>
<span class="nc" id="L2411">											pwtBean</span>
													.setVerificationStatus(&quot;InValid Virn&quot;);
<span class="nc" id="L2413">											pwtBean</span>
													.setMessage(&quot;UNDEFINED STATUS OF PWT:: &quot;
															+ prizeStatus);
<span class="nc" id="L2416">											pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L2417">											break;</span>
										}
										
									}else{
<span class="nc" id="L2421">										pwtBean.setValid(false);</span>
<span class="nc" id="L2422">										pwtBean.setVerificationStatus(&quot;InValid Virn&quot;);</span>
<span class="nc" id="L2423">										pwtBean	.setMessage(&quot;Invalid Virn&quot;);</span>
<span class="nc" id="L2424">										pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L2425">										break;</span>
									}		
									} else {
                                        
										
<span class="nc" id="L2430">										pwtBean.setValid(false);</span>
<span class="nc" id="L2431">										pwtBean.setVerificationStatus(&quot;InValid Ticket&quot;);</span>
<span class="nc" id="L2432">										pwtBean.setMessage(&quot;Ticket Number is not correct&quot;);</span>
<span class="nc" id="L2433">										pwtBean.setTicketValid(false);</span>
<span class="nc" id="L2434">										pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L2435">										break;</span>
										
										/*pwtBean.setValid(false);
										pwtBean
												.setVerificationStatus(&quot;InValid Virn&quot;);
										pwtBean
												.setMessage(&quot;Ticket and Virn mapping is not correct&quot;);
										pwtBean.setTicketValid(false);
										pwtBean.setMessageCode(&quot;TBD&quot;);
										break;*/
									}
									
									
									
								} else {
<span class="nc" id="L2450">									System.out.println(&quot;Yogesh Ticket is not valid @ BO : &quot;	+ pwtBean.getTicketNumber());</span>
									// Ticket is not valid
<span class="nc" id="L2452">									pwtBean.setValid(false);</span>
<span class="nc" id="L2453">									pwtBean.setVerificationStatus(&quot;InValid Virn&quot;);</span>
<span class="nc" id="L2454">									pwtBean.setMessage(&quot;Ticket is not valid and virn not verified&quot;);</span>
<span class="nc" id="L2455">									pwtBean.setMessageCode(&quot;TBD&quot;);</span>
<span class="nc" id="L2456">									break;</span>
								}
								
							}
							
							
							

						}

					}

<span class="nc" id="L2468">				} catch (SQLException e) {</span>

<span class="nc" id="L2470">					e.printStackTrace();</span>
<span class="nc" id="L2471">					throw new LMSException(e);</span>
				} finally {

<span class="nc" id="L2474">					try {</span>

<span class="nc bnc" id="L2476" title="All 4 branches missed.">						if (statement != null) {</span>
<span class="nc" id="L2477">							statement.close();</span>
						}
						/*
						 * if (connection != null) { connection.close(); }
						 */
<span class="nc" id="L2482">					} catch (SQLException se) {</span>
<span class="nc" id="L2483">						se.printStackTrace();</span>
<span class="nc" id="L2484">					}</span>
<span class="nc" id="L2485">				}</span>

			}
		}

<span class="nc" id="L2490">		return isVerified;</span>

	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>