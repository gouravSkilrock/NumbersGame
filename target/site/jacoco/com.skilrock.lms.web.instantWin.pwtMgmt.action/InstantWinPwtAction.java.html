<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>InstantWinPwtAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.web.instantWin.pwtMgmt.action</a> &gt; <span class="el_source">InstantWinPwtAction.java</span></div><h1>InstantWinPwtAction.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.web.instantWin.pwtMgmt.action;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpSession;

import com.skilrock.lms.beans.PlayerBean;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.BaseAction;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.coreEngine.instantWin.common.IWException;
import com.skilrock.lms.coreEngine.scratchService.pwtMgmt.common.PlayerVerifyHelperForApp;
import com.skilrock.lms.instantWin.javaBeans.VerifyTicketResponseBean;
import com.skilrock.lms.web.instantWin.pwtMgmt.daoImpl.InstantWinPwtService;

public class InstantWinPwtAction extends BaseAction {
	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	private VerifyTicketResponseBean verifyTicketResponseBean;
	private String ticketNbr;
	
	private String firstName;
	private String lastName;
	private String idType;
	private String idNumber;
	private String emailId;
	private String phone;
	private String plrAddr1;
	private String plrAddr2;
	private String state;
	private String city;
	private String plrCountry;
	private String plrPin;
	private String bankBranch;
	private String bankName;
	private String locationCity;
	private String bankAccNbr;

	private String plrAlreadyReg;
	private String playerType;
	private int playerId;
	
	private String tktNbr;
	private String tktStatus;
	private String paymentTime;
	private double winningAmt;
	private String purchaseTime;
	private String tktData;
	private String claimTime;
	private String purchasedFrom;
	private boolean paymentAllowed;
	private String iwTransactionId;
	private int errorCode;
	private String errorMsg;
	private boolean isPlayerReg;
	
	public InstantWinPwtAction() {
<span class="nc" id="L62">		super(InstantWinPwtAction.class);</span>
<span class="nc" id="L63">	}</span>

	public VerifyTicketResponseBean getVerifyTicketResponseBean() {
<span class="nc" id="L66">		return verifyTicketResponseBean;</span>
	}

	public void setVerifyTicketResponseBean(
			VerifyTicketResponseBean verifyTicketResponseBean) {
<span class="nc" id="L71">		this.verifyTicketResponseBean = verifyTicketResponseBean;</span>
<span class="nc" id="L72">	}</span>

	public String getTicketNbr() {
<span class="nc" id="L75">		return ticketNbr;</span>
	}

	public void setTicketNbr(String ticketNbr) {
<span class="nc" id="L79">		this.ticketNbr = ticketNbr;</span>
<span class="nc" id="L80">	}</span>
	
	public String getFirstName() {
<span class="nc" id="L83">		return firstName;</span>
	}

	public void setFirstName(String firstName) {
<span class="nc" id="L87">		this.firstName = firstName;</span>
<span class="nc" id="L88">	}</span>

	public String getLastName() {
<span class="nc" id="L91">		return lastName;</span>
	}

	public void setLastName(String lastName) {
<span class="nc" id="L95">		this.lastName = lastName;</span>
<span class="nc" id="L96">	}</span>

	public String getIdType() {
<span class="nc" id="L99">		return idType;</span>
	}

	public void setIdType(String idType) {
<span class="nc" id="L103">		this.idType = idType;</span>
<span class="nc" id="L104">	}</span>

	public String getIdNumber() {
<span class="nc" id="L107">		return idNumber;</span>
	}

	public void setIdNumber(String idNumber) {
<span class="nc" id="L111">		this.idNumber = idNumber;</span>
<span class="nc" id="L112">	}</span>

	public String getEmailId() {
<span class="nc" id="L115">		return emailId;</span>
	}

	public void setEmailId(String emailId) {
<span class="nc" id="L119">		this.emailId = emailId;</span>
<span class="nc" id="L120">	}</span>

	public String getPhone() {
<span class="nc" id="L123">		return phone;</span>
	}

	public void setPhone(String phone) {
<span class="nc" id="L127">		this.phone = phone;</span>
<span class="nc" id="L128">	}</span>

	public String getPlrAddr1() {
<span class="nc" id="L131">		return plrAddr1;</span>
	}

	public void setPlrAddr1(String plrAddr1) {
<span class="nc" id="L135">		this.plrAddr1 = plrAddr1;</span>
<span class="nc" id="L136">	}</span>

	public String getPlrAddr2() {
<span class="nc" id="L139">		return plrAddr2;</span>
	}

	public void setPlrAddr2(String plrAddr2) {
<span class="nc" id="L143">		this.plrAddr2 = plrAddr2;</span>
<span class="nc" id="L144">	}</span>

	public String getState() {
<span class="nc" id="L147">		return state;</span>
	}

	public void setState(String state) {
<span class="nc" id="L151">		this.state = state;</span>
<span class="nc" id="L152">	}</span>

	public String getCity() {
<span class="nc" id="L155">		return city;</span>
	}

	public void setCity(String city) {
<span class="nc" id="L159">		this.city = city;</span>
<span class="nc" id="L160">	}</span>

	public String getPlrCountry() {
<span class="nc" id="L163">		return plrCountry;</span>
	}

	public void setPlrCountry(String plrCountry) {
<span class="nc" id="L167">		this.plrCountry = plrCountry;</span>
<span class="nc" id="L168">	}</span>

	public String getPlrPin() {
<span class="nc" id="L171">		return plrPin;</span>
	}

	public void setPlrPin(String plrPin) {
<span class="nc" id="L175">		this.plrPin = plrPin;</span>
<span class="nc" id="L176">	}</span>

	public String getBankBranch() {
<span class="nc" id="L179">		return bankBranch;</span>
	}

	public void setBankBranch(String bankBranch) {
<span class="nc" id="L183">		this.bankBranch = bankBranch;</span>
<span class="nc" id="L184">	}</span>

	public String getBankName() {
<span class="nc" id="L187">		return bankName;</span>
	}

	public void setBankName(String bankName) {
<span class="nc" id="L191">		this.bankName = bankName;</span>
<span class="nc" id="L192">	}</span>

	public String getLocationCity() {
<span class="nc" id="L195">		return locationCity;</span>
	}

	public void setLocationCity(String locationCity) {
<span class="nc" id="L199">		this.locationCity = locationCity;</span>
<span class="nc" id="L200">	}</span>

	public String getBankAccNbr() {
<span class="nc" id="L203">		return bankAccNbr;</span>
	}

	public void setBankAccNbr(String bankAccNbr) {
<span class="nc" id="L207">		this.bankAccNbr = bankAccNbr;</span>
<span class="nc" id="L208">	}</span>

	public String getPlrAlreadyReg() {
<span class="nc" id="L211">		return plrAlreadyReg;</span>
	}

	public void setPlrAlreadyReg(String plrAlreadyReg) {
<span class="nc" id="L215">		this.plrAlreadyReg = plrAlreadyReg;</span>
<span class="nc" id="L216">	}</span>

	public String getPlayerType() {
<span class="nc" id="L219">		return playerType;</span>
	}

	public void setPlayerType(String playerType) {
<span class="nc" id="L223">		this.playerType = playerType;</span>
<span class="nc" id="L224">	}</span>

	public int getPlayerId() {
<span class="nc" id="L227">		return playerId;</span>
	}

	public void setPlayerId(int playerId) {
<span class="nc" id="L231">		this.playerId = playerId;</span>
<span class="nc" id="L232">	}</span>
	
	public String getTktNbr() {
<span class="nc" id="L235">		return tktNbr;</span>
	}

	public void setTktNbr(String tktNbr) {
<span class="nc" id="L239">		this.tktNbr = tktNbr;</span>
<span class="nc" id="L240">	}</span>

	public String getTktStatus() {
<span class="nc" id="L243">		return tktStatus;</span>
	}

	public void setTktStatus(String tktStatus) {
<span class="nc" id="L247">		this.tktStatus = tktStatus;</span>
<span class="nc" id="L248">	}</span>

	public String getPaymentTime() {
<span class="nc" id="L251">		return paymentTime;</span>
	}

	public void setPaymentTime(String paymentTime) {
<span class="nc" id="L255">		this.paymentTime = paymentTime;</span>
<span class="nc" id="L256">	}</span>

	public double getWinningAmt() {
<span class="nc" id="L259">		return winningAmt;</span>
	}

	public void setWinningAmt(double winningAmt) {
<span class="nc" id="L263">		this.winningAmt = winningAmt;</span>
<span class="nc" id="L264">	}</span>

	public String getPurchaseTime() {
<span class="nc" id="L267">		return purchaseTime;</span>
	}

	public void setPurchaseTime(String purchaseTime) {
<span class="nc" id="L271">		this.purchaseTime = purchaseTime;</span>
<span class="nc" id="L272">	}</span>

	public String getTktData() {
<span class="nc" id="L275">		return tktData;</span>
	}

	public void setTktData(String tktData) {
<span class="nc" id="L279">		this.tktData = tktData;</span>
<span class="nc" id="L280">	}</span>

	public String getClaimTime() {
<span class="nc" id="L283">		return claimTime;</span>
	}

	public void setClaimTime(String claimTime) {
<span class="nc" id="L287">		this.claimTime = claimTime;</span>
<span class="nc" id="L288">	}</span>

	public String getPurchasedFrom() {
<span class="nc" id="L291">		return purchasedFrom;</span>
	}

	public void setPurchasedFrom(String purchasedFrom) {
<span class="nc" id="L295">		this.purchasedFrom = purchasedFrom;</span>
<span class="nc" id="L296">	}</span>

	public boolean isPaymentAllowed() {
<span class="nc" id="L299">		return paymentAllowed;</span>
	}

	public void setPaymentAllowed(boolean paymentAllowed) {
<span class="nc" id="L303">		this.paymentAllowed = paymentAllowed;</span>
<span class="nc" id="L304">	}</span>

	public String getIwTransactionId() {
<span class="nc" id="L307">		return iwTransactionId;</span>
	}

	public void setIwTransactionId(String iwTransactionId) {
<span class="nc" id="L311">		this.iwTransactionId = iwTransactionId;</span>
<span class="nc" id="L312">	}</span>

	public int getErrorCode() {
<span class="nc" id="L315">		return errorCode;</span>
	}

	public void setErrorCode(int errorCode) {
<span class="nc" id="L319">		this.errorCode = errorCode;</span>
<span class="nc" id="L320">	}</span>

	public String getErrorMsg() {
<span class="nc" id="L323">		return errorMsg;</span>
	}

	public void setErrorMsg(String errorMsg) {
<span class="nc" id="L327">		this.errorMsg = errorMsg;</span>
<span class="nc" id="L328">	}</span>

	public boolean isPlayerReg() {
<span class="nc" id="L331">		return isPlayerReg;</span>
	}

	public void setPlayerReg(boolean isPlayerReg) {
<span class="nc" id="L335">		this.isPlayerReg = isPlayerReg;</span>
<span class="nc" id="L336">	}</span>

	@Override
	public String execute() throws Exception {
<span class="nc" id="L340">		return SUCCESS;</span>
	}

	public String fetchVerifyTicketData() {
<span class="nc" id="L344">		UserInfoBean userInfoBean = (UserInfoBean) getSession().getAttribute(&quot;USER_INFO&quot;);</span>
		try {
<span class="nc" id="L346">			verifyTicketResponseBean = new InstantWinPwtService().fetchVerifyTicketData(ticketNbr, userInfoBean);</span>
<span class="nc" id="L347">		} catch (IWException e) {</span>
<span class="nc" id="L348">			e.printStackTrace();</span>
<span class="nc" id="L349">		} catch (Exception e) {</span>
<span class="nc" id="L350">			e.printStackTrace();</span>
<span class="nc" id="L351">		}</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">		if(verifyTicketResponseBean.isPlayerReg()) {</span>
<span class="nc" id="L353">			return &quot;register&quot;;</span>
		} else
<span class="nc" id="L355">			return SUCCESS;</span>
	}
	
	public String payPwtTicket() {
<span class="nc" id="L359">		UserInfoBean userInfoBean = (UserInfoBean) getSession().getAttribute(&quot;USER_INFO&quot;);</span>
		try {
<span class="nc" id="L361">			verifyTicketResponseBean = new InstantWinPwtService().payPwtTicket(ticketNbr, playerId, userInfoBean);</span>
<span class="nc" id="L362">		} catch (IWException e) {</span>
<span class="nc" id="L363">			e.printStackTrace();</span>
<span class="nc" id="L364">		} catch (Exception e) {</span>
<span class="nc" id="L365">			e.printStackTrace();</span>
<span class="nc" id="L366">		}</span>
<span class="nc" id="L367">		return SUCCESS;</span>
	}
	
	public String fetchPlayerDetails() throws LMSException {
<span class="nc" id="L371">		PlayerVerifyHelperForApp searchPlayerHelper = new PlayerVerifyHelperForApp();</span>
<span class="nc" id="L372">		Map&lt;String, Object&gt; playerBeanMap = searchPlayerHelper.searchPlayer(firstName, lastName, idNumber, idType);</span>
<span class="nc" id="L373">		PlayerBean plrBean = (PlayerBean) playerBeanMap.get(&quot;plrBean&quot;);</span>
<span class="nc" id="L374">		HttpSession session = request.getSession();</span>
<span class="nc" id="L375">		session.setAttribute(&quot;playerBean&quot;, plrBean);</span>
<span class="nc" id="L376">		String plrAlreadyReg = &quot;NO&quot;;</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">		if (plrBean != null) {</span>
<span class="nc" id="L378">			plrAlreadyReg = &quot;YES&quot;;</span>
		}
<span class="nc" id="L380">		List&lt;String&gt; countryList = (ArrayList&lt;String&gt;) playerBeanMap.get(&quot;countryList&quot;);</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">		if (countryList == null) {</span>
<span class="nc" id="L382">			countryList = new ArrayList&lt;String&gt;();</span>
		}
<span class="nc" id="L384">		session.setAttribute(&quot;countryList&quot;, countryList);</span>
<span class="nc" id="L385">		session.setAttribute(&quot;plrAlreadyReg&quot;, plrAlreadyReg);</span>
<span class="nc" id="L386">		return SUCCESS;</span>
	}
	
	/**
	 * Player registration process
	 * 
	 * @return
	 * @throws LMSException
	 */
	public String plrRegistrationAndApprovalReq() throws LMSException {
<span class="nc" id="L396">		PlayerBean plrBean = null;</span>
<span class="nc" id="L397">		UserInfoBean userInfoBean = (UserInfoBean) getSession().getAttribute(&quot;USER_INFO&quot;);</span>
<span class="nc" id="L398">		System.out.println(&quot;plrAlreadyReg = &quot; + plrAlreadyReg + &quot;  , playerType = &quot; + playerType + &quot;  , playerId = &quot; + playerId);</span>
<span class="nc bnc" id="L399" title="All 4 branches missed.">		if (!&quot;YES&quot;.equalsIgnoreCase(plrAlreadyReg.trim()) &amp;&amp; &quot;player&quot;.equalsIgnoreCase(playerType.trim())) {</span>
<span class="nc" id="L400">			plrBean = new PlayerBean();</span>
<span class="nc" id="L401">			plrBean.setFirstName(firstName);</span>
<span class="nc" id="L402">			plrBean.setLastName(lastName);</span>
<span class="nc" id="L403">			plrBean.setIdType(idType);</span>
<span class="nc" id="L404">			plrBean.setIdNumber(idNumber);</span>
<span class="nc" id="L405">			plrBean.setEmailId(emailId);</span>
<span class="nc" id="L406">			plrBean.setPhone(phone);</span>
<span class="nc" id="L407">			plrBean.setPlrAddr1(plrAddr1);</span>
<span class="nc" id="L408">			plrBean.setPlrAddr2(plrAddr2);</span>
<span class="nc" id="L409">			plrBean.setPlrState(state);</span>
<span class="nc" id="L410">			plrBean.setPlrCity(city);</span>
<span class="nc" id="L411">			plrBean.setPlrCountry(plrCountry);</span>
<span class="nc" id="L412">			plrBean.setPlrPin(Long.parseLong(plrPin));</span>
<span class="nc" id="L413">			plrBean.setBankName(bankName);</span>
<span class="nc" id="L414">			plrBean.setBankBranch(bankBranch);</span>
<span class="nc" id="L415">			plrBean.setLocationCity(locationCity);</span>
<span class="nc" id="L416">			plrBean.setBankAccNbr(bankAccNbr);</span>
<span class="nc" id="L417">			System.out.println(&quot;Inside player registration 11111 &amp; plrBean is &quot; + plrBean);</span>
		}

		try {
<span class="nc bnc" id="L421" title="All 2 branches missed.">			if(plrBean != null)</span>
<span class="nc" id="L422">				playerId = new InstantWinPwtService().registerPlayer(plrBean);</span>
<span class="nc bnc" id="L423" title="All 2 branches missed.">			if(playerId == 0)</span>
<span class="nc" id="L424">				playerId = -1;</span>
<span class="nc" id="L425">			verifyTicketResponseBean = new InstantWinPwtService().payPwtTicket(tktNbr, playerId, userInfoBean);</span>
			/*verifyTicketResponseBean = new VerifyTicketResponseBean();
			verifyTicketResponseBean.setTktNbr(tktNbr);
			verifyTicketResponseBean.setPurchaseTime(purchaseTime);
			verifyTicketResponseBean.setPurchasedFrom(purchasedFrom);
			verifyTicketResponseBean.setTktData(tktData);
			verifyTicketResponseBean.setTktStatus(tktStatus);
			verifyTicketResponseBean.setWinningAmt(winningAmt);
			verifyTicketResponseBean.setErrorCode(errorCode);
			verifyTicketResponseBean.setErrorMsg(errorMsg);
			verifyTicketResponseBean.setPaymentAllowed(true);*/
<span class="nc" id="L436">			System.out.println(verifyTicketResponseBean);</span>
<span class="nc" id="L437">		} catch (Exception e) {</span>
			// TODO: handle exception
<span class="nc" id="L439">		}</span>
<span class="nc" id="L440">		return SUCCESS;</span>
	}

}

</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>