<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DrawGameRPOS.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.android.drawGames.playMgmt.action</a> &gt; <span class="el_source">DrawGameRPOS.java</span></div><h1>DrawGameRPOS.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.android.drawGames.playMgmt.action;

import java.io.PrintWriter;
import java.text.NumberFormat;
import java.util.Date;
import java.util.List;
import java.util.Map;

import javax.servlet.ServletContext;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.struts2.ServletActionContext;

import com.google.gson.JsonArray;
import com.google.gson.JsonObject;
import com.opensymphony.xwork2.ActionContext;
import com.skilrock.lms.ajax.AjaxRequestHelper;
import com.skilrock.lms.android.drawGames.common.AndroidErrors;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.BaseAction;
import com.skilrock.lms.common.ConfigurationVariables;
import com.skilrock.lms.common.filter.LMSFilterDispatcher;
import com.skilrock.lms.common.utility.LMSUtility;
import com.skilrock.lms.coreEngine.drawGames.playMgmt.DrawGameRPOSHelper;
import com.skilrock.lms.coreEngine.drawGames.playMgmt.MpesaPaymentProcessHelper;
import com.skilrock.lms.dge.beans.DrawIdBean;
import com.skilrock.lms.dge.beans.FortunePurchaseBean;
import com.skilrock.lms.dge.beans.FortuneThreePurchaseBean;
import com.skilrock.lms.dge.beans.FortuneTwoPurchaseBean;
import com.skilrock.lms.dge.beans.KenoPurchaseBean;
import com.skilrock.lms.dge.beans.LottoPurchaseBean;
import com.skilrock.lms.dge.beans.MainPWTDrawBean;
import com.skilrock.lms.dge.beans.PWTDrawBean;
import com.skilrock.lms.dge.beans.PanelIdBean;
import com.skilrock.lms.dge.beans.RaffleDrawIdBean;
import com.skilrock.lms.dge.beans.RafflePurchaseBean;
import com.skilrock.lms.embedded.drawGames.common.CommonMethods;
import com.skilrock.lms.embedded.drawGames.common.ReprintHepler;
import com.skilrock.lms.web.drawGames.common.Util;
import com.skilrock.lms.web.drawGames.common.UtilApplet;

public class DrawGameRPOS extends BaseAction {
	private static final long serialVersionUID = 1L;

	public DrawGameRPOS() {
<span class="nc" id="L47">		super(DrawGameRPOS.class);</span>
<span class="nc" id="L48">	}</span>

<span class="nc" id="L50">	HttpSession session = null;</span>
	private String userName;
	private String mobileNo;
	private long LSTktNo;
	private String mPesa;
	
	public void reprintTicketInJsonFormat() throws Exception {
<span class="nc" id="L57">		PrintWriter out = response.getWriter();</span>
<span class="nc" id="L58">		JsonObject jsonResponse = new JsonObject();</span>
<span class="nc" id="L59">		com.skilrock.lms.embedded.drawGames.common.DrawGameRPOS rpos = new  com.skilrock.lms.embedded.drawGames.common.DrawGameRPOS();</span>

<span class="nc" id="L61">		ServletContext sc = ServletActionContext.getServletContext();</span>
<span class="nc" id="L62">		Map currentUserSessionMap = (Map) sc.getAttribute(&quot;LOGGED_IN_USERS&quot;);</span>
<span class="nc" id="L63">		String isDraw = (String) sc.getAttribute(&quot;IS_DRAW&quot;);</span>
<span class="nc" id="L64">		String countryDeployed = (String) sc.getAttribute(&quot;COUNTRY_DEPLOYED&quot;);</span>
<span class="nc" id="L65">		response.setCharacterEncoding(&quot;UTF-8&quot;);</span>
<span class="nc" id="L66">		response.setContentType(&quot;text/html&quot;);</span>
<span class="nc bnc" id="L67" title="All 2 branches missed.">		if (isDraw.equalsIgnoreCase(&quot;NO&quot;)) {</span>
<span class="nc" id="L68">			response.getOutputStream().write(</span>
					(&quot;ErrorMsg:&quot; + AndroidErrors.DRAW_GAME_NOT_AVAILABLE+&quot;ErrorCode:&quot; + AndroidErrors.DRAW_GAME_NOT_AVAILABLE_ERROR_CODE+&quot;|&quot;)
					.getBytes());

		} else {
			/*
			 * logger.debug(&quot; LOGGED_IN_USERS maps is &quot; +
			 * currentUserSessionMap);
			 */

			// logger.debug(&quot; user name is &quot; + userName);
<span class="nc" id="L79">			HttpSession session = (HttpSession) currentUserSessionMap</span>
			.get(userName);

<span class="nc" id="L82">			UserInfoBean userInfoBean = (UserInfoBean) session</span>
			.getAttribute(&quot;USER_INFO&quot;);
			// logger.debug(&quot;Before--&quot; + new Date());
<span class="nc" id="L85">			DrawGameRPOSHelper helper = new DrawGameRPOSHelper();</span>

<span class="nc" id="L87">			String refMerchantId = (String) sc.getAttribute(&quot;REF_MERCHANT_ID&quot;);</span>
<span class="nc" id="L88">			int autoCancelHoldDays=Integer.parseInt((String) sc.getAttribute(&quot;AUTO_CANCEL_CLOSER_DAYS&quot;));</span>
<span class="nc" id="L89">			long lastPrintedTicket=0;</span>
<span class="nc" id="L90">			int gameId = 0;</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">			if(LSTktNo !=0){</span>
<span class="nc" id="L92">				lastPrintedTicket = LSTktNo/Util.getDivValueForLastSoldTkt(String.valueOf(LSTktNo).length());</span>
<span class="nc" id="L93">				gameId = Util.getGameIdFromGameNumber(Util.getGamenoFromTktnumber(String.valueOf(LSTktNo)));</span>
			}

<span class="nc" id="L96">			String actionName=ActionContext.getContext().getName();</span>
<span class="nc" id="L97">			helper.checkLastPrintedTicketStatusAndUpdate(userInfoBean,lastPrintedTicket,&quot;TERMINAL&quot;,refMerchantId,autoCancelHoldDays,actionName, gameId);</span>

<span class="nc" id="L99">			Object gameBean = helper.reprintTicket(userInfoBean, false, null,</span>
					true,null,&quot;TERMINAL&quot;);
<span class="nc" id="L101">			String gameName = null;</span>
			// logger.debug(&quot;BEFORE REPRINT CALL&quot;);

			//AjaxRequestHelper ajxHelper = new AjaxRequestHelper();
			//ajxHelper.getAvlblCreditAmt(userInfoBean);

<span class="nc" id="L107">			double bal = userInfoBean.getAvailableCreditLimit()</span>
			- userInfoBean.getClaimableBal();
<span class="nc" id="L109">			NumberFormat nFormat = NumberFormat.getInstance();</span>
<span class="nc" id="L110">			nFormat.setMinimumFractionDigits(2);</span>
<span class="nc" id="L111">			String balance =  nFormat.format(bal).replace(&quot;,&quot;, &quot;&quot;);</span>

			/*String balance = bal + &quot;00&quot;;
			balance = balance.substring(0, balance.indexOf(&quot;.&quot;) + 3);*/
<span class="nc" id="L115">			String finalReprintData = null;</span>

<span class="nc" id="L117">			StringBuilder topMsgsStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L118">			StringBuilder bottomMsgsStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L119">			String advtMsg = &quot;&quot;;</span>

<span class="nc bnc" id="L121" title="All 2 branches missed.">			if(gameBean instanceof RafflePurchaseBean) {</span>
<span class="nc" id="L122">				RafflePurchaseBean bean = (RafflePurchaseBean) gameBean;</span>

<span class="nc" id="L124">				UtilApplet.getAdvMsgs(bean.getAdvMsg(), topMsgsStr, bottomMsgsStr, 10);</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">				if (topMsgsStr.length() != 0) {</span>
<span class="nc" id="L126">					advtMsg = &quot;topAdvMsg:&quot; + topMsgsStr + &quot;|&quot;;</span>
				}
<span class="nc bnc" id="L128" title="All 2 branches missed.">				if (bottomMsgsStr.length() != 0) {</span>
<span class="nc" id="L129">					advtMsg = advtMsg + &quot;bottomAdvMsg:&quot; + bottomMsgsStr + &quot;|&quot;;</span>
				}
<span class="nc" id="L131">				String time = bean.getPurchaseTime().replace(&quot; &quot;,&quot;|Time:&quot;);</span>
<span class="nc" id="L132">				String drawDateTime = bean.getDrawDateTime().split(&quot;\\*&quot;)[0].replace(&quot; &quot;,&quot;|Time:&quot;);</span>
<span class="nc" id="L133">				String drawName = bean.getDrawDateTime().split(&quot;\\*&quot;)[1];</span>

<span class="nc" id="L135">				StringBuilder finalData = new StringBuilder(&quot;RaffleData:&quot;);</span>
<span class="nc" id="L136">				finalData.append(&quot;TicNo:&quot;).append(bean.getRaffleTicket_no()).append(bean.getReprintCount());</span>
<span class="nc" id="L137">				finalData.append(&quot;|brCd:&quot;).append(bean.getRaffleTicket_no()).append(bean.getReprintCount()).append(bean.getBarcodeCount());</span>
<span class="nc" id="L138">				finalData.append(&quot;|Date:&quot;).append(time);</span>
<span class="nc" id="L139">				finalData.append(&quot;|GameName:&quot;).append(bean.getGameDispName());</span>
<span class="nc" id="L140">				finalData.append(&quot;|DrawDate:&quot;).append(drawDateTime);</span>
<span class="nc" id="L141">				finalData.append(&quot;|DrawName:&quot;).append(drawName);</span>
<span class="nc" id="L142">				finalData.append(advtMsg);</span>
<span class="nc" id="L143">				finalReprintData = finalData.toString();</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">			} else if (gameBean instanceof FortunePurchaseBean) {</span>
<span class="nc" id="L145">				FortunePurchaseBean bean = (FortunePurchaseBean) gameBean;</span>
<span class="nc" id="L146">				UtilApplet.getAdvMsgs(bean.getAdvMsg(), topMsgsStr,</span>
						bottomMsgsStr, 10);

<span class="nc bnc" id="L149" title="All 2 branches missed.">				if (topMsgsStr.length() != 0) {</span>
<span class="nc" id="L150">					advtMsg = &quot;topAdvMsg:&quot; + topMsgsStr + &quot;|&quot;;</span>
				}

<span class="nc bnc" id="L153" title="All 2 branches missed.">				if (bottomMsgsStr.length() != 0) {</span>
<span class="nc" id="L154">					advtMsg = advtMsg + &quot;bottomAdvMsg:&quot; + bottomMsgsStr + &quot;|&quot;;</span>
				}
<span class="nc bnc" id="L156" title="All 2 branches missed.">				if (bean.getSaleStatus() == &quot;PERFORMED&quot;) {</span>
<span class="nc" id="L157">					finalReprintData = &quot;ErrorMsg:&quot;</span>
						+ AndroidErrors.DRAW_PERFORMED+&quot;ErrorCode:&quot; + AndroidErrors.DRAW_PERFORMED_ERROR_CODE+&quot;|&quot;;
					// logger.debug(&quot;FINAL REPRINT DATA:&quot; +
					// finalReprintData);
<span class="nc" id="L161">					response.getOutputStream().write(</span>
							finalReprintData.getBytes());
<span class="nc" id="L163">					return;</span>
				}
<span class="nc" id="L165">				gameName = Util.getGameName(bean.getGameId());</span>
				// logger.debug(&quot;BEFORE REPRINT CALL--------&quot; + gameName);
<span class="nc" id="L167">				String reprintData = ReprintHepler.reprintFortuneTicket(bean,</span>
						gameName);
				
<span class="nc" id="L170">				String promoData = rpos.buildPromoReprintData(bean</span>
						.getPromoPurchaseBean(),userInfoBean,countryDeployed);
				/*
				 * //here get the data for raffel games List&lt;RafflePurchaseBean&gt;
				 * rafflePurchaseBeanList= bean.getRafflePurchaseBeanList();
				 * String raffleData =
				 * CommonMethods.buildRaffleData(rafflePurchaseBeanList);
				 */

<span class="nc" id="L179">				finalReprintData = reprintData + &quot;|balance:&quot; + balance + &quot;|QP:&quot;</span>
				+ bean.getIsQuickPick()[0] +&quot;|ExpiryTime:&quot;+bean.getClaimEndTime().replace(&quot;.0&quot;, &quot;&quot;)+ &quot;|&quot; + advtMsg + promoData;
<span class="nc bnc" id="L181" title="All 2 branches missed.">			} else if (gameBean instanceof LottoPurchaseBean) {</span>
<span class="nc" id="L182">				LottoPurchaseBean bean = (LottoPurchaseBean) gameBean;</span>
<span class="nc" id="L183">				UtilApplet.getAdvMsgs(bean.getAdvMsg(), topMsgsStr,</span>
						bottomMsgsStr, 10);

<span class="nc bnc" id="L186" title="All 2 branches missed.">				if (topMsgsStr.length() != 0) {</span>
<span class="nc" id="L187">					advtMsg = &quot;topAdvMsg:&quot; + topMsgsStr + &quot;|&quot;;</span>
				}

<span class="nc bnc" id="L190" title="All 2 branches missed.">				if (bottomMsgsStr.length() != 0) {</span>
<span class="nc" id="L191">					advtMsg = advtMsg + &quot;bottomAdvMsg:&quot; + bottomMsgsStr + &quot;|&quot;;</span>
				}
<span class="nc bnc" id="L193" title="All 2 branches missed.">				if (bean.getSaleStatus() == &quot;PERFORMED&quot;) {</span>
<span class="nc" id="L194">					finalReprintData = &quot;ErrorMsg:&quot;</span>
						+ AndroidErrors.DRAW_PERFORMED+&quot;ErrorCode:&quot; + AndroidErrors.DRAW_PERFORMED_ERROR_CODE+&quot;|&quot;;
					
<span class="nc" id="L197">					logger.debug(&quot;FINAL REPRINT DATA:&quot; + finalReprintData);</span>
<span class="nc" id="L198">					response.getOutputStream().write(</span>
							finalReprintData.getBytes());
<span class="nc" id="L200">					return;</span>
				}
<span class="nc" id="L202">				gameName = Util.getGameName(bean.getGame_no());</span>
				// logger.debug(&quot;BEFORE REPRINT CALL--------&quot; + gameName);
<span class="nc" id="L204">				String reprintData = ReprintHepler.reprintLottoTicket(bean,</span>
						gameName);

				// String promoData
				// =buildPromoReprintData(bean.getPromoPurchaseBean());
				/*
				 * //here get the data for raffel games List&lt;RafflePurchaseBean&gt;
				 * rafflePurchaseBeanList= bean.getRafflePurchaseBeanList();
				 * String raffleData =
				 * CommonMethods.buildRaffleData(rafflePurchaseBeanList);
				 */
				/*
				 * response.getOutputStream().write( (reprintData + &quot;|balance:&quot;
				 * + bal + &quot;|QP:&quot; + bean.getIsQuickPick()[0] +
				 * &quot;|&quot;+promoData).getBytes());
				 */

<span class="nc" id="L221">				List&lt;RafflePurchaseBean&gt; rafflePurchaseBeanList = bean</span>
				.getRafflePurchaseBeanList();
<span class="nc" id="L223">				String raffleData = CommonMethods</span>
				.buildRaffleData(rafflePurchaseBeanList);
<span class="nc bnc" id="L225" title="All 2 branches missed.">				if (raffleData.length() != 0) {</span>
<span class="nc" id="L226">					raffleData = raffleData + &quot;|&quot;;</span>
				}
<span class="nc" id="L228">				String promoData=&quot;&quot;;</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">				if(bean.getPromoPurchaseBeanList()!=null){</span>
<span class="nc" id="L230">					List&lt;LottoPurchaseBean&gt; promoPurchaseBeanList=bean.getPromoPurchaseBeanList();</span>
<span class="nc" id="L231">					 promoData=ReprintHepler.buildSaleDataforZimlottothree(promoPurchaseBeanList,userInfoBean);</span>
				
				}
<span class="nc" id="L234">				finalReprintData = reprintData + &quot;|balance:&quot; + balance + &quot;|&quot;</span>
				+ raffleData +advtMsg+ promoData;
<span class="nc bnc" id="L236" title="All 2 branches missed.">			} else if (gameBean instanceof KenoPurchaseBean) {</span>
<span class="nc" id="L237">				NumberFormat nf = NumberFormat.getInstance();</span>
<span class="nc" id="L238">				nf.setMinimumFractionDigits(2);</span>

<span class="nc" id="L240">				balance = nf.format(bal).replaceAll(&quot;,&quot;, &quot;&quot;);</span>
<span class="nc" id="L241">				KenoPurchaseBean kenoPurchaseBean = (KenoPurchaseBean) gameBean;</span>
				
<span class="nc" id="L243">				int listSize = kenoPurchaseBean.getDrawDateTime().size();</span>
				
<span class="nc" id="L245">				JsonObject tktDataJsonObject = new JsonObject();</span>
<span class="nc" id="L246">				tktDataJsonObject.addProperty(&quot;gameCode&quot;, Util.getGameMasterLMSBean(kenoPurchaseBean.getGameId()).getGameNameDev());</span>
<span class="nc" id="L247">				tktDataJsonObject.addProperty(&quot;ticketNumber&quot;, kenoPurchaseBean.getTicket_no() + kenoPurchaseBean.getReprintCount());</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">				tktDataJsonObject.addProperty(&quot;barCd&quot;, kenoPurchaseBean.getTicket_no() + kenoPurchaseBean.getReprintCount() + ((ConfigurationVariables.currentTktLen == ConfigurationVariables.tktLenB &amp;&amp; LMSFilterDispatcher.isBarCodeRequired) ? kenoPurchaseBean.getBarcodeCount() : &quot;&quot;));</span>
				
<span class="nc" id="L250">				tktDataJsonObject.addProperty(&quot;TicketCost&quot;, nf.format(kenoPurchaseBean.getTotalPurchaseAmt()));</span>
<span class="nc" id="L251">				tktDataJsonObject.addProperty(&quot;gameName&quot;, Util.getGameDisplayName(kenoPurchaseBean.getGameId()));</span>
<span class="nc" id="L252">				tktDataJsonObject.addProperty(&quot;purchaseTime&quot;, kenoPurchaseBean.getPurchaseTime());</span>
				
<span class="nc" id="L254">				JsonArray panelDataArray = new JsonArray();</span>
<span class="nc" id="L255">				JsonArray drawDataArray = new JsonArray();</span>
<span class="nc" id="L256">				tktDataJsonObject.add(&quot;panelData&quot;, panelDataArray);</span>
<span class="nc" id="L257">				tktDataJsonObject.add(&quot;drawData&quot;, drawDataArray);</span>
				
<span class="nc" id="L259">				JsonObject drawDataObject = null;</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">				for (int iLoop = 0; iLoop &lt; listSize; iLoop++) {</span>
<span class="nc" id="L261">					drawDataObject = new JsonObject();</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">					if (kenoPurchaseBean.getDrawDateTime().get(iLoop).contains(&quot;*&quot;)) {</span>
<span class="nc" id="L263">						drawDataObject.addProperty(&quot;drawId&quot;, kenoPurchaseBean.getDrawDateTime().get(iLoop).split(&quot;&amp;&quot;)[1]);</span>
<span class="nc" id="L264">						drawDataObject.addProperty(&quot;drawDate&quot;, kenoPurchaseBean.getDrawDateTime().get(iLoop).split(&quot;\\*&quot;)[0].split(&quot; &quot;)[0]);</span>
<span class="nc" id="L265">						drawDataObject.addProperty(&quot;drawTime&quot;, kenoPurchaseBean.getDrawDateTime().get(iLoop).split(&quot;\\*&quot;)[0].split(&quot; &quot;)[1]);</span>
<span class="nc" id="L266">						drawDataObject.addProperty(&quot;drawName&quot;, kenoPurchaseBean.getDrawDateTime().get(iLoop).split(&quot;\\*&quot;)[1].split(&quot;&amp;&quot;)[0]);</span>
					} else {
<span class="nc" id="L268">						drawDataObject.addProperty(&quot;drawId&quot;, kenoPurchaseBean.getDrawDateTime().get(iLoop).split(&quot;&amp;&quot;)[1]);</span>
<span class="nc" id="L269">						drawDataObject.addProperty(&quot;drawDate&quot;, kenoPurchaseBean.getDrawDateTime().get(iLoop).split(&quot;&amp;&quot;)[0].split(&quot; &quot;)[0]);</span>
<span class="nc" id="L270">						drawDataObject.addProperty(&quot;drawTime&quot;, kenoPurchaseBean.getDrawDateTime().get(iLoop).split(&quot;&amp;&quot;)[0].split(&quot; &quot;)[1]);</span>
					}
<span class="nc" id="L272">					drawDataArray.add(drawDataObject);</span>
<span class="nc" id="L273">					drawDataObject = null;</span>
				}

				
<span class="nc" id="L277">				String[] playTypeStr = kenoPurchaseBean.getPlayType();</span>
<span class="nc" id="L278">				JsonObject panelDataObject = null;</span>
<span class="nc" id="L279">				int panelLength = kenoPurchaseBean.getBetAmountMultiple().length;</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">				for (int iLoop = 0; iLoop &lt; panelLength; iLoop++) {</span>
<span class="nc" id="L281">					panelDataObject = new JsonObject();</span>

<span class="nc" id="L283">					panelDataObject.addProperty(&quot;betAmtMul&quot;, kenoPurchaseBean.getBetAmountMultiple()[iLoop]);</span>
<span class="nc" id="L284">					panelDataObject.addProperty(&quot;pickedNumbers&quot;, kenoPurchaseBean.getPlayerData()[iLoop]);</span>
<span class="nc" id="L285">					panelDataObject.addProperty(&quot;numberPicked&quot;, kenoPurchaseBean.getPlayerData()[iLoop].split(&quot;,&quot;).length);</span>
<span class="nc" id="L286">					panelDataObject.addProperty(&quot;PlayType&quot;, playTypeStr[iLoop]);</span>
<span class="nc" id="L287">					panelDataObject.addProperty(&quot;unitPrice&quot;, kenoPurchaseBean.getUnitPrice()[iLoop]);</span>
<span class="nc" id="L288">					panelDataObject.addProperty(&quot;panelPrice&quot;, nf.format(kenoPurchaseBean.getBetAmountMultiple()[iLoop]* kenoPurchaseBean.getUnitPrice()[iLoop]* kenoPurchaseBean.getNoOfLines()[iLoop]* kenoPurchaseBean.getNoOfDraws()).replaceAll(&quot;,&quot;,&quot;&quot;));</span>
<span class="nc" id="L289">					panelDataObject.addProperty(&quot;QP&quot;, kenoPurchaseBean.getIsQuickPick()[iLoop]);</span>

<span class="nc" id="L291">					panelDataArray.add(panelDataObject);</span>
<span class="nc" id="L292">					panelDataObject = null;</span>
				}

<span class="nc" id="L295">				jsonResponse.addProperty(&quot;responseCode&quot;, 0);</span>
<span class="nc" id="L296">				jsonResponse.addProperty(&quot;saleTransId&quot;, kenoPurchaseBean.getRefTransId());</span>
<span class="nc" id="L297">				jsonResponse.add(&quot;ticketData&quot;, tktDataJsonObject);</span>
<span class="nc" id="L298">				jsonResponse.addProperty(&quot;availableBal&quot;, balance);</span>

//				responseObj.addProperty(&quot;&quot;, kenoPurchaseBean.get)
		
		
<span class="nc" id="L303">				UtilApplet.getAdvMsgs(kenoPurchaseBean.getAdvMsg(), topMsgsStr, bottomMsgsStr, 10);</span>
<span class="nc" id="L304">				JsonObject messageObject = null;</span>
<span class="nc" id="L305">				JsonArray topArray = new JsonArray();</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">				for(String message : topMsgsStr.toString().split(&quot;~&quot;)) {</span>
<span class="nc" id="L307">					messageObject = new JsonObject();</span>
<span class="nc" id="L308">					messageObject.addProperty(&quot;msg&quot;, message);</span>
<span class="nc" id="L309">					topArray.add(messageObject);</span>
				}
<span class="nc" id="L311">				JsonArray bottomArray = new JsonArray();</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">				for(String message : bottomMsgsStr.toString().split(&quot;~&quot;)) {</span>
<span class="nc" id="L313">					messageObject = new JsonObject();</span>
<span class="nc" id="L314">					messageObject.addProperty(&quot;msg&quot;, message);</span>
<span class="nc" id="L315">					bottomArray.add(messageObject);</span>
				}

<span class="nc" id="L318">				jsonResponse.add(&quot;topAdvMsg&quot;, topArray);</span>
<span class="nc" id="L319">				jsonResponse.add(&quot;bottomAdvMsg&quot;, bottomArray);</span>
				//jsonResponse.addProperty(&quot;topAdvMsg&quot;, new Gson().toJson(topMsgsStr.toString().split(&quot;~&quot;)));
				//jsonResponse.addProperty(&quot;bottomAdvMsg&quot;, new Gson().toJson(bottomMsgsStr.toString().split(&quot;~&quot;)));
				
<span class="nc bnc" id="L323" title="All 2 branches missed.">			} else if (gameBean instanceof FortuneTwoPurchaseBean) {</span>
<span class="nc" id="L324">				FortuneTwoPurchaseBean bean = (FortuneTwoPurchaseBean) gameBean;</span>
<span class="nc" id="L325">				UtilApplet.getAdvMsgs(bean.getAdvMsg(), topMsgsStr,</span>
						bottomMsgsStr, 10);

<span class="nc bnc" id="L328" title="All 2 branches missed.">				if (topMsgsStr.length() != 0) {</span>
<span class="nc" id="L329">					advtMsg = &quot;topAdvMsg:&quot; + topMsgsStr + &quot;|&quot;;</span>
				}

<span class="nc bnc" id="L332" title="All 2 branches missed.">				if (bottomMsgsStr.length() != 0) {</span>
<span class="nc" id="L333">					advtMsg = advtMsg + &quot;bottomAdvMsg:&quot; + bottomMsgsStr + &quot;|&quot;;</span>
				}
<span class="nc bnc" id="L335" title="All 2 branches missed.">				if (bean.getSaleStatus() == &quot;PERFORMED&quot;) {</span>
<span class="nc" id="L336">					finalReprintData = &quot;ErrorMsg:&quot;</span>
						+ AndroidErrors.DRAW_PERFORMED+&quot;ErrorCode:&quot; + AndroidErrors.DRAW_PERFORMED_ERROR_CODE+&quot;|&quot;;
					
<span class="nc" id="L339">					logger.debug(&quot;FINAL REPRINT DATA:&quot; + finalReprintData);</span>
<span class="nc" id="L340">					response.getOutputStream().write(</span>
							finalReprintData.getBytes());
<span class="nc" id="L342">					return;</span>
				}
<span class="nc" id="L344">				gameName = Util.getGameName(bean.getGame_no());</span>
<span class="nc" id="L345">				String reprintData = ReprintHepler.reprintFortuneTwoTicket(</span>
						bean, gameName);

<span class="nc" id="L348">				String promoReprintData = rpos.buildPromoReprintData(bean</span>
						.getPromoPurchaseBean(),userInfoBean,countryDeployed);
<span class="nc" id="L350">				finalReprintData = reprintData + &quot;|balance:&quot; + balance + &quot;|QP:&quot;</span>
				+ bean.getIsQuickPick()[0] + &quot;|&quot; + promoReprintData
				+ advtMsg;
<span class="nc bnc" id="L353" title="All 2 branches missed.">			}else if(gameBean instanceof FortuneThreePurchaseBean){</span>

<span class="nc" id="L355">				FortuneThreePurchaseBean bean = (FortuneThreePurchaseBean) gameBean;</span>
<span class="nc" id="L356">				UtilApplet.getAdvMsgs(bean.getAdvMsg(), topMsgsStr,</span>
						bottomMsgsStr, 10);

<span class="nc bnc" id="L359" title="All 2 branches missed.">				if (topMsgsStr.length() != 0) {</span>
<span class="nc" id="L360">					advtMsg = &quot;topAdvMsg:&quot; + topMsgsStr + &quot;|&quot;;</span>
				}

<span class="nc bnc" id="L363" title="All 2 branches missed.">				if (bottomMsgsStr.length() != 0) {</span>
<span class="nc" id="L364">					advtMsg = advtMsg + &quot;bottomAdvMsg:&quot; + bottomMsgsStr + &quot;|&quot;;</span>
				}
<span class="nc bnc" id="L366" title="All 2 branches missed.">				if (bean.getSaleStatus() == &quot;PERFORMED&quot;) {</span>
<span class="nc" id="L367">					finalReprintData = &quot;ErrorMsg:&quot;</span>
						+ AndroidErrors.DRAW_PERFORMED+&quot;ErrorCode:&quot; + AndroidErrors.DRAW_PERFORMED_ERROR_CODE+&quot;|&quot;;
					
<span class="nc" id="L370">					logger.debug(&quot;FINAL REPRINT DATA:&quot; + finalReprintData);</span>
<span class="nc" id="L371">					response.getOutputStream().write(</span>
							finalReprintData.getBytes());
<span class="nc" id="L373">					return;</span>
				}
<span class="nc" id="L375">				gameName = Util.getGameName(bean.getGame_no());</span>
<span class="nc" id="L376">				String reprintData = ReprintHepler.reprintFortuneThreeTicket(</span>
						bean, gameName);

<span class="nc" id="L379">				String promoReprintData = rpos.buildPromoReprintData(bean</span>
						.getPromoPurchaseBean(),userInfoBean,countryDeployed);
<span class="nc" id="L381">				finalReprintData = reprintData + &quot;|balance:&quot; + balance + &quot;|QP:&quot;</span>
				+ bean.getIsQuickPick()[0] + &quot;|&quot; + promoReprintData
				+ advtMsg;
			
<span class="nc" id="L385">			}</span>
<span class="nc bnc" id="L386" title="All 4 branches missed.">			else if (gameBean instanceof String</span>
					&amp;&amp; &quot;RG_RPERINT&quot;.equals(gameBean.toString())) {
				//finalReprintData = &quot;ErrorMsg:&quot; + AndroidErrors.REPRINT_FRAUD+&quot;ErrorCode:&quot; + AndroidErrors.REPRINT_FRAUD_ERROR_CODE+&quot;|&quot;;
<span class="nc" id="L389">				jsonResponse.addProperty(&quot;isSuccess&quot;, false);</span>
<span class="nc" id="L390">				jsonResponse.addProperty(&quot;errorCode&quot;, AndroidErrors.REPRINT_FRAUD_ERROR_CODE);</span>
<span class="nc" id="L391">				jsonResponse.addProperty(&quot;errorMsg&quot;, AndroidErrors.REPRINT_FRAUD);</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">			} else if (gameBean instanceof String) {</span>
				//finalReprintData =gameBean.toString();
				//finalReprintData = &quot;ErrorMsg:&quot; + AndroidErrors.REPRINT_FAIL+&quot;ErrorCode:&quot; + AndroidErrors.REPRINT_FAIL_ERROR_CODE+&quot;|&quot;;
<span class="nc" id="L395">				jsonResponse.addProperty(&quot;isSuccess&quot;, false);</span>
<span class="nc" id="L396">				jsonResponse.addProperty(&quot;errorCode&quot;, AndroidErrors.REPRINT_FAIL_ERROR_CODE);</span>
<span class="nc" id="L397">				jsonResponse.addProperty(&quot;errorMsg&quot;, AndroidErrors.REPRINT_FAIL);</span>
			} else {
				//finalReprintData = &quot;ErrorMsg:&quot; + AndroidErrors.REPRINT_FAIL+&quot;ErrorCode:&quot; + AndroidErrors.REPRINT_FAIL_ERROR_CODE+&quot;|&quot;;
<span class="nc" id="L400">				jsonResponse.addProperty(&quot;isSuccess&quot;, false);</span>
<span class="nc" id="L401">				jsonResponse.addProperty(&quot;errorCode&quot;, AndroidErrors.REPRINT_FAIL_ERROR_CODE);</span>
<span class="nc" id="L402">				jsonResponse.addProperty(&quot;errorMsg&quot;, AndroidErrors.REPRINT_FAIL);</span>
			}
<span class="nc" id="L404">			logger.info(&quot;FINAL REPRINT DATA:&quot; + jsonResponse);</span>
<span class="nc" id="L405">			out.print(jsonResponse);</span>
<span class="nc" id="L406">			out.flush();</span>
<span class="nc" id="L407">			out.close();</span>
		}

<span class="nc" id="L410">	}</span>
	
	
	public void payPwtTicketJson() throws Exception {
<span class="nc" id="L414">		ServletContext sc = ServletActionContext.getServletContext();</span>
<span class="nc" id="L415">		String isDraw = (String) sc.getAttribute(&quot;IS_DRAW&quot;);</span>
<span class="nc" id="L416">		double govtCommAmt=0.0;</span>
	//	response.setCharacterEncoding(&quot;UTF-8&quot;);
	//	response.setContentType(&quot;text/html&quot;);
<span class="nc bnc" id="L419" title="All 2 branches missed.">		if (isDraw.equalsIgnoreCase(&quot;NO&quot;)) {</span>
<span class="nc" id="L420">			response.getOutputStream().write(</span>
					(&quot;ErrorMsg:&quot; + AndroidErrors.DRAW_GAME_NOT_AVAILABLE+&quot;ErrorCode:&quot; + AndroidErrors.DRAW_GAME_NOT_AVAILABLE_ERROR_CODE+&quot;|&quot;)
					.getBytes());
<span class="nc" id="L423">			return;</span>
		}
<span class="nc" id="L425">		Map currentUserSessionMap = (Map) sc.getAttribute(&quot;LOGGED_IN_USERS&quot;);</span>
<span class="nc" id="L426">		HttpSession session = (HttpSession) currentUserSessionMap.get(userName);</span>
<span class="nc" id="L427">		String countryDeployed = (String) sc.getAttribute(&quot;COUNTRY_DEPLOYED&quot;);</span>
<span class="nc" id="L428">		UserInfoBean userInfoBean = (UserInfoBean) session</span>
		.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L430">		String refMerchantId = (String) sc.getAttribute(&quot;REF_MERCHANT_ID&quot;);</span>

<span class="nc" id="L432">		MainPWTDrawBean mainWinningBean = (MainPWTDrawBean) session</span>
		.getAttribute(&quot;PWT_RES&quot;);

<span class="nc" id="L435">		AjaxRequestHelper ajxHelper1 = new AjaxRequestHelper();</span>
<span class="nc" id="L436">		ajxHelper1.getAvlblCreditAmt(userInfoBean);</span>
<span class="nc" id="L437">		double bal1 = userInfoBean.getAvailableCreditLimit()</span>
		- userInfoBean.getClaimableBal();
<span class="nc" id="L439">		String highPrizeCriteria = (String) LMSUtility.sc.getAttribute(&quot;HIGH_PRIZE_CRITERIA&quot;);</span>
<span class="nc" id="L440">		String highPrizeAmt = (String) LMSUtility.sc.getAttribute(&quot;HIGH_PRIZE_AMT&quot;);</span>
<span class="nc" id="L441">		String highPrizeScheme = (String) LMSUtility.sc.getAttribute(</span>
						&quot;DRAW_GAME_HIGH_PRIZE_SCHEME&quot;);
<span class="nc" id="L443">		DrawGameRPOSHelper helper = new DrawGameRPOSHelper();</span>
<span class="nc" id="L444">		String promoTicketDta = &quot;&quot;;</span>
<span class="nc" id="L445">		logger.debug(&quot;Before--&quot; + new Date());</span>
		//code for Payment Through mPesa ...
<span class="nc bnc" id="L447" title="All 4 branches missed.">		if(&quot;Y&quot;.equalsIgnoreCase(mPesa) &amp;&amp; mobileNo!=null){</span>
<span class="nc" id="L448">			mainWinningBean.setIsmPesaEnable(true);</span>
<span class="nc" id="L449">			mainWinningBean.setMobileNumber(mobileNo);</span>
<span class="nc" id="L450">			UserInfoBean mPesaUserBean = new MpesaPaymentProcessHelper().payBymPesaAcc(mainWinningBean, userInfoBean);</span>
<span class="nc" id="L451">			mainWinningBean = helper.payPwtTicket(mainWinningBean, mPesaUserBean,highPrizeCriteria,highPrizeAmt,highPrizeScheme);</span>
<span class="nc" id="L452">		}else{</span>
<span class="nc" id="L453">			mainWinningBean = helper.payPwtTicket(mainWinningBean, userInfoBean,highPrizeCriteria,highPrizeAmt,highPrizeScheme);</span>
		}		
		/*
		 *  logger.debug(&quot;---------------------------- AFTER HELPER
		 * CLASS----------------------------------&quot; + new Date());
		 */

<span class="nc" id="L460">		String finalPwtData = null;</span>
<span class="nc bnc" id="L461" title="All 2 branches missed.">		if (&quot;PWT_LIMIT_EXCEED&quot;.equalsIgnoreCase(mainWinningBean.getStatus())) {</span>
<span class="nc" id="L462">			finalPwtData = &quot;ErrorMsg:&quot; + AndroidErrors.PWT_LIMIT_EXCEED+&quot;ErrorCode:&quot; + AndroidErrors.PWT_LIMIT_EXCEED_ERROR_CODE+&quot;|&quot;;</span>
<span class="nc" id="L463">			logger.debug(&quot;FINAL PWT DATA:&quot; + finalPwtData);</span>
<span class="nc" id="L464">			response.getOutputStream().write(finalPwtData.getBytes());</span>
<span class="nc" id="L465">			return;</span>
<span class="nc bnc" id="L466" title="All 2 branches missed.">		}if (&quot;INVALID_PWT_LIMIT_EXCEED&quot;.equalsIgnoreCase(mainWinningBean.getStatus())) {</span>
<span class="nc" id="L467">			finalPwtData = &quot;ErrorMsg:&quot; + AndroidErrors.INVALID_PWT_LIMIT_EXCEED+&quot;ErrorCode:&quot; + AndroidErrors.INVALID_PWT_LIMIT_EXCEED_ERROR_CODE+&quot;|&quot;;</span>
<span class="nc" id="L468">			logger.debug(&quot;FINAL PWT DATA:&quot; + finalPwtData);</span>
<span class="nc" id="L469">			response.getOutputStream().write(finalPwtData.getBytes());</span>
<span class="nc" id="L470">			return;</span>
		}

		/*if(mainWinningBean.getWinningBeanList() != null) {
			for (int i = 0; i &lt; mainWinningBean.getWinningBeanList().size(); i++) {
				PWTDrawBean winningBean = new PWTDrawBean();
				winningBean = mainWinningBean.getWinningBeanList().get(i);
				for(DrawIdBean drawIdBean : winningBean.getDrawWinList()) {
					if(drawIdBean.getRankId() == 4 &amp;&amp; &quot;TwelveByTwentyFour&quot;.equals(Util.getGameName(mainWinningBean.getGameId()))) {
						double tktCost = Double.parseDouble(drawIdBean.getWinningAmt())/2;
						for(int iLoop = 0; iLoop &lt; 2; iLoop++) {
							double unitPrice = Util.getUnitPrice(mainWinningBean.getGameId(), &quot;Direct12&quot;);
							int gameId = Util.getGameId(&quot;TwelveByTwentyFour&quot;);
							
							KenoPurchaseBean drawGamePurchaseBean = new KenoPurchaseBean();
							drawGamePurchaseBean.setGame_no(Util.getGameNumberFromGameId(gameId));
							drawGamePurchaseBean.setGameId(gameId);
							drawGamePurchaseBean.setGameDispName(Util.getGameDisplayName(gameId));
							drawGamePurchaseBean.setBetAmountMultiple(new int[]{(int) (tktCost/unitPrice)});
							drawGamePurchaseBean.setIsQuickPick(new int[]{1});
							drawGamePurchaseBean.setPlayerData(new String[]{&quot;QP&quot;});
							drawGamePurchaseBean.setPlayType(new String[]{&quot;Direct12&quot;});
							drawGamePurchaseBean.setNoPicked(new String[]{&quot;12&quot;});
							drawGamePurchaseBean.setNoOfPanel(1);
							drawGamePurchaseBean.setPartyId(userInfoBean.getUserOrgId());
							drawGamePurchaseBean.setPartyType(userInfoBean.getUserType());
							drawGamePurchaseBean.setUserId(userInfoBean.getUserId());
							drawGamePurchaseBean.setNoOfDraws(1);
							drawGamePurchaseBean.setIsAdvancedPlay(0);
							drawGamePurchaseBean.setRefMerchantId((String) sc.getAttribute(&quot;REF_MERCHANT_ID&quot;));
							drawGamePurchaseBean.setPurchaseChannel(&quot;LMS_Terminal&quot;);
							drawGamePurchaseBean.setPlrMobileNumber(&quot;&quot;);
	//						drawGamePurchaseBean.setActionName(kenoPurchaseBean.getActionName());
	//						drawGamePurchaseBean.setLastGameId(kenoPurchaseBean.getLastGameId());
							drawGamePurchaseBean.setDeviceType(&quot;TERMINAL&quot;);
							drawGamePurchaseBean.setBarcodeType((String) LMSUtility.sc.getAttribute(&quot;BARCODE_TYPE&quot;));
							drawGamePurchaseBean.setUserMappingId(userInfoBean.getCurrentUserMappingId());
							drawGamePurchaseBean.setDrawIdTableMap((Map&lt;Integer, Map&lt;Integer, String&gt;&gt;) sc.getAttribute(&quot;drawIdTableMap&quot;));
							drawGamePurchaseBean.setLastSoldTicketNo(&quot;0&quot;);
							drawGamePurchaseBean.setServiceId(Util.getServiceIdFormCode(&quot;DG&quot;));
							drawGamePurchaseBean.setPromotkt(true);
							
							KenoPurchaseBean purchaseBean = new TwelveByTwentyFourHelper().twelveByTwentyFourPurchaseTicket(userInfoBean, drawGamePurchaseBean);
							if (&quot;SUCCESS&quot;.equalsIgnoreCase(purchaseBean.getSaleStatus())) {
								promoTicketDta += new DrawGameRPOSHelper().buildTwelveByTwentyFourData(purchaseBean, userInfoBean);
	//							orgOnLineSaleCreditUpdation.drawTicketNPromoMappigUpdate(1, kenoPurchaseBean.getGame_no(), kenoPurchaseBean.getTicket_no(), purchaseBean.getTicket_no());
							} else {
	//							kenoPurchaseBean.setPromoSaleStatus(&quot;FAILED&quot;);
	//							return kenoPurchaseBean;
							}
	//						kenoPurchaseBean.setPromoPurchaseBean(purchaseBean);
						}
					}
				}
			}
		}*/
		
<span class="nc" id="L527">		String raffleData = AndroidErrors.RAFFLE_DATA;</span>
<span class="nc" id="L528">		StringBuilder stBuild = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L529">		double totalRaffleAmount = 0.0;</span>

<span class="nc bnc" id="L531" title="All 2 branches missed.">		if (mainWinningBean.getPwtTicketType().equalsIgnoreCase(&quot;RAFFLE&quot;)) {</span>

<span class="nc" id="L533">			List&lt;RaffleDrawIdBean&gt; raffleDrawIdBeanList = mainWinningBean</span>
			.getWinningBeanList().get(0).getRaffleDrawIdBeanList();
<span class="nc bnc" id="L535" title="All 2 branches missed.">			if (raffleDrawIdBeanList != null) {</span>
<span class="nc bnc" id="L536" title="All 2 branches missed.">				for (int j = 0; j &lt; raffleDrawIdBeanList.size(); j++) {</span>
<span class="nc bnc" id="L537" title="All 2 branches missed.">					if (j &gt; 0) {</span>
<span class="nc" id="L538">						raffleData = raffleData + &quot;;&quot;;</span>
					}
<span class="nc" id="L540">					RaffleDrawIdBean raffleWinningBean = raffleDrawIdBeanList</span>
					.get(j);
<span class="nc" id="L542">					String dataArr[] = buildPWTRaffleData(raffleWinningBean)</span>
					.split(&quot;RWA&quot;);
<span class="nc" id="L544">					String data = dataArr[0];</span>
<span class="nc bnc" id="L545" title="All 2 branches missed.">					if (dataArr.length &gt; 1)</span>
<span class="nc" id="L546">						totalRaffleAmount = Double.parseDouble(dataArr[1]);</span>

<span class="nc" id="L548">					raffleData = raffleData + data;</span>
				}
			}
<span class="nc" id="L551">			raffleData = raffleData + &quot;#&quot; + &quot;|Total Pay:&quot; + totalRaffleAmount</span>
			+ &quot;|&quot;;

<span class="nc bnc" id="L554" title="All 2 branches missed.">		} else if (mainWinningBean.getPwtTicketType().equalsIgnoreCase(&quot;DRAW&quot;)) {</span>
			// String raffleData=AndroidErrors.RAFFLE_DATA;
			// double totalRaffleAmount=0.0;
<span class="nc" id="L557">			List&lt;PWTDrawBean&gt; pwtWinBeanlist = mainWinningBean</span>
			.getWinningBeanList();
<span class="nc bnc" id="L559" title="All 2 branches missed.">			for (int k = 0; k &lt; pwtWinBeanlist.size(); k++) {</span>
<span class="nc" id="L560">				PWTDrawBean pwtWinningBean = pwtWinBeanlist.get(k);</span>
<span class="nc bnc" id="L561" title="All 2 branches missed.">				if (pwtWinningBean.getPwtTicketType()</span>
						.equalsIgnoreCase(&quot;RAFFLE&quot;)) {
<span class="nc" id="L563">					List&lt;RaffleDrawIdBean&gt; raffleDrawIdBeanList = pwtWinningBean</span>
					.getRaffleDrawIdBeanList();
<span class="nc bnc" id="L565" title="All 2 branches missed.">					for (int i = 0; i &lt; raffleDrawIdBeanList.size(); i++) {</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">						if (i &gt; 0) {</span>
<span class="nc" id="L567">							raffleData = raffleData + &quot;;&quot;;</span>
						}
<span class="nc" id="L569">						RaffleDrawIdBean raffleWinningBean = raffleDrawIdBeanList</span>
						.get(i);

<span class="nc bnc" id="L572" title="All 2 branches missed.">						if (&quot;FRAUD&quot;.equalsIgnoreCase(raffleWinningBean</span>
								.getStatus())) {

<span class="nc" id="L575">							raffleData = raffleData + &quot;ErrorMsg:&quot;</span>
							+ AndroidErrors.PWT_FRAUD;

<span class="nc bnc" id="L578" title="All 2 branches missed.">						} else if (&quot;TICKET_EXPIRED&quot;</span>
								.equalsIgnoreCase(raffleWinningBean.getStatus())) {
<span class="nc" id="L580">							raffleData = raffleData + &quot;ErrorMsg:&quot;</span>
							+ AndroidErrors.PWT_TICKET_EXPIRED+&quot;ErrorCode:&quot; + AndroidErrors.PWT_TICKET_EXPIRED_ERROR_CODE+&quot;|&quot;;

<span class="nc bnc" id="L583" title="All 2 branches missed.">						} else if (raffleWinningBean.getStatus().equals(</span>
						&quot;RES_AWAITED&quot;)) {
<span class="nc" id="L585">							raffleData = raffleData</span>
							+ raffleWinningBean.getDrawDateTime()
							+ &quot;|Awaited&quot;;

<span class="nc bnc" id="L589" title="All 4 branches missed.">						} else if (raffleWinningBean.getPwtStatus() != null</span>
								&amp;&amp; raffleWinningBean.getPwtStatus()
								.equalsIgnoreCase(&quot;OUT_VERIFY_LIMIT&quot;)) {
<span class="nc" id="L592">							raffleData = raffleData + &quot;ErrorMsg:&quot;</span>
							+ AndroidErrors.PWT_OUT_VERIFY_LIMIT+&quot;ErrorCode:&quot; + AndroidErrors.PWT_OUT_VERIFY_LIMIT_ERROR_CODE+&quot;|&quot;;

<span class="nc bnc" id="L595" title="All 4 branches missed.">						} else if (raffleWinningBean.getPwtStatus() != null</span>
								&amp;&amp; raffleWinningBean.getPwtStatus().equals(
								&quot;NON_WIN&quot;)) {
<span class="nc" id="L598">							raffleData = raffleData</span>
							+ raffleWinningBean.getDrawDateTime()
							+ &quot;|TRY AGAIN&quot;;

<span class="nc bnc" id="L602" title="All 4 branches missed.">						} else if (raffleWinningBean.getPwtStatus() != null</span>
								&amp;&amp; raffleWinningBean.getPwtStatus().equals(
								&quot;NORMAL_PAY&quot;)) {
<span class="nc" id="L605">							totalRaffleAmount = totalRaffleAmount</span>
							+ Double.parseDouble(raffleWinningBean
									.getWinningAmt());
<span class="nc" id="L608">							raffleData = raffleData</span>
							+ raffleWinningBean.getDrawDateTime()
							+ &quot;|WIN &quot;
							+ raffleWinningBean.getWinningAmt();

<span class="nc bnc" id="L613" title="All 4 branches missed.">						} else if (raffleWinningBean.getStatus() != null</span>
								&amp;&amp; raffleWinningBean.getStatus().equals(
								&quot;CLAIMED&quot;)) {
<span class="nc" id="L616">							raffleData = raffleData</span>
							+ raffleWinningBean.getDrawDateTime()
							+ &quot;|CLAIMED&quot;;

<span class="nc bnc" id="L620" title="All 4 branches missed.">						} else if (raffleWinningBean.getPwtStatus() != null</span>
								&amp;&amp; raffleWinningBean.getPwtStatus().equals(
								&quot;PND_PAY&quot;)) {
<span class="nc" id="L623">							raffleData = raffleData + &quot;ErrorMsg:&quot;</span>
							+ AndroidErrors.PWT_OUT_VERIFY_LIMIT+&quot;ErrorCode:&quot; + AndroidErrors.PWT_OUT_VERIFY_LIMIT_ERROR_CODE+&quot;|&quot;;

<span class="nc bnc" id="L626" title="All 4 branches missed.">						} else if (raffleWinningBean.getPwtStatus() != null</span>
								&amp;&amp; raffleWinningBean.getPwtStatus().equals(
								&quot;HIGH_PRIZE&quot;)) {
<span class="nc" id="L629">							raffleData = raffleData + &quot;ErrorMsg:&quot;</span>
							+ AndroidErrors.PWT_OUT_VERIFY_LIMIT+&quot;ErrorCode:&quot; + AndroidErrors.PWT_OUT_VERIFY_LIMIT_ERROR_CODE+&quot;|&quot;;

<span class="nc bnc" id="L632" title="All 4 branches missed.">						} else if (raffleWinningBean.getPwtStatus() != null</span>
								&amp;&amp; raffleWinningBean.getPwtStatus().equals(
								&quot;OUT_PAY_LIMIT&quot;)) {
<span class="nc" id="L635">							raffleData = raffleData + &quot;ErrorMsg:&quot;</span>
							+ AndroidErrors.PWT_OUT_VERIFY_LIMIT+&quot;ErrorCode:&quot; + AndroidErrors.PWT_OUT_VERIFY_LIMIT_ERROR_CODE+&quot;|&quot;;

<span class="nc bnc" id="L638" title="All 4 branches missed.">						} else if (raffleWinningBean.getPwtStatus() != null</span>
								&amp;&amp; raffleWinningBean.getPwtStatus().equals(
								&quot;OUT_VERIFY_LIMIT&quot;)) {
<span class="nc" id="L641">							raffleData = raffleData + &quot;ErrorMsg:&quot;</span>
							+ AndroidErrors.PWT_OUT_VERIFY_LIMIT+&quot;ErrorCode:&quot; + AndroidErrors.PWT_OUT_VERIFY_LIMIT_ERROR_CODE+&quot;|&quot;;
						}

					}

				}

			}
<span class="nc" id="L650">			raffleData = raffleData + &quot;#&quot;;</span>
			// StringBuilder stBuild = new StringBuilder(&quot;&quot;);
<span class="nc" id="L652">			double totalClmPndAmt=0.0;</span>
<span class="nc bnc" id="L653" title="All 2 branches missed.">			for (int k = 0; k &lt; pwtWinBeanlist.size(); k++) {</span>
<span class="nc" id="L654">				PWTDrawBean pwtWinningBean = pwtWinBeanlist.get(k);</span>
<span class="nc" id="L655">				govtCommAmt=pwtWinningBean.getGovtTaxAmount();</span>
<span class="nc bnc" id="L656" title="All 2 branches missed.">				if (pwtWinningBean.getPwtTicketType().equalsIgnoreCase(&quot;DRAW&quot;)) {</span>
<span class="nc" id="L657">					double totTktAmt = 0.0;</span>
<span class="nc" id="L658">					int totRegister = 0;</span>
<span class="nc bnc" id="L659" title="All 2 branches missed.">					if (!pwtWinningBean.isValid()) {</span>
<span class="nc" id="L660">						stBuild.append(&quot;\nMsg:Invalid Ticket&quot;);</span>

<span class="nc bnc" id="L662" title="All 2 branches missed.">					} else if (pwtWinningBean.getStatus().equals(&quot;SUCCESS&quot;)) {</span>
<span class="nc bnc" id="L663" title="All 2 branches missed.">						for (int i = 0; i &lt; pwtWinningBean.getDrawWinList()</span>
<span class="nc" id="L664">						.size(); i++) {</span>
<span class="nc" id="L665">							int nonWin = 0;</span>
<span class="nc" id="L666">							int win = 0;</span>
<span class="nc" id="L667">							int clm=0;</span>
<span class="nc" id="L668">							int register = 0;</span>
<span class="nc" id="L669">							int claim = 0;</span>
<span class="nc" id="L670">							int outVerify = 0;</span>
<span class="nc" id="L671">							int pndPay = 0;</span>
<span class="nc" id="L672">							boolean isExpired= false;</span>
<span class="nc" id="L673">							boolean isVerPending=false;</span>
<span class="nc" id="L674">							boolean isClmPending=false;</span>
<span class="nc" id="L675">							DrawIdBean drawBean = pwtWinningBean</span>
							.getDrawWinList().get(i);
<span class="nc" id="L677">							String drawStatusForTicket=drawBean.getStatus();</span>
<span class="nc" id="L678">							String drawTime = drawBean.getDrawDateTime();</span>
<span class="nc" id="L679">							String gameName = Util.getGameName(pwtWinningBean</span>
									.getGameNo());

<span class="nc" id="L682">							String[] drawTimeArr = drawTime.split(&quot;\\*&quot;);</span>
<span class="nc bnc" id="L683" title="All 2 branches missed.">							if (drawTimeArr.length &gt; 1) {</span>
<span class="nc bnc" id="L684" title="All 4 branches missed.">								if (drawTimeArr[1] == null</span>
										|| &quot;NULL&quot;
										.equalsIgnoreCase(drawTimeArr[1])) {
<span class="nc" id="L687">									drawTime = drawTimeArr[0];</span>
								}
							}

<span class="nc" id="L691">							boolean isResAwaited = false;</span>
<span class="nc" id="L692">							double drawAmt = 0.0;</span>
<span class="nc" id="L693">							List&lt;PanelIdBean&gt; panelWinList = drawBean</span>
							.getPanelWinList();
<span class="nc bnc" id="L695" title="All 4 branches missed.">							if (panelWinList != null &amp;&amp; !drawStatusForTicket.equals(&quot;DRAW_EXPIRED&quot;)) {</span>

<span class="nc bnc" id="L697" title="All 2 branches missed.">								for (int j = 0; j &lt; panelWinList.size(); j++) {</span>
<span class="nc" id="L698">									PanelIdBean panelBean = panelWinList.get(j);</span>

<span class="nc bnc" id="L700" title="All 2 branches missed.">									if (panelBean.getStatus().equals(&quot;NON WIN&quot;)) {</span>
<span class="nc" id="L701">										nonWin++;</span>
<span class="nc bnc" id="L702" title="All 2 branches missed.">									} else if (panelBean.getStatus().equals(</span>
									&quot;NORMAL_PAY&quot;)) {
<span class="nc" id="L704">										drawAmt = panelBean.getWinningAmt()</span>
										+ drawAmt;
<span class="nc" id="L706">										win++;</span>
<span class="nc bnc" id="L707" title="All 2 branches missed.">									} else if (panelBean.getStatus().equals(</span>
									&quot;CLAIMED&quot;)) {
<span class="nc" id="L709">										claim++;</span>
<span class="nc bnc" id="L710" title="All 2 branches missed.">									} else if (panelBean.getStatus().equals(</span>
									&quot;PND_PAY&quot;)) {
<span class="nc" id="L712">										pndPay++;</span>
<span class="nc bnc" id="L713" title="All 2 branches missed.">									} else if (panelBean.getStatus().equals(</span>
									&quot;HIGH_PRIZE&quot;)) {
<span class="nc" id="L715">										register++;</span>
<span class="nc bnc" id="L716" title="All 2 branches missed.">									} else if (panelBean.getStatus().equals(</span>
									&quot;OUT_PAY_LIMIT&quot;)) {
<span class="nc" id="L718">										register++;</span>
<span class="nc bnc" id="L719" title="All 2 branches missed.">									} else if (panelBean.getStatus().equals(</span>
									&quot;OUT_VERIFY_LIMIT&quot;)) {
<span class="nc" id="L721">										outVerify++;</span>
<span class="nc bnc" id="L722" title="All 2 branches missed.">									}else if(panelBean.getStatus().equals(&quot;CLAIM_PENDING&quot;)){</span>
<span class="nc" id="L723">										drawAmt = panelBean.getWinningAmt()+ drawAmt;</span>
<span class="nc" id="L724">										totalClmPndAmt+=panelBean.getWinningAmt();</span>
<span class="nc" id="L725">										clm++;</span>
									}
								}
<span class="nc bnc" id="L728" title="All 2 branches missed.">							}else if(drawStatusForTicket.equals(&quot;DRAW_EXPIRED&quot;)){</span>
<span class="nc" id="L729">								isExpired=true;</span>
<span class="nc bnc" id="L730" title="All 2 branches missed.">							}else if(drawStatusForTicket.equals(&quot;VERIFICATION_PENDING&quot;)){</span>
<span class="nc" id="L731">								isVerPending=true;</span>
<span class="nc bnc" id="L732" title="All 2 branches missed.">							}else if(drawStatusForTicket.equals(&quot;CLAIM_PENDING&quot;)){</span>
<span class="nc" id="L733">								isClmPending=true;</span>
							}else{
<span class="nc" id="L735">								isResAwaited = true;</span>
							}
<span class="nc bnc" id="L737" title="All 2 branches missed.">							totTktAmt = (drawStatusForTicket.equals(&quot;CLAIM_PENDING&quot;)?0.0:drawAmt-govtCommAmt) + totTktAmt;</span>
<span class="nc bnc" id="L738" title="All 2 branches missed.">							if(isExpired){</span>
<span class="nc" id="L739">								stBuild.append(&quot;|DrawTime:&quot; + drawTime + &quot;&quot;);</span>
<span class="nc" id="L740">								stBuild.append(&quot;,No:0,Message:Draw Expired&quot;);</span>
<span class="nc bnc" id="L741" title="All 2 branches missed.">							}else if (isVerPending) {</span>
<span class="nc" id="L742">								stBuild.append(&quot;|DrawTime:&quot; + drawTime + &quot;&quot;);</span>
<span class="nc" id="L743">								stBuild.append(&quot;,No:0,Message:VER PEND&quot;);</span>
<span class="nc bnc" id="L744" title="All 2 branches missed.">							}else if (isResAwaited) {</span>
<span class="nc" id="L745">								stBuild.append(&quot;|DrawTime:&quot; + drawTime + &quot;&quot;);</span>
<span class="nc" id="L746">								stBuild.append(&quot;,No:0,Message:Awaited&quot;);</span>
							} else {
<span class="nc" id="L748">								stBuild.append(&quot;|DrawTime:&quot; + drawTime + &quot;&quot;);</span>
								/* As per clients' requirement, it's commented to omit the non-win data 
								 *  to reduce the size of ticket and to show only relevant data.
								 *  
								 * if (nonWin != 0) {
									// stBuild.append(&quot;\nDrawTime:&quot; + drawTime +
									// &quot;&quot;);
									stBuild.append(&quot;,No:&quot; + nonWin
											+ &quot;,Message:TRY AGAIN&quot;);
								}*/
<span class="nc bnc" id="L758" title="All 2 branches missed.">								if (win != 0) {</span>
									// stBuild.append(&quot;\nDrawTime:&quot; + drawTime +
									// &quot;&quot;);
<span class="nc" id="L761">									stBuild.append(&quot;,No:&quot; + win + &quot;,Message:WIN &quot;</span>
											+ Util.getBalInString(drawAmt) +&quot;&quot;);
								}
<span class="nc bnc" id="L764" title="All 2 branches missed.">								if (register != 0) {</span>
									// stBuild.append(&quot;\nDrawTime:&quot; + drawTime +
									// &quot;&quot;);
<span class="nc" id="L767">									stBuild.append(&quot;,No:&quot; + register</span>
											+ &quot;,Message:REG. REQ.&quot;);
								}
<span class="nc bnc" id="L770" title="All 2 branches missed.">								if (claim != 0) {</span>
									// stBuild.append(&quot;\nDrawTime:&quot; + drawTime +
									// &quot;&quot;);
<span class="nc" id="L773">									stBuild.append(&quot;,No:&quot; + claim</span>
											+ &quot;,Message:CLAIMED&quot;);
								}
<span class="nc bnc" id="L776" title="All 2 branches missed.">								if (pndPay != 0) {</span>
									// stBuild.append(&quot;\nDrawTime:&quot; + drawTime +
									// &quot;&quot;);
<span class="nc" id="L779">									stBuild.append(&quot;,No:&quot; + pndPay</span>
											+ &quot;,Message:IN PROCESS&quot;);
								}
<span class="nc bnc" id="L782" title="All 2 branches missed.">								if (outVerify != 0) {</span>
									// stBuild.append(&quot;\nDrawTime:&quot; + drawTime +
									// &quot;&quot;);
<span class="nc" id="L785">									stBuild.append(&quot;,No:&quot; + outVerify</span>
											+ &quot;,Message:OUT OF VERIFY&quot;);
								}
<span class="nc bnc" id="L788" title="All 2 branches missed.">								if(clm!=0){</span>
<span class="nc" id="L789">									stBuild.append(&quot;,No:&quot; + clm</span>
											+ &quot;,Message:CLM PND &quot;+ Util.getBalInString(drawAmt-govtCommAmt));
								}
							}
<span class="nc" id="L793">							totRegister = totRegister + register;</span>
						}
<span class="nc bnc" id="L795" title="All 2 branches missed.">					} else if (pwtWinningBean.getStatus().equals(&quot;ERROR&quot;)) {</span>
<span class="nc" id="L796">						finalPwtData = &quot;ErrorMsg:&quot; + AndroidErrors.PWT_ERROR+&quot;ErrorCode:&quot; + AndroidErrors.PWT_ERROR_CODE+&quot;|&quot;;</span>
<span class="nc" id="L797">						logger.debug(&quot;FINAL PWT DATA:&quot; + finalPwtData);</span>
<span class="nc" id="L798">						response.getOutputStream().write(</span>
								finalPwtData.getBytes());
<span class="nc" id="L800">						return;</span>
					}

<span class="nc" id="L803">					totTktAmt = totTktAmt + totalRaffleAmount;</span>
 
<span class="nc" id="L805">					stBuild.append(&quot;|Total Pay:&quot; + Util.getBalInString(totTktAmt) + &quot;|&quot;);</span>
<span class="nc bnc" id="L806" title="All 2 branches missed.">					if(totalClmPndAmt&gt;0)</span>
<span class="nc" id="L807">						stBuild.append(&quot;Total CLM PEND:&quot; + Util.getBalInString(totalClmPndAmt-govtCommAmt) + &quot;|&quot;);</span>
					else
<span class="nc" id="L809">						stBuild.append(&quot;Total CLM PEND:&quot; + Util. getBalInString(totalClmPndAmt) + &quot;|&quot;);</span>
<span class="nc bnc" id="L810" title="All 2 branches missed.">					if (totRegister != 0) {</span>
<span class="nc" id="L811">						stBuild.append(&quot;No:&quot; + totRegister</span>
								+ &quot;,Message:Reg. Req&quot;);
					}
					// session.setAttribute(&quot;PWT_RES&quot;, pwtWinningBean);
<span class="nc" id="L815">					currentUserSessionMap.put(userName, session);</span>
					/*
					 * logger.debug(&quot; STRING BUILER is before reprint &quot; +
					 * stBuild);
					 * logger.debug(&quot;--------------------------GAME NUMBER &quot;
					 * + pwtWinningBean.getGameNo());
					 */

				}
			}

		}

<span class="nc" id="L828">		AjaxRequestHelper ajxHelper2 = new AjaxRequestHelper();</span>
<span class="nc" id="L829">		ajxHelper2.getAvlblCreditAmt(userInfoBean);</span>
<span class="nc" id="L830">		double bal2 = userInfoBean.getAvailableCreditLimit()</span>
		- userInfoBean.getClaimableBal();
<span class="nc" id="L832">		double bal = bal2 - bal1;</span>
<span class="nc" id="L833">		NumberFormat nFormat = NumberFormat.getInstance();</span>
<span class="nc" id="L834">		nFormat.setMinimumFractionDigits(2);</span>
<span class="nc" id="L835">		String balance =  nFormat.format(bal).replace(&quot;,&quot;, &quot;&quot;);</span>

<span class="nc" id="L837">		boolean isPromoPrint = false;</span>
<span class="nc bnc" id="L838" title="All 2 branches missed.">		if (mainWinningBean.isReprint()) {</span>
<span class="nc" id="L839">			isPromoPrint = true;</span>
<span class="nc" id="L840">			Object Purchasebean = mainWinningBean.getPurchaseBean();</span>
<span class="nc bnc" id="L841" title="All 2 branches missed.">			if (Purchasebean instanceof FortunePurchaseBean) {</span>
<span class="nc" id="L842">				int gamenbr = helper.getGamenoFromTktnumber(mainWinningBean</span>
						.getTicketNo());
<span class="nc" id="L844">				String gameName = Util.getGameName(gamenbr);</span>

<span class="nc" id="L846">				FortunePurchaseBean bean = (FortunePurchaseBean) mainWinningBean</span>
				.getPurchaseBean();
<span class="nc" id="L848">				stBuild.append(promoTicketDta + &quot;RPRT:&quot;</span>
						+ ReprintHepler.reprintFortuneTicket(bean, gameName));
<span class="nc" id="L850">				String raffleDataRPRT = CommonMethods.buildRaffleData(bean</span>
						.getRafflePurchaseBeanList());

<span class="nc" id="L853">				finalPwtData = raffleData + stBuild.toString() + &quot;|Amt:&quot;</span>
				+ balance + &quot;|QP:&quot; + bean.getIsQuickPick()[0] + &quot;|&quot;
				+ raffleDataRPRT;
<span class="nc bnc" id="L856" title="All 2 branches missed.">			} else if (Purchasebean instanceof LottoPurchaseBean) {</span>
<span class="nc" id="L857">				int gamenbr = helper.getGamenoFromTktnumber(mainWinningBean</span>
						.getTicketNo());
<span class="nc" id="L859">				String gameName = Util.getGameName(gamenbr);</span>

<span class="nc" id="L861">				LottoPurchaseBean bean = (LottoPurchaseBean) mainWinningBean</span>
				.getPurchaseBean();
<span class="nc" id="L863">				stBuild.append(promoTicketDta + &quot;RPRT:&quot;</span>
						+ ReprintHepler.reprintLottoTicket(bean, gameName));
<span class="nc" id="L865">				String raffleDataRPRT = CommonMethods.buildRaffleData(bean</span>
						.getRafflePurchaseBeanList());

<span class="nc" id="L868">				finalPwtData = raffleData + stBuild.toString() + &quot;|Amt:&quot;</span>
				+ balance + &quot;|QP:&quot; + bean.getIsQuickPick()[0] + &quot;|&quot;
				+ raffleDataRPRT;
<span class="nc bnc" id="L871" title="All 2 branches missed.">			} else if (Purchasebean instanceof KenoPurchaseBean) {</span>
<span class="nc" id="L872">				int gamenbr = helper.getGamenoFromTktnumber(mainWinningBean</span>
						.getTicketNo());
<span class="nc" id="L874">				String gameName = Util.getGameName(gamenbr);</span>

<span class="nc" id="L876">				KenoPurchaseBean bean = (KenoPurchaseBean) mainWinningBean</span>
				.getPurchaseBean();
<span class="nc" id="L878">				stBuild.append(promoTicketDta + &quot;RPRT:&quot;</span>
						+ ReprintHepler.reprintKenoTicketJsonFormat(bean, gameName, bal2));
<span class="nc" id="L880">				String raffleDataRPRT = CommonMethods.buildRaffleData(bean</span>
						.getRafflePurchaseBeanList());

<span class="nc" id="L883">				finalPwtData = raffleData + stBuild.toString() + &quot;|Amt:&quot;</span>
				+ balance + &quot;|QP:&quot; + bean.getIsQuickPick()[0] + &quot;|&quot;
				+ raffleDataRPRT;
<span class="nc bnc" id="L886" title="All 2 branches missed.">			} else if (Purchasebean instanceof FortuneTwoPurchaseBean) {</span>
<span class="nc" id="L887">				int gameNbr = helper.getGamenoFromTktnumber(mainWinningBean</span>
						.getTicketNo());
<span class="nc" id="L889">				String gameName = Util.getGameName(gameNbr);</span>
<span class="nc" id="L890">				FortuneTwoPurchaseBean bean = (FortuneTwoPurchaseBean) mainWinningBean</span>
				.getPurchaseBean();
<span class="nc" id="L892">				stBuild</span>
				.append(promoTicketDta + &quot;RPRT:&quot;
						+ ReprintHepler.reprintFortuneTwoTicket(bean,
								gameName));
<span class="nc" id="L896">				String raffleDataRPRT = CommonMethods.buildRaffleData(bean</span>
						.getRafflePurchaseBeanList());
<span class="nc" id="L898">				finalPwtData = raffleData + stBuild.toString() + &quot;|Amt:&quot;</span>
				+ balance + &quot;|QP:&quot; + bean.getIsQuickPick()[0] + &quot;|&quot;
				+ raffleDataRPRT;
<span class="nc bnc" id="L901" title="All 2 branches missed.">			}else if (Purchasebean instanceof FortuneThreePurchaseBean) {</span>
<span class="nc" id="L902">				int gameNbr = helper.getGamenoFromTktnumber(mainWinningBean</span>
						.getTicketNo());
<span class="nc" id="L904">				String gameName = Util.getGameName(gameNbr);</span>
<span class="nc" id="L905">				FortuneThreePurchaseBean bean = (FortuneThreePurchaseBean) mainWinningBean</span>
				.getPurchaseBean();
<span class="nc" id="L907">				stBuild</span>
				.append(promoTicketDta + &quot;RPRT:&quot;
						+ ReprintHepler.reprintFortuneThreeTicket(bean,
								gameName));
<span class="nc" id="L911">				String raffleDataRPRT = CommonMethods.buildRaffleData(bean</span>
						.getRafflePurchaseBeanList());
<span class="nc" id="L913">				finalPwtData = raffleData + stBuild.toString() + &quot;|Amt:&quot;</span>
				+ balance + &quot;|QP:&quot; + bean.getIsQuickPick()[0] + &quot;|&quot;
				+ raffleDataRPRT;
			}
<span class="nc" id="L917">		} else {</span>
<span class="nc" id="L918">			finalPwtData = raffleData + stBuild.toString() + &quot;Amt:&quot; + balance</span>
			+ &quot;|&quot;;
		}
		//Mobile No:1111213132|Ref No:123135458|     to be added ...
<span class="nc" id="L922">		StringBuilder topMsgsStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L923">		StringBuilder bottomMsgsStr = new StringBuilder(&quot;&quot;);</span>
<span class="nc" id="L924">		String advtMsg = &quot;&quot;;</span>

<span class="nc" id="L926">		UtilApplet.getAdvMsgs(mainWinningBean.getAdvMsg(), topMsgsStr,</span>
				bottomMsgsStr, 10);

<span class="nc bnc" id="L929" title="All 2 branches missed.">		if (topMsgsStr.length() != 0) {</span>
<span class="nc" id="L930">			advtMsg = &quot;topAdvMsg:&quot; + topMsgsStr + &quot;|&quot;;</span>
		}

<span class="nc bnc" id="L933" title="All 2 branches missed.">		if (bottomMsgsStr.length() != 0) {</span>
<span class="nc" id="L934">			advtMsg = advtMsg + &quot;bottomAdvMsg:&quot; + bottomMsgsStr + &quot;|&quot;;</span>
		}

<span class="nc bnc" id="L937" title="All 2 branches missed.">		finalPwtData = finalPwtData + advtMsg + ((isPromoPrint)?&quot;&quot;:promoTicketDta);</span>
<span class="nc bnc" id="L938" title="All 2 branches missed.">		if(govtCommAmt&gt;0)</span>
<span class="nc" id="L939">			finalPwtData=finalPwtData+&quot;Tax:&quot;+Util.getBalInString(govtCommAmt)+&quot;|&quot;;</span>
<span class="nc" id="L940">		logger.debug(&quot;FINAL PWT DATA:&quot; + finalPwtData);</span>
<span class="nc" id="L941">		response.getOutputStream().write(finalPwtData.getBytes());</span>
<span class="nc" id="L942">		return;</span>
	}
	public HttpServletResponse getResponse() {
<span class="nc" id="L945">		return response;</span>
	}


	public void setResponse(HttpServletResponse response) {
<span class="nc" id="L950">		this.response = response;</span>
<span class="nc" id="L951">	}</span>


	public HttpSession getSession() {
<span class="nc" id="L955">		return session;</span>
	}


	public void setSession(HttpSession session) {
<span class="nc" id="L960">		this.session = session;</span>
<span class="nc" id="L961">	}</span>


	public String getUserName() {
<span class="nc" id="L965">		return userName;</span>
	}


	public void setUserName(String userName) {
<span class="nc" id="L970">		this.userName = userName;</span>
<span class="nc" id="L971">	}</span>


	public String getMobileNo() {
<span class="nc" id="L975">		return mobileNo;</span>
	}


	public void setMobileNo(String mobileNo) {
<span class="nc" id="L980">		this.mobileNo = mobileNo;</span>
<span class="nc" id="L981">	}</span>


	public long getLSTktNo() {
<span class="nc" id="L985">		return LSTktNo;</span>
	}


	public void setLSTktNo(long lSTktNo) {
<span class="nc" id="L990">		LSTktNo = lSTktNo;</span>
<span class="nc" id="L991">	}</span>


	public String getmPesa() {
<span class="nc" id="L995">		return mPesa;</span>
	}


	public void setmPesa(String mPesa) {
<span class="nc" id="L1000">		this.mPesa = mPesa;</span>
<span class="nc" id="L1001">	}</span>


	public String buildPWTRaffleData(RaffleDrawIdBean raffleWinningBean) {

		// RaffleDrawIdBean
		// raffleWinningBean=(RaffleDrawIdBean)pwtWinningBean.getRaffleDrawIdBeanList().get(0);
<span class="nc" id="L1008">		double totalRaffleAmount = 0.0;</span>
<span class="nc bnc" id="L1009" title="All 2 branches missed.">		if (&quot;FRAUD&quot;.equalsIgnoreCase(raffleWinningBean.getStatus())) {</span>
<span class="nc" id="L1010">			return &quot;ErrorMsg:&quot; + AndroidErrors.PWT_FRAUD+&quot;ErrorCode:&quot; + AndroidErrors.PWT_FRAUD_ERROR_CODE+&quot;|&quot;;</span>

<span class="nc bnc" id="L1012" title="All 2 branches missed.">		} else if (&quot;TICKET_EXPIRED&quot;.equalsIgnoreCase(raffleWinningBean</span>
				.getStatus())) {
<span class="nc" id="L1014">			return &quot;ErrorMsg:&quot; + AndroidErrors.PWT_TICKET_EXPIRED+&quot;ErrorCode:&quot; + AndroidErrors.PWT_TICKET_EXPIRED_ERROR_CODE+&quot;|&quot;;</span>

<span class="nc bnc" id="L1016" title="All 2 branches missed.">		} else if (raffleWinningBean.getStatus().equals(&quot;RES_AWAITED&quot;)) {</span>
<span class="nc" id="L1017">			return raffleWinningBean.getDrawDateTime() + &quot;|Awaited&quot;;</span>

<span class="nc bnc" id="L1019" title="All 4 branches missed.">		} else if (raffleWinningBean.getPwtStatus() != null</span>
				&amp;&amp; raffleWinningBean.getPwtStatus().equalsIgnoreCase(
				&quot;OUT_VERIFY_LIMIT&quot;)) {
<span class="nc" id="L1022">			return &quot;ErrorMsg:&quot; + AndroidErrors.PWT_OUT_VERIFY_LIMIT+&quot;ErrorCode:&quot; + AndroidErrors.PWT_OUT_VERIFY_LIMIT_ERROR_CODE+&quot;|&quot;;</span>

<span class="nc bnc" id="L1024" title="All 4 branches missed.">		} else if (raffleWinningBean.getStatus() != null</span>
				&amp;&amp; raffleWinningBean.getStatus().equals(&quot;NON_WIN&quot;)) {
<span class="nc" id="L1026">			return raffleWinningBean.getDrawDateTime() + &quot;|TRY AGAIN&quot;;</span>

<span class="nc bnc" id="L1028" title="All 4 branches missed.">		} else if (raffleWinningBean.getPwtStatus() != null</span>
				&amp;&amp; raffleWinningBean.getPwtStatus().equals(&quot;NORMAL_PAY&quot;)) {
<span class="nc" id="L1030">			totalRaffleAmount = totalRaffleAmount</span>
			+ Double.parseDouble(raffleWinningBean.getWinningAmt());
<span class="nc" id="L1032">			return raffleWinningBean.getDrawDateTime() + &quot;|WIN &quot;</span>
			+ raffleWinningBean.getWinningAmt() + &quot;&quot; + &quot;RWA&quot;
			+ totalRaffleAmount;

<span class="nc bnc" id="L1036" title="All 4 branches missed.">		} else if (raffleWinningBean.getStatus() != null</span>
				&amp;&amp; raffleWinningBean.getStatus().equals(&quot;CLAIMED&quot;)) {
<span class="nc" id="L1038">			return raffleWinningBean.getDrawDateTime() + &quot;|CLAIMED&quot;;</span>

<span class="nc bnc" id="L1040" title="All 4 branches missed.">		} else if (raffleWinningBean.getPwtStatus() != null</span>
				&amp;&amp; raffleWinningBean.getPwtStatus().equals(&quot;PND_PAY&quot;)) {
<span class="nc" id="L1042">			return &quot;ErrorMsg:&quot; + AndroidErrors.PWT_OUT_VERIFY_LIMIT+&quot;ErrorCode:&quot; + AndroidErrors.PWT_OUT_VERIFY_LIMIT_ERROR_CODE+&quot;|&quot;;</span>

<span class="nc bnc" id="L1044" title="All 4 branches missed.">		} else if (raffleWinningBean.getPwtStatus() != null</span>
				&amp;&amp; raffleWinningBean.getPwtStatus().equals(&quot;HIGH_PRIZE&quot;)) {
<span class="nc" id="L1046">			return &quot;ErrorMsg:&quot; + AndroidErrors.PWT_OUT_VERIFY_LIMIT+&quot;ErrorCode:&quot; + AndroidErrors.PWT_OUT_VERIFY_LIMIT_ERROR_CODE+&quot;|&quot;;</span>

<span class="nc bnc" id="L1048" title="All 4 branches missed.">		} else if (raffleWinningBean.getPwtStatus() != null</span>
				&amp;&amp; raffleWinningBean.getPwtStatus().equals(&quot;OUT_PAY_LIMIT&quot;)) {
<span class="nc" id="L1050">			return &quot;ErrorMsg:&quot; + AndroidErrors.PWT_OUT_VERIFY_LIMIT+&quot;ErrorCode:&quot; + AndroidErrors.PWT_OUT_VERIFY_LIMIT_ERROR_CODE+&quot;|&quot;;</span>

<span class="nc bnc" id="L1052" title="All 4 branches missed.">		} else if (raffleWinningBean.getPwtStatus() != null</span>
				&amp;&amp; raffleWinningBean.getPwtStatus().equals(&quot;OUT_VERIFY_LIMIT&quot;)) {
<span class="nc" id="L1054">			return &quot;ErrorMsg:&quot; + AndroidErrors.PWT_OUT_VERIFY_LIMIT+&quot;ErrorCode:&quot; + AndroidErrors.PWT_OUT_VERIFY_LIMIT_ERROR_CODE+&quot;|&quot;;</span>

		}

<span class="nc" id="L1058">		return &quot;&quot;;</span>
	}	
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>