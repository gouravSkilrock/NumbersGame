<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BankHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.web.bankMgmt.Helpers</a> &gt; <span class="el_source">BankHelper.java</span></div><h1>BankHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.web.bankMgmt.Helpers;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.List;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.exception.LMSErrors;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.web.bankMgmt.beans.BankDetailsBean;
import com.skilrock.lms.web.bankMgmt.beans.BankRepDataBean;
import com.skilrock.lms.web.bankMgmt.beans.BranchDetailsBean;

<span class="nc" id="L21">public class BankHelper {</span>
<span class="nc" id="L22"> Log logger = LogFactory.getLog(BankHelper.class);</span>
	public boolean createBank(BankDetailsBean bankDetailsBean,UserInfoBean userBean,Timestamp creationTime){
<span class="nc" id="L24">		Connection con =null;</span>
<span class="nc" id="L25">		PreparedStatement pstmt =null;</span>
<span class="nc" id="L26">		ResultSet rs = null;</span>
		try{
<span class="nc" id="L28">			con =DBConnect.getConnection();</span>
			
<span class="nc" id="L30">			String query1 =&quot;select bank_display_name from st_lms_bank_master  where bank_display_name=? or role_id=? &quot;;</span>
<span class="nc" id="L31">			pstmt =con.prepareStatement(query1);</span>
<span class="nc" id="L32">			pstmt.setString(1,bankDetailsBean.getBankName());</span>
<span class="nc" id="L33">			pstmt.setInt(2,bankDetailsBean.getRoleId());</span>
<span class="nc" id="L34">			logger.info(&quot;check Bank &quot;+pstmt);</span>
<span class="nc" id="L35">			rs=pstmt.executeQuery();</span>
<span class="nc bnc" id="L36" title="All 2 branches missed.">			if(rs.next()){</span>
<span class="nc" id="L37">				logger.info(&quot;bank already exists with these details&quot;);</span>
<span class="nc" id="L38">				return false;</span>
			}
<span class="nc" id="L40">			con.setAutoCommit(false);</span>
<span class="nc" id="L41">			String query=&quot;insert into st_lms_bank_master(bank_display_name,bank_full_name,bank_address1,bank_address2,country,state,city,role_id,creation_date,created_by_user_id,status) values(?,?,?,?,?,?,?,?,?,?,?)&quot;;</span>

			
<span class="nc" id="L44">			pstmt =con.prepareStatement(query);</span>
<span class="nc" id="L45">			pstmt.setString(1,bankDetailsBean.getBankName());</span>
<span class="nc" id="L46">			pstmt.setString(2,bankDetailsBean.getBankFullName());</span>
<span class="nc" id="L47">			pstmt.setString(3,bankDetailsBean.getBankAddLine1());</span>
<span class="nc" id="L48">			pstmt.setString(4,bankDetailsBean.getBankAddLine2());</span>
<span class="nc" id="L49">			pstmt.setString(5,bankDetailsBean.getCountry());</span>
<span class="nc" id="L50">			pstmt.setString(6,bankDetailsBean.getState());</span>
<span class="nc" id="L51">			pstmt.setString(7,bankDetailsBean.getCity());</span>
<span class="nc" id="L52">			pstmt.setInt(8,bankDetailsBean.getRoleId());</span>
<span class="nc" id="L53">			pstmt.setTimestamp(9, creationTime);</span>
<span class="nc" id="L54">			pstmt.setInt(10, userBean.getUserId());</span>
<span class="nc" id="L55">			pstmt.setString(11,&quot;ACTIVE&quot;);</span>
<span class="nc" id="L56">			logger.info(&quot;create Bank &quot;+pstmt);</span>
<span class="nc" id="L57">			int updated = pstmt.executeUpdate();</span>
<span class="nc" id="L58">			logger.info(&quot;Bank  crated&quot;+updated);</span>
<span class="nc" id="L59">			con.commit();</span>
<span class="nc" id="L60">			return true;</span>
			
			
<span class="nc" id="L63">		}catch(Exception e){</span>
			
<span class="nc" id="L65">			logger.info(&quot;ms&quot;+e.getMessage());</span>
<span class="nc" id="L66">			e.printStackTrace();</span>
		} finally {

<span class="nc" id="L69">			try {</span>
<span class="nc bnc" id="L70" title="All 8 branches missed.">				if (con != null) {</span>
<span class="nc" id="L71">					con.close();</span>
				}
<span class="nc bnc" id="L73" title="All 8 branches missed.">				if (pstmt != null) {</span>

<span class="nc" id="L75">					pstmt.close();</span>
				}
<span class="nc bnc" id="L77" title="All 8 branches missed.">				if (rs != null) {</span>

<span class="nc" id="L79">					rs.close();</span>
				}


<span class="nc" id="L83">			} catch (Exception e) {</span>

<span class="nc" id="L85">				e.printStackTrace();</span>
<span class="nc" id="L86">			}</span>

<span class="nc" id="L88">		}</span>
	
<span class="nc" id="L90">		return false;</span>
	}
	public boolean createBranch(BranchDetailsBean branchDetailsBean, int userId, Timestamp creationTime) {
<span class="nc" id="L93">		Connection con = null;</span>
<span class="nc" id="L94">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L95">		ResultSet rs =null;</span>
		try {
<span class="nc" id="L97">			con = DBConnect.getConnection();</span>
<span class="nc" id="L98">			String query1 =&quot;select branch_display_name from st_lms_branch_master  where branch_display_name=? &quot;;</span>
<span class="nc" id="L99">			pstmt =con.prepareStatement(query1);</span>
<span class="nc" id="L100">			pstmt.setString(1, branchDetailsBean.getBranchName());</span>
<span class="nc" id="L101">			logger.info(&quot;check branch &quot;+pstmt);</span>
<span class="nc" id="L102">			rs=pstmt.executeQuery();</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">			if(rs.next()){</span>
<span class="nc" id="L104">				logger.info(&quot;branch already exists with this name&quot;);</span>
<span class="nc" id="L105">				return false;</span>
			}
<span class="nc" id="L107">			String query = &quot;INSERT INTO st_lms_branch_master(branch_display_name,branch_full_name,branch_address1,branch_address2,country,state,city,creation_date,created_by_user_id,bank_id,STATUS) VALUES (?,?,?,?,?,?,?,?,?,?,?);&quot;;</span>
<span class="nc" id="L108">			con.setAutoCommit(false);</span>
<span class="nc" id="L109">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L110">			pstmt.setString(1, branchDetailsBean.getBranchName());</span>
<span class="nc" id="L111">			pstmt.setString(2, branchDetailsBean.getBranchFullName());</span>
<span class="nc" id="L112">			pstmt.setString(3, branchDetailsBean.getBranchAddLine1());</span>
<span class="nc" id="L113">			pstmt.setString(4, branchDetailsBean.getBranchAddLine2());</span>
<span class="nc" id="L114">			pstmt.setString(5, branchDetailsBean.getCountry());</span>
<span class="nc" id="L115">			pstmt.setString(6, branchDetailsBean.getState());</span>
<span class="nc" id="L116">			pstmt.setString(7, branchDetailsBean.getCity());</span>
<span class="nc" id="L117">			pstmt.setTimestamp(8, creationTime);</span>
<span class="nc" id="L118">			pstmt.setInt(9, userId);</span>
<span class="nc" id="L119">			pstmt.setInt(10, branchDetailsBean.getBankId());</span>
<span class="nc" id="L120">			pstmt.setString(11, &quot;ACTIVE&quot;);</span>
<span class="nc" id="L121">			logger.info(&quot;create branch &quot; + pstmt);</span>
<span class="nc" id="L122">			int updated = pstmt.executeUpdate();</span>
<span class="nc" id="L123">			logger.info(&quot;branch  crated&quot; + updated);</span>
<span class="nc" id="L124">			con.commit();</span>
<span class="nc" id="L125">			return true;</span>

			
<span class="nc" id="L128">		} catch (Exception e) {</span>

<span class="nc" id="L130">			logger.info(&quot;ms&quot; + e.getMessage());</span>
<span class="nc" id="L131">			e.printStackTrace();</span>
		} finally {

<span class="nc" id="L134">			try {</span>
<span class="nc bnc" id="L135" title="All 8 branches missed.">				if (con != null) {</span>
<span class="nc" id="L136">					con.close();</span>
				}
<span class="nc bnc" id="L138" title="All 8 branches missed.">				if (pstmt != null) {</span>

<span class="nc" id="L140">					pstmt.close();</span>
				}
<span class="nc bnc" id="L142" title="All 8 branches missed.">				if (rs != null) {</span>

<span class="nc" id="L144">					rs.close();</span>
				}
<span class="nc" id="L146">			} catch (Exception e) {</span>

<span class="nc" id="L148">				e.printStackTrace();</span>
<span class="nc" id="L149">			}</span>

<span class="nc" id="L151">		}</span>

<span class="nc" id="L153">		return false;</span>
	}
	public boolean assignBranch(int branchId,int userId,UserInfoBean userBean,Timestamp mapTime) {
<span class="nc" id="L156">		Connection con = null;</span>
<span class="nc" id="L157">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L158">		ResultSet rs = null;</span>
<span class="nc" id="L159">		ResultSet rs1 = null;</span>
		try {
<span class="nc" id="L161">			con = DBConnect.getConnection();</span>
<span class="nc" id="L162">			String query = &quot;select bank_id from st_lms_branch_master where branch_id=? and status=?&quot;;</span>
<span class="nc" id="L163">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L164">			pstmt.setInt(1, branchId);</span>
<span class="nc" id="L165">			pstmt.setString(2,&quot;ACTIVE&quot;);</span>
<span class="nc" id="L166">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">			if (rs.next()) {</span>
				
<span class="nc" id="L169">				query = &quot;select * from st_lms_user_branch_mapping where user_id=? &quot;;</span>
<span class="nc" id="L170">				pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L171">				pstmt.setInt(1, userId);</span>
<span class="nc" id="L172">				rs1 = pstmt.executeQuery();</span>
<span class="nc" id="L173">				con.setAutoCommit(false);</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">				if(rs1.next()){</span>
<span class="nc" id="L175">					query = &quot;update st_lms_user_branch_mapping set bank_id=?,branch_id=? where user_id=?&quot;;</span>
<span class="nc" id="L176">					pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L177">					pstmt.setInt(1,rs.getInt(&quot;bank_id&quot;) );</span>
<span class="nc" id="L178">					pstmt.setInt(2,branchId);</span>
<span class="nc" id="L179">					pstmt.setInt(3, userId);</span>
<span class="nc" id="L180">					logger.info(&quot;update user  branch query&quot; + pstmt);</span>
<span class="nc" id="L181">					int updated = pstmt.executeUpdate();</span>
<span class="nc" id="L182">					logger.info(&quot;user branch updated &quot; + updated);</span>
<span class="nc" id="L183">					query = &quot;insert into st_lms_user_branch_mapping_history(current_user_id,bank_id,branch_id,current_branch_id,date_changes,done_by_user_id,comment) values(?,?,?,?,?,?,?)&quot;;</span>
<span class="nc" id="L184">					pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L185">					pstmt.setInt(1,userId);</span>
<span class="nc" id="L186">					pstmt.setInt(2,rs.getInt(&quot;bank_id&quot;));</span>
<span class="nc" id="L187">					pstmt.setInt(3, branchId);</span>
<span class="nc" id="L188">					pstmt.setInt(4, rs1.getInt(&quot;branch_id&quot;));</span>
<span class="nc" id="L189">					pstmt.setTimestamp(5, mapTime);</span>
<span class="nc" id="L190">					pstmt.setInt(6,userBean.getUserId());</span>
<span class="nc" id="L191">					pstmt.setString(7,&quot;Update&quot;);</span>
<span class="nc" id="L192">					logger.info(&quot;assing user to branch &quot; + pstmt);</span>
<span class="nc" id="L193">					updated = pstmt.executeUpdate();</span>
<span class="nc" id="L194">					logger.info(&quot;user assign to branch&quot; + updated);</span>
					
					
<span class="nc" id="L197">				}else{</span>
					
<span class="nc" id="L199">					query = &quot;insert into st_lms_user_branch_mapping(user_id,bank_id,branch_id) values(?,?,?)&quot;;</span>
<span class="nc" id="L200">					pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L201">					pstmt.setInt(1,userId);</span>
<span class="nc" id="L202">					pstmt.setInt(2,rs.getInt(&quot;bank_id&quot;));</span>
<span class="nc" id="L203">					pstmt.setInt(3, branchId);</span>
<span class="nc" id="L204">					logger.info(&quot;assing user to branch &quot; + pstmt);</span>
<span class="nc" id="L205">					int updated = pstmt.executeUpdate();</span>
<span class="nc" id="L206">					logger.info(&quot;user assign to branch&quot; + updated);</span>
					
				}
				
<span class="nc" id="L210">				con.commit();</span>

<span class="nc" id="L212">				return true;</span>

			}

<span class="nc" id="L216">		} catch (Exception e) {</span>

<span class="nc" id="L218">			logger.info(&quot;ms&quot; + e.getMessage());</span>
<span class="nc" id="L219">			e.printStackTrace();</span>
		} finally {

<span class="nc" id="L222">			try {</span>
<span class="nc bnc" id="L223" title="All 8 branches missed.">				if (con != null) {</span>
<span class="nc" id="L224">					con.close();</span>
				}
<span class="nc bnc" id="L226" title="All 8 branches missed.">				if (pstmt != null) {</span>

<span class="nc" id="L228">					pstmt.close();</span>
				}

<span class="nc" id="L231">			} catch (Exception e) {</span>

<span class="nc" id="L233">				e.printStackTrace();</span>
<span class="nc" id="L234">			}</span>

<span class="nc" id="L236">		}</span>

<span class="nc" id="L238">		return false;</span>
	}	
	public String checkBankNameAvailability(String bankName){
<span class="nc" id="L241">		Connection con = null;</span>
<span class="nc" id="L242">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L243">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L245">			con = DBConnect.getConnection();</span>
<span class="nc" id="L246">			String query = &quot;select bank_display_name from st_lms_bank_master where bank_display_name=?&quot;;</span>
<span class="nc" id="L247">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L248">			pstmt.setString(1,bankName.trim());</span>
<span class="nc" id="L249">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">			if (rs.next()) {</span>
				

<span class="nc" id="L253">				return &quot;Not Available&quot;;</span>

			}else{
				
<span class="nc" id="L257">				return &quot;Available&quot;;</span>
				
			}

<span class="nc" id="L261">		} catch (Exception e) {</span>

<span class="nc" id="L263">			logger.info(&quot;ms&quot; + e.getMessage());</span>
<span class="nc" id="L264">			e.printStackTrace();</span>
		} finally {

<span class="nc" id="L267">			try {</span>
<span class="nc bnc" id="L268" title="All 8 branches missed.">				if (con != null) {</span>
<span class="nc" id="L269">					con.close();</span>
				}
<span class="nc bnc" id="L271" title="All 8 branches missed.">				if (pstmt != null) {</span>

<span class="nc" id="L273">					pstmt.close();</span>
				}

<span class="nc" id="L276">			} catch (Exception e) {</span>

<span class="nc" id="L278">				e.printStackTrace();</span>
<span class="nc" id="L279">			}</span>

<span class="nc" id="L281">		}</span>

	
	
<span class="nc" id="L285">		return &quot;Not Available&quot;;</span>
	}
	public String fetchUserList(int roleId) {

<span class="nc" id="L289">		Connection con = null;</span>
<span class="nc" id="L290">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L291">		ResultSet rs = null;</span>
<span class="nc" id="L292">		StringBuilder sb  = new StringBuilder();</span>
		try {
<span class="nc" id="L294">			con = DBConnect.getConnection();</span>
<span class="nc" id="L295">			String query = &quot;select user_id,user_name from st_lms_user_master where role_id=? and isrolehead='N'&quot;;</span>
<span class="nc" id="L296">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L297">			pstmt.setInt(1,roleId);</span>
<span class="nc" id="L298">			rs = pstmt.executeQuery();</span>
	
<span class="nc bnc" id="L300" title="All 2 branches missed.">			while (rs.next()) {</span>
			
<span class="nc" id="L302">				sb.append(rs.getInt(&quot;user_id&quot;)).append(&quot;:&quot;).append(rs.getString(&quot;user_name&quot;)).append(&quot;|&quot;);</span>
			

			}

<span class="nc" id="L307">		} catch (Exception e) {</span>

<span class="nc" id="L309">			logger.info(&quot;ms&quot; + e.getMessage());</span>
<span class="nc" id="L310">			e.printStackTrace();</span>
		} finally {

<span class="nc" id="L313">			try {</span>
<span class="nc bnc" id="L314" title="All 6 branches missed.">				if (con != null) {</span>
<span class="nc" id="L315">					con.close();</span>
				}
<span class="nc bnc" id="L317" title="All 6 branches missed.">				if (pstmt != null) {</span>

<span class="nc" id="L319">					pstmt.close();</span>
				}

<span class="nc" id="L322">			} catch (Exception e) {</span>

<span class="nc" id="L324">				e.printStackTrace();</span>
<span class="nc" id="L325">			}</span>

<span class="nc" id="L327">		}</span>

	
	
<span class="nc" id="L331">		return sb.toString();</span>
	
	}

	public String fetchBankList(int roleId) {
<span class="nc" id="L336">		Connection con = null;</span>
<span class="nc" id="L337">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L338">		ResultSet rs = null;</span>
<span class="nc" id="L339">		StringBuilder bankList = new StringBuilder();</span>
		try {
<span class="nc" id="L341">			con = DBConnect.getConnection();</span>
<span class="nc" id="L342">			String query = &quot;SELECT bank_id bankId, bank_display_name bankName FROM st_lms_bank_master WHERE status='ACTIVE' ORDER BY bank_id&quot;;</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">			if(roleId!=1){</span>
<span class="nc" id="L344">				query = &quot;SELECT bank_id bankId, bank_display_name bankName FROM st_lms_bank_master WHERE status='ACTIVE'  and role_id=&quot;+roleId+&quot; ORDER BY bank_id&quot;;</span>
			}
			
<span class="nc" id="L347">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L348">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L349" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L350">				bankList.append(rs.getInt(&quot;bankId&quot;)).append(&quot;:&quot;).append(rs.getString(&quot;bankName&quot;)).append(&quot;|&quot;);</span>
			}
<span class="nc" id="L352">		} catch (Exception e) {</span>
<span class="nc" id="L353">			logger.info(&quot;Exception - &quot; + e.getMessage());</span>
<span class="nc" id="L354">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L356">			DBConnect.closeCon(con);</span>
<span class="nc" id="L357">		}</span>

<span class="nc" id="L359">		return bankList.toString();</span>
	}

	public int fetchBankList(int roleId, Connection con) {

<span class="nc" id="L364">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L365">		ResultSet rs = null;</span>
	 try {

<span class="nc" id="L368">			String query = &quot;SELECT bank_id bankId, bank_display_name bankName FROM st_lms_bank_master WHERE status='ACTIVE'  and role_id=&quot;+ roleId + &quot; ORDER BY bank_id&quot;;</span>
<span class="nc" id="L369">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L370">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L371" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L372">				return rs.getInt(&quot;bankId&quot;);</span>

			}
<span class="nc" id="L375">		} catch (Exception e) {</span>
<span class="nc" id="L376">			logger.info(&quot;Exception - &quot; + e.getMessage());</span>
<span class="nc" id="L377">			e.printStackTrace();</span>
<span class="nc" id="L378">		} </span>

<span class="nc" id="L380">		return 0;</span>
	}
	public String fetchBranchList(int roleId) {
<span class="nc" id="L383">		Connection con = null;</span>
<span class="nc" id="L384">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L385">		ResultSet rs = null;</span>
<span class="nc" id="L386">		StringBuilder sb  = new StringBuilder();</span>
		try {
<span class="nc" id="L388">			con = DBConnect.getConnection();</span>
<span class="nc" id="L389">			String query = &quot; &quot;;</span>
<span class="nc bnc" id="L390" title="All 2 branches missed.">			if(roleId==1){</span>
<span class="nc" id="L391">				query = &quot; select branch_id,branch_display_name from st_lms_branch_master branchM inner join 	st_lms_bank_master bankM on branchM.bank_id=bankM.bank_id where branchM.status='ACTIVE'  and bankM.status='ACTIVE' &quot;;</span>
<span class="nc" id="L392">				pstmt = con.prepareStatement(query);</span>
				
			}else {
				
<span class="nc" id="L396">				query = &quot; select branch_id,branch_display_name from st_lms_branch_master branchM inner join 	st_lms_bank_master bankM on branchM.bank_id=bankM.bank_id where branchM.status='ACTIVE'  and bankM.status='ACTIVE' and role_id=? &quot;;</span>
<span class="nc" id="L397">				pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L398">				pstmt.setInt(1,roleId);</span>
				
			}
<span class="nc" id="L401">			rs = pstmt.executeQuery();</span>
	
<span class="nc bnc" id="L403" title="All 2 branches missed.">			while (rs.next()) {</span>
			
<span class="nc" id="L405">				sb.append(rs.getInt(&quot;branch_id&quot;)).append(&quot;:&quot;).append(rs.getString(&quot;branch_display_name&quot;)).append(&quot;|&quot;);</span>
			

			}

<span class="nc" id="L410">		} catch (Exception e) {</span>

<span class="nc" id="L412">			logger.info(&quot;ms&quot; + e.getMessage());</span>
<span class="nc" id="L413">			e.printStackTrace();</span>
		} finally {

<span class="nc" id="L416">			try {</span>
<span class="nc bnc" id="L417" title="All 6 branches missed.">				if (con != null) {</span>
<span class="nc" id="L418">					con.close();</span>
				}
<span class="nc bnc" id="L420" title="All 6 branches missed.">				if (pstmt != null) {</span>

<span class="nc" id="L422">					pstmt.close();</span>
				}

<span class="nc" id="L425">			} catch (Exception e) {</span>

<span class="nc" id="L427">				e.printStackTrace();</span>
<span class="nc" id="L428">			}</span>

<span class="nc" id="L430">		}</span>

	
	
<span class="nc" id="L434">		return sb.toString();</span>
	}
	public String fetchRoleList() {
<span class="nc" id="L437">		Connection con = null;</span>
<span class="nc" id="L438">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L439">		ResultSet rs = null;</span>
<span class="nc" id="L440">		StringBuilder sb  = new StringBuilder();</span>
		try {
<span class="nc" id="L442">			con = DBConnect.getConnection();</span>
<span class="nc" id="L443">			String query = &quot; select distinct rm.role_id roleId,role_name roleName from st_lms_role_master  rm left join st_lms_bank_master bankM on bankM.role_id =rm.role_id where bankM.role_id is null and is_master !='Y'&quot;;</span>
<span class="nc" id="L444">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L445">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L446">			logger.info(&quot;role list query&quot;+pstmt);</span>
<span class="nc bnc" id="L447" title="All 2 branches missed.">			while (rs.next()) {</span>
			
<span class="nc" id="L449">				sb.append(rs.getInt(&quot;roleId&quot;)).append(&quot;:&quot;).append(rs.getString(&quot;roleName&quot;)).append(&quot;|&quot;);</span>
			

			}

<span class="nc" id="L454">		} catch (Exception e) {</span>

<span class="nc" id="L456">			logger.info(&quot;ms&quot; + e.getMessage());</span>
<span class="nc" id="L457">			e.printStackTrace();</span>
		} finally {

<span class="nc" id="L460">			try {</span>
<span class="nc bnc" id="L461" title="All 6 branches missed.">				if (con != null) {</span>
<span class="nc" id="L462">					con.close();</span>
				}
<span class="nc bnc" id="L464" title="All 6 branches missed.">				if (pstmt != null) {</span>

<span class="nc" id="L466">					pstmt.close();</span>
				}

<span class="nc" id="L469">			} catch (Exception e) {</span>

<span class="nc" id="L471">				e.printStackTrace();</span>
<span class="nc" id="L472">			}</span>

<span class="nc" id="L474">		}</span>

	
	
<span class="nc" id="L478">		return sb.toString();</span>
	}
	public String fetchBranchListForBank(int bankId) {

<span class="nc" id="L482">		Connection con = null;</span>
<span class="nc" id="L483">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L484">		ResultSet rs = null;</span>
<span class="nc" id="L485">		StringBuilder sb  = new StringBuilder();</span>
		try {
<span class="nc" id="L487">			con = DBConnect.getConnection();</span>
<span class="nc" id="L488">			String query = &quot; select branch_id,branch_display_name from st_lms_branch_master branchM inner join &quot; +</span>
							&quot;	st_lms_bank_master bankM on branchM.bank_id=bankM.bank_id where branchM.status='ACTIVE'  and bankM.status='ACTIVE' and branchM.bank_id=? &quot;;
<span class="nc" id="L490">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L491">			pstmt.setInt(1,bankId);</span>
<span class="nc" id="L492">			rs = pstmt.executeQuery();</span>
	
<span class="nc bnc" id="L494" title="All 2 branches missed.">			while (rs.next()) {</span>
			
<span class="nc" id="L496">				sb.append(rs.getInt(&quot;branch_id&quot;)).append(&quot;:&quot;).append(rs.getString(&quot;branch_display_name&quot;)).append(&quot;|&quot;);</span>
			

			}

<span class="nc" id="L501">		} catch (Exception e) {</span>

<span class="nc" id="L503">			logger.info(&quot;ms&quot; + e.getMessage());</span>
<span class="nc" id="L504">			e.printStackTrace();</span>
		} finally {

<span class="nc" id="L507">			try {</span>
<span class="nc bnc" id="L508" title="All 6 branches missed.">				if (con != null) {</span>
<span class="nc" id="L509">					con.close();</span>
				}
<span class="nc bnc" id="L511" title="All 6 branches missed.">				if (pstmt != null) {</span>

<span class="nc" id="L513">					pstmt.close();</span>
				}

<span class="nc" id="L516">			} catch (Exception e) {</span>

<span class="nc" id="L518">				e.printStackTrace();</span>
<span class="nc" id="L519">			}</span>

<span class="nc" id="L521">		}</span>

	
	
<span class="nc" id="L525">		return sb.toString();</span>
	
	}
	
	public String fetchUserBranchDetails(int userId) {

<span class="nc" id="L531">		Connection con = null;</span>
<span class="nc" id="L532">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L533">		ResultSet rs = null;</span>
<span class="nc" id="L534">		StringBuilder sb  = new StringBuilder();</span>
		try {
<span class="nc" id="L536">			con = DBConnect.getConnection();</span>
<span class="nc" id="L537">			String query = &quot; select branch_full_name,branch_display_name,branchM.branch_id from st_lms_branch_master branchM inner join st_lms_user_branch_mapping brm on branchM.branch_id=brm.branch_id where branchM.status='ACTIVE'  and brm.user_id=? &quot;;</span>
<span class="nc" id="L538">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L539">			pstmt.setInt(1,userId);</span>
<span class="nc" id="L540">			rs = pstmt.executeQuery();</span>
	
<span class="nc bnc" id="L542" title="All 2 branches missed.">			while (rs.next()) {</span>
			
<span class="nc" id="L544">				sb.append(rs.getString(&quot;branch_id&quot;)).append(&quot;:&quot;).append( rs.getString(&quot;branch_display_name&quot;)).append(&quot;:&quot;).append(rs.getString(&quot;branch_full_name&quot;)).append(&quot;|&quot;);</span>
			

			}

<span class="nc" id="L549">		} catch (Exception e) {</span>

<span class="nc" id="L551">			logger.info(&quot;ms&quot; + e.getMessage());</span>
<span class="nc" id="L552">			e.printStackTrace();</span>
		} finally {

<span class="nc" id="L555">			try {</span>
<span class="nc bnc" id="L556" title="All 6 branches missed.">				if (con != null) {</span>
<span class="nc" id="L557">					con.close();</span>
				}
<span class="nc bnc" id="L559" title="All 6 branches missed.">				if (pstmt != null) {</span>

<span class="nc" id="L561">					pstmt.close();</span>
				}

<span class="nc" id="L564">			} catch (Exception e) {</span>

<span class="nc" id="L566">				e.printStackTrace();</span>
<span class="nc" id="L567">			}</span>

<span class="nc" id="L569">		}</span>

	
	
<span class="nc" id="L573">		return sb.toString();</span>
	
	}
	public String fetchAgentBankList() {

<span class="nc" id="L578">		Connection con = null;</span>
<span class="nc" id="L579">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L580">		ResultSet rs = null;</span>
<span class="nc" id="L581">		StringBuilder bankList = new StringBuilder();</span>
		try {
<span class="nc" id="L583">			con = DBConnect.getConnection();</span>
<span class="nc" id="L584">			String query = &quot;SELECT bank_id bankId, bank_name bankName,bank_type bankType FROM st_lms_agent_bank_master ORDER BY bank_id&quot;;</span>
<span class="nc" id="L585">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L586">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L588">				bankList.append(rs.getInt(&quot;bankId&quot;)).append(&quot;:&quot;).append(rs.getString(&quot;bankType&quot;)).append(&quot;:&quot;).append(rs.getString(&quot;bankName&quot;)).append(&quot;|&quot;);</span>
			}
<span class="nc" id="L590">		} catch (Exception e) {</span>
<span class="nc" id="L591">			logger.info(&quot;Exception - &quot; + e.getMessage());</span>
<span class="nc" id="L592">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L594">			DBConnect.closeCon(con);</span>
<span class="nc" id="L595">		}</span>

<span class="nc" id="L597">		return bankList.toString();</span>
	
	}
	public String fetchAgentBranchListForBank(int bankId) {


<span class="nc" id="L603">		Connection con = null;</span>
<span class="nc" id="L604">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L605">		ResultSet rs = null;</span>
<span class="nc" id="L606">		StringBuilder sb  = new StringBuilder();</span>
		try {
<span class="nc" id="L608">			con = DBConnect.getConnection();</span>
<span class="nc" id="L609">			String query = &quot;SELECT branch_id branchId, branch_name branchName,branch_sort_code branchSortCode FROM st_lms_agent_branch_master where bank_id=? ORDER BY branch_id&quot;;</span>
<span class="nc" id="L610">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L611">			pstmt.setInt(1,bankId);</span>
<span class="nc" id="L612">			rs = pstmt.executeQuery();</span>
	
<span class="nc bnc" id="L614" title="All 2 branches missed.">			while (rs.next()) {</span>
			
<span class="nc" id="L616">				sb.append(rs.getInt(&quot;branchId&quot;)).append(&quot;:&quot;).append(rs.getString(&quot;branchSortCode&quot;)).append(&quot;:&quot;).append(rs.getString(&quot;branchName&quot;)).append(&quot;|&quot;);</span>
			

			}

<span class="nc" id="L621">		} catch (Exception e) {</span>

<span class="nc" id="L623">			logger.info(&quot;ms&quot; + e.getMessage());</span>
<span class="nc" id="L624">			e.printStackTrace();</span>
		} finally {

<span class="nc" id="L627">			try {</span>
<span class="nc bnc" id="L628" title="All 6 branches missed.">				if (con != null) {</span>
<span class="nc" id="L629">					con.close();</span>
				}
<span class="nc bnc" id="L631" title="All 6 branches missed.">				if (pstmt != null) {</span>

<span class="nc" id="L633">					pstmt.close();</span>
				}

<span class="nc" id="L636">			} catch (Exception e) {</span>

<span class="nc" id="L638">				e.printStackTrace();</span>
<span class="nc" id="L639">			}</span>

<span class="nc" id="L641">		}</span>

	
	
<span class="nc" id="L645">		return sb.toString();</span>
	
	
	}
	public boolean saveDetails(int bankId,int branchId, int agtOrgId,String accountNbr, UserInfoBean userBean,Timestamp mapTime) {

<span class="nc" id="L651">		Connection con = null;</span>
<span class="nc" id="L652">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L653">		ResultSet rs = null;</span>

		try {
<span class="nc" id="L656">			con = DBConnect.getConnection();</span>
<span class="nc" id="L657">			con.setAutoCommit(false);</span>
<span class="nc" id="L658">			String query = &quot;select bank_id,branch_id,account_nbr from st_lms_agent_bank_details where agent_org_id=? &quot;;</span>
<span class="nc" id="L659">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L660">			pstmt.setInt(1, agtOrgId);</span>
<span class="nc" id="L661">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L662" title="All 2 branches missed.">			if (rs.next()) {</span>
				
<span class="nc" id="L664">				query = &quot;insert into st_lms_agent_bank_details_history(agent_org_id,bank_id,branch_id,account_nbr,doneBy_user_id,date_changes) values(?,?,?,?,?,?)&quot;;</span>
<span class="nc" id="L665">				pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L666">				pstmt.setInt(1,agtOrgId);</span>
<span class="nc" id="L667">				pstmt.setInt(2,rs.getInt(&quot;bank_id&quot;));</span>
<span class="nc" id="L668">				pstmt.setInt(3, rs.getInt(&quot;branch_id&quot;));</span>
<span class="nc" id="L669">				pstmt.setString(4, rs.getString(&quot;account_nbr&quot;));</span>
<span class="nc" id="L670">				pstmt.setInt(5, userBean.getUserId());</span>
<span class="nc" id="L671">				pstmt.setTimestamp(6,mapTime);</span>
<span class="nc" id="L672">				logger.info(&quot;save agent Bank Details history query&quot; + pstmt);</span>
<span class="nc" id="L673">				int inserted = pstmt.executeUpdate();</span>
<span class="nc" id="L674">				logger.info(&quot;agent Bank Details  history saved&quot; + inserted);</span>
				
<span class="nc" id="L676">				query = &quot;update  st_lms_agent_bank_details set bank_id=?,branch_id=?,account_nbr=?,doneBy_user_id=? where agent_org_id=?&quot;;</span>
<span class="nc" id="L677">				pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L678">				pstmt.setInt(1,bankId);</span>
<span class="nc" id="L679">				pstmt.setInt(2, branchId);</span>
<span class="nc" id="L680">				pstmt.setString(3, accountNbr);</span>
<span class="nc" id="L681">				pstmt.setInt(4, userBean.getUserId());</span>
<span class="nc" id="L682">				pstmt.setInt(5,agtOrgId);</span>
<span class="nc" id="L683">				logger.info(&quot;update agent Bank Details &quot; + pstmt);</span>
<span class="nc" id="L684">				int updated = pstmt.executeUpdate();</span>
<span class="nc" id="L685">				logger.info(&quot;agent Bank Details updated&quot; + updated);</span>
					
<span class="nc" id="L687">				}else{</span>
					
<span class="nc" id="L689">					query = &quot;insert into st_lms_agent_bank_details(agent_org_id,bank_id,branch_id,account_nbr,doneBy_user_id) values(?,?,?,?,?)&quot;;</span>
<span class="nc" id="L690">					pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L691">					pstmt.setInt(1,agtOrgId);</span>
<span class="nc" id="L692">					pstmt.setInt(2,bankId);</span>
<span class="nc" id="L693">					pstmt.setInt(3, branchId);</span>
<span class="nc" id="L694">					pstmt.setString(4, accountNbr);</span>
<span class="nc" id="L695">					pstmt.setInt(5, userBean.getUserId());</span>
<span class="nc" id="L696">					logger.info(&quot;save agent Bank Details &quot; + pstmt);</span>
<span class="nc" id="L697">					int inserted = pstmt.executeUpdate();</span>
<span class="nc" id="L698">					logger.info(&quot;agent Bank Details saved&quot; + inserted);</span>
					
				}
				
<span class="nc" id="L702">				con.commit();</span>

<span class="nc" id="L704">				return true;</span>

		

<span class="nc" id="L708">		} catch (Exception e) {</span>

<span class="nc" id="L710">			logger.info(&quot;ms&quot; + e.getMessage());</span>
<span class="nc" id="L711">			e.printStackTrace();</span>
		} finally {

<span class="nc" id="L714">			try {</span>
<span class="nc bnc" id="L715" title="All 6 branches missed.">				if (con != null) {</span>
<span class="nc" id="L716">					con.close();</span>
				}
<span class="nc bnc" id="L718" title="All 6 branches missed.">				if (pstmt != null) {</span>

<span class="nc" id="L720">					pstmt.close();</span>
				}

<span class="nc" id="L723">			} catch (Exception e) {</span>

<span class="nc" id="L725">				e.printStackTrace();</span>
<span class="nc" id="L726">			}</span>

<span class="nc" id="L728">		}</span>

<span class="nc" id="L730">		return false;</span>
	
		
	}
	
	public void saveDetails(int bankId,int branchId, int agtOrgId,String accountNbr, UserInfoBean userBean,Timestamp mapTime , Connection con) throws LMSException {

<span class="nc" id="L737">		ResultSet rs = null;</span>
<span class="nc" id="L738">		PreparedStatement pstmt = null;</span>
		try {
<span class="nc" id="L740">			String query = &quot;select bank_id,branch_id,account_nbr from st_lms_agent_bank_details where agent_org_id=? &quot;;</span>
<span class="nc" id="L741">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L742">			pstmt.setInt(1, agtOrgId);</span>
<span class="nc" id="L743">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L744" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L745">				query = &quot;insert into st_lms_agent_bank_details_history(agent_org_id,bank_id,branch_id,account_nbr,doneBy_user_id,date_changes) values(?,?,?,?,?,?)&quot;;</span>
<span class="nc" id="L746">				pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L747">				pstmt.setInt(1,agtOrgId);</span>
<span class="nc" id="L748">				pstmt.setInt(2,rs.getInt(&quot;bank_id&quot;));</span>
<span class="nc" id="L749">				pstmt.setInt(3, rs.getInt(&quot;branch_id&quot;));</span>
<span class="nc" id="L750">				pstmt.setString(4, rs.getString(&quot;account_nbr&quot;));</span>
<span class="nc" id="L751">				pstmt.setInt(5, userBean.getUserId());</span>
<span class="nc" id="L752">				pstmt.setTimestamp(6,mapTime);</span>
<span class="nc" id="L753">				logger.info(&quot;save agent Bank Details history query&quot; + pstmt);</span>
<span class="nc" id="L754">				int inserted = pstmt.executeUpdate();</span>
<span class="nc" id="L755">				logger.info(&quot;agent Bank Details  history saved&quot; + inserted);</span>
				
<span class="nc" id="L757">				query = &quot;update  st_lms_agent_bank_details set bank_id=?,branch_id=?,account_nbr=?,doneBy_user_id=? where agent_org_id=?&quot;;</span>
<span class="nc" id="L758">				pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L759">				pstmt.setInt(1,bankId);</span>
<span class="nc" id="L760">				pstmt.setInt(2, branchId);</span>
<span class="nc" id="L761">				pstmt.setString(3, accountNbr);</span>
<span class="nc" id="L762">				pstmt.setInt(4, userBean.getUserId());</span>
<span class="nc" id="L763">				pstmt.setInt(5,agtOrgId);</span>
<span class="nc" id="L764">				logger.info(&quot;update agent Bank Details &quot; + pstmt);</span>
<span class="nc" id="L765">				int updated = pstmt.executeUpdate();</span>
<span class="nc" id="L766">				logger.info(&quot;agent Bank Details updated&quot; + updated);</span>
<span class="nc" id="L767">			}else{</span>
<span class="nc" id="L768">				query = &quot;insert into st_lms_agent_bank_details(agent_org_id,bank_id,branch_id,account_nbr,doneBy_user_id) values(?,?,?,?,?)&quot;;</span>
<span class="nc" id="L769">				pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L770">				pstmt.setInt(1,agtOrgId);</span>
<span class="nc" id="L771">				pstmt.setInt(2,bankId);</span>
<span class="nc" id="L772">				pstmt.setInt(3, branchId);</span>
<span class="nc" id="L773">				pstmt.setString(4, accountNbr);</span>
<span class="nc" id="L774">				pstmt.setInt(5, userBean.getUserId());</span>
<span class="nc" id="L775">				logger.info(&quot;save agent Bank Details &quot; + pstmt);</span>
<span class="nc" id="L776">				int inserted = pstmt.executeUpdate();</span>
<span class="nc" id="L777">				logger.info(&quot;agent Bank Details saved&quot; + inserted);</span>
			}
<span class="nc" id="L779">		} catch (Exception e) {</span>
<span class="nc" id="L780">			logger.info(&quot;ms&quot; + e.getMessage());</span>
<span class="nc" id="L781">			e.printStackTrace();</span>
<span class="nc" id="L782">			throw new LMSException(LMSErrors.AGENT_BANK_DETAILS_ERROR_CODE, LMSErrors.AGENT_BANK_DETAILS_ERROR_MESSAGE);</span>
		} finally {
<span class="nc" id="L784">			DBConnect.closeConnection(pstmt, rs);</span>
<span class="nc" id="L785">		} </span>
<span class="nc" id="L786">	}</span>

	
	
	
	public String fetchAgentBankDetails(int agtOrgId) {


<span class="nc" id="L794">		Connection con = null;</span>
<span class="nc" id="L795">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L796">		ResultSet rs = null;</span>
<span class="nc" id="L797">		StringBuilder sb  = new StringBuilder();</span>
		try {
<span class="nc" id="L799">			con = DBConnect.getConnection();</span>
<span class="nc" id="L800">			String query = &quot; select branch_name,bank_name,account_nbr from (select bank_id,branch_id,account_nbr from st_lms_agent_bank_details where agent_org_id=?)agtDet left join st_lms_agent_bank_master bm  on bm.bank_id=agtDet.bank_id   left join st_lms_agent_branch_master brm on brm.branch_id=agtDet.branch_id&quot;;</span>
<span class="nc" id="L801">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L802">			pstmt.setInt(1,agtOrgId);</span>
<span class="nc" id="L803">			rs = pstmt.executeQuery();</span>
	
<span class="nc bnc" id="L805" title="All 2 branches missed.">			while (rs.next()) {</span>
			
<span class="nc" id="L807">				sb.append(rs.getString(&quot;branch_name&quot;)).append(&quot;:&quot;).append( rs.getString(&quot;bank_name&quot;)).append(&quot;:&quot;).append(rs.getString(&quot;account_nbr&quot;)).append(&quot;|&quot;);</span>
			

			}

<span class="nc" id="L812">		} catch (Exception e) {</span>

<span class="nc" id="L814">			logger.info(&quot;ms&quot; + e.getMessage());</span>
<span class="nc" id="L815">			e.printStackTrace();</span>
		} finally {

<span class="nc" id="L818">			try {</span>
<span class="nc bnc" id="L819" title="All 6 branches missed.">				if (con != null) {</span>
<span class="nc" id="L820">					con.close();</span>
				}
<span class="nc bnc" id="L822" title="All 6 branches missed.">				if (pstmt != null) {</span>

<span class="nc" id="L824">					pstmt.close();</span>
				}

<span class="nc" id="L827">			} catch (Exception e) {</span>

<span class="nc" id="L829">				e.printStackTrace();</span>
<span class="nc" id="L830">			}</span>

<span class="nc" id="L832">		}</span>

	
	
<span class="nc" id="L836">		return sb.toString();</span>
	
	
	}
	public List&lt;BankRepDataBean&gt; fetchBankandBranchDetails(String delType,
			int bankId, int branchId, String regStartDate, String regEndDate,int roleId) {


<span class="nc" id="L844">		Connection con =null;</span>
<span class="nc" id="L845">		PreparedStatement ps =null;</span>
<span class="nc" id="L846">		ResultSet rs =null;</span>
<span class="nc" id="L847">		List&lt;BankRepDataBean&gt; bankRepDataList =new ArrayList&lt;BankRepDataBean&gt;();</span>
		try{
<span class="nc" id="L849">			con =DBConnect.getConnection();</span>
<span class="nc" id="L850">			StringBuilder  queryBuilder =new StringBuilder();</span>
<span class="nc" id="L851">			String appendQuery =&quot; &quot;;</span>
		
<span class="nc bnc" id="L853" title="All 2 branches missed.">			if(roleId!=1){</span>
<span class="nc" id="L854">				bankId=fetchBankList(roleId,con);</span>
<span class="nc bnc" id="L855" title="All 2 branches missed.">				if(bankId==0){</span>
<span class="nc" id="L856">					logger.info(&quot;Error In Getting Bank Id&quot;);</span>
<span class="nc" id="L857">					return bankRepDataList;</span>
				}
			}
<span class="nc" id="L860">			boolean isBank =true;</span>
<span class="nc bnc" id="L861" title="All 2 branches missed.">			if(!delType.equalsIgnoreCase(&quot;Bank&quot;)){</span>
<span class="nc" id="L862">				isBank=false;</span>
			}
<span class="nc bnc" id="L864" title="All 2 branches missed.">			if(branchId&gt;0){</span>
<span class="nc" id="L865">				appendQuery=&quot; and brm.bank_id=&quot;+bankId+&quot; and brm.branch_id=&quot;+branchId;</span>
				
<span class="nc bnc" id="L867" title="All 2 branches missed.">			}else if(bankId&gt;0){</span>
<span class="nc" id="L868">				appendQuery=&quot; and brm.bank_id=&quot;+bankId;</span>
				
			}
<span class="nc bnc" id="L871" title="All 2 branches missed.">			if(isBank){</span>
<span class="nc" id="L872">				queryBuilder.append(&quot;select bank_id,bank_display_name,bank_full_name,sm.name,cm.city_name,creation_date,bm.status from (select bank_id,bank_display_name,bank_full_name,state,city,creation_date,status from st_lms_bank_master brm where  date(creation_date)&gt;=? and date(creation_date)&lt;=?  &quot;+appendQuery+&quot;  ) bm inner join st_lms_state_master sm on sm.state_code=bm.state inner join st_lms_city_master cm on cm.city_code=bm.city order by bank_id&quot;);</span>
				
			}else{
<span class="nc" id="L875">				queryBuilder.append(&quot;select bank_id,branch_id,bank_display_name,bank_full_name,branch_display_name,branch_full_name,sm.name,cm.city_name,creation_date,bm.status from ( select  brm.bank_id,branch_id,bank_display_name,bank_full_name,branch_display_name,branch_full_name,brm.state,brm.city,brm.creation_date,brm.status from st_lms_branch_master brm inner join st_lms_bank_master bankm on brm.bank_id=bankm.bank_id where  date( brm.creation_date)&gt;=? and date( brm.creation_date)&lt;=? &quot;+appendQuery+&quot; ) bm inner join st_lms_state_master sm on sm.state_code=bm.state inner join st_lms_city_master cm on cm.city_code=bm.city order by bank_id&quot;);</span>
			}
		
		
<span class="nc" id="L879">			ps =con.prepareStatement(queryBuilder.toString());</span>
<span class="nc" id="L880">			ps.setString(1, regStartDate);</span>
<span class="nc" id="L881">			ps.setString(2, regEndDate);</span>
<span class="nc" id="L882">			logger.info(&quot;bank datails query&quot;+ps);</span>
<span class="nc" id="L883">			rs =ps.executeQuery();</span>
<span class="nc bnc" id="L884" title="All 2 branches missed.">			if(isBank){</span>
<span class="nc bnc" id="L885" title="All 2 branches missed.">				while(rs.next()){</span>
<span class="nc" id="L886">					BankRepDataBean repDataBean = new BankRepDataBean();</span>
<span class="nc" id="L887">					repDataBean.setBankName(rs.getString(&quot;bank_display_name&quot;));</span>
<span class="nc" id="L888">					repDataBean.setBankFullName(rs.getString(&quot;bank_full_name&quot;));</span>
<span class="nc" id="L889">					repDataBean.setState(rs.getString(&quot;name&quot;));</span>
<span class="nc" id="L890">					repDataBean.setCity(rs.getString(&quot;city_name&quot;));</span>
<span class="nc" id="L891">					repDataBean.setStatus(rs.getString(&quot;status&quot;));</span>
<span class="nc" id="L892">					repDataBean.setCreationDate(rs.getString(&quot;creation_date&quot;).replace(&quot;.0&quot;, &quot;&quot;));</span>
<span class="nc" id="L893">					bankRepDataList.add(repDataBean);</span>
<span class="nc" id="L894">				}</span>
			}else{
				
<span class="nc bnc" id="L897" title="All 2 branches missed.">				while(rs.next()){</span>
<span class="nc" id="L898">					BankRepDataBean repDataBean = new BankRepDataBean();</span>
<span class="nc" id="L899">					repDataBean.setBankName(rs.getString(&quot;bank_display_name&quot;));</span>
<span class="nc" id="L900">					repDataBean.setBankFullName(rs.getString(&quot;bank_full_name&quot;));</span>
<span class="nc" id="L901">					repDataBean.setBranchName(rs.getString(&quot;branch_display_name&quot;));</span>
<span class="nc" id="L902">					repDataBean.setBranchFullName(rs.getString(&quot;branch_full_name&quot;));</span>
<span class="nc" id="L903">					repDataBean.setState(rs.getString(&quot;name&quot;));</span>
<span class="nc" id="L904">					repDataBean.setCity(rs.getString(&quot;city_name&quot;));</span>
<span class="nc" id="L905">					repDataBean.setStatus(rs.getString(&quot;status&quot;));</span>
<span class="nc" id="L906">					repDataBean.setCreationDate(rs.getString(&quot;creation_date&quot;).replace(&quot;.0&quot;,&quot;&quot;));</span>
					
<span class="nc" id="L908">					bankRepDataList.add(repDataBean);</span>
<span class="nc" id="L909">				}</span>
				
			}
			
<span class="nc" id="L913">		}catch(Exception e){</span>
<span class="nc" id="L914">			e.printStackTrace();</span>
		}finally {
<span class="nc" id="L916">			try{</span>
<span class="nc bnc" id="L917" title="All 8 branches missed.">				if(con!=null){</span>
<span class="nc" id="L918">					con.close();</span>
				}
<span class="nc bnc" id="L920" title="All 8 branches missed.">				if(ps!=null){</span>
<span class="nc" id="L921">					ps.close();</span>
				}
<span class="nc bnc" id="L923" title="All 8 branches missed.">				if(rs!=null){</span>
<span class="nc" id="L924">					rs.close();</span>
				}
					
<span class="nc" id="L927">			}catch(Exception e){</span>
<span class="nc" id="L928">				e.printStackTrace();</span>
<span class="nc" id="L929">			}</span>
<span class="nc" id="L930">		}</span>
		
<span class="nc" id="L932">		return bankRepDataList;</span>
	
	
	}
	public List&lt;BankRepDataBean&gt; fetchCashierDetails(int bankId, int branchId,
			String regStartDate, String regEndDate, int roleId) {



<span class="nc" id="L941">		Connection con =null;</span>
<span class="nc" id="L942">		PreparedStatement ps =null;</span>
<span class="nc" id="L943">		ResultSet rs =null;</span>
<span class="nc" id="L944">		List&lt;BankRepDataBean&gt; bankRepDataList =new ArrayList&lt;BankRepDataBean&gt;();</span>
		try{
<span class="nc" id="L946">			con =DBConnect.getConnection();</span>
<span class="nc" id="L947">			StringBuilder  queryBuilder =new StringBuilder();</span>
<span class="nc" id="L948">			String appendQuery =&quot; &quot;;</span>
		
<span class="nc bnc" id="L950" title="All 2 branches missed.">			if(roleId!=1){</span>
<span class="nc" id="L951">				bankId=fetchBankList(roleId,con);</span>
<span class="nc bnc" id="L952" title="All 2 branches missed.">				if(bankId==0){</span>
<span class="nc" id="L953">					logger.info(&quot;Error In Getting Bank Id&quot;);</span>
<span class="nc" id="L954">					return bankRepDataList;</span>
				}
			}
			
			
<span class="nc bnc" id="L959" title="All 2 branches missed.">			if(branchId&gt;0){</span>
<span class="nc" id="L960">				appendQuery=&quot; and brmap.bank_id=&quot;+bankId+&quot; and brmap.branch_id=&quot;+branchId;</span>
<span class="nc bnc" id="L961" title="All 2 branches missed.">			}else if(bankId&gt;0){</span>
<span class="nc" id="L962">				appendQuery=&quot; and brmap.bank_id=&quot;+bankId;</span>
			}
<span class="nc" id="L964">			queryBuilder.append(&quot;select brmap.user_id,registration_date,ifnull(last_login_date,'NA') last_login_date,user_name,um.status cashierStatus,bank_display_name,bank_full_name,branch_display_name,branch_full_name from  st_lms_user_branch_mapping  brmap left join st_lms_user_master um on brmap.user_id=um.user_id left join st_lms_bank_master bm on brmap.bank_id=bm.bank_id left join st_lms_branch_master brm on brmap.branch_id=brm.branch_id where date(registration_date)&gt;=? and date(registration_date)&lt;=? &quot;+appendQuery+&quot; order by brmap.bank_id&quot;); </span>
<span class="nc" id="L965">			ps =con.prepareStatement(queryBuilder.toString());</span>
<span class="nc" id="L966">			ps.setString(1, regStartDate);</span>
<span class="nc" id="L967">			ps.setString(2, regEndDate);</span>
<span class="nc" id="L968">			logger.info(&quot;cashier  datails query&quot;+ps);</span>
<span class="nc" id="L969">			rs =ps.executeQuery();</span>
		
<span class="nc bnc" id="L971" title="All 2 branches missed.">			while(rs.next()){</span>
					
<span class="nc" id="L973">					BankRepDataBean repDataBean = new BankRepDataBean();</span>
<span class="nc" id="L974">					repDataBean.setBankName(rs.getString(&quot;bank_display_name&quot;));</span>
<span class="nc" id="L975">					repDataBean.setBankFullName(rs.getString(&quot;bank_full_name&quot;));</span>
<span class="nc" id="L976">					repDataBean.setBranchName(rs.getString(&quot;branch_display_name&quot;));</span>
<span class="nc" id="L977">					repDataBean.setBranchFullName(rs.getString(&quot;branch_full_name&quot;));</span>
<span class="nc" id="L978">					repDataBean.setStatus(rs.getString(&quot;cashierStatus&quot;));</span>
<span class="nc" id="L979">					repDataBean.setCashierName(rs.getString(&quot;user_name&quot;));</span>
<span class="nc" id="L980">					repDataBean.setCashierRegDate(rs.getString(&quot;registration_date&quot;).replace(&quot;.0&quot;, &quot;&quot;));</span>
<span class="nc" id="L981">					repDataBean.setCashierLastLoginDate(rs.getString(&quot;last_login_date&quot;).replace(&quot;.0&quot;, &quot;&quot;));</span>
<span class="nc" id="L982">					bankRepDataList.add(repDataBean);</span>
		
				
<span class="nc" id="L985">			}</span>
			
<span class="nc" id="L987">		}catch(Exception e){</span>
<span class="nc" id="L988">			e.printStackTrace();</span>
		}finally {
<span class="nc" id="L990">			try{</span>
<span class="nc bnc" id="L991" title="All 8 branches missed.">				if(con!=null){</span>
<span class="nc" id="L992">					con.close();</span>
				}
<span class="nc bnc" id="L994" title="All 8 branches missed.">				if(ps!=null){</span>
<span class="nc" id="L995">					ps.close();</span>
				}
<span class="nc bnc" id="L997" title="All 8 branches missed.">				if(rs!=null){</span>
<span class="nc" id="L998">					rs.close();</span>
				}
					
<span class="nc" id="L1001">			}catch(Exception e){</span>
<span class="nc" id="L1002">				e.printStackTrace();</span>
<span class="nc" id="L1003">			}</span>
<span class="nc" id="L1004">		}</span>
		
<span class="nc" id="L1006">		return bankRepDataList;</span>
	
	
	
	}
	
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>