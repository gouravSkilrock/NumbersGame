<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DrawGameAPIHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.api.drawGamesImpl</a> &gt; <span class="el_source">DrawGameAPIHelper.java</span></div><h1>DrawGameAPIHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.api.drawGamesImpl;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Timestamp;
import java.text.NumberFormat;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import java.util.TreeMap;
import java.util.TreeSet;

import javax.servlet.ServletContext;

import com.skilrock.lms.ajax.AjaxRequestHelper;
import com.skilrock.lms.api.beans.CancelBean;
import com.skilrock.lms.api.beans.GameDrawInfoBean;
import com.skilrock.lms.api.beans.GameInfoBean;
import com.skilrock.lms.api.beans.PWTApiBean;
import com.skilrock.lms.api.beans.PanelBean;
import com.skilrock.lms.api.beans.RaffleBean;
import com.skilrock.lms.api.beans.ReprintBean;
import com.skilrock.lms.api.beans.TPGameDetailsBean;
import com.skilrock.lms.api.beans.TPKenoPurchaseBean;
import com.skilrock.lms.api.beans.TPLottoPurchaseBean;
import com.skilrock.lms.api.beans.TPUserBalaanceBean;
import com.skilrock.lms.api.beans.TicketHeaderInfoBean;
import com.skilrock.lms.beans.LoginBean;
import com.skilrock.lms.beans.ServiceRequest;
import com.skilrock.lms.beans.ServiceResponse;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.utility.CommonMethods;
import com.skilrock.lms.common.utility.LMSUtility;
import com.skilrock.lms.coreEngine.drawGames.drawMgmt.DrawGameMgmtHelper;
import com.skilrock.lms.coreEngine.drawGames.playMgmt.DrawGameRPOSHelper;
import com.skilrock.lms.coreEngine.loginMgmt.common.UserAuthenticationHelper;
import com.skilrock.lms.coreEngine.service.IServiceDelegate;
import com.skilrock.lms.coreEngine.service.ServiceDelegate;
import com.skilrock.lms.coreEngine.service.dge.ServiceMethodName;
import com.skilrock.lms.coreEngine.service.dge.ServiceName;
import com.skilrock.lms.dge.beans.BetDetailsBean;
import com.skilrock.lms.dge.beans.CancelTicketBean;
import com.skilrock.lms.dge.beans.DrawDetailsBean;
import com.skilrock.lms.dge.beans.DrawIdBean;
import com.skilrock.lms.dge.beans.FortunePurchaseBean;
import com.skilrock.lms.dge.beans.FortuneTwoPurchaseBean;
import com.skilrock.lms.dge.beans.KenoPurchaseBean;
import com.skilrock.lms.dge.beans.LottoPurchaseBean;
import com.skilrock.lms.dge.beans.MainPWTDrawBean;
import com.skilrock.lms.dge.beans.PanelIdBean;
import com.skilrock.lms.dge.beans.RaffleDrawIdBean;
import com.skilrock.lms.dge.beans.RafflePurchaseBean;
import com.skilrock.lms.web.drawGames.common.Util;

<span class="nc" id="L62">public class DrawGameAPIHelper {</span>
	@SuppressWarnings(&quot;unchecked&quot;)
	public static TPGameDetailsBean apiDgData(UserInfoBean userBean)
			throws LMSException {
<span class="nc" id="L66">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L67">		TPGameDetailsBean returnBean = null;</span>

<span class="nc" id="L69">		Map&lt;String, List&lt;DrawDetailsBean&gt;&gt; gameMap = null;</span>
<span class="nc" id="L70">		TreeMap frzTimeMap = (TreeMap) LMSUtility.sc.getContext(&quot;/DrawGameWeb&quot;)</span>
				.getAttribute(&quot;FREEZETIME_DATA&quot;);
		try {
<span class="nc" id="L73">			String selQry = &quot;select game_id,game_name_dev,game_name,game_nbr,offline_freeze_time,retailer_sale_comm_rate,ifnull(promo_game_type,'STANDARD') game_type,ifnull(raffle_ticket_type,0) raffle_ticket_type from st_dg_game_master left outer join st_dg_promo_scheme ps on game_nbr=promo_game_id and ps.status='ACTIVE' where game_status!='SALE_CLOSE' order by game_nbr&quot;;</span>

<span class="nc" id="L75">			PreparedStatement pstmt = con.prepareStatement(selQry);</span>
<span class="nc" id="L76">			ResultSet rs = pstmt.executeQuery();</span>
<span class="nc" id="L77">			returnBean = new TPGameDetailsBean();</span>
<span class="nc" id="L78">			List&lt;GameInfoBean&gt; gameInfoList = new ArrayList&lt;GameInfoBean&gt;();</span>
<span class="nc" id="L79">			GameInfoBean gameBean = null;</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L81">				gameBean = new GameInfoBean();</span>
<span class="nc" id="L82">				String gameName = rs.getString(&quot;game_name_dev&quot;);</span>
<span class="nc" id="L83">				int gameNo = rs.getInt(&quot;game_nbr&quot;);</span>
<span class="nc" id="L84">				gameBean.setGameCode(gameName);</span>
<span class="nc" id="L85">				gameBean.setGameNo(gameNo);</span>
<span class="nc" id="L86">				gameBean.setGameDisplayName(rs.getString(&quot;game_name&quot;));</span>
<span class="nc" id="L87">				String gameType = rs.getString(&quot;game_type&quot;);</span>

<span class="nc bnc" id="L89" title="All 2 branches missed.">				if (&quot;STANDARD&quot;.equalsIgnoreCase(gameType)) {</span>
<span class="nc" id="L90">					gameBean.setType(0);</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">				} else if (&quot;RAFFLE&quot;.equalsIgnoreCase(gameType)) {</span>
<span class="nc" id="L92">					gameBean.setType(1);</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">				} else if (&quot;PROMO&quot;.equalsIgnoreCase(gameType)) {</span>
<span class="nc" id="L94">					gameBean.setType(2);</span>
				}

<span class="nc" id="L97">				String raffleType = rs.getString(&quot;raffle_ticket_type&quot;);</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">				if (&quot;REFERENCE&quot;.equalsIgnoreCase(raffleType)) {</span>
<span class="nc" id="L99">					gameBean.setTypeSpecificInfo(2);</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">				} else if (&quot;ORIGINAL&quot;.equalsIgnoreCase(raffleType)) {</span>
<span class="nc" id="L101">					gameBean.setTypeSpecificInfo(1);</span>
				} else {
<span class="nc" id="L103">					gameBean.setTypeSpecificInfo(0);</span>
				}

<span class="nc" id="L106">				Iterator&lt;BetDetailsBean&gt; priceMapIter = Util.getGameMap().get(gameName)</span>
						.getPriceMap().values().iterator();
<span class="nc bnc" id="L108" title="All 2 branches missed.">				if (priceMapIter.hasNext()) {</span>
<span class="nc" id="L109">					gameBean.setUnit_price(priceMapIter.next().getUnitPrice());</span>
				}

				// offlineFzTimeMap.put(gameNo,
				// rs.getInt(&quot;offline_freeze_time&quot;));
<span class="nc" id="L114">				gameBean.setOnline_FTG(Integer.parseInt((String)frzTimeMap.get(gameNo)));</span>
<span class="nc" id="L115">				gameBean.setTicket_validity(Util.getGameMap().get(gameName)</span>
						.getTicketExpiryPeriod());
<span class="nc" id="L117">				double jackPotAmt=Util.getGameMap().get(gameName).getJackpotLimit();</span>
<span class="nc" id="L118">				NumberFormat nf = NumberFormat.getInstance();</span>
<span class="nc" id="L119">				nf.setMinimumFractionDigits(2);</span>
				
<span class="nc" id="L121">				String jkPotAmt = nf.format(jackPotAmt).replaceAll(&quot;,&quot;, &quot;&quot;);</span>
<span class="nc" id="L122">				gameBean.setJackpotAmount(jkPotAmt);</span>
<span class="nc" id="L123">				gameInfoList.add(gameBean);</span>
<span class="nc" id="L124">			}</span>

			/*
			 * retBean.setUserId(userId); retBean.setGameData(gameData);
			 * retBean.setOffline(isOffline);
			 * retBean.setOfflineFzTimeMap(offlineFzTimeMap);
			 * retBean.setRetSaleComm(retSaleComm);
			 */

<span class="nc" id="L133">			IServiceDelegate delegate = ServiceDelegate.getInstance();</span>
<span class="nc" id="L134">			ServiceRequest sReq = new ServiceRequest();</span>
<span class="nc" id="L135">			sReq.setServiceName(ServiceName.DRAWGAME);</span>
<span class="nc" id="L136">			sReq.setServiceMethod(ServiceMethodName.FETCH_ACTIVE_DRAW_DETAILS);</span>
			
<span class="nc" id="L138">			ServiceResponse resp = delegate.getResponse(sReq);</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">			if (resp.getIsSuccess()) {</span>
				// retBean = (OfflineRetailerBean) resp.getResponseData();
<span class="nc" id="L141">				gameMap = (HashMap&lt;String, List&lt;DrawDetailsBean&gt;&gt;) resp.getResponseData();</span>
			} else {
<span class="nc" id="L143">				throw new LMSException(&quot;Some Error&quot;);</span>
			}

<span class="nc" id="L146">			List&lt;com.skilrock.lms.api.beans.DrawDetailsBean&gt; drawDetailsListAPI = null;</span>
<span class="nc" id="L147">			TreeMap&lt;Long, String&gt; frzmap = new TreeMap&lt;Long, String&gt;();</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">			for (int i = 0; i &lt; gameInfoList.size(); i++) {</span>
<span class="nc" id="L149">				gameBean = gameInfoList.get(i);</span>
<span class="nc" id="L150">				List&lt;DrawDetailsBean&gt; drawDetailsList = gameMap.get(gameBean.getGameCode());</span>

<span class="nc" id="L152">				gameBean.setNoOfDraws(drawDetailsList.size());</span>
<span class="nc" id="L153">				DrawDetailsBean drawBeanDGE = null;</span>
<span class="nc" id="L154">				com.skilrock.lms.api.beans.DrawDetailsBean drawBeanAPI = null;</span>
<span class="nc" id="L155">				drawDetailsListAPI = new ArrayList&lt;com.skilrock.lms.api.beans.DrawDetailsBean&gt;();</span>
<span class="nc" id="L156">				TreeSet&lt;Long&gt; timeSet = new TreeSet&lt;Long&gt;();</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">				for (int j = 0; j &lt; drawDetailsList.size(); j++) {</span>
<span class="nc" id="L158">					drawBeanDGE = drawDetailsList.get(j);</span>
<span class="nc" id="L159">					drawBeanAPI = new com.skilrock.lms.api.beans.DrawDetailsBean();</span>
<span class="nc" id="L160">					drawBeanAPI.setDrawId(drawBeanDGE.getDrawId());</span>
<span class="nc" id="L161">					drawBeanAPI.setDrawDateTime(drawBeanDGE.getDrawDateTime()</span>
							.toString());
<span class="nc" id="L163">					drawBeanAPI.setDrawName(drawBeanDGE.getDrawName());</span>
<span class="nc" id="L164">					drawDetailsListAPI.add(drawBeanAPI);</span>
<span class="nc" id="L165">					drawBeanDGE.getDrawDateTime().getTime();</span>
<span class="nc" id="L166">					timeSet.add(drawBeanDGE.getDrawDateTime().getTime());</span>
				}

				
<span class="nc" id="L170">				frzmap.put(timeSet.first()</span>
						- (Long.parseLong((String)frzTimeMap.get(gameBean.getGameNo()))*1000),
						gameBean.getGameCode());
<span class="nc" id="L173">				gameBean.setDrawBeanList(drawDetailsListAPI);</span>
			}

			/*
			 * if (isOffline) { returnData.append(&quot;|PromoInfo:&quot;); selQry =
			 * &quot;select scheme_id,sale_game_id,promo_game_id,sale_ticket_amt,if(valid_for_draw='INDOOR',1,if(valid_for_draw='OUTDOOR',0,2)) valid_for_draw from st_dg_promo_scheme where status='ACTIVE'&quot;
			 * ; pstmt = con.prepareStatement(selQry); rs =
			 * pstmt.executeQuery(); boolean isPromo = false; while (rs.next())
			 * { isPromo = true; returnData.append(rs.getString(&quot;scheme_id&quot;) +
			 * &quot;,&quot;); returnData.append(rs.getString(&quot;sale_game_id&quot;) + &quot;,&quot;);
			 * returnData.append(rs.getString(&quot;promo_game_id&quot;) + &quot;,&quot;);
			 * returnData.append(rs.getString(&quot;sale_ticket_amt&quot;) + &quot;,&quot;);
			 * returnData.append(rs.getString(&quot;valid_for_draw&quot;) + &quot;#&quot;); } if
			 * (isPromo) { returnData.deleteCharAt(returnData.length() - 1); }
			 * else { returnData.delete(returnData.length() -
			 * &quot;|PromoInfo:&quot;.length(), returnData.length()); } }
			 */

<span class="nc" id="L191">			Iterator&lt;Long&gt; frzmapIter = frzmap.keySet().iterator();</span>
<span class="nc bnc" id="L192" title="All 2 branches missed.">			if (frzmapIter.hasNext()) {</span>
<span class="nc" id="L193">				String nextTimeTogGetInfo = new Timestamp(frzmapIter.next())</span>
						.toString();
<span class="nc" id="L195">				returnBean.setNextTimeTogGetInfo(nextTimeTogGetInfo);</span>
			}

<span class="nc" id="L198">			returnBean.setGameBeanList(gameInfoList);</span>

<span class="nc" id="L200">		} catch (Exception e) {</span>
<span class="nc" id="L201">			e.printStackTrace();</span>
<span class="nc" id="L202">			throw new LMSException(&quot;Some Error&quot;);</span>
		} finally {
<span class="nc" id="L204">			DBConnect.closeCon(con);</span>
<span class="nc" id="L205">		}</span>
<span class="nc" id="L206">		returnBean.setErrorCode(&quot;100&quot;);</span>
<span class="nc" id="L207">		returnBean.setSuccess(true);</span>
<span class="nc" id="L208">		return returnBean;</span>
	}

	public static UserInfoBean getUserData(String userName) {
<span class="nc" id="L212">		ServletContext sc = LMSUtility.sc;</span>
<span class="nc" id="L213">		UserInfoBean userBean = null;</span>
<span class="nc" id="L214">		Map&lt;String, UserInfoBean&gt; currentUsersMap = (Map&lt;String, UserInfoBean&gt;) sc</span>
				.getAttribute(&quot;API_LOGGED_IN_USERS_MAP&quot;);

<span class="nc bnc" id="L217" title="All 2 branches missed.">		if (currentUsersMap != null) {</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">			if (!currentUsersMap.isEmpty()) {</span>
<span class="nc" id="L219">				userBean = currentUsersMap.get(userName);</span>
			}
		} else {

		}
<span class="nc" id="L224">		return userBean;</span>
	}

	public static UserInfoBean createUserData(String userName, String password) {
<span class="nc" id="L228">		ServletContext sc = LMSUtility.sc;</span>
<span class="nc" id="L229">		LoginBean loginBean = new UserAuthenticationHelper()</span>
				.loginAuthentication(userName, password, &quot;TERMINAL&quot;, &quot;2000&quot;, null, false);
<span class="nc" id="L231">		UserInfoBean userBean = null;</span>
<span class="nc bnc" id="L232" title="All 4 branches missed.">		if(&quot;success&quot;.equals(loginBean.getStatus()) || &quot;FirstTime&quot;.equals(loginBean.getStatus())){</span>
<span class="nc" id="L233">			userBean = loginBean.getUserInfo();</span>
<span class="nc" id="L234">	        Connection connection = DBConnect.getConnection();</span>
	        try {
<span class="nc" id="L236">				PreparedStatement pstmt = connection.prepareStatement(&quot;select merchant_ip,user_name,password from st_lms_merchant_auth_master where  user_name = ?&quot;);</span>
<span class="nc" id="L237">				pstmt.setString(1, userName);</span>
<span class="nc" id="L238">				ResultSet rs = pstmt.executeQuery();</span>
<span class="nc" id="L239">				String merIp = null;</span>
<span class="nc" id="L240">				String tpPass = null;			</span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">				if(rs.next()){</span>
<span class="nc" id="L242">					merIp = rs.getString(&quot;merchant_ip&quot;);</span>
<span class="nc" id="L243">					tpPass = rs.getString(&quot;password&quot;);</span>
				}
<span class="nc bnc" id="L245" title="All 2 branches missed.">				if(userBean.isTPUser()){</span>
<span class="nc" id="L246">					userBean.setTpIp(merIp);</span>
<span class="nc" id="L247">					userBean.setTpTxnPassword(tpPass);</span>
				}
<span class="nc" id="L249">			} catch (SQLException e) {</span>
				
<span class="nc" id="L251">				e.printStackTrace();</span>
<span class="nc" id="L252">			}	</span>
		}			
		
<span class="nc" id="L255">		return userBean;</span>
	}

	public static ReprintBean reprintTicket(UserInfoBean userBean,
			String lmsTranxIdToReprint) {		
<span class="nc" id="L260">		ReprintBean reprintBean = new ReprintBean();			</span>
		
<span class="nc" id="L262">		DrawGameRPOSHelper dgHelper = new DrawGameRPOSHelper();</span>
<span class="nc" id="L263">		Object gameBean = dgHelper.reprintTicket(userBean, false, null, true,</span>
				lmsTranxIdToReprint,null);
<span class="nc" id="L265">		reprintBean = reprintTPTicket(gameBean,userBean);</span>
<span class="nc" id="L266">		return reprintBean;</span>
	}

	private static ReprintBean reprintTPTicket(Object gameBean, UserInfoBean userBean) {
<span class="nc" id="L270">		ReprintBean reprintBean = new ReprintBean();</span>
<span class="nc" id="L271">		LottoPurchaseBean lottobean = null;</span>
<span class="nc" id="L272">		KenoPurchaseBean kenobean = null;</span>
<span class="nc" id="L273">		TPKenoPurchaseBean tpKenoBean = new TPKenoPurchaseBean();</span>
<span class="nc" id="L274">		TPLottoPurchaseBean tpLottoBean = new TPLottoPurchaseBean();</span>
<span class="nc" id="L275">		AjaxRequestHelper ajxHelper = new AjaxRequestHelper();</span>
<span class="nc" id="L276">		ajxHelper.getAvlblCreditAmt(userBean);</span>

<span class="nc" id="L278">		double bal = userBean.getAvailableCreditLimit()</span>
				- userBean.getClaimableBal();
<span class="nc" id="L280">		NumberFormat nFormat = NumberFormat.getInstance();</span>
<span class="nc" id="L281">		nFormat.setMinimumFractionDigits(2);</span>
<span class="nc" id="L282">		String balance =  nFormat.format(bal).replace(&quot;,&quot;, &quot;&quot;);</span>
		
<span class="nc bnc" id="L284" title="All 2 branches missed.">		if (gameBean instanceof FortunePurchaseBean) {</span>
			// to be implemented as this game is available
<span class="nc" id="L286">			reprintBean.setErrorCode(&quot;119&quot;);//Invalid Game Ticket</span>
<span class="nc" id="L287">			reprintBean.setSuccess(false);</span>
<span class="nc bnc" id="L288" title="All 2 branches missed.">		} else if (gameBean instanceof FortuneTwoPurchaseBean) {</span>
			// to be implemented as this game is available
<span class="nc" id="L290">			reprintBean.setErrorCode(&quot;119&quot;);//Invalid Game Ticket</span>
<span class="nc" id="L291">			reprintBean.setSuccess(false);</span>
<span class="nc bnc" id="L292" title="All 2 branches missed.">		} else if (gameBean instanceof KenoPurchaseBean) {</span>
<span class="nc" id="L293">			kenobean = (KenoPurchaseBean) gameBean;</span>
<span class="nc" id="L294">			tpKenoBean.setTicketNumber(kenobean.getTicket_no()</span>
					+ kenobean.getReprintCount());
<span class="nc" id="L296">			tpKenoBean.setBalance(balance);</span>
<span class="nc" id="L297">			tpKenoBean.setGameCode(Util.getGameName(kenobean.getGame_no()));</span>
			//tpKenoBean.setLmsTranxId(lmsTranxIdToReprint);
<span class="nc" id="L299">			tpKenoBean.setPurchaseTime(kenobean.getPurchaseTime());</span>
<span class="nc" id="L300">			tpKenoBean.setNoOfDraws(kenobean.getNoOfDraws()+&quot;&quot;);</span>
<span class="nc" id="L301">			tpKenoBean.setTicketCost(kenobean.getTotalPurchaseAmt()+&quot;&quot;);</span>
<span class="nc" id="L302">			tpKenoBean.setTotalPurchaseAmt(kenobean.getTotalPurchaseAmt()+&quot;&quot;);</span>
<span class="nc" id="L303">			tpKenoBean.setDrawDateTimeList(kenobean.getDrawDateTime());</span>
<span class="nc" id="L304">			tpKenoBean.setRaffle(kenobean.isRaffelAssociated());</span>
<span class="nc" id="L305">			PanelBean panelBean = null;</span>
<span class="nc" id="L306">			List&lt;PanelBean&gt; panelList = new ArrayList&lt;PanelBean&gt;();</span>
<span class="nc" id="L307">			int noOfPanels = kenobean.getPlayType().length;</span>
<span class="nc bnc" id="L308" title="All 2 branches missed.">			for (int i = 0; i &lt; noOfPanels; i++) {</span>
<span class="nc" id="L309">				panelBean = new PanelBean();</span>
<span class="nc" id="L310">				panelBean</span>
						.setBetAmountMultiple(kenobean.getBetAmountMultiple()[i]+&quot;&quot;);
<span class="nc" id="L312">				panelBean.setIsQp(kenobean.getIsQuickPick()[i]+&quot;&quot;);</span>
			//	panelBean.setNoPicked(Integer
			//			.parseInt(kenobean.getNoPicked()[i]));
<span class="nc" id="L315">				panelBean.setPickedNumbers(kenobean.getPlayerData()[i]);</span>
<span class="nc" id="L316">				panelBean.setPlayType(kenobean.getPlayType()[i]);</span>
<span class="nc" id="L317">				panelBean.setNoOfLines(kenobean.getNoOfLines()[i]+&quot;&quot;);</span>
<span class="nc" id="L318">				panelBean.setUnitPrice(kenobean.getUnitPrice()[i]+&quot;&quot;);</span>
<span class="nc" id="L319">				panelList.add(panelBean);</span>

			}
<span class="nc" id="L322">			tpKenoBean.setPanelList(panelList);</span>
<span class="nc" id="L323">			List&lt;RafflePurchaseBean&gt; raffleList= (List&lt;RafflePurchaseBean&gt;)kenobean.getPromoPurchaseBean();</span>
<span class="nc bnc" id="L324" title="All 2 branches missed.">			if(raffleList != null){</span>
<span class="nc" id="L325">				RafflePurchaseBean raffBean = null;</span>
<span class="nc" id="L326">				RaffleBean tpRaffBean = null;			</span>
<span class="nc" id="L327">				raffBean = raffleList.get(0);//hard coded as only 1 raffle applicable at this time //Yogesh Sir</span>
<span class="nc" id="L328">				tpRaffBean = new RaffleBean();</span>
<span class="nc" id="L329">				tpRaffBean.setDrawDateTime(raffBean.getDrawDateTime());</span>
<span class="nc" id="L330">				tpRaffBean.setGameCode(Util.getGameName(raffBean.getGame_no()));</span>
<span class="nc bnc" id="L331" title="All 2 branches missed.">				if(&quot;ORIGINAL&quot;.equalsIgnoreCase(raffBean.getRaffleTicketType())){</span>
<span class="nc" id="L332">					tpRaffBean.setTicketNumber(raffBean.getRaffleTicket_no()+raffBean.getReprintCount());</span>
					}
<span class="nc" id="L334">				tpRaffBean.setPurchaseTime(raffBean.getPurchaseTime());	</span>
<span class="nc" id="L335">				tpKenoBean.setRaffleData(tpRaffBean);</span>
<span class="nc" id="L336">				tpKenoBean.setRaffle(true);</span>
			}
<span class="nc" id="L338">			tpKenoBean.setTopAdMessageList(kenobean.getAdvMsg().get(&quot;TOP&quot;));</span>
<span class="nc" id="L339">			tpKenoBean.setBottomAdMessageList(kenobean.getAdvMsg().get(&quot;BOTTOM&quot;));</span>
<span class="nc" id="L340">			tpKenoBean.setSuccess(true);</span>
<span class="nc" id="L341">			reprintBean.setKenoBean(tpKenoBean);</span>
<span class="nc" id="L342">			reprintBean.setErrorCode(&quot;100&quot;);//Success</span>
<span class="nc" id="L343">			reprintBean.setSuccess(true);</span>

<span class="nc bnc" id="L345" title="All 2 branches missed.">		} else if (gameBean instanceof LottoPurchaseBean) {</span>
<span class="nc" id="L346">			lottobean = (LottoPurchaseBean) gameBean;</span>
<span class="nc" id="L347">			tpLottoBean.setTicketNumber(lottobean.getTicket_no()</span>
					+ lottobean.getReprintCount());
<span class="nc" id="L349">			tpLottoBean.setGameCode(Util.getGameName(lottobean.getGame_no()));</span>
<span class="nc" id="L350">			tpLottoBean.setPurchaseTime(lottobean.getPurchaseTime());</span>

<span class="nc" id="L352">			tpLottoBean.setBalance(balance);</span>

<span class="nc" id="L354">			tpLottoBean.setTicketCost(lottobean.getTotalPurchaseAmt()+&quot;&quot;);</span>
<span class="nc" id="L355">			tpLottoBean.setDrawDateTime(lottobean.getDrawDateTime());			</span>
<span class="nc" id="L356">			String[] pickedNumbers = new String[lottobean.getPlayerPicked().size()];</span>
<span class="nc bnc" id="L357" title="All 2 branches missed.">			for(int i = 0 ; i&lt;lottobean.getPlayerPicked().size();i++){</span>
<span class="nc" id="L358">				pickedNumbers[i] = lottobean.getPlayerPicked().get(i);</span>
			}
<span class="nc" id="L360">			tpLottoBean.setPickedNumbers(pickedNumbers);</span>
<span class="nc" id="L361">			tpLottoBean.setNoPicked(lottobean.getNoPicked()+&quot;&quot;);</span>
<span class="nc" id="L362">			tpLottoBean.setNoOfDraws(lottobean.getNoOfDraws()+&quot;&quot;);</span>
			//tpLottoBean.setLmsTranxId(lmsTranxIdToReprint);
<span class="nc" id="L364">			tpLottoBean.setQpStatus(lottobean.getIsQuickPick());</span>
			
<span class="nc" id="L366">			List&lt;LottoPurchaseBean&gt; promoGameList=lottobean.getPromoPurchaseBeanList();</span>
<span class="nc" id="L367">			List&lt;TPLottoPurchaseBean&gt; tpPromoGameList=new ArrayList&lt;TPLottoPurchaseBean&gt;();</span>
<span class="nc bnc" id="L368" title="All 4 branches missed.">			if(promoGameList != null &amp;&amp; promoGameList.size()&gt;0){</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">				for(int i=0;i&lt;promoGameList.size();i++){</span>
<span class="nc" id="L370">				LottoPurchaseBean lottoReprintBean=null;</span>
<span class="nc" id="L371">				TPLottoPurchaseBean tpLottoReprintBean=new TPLottoPurchaseBean();</span>
<span class="nc" id="L372">				lottoReprintBean=promoGameList.get(i);</span>
<span class="nc" id="L373">				tpLottoReprintBean.setTicketNumber(lottoReprintBean.getTicket_no()+lottoReprintBean.getReprintCount());</span>
<span class="nc" id="L374">				tpLottoReprintBean.setPurchaseTime(lottoReprintBean.getPurchaseTime());</span>
<span class="nc" id="L375">				tpLottoReprintBean.setDrawDateTime(lottoReprintBean.getDrawDateTime());</span>
<span class="nc bnc" id="L376" title="All 2 branches missed.">				if(lottoReprintBean.getAdvMsg() !=null){</span>
<span class="nc" id="L377">				tpLottoReprintBean.setBottomAdMessageList(lottoReprintBean.getAdvMsg().get(&quot;BOTTOM&quot;));</span>
<span class="nc" id="L378">				tpLottoReprintBean.setTopAdMessageList(lottoReprintBean.getAdvMsg().get(&quot;TOP&quot;));</span>
				}
<span class="nc" id="L380">				tpLottoReprintBean.setTotalPurchaseAmt(lottoReprintBean.getTotalPurchaseAmt()+&quot;&quot;);</span>
<span class="nc" id="L381">				tpLottoReprintBean.setTicketCost(lottoReprintBean.getTotalPurchaseAmt()+&quot;&quot;);</span>
<span class="nc" id="L382">				tpLottoReprintBean.setLmsTranxId(lottoReprintBean.getRefTransId());</span>
<span class="nc" id="L383">				tpLottoReprintBean.setNoOfDraws(lottoReprintBean.getNoOfDraws()+&quot;&quot;);</span>
<span class="nc" id="L384">				tpLottoReprintBean.setQpStatus(lottoReprintBean.getIsQuickPick());</span>
<span class="nc" id="L385">				tpLottoReprintBean.setPlayType(lottoReprintBean.getPlayType());</span>
<span class="nc" id="L386">				tpLottoReprintBean.setNoPicked(lottoReprintBean.getNoPicked()+&quot;&quot;);</span>
<span class="nc" id="L387">				tpLottoReprintBean.setIsAdvancedPlay(lottoReprintBean.getIsAdvancedPlay()+&quot;&quot;);</span>
<span class="nc" id="L388">				String pickNum[] = new String[lottoReprintBean.getPlayerPicked().size()];</span>
<span class="nc bnc" id="L389" title="All 2 branches missed.">				for(int k = 0 ; k &lt;lottoReprintBean.getPlayerPicked().size();k++ ){</span>
<span class="nc" id="L390">					pickNum[k] = lottoReprintBean.getPlayerPicked().get(k);</span>
				}
<span class="nc" id="L392">				tpLottoReprintBean.setPickedNumbers(pickNum);</span>
				
<span class="nc" id="L394">				tpLottoReprintBean.setSuccess(true);</span>
<span class="nc" id="L395">				tpLottoReprintBean.setErrorCode(&quot;100&quot;);//OK</span>
<span class="nc" id="L396">				tpPromoGameList.add(tpLottoReprintBean);</span>
				}
			}
			
<span class="nc" id="L400">			tpLottoBean.setPromoPurchaseBeanList(tpPromoGameList);</span>
			
			
<span class="nc" id="L403">			tpLottoBean.setRaffle(lottobean.isRaffelAssociated());</span>
<span class="nc" id="L404">			List&lt;RafflePurchaseBean&gt; raffleList= lottobean.getRafflePurchaseBeanList();</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">			if(raffleList != null){</span>
<span class="nc" id="L406">				RafflePurchaseBean raffBean = null;</span>
<span class="nc" id="L407">				RaffleBean tpRaffBean = null;			</span>
<span class="nc" id="L408">				raffBean = raffleList.get(0);//hard coded as only 1 raffle applicable at this time //Yogesh Sir</span>
<span class="nc" id="L409">				tpRaffBean = new RaffleBean();</span>
<span class="nc" id="L410">				tpRaffBean.setDrawDateTime(raffBean.getDrawDateTime());</span>
<span class="nc" id="L411">				tpRaffBean.setGameCode(Util.getGameName(raffBean.getGame_no()));</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">				if(&quot;ORIGINAL&quot;.equalsIgnoreCase(raffBean.getRaffleTicketType())){</span>
<span class="nc" id="L413">					tpRaffBean.setTicketNumber(raffBean.getRaffleTicket_no()+raffBean.getReprintCount());</span>
					}
<span class="nc" id="L415">				tpRaffBean.setPurchaseTime(raffBean.getPurchaseTime());	</span>
<span class="nc" id="L416">				tpLottoBean.setRaffleData(tpRaffBean);</span>
<span class="nc" id="L417">				tpLottoBean.setRaffle(true);</span>
			}
<span class="nc" id="L419">			tpLottoBean.setTotalPurchaseAmt(lottobean.getTotalPurchaseAmt()+&quot;&quot;);</span>
<span class="nc" id="L420">			tpLottoBean.setTopAdMessageList(lottobean.getAdvMsg().get(&quot;TOP&quot;));</span>
<span class="nc" id="L421">			tpLottoBean.setBottomAdMessageList(lottobean.getAdvMsg().get(&quot;BOTTOM&quot;));</span>
<span class="nc" id="L422">			tpLottoBean.setSuccess(true);</span>
<span class="nc" id="L423">			reprintBean.setLottoBean(tpLottoBean);</span>
<span class="nc" id="L424">			reprintBean.setSuccess(true);</span>
<span class="nc" id="L425">			reprintBean.setErrorCode(&quot;100&quot;);//Success</span>

<span class="nc bnc" id="L427" title="All 4 branches missed.">		} else if (gameBean instanceof String</span>
				&amp;&amp; &quot;RG_RPERINT&quot;.equals(gameBean.toString())) {
<span class="nc" id="L429">			reprintBean.setErrorCode(&quot;113&quot;);//REPRINT_FRAUD</span>
<span class="nc" id="L430">			reprintBean.setSuccess(false);</span>
<span class="nc bnc" id="L431" title="All 2 branches missed.">		} else if (gameBean instanceof String) {</span>
<span class="nc" id="L432">			reprintBean.setErrorCode(&quot;121&quot;);//REPRINT_FAIL</span>
<span class="nc" id="L433">			reprintBean.setSuccess(false);</span>
		} else {
<span class="nc" id="L435">			reprintBean.setErrorCode(&quot;120&quot;);//Reprint Error</span>
<span class="nc" id="L436">			reprintBean.setSuccess(false);</span>
		}

<span class="nc" id="L439">		return reprintBean;</span>
	}

	public static CancelBean cancelTicket(UserInfoBean userBean,
			String lmsTranxIdToRefund, String refTransId, String mobileNumber) {
<span class="nc" id="L444">		CancelBean cancelBean = new CancelBean();	</span>
		
		try{
<span class="nc bnc" id="L447" title="All 2 branches missed.">			if(Long.parseLong(refTransId) &lt;= 0){</span>
				
<span class="nc" id="L449">				cancelBean.setSuccess(false);</span>
<span class="nc" id="L450">				cancelBean.setErrorCode(&quot;105&quot;);//Third Party Transaction Id not received</span>
<span class="nc" id="L451">				return cancelBean;</span>
			}else {
<span class="nc bnc" id="L453" title="All 2 branches missed.">				if(Util.checkDupRefTransId(refTransId,userBean.getUserOrgId())){</span>
					
<span class="nc" id="L455">					cancelBean.setSuccess(false);</span>
<span class="nc" id="L456">					cancelBean.setErrorCode(&quot;105&quot;);//Third Party Transaction Id not received</span>
<span class="nc" id="L457">					return cancelBean;</span>
				}
				
			}
			}
<span class="nc" id="L462">			catch (Exception e) {</span>
<span class="nc" id="L463">				cancelBean.setSuccess(false);</span>
<span class="nc" id="L464">				cancelBean.setErrorCode(&quot;105&quot;);//Third Party Transaction Id not received</span>
<span class="nc" id="L465">				return cancelBean;</span>
<span class="nc" id="L466">			}</span>
						
<span class="nc" id="L468">		cancelBean.setLmsTranxIdToRefund(lmsTranxIdToRefund);</span>
<span class="nc" id="L469">		cancelBean.setRefTransId(refTransId);</span>
<span class="nc" id="L470">		DrawGameRPOSHelper dghelper = new DrawGameRPOSHelper();</span>
<span class="nc" id="L471">		String ticketNumber = dghelper.getTicketNumberFrmTxnId(</span>
				lmsTranxIdToRefund, userBean.getUserOrgId());
<span class="nc bnc" id="L473" title="All 2 branches missed.">		if (ticketNumber == null) {</span>
<span class="nc" id="L474">			cancelBean.setSuccess(false);</span>
<span class="nc" id="L475">			cancelBean.setErrorCode(&quot;118&quot;);//InValid Transaction Id</span>
<span class="nc" id="L476">			return cancelBean;</span>
		}
<span class="nc" id="L478">		CancelTicketBean cancelTicketBean = new CancelTicketBean();</span>
<span class="nc" id="L479">		String repCount = CommonMethods.fetchReprintCount(Util.getGamenoFromTktnumber(ticketNumber+&quot;00&quot;), ticketNumber);</span>
<span class="nc" id="L480">		cancelTicketBean.setTicketNo(ticketNumber+repCount);</span>
<span class="nc" id="L481">		cancelTicketBean.setPartyId(userBean.getUserOrgId());</span>
<span class="nc" id="L482">		cancelTicketBean.setPartyType(userBean.getUserType());</span>
<span class="nc" id="L483">		cancelTicketBean.setUserId(userBean.getUserId());</span>
<span class="nc" id="L484">		cancelTicketBean.setCancelChannel(&quot;LMS_API&quot;);</span>
<span class="nc" id="L485">		cancelTicketBean.setRefMerchantId((String)LMSUtility.sc.getAttribute(&quot;REF_MERCHANT_ID&quot;));</span>
<span class="nc" id="L486">		Map&lt;Integer, Map&lt;Integer, String&gt;&gt; drawIdTableMap = (Map&lt;Integer, Map&lt;Integer, String&gt;&gt;)LMSUtility.sc</span>
		.getContext(&quot;/DrawGameWeb&quot;).getAttribute(&quot;drawIdTableMap&quot;);
<span class="nc" id="L488">		cancelTicketBean.setDrawIdTableMap(drawIdTableMap);</span>

		try {
<span class="nc" id="L491">			cancelTicketBean.setAutoCancel(false);</span>
<span class="nc" id="L492">			cancelTicketBean = dghelper.cancelTicket(cancelTicketBean,</span>
					userBean, false,&quot;manual&quot;);// isAutoCancel false
<span class="nc bnc" id="L494" title="All 2 branches missed.">			if (cancelTicketBean.isValid()) {</span>
<span class="nc" id="L495">			Util.storeTPTxnId(userBean.getUserOrgId(), cancelTicketBean.getRefTransId(), refTransId, mobileNumber);</span>
					
<span class="nc" id="L497">				AjaxRequestHelper ajxHelper = new AjaxRequestHelper();</span>
<span class="nc" id="L498">				ajxHelper.getAvlblCreditAmt(userBean);</span>

<span class="nc" id="L500">				double bal = userBean.getAvailableCreditLimit()</span>
						- userBean.getClaimableBal();
<span class="nc" id="L502">				cancelBean.setRefundAmount(cancelTicketBean.getRefundAmount());</span>
<span class="nc" id="L503">				cancelBean.setTicketNumber(cancelTicketBean.getTicketNo());</span>
<span class="nc" id="L504">				cancelBean.setBalance(bal);</span>
<span class="nc" id="L505">				cancelBean.setLmsTransId(cancelTicketBean.getRefTransId());</span>
<span class="nc" id="L506">				cancelBean.setSuccess(true);</span>
<span class="nc" id="L507">				cancelBean.setErrorCode(&quot;100&quot;);</span>
<span class="nc" id="L508">				return cancelBean;</span>

			} else {
<span class="nc" id="L511">				cancelBean.setSuccess(false);</span>
<span class="nc" id="L512">				cancelBean.setErrorCode(&quot;101&quot;);//ticket could not be cancelled ...</span>
<span class="nc" id="L513">				return cancelBean;</span>
			}

<span class="nc" id="L516">		} catch (Exception e) {</span>
<span class="nc" id="L517">			e.printStackTrace();</span>
<span class="nc" id="L518">			cancelBean.setSuccess(false);			</span>
<span class="nc" id="L519">			cancelBean.setErrorCode(&quot;101&quot;);//ticket could not be cancelled ...</span>
<span class="nc" id="L520">			return cancelBean;</span>
		}
	}

	public static PWTApiBean pwtVerification(UserInfoBean userBean, String ticketNo) {
<span class="nc" id="L525">		PWTApiBean pwtBean = new PWTApiBean();</span>
<span class="nc" id="L526">		MainPWTDrawBean mainPwtBean = new MainPWTDrawBean();	</span>
			
<span class="nc" id="L528">		DrawGameRPOSHelper dgHelper = new DrawGameRPOSHelper();</span>
<span class="nc" id="L529">		mainPwtBean.setTicketNo(ticketNo);</span>
<span class="nc" id="L530">		pwtBean.setTicketNo(ticketNo);</span>
		try {
<span class="nc" id="L532">			mainPwtBean = dgHelper.prizeWinningTicket(mainPwtBean, userBean,</span>
					(String)LMSUtility.sc.getAttribute(&quot;REF_MERCHANT_ID&quot;));
			
			
<span class="nc bnc" id="L536" title="All 2 branches missed.">			if (&quot;ERROR&quot;.equalsIgnoreCase(mainPwtBean.getStatus())) {</span>
<span class="nc" id="L537">				pwtBean.setSuccess(false);</span>
<span class="nc" id="L538">				pwtBean.setErrorCode(&quot;122&quot;);//Can Not Verify.Invalid PWT</span>
<span class="nc" id="L539">				return pwtBean;				</span>
<span class="nc bnc" id="L540" title="All 2 branches missed.">			} else if (&quot;FRAUD&quot;.equalsIgnoreCase(mainPwtBean.getStatus())) {</span>
<span class="nc" id="L541">				pwtBean.setSuccess(false);</span>
<span class="nc" id="L542">				pwtBean.setErrorCode(&quot;122&quot;);//Can Not Verify.Invalid PWT</span>
<span class="nc" id="L543">				return pwtBean;	</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">			} else if (&quot;ERROR_INVALID&quot;</span>
					.equalsIgnoreCase(mainPwtBean.getStatus())) {
<span class="nc" id="L546">				pwtBean.setSuccess(false);</span>
<span class="nc" id="L547">				pwtBean.setErrorCode(&quot;117&quot;);//Invalid Ticket.</span>
<span class="nc" id="L548">				return pwtBean;	</span>
<span class="nc bnc" id="L549" title="All 2 branches missed.">			} else if (&quot;CANCELLED&quot;.equalsIgnoreCase(mainPwtBean.getStatus())) {</span>
<span class="nc" id="L550">				pwtBean.setSuccess(false);</span>
<span class="nc" id="L551">				pwtBean.setErrorCode(&quot;117&quot;);//Invalid Ticket.</span>
<span class="nc" id="L552">				return pwtBean;	</span>
<span class="nc bnc" id="L553" title="All 2 branches missed.">			} else if (&quot;UN_AUTH&quot;.equalsIgnoreCase(mainPwtBean.getStatus())) {</span>
<span class="nc" id="L554">				pwtBean.setSuccess(false);</span>
<span class="nc" id="L555">				pwtBean.setErrorCode(&quot;123&quot;);//Can Not Verify.Invalid Sub-Agent</span>
<span class="nc" id="L556">				return pwtBean;	</span>
<span class="nc bnc" id="L557" title="All 4 branches missed.">			} else if (mainPwtBean.getStatus() != null</span>
					&amp;&amp; mainPwtBean.getStatus().equalsIgnoreCase(
							&quot;OUT_VERIFY_LIMIT&quot;)) {
<span class="nc" id="L560">				pwtBean.setSuccess(false);</span>
<span class="nc" id="L561">				pwtBean.setErrorCode(&quot;124&quot;);//Can Not Verify.High Prize</span>
<span class="nc" id="L562">				return pwtBean;	</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">			} else if (&quot;HIGH_PRIZE&quot;.equalsIgnoreCase(mainPwtBean.getStatus())) {</span>
<span class="nc" id="L564">				pwtBean.setSuccess(false);</span>
<span class="nc" id="L565">				pwtBean.setErrorCode(&quot;124&quot;);//Can Not Verify.High Prize</span>
<span class="nc" id="L566">				return pwtBean;				</span>
<span class="nc bnc" id="L567" title="All 2 branches missed.">			} else if (&quot;OUT_PAY_LIMIT&quot;</span>
					.equalsIgnoreCase(mainPwtBean.getStatus())) {
<span class="nc" id="L569">				pwtBean.setSuccess(false);</span>
<span class="nc" id="L570">				pwtBean.setErrorCode(&quot;124&quot;);//Can Not Verify.High Prize</span>
<span class="nc" id="L571">				return pwtBean;	</span>
			
<span class="nc bnc" id="L573" title="All 2 branches missed.">			} else if (&quot;TICKET_EXPIRED&quot;.equalsIgnoreCase(mainPwtBean</span>
					.getStatus())) {
<span class="nc" id="L575">				pwtBean.setSuccess(false);</span>
<span class="nc" id="L576">				pwtBean.setErrorCode(&quot;125&quot;);//Expired or Invalid Ticket</span>
<span class="nc" id="L577">				return pwtBean;	</span>
			
			}
<span class="nc bnc" id="L580" title="All 2 branches missed.">			if (!mainPwtBean.isValid()) {</span>
<span class="nc" id="L581">				pwtBean.setSuccess(false);</span>
<span class="nc" id="L582">				pwtBean.setErrorCode(&quot;117&quot;);//Invalid Ticket.</span>
<span class="nc" id="L583">				return pwtBean;</span>
			} else {
<span class="nc" id="L585">				com.skilrock.lms.api.beans.DrawDetailsBean drawApiBean = null;</span>
<span class="nc" id="L586">				List&lt;com.skilrock.lms.api.beans.DrawDetailsBean&gt; drawDetailList = new ArrayList&lt;com.skilrock.lms.api.beans.DrawDetailsBean&gt;();</span>
<span class="nc" id="L587">				DrawIdBean drawDgBean = null;</span>
<span class="nc" id="L588">				PanelIdBean panelBean = null;</span>
<span class="nc" id="L589">				PanelBean panelApiBean = null;</span>
<span class="nc" id="L590">				RaffleDrawIdBean raffleDgBean=null;</span>
<span class="nc" id="L591">				RaffleBean raffleApiBean=null;</span>
				//List&lt;PanelBean&gt; panelList = new ArrayList&lt;PanelBean&gt;();
				// this loop need to be changed in case of Raffle Reference
<span class="nc bnc" id="L594" title="All 2 branches missed.">				for(int l=0;l&lt;mainPwtBean.getWinningBeanList().size();l++){</span>
<span class="nc bnc" id="L595" title="All 2 branches missed.">					if(mainPwtBean.getWinningBeanList().get(l)</span>
							.getRaffleDrawIdBeanList() == null){
						
<span class="nc bnc" id="L598" title="All 2 branches missed.">				for (int i = 0; i &lt; mainPwtBean.getWinningBeanList().get(l)</span>
<span class="nc" id="L599">						.getDrawWinList().size(); i++) {</span>
<span class="nc" id="L600">					drawDgBean = mainPwtBean.getWinningBeanList().get(l)</span>
							.getDrawWinList().get(i);
<span class="nc" id="L602">					drawApiBean = new com.skilrock.lms.api.beans.DrawDetailsBean();</span>
<span class="nc" id="L603">					drawApiBean.setDrawDateTime(drawDgBean.getDrawDateTime());</span>
					
<span class="nc" id="L605">					panelApiBean = new PanelBean();</span>
<span class="nc" id="L606">					int nonWin = 0;</span>
<span class="nc" id="L607">					int win = 0;</span>
<span class="nc" id="L608">					int register = 0;</span>
<span class="nc" id="L609">					int claim = 0;</span>
<span class="nc" id="L610">					int outVerify = 0;</span>
<span class="nc" id="L611">					int pndPay = 0;</span>
<span class="nc" id="L612">					boolean isResAwaited = false;</span>
<span class="nc" id="L613">					double drawAmt = 0.0;</span>
<span class="nc" id="L614">					List&lt;PanelIdBean&gt; panelWinList = drawDgBean</span>
							.getPanelWinList();
<span class="nc bnc" id="L616" title="All 2 branches missed.">					if (panelWinList != null) {</span>
<span class="nc bnc" id="L617" title="All 2 branches missed.">						for (int k = 0; k &lt; panelWinList.size(); k++) {</span>
<span class="nc" id="L618">							panelBean = panelWinList.get(k);</span>

<span class="nc bnc" id="L620" title="All 2 branches missed.">							if (panelBean.getStatus().equals(&quot;NON WIN&quot;)) {</span>
<span class="nc" id="L621">								nonWin++;</span>
<span class="nc bnc" id="L622" title="All 2 branches missed.">							} else if (panelBean.getStatus().equals(</span>
									&quot;NORMAL_PAY&quot;)) {
<span class="nc" id="L624">								drawAmt = panelBean.getWinningAmt() + drawAmt;</span>
<span class="nc" id="L625">								win++;</span>
<span class="nc bnc" id="L626" title="All 2 branches missed.">							} else if (panelBean.getStatus().equals(&quot;CLAIMED&quot;)) {</span>
<span class="nc" id="L627">								claim++;</span>
<span class="nc bnc" id="L628" title="All 2 branches missed.">							} else if (panelBean.getStatus().equals(&quot;PND_PAY&quot;)) {</span>
<span class="nc" id="L629">								pndPay++;</span>
<span class="nc bnc" id="L630" title="All 2 branches missed.">							} else if (panelBean.getStatus().equals(</span>
									&quot;HIGH_PRIZE&quot;)) {
<span class="nc" id="L632">								register++;</span>
<span class="nc bnc" id="L633" title="All 2 branches missed.">							} else if (panelBean.getStatus().equals(</span>
									&quot;OUT_PAY_LIMIT&quot;)) {
<span class="nc" id="L635">								register++;</span>
<span class="nc bnc" id="L636" title="All 2 branches missed.">							} else if (panelBean.getStatus().equals(</span>
									&quot;OUT_VERIFY_LIMIT&quot;)) {
<span class="nc" id="L638">								outVerify++;</span>
							}
						}

					} else {
<span class="nc" id="L643">						isResAwaited = true;</span>
					}
<span class="nc bnc" id="L645" title="All 2 branches missed.">					if (isResAwaited) {</span>
<span class="nc" id="L646">						panelApiBean.setMessage(&quot;Result Awaitted&quot;);</span>
						//panelApiBean.setNoOfPanels(panelWinList.size());
					} else {
<span class="nc bnc" id="L649" title="All 2 branches missed.">						if (nonWin != 0) {</span>
<span class="nc" id="L650">							panelApiBean.setMessage(&quot;Try Again&quot;);</span>
<span class="nc" id="L651">							panelApiBean.setNoOfPanels(nonWin+&quot;&quot;);</span>
						}
<span class="nc bnc" id="L653" title="All 2 branches missed.">						if (win != 0) {</span>
<span class="nc" id="L654">							panelApiBean.setMessage(&quot;Win Amt &quot; + drawAmt);</span>
<span class="nc" id="L655">							panelApiBean.setNoOfPanels(win+&quot;&quot;);</span>
						}
<span class="nc bnc" id="L657" title="All 2 branches missed.">						if (register != 0) {</span>
<span class="nc" id="L658">							panelApiBean.setMessage(&quot;Registration Required&quot;);</span>
<span class="nc" id="L659">							panelApiBean.setNoOfPanels(register+&quot;&quot;);</span>
						}
<span class="nc bnc" id="L661" title="All 2 branches missed.">						if (claim != 0) {</span>
<span class="nc" id="L662">							panelApiBean.setMessage(&quot;CLAIMED&quot;);</span>
<span class="nc" id="L663">							panelApiBean.setNoOfPanels(claim+&quot;&quot;);</span>
						}
<span class="nc bnc" id="L665" title="All 2 branches missed.">						if (pndPay != 0) {</span>
<span class="nc" id="L666">							panelApiBean.setMessage(&quot;IN PROCESS&quot;);</span>
<span class="nc" id="L667">							panelApiBean.setNoOfPanels(pndPay+&quot;&quot;);</span>
						}
<span class="nc bnc" id="L669" title="All 2 branches missed.">						if (outVerify != 0) {</span>
<span class="nc" id="L670">							panelApiBean.setMessage(&quot;OUT OF VERIFY&quot;);</span>
<span class="nc" id="L671">							panelApiBean.setNoOfPanels(outVerify+&quot;&quot;);</span>
						}

					}
					// panelApiBean is to be added to the drawAPiBean and then
<span class="nc" id="L676">					drawApiBean.setPanelBean(panelApiBean);</span>
<span class="nc" id="L677">					drawDetailList.add(drawApiBean);</span>
				}
			}else{
<span class="nc" id="L680">				raffleDgBean = (RaffleDrawIdBean) mainPwtBean.getWinningBeanList().get(l)</span>
				.getRaffleDrawIdBeanList().get(0);
<span class="nc" id="L682">				raffleApiBean = new com.skilrock.lms.api.beans.RaffleBean();</span>
<span class="nc" id="L683">				raffleApiBean.setDrawDateTime(raffleDgBean.getDrawDateTime());</span>
				//raffleApiBean.setTicketNumber(raffleDgBean.getRaffleTicketNumberInDB());
				
<span class="nc bnc" id="L686" title="All 2 branches missed.">				if (raffleDgBean.getStatus().equals(&quot;NON_WIN&quot;)) {</span>
<span class="nc" id="L687">				raffleApiBean.setMessage(&quot;Try Again&quot;);</span>
<span class="nc bnc" id="L688" title="All 2 branches missed.">				} else if(raffleDgBean.getStatus().equals(&quot;CLAIMED&quot;)){</span>
<span class="nc" id="L689">					raffleApiBean.setMessage(&quot;CLAIMED&quot;);</span>
<span class="nc bnc" id="L690" title="All 2 branches missed.">				} else if(raffleDgBean.getStatus().equals(&quot;NORMAL_PAY&quot;)){</span>
<span class="nc" id="L691">					raffleApiBean.setMessage(&quot;Win Amt &quot; +raffleDgBean.getWinningAmt());</span>
<span class="nc bnc" id="L692" title="All 2 branches missed.">				} else if(raffleDgBean.getStatus().equals(&quot;OUT_PAY_LIMIT&quot;)){</span>
<span class="nc" id="L693">					raffleApiBean.setMessage(&quot;Registration Required&quot;);</span>
<span class="nc bnc" id="L694" title="All 2 branches missed.">				} else if(raffleDgBean.getStatus().equals(&quot;HIGH_PRIZE&quot;)){</span>
<span class="nc" id="L695">					raffleApiBean.setMessage(&quot;Registration Required&quot;);</span>
<span class="nc bnc" id="L696" title="All 2 branches missed.">				} else if(raffleDgBean.getStatus().equals(&quot;OUT_VERIFY_LIMIT&quot;)){</span>
<span class="nc" id="L697">					raffleApiBean.setMessage(&quot;OUT OF VERIFY&quot;);</span>
<span class="nc bnc" id="L698" title="All 2 branches missed.">				} else if(raffleDgBean.getStatus().equals(&quot;PND_PAY&quot;)){</span>
<span class="nc" id="L699">					raffleApiBean.setMessage(&quot;IN PROCESS&quot;);</span>
				} else{
<span class="nc" id="L701">					raffleApiBean.setMessage(&quot;Result Awaitted&quot;);</span>
				}
			}
			} 
<span class="nc" id="L705">				pwtBean.setRaffleBean(raffleApiBean);</span>
<span class="nc" id="L706">				pwtBean.setDrawBeanList(drawDetailList);</span>
			}
<span class="nc" id="L708">			NumberFormat nf = NumberFormat.getInstance();</span>
<span class="nc" id="L709">			nf.setMinimumFractionDigits(2);</span>
<span class="nc" id="L710">			double totWinAmt = mainPwtBean.getTotlticketAmount();</span>
<span class="nc" id="L711">			String totPwtAmt = nf.format(totWinAmt).replaceAll(&quot;,&quot;, &quot;&quot;);</span>
<span class="nc" id="L712">			pwtBean.setTotalWinning(totPwtAmt);</span>
<span class="nc" id="L713">			pwtBean.setGameCode(Util</span>
					.getGameName(mainPwtBean.getMainTktGameNo()));
<span class="nc" id="L715">			pwtBean.setSuccess(true);</span>
<span class="nc" id="L716">			pwtBean.setErrorCode(&quot;100&quot;);//success</span>
<span class="nc" id="L717">			return pwtBean;</span>

<span class="nc" id="L719">		} catch (SQLException e) {</span>
<span class="nc" id="L720">			e.printStackTrace();</span>
<span class="nc" id="L721">			pwtBean.setSuccess(false);</span>
<span class="nc" id="L722">			pwtBean.setErrorCode(&quot;500&quot;);//Internal Server error</span>
<span class="nc" id="L723">			return pwtBean;</span>
		}

	}

	public static PWTApiBean pwtPayment(UserInfoBean userBean, String ticketNo,
			String refTransId, String mobileNumber) {// refTransId to be stored in
													// LMS
<span class="nc" id="L731">		PWTApiBean pwtBean = new PWTApiBean();</span>
<span class="nc" id="L732">		MainPWTDrawBean mainPwtBean = new MainPWTDrawBean();</span>
			
		
<span class="nc" id="L735">		mainPwtBean.setTicketNo(ticketNo);</span>
<span class="nc" id="L736">		pwtBean.setTicketNo(ticketNo);</span>
		
		try{
<span class="nc bnc" id="L739" title="All 2 branches missed.">			if(Long.parseLong(refTransId) &lt;= 0){</span>
				
<span class="nc" id="L741">				pwtBean.setSuccess(false);</span>
<span class="nc" id="L742">				pwtBean.setErrorCode(&quot;105&quot;);//Third Party Transaction Id not received</span>
<span class="nc" id="L743">				return pwtBean;</span>
			}else {
<span class="nc bnc" id="L745" title="All 2 branches missed.">				if(Util.checkDupRefTransId(refTransId,userBean.getUserOrgId())){</span>
					
<span class="nc" id="L747">					pwtBean.setSuccess(false);</span>
<span class="nc" id="L748">					pwtBean.setErrorCode(&quot;105&quot;);//Third Party Transaction Id not received</span>
<span class="nc" id="L749">					return pwtBean;</span>
				}
				
			}
			}
<span class="nc" id="L754">			catch (Exception e) {</span>
<span class="nc" id="L755">				pwtBean.setSuccess(false);</span>
<span class="nc" id="L756">				pwtBean.setErrorCode(&quot;105&quot;);//Third Party Transaction Id not received</span>
<span class="nc" id="L757">				return pwtBean;</span>
<span class="nc" id="L758">			}</span>
		
		try {
<span class="nc" id="L761">			DrawGameRPOSHelper dgHelper = new DrawGameRPOSHelper();</span>
<span class="nc" id="L762">			mainPwtBean = dgHelper.prizeWinningTicket(mainPwtBean, userBean,</span>
					(String)LMSUtility.sc.getAttribute(&quot;REF_MERCHANT_ID&quot;));
<span class="nc" id="L764">			String highPrizeCriteria = (String) LMSUtility.sc.getAttribute(&quot;HIGH_PRIZE_CRITERIA&quot;);</span>
<span class="nc" id="L765">			String highPrizeAmt = (String) LMSUtility.sc.getAttribute(&quot;HIGH_PRIZE_AMT&quot;);</span>
<span class="nc" id="L766">			String highPrizeScheme = (String) LMSUtility.sc.getAttribute(</span>
							&quot;DRAW_GAME_HIGH_PRIZE_SCHEME&quot;);
<span class="nc bnc" id="L768" title="All 2 branches missed.">			if (!mainPwtBean.isValid()) {</span>
<span class="nc" id="L769">				pwtBean.setSuccess(false);</span>
<span class="nc" id="L770">				pwtBean.setErrorCode(&quot;117&quot;);//Invalid Ticket.</span>
<span class="nc" id="L771">				return pwtBean;</span>
			} else {
<span class="nc" id="L773">				mainPwtBean = dgHelper.payPwtTicket(mainPwtBean, userBean,highPrizeCriteria ,highPrizeAmt ,highPrizeScheme);</span>
				
<span class="nc bnc" id="L775" title="All 2 branches missed.">				if(&quot;ERROR&quot;.equalsIgnoreCase(mainPwtBean.getStatus())){</span>
<span class="nc" id="L776">					pwtBean.setSuccess(false);</span>
<span class="nc" id="L777">					pwtBean.setErrorCode(&quot;117&quot;);//Invalid Ticket.</span>
<span class="nc" id="L778">					return pwtBean;</span>
				}
				
<span class="nc bnc" id="L781" title="All 4 branches missed.">				if(mainPwtBean.getTransactionIdList() != null &amp;&amp; mainPwtBean.getTransactionIdList().size()&gt;0){</span>
<span class="nc" id="L782">					List&lt;Long&gt; txnIdList = mainPwtBean.getTransactionIdList();</span>
<span class="nc bnc" id="L783" title="All 2 branches missed.">					for (int i = 0; i &lt; txnIdList.size(); i++) {</span>
<span class="nc" id="L784">						Util.storeTPTxnId(userBean.getUserOrgId(), txnIdList.get(i)+&quot;&quot;, refTransId, mobileNumber);</span>
					}
<span class="nc" id="L786">				pwtBean.setLmsTranxIdList(mainPwtBean.getTransactionIdList());</span>
<span class="nc" id="L787">				}else {				</span>
<span class="nc" id="L788">					pwtBean.setSuccess(false);</span>
<span class="nc" id="L789">					pwtBean.setErrorCode(&quot;126&quot;);//Pwt Payment could not be processed</span>
<span class="nc" id="L790">					return pwtBean;</span>
				}
<span class="nc" id="L792">				com.skilrock.lms.api.beans.DrawDetailsBean drawApiBean = null;</span>
<span class="nc" id="L793">				List&lt;com.skilrock.lms.api.beans.DrawDetailsBean&gt; drawDetailList = new ArrayList&lt;com.skilrock.lms.api.beans.DrawDetailsBean&gt;();</span>
<span class="nc" id="L794">				DrawIdBean drawDgBean = null;</span>
<span class="nc" id="L795">				PanelIdBean panelBean = null;</span>
<span class="nc" id="L796">				PanelBean panelApiBean = null;</span>
<span class="nc" id="L797">				RaffleDrawIdBean raffleDgBean=null;</span>
<span class="nc" id="L798">				RaffleBean raffleApiBean=null;</span>
<span class="nc" id="L799">				AjaxRequestHelper ajxHelper = new AjaxRequestHelper();</span>
<span class="nc" id="L800">				ajxHelper.getAvlblCreditAmt(userBean);</span>

<span class="nc" id="L802">				double bal = userBean.getAvailableCreditLimit()</span>
						- userBean.getClaimableBal();
				// this loop need to be changed in case of Raffle Reference
<span class="nc bnc" id="L805" title="All 2 branches missed.">				for(int l=0;l&lt;mainPwtBean.getWinningBeanList().size();l++){</span>
<span class="nc bnc" id="L806" title="All 2 branches missed.">					if(mainPwtBean.getWinningBeanList().get(l)</span>
							.getRaffleDrawIdBeanList() == null){
						
				
<span class="nc bnc" id="L810" title="All 2 branches missed.">				for (int i = 0; i &lt; mainPwtBean.getWinningBeanList().get(l)</span>
<span class="nc" id="L811">						.getDrawWinList().size(); i++) {</span>
<span class="nc" id="L812">					drawDgBean = mainPwtBean.getWinningBeanList().get(l)</span>
							.getDrawWinList().get(i);
<span class="nc" id="L814">					drawApiBean = new com.skilrock.lms.api.beans.DrawDetailsBean();</span>
<span class="nc" id="L815">					drawApiBean.setDrawDateTime(drawDgBean.getDrawDateTime());</span>
					// List&lt;PanelBean&gt; panelList = new ArrayList&lt;PanelBean&gt;();
<span class="nc" id="L817">					panelApiBean = new PanelBean();</span>
<span class="nc" id="L818">					int nonWin = 0;</span>
<span class="nc" id="L819">					int win = 0;</span>
<span class="nc" id="L820">					int register = 0;</span>
<span class="nc" id="L821">					int claim = 0;</span>
<span class="nc" id="L822">					int outVerify = 0;</span>
<span class="nc" id="L823">					int pndPay = 0;</span>
<span class="nc" id="L824">					boolean isResAwaited = false;</span>
<span class="nc" id="L825">					double drawAmt = 0.0;</span>
<span class="nc" id="L826">					List&lt;PanelIdBean&gt; panelWinList = drawDgBean</span>
							.getPanelWinList();
<span class="nc bnc" id="L828" title="All 2 branches missed.">					if (panelWinList != null) {</span>
<span class="nc bnc" id="L829" title="All 2 branches missed.">						for (int k = 0; k &lt; panelWinList.size(); k++) {</span>
<span class="nc" id="L830">							panelBean = panelWinList.get(k);</span>

<span class="nc bnc" id="L832" title="All 2 branches missed.">							if (panelBean.getStatus().equals(&quot;NON WIN&quot;)) {</span>
<span class="nc" id="L833">								nonWin++;</span>
<span class="nc bnc" id="L834" title="All 2 branches missed.">							} else if (panelBean.getStatus().equals(</span>
									&quot;NORMAL_PAY&quot;)) {
<span class="nc" id="L836">								drawAmt = panelBean.getWinningAmt() + drawAmt;</span>
<span class="nc" id="L837">								win++;</span>
<span class="nc bnc" id="L838" title="All 2 branches missed.">							} else if (panelBean.getStatus().equals(&quot;CLAIMED&quot;)) {</span>
<span class="nc" id="L839">								claim++;</span>
<span class="nc bnc" id="L840" title="All 2 branches missed.">							} else if (panelBean.getStatus().equals(&quot;PND_PAY&quot;)) {</span>
<span class="nc" id="L841">								pndPay++;</span>
<span class="nc bnc" id="L842" title="All 2 branches missed.">							} else if (panelBean.getStatus().equals(</span>
									&quot;HIGH_PRIZE&quot;)) {
<span class="nc" id="L844">								register++;</span>
<span class="nc bnc" id="L845" title="All 2 branches missed.">							} else if (panelBean.getStatus().equals(</span>
									&quot;OUT_PAY_LIMIT&quot;)) {
<span class="nc" id="L847">								register++;</span>
<span class="nc bnc" id="L848" title="All 2 branches missed.">							} else if (panelBean.getStatus().equals(</span>
									&quot;OUT_VERIFY_LIMIT&quot;)) {
<span class="nc" id="L850">								outVerify++;</span>
							}
						}

					} else {
<span class="nc" id="L855">						isResAwaited = true;</span>
					}
<span class="nc bnc" id="L857" title="All 2 branches missed.">					if (isResAwaited) {</span>
<span class="nc" id="L858">						panelApiBean.setMessage(&quot;Result Awaitted&quot;);</span>
						//panelApiBean.setNoOfPanels(panelWinList.size());
					} else {
<span class="nc bnc" id="L861" title="All 2 branches missed.">						if (nonWin != 0) {</span>
<span class="nc" id="L862">							panelApiBean.setMessage(&quot;Try Again&quot;);</span>
<span class="nc" id="L863">							panelApiBean.setNoOfPanels(nonWin+&quot;&quot;);</span>
						}
<span class="nc bnc" id="L865" title="All 2 branches missed.">						if (win != 0) {</span>
<span class="nc" id="L866">							panelApiBean.setMessage(&quot;Win Amt &quot; + drawAmt);</span>
<span class="nc" id="L867">							panelApiBean.setNoOfPanels(win+&quot;&quot;);</span>
						}
<span class="nc bnc" id="L869" title="All 2 branches missed.">						if (register != 0) {</span>
<span class="nc" id="L870">							panelApiBean.setMessage(&quot;Registration Required&quot;);</span>
<span class="nc" id="L871">							panelApiBean.setNoOfPanels(register+&quot;&quot;);</span>
						}
<span class="nc bnc" id="L873" title="All 2 branches missed.">						if (claim != 0) {</span>
<span class="nc" id="L874">							panelApiBean.setMessage(&quot;CLAIMED&quot;);</span>
<span class="nc" id="L875">							panelApiBean.setNoOfPanels(claim+&quot;&quot;);</span>
						}
<span class="nc bnc" id="L877" title="All 2 branches missed.">						if (pndPay != 0) {</span>
<span class="nc" id="L878">							panelApiBean.setMessage(&quot;IN PROCESS&quot;);</span>
<span class="nc" id="L879">							panelApiBean.setNoOfPanels(pndPay+&quot;&quot;);</span>
						}
<span class="nc bnc" id="L881" title="All 2 branches missed.">						if (outVerify != 0) {</span>
<span class="nc" id="L882">							panelApiBean.setMessage(&quot;OUT OF VERIFY&quot;);</span>
<span class="nc" id="L883">							panelApiBean.setNoOfPanels(outVerify+&quot;&quot;);</span>
						}

					}
					// panelApiBean is to be added to the drawAPiBean and then
<span class="nc" id="L888">					drawApiBean.setPanelBean(panelApiBean);</span>
<span class="nc" id="L889">					drawDetailList.add(drawApiBean);</span>
				}
					}else {
<span class="nc" id="L892">						raffleDgBean = (RaffleDrawIdBean) mainPwtBean.getWinningBeanList().get(l)</span>
						.getRaffleDrawIdBeanList().get(0);
<span class="nc" id="L894">						raffleApiBean = new com.skilrock.lms.api.beans.RaffleBean();</span>
<span class="nc" id="L895">						raffleApiBean.setDrawDateTime(raffleDgBean.getDrawDateTime());</span>
						//raffleApiBean.setTicketNumber(raffleDgBean.getRaffleTicketNumberInDB());
<span class="nc bnc" id="L897" title="All 2 branches missed.">						if (raffleDgBean.getStatus().equals(&quot;NON_WIN&quot;)) {</span>
<span class="nc" id="L898">							raffleApiBean.setMessage(&quot;Try Again&quot;);</span>
<span class="nc bnc" id="L899" title="All 2 branches missed.">							} else if(raffleDgBean.getStatus().equals(&quot;CLAIMED&quot;)){</span>
<span class="nc" id="L900">								raffleApiBean.setMessage(&quot;CLAIMED&quot;);</span>
<span class="nc bnc" id="L901" title="All 2 branches missed.">							} else if(raffleDgBean.getStatus().equals(&quot;NORMAL_PAY&quot;)){</span>
<span class="nc" id="L902">								raffleApiBean.setMessage(&quot;Win Amt &quot; +raffleDgBean.getWinningAmt());</span>
<span class="nc bnc" id="L903" title="All 2 branches missed.">							} else if(raffleDgBean.getStatus().equals(&quot;OUT_PAY_LIMIT&quot;)){</span>
<span class="nc" id="L904">								raffleApiBean.setMessage(&quot;Registration Required&quot;);</span>
<span class="nc bnc" id="L905" title="All 2 branches missed.">							} else if(raffleDgBean.getStatus().equals(&quot;HIGH_PRIZE&quot;)){</span>
<span class="nc" id="L906">								raffleApiBean.setMessage(&quot;Registration Required&quot;);</span>
<span class="nc bnc" id="L907" title="All 2 branches missed.">							} else if(raffleDgBean.getStatus().equals(&quot;OUT_VERIFY_LIMIT&quot;)){</span>
<span class="nc" id="L908">								raffleApiBean.setMessage(&quot;OUT OF VERIFY&quot;);</span>
<span class="nc bnc" id="L909" title="All 2 branches missed.">							} else if(raffleDgBean.getStatus().equals(&quot;PND_PAY&quot;)){</span>
<span class="nc" id="L910">								raffleApiBean.setMessage(&quot;IN PROCESS&quot;);</span>
							} else{
<span class="nc" id="L912">								raffleApiBean.setMessage(&quot;Result Awaitted&quot;);</span>
							}
					}
				}
<span class="nc" id="L916">				pwtBean.setRaffleBean(raffleApiBean);</span>
<span class="nc" id="L917">				pwtBean.setDrawBeanList(drawDetailList);</span>
<span class="nc" id="L918">				NumberFormat nf = NumberFormat.getInstance();</span>
<span class="nc" id="L919">				nf.setMinimumFractionDigits(2);</span>
<span class="nc" id="L920">				double totWinAmt = mainPwtBean.getTotlticketAmount();</span>
<span class="nc" id="L921">				String totPwtAmt = nf.format(totWinAmt).replaceAll(&quot;,&quot;, &quot;&quot;);</span>
<span class="nc" id="L922">				pwtBean.setTotalWinning(totPwtAmt);</span>
<span class="nc" id="L923">				pwtBean.setBalance(bal);</span>
				
				
<span class="nc bnc" id="L926" title="All 2 branches missed.">				if(mainPwtBean.isReprint()){</span>
<span class="nc" id="L927">					pwtBean.setReprntReq(mainPwtBean.isReprint());</span>
<span class="nc" id="L928">					Object gameBean = mainPwtBean.getPurchaseBean();</span>
<span class="nc" id="L929">					ReprintBean reprintBean = reprintTPTicket(gameBean, userBean);</span>
<span class="nc" id="L930">					pwtBean.setReprintBean(reprintBean);</span>
				}
<span class="nc" id="L932">				pwtBean.setSuccess(true);</span>
<span class="nc" id="L933">				pwtBean.setErrorCode(&quot;100&quot;);//success</span>
<span class="nc" id="L934">				return pwtBean;</span>
			}

<span class="nc" id="L937">		} catch (Exception e) {</span>
<span class="nc" id="L938">			e.printStackTrace();</span>
<span class="nc" id="L939">			pwtBean.setSuccess(false);</span>
<span class="nc" id="L940">			pwtBean.setErrorCode(&quot;500&quot;);//Internal Server error</span>
<span class="nc" id="L941">			return pwtBean;</span>
		}

	}

	public static List&lt;GameDrawInfoBean&gt; drawResult(String gameCode, String date) {
<span class="nc" id="L947">		List&lt;GameDrawInfoBean&gt; returnList = new ArrayList&lt;GameDrawInfoBean&gt;();</span>

<span class="nc" id="L949">		GameDrawInfoBean gameBean = null;</span>

<span class="nc bnc" id="L951" title="All 2 branches missed.">		if (gameCode != null) {</span>
<span class="nc" id="L952">			gameBean = new GameDrawInfoBean();</span>
<span class="nc" id="L953">			gameBean.setGameCode(gameCode);</span>

<span class="nc" id="L955">			ServletContext sc = LMSUtility.sc;</span>
<span class="nc" id="L956">			DrawGameRPOSHelper helper = new DrawGameRPOSHelper();</span>
<span class="nc" id="L957">			TreeMap drawGameData = helper.getDrawGameData();</span>
<span class="nc" id="L958">			sc.setAttribute(&quot;GAME_DATA&quot;, drawGameData);</span>
<span class="nc" id="L959">			List list = (List) drawGameData.get(Util.getGameMap().get(gameCode)</span>
					.getGameNo());

<span class="nc" id="L962">			List&lt;DrawDetailsBean&gt; drawDetailsList = (List&lt;DrawDetailsBean&gt;) list</span>
					.get(3);

<span class="nc bnc" id="L965" title="All 2 branches missed.">			int drawResultCount = drawDetailsList.size() &gt; 10 ? 10</span>
					: drawDetailsList.size();
<span class="nc" id="L967">			String[] drawResult = null;</span>

<span class="nc" id="L969">			List&lt;com.skilrock.lms.api.beans.DrawDetailsBean&gt; drawResultList = new ArrayList&lt;com.skilrock.lms.api.beans.DrawDetailsBean&gt;();</span>
<span class="nc bnc" id="L970" title="All 2 branches missed.">			for (int i = 0; i &lt; drawResultCount; i++) {</span>
<span class="nc" id="L971">				com.skilrock.lms.api.beans.DrawDetailsBean drawBeanAPI = new com.skilrock.lms.api.beans.DrawDetailsBean();</span>
<span class="nc" id="L972">				DrawDetailsBean drawBean = drawDetailsList.get(i);</span>
<span class="nc" id="L973">				drawBeanAPI.setDrawId(drawBean.getDrawId());</span>
<span class="nc" id="L974">				drawBeanAPI.setDrawDateTime(drawBean.getDrawDateTime()</span>
						.toString());
<span class="nc" id="L976">				drawBeanAPI.setDrawName(drawBean.getDrawName());</span>
<span class="nc" id="L977">				drawBeanAPI.setSymbols(drawBean.getWinningResult());</span>

<span class="nc" id="L979">				drawResultList.add(drawBeanAPI);</span>
			}
<span class="nc" id="L981">			gameBean.setDrawResultList(drawResultList);</span>

<span class="nc" id="L983">			returnList.add(gameBean);</span>

<span class="nc" id="L985">		} else {</span>
			try {
<span class="nc" id="L987">				Map&lt;String, LinkedHashMap&lt;String, DrawDetailsBean&gt;&gt; resultMap = new DrawGameMgmtHelper()</span>
						.fetchWinningResultDateWise(date, date);
<span class="nc" id="L989">				Iterator iter = resultMap.entrySet().iterator();</span>

<span class="nc bnc" id="L991" title="All 2 branches missed.">				while (iter.hasNext()) {</span>
<span class="nc" id="L992">					gameBean = new GameDrawInfoBean();</span>
<span class="nc" id="L993">					Map.Entry&lt;String, LinkedHashMap&lt;String, DrawDetailsBean&gt;&gt; pair = (Map.Entry&lt;String, LinkedHashMap&lt;String, DrawDetailsBean&gt;&gt;) iter</span>
							.next();
<span class="nc" id="L995">					String gameNameDev = pair.getKey();</span>
<span class="nc" id="L996">					gameBean.setGameCode(gameNameDev);</span>
<span class="nc" id="L997">					List&lt;com.skilrock.lms.api.beans.DrawDetailsBean&gt; drawResultList = new ArrayList&lt;com.skilrock.lms.api.beans.DrawDetailsBean&gt;();</span>

<span class="nc" id="L999">					Iterator&lt;DrawDetailsBean&gt; innerIter = pair.getValue()</span>
							.values().iterator();
<span class="nc bnc" id="L1001" title="All 2 branches missed.">					while (innerIter.hasNext()) {</span>
<span class="nc" id="L1002">						DrawDetailsBean drawBean = innerIter.next();</span>
<span class="nc" id="L1003">						int drawId = drawBean.getDrawId();</span>
<span class="nc" id="L1004">						String drawName = drawBean.getDrawName();</span>
<span class="nc" id="L1005">						Timestamp drawDateTime = drawBean.getDrawDateTime();</span>
<span class="nc" id="L1006">						String winningResult = drawBean.getWinningResult();</span>

<span class="nc" id="L1008">						com.skilrock.lms.api.beans.DrawDetailsBean drawBeanAPI = new com.skilrock.lms.api.beans.DrawDetailsBean();</span>
<span class="nc" id="L1009">						drawBeanAPI.setDrawDateTime(drawDateTime.toString());</span>
<span class="nc" id="L1010">						drawBeanAPI.setDrawId(drawId);</span>
<span class="nc" id="L1011">						drawBeanAPI.setDrawName(drawName);</span>
<span class="nc" id="L1012">						drawBeanAPI.setSymbols(winningResult);</span>

<span class="nc" id="L1014">						drawResultList.add(drawBeanAPI);</span>
<span class="nc" id="L1015">					}</span>
<span class="nc" id="L1016">					gameBean.setDrawResultList(drawResultList);</span>
					
<span class="nc" id="L1018">					returnList.add(gameBean);</span>
<span class="nc" id="L1019">				}</span>
<span class="nc" id="L1020">			} catch (Exception e) {</span>
<span class="nc" id="L1021">				e.printStackTrace();</span>
<span class="nc" id="L1022">			}</span>
		}

<span class="nc" id="L1025">		return returnList;</span>
	}

	public static TPUserBalaanceBean getUserBal(UserInfoBean userBean) {
<span class="nc" id="L1029">		TPUserBalaanceBean  userBalBean = new TPUserBalaanceBean();</span>
<span class="nc" id="L1030">		AjaxRequestHelper ajxHelper = new AjaxRequestHelper();</span>
<span class="nc" id="L1031">		ajxHelper.getAvlblCreditAmt(userBean);</span>
<span class="nc" id="L1032">		double bal = userBean.getAvailableCreditLimit()</span>
				- userBean.getClaimableBal();
<span class="nc" id="L1034">		System.out.println(&quot;inside getUserBal and bal is:&quot;+bal);</span>
<span class="nc" id="L1035">		userBalBean.setBalance(bal);</span>
<span class="nc" id="L1036">		userBalBean.setUserName(userBean.getUserName());</span>
<span class="nc" id="L1037">		userBalBean.setSuccess(true);</span>
<span class="nc" id="L1038">		userBalBean.setErrorCode(&quot;100&quot;);</span>
<span class="nc" id="L1039">		return userBalBean;</span>
		
	}
	
	public static TicketHeaderInfoBean getHeaderInfo() {
<span class="nc" id="L1044">		TicketHeaderInfoBean  tktInfoBean = new TicketHeaderInfoBean();</span>
<span class="nc" id="L1045">		tktInfoBean.setCompanyName((String)LMSUtility.sc.getAttribute(&quot;ORG_NAME_JSP&quot;));</span>
<span class="nc" id="L1046">		tktInfoBean.setIsLogoDisplayOnTkt(&quot;YES&quot;);//to be done later ...</span>
<span class="nc" id="L1047">		tktInfoBean.setTicketType(&quot;SAMPLE&quot;);//to be done later ...</span>
<span class="nc" id="L1048">		tktInfoBean.setSuccess(true);</span>
<span class="nc" id="L1049">		tktInfoBean.setErrorCode(&quot;100&quot;);</span>
<span class="nc" id="L1050">		return tktInfoBean;</span>
	}
	
	public static List&lt;String&gt; getTransactionType(List&lt;Long&gt; lmsTranxIdList){
<span class="nc" id="L1054">		List&lt;String&gt; lmsTranxIdTypeList = new DrawGameRPOSHelper().getTransactionType(lmsTranxIdList);</span>
<span class="nc" id="L1055">		return lmsTranxIdTypeList;</span>
	}
	
	public static List&lt;Long&gt; getLMSTxnIdList(int retOrgId, String refTxnId){
<span class="nc" id="L1059">		List&lt;Long&gt; returnList = DrawGameRPOSHelper.getLMSTxnIdList(retOrgId, refTxnId);</span>
<span class="nc" id="L1060">		return returnList;</span>
	}
	
	public static String getMobileNo(int retOrgId, String refTxnId){
<span class="nc" id="L1064">		String mobileNo = DrawGameRPOSHelper.getMobileNo(retOrgId, refTxnId);</span>
<span class="nc" id="L1065">		return mobileNo;</span>
	}
	
	public static ReprintBean getTransactionStatusAndData(UserInfoBean userBean, String refTxnId, List&lt;Long&gt; lmsTranxIdList, List&lt;String&gt; lmsTranxIdTypeList, String mobileNo){
<span class="nc" id="L1069">		ReprintBean reprintBean = new ReprintBean();</span>
<span class="nc bnc" id="L1070" title="All 4 branches missed.">		if(lmsTranxIdList != null &amp;&amp; lmsTranxIdList.size() &gt; 0){</span>
<span class="nc bnc" id="L1071" title="All 2 branches missed.">			if(&quot;DG_SALE_KENO&quot;.equalsIgnoreCase(lmsTranxIdTypeList.get(0))){</span>
<span class="nc" id="L1072">				KenoPurchaseBean kenoBean = (KenoPurchaseBean)DrawGameRPOSHelper.getTransactionStatusAndData(userBean, lmsTranxIdList, lmsTranxIdTypeList);</span>
<span class="nc" id="L1073">				TPKenoPurchaseBean tpKenoBean = new TPKenoPurchaseBean();</span>
				
<span class="nc" id="L1075">				fillKenoSaleTxnStatusAndData(userBean, kenoBean, tpKenoBean);</span>
				
<span class="nc" id="L1077">				tpKenoBean.setLmsTranxId(lmsTranxIdList.get(0) + &quot;&quot;);</span>
<span class="nc" id="L1078">				tpKenoBean.setMobileNumber(mobileNo);</span>
<span class="nc" id="L1079">				tpKenoBean.setRefTransId(refTxnId);</span>
<span class="nc" id="L1080">				tpKenoBean.setUserName(userBean.getUserName());</span>
<span class="nc" id="L1081">				tpKenoBean.setErrorCode(&quot;100&quot;);</span>
				
				
<span class="nc" id="L1084">				reprintBean.setKenoBean(tpKenoBean);</span>
<span class="nc" id="L1085">				reprintBean.setErrorCode(&quot;100&quot;);//Success</span>
<span class="nc" id="L1086">				reprintBean.setSuccess(true);</span>
<span class="nc bnc" id="L1087" title="All 2 branches missed.">			} else if(&quot;DG_SALE_TANZANIALOTTO&quot;.equalsIgnoreCase(lmsTranxIdTypeList.get(0))){</span>
<span class="nc" id="L1088">				LottoPurchaseBean lottoBean = (LottoPurchaseBean)DrawGameRPOSHelper.getTransactionStatusAndData(userBean, lmsTranxIdList, lmsTranxIdTypeList);</span>
<span class="nc" id="L1089">				TPLottoPurchaseBean tpLottoBean = new TPLottoPurchaseBean();</span>
				
<span class="nc" id="L1091">				fillTanzanialottoSaleTxnStatusAndData(userBean, lottoBean, tpLottoBean);</span>
				
<span class="nc" id="L1093">				tpLottoBean.setLmsTranxId(lmsTranxIdList.get(0) + &quot;&quot;);</span>
<span class="nc" id="L1094">				tpLottoBean.setMobileNumber(mobileNo);</span>
<span class="nc" id="L1095">				tpLottoBean.setRefTransId(refTxnId);</span>
<span class="nc" id="L1096">				tpLottoBean.setUserName(userBean.getUserName());</span>
<span class="nc" id="L1097">				tpLottoBean.setErrorCode(&quot;100&quot;);</span>
				
				
<span class="nc" id="L1100">				reprintBean.setLottoBean(tpLottoBean);</span>
<span class="nc" id="L1101">				reprintBean.setErrorCode(&quot;100&quot;);//Success</span>
<span class="nc" id="L1102">				reprintBean.setSuccess(true);</span>
<span class="nc bnc" id="L1103" title="All 2 branches missed.">			} else if(&quot;DG_SALE_BONUSBALLLOTTO&quot;.equalsIgnoreCase(lmsTranxIdTypeList.get(0))){</span>
<span class="nc" id="L1104">				LottoPurchaseBean lottoBean = (LottoPurchaseBean)DrawGameRPOSHelper.getTransactionStatusAndData(userBean, lmsTranxIdList, lmsTranxIdTypeList);</span>
<span class="nc" id="L1105">				TPLottoPurchaseBean tpLottoBean = new TPLottoPurchaseBean();</span>
				
<span class="nc" id="L1107">				fillBonusBalllottoSaleTxnStatusAndData(userBean, lottoBean, tpLottoBean);</span>
				
<span class="nc" id="L1109">				tpLottoBean.setLmsTranxId(lmsTranxIdList.get(0) + &quot;&quot;);</span>
<span class="nc" id="L1110">				tpLottoBean.setMobileNumber(mobileNo);</span>
<span class="nc" id="L1111">				tpLottoBean.setRefTransId(refTxnId);</span>
<span class="nc" id="L1112">				tpLottoBean.setUserName(userBean.getUserName());</span>
<span class="nc" id="L1113">				tpLottoBean.setErrorCode(&quot;100&quot;);</span>
				
				
<span class="nc" id="L1116">				reprintBean.setLottoBean(tpLottoBean);</span>
<span class="nc" id="L1117">				reprintBean.setErrorCode(&quot;100&quot;);//Success</span>
<span class="nc" id="L1118">				reprintBean.setSuccess(true);</span>
<span class="nc bnc" id="L1119" title="All 2 branches missed.">			} else if(lmsTranxIdTypeList.get(0).contains(&quot;DG_REFUND_CANCEL&quot;)){</span>
<span class="nc" id="L1120">				CancelTicketBean cancelBean = (CancelTicketBean)DrawGameRPOSHelper.getTransactionStatusAndData(userBean, lmsTranxIdList, lmsTranxIdTypeList);</span>
<span class="nc" id="L1121">				CancelBean tpCancelBean = new CancelBean();</span>
				
<span class="nc" id="L1123">				fillCancelTxnStatusAndData(userBean, cancelBean, tpCancelBean);</span>
				
<span class="nc" id="L1125">				tpCancelBean.setRefTransId(refTxnId);</span>
<span class="nc" id="L1126">				tpCancelBean.setLmsTranxIdToRefund(lmsTranxIdList.get(0) + &quot;&quot;);</span>
<span class="nc" id="L1127">				tpCancelBean.setLmsTransId(lmsTranxIdList.get(0) + &quot;&quot;);</span>
				
<span class="nc" id="L1129">				reprintBean.setCancelBean(tpCancelBean);</span>
<span class="nc" id="L1130">				reprintBean.setErrorCode(&quot;100&quot;);//Success</span>
<span class="nc" id="L1131">				reprintBean.setSuccess(true);</span>
<span class="nc bnc" id="L1132" title="All 2 branches missed.">			} else if(lmsTranxIdTypeList.get(0).contains(&quot;PWT&quot;)){</span>
<span class="nc" id="L1133">				PWTApiBean tpPWTBean = (PWTApiBean) DrawGameRPOSHelper.getTransactionStatusAndData(userBean, lmsTranxIdList, lmsTranxIdTypeList);</span>
				
<span class="nc" id="L1135">				tpPWTBean.setLmsTranxIdList(lmsTranxIdList);</span>
<span class="nc" id="L1136">				tpPWTBean.setErrorCode(&quot;100&quot;);</span>
<span class="nc" id="L1137">				tpPWTBean.setSuccess(true);</span>
				
<span class="nc" id="L1139">				reprintBean.setPwtBean(tpPWTBean);</span>
<span class="nc" id="L1140">				reprintBean.setErrorCode(&quot;100&quot;);//Success</span>
<span class="nc" id="L1141">				reprintBean.setSuccess(true);</span>
			}
		}
<span class="nc" id="L1144">		return reprintBean;</span>
	}
	
	public static void fillKenoSaleTxnStatusAndData(UserInfoBean userBean, KenoPurchaseBean kenoBean, TPKenoPurchaseBean tpKenoBean){
<span class="nc" id="L1148">		AjaxRequestHelper ajxHelper = new AjaxRequestHelper();</span>
<span class="nc" id="L1149">		ajxHelper.getAvlblCreditAmt(userBean);</span>

<span class="nc" id="L1151">		double bal = userBean.getAvailableCreditLimit() - userBean.getClaimableBal();</span>
<span class="nc" id="L1152">		NumberFormat nFormat = NumberFormat.getInstance();</span>
<span class="nc" id="L1153">		nFormat.setMinimumFractionDigits(2);</span>
<span class="nc" id="L1154">		String balance =  nFormat.format(bal).replace(&quot;,&quot;, &quot;&quot;);</span>
		
<span class="nc" id="L1156">		tpKenoBean.setTicketNumber(kenoBean.getTicket_no() + kenoBean.getReprintCount());</span>
		
<span class="nc" id="L1158">		tpKenoBean.setBalance(balance);</span>
<span class="nc" id="L1159">		tpKenoBean.setGameCode(Util.getGameName(kenoBean.getGame_no()));</span>
<span class="nc" id="L1160">		tpKenoBean.setIsAdvancePlay(kenoBean.getIsAdvancedPlay() + &quot;&quot;);</span>
		//tpKenoBean.setLmsTranxId(lmsTranxIdToReprint);
<span class="nc" id="L1162">		tpKenoBean.setPurchaseTime(kenoBean.getPurchaseTime());</span>
<span class="nc" id="L1163">		tpKenoBean.setNoOfDraws(kenoBean.getNoOfDraws()+&quot;&quot;);</span>
<span class="nc" id="L1164">		tpKenoBean.setTicketCost(kenoBean.getTotalPurchaseAmt()+&quot;&quot;);</span>
<span class="nc" id="L1165">		tpKenoBean.setTotalPurchaseAmt(kenoBean.getTotalPurchaseAmt()+&quot;&quot;);</span>
<span class="nc" id="L1166">		tpKenoBean.setDrawDateTimeList(kenoBean.getDrawDateTime());</span>
<span class="nc" id="L1167">		tpKenoBean.setRaffle(kenoBean.isRaffelAssociated());</span>
<span class="nc" id="L1168">		PanelBean panelBean = null;</span>
<span class="nc" id="L1169">		List&lt;PanelBean&gt; panelList = new ArrayList&lt;PanelBean&gt;();</span>
<span class="nc" id="L1170">		int noOfPanels = kenoBean.getPlayType().length;</span>
<span class="nc bnc" id="L1171" title="All 2 branches missed.">		for (int i = 0; i &lt; noOfPanels; i++) {</span>
<span class="nc" id="L1172">			panelBean = new PanelBean();</span>
<span class="nc" id="L1173">			panelBean.setBetAmountMultiple(kenoBean.getBetAmountMultiple()[i]+&quot;&quot;);</span>
<span class="nc" id="L1174">			panelBean.setIsQp(kenoBean.getIsQuickPick()[i]+&quot;&quot;);</span>
<span class="nc" id="L1175">			panelBean.setNoPicked(kenoBean.getPlayerData()[i].split(&quot;,&quot;).length + &quot;&quot;);</span>
<span class="nc" id="L1176">			panelBean.setPickedNumbers(kenoBean.getPlayerData()[i]);</span>
<span class="nc" id="L1177">			panelBean.setPlayType(kenoBean.getPlayType()[i]);</span>
<span class="nc" id="L1178">			panelBean.setNoOfLines(kenoBean.getNoOfLines()[i]+&quot;&quot;);</span>
<span class="nc" id="L1179">			panelBean.setUnitPrice(kenoBean.getUnitPrice()[i]+&quot;&quot;);</span>
<span class="nc" id="L1180">			panelBean.setNoOfPanels(noOfPanels+&quot;&quot;);</span>
<span class="nc" id="L1181">			panelList.add(panelBean);</span>

		}
<span class="nc" id="L1184">		tpKenoBean.setPanelList(panelList);</span>
<span class="nc" id="L1185">		List&lt;RafflePurchaseBean&gt; raffleList= kenoBean.getRafflePurchaseBeanList();</span>
<span class="nc bnc" id="L1186" title="All 2 branches missed.">		if(raffleList != null){</span>
<span class="nc" id="L1187">			RafflePurchaseBean raffBean = null;</span>
<span class="nc" id="L1188">			RaffleBean tpRaffBean = null;			</span>
<span class="nc" id="L1189">			raffBean = raffleList.get(0);//hard coded as only 1 raffle applicable at this time //Yogesh Sir</span>
<span class="nc" id="L1190">			tpRaffBean = new RaffleBean();</span>
<span class="nc" id="L1191">			tpRaffBean.setDrawDateTime(raffBean.getDrawDateTime());</span>
<span class="nc" id="L1192">			tpRaffBean.setGameCode(Util.getGameName(raffBean.getGame_no()));</span>
<span class="nc bnc" id="L1193" title="All 2 branches missed.">			if(&quot;ORIGINAL&quot;.equalsIgnoreCase(raffBean.getRaffleTicketType())){</span>
<span class="nc" id="L1194">				tpRaffBean.setTicketNumber(raffBean.getRaffleTicket_no()+raffBean.getReprintCount());</span>
				}
<span class="nc" id="L1196">			tpRaffBean.setPurchaseTime(raffBean.getPurchaseTime());	</span>
<span class="nc" id="L1197">			tpKenoBean.setRaffleData(tpRaffBean);</span>
<span class="nc" id="L1198">			tpKenoBean.setRaffle(true);</span>
		}
<span class="nc" id="L1200">		tpKenoBean.setTopAdMessageList(kenoBean.getAdvMsg().get(&quot;TOP&quot;));</span>
<span class="nc" id="L1201">		tpKenoBean.setBottomAdMessageList(kenoBean.getAdvMsg().get(&quot;BOTTOM&quot;));</span>
<span class="nc" id="L1202">		tpKenoBean.setSuccess(true);</span>
<span class="nc" id="L1203">	}</span>
	
	public static void fillTanzanialottoSaleTxnStatusAndData(UserInfoBean userBean, LottoPurchaseBean lottoBean, TPLottoPurchaseBean tpLottoBean){
<span class="nc" id="L1206">		AjaxRequestHelper ajxHelper = new AjaxRequestHelper();</span>
<span class="nc" id="L1207">		ajxHelper.getAvlblCreditAmt(userBean);</span>

<span class="nc" id="L1209">		double bal = userBean.getAvailableCreditLimit() - userBean.getClaimableBal();</span>
<span class="nc" id="L1210">		NumberFormat nFormat = NumberFormat.getInstance();</span>
<span class="nc" id="L1211">		nFormat.setMinimumFractionDigits(2);</span>
<span class="nc" id="L1212">		String balance =  nFormat.format(bal).replace(&quot;,&quot;, &quot;&quot;);</span>
<span class="nc" id="L1213">		tpLottoBean.setBalance(balance);</span>
<span class="nc" id="L1214">		tpLottoBean.setBottomAdMessageList(lottoBean.getAdvMsg().get(&quot;BOTTOM&quot;));</span>
<span class="nc" id="L1215">		tpLottoBean.setDrawDateTime(lottoBean.getDrawDateTime());</span>
<span class="nc" id="L1216">		tpLottoBean.setGameCode(Util.getGameName(lottoBean.getGame_no()));</span>
<span class="nc" id="L1217">		tpLottoBean.setIsAdvancedPlay(lottoBean.getIsAdvancedPlay() + &quot;&quot;);</span>
<span class="nc" id="L1218">		tpLottoBean.setNoOfDraws(lottoBean.getNoOfDraws()+&quot;&quot;);</span>
		//tpLottoBean.setNoPicked(noPicked);
		
<span class="nc" id="L1221">		String[] pickedNumbers = new String[lottoBean.getPlayerPicked().size()];</span>
<span class="nc bnc" id="L1222" title="All 2 branches missed.">		for(int i = 0 ; i&lt;lottoBean.getPlayerPicked().size();i++){</span>
<span class="nc" id="L1223">			pickedNumbers[i] = lottoBean.getPlayerPicked().get(i);</span>
		}
		
<span class="nc" id="L1226">		tpLottoBean.setPickedNumbers(pickedNumbers);</span>
<span class="nc" id="L1227">		tpLottoBean.setPurchaseTime(lottoBean.getPurchaseTime());</span>
<span class="nc" id="L1228">		tpLottoBean.setQpStatus(lottoBean.getIsQuickPick());</span>
<span class="nc" id="L1229">		tpLottoBean.setRaffle(lottoBean.isRaffelAssociated());</span>
<span class="nc" id="L1230">		tpLottoBean.setTicketCost(lottoBean.getTotalPurchaseAmt()+&quot;&quot;);</span>
<span class="nc" id="L1231">		tpLottoBean.setTicketNumber(lottoBean.getTicket_no() + lottoBean.getReprintCount());</span>
<span class="nc" id="L1232">		tpLottoBean.setTopAdMessageList(lottoBean.getAdvMsg().get(&quot;TOP&quot;));</span>
<span class="nc" id="L1233">		tpLottoBean.setTotalPurchaseAmt(lottoBean.getTotalPurchaseAmt() + &quot;&quot;);</span>
				
<span class="nc" id="L1235">		List&lt;RafflePurchaseBean&gt; raffleList= lottoBean.getRafflePurchaseBeanList();</span>
<span class="nc bnc" id="L1236" title="All 2 branches missed.">		if(raffleList != null){</span>
<span class="nc" id="L1237">			RafflePurchaseBean raffBean = null;</span>
<span class="nc" id="L1238">			RaffleBean tpRaffBean = null;			</span>
<span class="nc" id="L1239">			raffBean = raffleList.get(0);//hard coded as only 1 raffle applicable at this time //Yogesh Sir</span>
<span class="nc" id="L1240">			tpRaffBean = new RaffleBean();</span>
<span class="nc" id="L1241">			tpRaffBean.setDrawDateTime(raffBean.getDrawDateTime());</span>
<span class="nc" id="L1242">			tpRaffBean.setGameCode(Util.getGameName(raffBean.getGame_no()));</span>
<span class="nc bnc" id="L1243" title="All 2 branches missed.">			if(&quot;ORIGINAL&quot;.equalsIgnoreCase(raffBean.getRaffleTicketType())){</span>
<span class="nc" id="L1244">				tpRaffBean.setTicketNumber(raffBean.getRaffleTicket_no()+raffBean.getReprintCount());</span>
				}
<span class="nc" id="L1246">			tpRaffBean.setPurchaseTime(raffBean.getPurchaseTime());	</span>
<span class="nc" id="L1247">			tpLottoBean.setRaffleData(tpRaffBean);</span>
<span class="nc" id="L1248">			tpLottoBean.setRaffle(true);</span>
		}
		
<span class="nc" id="L1251">		tpLottoBean.setSuccess(true);</span>
<span class="nc" id="L1252">	}</span>
	
	public static void fillBonusBalllottoSaleTxnStatusAndData(UserInfoBean userBean, LottoPurchaseBean lottoBean, TPLottoPurchaseBean tpLottoBean){
<span class="nc" id="L1255">		AjaxRequestHelper ajxHelper = new AjaxRequestHelper();</span>
<span class="nc" id="L1256">		ajxHelper.getAvlblCreditAmt(userBean);</span>

<span class="nc" id="L1258">		double bal = userBean.getAvailableCreditLimit() - userBean.getClaimableBal();</span>
<span class="nc" id="L1259">		NumberFormat nFormat = NumberFormat.getInstance();</span>
<span class="nc" id="L1260">		nFormat.setMinimumFractionDigits(2);</span>
<span class="nc" id="L1261">		String balance =  nFormat.format(bal).replace(&quot;,&quot;, &quot;&quot;);</span>
<span class="nc" id="L1262">		tpLottoBean.setBalance(balance);</span>
<span class="nc" id="L1263">		tpLottoBean.setBottomAdMessageList(lottoBean.getAdvMsg().get(&quot;BOTTOM&quot;));</span>
<span class="nc" id="L1264">		tpLottoBean.setDrawDateTime(lottoBean.getDrawDateTime());</span>
<span class="nc" id="L1265">		tpLottoBean.setGameCode(Util.getGameName(lottoBean.getGame_no()));</span>
<span class="nc" id="L1266">		tpLottoBean.setIsAdvancedPlay(lottoBean.getIsAdvancedPlay() + &quot;&quot;);</span>
<span class="nc" id="L1267">		tpLottoBean.setNoOfDraws(lottoBean.getNoOfDraws()+&quot;&quot;);</span>
		//tpLottoBean.setNoPicked(noPicked);
		
<span class="nc" id="L1270">		String[] pickedNumbers = new String[lottoBean.getPlayerPicked().size()];</span>
<span class="nc bnc" id="L1271" title="All 2 branches missed.">		for(int i = 0 ; i&lt;lottoBean.getPlayerPicked().size();i++){</span>
<span class="nc" id="L1272">			pickedNumbers[i] = lottoBean.getPlayerPicked().get(i);</span>
		}
		
<span class="nc" id="L1275">		tpLottoBean.setPickedNumbers(pickedNumbers);</span>
<span class="nc" id="L1276">		tpLottoBean.setPurchaseTime(lottoBean.getPurchaseTime());</span>
<span class="nc" id="L1277">		tpLottoBean.setQpStatus(lottoBean.getIsQuickPick());</span>
<span class="nc" id="L1278">		tpLottoBean.setRaffle(lottoBean.isRaffelAssociated());</span>
<span class="nc" id="L1279">		tpLottoBean.setTicketCost(lottoBean.getTotalPurchaseAmt()+&quot;&quot;);</span>
<span class="nc" id="L1280">		tpLottoBean.setTicketNumber(lottoBean.getTicket_no() + lottoBean.getReprintCount());</span>
<span class="nc" id="L1281">		tpLottoBean.setTopAdMessageList(lottoBean.getAdvMsg().get(&quot;TOP&quot;));</span>
<span class="nc" id="L1282">		tpLottoBean.setTotalPurchaseAmt(lottoBean.getTotalPurchaseAmt() + &quot;&quot;);</span>
				
<span class="nc" id="L1284">		List&lt;RafflePurchaseBean&gt; raffleList= lottoBean.getRafflePurchaseBeanList();</span>
<span class="nc bnc" id="L1285" title="All 2 branches missed.">		if(raffleList != null){</span>
<span class="nc" id="L1286">			RafflePurchaseBean raffBean = null;</span>
<span class="nc" id="L1287">			RaffleBean tpRaffBean = null;			</span>
<span class="nc" id="L1288">			raffBean = raffleList.get(0);//hard coded as only 1 raffle applicable at this time //Yogesh Sir</span>
<span class="nc" id="L1289">			tpRaffBean = new RaffleBean();</span>
<span class="nc" id="L1290">			tpRaffBean.setDrawDateTime(raffBean.getDrawDateTime());</span>
<span class="nc" id="L1291">			tpRaffBean.setGameCode(Util.getGameName(raffBean.getGame_no()));</span>
<span class="nc bnc" id="L1292" title="All 2 branches missed.">			if(&quot;ORIGINAL&quot;.equalsIgnoreCase(raffBean.getRaffleTicketType())){</span>
<span class="nc" id="L1293">				tpRaffBean.setTicketNumber(raffBean.getRaffleTicket_no()+raffBean.getReprintCount());</span>
				}
<span class="nc" id="L1295">			tpRaffBean.setPurchaseTime(raffBean.getPurchaseTime());	</span>
<span class="nc" id="L1296">			tpLottoBean.setRaffleData(tpRaffBean);</span>
<span class="nc" id="L1297">			tpLottoBean.setRaffle(true);</span>
		}
		
<span class="nc" id="L1300">		tpLottoBean.setSuccess(true);</span>
<span class="nc" id="L1301">	}</span>
	
	public static void fillCancelTxnStatusAndData(UserInfoBean userBean, CancelTicketBean cancelBean, CancelBean tpCancelBean){
<span class="nc" id="L1304">		AjaxRequestHelper ajxHelper = new AjaxRequestHelper();</span>
<span class="nc" id="L1305">		ajxHelper.getAvlblCreditAmt(userBean);</span>
<span class="nc" id="L1306">		double bal = userBean.getAvailableCreditLimit() - userBean.getClaimableBal();</span>
<span class="nc" id="L1307">		tpCancelBean.setBalance(bal);</span>
<span class="nc" id="L1308">		tpCancelBean.setTicketNumber(cancelBean.getTicketNo() + cancelBean.getReprintCount());</span>
<span class="nc" id="L1309">		tpCancelBean.setRefundAmount(cancelBean.getRefundAmount());</span>
		
<span class="nc" id="L1311">		tpCancelBean.setSuccess(true);</span>
<span class="nc" id="L1312">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>