<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AgentSalePWTCommVarianceHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.userMgmt.common</a> &gt; <span class="el_source">AgentSalePWTCommVarianceHelper.java</span></div><h1>AgentSalePWTCommVarianceHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.userMgmt.common;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.TreeMap;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.beans.SalePwtCommVarBean;
import com.skilrock.lms.beans.UpdateSalePwtCommVarBean;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.utility.FormatNumber;
import com.skilrock.lms.coreEngine.drawGames.common.CommonFunctionsHelper;
import com.skilrock.lms.web.drawGames.common.Util;

<span class="nc" id="L24">public class AgentSalePWTCommVarianceHelper {</span>
<span class="nc" id="L25">	static Log logger = LogFactory.getLog(AgentSalePWTCommVarianceHelper.class);</span>
	public static void main(String[] args) {
<span class="nc" id="L27">		System.out.println(5.0 != 5);</span>
<span class="nc" id="L28">		System.out.println(5.0 != 4.0);</span>

<span class="nc" id="L30">	}</span>

	private Connection con;
<span class="nc" id="L33">	public Map&lt;String, Double&gt; maxCommRate = new TreeMap&lt;String, Double&gt;();</span>

	/*
	 * public List&lt;String&gt; getAgentNameList(String orgType) { List&lt;String&gt;
	 * agentNameList=new ArrayList&lt;String&gt;(); con=new
	 * DBConnect().getConnection(); try { pstmt=con.prepareStatement(&quot;select
	 * name from st_lms_organization_master where
	 * organization_type='&quot;+orgType+&quot;' order by name&quot;); rs=pstmt.executeQuery();
	 * while(rs.next()) { String agentName=rs.getString(&quot;name&quot;);
	 * agentNameList.add(agentName); } rs.close(); } catch (SQLException e) {
	 * e.printStackTrace(); } finally { try { if(pstmt!=null) pstmt.close();
	 * if(con!=null &amp;&amp; (!con.isClosed())) con.close(); } catch (SQLException e) { //
	 * TODO Auto-generated catch block e.printStackTrace(); } }
	 * 
	 * System.out.println(&quot;name list ===== &quot;+agentNameList); return
	 * agentNameList; }
	 */

	private PreparedStatement pstmt;

	private ResultSet rs;

	//

	private List&lt;UpdateSalePwtCommVarBean&gt; getAllSalePwtGameDetails(
			String gamedetailsquery, Connection conn) throws SQLException {

<span class="nc" id="L60">		List&lt;UpdateSalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;UpdateSalePwtCommVarBean&gt;();</span>
<span class="nc" id="L61">		UpdateSalePwtCommVarBean bean = null;</span>
<span class="nc" id="L62">		Connection connection = conn;</span>
<span class="nc" id="L63">		PreparedStatement pstmt = connection.prepareStatement(gamedetailsquery);</span>
<span class="nc" id="L64">		ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L65">		System.out.println(&quot; game name query === &quot; + pstmt);</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">		while (rss.next()) {</span>
<span class="nc" id="L67">			bean = new UpdateSalePwtCommVarBean();</span>
<span class="nc" id="L68">			bean.setGameId(rss.getInt(&quot;game_id&quot;));</span>
			// retrieve the default Sale commission variance
<span class="nc" id="L70">			bean.setDefaultSaleCommRate(rss.getDouble(&quot;agent_sale_comm_rate&quot;));</span>
<span class="nc" id="L71">			bean.setDefaultPwtCommRate(rss.getDouble(&quot;agent_pwt_comm_rate&quot;));</span>
<span class="nc" id="L72">			salePwtCommVarList.add(bean);</span>
		}

<span class="nc" id="L75">		return salePwtCommVarList;</span>

	}

	public Map&lt;String, Double&gt; getDefaultCommRate(String nbr, String name) {
<span class="nc" id="L80">		double maxSaleVariance = 0.0;</span>
<span class="nc" id="L81">		double maxPwtVariance = 0.0;</span>
<span class="nc" id="L82">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L83">		String sqlQuery = &quot;select agent_sale_comm_rate 'max_sale_rate',  agent_pwt_comm_rate  'max_pwt_rate',  govt_comm_rate  'max_gov_rate',  prize_payout_ratio  'max_prize_ratio' from st_se_game_master where  game_status!='TERMINATE' and game_nbr=&quot;</span>
				+ nbr + &quot; and game_name='&quot; + name + &quot;'&quot;;
		try {
<span class="nc" id="L86">			PreparedStatement pstmt = conn.prepareStatement(sqlQuery);</span>
<span class="nc" id="L87">			ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L88">			System.out.println(&quot; game name query === &quot; + pstmt);</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">			while (rss.next()) {</span>
<span class="nc" id="L90">				double maxSaleCommRate = rss.getDouble(&quot;max_sale_rate&quot;);</span>
<span class="nc" id="L91">				double maxGovRate = rss.getDouble(&quot;max_gov_rate&quot;);</span>
<span class="nc" id="L92">				double maxPrizeRatio = rss.getDouble(&quot;max_prize_ratio&quot;);</span>
<span class="nc" id="L93">				double maxPwtCommRate = rss.getDouble(&quot;max_pwt_rate&quot;);</span>
<span class="nc" id="L94">				maxSaleVariance = 100 - (maxSaleCommRate + maxGovRate + maxPrizeRatio);</span>
<span class="nc" id="L95">				maxPwtVariance = 100 - (maxPwtCommRate + maxGovRate + maxPrizeRatio);</span>
				// maxPwtVariance=100(maxPwtCommRate+)
<span class="nc" id="L97">				maxCommRate.put(&quot;maxSaleVariance&quot;, maxSaleVariance);</span>
<span class="nc" id="L98">				maxCommRate.put(&quot;maxPwtVariance&quot;, maxPwtVariance);</span>
				// maxCommRate.put(&quot;maxPwtVariance&quot;, value)
<span class="nc" id="L100">			}</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">			if (rss != null) {</span>
<span class="nc" id="L102">				rss.close();</span>
			}
<span class="nc bnc" id="L104" title="All 2 branches missed.">			if (pstmt != null) {</span>
<span class="nc" id="L105">				pstmt.close();</span>
			}
<span class="nc" id="L107">		} catch (SQLException e) {</span>
<span class="nc" id="L108">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L110">			try {</span>
<span class="nc bnc" id="L111" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L112">					conn.close();</span>
				}
<span class="nc" id="L114">			} catch (SQLException e) {</span>
<span class="nc" id="L115">				e.printStackTrace();</span>
<span class="nc" id="L116">			}</span>
<span class="nc" id="L117">		}</span>
<span class="nc" id="L118">		return maxCommRate;</span>
	}

	public Map&lt;String, Double&gt; getDefaultCommRateDg(String nbr, String name) {
<span class="nc" id="L122">		double maxSaleVariance = 0.0;</span>
<span class="nc" id="L123">		double maxPwtVariance = 0.0;</span>
<span class="nc" id="L124">		Connection conn = DBConnect.getConnection();</span>
		/*String sqlQuery = &quot;select agent_sale_comm_rate 'max_sale_rate',  agent_pwt_comm_rate  'max_pwt_rate',  govt_comm  'max_gov_rate',  prize_payout_ratio  'max_prize_ratio' from st_dg_game_master where  game_status!='TERMINATE' and game_nbr=&quot;
				+ nbr + &quot; and game_name='&quot; + name + &quot;'&quot;;*/
		
<span class="nc" id="L128">		String sqlQuery = &quot;select agent_sale_comm_rate 'max_sale_rate',  agent_pwt_comm_rate  'max_pwt_rate',  govt_comm  'max_gov_rate',  prize_payout_ratio  'max_prize_ratio' from st_dg_game_master where  game_status!='TERMINATE' and game_id=&quot;</span>
			+ nbr;
		try {
<span class="nc" id="L131">			PreparedStatement pstmt = conn.prepareStatement(sqlQuery);</span>
<span class="nc" id="L132">			ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L133">			System.out.println(&quot; game name query === DG &quot; + pstmt);</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">			while (rss.next()) {</span>
<span class="nc" id="L135">				double maxSaleCommRate = rss.getDouble(&quot;max_sale_rate&quot;);</span>
<span class="nc" id="L136">				double maxGovRate = rss.getDouble(&quot;max_gov_rate&quot;);</span>
<span class="nc" id="L137">				double maxPrizeRatio = rss.getDouble(&quot;max_prize_ratio&quot;);</span>
<span class="nc" id="L138">				double maxPwtCommRate = rss.getDouble(&quot;max_pwt_rate&quot;);</span>
<span class="nc" id="L139">				maxSaleVariance = 100 - (maxSaleCommRate + maxGovRate + maxPrizeRatio);</span>
<span class="nc" id="L140">				maxPwtVariance = 100 - (maxPwtCommRate + maxGovRate + maxPrizeRatio);</span>
				// maxPwtVariance=100(maxPwtCommRate+)
<span class="nc" id="L142">				maxCommRate.put(&quot;maxSaleVariance&quot;, maxSaleVariance);</span>
<span class="nc" id="L143">				maxCommRate.put(&quot;maxPwtVariance&quot;, maxPwtVariance);</span>
				// maxCommRate.put(&quot;maxPwtVariance&quot;, value)
<span class="nc" id="L145">			}</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">			if (rss != null) {</span>
<span class="nc" id="L147">				rss.close();</span>
			}
<span class="nc bnc" id="L149" title="All 2 branches missed.">			if (pstmt != null) {</span>
<span class="nc" id="L150">				pstmt.close();</span>
			}
<span class="nc" id="L152">		} catch (SQLException e) {</span>
<span class="nc" id="L153">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L155">			try {</span>
<span class="nc bnc" id="L156" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L157">					conn.close();</span>
				}
<span class="nc" id="L159">			} catch (SQLException e) {</span>
<span class="nc" id="L160">				e.printStackTrace();</span>
<span class="nc" id="L161">			}</span>
<span class="nc" id="L162">		}</span>
<span class="nc" id="L163">		return maxCommRate;</span>
	}
	
	public Map&lt;String, Double&gt; getDefaultCommRateIW(String nbr, String name) {
<span class="nc" id="L167">		double maxSaleVariance = 0.0;</span>
<span class="nc" id="L168">		double maxPwtVariance = 0.0;</span>
<span class="nc" id="L169">		Connection conn = DBConnect.getConnection();</span>
		/*
		 * String sqlQuery =
		 * &quot;select agent_sale_comm_rate 'max_sale_rate',  agent_pwt_comm_rate  'max_pwt_rate',  govt_comm  'max_gov_rate',  prize_payout_ratio  'max_prize_ratio' from st_dg_game_master where  game_status!='TERMINATE' and game_nbr=&quot;
		 * + nbr + &quot; and game_name='&quot; + name + &quot;'&quot;;
		 */

<span class="nc" id="L176">		String sqlQuery = &quot;select agent_sale_comm_rate 'max_sale_rate', agent_pwt_comm_rate 'max_pwt_rate', gov_comm_rate  'max_gov_rate',  prize_payout_ratio  'max_prize_ratio' from st_iw_game_master where  game_status!='TERMINATE' and game_id=&quot; + nbr;</span>
		try {
<span class="nc" id="L178">			PreparedStatement pstmt = conn.prepareStatement(sqlQuery);</span>
<span class="nc" id="L179">			ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L180">			System.out.println(&quot; game name query === DG &quot; + pstmt);</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">			while (rss.next()) {</span>
<span class="nc" id="L182">				double maxSaleCommRate = rss.getDouble(&quot;max_sale_rate&quot;);</span>
<span class="nc" id="L183">				double maxGovRate = rss.getDouble(&quot;max_gov_rate&quot;);</span>
<span class="nc" id="L184">				double maxPrizeRatio = rss.getDouble(&quot;max_prize_ratio&quot;);</span>
<span class="nc" id="L185">				double maxPwtCommRate = rss.getDouble(&quot;max_pwt_rate&quot;);</span>
<span class="nc" id="L186">				maxSaleVariance = 100 - (maxSaleCommRate + maxGovRate + maxPrizeRatio);</span>
<span class="nc" id="L187">				maxPwtVariance = 100 - (maxPwtCommRate + maxGovRate + maxPrizeRatio);</span>
				// maxPwtVariance=100(maxPwtCommRate+)
<span class="nc" id="L189">				maxCommRate.put(&quot;maxSaleVariance&quot;, maxSaleVariance);</span>
<span class="nc" id="L190">				maxCommRate.put(&quot;maxPwtVariance&quot;, maxPwtVariance);</span>
				// maxCommRate.put(&quot;maxPwtVariance&quot;, value)
<span class="nc" id="L192">			}</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">			if (rss != null) {</span>
<span class="nc" id="L194">				rss.close();</span>
			}
<span class="nc bnc" id="L196" title="All 2 branches missed.">			if (pstmt != null) {</span>
<span class="nc" id="L197">				pstmt.close();</span>
			}
<span class="nc" id="L199">		} catch (SQLException e) {</span>
<span class="nc" id="L200">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L202">			try {</span>
<span class="nc bnc" id="L203" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L204">					conn.close();</span>
				}
<span class="nc" id="L206">			} catch (SQLException e) {</span>
<span class="nc" id="L207">				e.printStackTrace();</span>
<span class="nc" id="L208">			}</span>
<span class="nc" id="L209">		}</span>
<span class="nc" id="L210">		return maxCommRate;</span>
	}
	
	public Map&lt;String, Double&gt; getDefaultCommRateCS(String id, String prodCode, String provider) {
<span class="nc" id="L214">		double maxSaleVariance = 0.0;</span>
<span class="nc" id="L215">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L216">		String sqlQuery = &quot;select agent_comm 'max_sale_rate',  good_cause_comm  'max_gov_rate' from st_cs_product_master where  status!='INACTIVE' and product_id=&quot;</span>
				+ id ;
		try {
<span class="nc" id="L219">			PreparedStatement pstmt = conn.prepareStatement(sqlQuery);</span>
<span class="nc" id="L220">			ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L221">			System.out.println(&quot; product name query === CS &quot; + pstmt);</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">			while (rss.next()) {</span>
<span class="nc" id="L223">				double maxSaleCommRate = rss.getDouble(&quot;max_sale_rate&quot;);</span>
<span class="nc" id="L224">				double maxGovRate = rss.getDouble(&quot;max_gov_rate&quot;);</span>
<span class="nc" id="L225">				maxSaleVariance = 100 - (maxSaleCommRate + maxGovRate);</span>
				// maxPwtVariance=100(maxPwtCommRate+)
<span class="nc" id="L227">				maxCommRate.put(&quot;maxSaleVariance&quot;, maxSaleVariance);</span>
<span class="nc" id="L228">			}</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">			if (rss != null) {</span>
<span class="nc" id="L230">				rss.close();</span>
			}
<span class="nc bnc" id="L232" title="All 2 branches missed.">			if (pstmt != null) {</span>
<span class="nc" id="L233">				pstmt.close();</span>
			}
<span class="nc" id="L235">		} catch (SQLException e) {</span>
<span class="nc" id="L236">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L238">			try {</span>
<span class="nc bnc" id="L239" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L240">					conn.close();</span>
				}
<span class="nc" id="L242">			} catch (SQLException e) {</span>
<span class="nc" id="L243">				e.printStackTrace();</span>
<span class="nc" id="L244">			}</span>
<span class="nc" id="L245">		}</span>
<span class="nc" id="L246">		return maxCommRate;</span>
	}
	
	public Map&lt;String, Double&gt; getDefaultCommRateForOLA(String id, String name){

<span class="nc" id="L251">		double maxWidVariance = 0.0;</span>
<span class="nc" id="L252">		double maxDepVariance = 0.0;</span>
<span class="nc" id="L253">		double maxNetGVariance = 0.0;</span>
<span class="nc" id="L254">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L255">		String sqlQuery = &quot;select agt_withdrawl_comm 'max_wid_rate',  agt_deposit_comm  'max_dep_rate', agt_net_gaming_comm 'max_netg_rate' from st_ola_wallet_master where  wallet_status ='ACTIVE' and wallet_id=&quot;</span>
			+ id;
		try {
<span class="nc" id="L258">			PreparedStatement pstmt = conn.prepareStatement(sqlQuery);</span>
<span class="nc" id="L259">			ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L260">			System.out.println(&quot; wallet name query === OLA &quot; + pstmt);</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">			while (rss.next()) {</span>
<span class="nc" id="L262">				double maxWidCommRate = rss.getDouble(&quot;max_wid_rate&quot;);</span>
<span class="nc" id="L263">				double maxDepCommRate = rss.getDouble(&quot;max_dep_rate&quot;);</span>
<span class="nc" id="L264">				double maxNetGCommRate = rss.getDouble(&quot;max_netg_rate&quot;);</span>
<span class="nc" id="L265">				maxWidVariance = 100 - (maxWidCommRate + maxDepCommRate + maxNetGCommRate);</span>
<span class="nc" id="L266">				maxDepVariance = 100 - (maxWidCommRate + maxDepCommRate + maxNetGCommRate);</span>
<span class="nc" id="L267">				maxNetGVariance = 100 - (maxWidCommRate + maxDepCommRate + maxNetGCommRate);</span>
				// maxPwtVariance=100(maxPwtCommRate+)
<span class="nc" id="L269">				maxCommRate.put(&quot;maxWidVariance&quot;, maxWidVariance);</span>
<span class="nc" id="L270">				maxCommRate.put(&quot;maxDepVariance&quot;, maxDepVariance);</span>
<span class="nc" id="L271">				maxCommRate.put(&quot;maxNetGVariance&quot;, maxNetGVariance);</span>
				// maxCommRate.put(&quot;maxPwtVariance&quot;, value)
<span class="nc" id="L273">			}</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">			if (rss != null) {</span>
<span class="nc" id="L275">				rss.close();</span>
			}
<span class="nc bnc" id="L277" title="All 2 branches missed.">			if (pstmt != null) {</span>
<span class="nc" id="L278">				pstmt.close();</span>
			}
<span class="nc" id="L280">		} catch (SQLException e) {</span>
<span class="nc" id="L281">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L283">			try {</span>
<span class="nc bnc" id="L284" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L285">					conn.close();</span>
				}
<span class="nc" id="L287">			} catch (SQLException e) {</span>
<span class="nc" id="L288">				e.printStackTrace();</span>
<span class="nc" id="L289">			}</span>
<span class="nc" id="L290">		}</span>
<span class="nc" id="L291">		return maxCommRate;</span>
	
	}

	public Map&lt;String, Double&gt; getDefaultCommRateForAll() {
<span class="nc" id="L296">		double maxSaleVariance = 0.0;</span>
<span class="nc" id="L297">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L298">		String sqlQuery = &quot;select max(agent_sale_comm_rate)'max_sale_rate', min(agent_sale_comm_rate) 'min_sale_rate', max(agent_pwt_comm_rate) 'max_pwt_rate', max(govt_comm_rate) 'max_gov_rate', max(prize_payout_ratio)'max_prize_ratio' from st_se_game_master where  game_status!='TERMINATE'&quot;;</span>
		try {
<span class="nc" id="L300">			PreparedStatement pstmt = conn.prepareStatement(sqlQuery);</span>
<span class="nc" id="L301">			ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L302">			System.out.println(&quot; game name query === &quot; + pstmt);</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">			while (rss.next()) {</span>
<span class="nc" id="L304">				double maxSaleCommRate = rss.getDouble(&quot;max_sale_rate&quot;);</span>
<span class="nc" id="L305">				double maxGovRate = rss.getDouble(&quot;max_gov_rate&quot;);</span>
<span class="nc" id="L306">				double maxPrizeRatio = rss.getDouble(&quot;max_prize_ratio&quot;);</span>
<span class="nc" id="L307">				double maxPwtCommRate = rss.getDouble(&quot;max_pwt_rate&quot;);</span>
<span class="nc" id="L308">				double minSaleCommRate = rss.getDouble(&quot;min_sale_rate&quot;);</span>
<span class="nc" id="L309">				maxSaleVariance = 100 - (maxSaleCommRate + maxGovRate + maxPrizeRatio);</span>
				// maxPwtVariance=100(maxPwtCommRate+)
<span class="nc" id="L311">				maxCommRate.put(&quot;maxSaleVariance&quot;, maxSaleVariance);</span>
<span class="nc" id="L312">				maxCommRate.put(&quot;minSaleCommVar&quot;, minSaleCommRate);</span>
				// maxCommRate.put(&quot;maxPwtVariance&quot;, value)
<span class="nc" id="L314">			}</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">			if (rss != null) {</span>
<span class="nc" id="L316">				rss.close();</span>
			}
<span class="nc bnc" id="L318" title="All 2 branches missed.">			if (pstmt != null) {</span>
<span class="nc" id="L319">				pstmt.close();</span>
			}
<span class="nc" id="L321">		} catch (SQLException e) {</span>
<span class="nc" id="L322">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L324">			try {</span>
<span class="nc bnc" id="L325" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L326">					conn.close();</span>
				}
<span class="nc" id="L328">			} catch (SQLException e) {</span>
<span class="nc" id="L329">				e.printStackTrace();</span>
<span class="nc" id="L330">			}</span>
<span class="nc" id="L331">		}</span>
<span class="nc" id="L332">		return maxCommRate;</span>
	}

	private String getGameName(int gameId, Connection conn) {
<span class="nc" id="L336">		String gameName = &quot;No Name&quot;;</span>

<span class="nc" id="L338">		String sqlQuery = &quot;select game_nbr, game_name, game_status from st_se_game_master where (game_id =? and game_status!='TERMINATE')&quot;;</span>
		try {
<span class="nc" id="L340">			PreparedStatement pstmt = conn.prepareStatement(sqlQuery);</span>
<span class="nc" id="L341">			pstmt.setInt(1, gameId);</span>
<span class="nc" id="L342">			ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L343">			System.out.println(&quot; game name query === &quot; + pstmt);</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">			while (rss.next()) {</span>
<span class="nc" id="L345">				gameName = rss.getInt(&quot;game_nbr&quot;) + &quot;-&quot;</span>
						+ rss.getString(&quot;game_name&quot;);
			}
<span class="nc bnc" id="L348" title="All 2 branches missed.">			if (rss != null) {</span>
<span class="nc" id="L349">				rss.close();</span>
			}
<span class="nc bnc" id="L351" title="All 2 branches missed.">			if (pstmt != null) {</span>
<span class="nc" id="L352">				pstmt.close();</span>
			}
<span class="nc" id="L354">		} catch (SQLException e) {</span>
<span class="nc" id="L355">			e.printStackTrace();</span>
<span class="nc" id="L356">		}</span>
<span class="nc" id="L357">		return gameName;</span>
	}

	//
	public Map&lt;String, String&gt; getOrganizationType(int loginTierId) {
<span class="nc" id="L362">		Map&lt;String, String&gt; orgTypeMap = new TreeMap&lt;String, String&gt;();</span>
<span class="nc" id="L363">		con = DBConnect.getConnection();</span>
		try {
<span class="nc" id="L365">			pstmt = con</span>
					.prepareStatement(&quot;Select * from st_lms_tier_master where parent_tier_id ='&quot;
							+ loginTierId + &quot;'&quot;);
<span class="nc" id="L368">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L370">				orgTypeMap.put(rs.getString(&quot;tier_code&quot;), rs</span>
						.getString(&quot;tier_name&quot;));
			}
<span class="nc" id="L373">			rs.close();</span>
<span class="nc" id="L374">		} catch (SQLException e) {</span>
<span class="nc" id="L375">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L377">			try {</span>
<span class="nc bnc" id="L378" title="All 6 branches missed.">				if (pstmt != null) {</span>
<span class="nc" id="L379">					pstmt.close();</span>
				}
<span class="nc bnc" id="L381" title="All 12 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L382">					con.close();</span>
				}
<span class="nc" id="L384">			} catch (SQLException e) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L386">				e.printStackTrace();</span>
<span class="nc" id="L387">			}</span>
<span class="nc" id="L388">		}</span>

<span class="nc" id="L390">		System.out.println(&quot;orgTypeMap map  ===== &quot; + orgTypeMap);</span>
<span class="nc" id="L391">		return orgTypeMap;</span>
	}

	public List&lt;SalePwtCommVarBean&gt; getSalePwtGameDetails(String query,
			Connection conn, String gamestatus) throws SQLException {
<span class="nc" id="L396">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L397">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L398">		Connection connection = conn;</span>
<span class="nc" id="L399">		PreparedStatement pstmt = connection.prepareStatement(query);</span>
<span class="nc" id="L400">		ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L401">		System.out.println(&quot; game name query === &quot; + pstmt);</span>
<span class="nc bnc" id="L402" title="All 2 branches missed.">		while (rss.next()) {</span>
<span class="nc" id="L403">			bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L404">			String gamename = rss.getInt(&quot;game_nbr&quot;) + &quot;-&quot;</span>
					+ rss.getString(&quot;game_name&quot;);
<span class="nc" id="L406">			bean.setGameName(gamename);</span>

			// retrieve the default Sale commission variance
<span class="nc" id="L409">			double defSaleCommRate = rss.getDouble(&quot;agent_sale_comm_rate&quot;);</span>
<span class="nc" id="L410">			bean.setDefSaleCommRate(FormatNumber.formatNumber(defSaleCommRate));</span>
			// retrieve the Sale commission variance
<span class="nc" id="L412">			double currentSaleCommVar = 0.0;// rss.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L413">			bean.setCurrentSaleCommVar(FormatNumber</span>
					.formatNumber(currentSaleCommVar));
			// calculate the Sale commission variance
<span class="nc" id="L416">			bean.setNetSaleCommRate(FormatNumber.formatNumber(defSaleCommRate</span>
					+ currentSaleCommVar));

<span class="nc" id="L419">			double defPwtCommRate = rss.getDouble(&quot;agent_pwt_comm_rate&quot;);</span>
<span class="nc" id="L420">			bean.setDefPwtCommRate(FormatNumber.formatNumber(defPwtCommRate));</span>
			// retrieve the PWT commission variance
<span class="nc" id="L422">			double currentPwtCommVar = 0.0;// rss.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L423">			bean.setCurrentPwtCommVar(FormatNumber</span>
					.formatNumber(currentPwtCommVar));
			// calculate the PWT commission variance
<span class="nc" id="L426">			bean.setNetPwtCommRate(FormatNumber.formatNumber(defPwtCommRate</span>
					+ currentPwtCommVar));

<span class="nc" id="L429">			salePwtCommVarList.add(bean);</span>
<span class="nc" id="L430">		}</span>

<span class="nc" id="L432">		return salePwtCommVarList;</span>
	}

	public List&lt;SalePwtCommVarBean&gt; getSalePwtGameDetailsDg(String query,
			Connection conn, String gamestatus) throws SQLException {
<span class="nc" id="L437">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L438">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L439">		Connection connection = conn;</span>
<span class="nc" id="L440">		PreparedStatement pstmt = connection.prepareStatement(query);</span>
<span class="nc" id="L441">		ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L442">		System.out.println(&quot; game name query === &quot; + pstmt);</span>
<span class="nc bnc" id="L443" title="All 2 branches missed.">		while (rss.next()) {</span>
<span class="nc" id="L444">			bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L445">			String gamename = rss.getInt(&quot;game_id&quot;) + &quot;-&quot;</span>
					+ rss.getString(&quot;game_name&quot;);
<span class="nc" id="L447">			bean.setGameName(gamename);</span>

			// retrieve the default Sale commission variance
<span class="nc" id="L450">			double defSaleCommRate = rss.getDouble(&quot;agent_sale_comm_rate&quot;);</span>
<span class="nc" id="L451">			bean.setDefSaleCommRate(FormatNumber.formatNumber(defSaleCommRate));</span>
			// retrieve the Sale commission variance
<span class="nc" id="L453">			double currentSaleCommVar = 0.0;// rss.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L454">			bean.setCurrentSaleCommVar(FormatNumber</span>
					.formatNumber(currentSaleCommVar));
			// calculate the Sale commission variance
<span class="nc" id="L457">			bean.setNetSaleCommRate(FormatNumber.formatNumber(defSaleCommRate</span>
					+ currentSaleCommVar));

<span class="nc" id="L460">			double defPwtCommRate = rss.getDouble(&quot;agent_pwt_comm_rate&quot;);</span>
<span class="nc" id="L461">			bean.setDefPwtCommRate(FormatNumber.formatNumber(defPwtCommRate));</span>
			// retrieve the PWT commission variance
<span class="nc" id="L463">			double currentPwtCommVar = 0.0;// rss.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L464">			bean.setCurrentPwtCommVar(FormatNumber</span>
					.formatNumber(currentPwtCommVar));
			// calculate the PWT commission variance
<span class="nc" id="L467">			bean.setNetPwtCommRate(FormatNumber.formatNumber(defPwtCommRate</span>
					+ currentPwtCommVar));

<span class="nc" id="L470">			salePwtCommVarList.add(bean);</span>
<span class="nc" id="L471">		}</span>

<span class="nc" id="L473">		return salePwtCommVarList;</span>
	}

	public List&lt;SalePwtCommVarBean&gt; getSaleProdDetailsCS(String query,
			Connection conn, String prodStatus) throws SQLException {
<span class="nc" id="L478">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L479">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L480">		Connection connection = conn;</span>
<span class="nc" id="L481">		PreparedStatement pstmt = connection.prepareStatement(query);</span>
<span class="nc" id="L482">		ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L483">		logger.debug(&quot; product name query in comm var === &quot; + pstmt);</span>
<span class="nc bnc" id="L484" title="All 2 branches missed.">		while (rss.next()) {</span>
<span class="nc" id="L485">			bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L486">			String gamename = rss.getInt(&quot;product_id&quot;) + &quot;_&quot;</span>
					+ rss.getString(&quot;product_code&quot;)+ &quot;_&quot; + rss.getString(&quot;operator_name&quot;)+&quot;_&quot;+rss.getString(&quot;denomination&quot;);
<span class="nc" id="L488">			bean.setGameName(gamename);</span>

			// retrieve the default Sale commission variance
<span class="nc" id="L491">			double defSaleCommRate = rss.getDouble(&quot;agent_comm&quot;);</span>
<span class="nc" id="L492">			bean.setDefSaleCommRate(FormatNumber.formatNumber(defSaleCommRate));</span>
			// retrieve the Sale commission variance
<span class="nc" id="L494">			double currentSaleCommVar = 0.0;// rss.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L495">			bean.setCurrentSaleCommVar(FormatNumber</span>
					.formatNumber(currentSaleCommVar));
			// calculate the Sale commission variance
<span class="nc" id="L498">			bean.setNetSaleCommRate(FormatNumber.formatNumber(defSaleCommRate</span>
					+ currentSaleCommVar));
<span class="nc" id="L500">			salePwtCommVarList.add(bean);</span>
<span class="nc" id="L501">		}</span>

<span class="nc" id="L503">		return salePwtCommVarList;</span>
	}
	
	public List&lt;SalePwtCommVarBean&gt; getWidDepNetgameDetailsOLA(String query,
			Connection conn, String walletStatus)throws SQLException{

<span class="nc" id="L509">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L510">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L511">		Connection connection = conn;</span>
<span class="nc" id="L512">		PreparedStatement pstmt = connection.prepareStatement(query);</span>
<span class="nc" id="L513">		ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L514">		System.out.println(&quot; wallet name query === &quot; + pstmt);</span>
<span class="nc bnc" id="L515" title="All 2 branches missed.">		while (rss.next()) {</span>
<span class="nc" id="L516">			bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L517">			String walletname = rss.getInt(&quot;wallet_id&quot;) + &quot;-&quot;</span>
					+ rss.getString(&quot;wallet_name&quot;);
<span class="nc" id="L519">			bean.setGameName(walletname);</span>

			// retrieve the default Withdrawal commission variance
<span class="nc" id="L522">			double defWidCommRate = rss.getDouble(&quot;agt_withdrawl_comm&quot;);</span>
<span class="nc" id="L523">			bean.setDefWidCommRate(FormatNumber.formatNumber(defWidCommRate));</span>
			// retrieve the Withdrawal commission variance
<span class="nc" id="L525">			double currentWidCommVar = 0.0;// rss.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L526">			bean.setCurrentWidCommVar(FormatNumber</span>
					.formatNumber(currentWidCommVar));
			// calculate the Sale commission variance
<span class="nc" id="L529">			bean.setNetWidCommRate(FormatNumber.formatNumber(defWidCommRate</span>
					+ currentWidCommVar));

<span class="nc" id="L532">			double defDepCommRate = rss.getDouble(&quot;agt_deposit_comm&quot;);</span>
<span class="nc" id="L533">			bean.setDefDepCommRate(FormatNumber.formatNumber(defDepCommRate));</span>
			// retrieve the Deposit commission variance
<span class="nc" id="L535">			double currentDepCommVar = 0.0;// rss.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L536">			bean.setCurrentDepCommVar(FormatNumber</span>
					.formatNumber(currentDepCommVar));
			// calculate the Deposit commission variance
<span class="nc" id="L539">			bean.setNetDepCommRate(FormatNumber.formatNumber(defDepCommRate</span>
					+ currentDepCommVar));
			
<span class="nc" id="L542">			double defNetGCommRate = rss.getDouble(&quot;agt_net_gaming_comm&quot;);</span>
<span class="nc" id="L543">			bean.setDefNetGCommRate(FormatNumber.formatNumber(defNetGCommRate));</span>
			// retrieve the Net Gaming commission variance
<span class="nc" id="L545">			double currentNetGCommVar = 0.0;// rss.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L546">			bean.setCurrentNetGCommVar(FormatNumber</span>
					.formatNumber(currentNetGCommVar));
			// calculate the Net Gaming commission variance
<span class="nc" id="L549">			bean.setNetNetGCommRate(FormatNumber.formatNumber(defNetGCommRate</span>
					+ currentNetGCommVar));

<span class="nc" id="L552">			salePwtCommVarList.add(bean);</span>
<span class="nc" id="L553">		}</span>

<span class="nc" id="L555">		return salePwtCommVarList;</span>
	
	}
	
	public List&lt;SalePwtCommVarBean&gt; getSalePwtGameDetailsIW(String query, Connection conn, String gamestatus) throws SQLException {
<span class="nc" id="L560">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L561">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L562">		Connection connection = conn;</span>
<span class="nc" id="L563">		PreparedStatement pstmt = connection.prepareStatement(query);</span>
<span class="nc" id="L564">		ResultSet rss = pstmt.executeQuery();</span>
		//System.out.println(&quot; game name query === &quot; + pstmt);
<span class="nc bnc" id="L566" title="All 2 branches missed.">		while (rss.next()) {</span>
<span class="nc" id="L567">			bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L568">			String gamename = rss.getInt(&quot;game_id&quot;) + &quot;-&quot; + rss.getString(&quot;game_disp_name&quot;);</span>
<span class="nc" id="L569">			bean.setGameName(gamename);</span>

			// retrieve the default Sale commission variance
<span class="nc" id="L572">			double defSaleCommRate = rss.getDouble(&quot;agent_sale_comm_rate&quot;);</span>
<span class="nc" id="L573">			bean.setDefSaleCommRate(FormatNumber.formatNumber(defSaleCommRate));</span>
			// retrieve the Sale commission variance
<span class="nc" id="L575">			double currentSaleCommVar = 0.0;// rss.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L576">			bean.setCurrentSaleCommVar(FormatNumber.formatNumber(currentSaleCommVar));</span>
			// calculate the Sale commission variance
<span class="nc" id="L578">			bean.setNetSaleCommRate(FormatNumber.formatNumber(defSaleCommRate + currentSaleCommVar));</span>

<span class="nc" id="L580">			double defPwtCommRate = rss.getDouble(&quot;agent_pwt_comm_rate&quot;);</span>
<span class="nc" id="L581">			bean.setDefPwtCommRate(FormatNumber.formatNumber(defPwtCommRate));</span>
			// retrieve the PWT commission variance
<span class="nc" id="L583">			double currentPwtCommVar = 0.0;// rss.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L584">			bean.setCurrentPwtCommVar(FormatNumber.formatNumber(currentPwtCommVar));</span>
			// calculate the PWT commission variance
<span class="nc" id="L586">			bean.setNetPwtCommRate(FormatNumber.formatNumber(defPwtCommRate + currentPwtCommVar));</span>

<span class="nc" id="L588">			salePwtCommVarList.add(bean);</span>
<span class="nc" id="L589">		}</span>
<span class="nc" id="L590">		return salePwtCommVarList;</span>
	}
	
	// by mukesh for virtual sport for agent
	public List&lt;SalePwtCommVarBean&gt; getSalePwtGameDetailsVS(String query, Connection conn, String gamestatus) throws SQLException {
<span class="nc" id="L595">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L596">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L597">		Connection connection = conn;</span>
<span class="nc" id="L598">		PreparedStatement pstmt = connection.prepareStatement(query);</span>
<span class="nc" id="L599">		ResultSet rss = pstmt.executeQuery();</span>
		//System.out.println(&quot; game name query === &quot; + pstmt);
<span class="nc bnc" id="L601" title="All 2 branches missed.">		while (rss.next()) {</span>
<span class="nc" id="L602">			bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L603">			String gamename = rss.getInt(&quot;game_id&quot;) + &quot;-&quot; + rss.getString(&quot;game_disp_name&quot;);</span>
<span class="nc" id="L604">			bean.setGameName(gamename);</span>

			// retrieve the default Sale commission variance
<span class="nc" id="L607">			double defSaleCommRate = rss.getDouble(&quot;agent_sale_comm_rate&quot;);</span>
<span class="nc" id="L608">			bean.setDefSaleCommRate(FormatNumber.formatNumber(defSaleCommRate));</span>
			// retrieve the Sale commission variance
<span class="nc" id="L610">			double currentSaleCommVar = 0.0;// rss.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L611">			bean.setCurrentSaleCommVar(FormatNumber.formatNumber(currentSaleCommVar));</span>
			// calculate the Sale commission variance
<span class="nc" id="L613">			bean.setNetSaleCommRate(FormatNumber.formatNumber(defSaleCommRate + currentSaleCommVar));</span>

<span class="nc" id="L615">			double defPwtCommRate = rss.getDouble(&quot;agent_pwt_comm_rate&quot;);</span>
<span class="nc" id="L616">			bean.setDefPwtCommRate(FormatNumber.formatNumber(defPwtCommRate));</span>
			// retrieve the PWT commission variance
<span class="nc" id="L618">			double currentPwtCommVar = 0.0;// rss.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L619">			bean.setCurrentPwtCommVar(FormatNumber.formatNumber(currentPwtCommVar));</span>
			// calculate the PWT commission variance
<span class="nc" id="L621">			bean.setNetPwtCommRate(FormatNumber.formatNumber(defPwtCommRate + currentPwtCommVar));</span>

<span class="nc" id="L623">			salePwtCommVarList.add(bean);</span>
<span class="nc" id="L624">		}</span>
<span class="nc" id="L625">		return salePwtCommVarList;</span>
	}
	
	public Map&lt;String, String&gt; getServiceList() {
<span class="nc" id="L629">		Map&lt;String, String&gt; serviceNameMap = new TreeMap&lt;String, String&gt;();</span>
<span class="nc" id="L630">		con = DBConnect.getConnection();</span>
		try {
<span class="nc" id="L632">			pstmt = con</span>
					.prepareStatement(&quot;Select * from st_lms_service_master where service_code &lt;&gt;'MGMT' and status='ACTIVE'&quot;);
<span class="nc" id="L634">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L635" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L636">				serviceNameMap.put(rs.getString(&quot;service_code&quot;), rs</span>
						.getString(&quot;service_display_name&quot;));
			}
<span class="nc" id="L639">			rs.close();</span>
<span class="nc" id="L640">		} catch (SQLException e) {</span>
<span class="nc" id="L641">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L643">			try {</span>
<span class="nc bnc" id="L644" title="All 6 branches missed.">				if (pstmt != null) {</span>
<span class="nc" id="L645">					pstmt.close();</span>
				}
<span class="nc bnc" id="L647" title="All 12 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L648">					con.close();</span>
				}
<span class="nc" id="L650">			} catch (SQLException e) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L652">				e.printStackTrace();</span>
<span class="nc" id="L653">			}</span>
<span class="nc" id="L654">		}</span>

<span class="nc" id="L656">		System.out.println(&quot;service Name map  ===== &quot; + serviceNameMap);</span>
<span class="nc" id="L657">		return serviceNameMap;</span>
	}

	public List&lt;SalePwtCommVarBean&gt; salePwtCommVarList(String agentOrgName,
			String gamestatus, String orgTypeCode) {
<span class="nc" id="L662">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L663">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L664">		con = DBConnect.getConnection();</span>
	
	

		try {
<span class="nc" id="L669">			int orgId = Integer.parseInt(agentOrgName);</span>
<span class="nc" id="L670">			String sqlQuery = &quot;select * from st_se_bo_agent_sale_pwt_comm_variance aa, st_se_game_master gm where agent_org_id=&quot;</span>
								+ orgId+&quot; and gm.game_id=aa.game_id &quot;;
			
<span class="nc bnc" id="L673" title="All 2 branches missed.">			if (!&quot;ALL&quot;.equalsIgnoreCase(gamestatus)) {</span>
<span class="nc" id="L674">				sqlQuery = sqlQuery + &quot;and gm.game_status='&quot; + gamestatus + &quot;'&quot;;</span>
			}
<span class="nc" id="L676">			System.out.println(&quot;agent organization name is ==== &quot; + agentOrgName</span>
					+ &quot;\n query = &quot; + sqlQuery);
			
			
<span class="nc" id="L680">			Statement stmt = con</span>
					.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE,
							ResultSet.CONCUR_READ_ONLY);
<span class="nc" id="L683">			rs = stmt.executeQuery(sqlQuery);</span>
			// Point to the last row in resultset.
<span class="nc" id="L685">			rs.last();</span>
			// Get the row position which is also the number of rows in the
			// resultset.
<span class="nc" id="L688">			int rowcount = rs.getRow();</span>
<span class="nc" id="L689">			System.out.println(&quot;row count value is ======== &quot; + rowcount);</span>
<span class="nc" id="L690">			rs.beforeFirst();</span>
<span class="nc bnc" id="L691" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L692">				bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L693">				System.out.println(&quot;inside if row count 11111111111111&quot;);</span>
				// get the game name
<span class="nc" id="L695">				int gameId = rs.getInt(&quot;game_id&quot;);</span>
<span class="nc bnc" id="L696" title="All 2 branches missed.">				if (gameId &lt;= 0) {</span>
<span class="nc bnc" id="L697" title="All 2 branches missed.">					if (gameId == 0) {</span>
<span class="nc" id="L698">						bean.setGameName(&quot;Applicable on All Existing Games&quot;);</span>
<span class="nc bnc" id="L699" title="All 2 branches missed.">					} else if (gameId == -1) {</span>
<span class="nc" id="L700">						bean</span>
								.setGameName(&quot;Applicable on All Existing and New Games&quot;);
					} else {
<span class="nc" id="L703">						bean.setGameName(&quot;Errror occured&quot;);</span>
					}
					// retrieve the default Sale commission variance
<span class="nc" id="L706">					bean.setDefSaleCommRate(null);</span>
					// retrieve the Sale commission variance
<span class="nc" id="L708">					double currentSaleCommVar = rs</span>
							.getDouble(&quot;sale_comm_variance&quot;);
<span class="nc" id="L710">					bean.setCurrentSaleCommVar(FormatNumber</span>
							.formatNumber(currentSaleCommVar));
					// calculate the Sale commission variance
<span class="nc" id="L713">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L715">					bean.setDefPwtCommRate(null);</span>
					// retrieve the PWT commission variance
<span class="nc" id="L717">					double currentPwtCommVar = rs</span>
							.getDouble(&quot;pwt_comm_variance&quot;);
<span class="nc" id="L719">					bean.setCurrentPwtCommVar(FormatNumber</span>
							.formatNumber(currentPwtCommVar));
					// calculate the PWT commission variance
<span class="nc" id="L722">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L724">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L725">					System.out.println(&quot;inside if row count 2222222222&quot;);</span>
<span class="nc" id="L726">				} else {</span>
<span class="nc" id="L727">					System.out</span>
							.println(&quot;inside else rowcount 111111111111111111&quot;);
<span class="nc" id="L729">					bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L730">					bean.setGameName(rs.getInt(&quot;game_nbr&quot;) + &quot;-&quot;</span>
							+ rs.getString(&quot;game_name&quot;));

					// retrieve the default Sale commission variance
<span class="nc" id="L734">					double defSaleCommRate = rs</span>
							.getDouble(&quot;default_sale_comm_rate&quot;);
<span class="nc" id="L736">					bean.setDefSaleCommRate(FormatNumber</span>
							.formatNumber(defSaleCommRate));
					// retrieve the Sale commission variance
<span class="nc" id="L739">					double currentSaleCommVar = rs</span>
							.getDouble(&quot;sale_comm_variance&quot;);
<span class="nc" id="L741">					bean.setCurrentSaleCommVar(FormatNumber</span>
							.formatNumber(currentSaleCommVar));
					// calculate the Sale commission variance
<span class="nc" id="L744">					bean</span>
							.setNetSaleCommRate(FormatNumber
									.formatNumber(defSaleCommRate
											+ currentSaleCommVar));

<span class="nc" id="L749">					double defPwtCommRate = rs</span>
							.getDouble(&quot;default_pwt_comm_rate&quot;);
<span class="nc" id="L751">					bean.setDefPwtCommRate(FormatNumber</span>
							.formatNumber(defPwtCommRate));
					// retrieve the PWT commission variance
<span class="nc" id="L754">					double currentPwtCommVar = rs</span>
							.getDouble(&quot;pwt_comm_variance&quot;);
<span class="nc" id="L756">					bean.setCurrentPwtCommVar(FormatNumber</span>
							.formatNumber(currentPwtCommVar));
					// calculate the PWT commission variance
<span class="nc" id="L759">					bean.setNetPwtCommRate(FormatNumber</span>
							.formatNumber(defPwtCommRate + currentPwtCommVar));

<span class="nc" id="L762">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L763">					System.out.println(&quot;inside else row count 2222222222&quot;);</span>
				}
<span class="nc" id="L765">			}</span>
<span class="nc" id="L766">			rs.close();</span>
<span class="nc" id="L767">			stmt.close();</span>

			// now get the details of games from st_se_game_master thats
			// commission variance are not set
<span class="nc" id="L771">			String query = &quot;select game_id, game_nbr, game_name, agent_sale_comm_rate, agent_pwt_comm_rate, govt_comm_rate, prize_payout_ratio from st_se_game_master where game_id NOT IN (select game_id from st_se_bo_agent_sale_pwt_comm_variance where agent_org_id=&quot;</span>
					+ orgId + &quot;)&quot;;
<span class="nc bnc" id="L773" title="All 2 branches missed.">			if (!&quot;ALL&quot;.equalsIgnoreCase(gamestatus)) {</span>
<span class="nc" id="L774">				query = query + &quot;and game_status='&quot; + gamestatus + &quot;'&quot;;</span>
			}
<span class="nc" id="L776">			System.out.println(&quot;agent  query = &quot; + query);</span>
<span class="nc" id="L777">			List&lt;SalePwtCommVarBean&gt; remList = getSalePwtGameDetails(query,</span>
					con, gamestatus);
<span class="nc bnc" id="L779" title="All 2 branches missed.">			if (remList.size() &gt; 0) {</span>
<span class="nc" id="L780">				salePwtCommVarList.addAll(remList);</span>
			}

<span class="nc" id="L783">		} catch (SQLException e) {</span>
<span class="nc" id="L784">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L786">			try {</span>
<span class="nc bnc" id="L787" title="All 6 branches missed.">				if (pstmt != null) {</span>
<span class="nc" id="L788">					pstmt.close();</span>
				}
<span class="nc bnc" id="L790" title="All 12 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L791">					con.close();</span>
				}
<span class="nc" id="L793">			} catch (SQLException e) {</span>
<span class="nc" id="L794">				e.printStackTrace();</span>
<span class="nc" id="L795">			}</span>
<span class="nc" id="L796">		}</span>

<span class="nc" id="L798">		System.out.println(&quot;name list ===== &quot; + salePwtCommVarList);</span>
<span class="nc" id="L799">		return salePwtCommVarList;</span>

	}

	//
	public List&lt;SalePwtCommVarBean&gt; salePwtCommVarListForDg(
			String agentOrgName, String gamestatus, String orgTypeCode) {
<span class="nc" id="L806">		System.out.println(&quot;salePwtCommVarListForDg called&quot;);</span>
<span class="nc" id="L807">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L808">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L809">		con = DBConnect.getConnection();</span>
/*		String sqlQuery = &quot;select * from st_dg_bo_agent_sale_pwt_comm_variance aa, st_dg_game_master gm where agent_org_id=(select organization_id from st_lms_organization_master where organization_type='&quot;
				+ orgTypeCode
				+ &quot;' and name='&quot;
				+ agentOrgName.trim()
				+ &quot;') and gm.game_id=aa.game_id &quot;;*/
		/*
		 * if (!(&quot;ALL&quot;.equalsIgnoreCase(gamestatus))) sqlQuery = sqlQuery + &quot;and
		 * gm.game_status='&quot; + gamestatus + &quot;'&quot;;
		 */
		
		

		try {
<span class="nc" id="L823">			int agetOrgId = Integer.parseInt(agentOrgName);</span>
			
<span class="nc" id="L825">			String sqlQuery = &quot; select * from st_dg_bo_agent_sale_pwt_comm_variance aa, st_dg_game_master gm where agent_org_id=&quot;+agetOrgId</span>
			+&quot; and gm.game_id=aa.game_id and gm.game_id not in(select game_id from st_dg_game_master where closing_time &lt; now())&quot;;
<span class="nc" id="L827">			System.out.println(&quot;agent organization name is ==== &quot; + agetOrgId+ &quot;\n query = &quot; + sqlQuery);	</span>
<span class="nc" id="L828">			Statement stmt = con</span>
					.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE,
							ResultSet.CONCUR_READ_ONLY);
<span class="nc" id="L831">			rs = stmt.executeQuery(sqlQuery);</span>
			// Point to the last row in resultset.
<span class="nc" id="L833">			rs.last();</span>
			// Get the row position which is also the number of rows in the
			// resultset.
<span class="nc" id="L836">			int rowcount = rs.getRow();</span>
<span class="nc" id="L837">			System.out.println(&quot;row count value is ======== &quot; + rowcount);</span>
<span class="nc" id="L838">			rs.beforeFirst();</span>
<span class="nc bnc" id="L839" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L840">				bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L841">				System.out.println(&quot;inside if row count 11111111111111&quot;);</span>
				// get the game name
<span class="nc" id="L843">				int gameId = rs.getInt(&quot;game_id&quot;);</span>
<span class="nc bnc" id="L844" title="All 2 branches missed.">				if (gameId &lt;= 0) {</span>
<span class="nc bnc" id="L845" title="All 2 branches missed.">					if (gameId == 0) {</span>
<span class="nc" id="L846">						bean.setGameName(&quot;Applicable on All Existing Games&quot;);</span>
<span class="nc bnc" id="L847" title="All 2 branches missed.">					} else if (gameId == -1) {</span>
<span class="nc" id="L848">						bean</span>
								.setGameName(&quot;Applicable on All Existing and New Games&quot;);
					} else {
<span class="nc" id="L851">						bean.setGameName(&quot;Errror occured&quot;);</span>
					}
					// retrieve the default Sale commission variance
<span class="nc" id="L854">					bean.setDefSaleCommRate(null);</span>
					// retrieve the Sale commission variance
<span class="nc" id="L856">					double currentSaleCommVar = rs</span>
							.getDouble(&quot;sale_comm_variance&quot;);
<span class="nc" id="L858">					bean.setCurrentSaleCommVar(FormatNumber</span>
							.formatNumber(currentSaleCommVar));
					// calculate the Sale commission variance
<span class="nc" id="L861">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L863">					bean.setDefPwtCommRate(null);</span>
					// retrieve the PWT commission variance
<span class="nc" id="L865">					double currentPwtCommVar = rs</span>
							.getDouble(&quot;pwt_comm_variance&quot;);
<span class="nc" id="L867">					bean.setCurrentPwtCommVar(FormatNumber</span>
							.formatNumber(currentPwtCommVar));
					// calculate the PWT commission variance
<span class="nc" id="L870">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L872">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L873">					System.out.println(&quot;inside if row count 2222222222&quot;);</span>
<span class="nc" id="L874">				} else {</span>
<span class="nc" id="L875">					System.out</span>
							.println(&quot;inside else rowcount 111111111111111111&quot;);
<span class="nc" id="L877">					bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L878">					bean.setGameName(rs.getInt(&quot;game_id&quot;) + &quot;-&quot;</span>
							+ rs.getString(&quot;game_name&quot;));

					// retrieve the default Sale commission variance
<span class="nc" id="L882">					double defSaleCommRate = rs</span>
							.getDouble(&quot;default_sale_comm_rate&quot;);
<span class="nc" id="L884">					bean.setDefSaleCommRate(FormatNumber</span>
							.formatNumber(defSaleCommRate));
					// retrieve the Sale commission variance
<span class="nc" id="L887">					double currentSaleCommVar = rs</span>
							.getDouble(&quot;sale_comm_variance&quot;);
<span class="nc" id="L889">					bean.setCurrentSaleCommVar(FormatNumber</span>
							.formatNumber(currentSaleCommVar));
					// calculate the Sale commission variance
<span class="nc" id="L892">					bean</span>
							.setNetSaleCommRate(FormatNumber
									.formatNumber(defSaleCommRate
											+ currentSaleCommVar));

<span class="nc" id="L897">					double defPwtCommRate = rs</span>
							.getDouble(&quot;default_pwt_comm_rate&quot;);
<span class="nc" id="L899">					bean.setDefPwtCommRate(FormatNumber</span>
							.formatNumber(defPwtCommRate));
					// retrieve the PWT commission variance
<span class="nc" id="L902">					double currentPwtCommVar = rs</span>
							.getDouble(&quot;pwt_comm_variance&quot;);
<span class="nc" id="L904">					bean.setCurrentPwtCommVar(FormatNumber</span>
							.formatNumber(currentPwtCommVar));
					// calculate the PWT commission variance
<span class="nc" id="L907">					bean.setNetPwtCommRate(FormatNumber</span>
							.formatNumber(defPwtCommRate + currentPwtCommVar));

<span class="nc" id="L910">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L911">					System.out.println(&quot;inside else row count 2222222222&quot;);</span>
				}
<span class="nc" id="L913">			}</span>
<span class="nc" id="L914">			rs.close();</span>
<span class="nc" id="L915">			stmt.close();</span>

			// now get the details of games from st_dg_game_master thats
			// commission variance are not set
<span class="nc" id="L919">			String query = &quot;select game_id, game_nbr, game_name, agent_sale_comm_rate, agent_pwt_comm_rate, govt_comm, prize_payout_ratio from st_dg_game_master where game_id NOT IN (select game_id from st_dg_bo_agent_sale_pwt_comm_variance where agent_org_id=&quot; +</span>
					&quot;		 &quot;+agetOrgId+ &quot; union select game_id from st_dg_game_master where closing_time &lt; now())&quot;;
			/*
			 * if (!(&quot;ALL&quot;.equalsIgnoreCase(gamestatus))) query = query + &quot;and
			 * game_status='&quot; + gamestatus + &quot;'&quot;;
			 */
<span class="nc" id="L925">			System.out.println(&quot;agent  query = &quot; + query);</span>
<span class="nc" id="L926">			List&lt;SalePwtCommVarBean&gt; remList = getSalePwtGameDetailsDg(query,</span>
					con, gamestatus);
<span class="nc bnc" id="L928" title="All 2 branches missed.">			if (remList.size() &gt; 0) {</span>
<span class="nc" id="L929">				salePwtCommVarList.addAll(remList);</span>
			}

<span class="nc" id="L932">		} catch (SQLException e) {</span>
<span class="nc" id="L933">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L935">			try {</span>
<span class="nc bnc" id="L936" title="All 6 branches missed.">				if (pstmt != null) {</span>
<span class="nc" id="L937">					pstmt.close();</span>
				}
<span class="nc bnc" id="L939" title="All 12 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L940">					con.close();</span>
				}
<span class="nc" id="L942">			} catch (SQLException e) {</span>
<span class="nc" id="L943">				e.printStackTrace();</span>
<span class="nc" id="L944">			}</span>
<span class="nc" id="L945">		}</span>

<span class="nc" id="L947">		System.out.println(&quot;name list ===== &quot; + salePwtCommVarList);</span>
<span class="nc" id="L948">		return salePwtCommVarList;</span>

	}
	
	public List&lt;SalePwtCommVarBean&gt; saleCommVarListForCS(
			String agentOrgName, String prodStatus, String orgTypeCode) {
<span class="nc" id="L954">		System.out.println(&quot;Agent saleCommVarListForCS called&quot;);</span>
<span class="nc" id="L955">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L956">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L957">		con = DBConnect.getConnection();</span>
		

		try {
<span class="nc" id="L961">			int orgId =Integer.parseInt(agentOrgName);</span>
			
			
<span class="nc" id="L964">			String sqlQuery = &quot;select * from st_cs_bo_agent_sale_comm_variance aa, st_cs_product_master pm, st_cs_operator_master com where agent_org_id=&quot;</span>
								+ orgId+&quot; and pm.product_id=aa.product_id  and pm.status='ACTIVE' and pm.operator_code = com.operator_code&quot;;
<span class="nc" id="L966">		logger.debug(&quot;agent organization name is ==== &quot; + agentOrgName</span>
				+ &quot;\n query = &quot; + sqlQuery);
			
<span class="nc" id="L969">			Statement stmt = con</span>
					.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE,
							ResultSet.CONCUR_READ_ONLY);
<span class="nc" id="L972">			rs = stmt.executeQuery(sqlQuery);</span>
			// Point to the last row in resultset.
<span class="nc" id="L974">			rs.last();</span>
			// Get the row position which is also the number of rows in the
			// resultset.
<span class="nc" id="L977">			int rowcount = rs.getRow();</span>
<span class="nc" id="L978">			logger.debug(&quot;row count value is ======== &quot; + rowcount);</span>
<span class="nc" id="L979">			rs.beforeFirst();</span>
<span class="nc bnc" id="L980" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L981">				bean = new SalePwtCommVarBean();</span>
				// get the game name
<span class="nc" id="L983">				int gameId = rs.getInt(&quot;product_id&quot;);</span>
<span class="nc bnc" id="L984" title="All 2 branches missed.">				if (gameId &lt;= 0) {</span>
<span class="nc bnc" id="L985" title="All 2 branches missed.">					if (gameId == 0) {</span>
<span class="nc" id="L986">						bean.setGameName(&quot;Applicable on All Existing Games&quot;);</span>
<span class="nc bnc" id="L987" title="All 2 branches missed.">					} else if (gameId == -1) {</span>
<span class="nc" id="L988">						bean</span>
								.setGameName(&quot;Applicable on All Existing and New Games&quot;);
					} else {
<span class="nc" id="L991">						bean.setGameName(&quot;Errror occured&quot;);</span>
					}
					// retrieve the default Sale commission variance
<span class="nc" id="L994">					bean.setDefSaleCommRate(null);</span>
					// retrieve the Sale commission variance
<span class="nc" id="L996">					double currentSaleCommVar = rs</span>
							.getDouble(&quot;sale_comm_variance&quot;);
<span class="nc" id="L998">					bean.setCurrentSaleCommVar(FormatNumber</span>
							.formatNumber(currentSaleCommVar));
					// calculate the Sale commission variance
<span class="nc" id="L1001">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L1003">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L1004">				} else {</span>
<span class="nc" id="L1005">					bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L1006">					bean.setGameName(rs.getInt(&quot;product_id&quot;) + &quot;_&quot;</span>
							+ rs.getString(&quot;product_code&quot;)+ &quot;_&quot; + rs.getString(&quot;operator_name&quot;)+&quot;_&quot;+rs.getDouble(&quot;denomination&quot;));

					// retrieve the default Sale commission variance
<span class="nc" id="L1010">					double defSaleCommRate = rs</span>
							.getDouble(&quot;default_sale_comm_rate&quot;);
<span class="nc" id="L1012">					bean.setDefSaleCommRate(FormatNumber</span>
							.formatNumber(defSaleCommRate));
					// retrieve the Sale commission variance
<span class="nc" id="L1015">					double currentSaleCommVar = rs</span>
							.getDouble(&quot;sale_comm_variance&quot;);
<span class="nc" id="L1017">					bean.setCurrentSaleCommVar(FormatNumber</span>
							.formatNumber(currentSaleCommVar));
					// calculate the Sale commission variance
<span class="nc" id="L1020">					bean</span>
							.setNetSaleCommRate(FormatNumber
									.formatNumber(defSaleCommRate
											+ currentSaleCommVar));
<span class="nc" id="L1024">					salePwtCommVarList.add(bean);</span>
				}
<span class="nc" id="L1026">			}</span>
<span class="nc" id="L1027">			rs.close();</span>
<span class="nc" id="L1028">			stmt.close();</span>

			// now get the details of games from st_dg_game_master thats
			// commission variance are not set
<span class="nc" id="L1032">			String query = &quot;select product_id, product_code, operator_name, denomination, agent_comm, good_cause_comm from st_cs_product_master pm, st_cs_operator_master com where pm.status='ACTIVE' and pm.operator_code = com.operator_code and pm.product_id NOT IN (select product_id from st_cs_bo_agent_sale_comm_variance where agent_org_id=&quot;</span>
					+ orgId + &quot;)&quot;;
<span class="nc" id="L1034">			logger.debug(&quot;agent  query = &quot; + query);</span>
<span class="nc" id="L1035">			List&lt;SalePwtCommVarBean&gt; remList = getSaleProdDetailsCS(query,</span>
					con, prodStatus);
<span class="nc bnc" id="L1037" title="All 2 branches missed.">			if (remList.size() &gt; 0) {</span>
<span class="nc" id="L1038">				salePwtCommVarList.addAll(remList);</span>
			}

<span class="nc" id="L1041">		} catch (SQLException e) {</span>
<span class="nc" id="L1042">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1044">			try {</span>
<span class="nc bnc" id="L1045" title="All 6 branches missed.">				if (pstmt != null) {</span>
<span class="nc" id="L1046">					pstmt.close();</span>
				}
<span class="nc bnc" id="L1048" title="All 12 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L1049">					con.close();</span>
				}
<span class="nc" id="L1051">			} catch (SQLException e) {</span>
<span class="nc" id="L1052">				e.printStackTrace();</span>
<span class="nc" id="L1053">			}</span>
<span class="nc" id="L1054">		}</span>

<span class="nc" id="L1056">		System.out.println(&quot;name list ===== &quot; + salePwtCommVarList);</span>
<span class="nc" id="L1057">		return salePwtCommVarList;</span>

	}
	
	public List&lt;SalePwtCommVarBean&gt; salePwtCommVarListOLA(String agentOrgName, String walletStatus, String orgTypeCode){

<span class="nc" id="L1063">		System.out.println(&quot;salePwtCommVarListForOLA called&quot;);</span>
<span class="nc" id="L1064">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L1065">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L1066">		con = DBConnect.getConnection();</span>
	

		try {
<span class="nc" id="L1070">			int orgId =Integer.parseInt(agentOrgName);</span>
			
<span class="nc" id="L1072">			String sqlQuery = &quot;select * from st_ola_bo_agent_comm_variance aa, st_ola_wallet_master wm where agent_org_id=&quot;</span>
								+ orgId+&quot; and wm.wallet_id=aa.wallet_id &quot;;
		/*
		 * if (!(&quot;ALL&quot;.equalsIgnoreCase(gamestatus))) sqlQuery = sqlQuery + &quot;and
		 * gm.game_status='&quot; + gamestatus + &quot;'&quot;;
		 */
<span class="nc" id="L1078">		logger.debug(&quot;agent organization name is ==== &quot; + agentOrgName</span>
				+ &quot;\n query = &quot; + sqlQuery);
			
<span class="nc" id="L1081">			Statement stmt = con</span>
					.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE,
							ResultSet.CONCUR_READ_ONLY);
<span class="nc" id="L1084">			rs = stmt.executeQuery(sqlQuery);</span>
			// Point to the last row in resultset.
			//rs.last();
			// Get the row position which is also the number of rows in the
			// resultset.
			//int rowcount = rs.getRow();
			//logger.debug(&quot;row count value is ======== &quot; + rowcount);
			//rs.beforeFirst();
<span class="nc bnc" id="L1092" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1093">				bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L1094">				logger.debug(&quot;inside if row count 11111111111111&quot;);</span>
				// get the game name
<span class="nc" id="L1096">				int walletId = rs.getInt(&quot;wallet_id&quot;);</span>
<span class="nc bnc" id="L1097" title="All 2 branches missed.">				if (walletId &lt;= 0) {</span>
<span class="nc bnc" id="L1098" title="All 2 branches missed.">					if (walletId == 0) {</span>
<span class="nc" id="L1099">						bean.setGameName(&quot;Applicable on All Existing Wallets&quot;);</span>
<span class="nc bnc" id="L1100" title="All 2 branches missed.">					} else if (walletId == -1) {</span>
<span class="nc" id="L1101">						bean</span>
								.setGameName(&quot;Applicable on All Existing and New Wallets&quot;);
					} else {
<span class="nc" id="L1104">						bean.setGameName(&quot;Errror occured&quot;);</span>
					}
					// retrieve the default withdrawal commission variance
<span class="nc" id="L1107">					bean.setDefWidCommRate(null);</span>
					// retrieve the withdrawal commission variance
<span class="nc" id="L1109">					double currentWidCommVar = rs</span>
							.getDouble(&quot;withdrawl_comm_variance&quot;);
<span class="nc" id="L1111">					bean.setCurrentWidCommVar(FormatNumber</span>
							.formatNumber(currentWidCommVar));
					// calculate the withdrawal commission variance
<span class="nc" id="L1114">					bean.setNetWidCommRate(null);</span>

<span class="nc" id="L1116">					bean.setDefDepCommRate(null);</span>
					// retrieve the Deposit commission variance
<span class="nc" id="L1118">					double currentDepCommVar = rs</span>
							.getDouble(&quot;deposit_comm_variance&quot;);
<span class="nc" id="L1120">					bean.setCurrentWidCommVar(FormatNumber</span>
							.formatNumber(currentDepCommVar));
					// calculate the Deposit commission variance
<span class="nc" id="L1123">					bean.setNetSaleCommRate(null);</span>
					
<span class="nc" id="L1125">					bean.setDefNetGCommRate(null);</span>
					// retrieve the Net Gaming commission variance
<span class="nc" id="L1127">					double currentNetGCommVar = rs</span>
							.getDouble(&quot;net_gaming_comm_variance&quot;);
<span class="nc" id="L1129">					bean.setCurrentWidCommVar(FormatNumber</span>
							.formatNumber(currentNetGCommVar));
					// calculate the Net Gaming commission variance
<span class="nc" id="L1132">					bean.setNetNetGCommRate(null);</span>

<span class="nc" id="L1134">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L1135">					logger.debug(&quot;inside if row count 2222222222&quot;);</span>
<span class="nc" id="L1136">				} else {</span>
<span class="nc" id="L1137">					logger.debug(&quot;inside else rowcount 111111111111111111&quot;);</span>
<span class="nc" id="L1138">					bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L1139">					bean.setGameName(rs.getInt(&quot;wallet_id&quot;) + &quot;-&quot;</span>
							+ rs.getString(&quot;wallet_name&quot;));

					// retrieve the default Withdrawal commission variance
<span class="nc" id="L1143">					double defWidCommRate = rs</span>
							.getDouble(&quot;default_withdrawl_comm_rate&quot;);
<span class="nc" id="L1145">					bean.setDefWidCommRate(FormatNumber</span>
							.formatNumber(defWidCommRate));
					// retrieve the Withdrawal commission variance
<span class="nc" id="L1148">					double currentWidCommVar = rs</span>
							.getDouble(&quot;withdrawl_comm_variance&quot;);
<span class="nc" id="L1150">					bean.setCurrentWidCommVar(FormatNumber</span>
							.formatNumber(currentWidCommVar));
					// calculate the Withdrawal commission variance
<span class="nc" id="L1153">					bean</span>
							.setNetWidCommRate(FormatNumber
									.formatNumber(defWidCommRate
											+ currentWidCommVar));

<span class="nc" id="L1158">					double defDepCommRate = rs</span>
							.getDouble(&quot;default_deposit_comm_rate&quot;);
<span class="nc" id="L1160">					bean.setDefDepCommRate(FormatNumber</span>
							.formatNumber(defDepCommRate));
					// retrieve the Deposit commission variance
<span class="nc" id="L1163">					double currentDepCommVar = rs</span>
							.getDouble(&quot;deposit_comm_variance&quot;);
<span class="nc" id="L1165">					bean.setCurrentDepCommVar(FormatNumber</span>
							.formatNumber(currentDepCommVar));
					// calculate the Deposit commission variance
<span class="nc" id="L1168">					bean.setNetDepCommRate(FormatNumber</span>
							.formatNumber(defDepCommRate + currentDepCommVar));
					
<span class="nc" id="L1171">					double defNetGCommRate = rs</span>
					.getDouble(&quot;default_net_gaming_comm_rate&quot;);
<span class="nc" id="L1173">					bean.setDefNetGCommRate(FormatNumber</span>
						.formatNumber(defNetGCommRate));
					// retrieve the Net Gaming commission variance
<span class="nc" id="L1176">					double currentNetGCommVar = rs</span>
							.getDouble(&quot;net_gaming_comm_variance&quot;);
<span class="nc" id="L1178">					bean.setCurrentNetGCommVar(FormatNumber</span>
							.formatNumber(currentNetGCommVar));
					// calculate the Net Gaming commission variance
<span class="nc" id="L1181">					bean.setNetNetGCommRate(FormatNumber</span>
							.formatNumber(defNetGCommRate + currentNetGCommVar));

<span class="nc" id="L1184">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L1185">					logger.debug(&quot;inside else row count 2222222222&quot;);</span>
				}
<span class="nc" id="L1187">			}</span>
<span class="nc" id="L1188">			rs.close();</span>
<span class="nc" id="L1189">			stmt.close();</span>

			// now get the details of games from st_dg_game_master thats
			// commission variance are not set
<span class="nc" id="L1193">			String query = &quot;select wallet_id, wallet_name, agt_withdrawl_comm, agt_deposit_comm, agt_net_gaming_comm from st_ola_wallet_master where wallet_id NOT IN (select wallet_id from st_ola_bo_agent_comm_variance where agent_org_id=&quot;</span>
					+orgId + &quot; )&quot;;
			/*
			 * if (!(&quot;ALL&quot;.equalsIgnoreCase(gamestatus))) query = query + &quot;and
			 * game_status='&quot; + gamestatus + &quot;'&quot;;
			 */
<span class="nc" id="L1199">			System.out.println(&quot;agent  query = &quot; + query);</span>
<span class="nc" id="L1200">			List&lt;SalePwtCommVarBean&gt; remList = getWidDepNetgameDetailsOLA(query,</span>
					con, walletStatus);
<span class="nc bnc" id="L1202" title="All 2 branches missed.">			if (remList.size() &gt; 0) {</span>
<span class="nc" id="L1203">				salePwtCommVarList.addAll(remList);</span>
			}

<span class="nc" id="L1206">		} catch (SQLException e) {</span>
<span class="nc" id="L1207">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1209">			try {</span>
<span class="nc bnc" id="L1210" title="All 6 branches missed.">				if (pstmt != null) {</span>
<span class="nc" id="L1211">					pstmt.close();</span>
				}
<span class="nc bnc" id="L1213" title="All 12 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L1214">					con.close();</span>
				}
<span class="nc" id="L1216">			} catch (SQLException e) {</span>
<span class="nc" id="L1217">				e.printStackTrace();</span>
<span class="nc" id="L1218">			}</span>
<span class="nc" id="L1219">		}</span>

<span class="nc" id="L1221">		System.out.println(&quot;name list ===== &quot; + salePwtCommVarList);</span>
<span class="nc" id="L1222">		return salePwtCommVarList;</span>

	
	}
	
	public List&lt;SalePwtCommVarBean&gt; salePwtCommVarListForIW(String agentOrgName, String gamestatus, String orgTypeCode) {
<span class="nc" id="L1228">		System.out.println(&quot;salePwtCommVarListForIW called&quot;);</span>
<span class="nc" id="L1229">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L1230">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L1231">		con = DBConnect.getConnection();</span>
		/*
		 * String sqlQuery =
		 * &quot;select * from st_dg_bo_agent_sale_pwt_comm_variance aa, st_dg_game_master gm where agent_org_id=(select organization_id from st_lms_organization_master where organization_type='&quot;
		 * + orgTypeCode + &quot;' and name='&quot; + agentOrgName.trim() +
		 * &quot;') and gm.game_id=aa.game_id &quot;;
		 */
		/*
		 * if (!(&quot;ALL&quot;.equalsIgnoreCase(gamestatus))) sqlQuery = sqlQuery + &quot;and
		 * gm.game_status='&quot; + gamestatus + &quot;'&quot;;
		 */

		try {
<span class="nc" id="L1244">			int agetOrgId = Integer.parseInt(agentOrgName);</span>

<span class="nc" id="L1246">			String sqlQuery = &quot; select * from st_iw_bo_agent_sale_pwt_comm_variance aa, st_iw_game_master gm where agent_org_id=&quot;</span>
					+ agetOrgId
					+ &quot; and gm.game_id=aa.game_id and gm.game_id not in(select game_id from st_iw_game_master where closing_time &lt; now())&quot;;
<span class="nc" id="L1249">			System.out.println(&quot;agent organization name is ==== &quot; + agetOrgId + &quot;\n query = &quot; + sqlQuery);</span>
<span class="nc" id="L1250">			Statement stmt = con.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_READ_ONLY);</span>
<span class="nc" id="L1251">			rs = stmt.executeQuery(sqlQuery);</span>
<span class="nc" id="L1252">			rs.last();</span>
<span class="nc" id="L1253">			int rowcount = rs.getRow();</span>
<span class="nc" id="L1254">			System.out.println(&quot;row count value is ======== &quot; + rowcount);</span>
<span class="nc" id="L1255">			rs.beforeFirst();</span>
<span class="nc bnc" id="L1256" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1257">				bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L1258">				System.out.println(&quot;inside if row count 11111111111111&quot;);</span>
				// get the game name
<span class="nc" id="L1260">				int gameId = rs.getInt(&quot;game_id&quot;);</span>
<span class="nc bnc" id="L1261" title="All 2 branches missed.">				if (gameId &lt;= 0) {</span>
<span class="nc bnc" id="L1262" title="All 2 branches missed.">					if (gameId == 0) {</span>
<span class="nc" id="L1263">						bean.setGameName(&quot;Applicable on All Existing Games&quot;);</span>
<span class="nc bnc" id="L1264" title="All 2 branches missed.">					} else if (gameId == -1) {</span>
<span class="nc" id="L1265">						bean.setGameName(&quot;Applicable on All Existing and New Games&quot;);</span>
					} else {
<span class="nc" id="L1267">						bean.setGameName(&quot;Errror occured&quot;);</span>
					}
					// retrieve the default Sale commission variance
<span class="nc" id="L1270">					bean.setDefSaleCommRate(null);</span>
					// retrieve the Sale commission variance
<span class="nc" id="L1272">					double currentSaleCommVar = rs.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L1273">					bean.setCurrentSaleCommVar(FormatNumber.formatNumber(currentSaleCommVar));</span>
					// calculate the Sale commission variance
<span class="nc" id="L1275">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L1277">					bean.setDefPwtCommRate(null);</span>
					// retrieve the PWT commission variance
<span class="nc" id="L1279">					double currentPwtCommVar = rs.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L1280">					bean.setCurrentPwtCommVar(FormatNumber.formatNumber(currentPwtCommVar));</span>
					// calculate the PWT commission variance
<span class="nc" id="L1282">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L1284">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L1285">					System.out.println(&quot;inside if row count 2222222222&quot;);</span>
<span class="nc" id="L1286">				} else {</span>
<span class="nc" id="L1287">					System.out.println(&quot;inside else rowcount 111111111111111111&quot;);</span>
<span class="nc" id="L1288">					bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L1289">					bean.setGameName(rs.getInt(&quot;game_id&quot;) + &quot;-&quot; + rs.getString(&quot;game_disp_name&quot;));</span>

					// retrieve the default Sale commission variance
<span class="nc" id="L1292">					double defSaleCommRate = rs.getDouble(&quot;default_sale_comm_rate&quot;);</span>
<span class="nc" id="L1293">					bean.setDefSaleCommRate(FormatNumber.formatNumber(defSaleCommRate));</span>
					// retrieve the Sale commission variance
<span class="nc" id="L1295">					double currentSaleCommVar = rs.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L1296">					bean.setCurrentSaleCommVar(FormatNumber.formatNumber(currentSaleCommVar));</span>
					// calculate the Sale commission variance
<span class="nc" id="L1298">					bean.setNetSaleCommRate(FormatNumber.formatNumber(defSaleCommRate + currentSaleCommVar));</span>

<span class="nc" id="L1300">					double defPwtCommRate = rs.getDouble(&quot;default_pwt_comm_rate&quot;);</span>
<span class="nc" id="L1301">					bean.setDefPwtCommRate(FormatNumber.formatNumber(defPwtCommRate));</span>
					// retrieve the PWT commission variance
<span class="nc" id="L1303">					double currentPwtCommVar = rs.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L1304">					bean.setCurrentPwtCommVar(FormatNumber.formatNumber(currentPwtCommVar));</span>
					// calculate the PWT commission variance
<span class="nc" id="L1306">					bean.setNetPwtCommRate(FormatNumber.formatNumber(defPwtCommRate + currentPwtCommVar));</span>

<span class="nc" id="L1308">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L1309">					System.out.println(&quot;inside else row count 2222222222&quot;);</span>
				}
<span class="nc" id="L1311">			}</span>
<span class="nc" id="L1312">			rs.close();</span>
<span class="nc" id="L1313">			stmt.close();</span>

			// now get the details of games from st_iw_game_master thats
			// commission variance are not set
<span class="nc" id="L1317">			String query = &quot;select game_id, game_no, game_disp_name, agent_sale_comm_rate, agent_pwt_comm_rate, gov_comm_rate, prize_payout_ratio from st_iw_game_master where game_id NOT IN (select game_id from st_iw_bo_agent_sale_pwt_comm_variance where agent_org_id=&quot;</span>
					+ &quot;		 &quot;
					+ agetOrgId
					+ &quot; union select game_id from st_iw_game_master where closing_time &lt; now())&quot;;
			/*
			 * if (!(&quot;ALL&quot;.equalsIgnoreCase(gamestatus))) query = query + &quot;and
			 * game_status='&quot; + gamestatus + &quot;'&quot;;
			 */
<span class="nc" id="L1325">			System.out.println(&quot;agent  query = &quot; + query);</span>
<span class="nc" id="L1326">			List&lt;SalePwtCommVarBean&gt; remList = getSalePwtGameDetailsIW(query, con, gamestatus);</span>
<span class="nc bnc" id="L1327" title="All 2 branches missed.">			if (remList.size() &gt; 0) {</span>
<span class="nc" id="L1328">				salePwtCommVarList.addAll(remList);</span>
			}
<span class="nc" id="L1330">		} catch (SQLException e) {</span>
<span class="nc" id="L1331">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1333">			try {</span>
<span class="nc bnc" id="L1334" title="All 6 branches missed.">				if (pstmt != null) {</span>
<span class="nc" id="L1335">					pstmt.close();</span>
				}
<span class="nc bnc" id="L1337" title="All 12 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L1338">					con.close();</span>
				}
<span class="nc" id="L1340">			} catch (SQLException e) {</span>
<span class="nc" id="L1341">				e.printStackTrace();</span>
<span class="nc" id="L1342">			}</span>
<span class="nc" id="L1343">		}</span>
<span class="nc" id="L1344">		System.out.println(&quot;name list ===== &quot; + salePwtCommVarList);</span>
<span class="nc" id="L1345">		return salePwtCommVarList;</span>
	}
	
	// PA Sale and PWT Profit Variance For Virtual Sport For Agent
	
	public List&lt;SalePwtCommVarBean&gt;  salePwtCommVarListForVS(String agentOrgName, String gamestatus, String orgTypeCode) {
		//System.out.println(&quot;salePwtCommVarListForVS called&quot;);
<span class="nc" id="L1352">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L1353">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L1354">		con = DBConnect.getConnection();</span>
		try {
<span class="nc" id="L1356">			int agetOrgId = Integer.parseInt(agentOrgName);</span>

<span class="nc" id="L1358">			String sqlQuery = &quot; select * from st_vs_bo_agent_sale_pwt_comm_variance aa, st_vs_game_master gm where agent_org_id=&quot;</span>
					+ agetOrgId
					+ &quot; and gm.game_id=aa.game_id and gm.game_id not in(select game_id from st_vs_game_master where closing_time &lt; now())&quot;;
			//System.out.println(&quot;agent organization name is ==== &quot; + agetOrgId + &quot;\n query = &quot; + sqlQuery);
<span class="nc" id="L1362">			Statement stmt = con.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_READ_ONLY);</span>
<span class="nc" id="L1363">			rs = stmt.executeQuery(sqlQuery);</span>
<span class="nc" id="L1364">			rs.last();</span>
<span class="nc" id="L1365">			int rowcount = rs.getRow();</span>
			//System.out.println(&quot;row count value is ======== &quot; + rowcount);
<span class="nc" id="L1367">			rs.beforeFirst();</span>
<span class="nc bnc" id="L1368" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1369">				bean = new SalePwtCommVarBean();</span>
				//System.out.println(&quot;inside if row count 11111111111111&quot;);
				// get the game name
<span class="nc" id="L1372">				int gameId = rs.getInt(&quot;game_id&quot;);</span>
<span class="nc bnc" id="L1373" title="All 2 branches missed.">				if (gameId &lt;= 0) {</span>
<span class="nc bnc" id="L1374" title="All 2 branches missed.">					if (gameId == 0) {</span>
<span class="nc" id="L1375">						bean.setGameName(&quot;Applicable on All Existing Games&quot;);</span>
<span class="nc bnc" id="L1376" title="All 2 branches missed.">					} else if (gameId == -1) {</span>
<span class="nc" id="L1377">						bean.setGameName(&quot;Applicable on All Existing and New Games&quot;);</span>
					} else {
<span class="nc" id="L1379">						bean.setGameName(&quot;Errror occured&quot;);</span>
					}
					// retrieve the default Sale commission variance
<span class="nc" id="L1382">					bean.setDefSaleCommRate(null);</span>
					// retrieve the Sale commission variance
<span class="nc" id="L1384">					double currentSaleCommVar = rs.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L1385">					bean.setCurrentSaleCommVar(FormatNumber.formatNumber(currentSaleCommVar));</span>
					// calculate the Sale commission variance
<span class="nc" id="L1387">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L1389">					bean.setDefPwtCommRate(null);</span>
					// retrieve the PWT commission variance
<span class="nc" id="L1391">					double currentPwtCommVar = rs.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L1392">					bean.setCurrentPwtCommVar(FormatNumber.formatNumber(currentPwtCommVar));</span>
					// calculate the PWT commission variance
<span class="nc" id="L1394">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L1396">					salePwtCommVarList.add(bean);</span>
				//	System.out.println(&quot;inside if row count 2222222222&quot;);
<span class="nc" id="L1398">				} else {</span>
					//System.out.println(&quot;inside else rowcount 111111111111111111&quot;);
<span class="nc" id="L1400">					bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L1401">					bean.setGameName(rs.getInt(&quot;game_id&quot;) + &quot;-&quot; + rs.getString(&quot;game_disp_name&quot;));</span>

					// retrieve the default Sale commission variance
<span class="nc" id="L1404">					double defSaleCommRate = rs.getDouble(&quot;default_sale_comm_rate&quot;);</span>
<span class="nc" id="L1405">					bean.setDefSaleCommRate(FormatNumber.formatNumber(defSaleCommRate));</span>
					// retrieve the Sale commission variance
<span class="nc" id="L1407">					double currentSaleCommVar = rs.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L1408">					bean.setCurrentSaleCommVar(FormatNumber.formatNumber(currentSaleCommVar));</span>
					// calculate the Sale commission variance
<span class="nc" id="L1410">					bean.setNetSaleCommRate(FormatNumber.formatNumber(defSaleCommRate + currentSaleCommVar));</span>

<span class="nc" id="L1412">					double defPwtCommRate = rs.getDouble(&quot;default_pwt_comm_rate&quot;);</span>
<span class="nc" id="L1413">					bean.setDefPwtCommRate(FormatNumber.formatNumber(defPwtCommRate));</span>
					// retrieve the PWT commission variance
<span class="nc" id="L1415">					double currentPwtCommVar = rs.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L1416">					bean.setCurrentPwtCommVar(FormatNumber.formatNumber(currentPwtCommVar));</span>
					// calculate the PWT commission variance
<span class="nc" id="L1418">					bean.setNetPwtCommRate(FormatNumber.formatNumber(defPwtCommRate + currentPwtCommVar));</span>

<span class="nc" id="L1420">					salePwtCommVarList.add(bean);</span>
				//	System.out.println(&quot;inside else row count 2222222222&quot;);
				}
<span class="nc" id="L1423">			}</span>
<span class="nc" id="L1424">			rs.close();</span>
<span class="nc" id="L1425">			stmt.close();</span>

			// now get the details of games from st_vs_game_master thats
			// commission variance are not set
<span class="nc" id="L1429">			String query = &quot;select game_id, game_no, game_disp_name, agent_sale_comm_rate, agent_pwt_comm_rate, gov_comm_rate, prize_payout_ratio from st_vs_game_master where game_id NOT IN (select game_id from st_vs_bo_agent_sale_pwt_comm_variance where agent_org_id=&quot;</span>
					+ &quot;		 &quot;
					+ agetOrgId
					+ &quot; union select game_id from st_vs_game_master where closing_time &lt; now())&quot;;
			/*
			 * if (!(&quot;ALL&quot;.equalsIgnoreCase(gamestatus))) query = query + &quot;and
			 * game_status='&quot; + gamestatus + &quot;'&quot;;
			 */
		//	System.out.println(&quot;agent  query = &quot; + query);
<span class="nc" id="L1438">			List&lt;SalePwtCommVarBean&gt; remList = getSalePwtGameDetailsVS(query, con, gamestatus);</span>
<span class="nc bnc" id="L1439" title="All 2 branches missed.">			if (remList.size() &gt; 0) {</span>
<span class="nc" id="L1440">				salePwtCommVarList.addAll(remList);</span>
			}
<span class="nc" id="L1442">		} catch (SQLException e) {</span>
<span class="nc" id="L1443">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1445">			try {</span>
<span class="nc bnc" id="L1446" title="All 6 branches missed.">				if (pstmt != null) {</span>
<span class="nc" id="L1447">					pstmt.close();</span>
				}
<span class="nc bnc" id="L1449" title="All 12 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L1450">					con.close();</span>
				}
<span class="nc" id="L1452">			} catch (SQLException e) {</span>
<span class="nc" id="L1453">				e.printStackTrace();</span>
<span class="nc" id="L1454">			}</span>
<span class="nc" id="L1455">		}</span>
		//System.out.println(&quot;name list ===== &quot; + salePwtCommVarList);
<span class="nc" id="L1457">		return salePwtCommVarList;</span>
	}
	
	
	public String submitUpdatedAllValue(String agtOrgName, String gameStatus,
			String saleCommVar, String pwtCommVar) throws LMSException {

<span class="nc" id="L1464">		List&lt;UpdateSalePwtCommVarBean&gt; list = new ArrayList&lt;UpdateSalePwtCommVarBean&gt;();</span>
<span class="nc" id="L1465">		double saleCommVar1 = Double.parseDouble(saleCommVar.trim());</span>
<span class="nc" id="L1466">		double pwtCommVar1 = Double.parseDouble(pwtCommVar.trim());</span>
<span class="nc" id="L1467">		UpdateSalePwtCommVarBean commVarianceBean = null;</span>
<span class="nc" id="L1468">		Connection conn = DBConnect.getConnection();</span>
		try {
<span class="nc" id="L1470">			conn.setAutoCommit(false);</span>
<span class="nc" id="L1471">			PreparedStatement pstmt1 = conn</span>
					.prepareStatement(&quot;select agent_org_id, game_id, sale_comm_variance, default_sale_comm_rate, pwt_comm_variance, default_pwt_comm_rate from st_se_bo_agent_sale_pwt_comm_variance where agent_org_id=(select organization_id from st_lms_organization_master where name='&quot;
							+ agtOrgName.trim() + &quot;')&quot;);
<span class="nc" id="L1474">			ResultSet rs1 = pstmt1.executeQuery();</span>
<span class="nc" id="L1475">			System.out.println(&quot;query = &quot; + pstmt1);</span>
<span class="nc bnc" id="L1476" title="All 2 branches missed.">			while (rs1.next()) {</span>
<span class="nc" id="L1477">				System.out.println(&quot;inside pstmt1---11111111&quot;);</span>
<span class="nc" id="L1478">				commVarianceBean = new UpdateSalePwtCommVarBean();</span>
<span class="nc" id="L1479">				double oldPwtCommVar = rs1.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L1480">				double oldSaleCommVar = rs1.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L1481">				commVarianceBean.setAgentOrgId(rs1.getInt(&quot;agent_org_id&quot;));</span>
<span class="nc" id="L1482">				commVarianceBean.setGameId(rs1.getInt(&quot;game_id&quot;));</span>
<span class="nc" id="L1483">				commVarianceBean.setSaleCommVar(oldSaleCommVar);</span>
<span class="nc" id="L1484">				commVarianceBean.setDefaultSaleCommRate(rs1</span>
						.getDouble(&quot;default_sale_comm_rate&quot;));
<span class="nc" id="L1486">				commVarianceBean.setPwtCommVar(oldPwtCommVar);</span>
<span class="nc" id="L1487">				commVarianceBean.setDefaultPwtCommRate(rs1</span>
						.getDouble(&quot;default_pwt_comm_rate&quot;));
<span class="nc" id="L1489">				list.add(commVarianceBean);</span>

<span class="nc" id="L1491">			}</span>
<span class="nc" id="L1492">			System.out.println(&quot;list &quot; + list);</span>
<span class="nc" id="L1493">			pstmt1.close();</span>
<span class="nc" id="L1494">			rs1.close();</span>
<span class="nc bnc" id="L1495" title="All 2 branches missed.">			for (UpdateSalePwtCommVarBean commvariancebean : list) {</span>
<span class="nc" id="L1496">				commVarianceBean = commvariancebean;</span>
<span class="nc bnc" id="L1497" title="All 2 branches missed.">				if (saleCommVar1 != commVarianceBean.getSaleCommVar()) {</span>
<span class="nc" id="L1498">					System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L1499">					PreparedStatement pstmt3 = conn</span>
							.prepareStatement(&quot;insert into st_se_bo_agent_sale_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L1501">					pstmt3.setInt(1, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L1502">					pstmt3.setInt(2, commVarianceBean.getGameId());</span>
<span class="nc" id="L1503">					pstmt3.setDouble(3, commVarianceBean.getSaleCommVar());</span>
<span class="nc" id="L1504">					pstmt3.setTimestamp(4, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L1506">					int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L1507">					System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L1508">					System.out</span>
							.println(&quot;sale comm var history table updated rows === &quot;
									+ rows);

				}

<span class="nc bnc" id="L1514" title="All 2 branches missed.">				if (pwtCommVar1 != commVarianceBean.getPwtCommVar()) {</span>
<span class="nc" id="L1515">					System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L1516">					PreparedStatement pstmt4 = conn</span>
							.prepareStatement(&quot;insert into st_se_bo_agent_pwt_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L1518">					pstmt4.setInt(1, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L1519">					pstmt4.setInt(2, commVarianceBean.getGameId());</span>
<span class="nc" id="L1520">					pstmt4.setDouble(3, commVarianceBean.getPwtCommVar());</span>
<span class="nc" id="L1521">					pstmt4.setTimestamp(4, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L1523">					int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L1524">					System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L1525">					System.out</span>
							.println(&quot;PWT comm var history table updated rows === &quot;
									+ rows);

				}
<span class="nc" id="L1530">			}</span>

<span class="nc bnc" id="L1532" title="All 2 branches missed.">			if (list.size() &gt; 0) {</span>
<span class="nc" id="L1533">				System.out.println(&quot;555555555555555&quot;);</span>
<span class="nc" id="L1534">				PreparedStatement pstmt5 = conn</span>
						.prepareStatement(&quot;delete from st_se_bo_agent_sale_pwt_comm_variance  where agent_org_id=?&quot;);
<span class="nc" id="L1536">				pstmt5.setInt(1, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L1537">				int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L1538">				System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L1539">				System.out</span>
						.println(&quot;Delete entry from st_se_bo_agent_sale_pwt_comm_variance  table updated rows === &quot;
								+ rows);
<span class="nc" id="L1542">				pstmt5.close();</span>
			}

<span class="nc bnc" id="L1545" title="All 4 branches missed.">			if (saleCommVar1 != 0.0 || pwtCommVar1 != 0.0) {</span>
<span class="nc" id="L1546">				System.out.println(&quot;66666666666666666666666666&quot;);</span>
<span class="nc" id="L1547">				PreparedStatement pstmt6 = conn</span>
						.prepareStatement(&quot;select organization_id from st_lms_organization_master where name=?&quot;);
<span class="nc" id="L1549">				pstmt6.setString(1, agtOrgName.trim());</span>
<span class="nc" id="L1550">				ResultSet rs6 = pstmt6.executeQuery();</span>
<span class="nc" id="L1551">				System.out.println(&quot;query = &quot; + pstmt6);</span>
<span class="nc" id="L1552">				int agtOrgid = 0;</span>
<span class="nc bnc" id="L1553" title="All 2 branches missed.">				if (rs6.next()) {</span>
<span class="nc" id="L1554">					agtOrgid = rs6.getInt(&quot;organization_id&quot;);</span>
				}

<span class="nc" id="L1557">				String gamedetailsquery = null;</span>
<span class="nc bnc" id="L1558" title="All 2 branches missed.">				if (&quot;ALL&quot;.equalsIgnoreCase(gameStatus.trim())) {</span>
<span class="nc" id="L1559">					System.out</span>
							.println(&quot;inside allllllllllllllllllllllllllllllllllllll&quot;);
<span class="nc" id="L1561">					gamedetailsquery = &quot;select game_id, game_nbr, game_name, agent_sale_comm_rate, agent_pwt_comm_rate, govt_comm_rate, prize_payout_ratio from st_se_game_master where game_status!='TERMINATE'&quot;;</span>
				} else {
<span class="nc" id="L1563">					gamedetailsquery = &quot;select game_id, game_nbr, game_name, agent_sale_comm_rate, agent_pwt_comm_rate, govt_comm_rate, prize_payout_ratio from st_se_game_master where game_status='&quot;</span>
							+ gameStatus + &quot;'&quot;;
				}

<span class="nc" id="L1567">				List&lt;UpdateSalePwtCommVarBean&gt; gameDetailList = getAllSalePwtGameDetails(</span>
						gamedetailsquery, conn);
<span class="nc" id="L1569">				System.out.println(&quot;game Details list &quot; + gameDetailList);</span>

<span class="nc bnc" id="L1571" title="All 2 branches missed.">				if (agtOrgid &gt; 0) {</span>
<span class="nc bnc" id="L1572" title="All 2 branches missed.">					for (UpdateSalePwtCommVarBean updateSalePwtCommVarBean : gameDetailList) {</span>
<span class="nc" id="L1573">						commVarianceBean = updateSalePwtCommVarBean;</span>
<span class="nc" id="L1574">						PreparedStatement pstmt5 = conn</span>
								.prepareStatement(&quot;insert into st_se_bo_agent_sale_pwt_comm_variance  values (? , ? , ? ,?,?, ?)&quot;);
<span class="nc" id="L1576">						pstmt5.setInt(1, agtOrgid);</span>
<span class="nc" id="L1577">						pstmt5.setInt(2, commVarianceBean.getGameId());</span>
<span class="nc" id="L1578">						pstmt5.setDouble(3, saleCommVar1);</span>
<span class="nc" id="L1579">						pstmt5.setDouble(4, commVarianceBean</span>
								.getDefaultSaleCommRate());
<span class="nc" id="L1581">						pstmt5.setDouble(5, pwtCommVar1);</span>
<span class="nc" id="L1582">						pstmt5.setDouble(6, commVarianceBean</span>
								.getDefaultPwtCommRate());
<span class="nc" id="L1584">						int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L1585">						System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L1586">						System.out</span>
								.println(&quot;insert entries st_se_bo_agent_sale_pwt_comm_variance  table updated rows === &quot;
										+ rows);
<span class="nc" id="L1589">						pstmt5.close();</span>
<span class="nc" id="L1590">					}</span>

<span class="nc bnc" id="L1592" title="All 2 branches missed.">					if (list.size() == 0) {</span>
<span class="nc bnc" id="L1593" title="All 2 branches missed.">						for (UpdateSalePwtCommVarBean updateSalePwtCommVarBean : gameDetailList) {</span>
<span class="nc" id="L1594">							commVarianceBean = updateSalePwtCommVarBean;</span>
<span class="nc" id="L1595">							System.out.println(&quot;3333333333333333333&quot;);</span>

<span class="nc" id="L1597">							PreparedStatement pstmt3 = conn</span>
									.prepareStatement(&quot;insert into st_se_bo_agent_sale_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L1599">							pstmt3.setInt(1, agtOrgid);</span>
<span class="nc" id="L1600">							pstmt3.setInt(2, commVarianceBean.getGameId());</span>
<span class="nc" id="L1601">							pstmt3.setDouble(3, 0.0);</span>
<span class="nc" id="L1602">							pstmt3.setTimestamp(4, new java.sql.Timestamp(</span>
									new java.util.Date().getTime()));
<span class="nc" id="L1604">							int row = pstmt3.executeUpdate();</span>
<span class="nc" id="L1605">							System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L1606">							System.out</span>
									.println(&quot;sale comm var history table updated rows === &quot;
											+ row);

<span class="nc" id="L1610">							System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L1611">							PreparedStatement pstmt4 = conn</span>
									.prepareStatement(&quot;insert into st_se_bo_agent_pwt_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L1613">							pstmt4.setInt(1, agtOrgid);</span>
<span class="nc" id="L1614">							pstmt4.setInt(2, commVarianceBean.getGameId());</span>
<span class="nc" id="L1615">							pstmt4.setDouble(3, 0.0);</span>
<span class="nc" id="L1616">							pstmt4.setTimestamp(4, new java.sql.Timestamp(</span>
									new java.util.Date().getTime()));
<span class="nc" id="L1618">							int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L1619">							System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L1620">							System.out</span>
									.println(&quot;PWT comm var history table updated rows === &quot;
											+ rows);

<span class="nc" id="L1624">						}</span>
					}
				}

			}
<span class="nc" id="L1629">			conn.commit();</span>
<span class="nc" id="L1630">		} catch (SQLException se) {</span>
			try {
<span class="nc" id="L1632">				System.out.println(&quot;rollbacked&quot;);</span>
<span class="nc" id="L1633">				conn.rollback();</span>
<span class="nc" id="L1634">			} catch (SQLException e) {</span>
<span class="nc" id="L1635">				e.printStackTrace();</span>
				// throw new LMSException(e);
<span class="nc" id="L1637">			}</span>
<span class="nc" id="L1638">			se.printStackTrace();</span>
<span class="nc" id="L1639">			throw new LMSException(se);</span>

		} finally {

<span class="nc" id="L1643">			try {</span>
<span class="nc bnc" id="L1644" title="All 8 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L1645">					conn.close();</span>
				}
<span class="nc" id="L1647">			} catch (SQLException e) {</span>
<span class="nc" id="L1648">				e.printStackTrace();</span>
<span class="nc" id="L1649">			}</span>

<span class="nc" id="L1651">		}</span>

<span class="nc" id="L1653">		return &quot;SUCCESS&quot;;</span>

	}

	public String submitUpdatedValueCS(String agtOrgName, String gname,
			String defSaleCommRate, String saleCommVar) throws LMSException {

<span class="nc" id="L1660">		String game[] = gname.split(&quot;_&quot;);</span>
<span class="nc" id="L1661">		double dSaleCommRate = Double.parseDouble(defSaleCommRate.trim());</span>
<span class="nc" id="L1662">		double saleCommVar1 = Double.parseDouble(saleCommVar.trim());</span>
<span class="nc" id="L1663">		UpdateSalePwtCommVarBean commVarianceBean = null;</span>
<span class="nc" id="L1664">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L1665">		boolean flagforZero = false;</span>
		try {
<span class="nc" id="L1667">			conn.setAutoCommit(false);</span>
<span class="nc" id="L1668">			int orgId =Integer.parseInt(agtOrgName);</span>
<span class="nc" id="L1669">			PreparedStatement pstmt1 = conn</span>
					.prepareStatement(&quot;select agent_org_id, product_id, sale_comm_variance, default_sale_comm_rate  from st_cs_bo_agent_sale_comm_variance where product_id=&quot;
							+ game[0]+&quot; and agent_org_id=&quot;
							+ orgId + &quot; &quot;);
<span class="nc" id="L1673">			ResultSet rs1 = pstmt1.executeQuery();</span>
<span class="nc" id="L1674">			logger.debug(&quot;query = &quot; + pstmt1);</span>
<span class="nc bnc" id="L1675" title="All 2 branches missed.">			if (rs1.next()) {</span>
<span class="nc" id="L1676">				double oldSaleCommVar = rs1.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc bnc" id="L1677" title="All 2 branches missed.">				if (saleCommVar1 == oldSaleCommVar) {</span>
<span class="nc" id="L1678">					return &quot;SAME_VALUES&quot;;</span>
				}

<span class="nc" id="L1681">				commVarianceBean = new UpdateSalePwtCommVarBean();</span>
<span class="nc" id="L1682">				commVarianceBean.setAgentOrgId(rs1.getInt(&quot;agent_org_id&quot;));</span>
<span class="nc" id="L1683">				commVarianceBean.setGameId(rs1.getInt(&quot;product_id&quot;));</span>
<span class="nc" id="L1684">				commVarianceBean.setSaleCommVar(oldSaleCommVar);</span>
<span class="nc" id="L1685">				commVarianceBean.setDefaultSaleCommRate(rs1</span>
						.getDouble(&quot;default_sale_comm_rate&quot;));
			}
<span class="nc" id="L1688">			pstmt1.close();</span>
<span class="nc" id="L1689">			rs1.close();</span>

<span class="nc bnc" id="L1691" title="All 2 branches missed.">			if (commVarianceBean != null) {</span>
<span class="nc" id="L1692">				PreparedStatement pstmt5 = conn</span>
						.prepareStatement(&quot;delete from st_cs_bo_agent_sale_comm_variance  where product_id=? and agent_org_id=?&quot;);
<span class="nc" id="L1694">				pstmt5.setInt(1, commVarianceBean.getGameId());</span>
<span class="nc" id="L1695">				pstmt5.setInt(2, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L1696">				int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L1697">				System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L1698">				System.out</span>
						.println(&quot;Delete entry from st_cs_bo_agent_sale_comm_variance  table updated rows === &quot;
								+ rows);
<span class="nc" id="L1701">				pstmt5.close();</span>
<span class="nc" id="L1702">				flagforZero = true;</span>
			}

<span class="nc bnc" id="L1705" title="All 4 branches missed.">			if (commVarianceBean != null</span>
					&amp;&amp; saleCommVar1 != commVarianceBean.getSaleCommVar()) {
<span class="nc" id="L1707">				PreparedStatement pstmt3 = conn</span>
						.prepareStatement(&quot;insert into st_cs_bo_agent_sale_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L1709">				pstmt3.setInt(1, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L1710">				pstmt3.setInt(2, commVarianceBean.getGameId());</span>
<span class="nc" id="L1711">				pstmt3.setDouble(3, commVarianceBean.getSaleCommVar());</span>
<span class="nc" id="L1712">				pstmt3.setTimestamp(4, new java.sql.Timestamp(</span>
						new java.util.Date().getTime()));
<span class="nc" id="L1714">				int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L1715">				System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L1716">				System.out</span>
						.println(&quot;sale comm var history table updated rows === &quot;
								+ rows);
<span class="nc" id="L1719">				pstmt3.close();</span>
			}

<span class="nc" id="L1722">			System.out.println(saleCommVar1 + &quot; **saleCommVar1** &quot;);</span>
<span class="nc bnc" id="L1723" title="All 2 branches missed.">			System.out.println(&quot;saleCommVar1!=0.0&quot;</span>
					+ (saleCommVar1 != 0.0 ));
<span class="nc bnc" id="L1725" title="All 2 branches missed.">			if (saleCommVar1 != 0.0) {</span>
				/*PreparedStatement pstmt6 = conn
						.prepareStatement(&quot;select organization_id from st_lms_organization_master where name=?&quot;);
				pstmt6.setString(1, agtOrgName.trim());
				ResultSet rs6 = pstmt6.executeQuery();
				logger.debug(&quot;query = &quot; + pstmt6);*/
<span class="nc" id="L1731">				int productId = 0;</span>
				//int agtOrgid = 0;
				//if (rs6.next()) {
<span class="nc" id="L1734">					productId = Integer.parseInt(game[0]);</span>
				//	agtOrgid = rs6.getInt(&quot;organization_id&quot;);
				// }
<span class="nc bnc" id="L1737" title="All 4 branches missed.">				if (productId &gt;0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L1738">					PreparedStatement pstmt5 = conn</span>
							.prepareStatement(&quot;insert into st_cs_bo_agent_sale_comm_variance  values (? , ? , ? , ?)&quot;);
<span class="nc" id="L1740">					pstmt5.setInt(1, orgId);</span>
<span class="nc" id="L1741">					pstmt5.setInt(2, productId);</span>
<span class="nc" id="L1742">					pstmt5.setDouble(3, saleCommVar1);</span>
<span class="nc" id="L1743">					pstmt5.setDouble(4, dSaleCommRate);</span>
<span class="nc" id="L1744">					int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L1745">					System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L1746">					System.out</span>
							.println(&quot;insert entries st_cs_bo_agent_sale_comm_variance  table updated rows === &quot;
									+ rows);
<span class="nc" id="L1749">					pstmt5.close();</span>
				}

<span class="nc bnc" id="L1752" title="All 6 branches missed.">				if (commVarianceBean == null &amp;&amp; productId &gt;0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L1753">					PreparedStatement pstmt3 = conn</span>
							.prepareStatement(&quot;insert into st_cs_bo_agent_sale_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L1755">					pstmt3.setInt(1, orgId);</span>
<span class="nc" id="L1756">					pstmt3.setInt(2, productId);</span>
<span class="nc" id="L1757">					pstmt3.setDouble(3, 0.0);</span>
<span class="nc" id="L1758">					pstmt3.setTimestamp(4, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L1760">					int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L1761">					System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L1762">					System.out</span>
							.println(&quot;sale comm var history table updated rows === &quot;
									+ rows);
<span class="nc" id="L1765">					pstmt3.close();</span>
				}
			}
<span class="nc" id="L1768">			conn.commit();</span>
<span class="nc" id="L1769">		} catch (SQLException se) {</span>
			try {
<span class="nc" id="L1771">				System.out.println(&quot;rollbacked&quot;);</span>
<span class="nc" id="L1772">				conn.rollback();</span>
<span class="nc" id="L1773">			} catch (SQLException e) {</span>
<span class="nc" id="L1774">				e.printStackTrace();</span>
				// throw new LMSException(e);
<span class="nc" id="L1776">			}</span>
<span class="nc" id="L1777">			se.printStackTrace();</span>
<span class="nc" id="L1778">			throw new LMSException(se);</span>

		} finally {

<span class="nc" id="L1782">			try {</span>
<span class="nc bnc" id="L1783" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L1784">					conn.close();</span>
				}
<span class="nc" id="L1786">			} catch (SQLException e) {</span>
<span class="nc" id="L1787">				e.printStackTrace();</span>
<span class="nc" id="L1788">			}</span>

<span class="nc" id="L1790">		}</span>

<span class="nc" id="L1792">		return &quot;SUCCESS&quot;;</span>
	}

	//
	public String submitUpdatedValueDg(String agtOrgName, String gname,
			String defSaleCommRate, String saleCommVar, String defPwtCommRate,
			String pwtCommVar) throws LMSException {

<span class="nc" id="L1800">		String game[] = gname.split(&quot;-&quot;);</span>
<span class="nc" id="L1801">		double dSaleCommRate = Double.parseDouble(defSaleCommRate.trim());</span>
<span class="nc" id="L1802">		double saleCommVar1 = Double.parseDouble(saleCommVar.trim());</span>
<span class="nc" id="L1803">		double dPwtCommRate = Double.parseDouble(defPwtCommRate.trim());</span>
<span class="nc" id="L1804">		double pwtCommVar1 = Double.parseDouble(pwtCommVar.trim());</span>
<span class="nc" id="L1805">		UpdateSalePwtCommVarBean commVarianceBean = null;</span>
<span class="nc" id="L1806">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L1807">		boolean flagforZero = false;</span>
		try {
<span class="nc" id="L1809">			conn.setAutoCommit(false);</span>
<span class="nc" id="L1810">			int orgId =Integer.parseInt(agtOrgName);</span>
<span class="nc" id="L1811">			PreparedStatement pstmt1 = conn</span>
					.prepareStatement(&quot;select agent_org_id, game_id, sale_comm_variance, default_sale_comm_rate, pwt_comm_variance, default_pwt_comm_rate from st_dg_bo_agent_sale_pwt_comm_variance where game_id=&quot;
							+ game[0] +&quot;  and agent_org_id= &quot;
							+ orgId + &quot; &quot;);
<span class="nc" id="L1815">			System.out.println(&quot;query = &quot; + pstmt1);</span>
<span class="nc" id="L1816">			ResultSet rs1 = pstmt1.executeQuery();</span>
			
<span class="nc bnc" id="L1818" title="All 2 branches missed.">			if (rs1.next()) {</span>
<span class="nc" id="L1819">				System.out.println(&quot;inside pstmt1---11111111&quot;);</span>
<span class="nc" id="L1820">				double oldPwtCommVar = rs1.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L1821">				double oldSaleCommVar = rs1.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc bnc" id="L1822" title="All 4 branches missed.">				if (oldPwtCommVar == pwtCommVar1</span>
						&amp;&amp; saleCommVar1 == oldSaleCommVar) {
<span class="nc" id="L1824">					return &quot;SAME_VALUES&quot;;</span>
				}

<span class="nc" id="L1827">				commVarianceBean = new UpdateSalePwtCommVarBean();</span>
<span class="nc" id="L1828">				commVarianceBean.setAgentOrgId(rs1.getInt(&quot;agent_org_id&quot;));</span>
<span class="nc" id="L1829">				commVarianceBean.setGameId(rs1.getInt(&quot;game_id&quot;));</span>
<span class="nc" id="L1830">				commVarianceBean.setSaleCommVar(oldSaleCommVar);</span>
<span class="nc" id="L1831">				commVarianceBean.setDefaultSaleCommRate(rs1</span>
						.getDouble(&quot;default_sale_comm_rate&quot;));
<span class="nc" id="L1833">				commVarianceBean.setPwtCommVar(oldPwtCommVar);</span>
<span class="nc" id="L1834">				commVarianceBean.setDefaultPwtCommRate(rs1</span>
						.getDouble(&quot;default_pwt_comm_rate&quot;));
<span class="nc" id="L1836">				System.out.println(&quot;inside pstmt1---22222222&quot;);</span>
			}
<span class="nc" id="L1838">			pstmt1.close();</span>
<span class="nc" id="L1839">			rs1.close();</span>

<span class="nc bnc" id="L1841" title="All 2 branches missed.">			if (commVarianceBean != null) {</span>
<span class="nc" id="L1842">				System.out.println(&quot;555555555555555&quot;);</span>
<span class="nc" id="L1843">				PreparedStatement pstmt5 = conn</span>
						.prepareStatement(&quot;delete from st_dg_bo_agent_sale_pwt_comm_variance  where game_id=? and agent_org_id=?&quot;);
<span class="nc" id="L1845">				pstmt5.setInt(1, commVarianceBean.getGameId());</span>
<span class="nc" id="L1846">				pstmt5.setInt(2, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L1847">				int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L1848">				System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L1849">				System.out</span>
						.println(&quot;Delete entry from st_dg_bo_agent_sale_pwt_comm_variance  table updated rows === &quot;
								+ rows);
<span class="nc" id="L1852">				pstmt5.close();</span>
<span class="nc" id="L1853">				flagforZero = true;</span>
			}

<span class="nc bnc" id="L1856" title="All 4 branches missed.">			if (commVarianceBean != null</span>
					&amp;&amp; saleCommVar1 != commVarianceBean.getSaleCommVar()) {
<span class="nc" id="L1858">				System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L1859">				PreparedStatement pstmt3 = conn</span>
						.prepareStatement(&quot;insert into st_dg_bo_agent_sale_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L1861">				pstmt3.setInt(1, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L1862">				pstmt3.setInt(2, commVarianceBean.getGameId());</span>
<span class="nc" id="L1863">				pstmt3.setDouble(3, commVarianceBean.getSaleCommVar());</span>
<span class="nc" id="L1864">				pstmt3.setTimestamp(4, new java.sql.Timestamp(</span>
						new java.util.Date().getTime()));
<span class="nc" id="L1866">				int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L1867">				System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L1868">				System.out</span>
						.println(&quot;sale comm var history table updated rows === &quot;
								+ rows);
<span class="nc" id="L1871">				pstmt3.close();</span>
			}

<span class="nc bnc" id="L1874" title="All 4 branches missed.">			if (commVarianceBean != null</span>
					&amp;&amp; pwtCommVar1 != commVarianceBean.getPwtCommVar()) {
<span class="nc" id="L1876">				System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L1877">				PreparedStatement pstmt4 = conn</span>
						.prepareStatement(&quot;insert into st_dg_bo_agent_pwt_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L1879">				pstmt4.setInt(1, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L1880">				pstmt4.setInt(2, commVarianceBean.getGameId());</span>
<span class="nc" id="L1881">				pstmt4.setDouble(3, commVarianceBean.getPwtCommVar());</span>
<span class="nc" id="L1882">				pstmt4.setTimestamp(4, new java.sql.Timestamp(</span>
						new java.util.Date().getTime()));
<span class="nc" id="L1884">				int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L1885">				System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L1886">				System.out</span>
						.println(&quot;PWT comm var history table updated rows === &quot;
								+ rows);
<span class="nc" id="L1889">				pstmt4.close();</span>
			}

<span class="nc" id="L1892">			System.out.println(saleCommVar1 + &quot; **saleCommVar1** &quot;</span>
					+ pwtCommVar1);
<span class="nc bnc" id="L1894" title="All 4 branches missed.">			System.out.println(&quot;saleCommVar1!=0.0 ||  pwtCommVar1!=0.0&quot;</span>
					+ (saleCommVar1 != 0.0 || pwtCommVar1 != 0.0));
		/*	PreparedStatement pstmt6 = conn
					.prepareStatement(&quot;select aa.game_id, bb.organization_id from ((select organization_id from st_lms_organization_master where name=?) bb, ( select game_id from st_dg_game_master where game_nbr=? )aa) &quot;);
			pstmt6.setString(1, agtOrgName.trim());
			pstmt6.setInt(2, Integer.parseInt(game[0]));*/
			
		/*	PreparedStatement pstmt6 = conn
			.prepareStatement(&quot; select game_id from st_dg_game_master where game_nbr=?   &quot;);
			
			pstmt6.setInt(1, Integer.parseInt(game[0]));
			//pstmt6.setString(3, game[1]);
			ResultSet rs6 = pstmt6.executeQuery();
			System.out.println(&quot;query = &quot; + pstmt6);*/
<span class="nc" id="L1908">			int gameId = Integer.parseInt(game[0]);</span>
			//int agtOrgid1 = 0;
			/*if (rs6.next()) {
				gameId = rs6.getInt(&quot;game_id&quot;);
				//	agtOrgid = rs6.getInt(&quot;organization_id&quot;);
			}*/
<span class="nc bnc" id="L1914" title="All 4 branches missed.">			if (saleCommVar1 != 0.0 || pwtCommVar1 != 0.0) {</span>
<span class="nc" id="L1915">				System.out.println(&quot;66666666666666666666666666&quot;);</span>
				/*PreparedStatement pstmt6 = conn
						.prepareStatement(&quot;select aa.game_id, bb.organization_id from ((select organization_id from st_lms_organization_master where name=?) bb, ( select game_id from st_dg_game_master where game_nbr=? and game_name=? )aa) &quot;);
				pstmt6.setString(1, agtOrgName.trim());
				pstmt6.setInt(2, Integer.parseInt(game[0]));
				pstmt6.setString(3, game[1]);
				ResultSet rs6 = pstmt6.executeQuery();
				System.out.println(&quot;query = &quot; + pstmt6);
				int gameId = 0;
				int agtOrgid = 0;
				if (rs6.next()) {
					gameId = rs6.getInt(&quot;game_id&quot;);
					agtOrgid = rs6.getInt(&quot;organization_id&quot;);
				}*/
<span class="nc bnc" id="L1929" title="All 4 branches missed.">				if (gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L1930">					PreparedStatement pstmt5 = conn</span>
							.prepareStatement(&quot;insert into st_dg_bo_agent_sale_pwt_comm_variance  values (? , ? , ? ,?,?, ?)&quot;);
<span class="nc" id="L1932">					pstmt5.setInt(1, orgId);</span>
<span class="nc" id="L1933">					pstmt5.setInt(2, gameId);</span>
<span class="nc" id="L1934">					pstmt5.setDouble(3, saleCommVar1);</span>
<span class="nc" id="L1935">					pstmt5.setDouble(4, dSaleCommRate);</span>
<span class="nc" id="L1936">					pstmt5.setDouble(5, pwtCommVar1);</span>
<span class="nc" id="L1937">					pstmt5.setDouble(6, dPwtCommRate);</span>
<span class="nc" id="L1938">					int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L1939">					System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L1940">					System.out</span>
							.println(&quot;insert entries st_dg_bo_agent_sale_pwt_comm_variance  table updated rows === &quot;
									+ rows);
<span class="nc" id="L1943">					pstmt5.close();</span>
					
					
					  /* //here update the updated comm rate in the context
					   //System.out.println(&quot;var in context before: &quot; + Util.getSaleCommVariance(retOrgid, gameId));
						double retUpdatedCommVar = CommonFunctionsHelper.fetchDGCommOfOrganization(gameId, agtOrgid, &quot;SALE&quot;, &quot;AGENT&quot;, conn);
						Util.updateSaleCommVariance(agtOrgid, gameId,retUpdatedCommVar);
						System.out.println(&quot;var in context after updation: &quot; + Util.getSaleCommVariance(agtOrgid, gameId));
					    //updated successfully
*/						
					
				}

<span class="nc bnc" id="L1956" title="All 6 branches missed.">				if (commVarianceBean == null &amp;&amp; gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L1957">					System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L1958">					PreparedStatement pstmt3 = conn</span>
							.prepareStatement(&quot;insert into st_dg_bo_agent_sale_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L1960">					pstmt3.setInt(1, orgId);</span>
<span class="nc" id="L1961">					pstmt3.setInt(2, gameId);</span>
<span class="nc" id="L1962">					pstmt3.setDouble(3, 0.0);</span>
<span class="nc" id="L1963">					pstmt3.setTimestamp(4, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L1965">					int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L1966">					System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L1967">					System.out</span>
							.println(&quot;sale comm var history table updated rows === &quot;
									+ rows);
<span class="nc" id="L1970">					pstmt3.close();</span>
				}

<span class="nc bnc" id="L1973" title="All 6 branches missed.">				if (commVarianceBean == null &amp;&amp; gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L1974">					System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L1975">					PreparedStatement pstmt4 = conn</span>
							.prepareStatement(&quot;insert into st_dg_bo_agent_pwt_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L1977">					pstmt4.setInt(1, orgId);</span>
<span class="nc" id="L1978">					pstmt4.setInt(2, gameId);</span>
<span class="nc" id="L1979">					pstmt4.setDouble(3, 0.0);</span>
<span class="nc" id="L1980">					pstmt4.setTimestamp(4, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L1982">					int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L1983">					System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L1984">					System.out</span>
							.println(&quot;PWT comm var history table updated rows === &quot;
									+ rows);
<span class="nc" id="L1987">					pstmt4.close();</span>
				}

			}
			
			 //here update the updated comm rate in the context
			   //System.out.println(&quot;var in context before: &quot; + Util.getSaleCommVariance(retOrgid, gameId));
<span class="nc" id="L1994">				double retUpdatedCommVar = CommonFunctionsHelper.fetchDGCommOfOrganization(gameId, orgId, &quot;SALE&quot;, &quot;AGENT&quot;, conn);</span>
<span class="nc" id="L1995">				Util.updateSaleCommVariance(orgId, gameId,retUpdatedCommVar);</span>
<span class="nc" id="L1996">				System.out.println(&quot;var in context after updation: &quot; + Util.getSaleCommVariance(orgId, gameId));</span>
			    //updated successfully
			
<span class="nc" id="L1999">			conn.commit();</span>
<span class="nc" id="L2000">		} catch (SQLException se) {</span>
			try {
<span class="nc" id="L2002">				System.out.println(&quot;rolled back&quot;);</span>
<span class="nc" id="L2003">				conn.rollback();</span>
<span class="nc" id="L2004">			} catch (SQLException e) {</span>
<span class="nc" id="L2005">				e.printStackTrace();</span>
				// throw new LMSException(e);
<span class="nc" id="L2007">			}</span>
<span class="nc" id="L2008">			se.printStackTrace();</span>
<span class="nc" id="L2009">			throw new LMSException(se);</span>

		} finally {

<span class="nc" id="L2013">			try {</span>
<span class="nc bnc" id="L2014" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L2015">					conn.close();</span>
				}
<span class="nc" id="L2017">			} catch (SQLException e) {</span>
<span class="nc" id="L2018">				e.printStackTrace();</span>
<span class="nc" id="L2019">			}</span>

<span class="nc" id="L2021">		}</span>

<span class="nc" id="L2023">		return &quot;SUCCESS&quot;;</span>
	}
	
	public String submitUpdatedValueIW(String agtOrgName, String gname, String defSaleCommRate, String saleCommVar, String defPwtCommRate, String pwtCommVar) throws LMSException {
<span class="nc" id="L2027">		String game[] = gname.split(&quot;-&quot;);</span>
<span class="nc" id="L2028">		double dSaleCommRate = Double.parseDouble(defSaleCommRate.trim());</span>
<span class="nc" id="L2029">		double saleCommVar1 = Double.parseDouble(saleCommVar.trim());</span>
<span class="nc" id="L2030">		double dPwtCommRate = Double.parseDouble(defPwtCommRate.trim());</span>
<span class="nc" id="L2031">		double pwtCommVar1 = Double.parseDouble(pwtCommVar.trim());</span>
<span class="nc" id="L2032">		UpdateSalePwtCommVarBean commVarianceBean = null;</span>
<span class="nc" id="L2033">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L2034">		boolean flagforZero = false;</span>
		try {
<span class="nc" id="L2036">			conn.setAutoCommit(false);</span>
<span class="nc" id="L2037">			int orgId = Integer.parseInt(agtOrgName);</span>
<span class="nc" id="L2038">			PreparedStatement pstmt1 = conn.prepareStatement(&quot;select agent_org_id, game_id, sale_comm_variance, default_sale_comm_rate, pwt_comm_variance, default_pwt_comm_rate from st_iw_bo_agent_sale_pwt_comm_variance where game_id=&quot; + game[0] + &quot;  and agent_org_id= &quot; + orgId + &quot; &quot;);</span>
<span class="nc" id="L2039">			System.out.println(&quot;query = &quot; + pstmt1);</span>
<span class="nc" id="L2040">			ResultSet rs1 = pstmt1.executeQuery();</span>
<span class="nc bnc" id="L2041" title="All 2 branches missed.">			if (rs1.next()) {</span>
<span class="nc" id="L2042">				System.out.println(&quot;inside pstmt1---11111111&quot;);</span>
<span class="nc" id="L2043">				double oldPwtCommVar = rs1.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L2044">				double oldSaleCommVar = rs1.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc bnc" id="L2045" title="All 4 branches missed.">				if (oldPwtCommVar == pwtCommVar1 &amp;&amp; saleCommVar1 == oldSaleCommVar) {</span>
<span class="nc" id="L2046">					return &quot;SAME_VALUES&quot;;</span>
				}

<span class="nc" id="L2049">				commVarianceBean = new UpdateSalePwtCommVarBean();</span>
<span class="nc" id="L2050">				commVarianceBean.setAgentOrgId(rs1.getInt(&quot;agent_org_id&quot;));</span>
<span class="nc" id="L2051">				commVarianceBean.setGameId(rs1.getInt(&quot;game_id&quot;));</span>
<span class="nc" id="L2052">				commVarianceBean.setSaleCommVar(oldSaleCommVar);</span>
<span class="nc" id="L2053">				commVarianceBean.setDefaultSaleCommRate(rs1.getDouble(&quot;default_sale_comm_rate&quot;));</span>
<span class="nc" id="L2054">				commVarianceBean.setPwtCommVar(oldPwtCommVar);</span>
<span class="nc" id="L2055">				commVarianceBean.setDefaultPwtCommRate(rs1.getDouble(&quot;default_pwt_comm_rate&quot;));</span>
<span class="nc" id="L2056">				System.out.println(&quot;inside pstmt1---22222222&quot;);</span>
			}
<span class="nc" id="L2058">			pstmt1.close();</span>
<span class="nc" id="L2059">			rs1.close();</span>

<span class="nc bnc" id="L2061" title="All 2 branches missed.">			if (commVarianceBean != null) {</span>
<span class="nc" id="L2062">				System.out.println(&quot;555555555555555&quot;);</span>
<span class="nc" id="L2063">				PreparedStatement pstmt5 = conn.prepareStatement(&quot;delete from st_iw_bo_agent_sale_pwt_comm_variance  where game_id=? and agent_org_id=?&quot;);</span>
<span class="nc" id="L2064">				pstmt5.setInt(1, commVarianceBean.getGameId());</span>
<span class="nc" id="L2065">				pstmt5.setInt(2, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L2066">				int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L2067">				System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L2068">				System.out.println(&quot;Delete entry from st_dg_bo_agent_sale_pwt_comm_variance  table updated rows === &quot; + rows);</span>
<span class="nc" id="L2069">				pstmt5.close();</span>
<span class="nc" id="L2070">				flagforZero = true;</span>
			}

<span class="nc bnc" id="L2073" title="All 4 branches missed.">			if (commVarianceBean != null</span>
					&amp;&amp; saleCommVar1 != commVarianceBean.getSaleCommVar()) {
<span class="nc" id="L2075">				System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L2076">				PreparedStatement pstmt3 = conn.prepareStatement(&quot;insert into st_iw_bo_agent_sale_comm_variance_history values(?, ?, ?, ?)&quot;);</span>
<span class="nc" id="L2077">				pstmt3.setInt(1, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L2078">				pstmt3.setInt(2, commVarianceBean.getGameId());</span>
<span class="nc" id="L2079">				pstmt3.setDouble(3, commVarianceBean.getSaleCommVar());</span>
<span class="nc" id="L2080">				pstmt3.setTimestamp(4, new java.sql.Timestamp(new java.util.Date().getTime()));</span>
<span class="nc" id="L2081">				int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L2082">				System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L2083">				System.out.println(&quot;sale comm var history table updated rows === &quot; + rows);</span>
<span class="nc" id="L2084">				pstmt3.close();</span>
			}

<span class="nc bnc" id="L2087" title="All 4 branches missed.">			if (commVarianceBean != null &amp;&amp; pwtCommVar1 != commVarianceBean.getPwtCommVar()) {</span>
<span class="nc" id="L2088">				System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L2089">				PreparedStatement pstmt4 = conn</span>
						.prepareStatement(&quot;insert into st_iw_bo_agent_pwt_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L2091">				pstmt4.setInt(1, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L2092">				pstmt4.setInt(2, commVarianceBean.getGameId());</span>
<span class="nc" id="L2093">				pstmt4.setDouble(3, commVarianceBean.getPwtCommVar());</span>
<span class="nc" id="L2094">				pstmt4.setTimestamp(4, new java.sql.Timestamp(new java.util.Date().getTime()));</span>
<span class="nc" id="L2095">				int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L2096">				System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L2097">				System.out.println(&quot;PWT comm var history table updated rows === &quot; + rows);</span>
<span class="nc" id="L2098">				pstmt4.close();</span>
			}

<span class="nc" id="L2101">			System.out.println(saleCommVar1 + &quot; **saleCommVar1** &quot; + pwtCommVar1);</span>
<span class="nc bnc" id="L2102" title="All 4 branches missed.">			System.out.println(&quot;saleCommVar1!=0.0 ||  pwtCommVar1!=0.0&quot; + (saleCommVar1 != 0.0 || pwtCommVar1 != 0.0));</span>
			/*
			 * PreparedStatement pstmt6 = conn .prepareStatement(
			 * &quot;select aa.game_id, bb.organization_id from ((select organization_id from st_lms_organization_master where name=?) bb, ( select game_id from st_dg_game_master where game_nbr=? )aa) &quot;
			 * ); pstmt6.setString(1, agtOrgName.trim()); pstmt6.setInt(2,
			 * Integer.parseInt(game[0]));
			 */

			/*
			 * PreparedStatement pstmt6 = conn .prepareStatement(
			 * &quot; select game_id from st_dg_game_master where game_nbr=?   &quot;);
			 * 
			 * pstmt6.setInt(1, Integer.parseInt(game[0]));
			 * //pstmt6.setString(3, game[1]); ResultSet rs6 =
			 * pstmt6.executeQuery(); System.out.println(&quot;query = &quot; + pstmt6);
			 */
<span class="nc" id="L2118">			int gameId = Integer.parseInt(game[0]);</span>
			// int agtOrgid1 = 0;
			/*
			 * if (rs6.next()) { gameId = rs6.getInt(&quot;game_id&quot;); // agtOrgid =
			 * rs6.getInt(&quot;organization_id&quot;); }
			 */
<span class="nc bnc" id="L2124" title="All 4 branches missed.">			if (saleCommVar1 != 0.0 || pwtCommVar1 != 0.0) {</span>
<span class="nc" id="L2125">				System.out.println(&quot;66666666666666666666666666&quot;);</span>
				/*
				 * PreparedStatement pstmt6 = conn .prepareStatement(
				 * &quot;select aa.game_id, bb.organization_id from ((select organization_id from st_lms_organization_master where name=?) bb, ( select game_id from st_dg_game_master where game_nbr=? and game_name=? )aa) &quot;
				 * ); pstmt6.setString(1, agtOrgName.trim()); pstmt6.setInt(2,
				 * Integer.parseInt(game[0])); pstmt6.setString(3, game[1]);
				 * ResultSet rs6 = pstmt6.executeQuery();
				 * System.out.println(&quot;query = &quot; + pstmt6); int gameId = 0; int
				 * agtOrgid = 0; if (rs6.next()) { gameId =
				 * rs6.getInt(&quot;game_id&quot;); agtOrgid =
				 * rs6.getInt(&quot;organization_id&quot;); }
				 */
<span class="nc bnc" id="L2137" title="All 4 branches missed.">				if (gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2138">					PreparedStatement pstmt5 = conn.prepareStatement(&quot;insert into st_iw_bo_agent_sale_pwt_comm_variance  values (? , ? , ? ,?,?, ?)&quot;);</span>
<span class="nc" id="L2139">					pstmt5.setInt(1, orgId);</span>
<span class="nc" id="L2140">					pstmt5.setInt(2, gameId);</span>
<span class="nc" id="L2141">					pstmt5.setDouble(3, saleCommVar1);</span>
<span class="nc" id="L2142">					pstmt5.setDouble(4, dSaleCommRate);</span>
<span class="nc" id="L2143">					pstmt5.setDouble(5, pwtCommVar1);</span>
<span class="nc" id="L2144">					pstmt5.setDouble(6, dPwtCommRate);</span>
<span class="nc" id="L2145">					int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L2146">					System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L2147">					System.out.println(&quot;insert entries st_iw_bo_agent_sale_pwt_comm_variance  table updated rows === &quot; + rows);</span>
<span class="nc" id="L2148">					pstmt5.close();</span>

					/*
					 * //here update the updated comm rate in the context
					 * //System.out.println(&quot;var in context before: &quot; +
					 * Util.getSaleCommVariance(retOrgid, gameId)); double
					 * retUpdatedCommVar =
					 * CommonFunctionsHelper.fetchDGCommOfOrganization(gameId,
					 * agtOrgid, &quot;SALE&quot;, &quot;AGENT&quot;, conn);
					 * Util.updateSaleCommVariance(agtOrgid,
					 * gameId,retUpdatedCommVar);
					 * System.out.println(&quot;var in context after updation: &quot; +
					 * Util.getSaleCommVariance(agtOrgid, gameId)); //updated
					 * successfully
					 */

				}

<span class="nc bnc" id="L2166" title="All 6 branches missed.">				if (commVarianceBean == null &amp;&amp; gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2167">					System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L2168">					PreparedStatement pstmt3 = conn.prepareStatement(&quot;insert into st_iw_bo_agent_sale_comm_variance_history values(?, ?, ?, ?)&quot;);</span>
<span class="nc" id="L2169">					pstmt3.setInt(1, orgId);</span>
<span class="nc" id="L2170">					pstmt3.setInt(2, gameId);</span>
<span class="nc" id="L2171">					pstmt3.setDouble(3, 0.0);</span>
<span class="nc" id="L2172">					pstmt3.setTimestamp(4, new java.sql.Timestamp(new java.util.Date().getTime()));</span>
<span class="nc" id="L2173">					int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L2174">					System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L2175">					System.out.println(&quot;sale comm var history table updated rows === &quot; + rows);</span>
<span class="nc" id="L2176">					pstmt3.close();</span>
				}

<span class="nc bnc" id="L2179" title="All 6 branches missed.">				if (commVarianceBean == null &amp;&amp; gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2180">					System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L2181">					PreparedStatement pstmt4 = conn.prepareStatement(&quot;insert into st_iw_bo_agent_pwt_comm_variance_history values(?, ?, ?, ?)&quot;);</span>
<span class="nc" id="L2182">					pstmt4.setInt(1, orgId);</span>
<span class="nc" id="L2183">					pstmt4.setInt(2, gameId);</span>
<span class="nc" id="L2184">					pstmt4.setDouble(3, 0.0);</span>
<span class="nc" id="L2185">					pstmt4.setTimestamp(4, new java.sql.Timestamp(new java.util.Date().getTime()));</span>
<span class="nc" id="L2186">					int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L2187">					System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L2188">					System.out.println(&quot;PWT comm var history table updated rows === &quot; + rows);</span>
<span class="nc" id="L2189">					pstmt4.close();</span>
				}
			}

			// here update the updated comm rate in the context
			// System.out.println(&quot;var in context before: &quot; +
			// Util.getSaleCommVariance(retOrgid, gameId));
<span class="nc" id="L2196">			double retUpdatedCommVar = CommonFunctionsHelper.fetchIWCommOfOrganization(gameId, orgId, &quot;SALE&quot;, &quot;AGENT&quot;, conn);</span>
<span class="nc" id="L2197">			Util.updateSaleCommVarianceIW(orgId, gameId, retUpdatedCommVar);</span>
<span class="nc" id="L2198">			System.out.println(&quot;var in context after updation: &quot; + Util.getIWSaleCommVariance(orgId, gameId));</span>
			// updated successfully
<span class="nc" id="L2200">			conn.commit();</span>
<span class="nc" id="L2201">		} catch (SQLException se) {</span>
			try {
<span class="nc" id="L2203">				System.out.println(&quot;rolled back&quot;);</span>
<span class="nc" id="L2204">				conn.rollback();</span>
<span class="nc" id="L2205">			} catch (SQLException e) {</span>
<span class="nc" id="L2206">				e.printStackTrace();</span>
				// throw new LMSException(e);
<span class="nc" id="L2208">			}</span>
<span class="nc" id="L2209">			se.printStackTrace();</span>
<span class="nc" id="L2210">			throw new LMSException(se);</span>

		} finally {

<span class="nc" id="L2214">			try {</span>
<span class="nc bnc" id="L2215" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L2216">					conn.close();</span>
				}
<span class="nc" id="L2218">			} catch (SQLException e) {</span>
<span class="nc" id="L2219">				e.printStackTrace();</span>
<span class="nc" id="L2220">			}</span>

<span class="nc" id="L2222">		}</span>
<span class="nc" id="L2223">		return &quot;SUCCESS&quot;;</span>
	}

	public String submitUpdatedValue(String agtOrgName, String gname,
			String defSaleCommRate, String saleCommVar, String defPwtCommRate,
			String pwtCommVar) throws LMSException {

<span class="nc" id="L2230">		String game[] = gname.split(&quot;-&quot;);</span>
<span class="nc" id="L2231">		double dSaleCommRate = Double.parseDouble(defSaleCommRate.trim());</span>
<span class="nc" id="L2232">		double saleCommVar1 = Double.parseDouble(saleCommVar.trim());</span>
<span class="nc" id="L2233">		double dPwtCommRate = Double.parseDouble(defPwtCommRate.trim());</span>
<span class="nc" id="L2234">		double pwtCommVar1 = Double.parseDouble(pwtCommVar.trim());</span>
<span class="nc" id="L2235">		UpdateSalePwtCommVarBean commVarianceBean = null;</span>
<span class="nc" id="L2236">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L2237">		boolean flagforZero = false;</span>
		try {
<span class="nc" id="L2239">			conn.setAutoCommit(false);</span>
<span class="nc" id="L2240">			int orgId = Integer.parseInt(agtOrgName);</span>
<span class="nc" id="L2241">			PreparedStatement pstmt1 = conn</span>
					.prepareStatement(&quot;select agent_org_id, game_id, sale_comm_variance, default_sale_comm_rate, pwt_comm_variance, default_pwt_comm_rate from st_se_bo_agent_sale_pwt_comm_variance where game_id=(select game_id from st_se_game_master where game_nbr=&quot;
							+ game[0]+ &quot;) and agent_org_id=&quot;
							+ orgId + &quot;&quot;);
<span class="nc" id="L2245">			ResultSet rs1 = pstmt1.executeQuery();</span>
<span class="nc" id="L2246">			System.out.println(&quot;query = &quot; + pstmt1);</span>
<span class="nc bnc" id="L2247" title="All 2 branches missed.">			if (rs1.next()) {</span>
<span class="nc" id="L2248">				System.out.println(&quot;inside pstmt1---11111111&quot;);</span>
<span class="nc" id="L2249">				double oldPwtCommVar = rs1.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L2250">				double oldSaleCommVar = rs1.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc bnc" id="L2251" title="All 4 branches missed.">				if (oldPwtCommVar == pwtCommVar1</span>
						&amp;&amp; saleCommVar1 == oldSaleCommVar) {
<span class="nc" id="L2253">					return &quot;SAME_VALUES&quot;;</span>
				}

<span class="nc" id="L2256">				commVarianceBean = new UpdateSalePwtCommVarBean();</span>
<span class="nc" id="L2257">				commVarianceBean.setAgentOrgId(rs1.getInt(&quot;agent_org_id&quot;));</span>
<span class="nc" id="L2258">				commVarianceBean.setGameId(rs1.getInt(&quot;game_id&quot;));</span>
<span class="nc" id="L2259">				commVarianceBean.setSaleCommVar(oldSaleCommVar);</span>
<span class="nc" id="L2260">				commVarianceBean.setDefaultSaleCommRate(rs1</span>
						.getDouble(&quot;default_sale_comm_rate&quot;));
<span class="nc" id="L2262">				commVarianceBean.setPwtCommVar(oldPwtCommVar);</span>
<span class="nc" id="L2263">				commVarianceBean.setDefaultPwtCommRate(rs1</span>
						.getDouble(&quot;default_pwt_comm_rate&quot;));
<span class="nc" id="L2265">				System.out.println(&quot;inside pstmt1---22222222&quot;);</span>
			}
<span class="nc" id="L2267">			pstmt1.close();</span>
<span class="nc" id="L2268">			rs1.close();</span>

<span class="nc bnc" id="L2270" title="All 2 branches missed.">			if (commVarianceBean != null) {</span>
<span class="nc" id="L2271">				System.out.println(&quot;555555555555555&quot;);</span>
<span class="nc" id="L2272">				PreparedStatement pstmt5 = conn</span>
						.prepareStatement(&quot;delete from st_se_bo_agent_sale_pwt_comm_variance  where game_id=? and agent_org_id=?&quot;);
<span class="nc" id="L2274">				pstmt5.setInt(1, commVarianceBean.getGameId());</span>
<span class="nc" id="L2275">				pstmt5.setInt(2, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L2276">				int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L2277">				System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L2278">				System.out</span>
						.println(&quot;Delete entry from st_se_bo_agent_sale_pwt_comm_variance  table updated rows === &quot;
								+ rows);
<span class="nc" id="L2281">				pstmt5.close();</span>
<span class="nc" id="L2282">				flagforZero = true;</span>
			}

<span class="nc bnc" id="L2285" title="All 4 branches missed.">			if (commVarianceBean != null</span>
					&amp;&amp; saleCommVar1 != commVarianceBean.getSaleCommVar()) {
<span class="nc" id="L2287">				System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L2288">				PreparedStatement pstmt3 = conn</span>
						.prepareStatement(&quot;insert into st_se_bo_agent_sale_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L2290">				pstmt3.setInt(1, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L2291">				pstmt3.setInt(2, commVarianceBean.getGameId());</span>
<span class="nc" id="L2292">				pstmt3.setDouble(3, commVarianceBean.getSaleCommVar());</span>
<span class="nc" id="L2293">				pstmt3.setTimestamp(4, new java.sql.Timestamp(</span>
						new java.util.Date().getTime()));
<span class="nc" id="L2295">				int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L2296">				System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L2297">				System.out</span>
						.println(&quot;sale comm var history table updated rows === &quot;
								+ rows);
<span class="nc" id="L2300">				pstmt3.close();</span>
			}

<span class="nc bnc" id="L2303" title="All 4 branches missed.">			if (commVarianceBean != null</span>
					&amp;&amp; pwtCommVar1 != commVarianceBean.getPwtCommVar()) {
<span class="nc" id="L2305">				System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L2306">				PreparedStatement pstmt4 = conn</span>
						.prepareStatement(&quot;insert into st_se_bo_agent_pwt_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L2308">				pstmt4.setInt(1, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L2309">				pstmt4.setInt(2, commVarianceBean.getGameId());</span>
<span class="nc" id="L2310">				pstmt4.setDouble(3, commVarianceBean.getPwtCommVar());</span>
<span class="nc" id="L2311">				pstmt4.setTimestamp(4, new java.sql.Timestamp(</span>
						new java.util.Date().getTime()));
<span class="nc" id="L2313">				int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L2314">				System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L2315">				System.out</span>
						.println(&quot;PWT comm var history table updated rows === &quot;
								+ rows);
<span class="nc" id="L2318">				pstmt4.close();</span>
			}

<span class="nc" id="L2321">			System.out.println(saleCommVar1 + &quot; **saleCommVar1** &quot;</span>
					+ pwtCommVar1);
<span class="nc bnc" id="L2323" title="All 4 branches missed.">			System.out.println(&quot;saleCommVar1!=0.0 ||  pwtCommVar1!=0.0&quot;</span>
					+ (saleCommVar1 != 0.0 || pwtCommVar1 != 0.0));
<span class="nc bnc" id="L2325" title="All 4 branches missed.">			if (saleCommVar1 != 0.0 || pwtCommVar1 != 0.0) {</span>
<span class="nc" id="L2326">				System.out.println(&quot;66666666666666666666666666&quot;);</span>
<span class="nc" id="L2327">				PreparedStatement pstmt6 = conn</span>
						.prepareStatement(&quot; select game_id from st_se_game_master where game_nbr=? and game_name=?   &quot;);
			//	pstmt6.setString(1, agtOrgName.trim());
<span class="nc" id="L2330">				pstmt6.setInt(1, Integer.parseInt(game[0]));</span>
<span class="nc" id="L2331">				pstmt6.setString(2, game[1]);</span>
<span class="nc" id="L2332">				ResultSet rs6 = pstmt6.executeQuery();</span>
<span class="nc" id="L2333">				System.out.println(&quot;query = &quot; + pstmt6);</span>
<span class="nc" id="L2334">				int gameId = 0;</span>
				//int agtOrgid = 0;
<span class="nc bnc" id="L2336" title="All 2 branches missed.">				if (rs6.next()) {</span>
<span class="nc" id="L2337">					gameId = rs6.getInt(&quot;game_id&quot;);</span>
					// agtOrgid = rs6.getInt(&quot;organization_id&quot;);
				}
<span class="nc bnc" id="L2340" title="All 4 branches missed.">				if (gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2341">					PreparedStatement pstmt5 = conn</span>
							.prepareStatement(&quot;insert into st_se_bo_agent_sale_pwt_comm_variance  values (? , ? , ? ,?,?, ?)&quot;);
<span class="nc" id="L2343">					pstmt5.setInt(1, orgId);</span>
<span class="nc" id="L2344">					pstmt5.setInt(2, gameId);</span>
<span class="nc" id="L2345">					pstmt5.setDouble(3, saleCommVar1);</span>
<span class="nc" id="L2346">					pstmt5.setDouble(4, dSaleCommRate);</span>
<span class="nc" id="L2347">					pstmt5.setDouble(5, pwtCommVar1);</span>
<span class="nc" id="L2348">					pstmt5.setDouble(6, dPwtCommRate);</span>
<span class="nc" id="L2349">					int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L2350">					System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L2351">					System.out</span>
							.println(&quot;insert entries st_se_bo_agent_sale_pwt_comm_variance  table updated rows === &quot;
									+ rows);
<span class="nc" id="L2354">					pstmt5.close();</span>
				}

<span class="nc bnc" id="L2357" title="All 6 branches missed.">				if (commVarianceBean == null &amp;&amp; gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2358">					System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L2359">					PreparedStatement pstmt3 = conn</span>
							.prepareStatement(&quot;insert into st_se_bo_agent_sale_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L2361">					pstmt3.setInt(1, orgId);</span>
<span class="nc" id="L2362">					pstmt3.setInt(2, gameId);</span>
<span class="nc" id="L2363">					pstmt3.setDouble(3, 0.0);</span>
<span class="nc" id="L2364">					pstmt3.setTimestamp(4, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L2366">					int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L2367">					System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L2368">					System.out</span>
							.println(&quot;sale comm var history table updated rows === &quot;
									+ rows);
<span class="nc" id="L2371">					pstmt3.close();</span>
				}

<span class="nc bnc" id="L2374" title="All 6 branches missed.">				if (commVarianceBean == null &amp;&amp; gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2375">					System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L2376">					PreparedStatement pstmt4 = conn</span>
							.prepareStatement(&quot;insert into st_se_bo_agent_pwt_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L2378">					pstmt4.setInt(1, orgId);</span>
<span class="nc" id="L2379">					pstmt4.setInt(2, gameId);</span>
<span class="nc" id="L2380">					pstmt4.setDouble(3, 0.0);</span>
<span class="nc" id="L2381">					pstmt4.setTimestamp(4, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L2383">					int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L2384">					System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L2385">					System.out</span>
							.println(&quot;PWT comm var history table updated rows === &quot;
									+ rows);
<span class="nc" id="L2388">					pstmt4.close();</span>
				}

			}
<span class="nc" id="L2392">			conn.commit();</span>
<span class="nc" id="L2393">		} catch (SQLException se) {</span>
			try {
<span class="nc" id="L2395">				System.out.println(&quot;rollbacked&quot;);</span>
<span class="nc" id="L2396">				conn.rollback();</span>
<span class="nc" id="L2397">			} catch (SQLException e) {</span>
<span class="nc" id="L2398">				e.printStackTrace();</span>
				// throw new LMSException(e);
<span class="nc" id="L2400">			}</span>
<span class="nc" id="L2401">			se.printStackTrace();</span>
<span class="nc" id="L2402">			throw new LMSException(se);</span>

		} finally {

<span class="nc" id="L2406">			try {</span>
<span class="nc bnc" id="L2407" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L2408">					conn.close();</span>
				}
<span class="nc" id="L2410">			} catch (SQLException e) {</span>
<span class="nc" id="L2411">				e.printStackTrace();</span>
<span class="nc" id="L2412">			}</span>

<span class="nc" id="L2414">		}</span>

<span class="nc" id="L2416">		return &quot;SUCCESS&quot;;</span>
	}
	
	public String submitUpdatedValueOLA(String agtOrgName, String wname,
			String defWidCommRate, String widCommVar, String defDepCommRate,
			String depCommVar, String defNetGCommRate, String netGCommVar) throws LMSException{

<span class="nc" id="L2423">		String wallet[] = wname.split(&quot;-&quot;);</span>
<span class="nc" id="L2424">		double dWidCommRate = Double.parseDouble(defWidCommRate.trim());</span>
<span class="nc" id="L2425">		double widCommVar1 = Double.parseDouble(widCommVar.trim());</span>
<span class="nc" id="L2426">		double dDepCommRate = Double.parseDouble(defDepCommRate.trim());</span>
<span class="nc" id="L2427">		double depCommVar1 = Double.parseDouble(depCommVar.trim());</span>
<span class="nc" id="L2428">		double dNetGCommRate = Double.parseDouble(defNetGCommRate.trim());</span>
<span class="nc" id="L2429">		double netGCommVar1 = Double.parseDouble(netGCommVar.trim());</span>
<span class="nc" id="L2430">		UpdateSalePwtCommVarBean commVarianceBean = null;</span>
<span class="nc" id="L2431">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L2432">		boolean flagforZero = false;</span>
		try {
<span class="nc" id="L2434">			conn.setAutoCommit(false);</span>
<span class="nc" id="L2435">			int orgId =Integer.parseInt(agtOrgName);</span>
<span class="nc" id="L2436">			PreparedStatement pstmt1 = conn</span>
					.prepareStatement(&quot;select agent_org_id, wallet_id, deposit_comm_variance, default_deposit_comm_rate, withdrawl_comm_variance, default_withdrawl_comm_rate, net_gaming_comm_variance, default_net_gaming_comm_rate from st_ola_bo_agent_comm_variance where wallet_id = &quot;
										+ wallet[0]
										+ &quot; and agent_org_id=&quot;
										+ orgId +&quot;&quot;);
<span class="nc" id="L2441">			ResultSet rs1 = pstmt1.executeQuery();</span>
<span class="nc" id="L2442">			System.out.println(&quot;query = &quot; + pstmt1);</span>
<span class="nc bnc" id="L2443" title="All 2 branches missed.">			if (rs1.next()) {</span>
<span class="nc" id="L2444">				System.out.println(&quot;inside pstmt1---11111111&quot;);</span>
<span class="nc" id="L2445">				double oldDepCommVar = rs1.getDouble(&quot;deposit_comm_variance&quot;);</span>
<span class="nc" id="L2446">				double oldWidCommVar = rs1.getDouble(&quot;withdrawl_comm_variance&quot;);</span>
<span class="nc" id="L2447">				double oldNetGCommVar = rs1.getDouble(&quot;net_gaming_comm_variance&quot;);</span>
<span class="nc bnc" id="L2448" title="All 6 branches missed.">				if (oldDepCommVar == depCommVar1</span>
						&amp;&amp; widCommVar1 == oldWidCommVar &amp;&amp; netGCommVar1 == oldNetGCommVar) {
<span class="nc" id="L2450">					return &quot;SAME_VALUES&quot;;</span>
				}

<span class="nc" id="L2453">				commVarianceBean = new UpdateSalePwtCommVarBean();</span>
<span class="nc" id="L2454">				commVarianceBean.setAgentOrgId(rs1.getInt(&quot;agent_org_id&quot;));</span>
<span class="nc" id="L2455">				commVarianceBean.setGameId(rs1.getInt(&quot;wallet_id&quot;));</span>
<span class="nc" id="L2456">				commVarianceBean.setWidCommVar(oldWidCommVar);</span>
<span class="nc" id="L2457">				commVarianceBean.setDefaultWidCommRate(rs1</span>
						.getDouble(&quot;default_withdrawl_comm_rate&quot;));
<span class="nc" id="L2459">				commVarianceBean.setDepCommVar(oldDepCommVar);</span>
<span class="nc" id="L2460">				commVarianceBean.setDefaultDepCommRate(rs1</span>
						.getDouble(&quot;default_deposit_comm_rate&quot;));
<span class="nc" id="L2462">				commVarianceBean.setNetGCommVar(oldNetGCommVar);</span>
<span class="nc" id="L2463">				commVarianceBean.setDefaultNetGCommRate(rs1</span>
						.getDouble(&quot;default_net_gaming_comm_rate&quot;));
<span class="nc" id="L2465">				System.out.println(&quot;inside pstmt1---22222222&quot;);</span>
			}
<span class="nc" id="L2467">			pstmt1.close();</span>
<span class="nc" id="L2468">			rs1.close();</span>

<span class="nc bnc" id="L2470" title="All 2 branches missed.">			if (commVarianceBean != null) {</span>
<span class="nc" id="L2471">				System.out.println(&quot;555555555555555&quot;);</span>
<span class="nc" id="L2472">				PreparedStatement pstmt5 = conn</span>
						.prepareStatement(&quot;delete from st_ola_bo_agent_comm_variance  where wallet_id=? and agent_org_id=?&quot;);
<span class="nc" id="L2474">				pstmt5.setInt(1, commVarianceBean.getGameId());</span>
<span class="nc" id="L2475">				pstmt5.setInt(2, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L2476">				int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L2477">				System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L2478">				System.out</span>
						.println(&quot;Delete entry from st_ola_bo_agent_variance  table updated rows === &quot;
								+ rows);
<span class="nc" id="L2481">				pstmt5.close();</span>
<span class="nc" id="L2482">				flagforZero = true;</span>
			}

<span class="nc bnc" id="L2485" title="All 4 branches missed.">			if (commVarianceBean != null</span>
					&amp;&amp; widCommVar1 != commVarianceBean.getWidCommVar()) {
<span class="nc" id="L2487">				System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L2488">				PreparedStatement pstmt3 = conn</span>
						.prepareStatement(&quot;insert into st_ola_bo_agent_withdrawl_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L2490">				pstmt3.setInt(1, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L2491">				pstmt3.setInt(2, commVarianceBean.getGameId());</span>
<span class="nc" id="L2492">				pstmt3.setDouble(3, commVarianceBean.getWidCommVar());</span>
<span class="nc" id="L2493">				pstmt3.setTimestamp(4, new java.sql.Timestamp(</span>
						new java.util.Date().getTime()));
<span class="nc" id="L2495">				int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L2496">				System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L2497">				System.out</span>
						.println(&quot;sale comm var history table updated rows === &quot;
								+ rows);
<span class="nc" id="L2500">				pstmt3.close();</span>
			}

<span class="nc bnc" id="L2503" title="All 4 branches missed.">			if (commVarianceBean != null</span>
					&amp;&amp; depCommVar1 != commVarianceBean.getDepCommVar()) {
<span class="nc" id="L2505">				System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L2506">				PreparedStatement pstmt4 = conn</span>
						.prepareStatement(&quot;insert into st_ola_bo_agent_deposit_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L2508">				pstmt4.setInt(1, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L2509">				pstmt4.setInt(2, commVarianceBean.getGameId());</span>
<span class="nc" id="L2510">				pstmt4.setDouble(3, commVarianceBean.getDepCommVar());</span>
<span class="nc" id="L2511">				pstmt4.setTimestamp(4, new java.sql.Timestamp(</span>
						new java.util.Date().getTime()));
<span class="nc" id="L2513">				int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L2514">				System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L2515">				System.out</span>
						.println(&quot;Deposit comm var history table updated rows === &quot;
								+ rows);
<span class="nc" id="L2518">				pstmt4.close();</span>
			}
			
<span class="nc bnc" id="L2521" title="All 4 branches missed.">			if (commVarianceBean != null</span>
					&amp;&amp; netGCommVar1 != commVarianceBean.getNetGCommVar()) {
<span class="nc" id="L2523">				System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L2524">				PreparedStatement pstmt4 = conn</span>
						.prepareStatement(&quot;insert into st_ola_bo_agent_plr_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L2526">				pstmt4.setInt(1, commVarianceBean.getAgentOrgId());</span>
<span class="nc" id="L2527">				pstmt4.setInt(2, commVarianceBean.getGameId());</span>
<span class="nc" id="L2528">				pstmt4.setDouble(3, commVarianceBean.getNetGCommVar());</span>
<span class="nc" id="L2529">				pstmt4.setTimestamp(4, new java.sql.Timestamp(</span>
						new java.util.Date().getTime()));
<span class="nc" id="L2531">				int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L2532">				System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L2533">				System.out</span>
						.println(&quot;PWT comm var history table updated rows === &quot;
								+ rows);
<span class="nc" id="L2536">				pstmt4.close();</span>
			}

<span class="nc" id="L2539">			logger.debug(&quot; **widCommVar1** &quot; + widCommVar1 + &quot; **depCommVar1** &quot;</span>
					+ depCommVar1 + &quot; **netGCommVar1** &quot;+ netGCommVar1  +&quot; **&quot;);
<span class="nc bnc" id="L2541" title="All 6 branches missed.">			logger.debug(&quot;widCommVar1!=0.0 ||  depCommVar1!=0.0 || netGCommVar != 0.0&quot;</span>
					+ (widCommVar1 != 0.0 || depCommVar1 != 0.0 || netGCommVar1 != 0.0));
<span class="nc" id="L2543">			PreparedStatement pstmt6 = conn</span>
					.prepareStatement(&quot; select wallet_id from st_ola_wallet_master where wallet_id=?  &quot;);
			//pstmt6.setString(1, agtOrgName.trim());
<span class="nc" id="L2546">			pstmt6.setInt(1, Integer.parseInt(wallet[0]));</span>
			//pstmt6.setString(3, game[1]);
<span class="nc" id="L2548">			ResultSet rs6 = pstmt6.executeQuery();</span>
<span class="nc" id="L2549">			System.out.println(&quot;query = &quot; + pstmt6);</span>
<span class="nc" id="L2550">			int walletId = 0;</span>
		//	int agtOrgid = 0;
<span class="nc bnc" id="L2552" title="All 2 branches missed.">			if (rs6.next()) {</span>
<span class="nc" id="L2553">				walletId = rs6.getInt(&quot;wallet_id&quot;);</span>
			//	agtOrgid = rs6.getInt(&quot;organization_id&quot;);
			}
<span class="nc bnc" id="L2556" title="All 6 branches missed.">			if (widCommVar1 != 0.0 || depCommVar1 != 0.0 || netGCommVar1 != 0.0) {</span>
<span class="nc" id="L2557">				System.out.println(&quot;66666666666666666666666666&quot;);</span>
				/*PreparedStatement pstmt6 = conn
						.prepareStatement(&quot;select aa.game_id, bb.organization_id from ((select organization_id from st_lms_organization_master where name=?) bb, ( select game_id from st_dg_game_master where game_nbr=? and game_name=? )aa) &quot;);
				pstmt6.setString(1, agtOrgName.trim());
				pstmt6.setInt(2, Integer.parseInt(game[0]));
				pstmt6.setString(3, game[1]);
				ResultSet rs6 = pstmt6.executeQuery();
				System.out.println(&quot;query = &quot; + pstmt6);
				int gameId = 0;
				int agtOrgid = 0;
				if (rs6.next()) {
					gameId = rs6.getInt(&quot;game_id&quot;);
					agtOrgid = rs6.getInt(&quot;organization_id&quot;);
				}*/
<span class="nc bnc" id="L2571" title="All 4 branches missed.">				if (walletId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2572">					PreparedStatement pstmt5 = conn</span>
							.prepareStatement(&quot;insert into st_ola_bo_agent_comm_variance  values (? , ? , ? ,?,?, ?,?,?)&quot;);
<span class="nc" id="L2574">					pstmt5.setInt(1, orgId);</span>
<span class="nc" id="L2575">					pstmt5.setInt(2, walletId);</span>
<span class="nc" id="L2576">					pstmt5.setDouble(3, depCommVar1);</span>
<span class="nc" id="L2577">					pstmt5.setDouble(4, dDepCommRate);</span>
<span class="nc" id="L2578">					pstmt5.setDouble(5, widCommVar1);</span>
<span class="nc" id="L2579">					pstmt5.setDouble(6, dWidCommRate);</span>
<span class="nc" id="L2580">					pstmt5.setDouble(7, netGCommVar1);</span>
<span class="nc" id="L2581">					pstmt5.setDouble(8, dNetGCommRate);</span>
<span class="nc" id="L2582">					int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L2583">					logger.debug(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L2584">					logger.debug(&quot;insert entries st_ola_bo_agent_comm_variance  table updated rows === &quot;</span>
									+ rows);
<span class="nc" id="L2586">					pstmt5.close();</span>
					
					
					  /* //here update the updated comm rate in the context
					   //System.out.println(&quot;var in context before: &quot; + Util.getSaleCommVariance(retOrgid, gameId));
						double retUpdatedCommVar = CommonFunctionsHelper.fetchDGCommOfOrganization(gameId, agtOrgid, &quot;SALE&quot;, &quot;AGENT&quot;, conn);
						Util.updateSaleCommVariance(agtOrgid, gameId,retUpdatedCommVar);
						System.out.println(&quot;var in context after updation: &quot; + Util.getSaleCommVariance(agtOrgid, gameId));
					    //updated successfully
*/						
					
				}

<span class="nc bnc" id="L2599" title="All 6 branches missed.">				if (commVarianceBean == null &amp;&amp; walletId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2600">					logger.debug(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L2601">					PreparedStatement pstmt3 = conn</span>
							.prepareStatement(&quot;insert into st_ola_bo_agent_withdrawl_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L2603">					pstmt3.setInt(1, orgId);</span>
<span class="nc" id="L2604">					pstmt3.setInt(2, walletId);</span>
<span class="nc" id="L2605">					pstmt3.setDouble(3, 0.0);</span>
<span class="nc" id="L2606">					pstmt3.setTimestamp(4, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L2608">					int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L2609">					logger.debug(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L2610">					logger.debug(&quot;withdrawal comm var history table updated rows === &quot;</span>
									+ rows);
<span class="nc" id="L2612">					pstmt3.close();</span>
				}

<span class="nc bnc" id="L2615" title="All 6 branches missed.">				if (commVarianceBean == null &amp;&amp; walletId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2616">					logger.debug(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L2617">					PreparedStatement pstmt4 = conn</span>
							.prepareStatement(&quot;insert into st_ola_bo_agent_deposit_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L2619">					pstmt4.setInt(1, orgId);</span>
<span class="nc" id="L2620">					pstmt4.setInt(2, walletId);</span>
<span class="nc" id="L2621">					pstmt4.setDouble(3, 0.0);</span>
<span class="nc" id="L2622">					pstmt4.setTimestamp(4, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L2624">					int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L2625">					logger.debug(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L2626">					logger.debug(&quot;Deposit comm var history table updated rows === &quot;</span>
									+ rows);
<span class="nc" id="L2628">					pstmt4.close();</span>
				}
				
<span class="nc bnc" id="L2631" title="All 6 branches missed.">				if (commVarianceBean == null &amp;&amp; walletId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2632">					logger.debug(&quot;55555555555555555555555&quot;);</span>
<span class="nc" id="L2633">					PreparedStatement pstmt5 = conn</span>
							.prepareStatement(&quot;insert into st_ola_bo_agent_plr_comm_variance_history values(?, ?, ?, ?)&quot;);
<span class="nc" id="L2635">					pstmt5.setInt(1, orgId);</span>
<span class="nc" id="L2636">					pstmt5.setInt(2, walletId);</span>
<span class="nc" id="L2637">					pstmt5.setDouble(3, 0.0);</span>
<span class="nc" id="L2638">					pstmt5.setTimestamp(4, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L2640">					int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L2641">					logger.debug(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L2642">					logger.debug(&quot;Net Gaming comm var history table updated rows === &quot;</span>
									+ rows);
<span class="nc" id="L2644">					pstmt5.close();</span>
				}

			}
			
			 //here update the updated comm rate in the context
			   //System.out.println(&quot;var in context before: &quot; + Util.getSaleCommVariance(retOrgid, gameId));
				//double UpdatedWidCommVar = CommonFunctionsHelper.fetchWidCommOfOrganization(walletId, agtOrgid, &quot;SALE&quot;, &quot;AGENT&quot;, conn);
				//Util.updateSaleCommVariance(agtOrgid, walletId,UpdatedWidCommVar);
				//logger.debug(&quot;var in context after updation: &quot; + Util.getSaleCommVariance(agtOrgid, walletId));
			    //updated successfully
			
<span class="nc" id="L2656">			conn.commit();</span>
<span class="nc" id="L2657">		} catch (SQLException se) {</span>
			try {
<span class="nc" id="L2659">				System.out.println(&quot;rolled back&quot;);</span>
<span class="nc" id="L2660">				conn.rollback();</span>
<span class="nc" id="L2661">			} catch (SQLException e) {</span>
<span class="nc" id="L2662">				e.printStackTrace();</span>
				// throw new LMSException(e);
<span class="nc" id="L2664">			}</span>
<span class="nc" id="L2665">			se.printStackTrace();</span>
<span class="nc" id="L2666">			throw new LMSException(se);</span>

		} finally {

<span class="nc" id="L2670">			try {</span>
<span class="nc bnc" id="L2671" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L2672">					conn.close();</span>
				}
<span class="nc" id="L2674">			} catch (SQLException e) {</span>
<span class="nc" id="L2675">				e.printStackTrace();</span>
<span class="nc" id="L2676">			}</span>

<span class="nc" id="L2678">		}</span>

<span class="nc" id="L2680">		return &quot;SUCCESS&quot;;</span>
	
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>