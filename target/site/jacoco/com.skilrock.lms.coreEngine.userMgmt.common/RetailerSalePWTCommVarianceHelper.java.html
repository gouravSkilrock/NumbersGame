<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RetailerSalePWTCommVarianceHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.userMgmt.common</a> &gt; <span class="el_source">RetailerSalePWTCommVarianceHelper.java</span></div><h1>RetailerSalePWTCommVarianceHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.userMgmt.common;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.TreeMap;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.beans.SalePwtCommVarBean;
import com.skilrock.lms.beans.UpdateSalePwtCommVarBean;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.utility.FormatNumber;
import com.skilrock.lms.coreEngine.drawGames.common.CommonFunctionsHelper;
import com.skilrock.lms.web.drawGames.common.Util;

<span class="nc" id="L24">public class RetailerSalePWTCommVarianceHelper {</span>
<span class="nc" id="L25">	static Log logger = LogFactory.getLog(RetailerSalePWTCommVarianceHelper.class);</span>
	private Connection con;
<span class="nc" id="L27">	public Map&lt;String, Double&gt; maxCommRate = new TreeMap&lt;String, Double&gt;();</span>
	private PreparedStatement pstmt;

	private ResultSet rs;

	public Map&lt;String, Double&gt; getDefaultCommRate(String nbr, String name) {
<span class="nc" id="L33">		double maxSaleVariance = 0.0;</span>
<span class="nc" id="L34">		double maxPwtVariance = 0.0;</span>
<span class="nc" id="L35">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L36">		String sqlQuery = &quot;select retailer_sale_comm_rate 'max_sale_rate',  retailer_pwt_comm_rate  'max_pwt_rate',  govt_comm_rate  'max_gov_rate',  prize_payout_ratio  'max_prize_ratio' from st_se_game_master where  game_status!='TERMINATE' and game_nbr=&quot;</span>
				+ nbr ;
		try {
<span class="nc" id="L39">			PreparedStatement pstmt = conn.prepareStatement(sqlQuery);</span>
<span class="nc" id="L40">			ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L41">			System.out.println(&quot; game name query === &quot; + pstmt);</span>
<span class="nc bnc" id="L42" title="All 2 branches missed.">			while (rss.next()) {</span>
<span class="nc" id="L43">				double maxSaleCommRate = rss.getDouble(&quot;max_sale_rate&quot;);</span>
<span class="nc" id="L44">				double maxGovRate = rss.getDouble(&quot;max_gov_rate&quot;);</span>
<span class="nc" id="L45">				double maxPrizeRatio = rss.getDouble(&quot;max_prize_ratio&quot;);</span>
<span class="nc" id="L46">				double maxPwtCommRate = rss.getDouble(&quot;max_pwt_rate&quot;);</span>
<span class="nc" id="L47">				maxSaleVariance = 100 - (maxSaleCommRate + maxGovRate + maxPrizeRatio);</span>
<span class="nc" id="L48">				maxPwtVariance = 100 - (maxPwtCommRate + maxGovRate + maxPrizeRatio);</span>
				// maxPwtVariance=100(maxPwtCommRate+)
<span class="nc" id="L50">				maxCommRate.put(&quot;maxSaleVariance&quot;, maxSaleVariance);</span>
<span class="nc" id="L51">				maxCommRate.put(&quot;maxPwtVariance&quot;, maxPwtVariance);</span>
				// maxCommRate.put(&quot;maxPwtVariance&quot;, value)
<span class="nc" id="L53">			}</span>
<span class="nc bnc" id="L54" title="All 2 branches missed.">			if (rss != null) {</span>
<span class="nc" id="L55">				rss.close();</span>
			}
<span class="nc bnc" id="L57" title="All 2 branches missed.">			if (pstmt != null) {</span>
<span class="nc" id="L58">				pstmt.close();</span>
			}
<span class="nc" id="L60">		} catch (SQLException e) {</span>
<span class="nc" id="L61">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L63">			try {</span>
<span class="nc bnc" id="L64" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L65">					conn.close();</span>
				}
<span class="nc" id="L67">			} catch (SQLException e) {</span>
<span class="nc" id="L68">				e.printStackTrace();</span>
<span class="nc" id="L69">			}</span>
<span class="nc" id="L70">		}</span>
<span class="nc" id="L71">		return maxCommRate;</span>
	}

	public Map&lt;String, Double&gt; getDefaultCommRateDg(String nbr, String name) {
<span class="nc" id="L75">		double maxSaleVariance = 0.0;</span>
<span class="nc" id="L76">		double maxPwtVariance = 0.0;</span>
<span class="nc" id="L77">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L78">		String sqlQuery = &quot;select retailer_sale_comm_rate 'max_sale_rate',  retailer_pwt_comm_rate  'max_pwt_rate',  govt_comm  'max_gov_rate',  prize_payout_ratio  'max_prize_ratio' from st_dg_game_master where  game_status!='TERMINATE' and game_id=&quot;</span>
				+ nbr ;
		try {
<span class="nc" id="L81">			PreparedStatement pstmt = conn.prepareStatement(sqlQuery);</span>
<span class="nc" id="L82">			ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L83">			System.out.println(&quot; game name query === DG &quot; + pstmt);</span>
<span class="nc bnc" id="L84" title="All 2 branches missed.">			while (rss.next()) {</span>
<span class="nc" id="L85">				double maxSaleCommRate = rss.getDouble(&quot;max_sale_rate&quot;);</span>
<span class="nc" id="L86">				double maxGovRate = rss.getDouble(&quot;max_gov_rate&quot;);</span>
<span class="nc" id="L87">				double maxPrizeRatio = rss.getDouble(&quot;max_prize_ratio&quot;);</span>
<span class="nc" id="L88">				double maxPwtCommRate = rss.getDouble(&quot;max_pwt_rate&quot;);</span>
<span class="nc" id="L89">				maxSaleVariance = 100 - (maxSaleCommRate + maxGovRate + maxPrizeRatio);</span>
<span class="nc" id="L90">				maxPwtVariance = 100 - (maxPwtCommRate + maxGovRate + maxPrizeRatio);</span>
				// maxPwtVariance=100(maxPwtCommRate+)
<span class="nc" id="L92">				maxCommRate.put(&quot;maxSaleVariance&quot;, maxSaleVariance);</span>
<span class="nc" id="L93">				maxCommRate.put(&quot;maxPwtVariance&quot;, maxPwtVariance);</span>
				// maxCommRate.put(&quot;maxPwtVariance&quot;, value)
<span class="nc" id="L95">			}</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">			if (rss != null) {</span>
<span class="nc" id="L97">				rss.close();</span>
			}
<span class="nc bnc" id="L99" title="All 2 branches missed.">			if (pstmt != null) {</span>
<span class="nc" id="L100">				pstmt.close();</span>
			}
<span class="nc" id="L102">		} catch (SQLException e) {</span>
<span class="nc" id="L103">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L105">			try {</span>
<span class="nc bnc" id="L106" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L107">					conn.close();</span>
				}
<span class="nc" id="L109">			} catch (SQLException e) {</span>
<span class="nc" id="L110">				e.printStackTrace();</span>
<span class="nc" id="L111">			}</span>
<span class="nc" id="L112">		}</span>
<span class="nc" id="L113">		return maxCommRate;</span>
	}
	
	public Map&lt;String, Double&gt; getDefaultCommRateIW(String nbr, String name) {
<span class="nc" id="L117">		double maxSaleVariance = 0.0;</span>
<span class="nc" id="L118">		double maxPwtVariance = 0.0;</span>
<span class="nc" id="L119">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L120">		String sqlQuery = &quot;select retailer_sale_comm_rate 'max_sale_rate',  retailer_pwt_comm_rate  'max_pwt_rate', gov_comm_rate 'max_gov_rate',  prize_payout_ratio  'max_prize_ratio' from st_iw_game_master where  game_status!='TERMINATE' and game_id=&quot; + nbr;</span>
		try {
<span class="nc" id="L122">			PreparedStatement pstmt = conn.prepareStatement(sqlQuery);</span>
<span class="nc" id="L123">			ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L124">			System.out.println(&quot; game name query === DG &quot; + pstmt);</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">			while (rss.next()) {</span>
<span class="nc" id="L126">				double maxSaleCommRate = rss.getDouble(&quot;max_sale_rate&quot;);</span>
<span class="nc" id="L127">				double maxGovRate = rss.getDouble(&quot;max_gov_rate&quot;);</span>
<span class="nc" id="L128">				double maxPrizeRatio = rss.getDouble(&quot;max_prize_ratio&quot;);</span>
<span class="nc" id="L129">				double maxPwtCommRate = rss.getDouble(&quot;max_pwt_rate&quot;);</span>
<span class="nc" id="L130">				maxSaleVariance = 100 - (maxSaleCommRate + maxGovRate + maxPrizeRatio);</span>
<span class="nc" id="L131">				maxPwtVariance = 100 - (maxPwtCommRate + maxGovRate + maxPrizeRatio);</span>
				// maxPwtVariance=100(maxPwtCommRate+)
<span class="nc" id="L133">				maxCommRate.put(&quot;maxSaleVariance&quot;, maxSaleVariance);</span>
<span class="nc" id="L134">				maxCommRate.put(&quot;maxPwtVariance&quot;, maxPwtVariance);</span>
				// maxCommRate.put(&quot;maxPwtVariance&quot;, value)
<span class="nc" id="L136">			}</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">			if (rss != null) {</span>
<span class="nc" id="L138">				rss.close();</span>
			}
<span class="nc bnc" id="L140" title="All 2 branches missed.">			if (pstmt != null) {</span>
<span class="nc" id="L141">				pstmt.close();</span>
			}
<span class="nc" id="L143">		} catch (SQLException e) {</span>
<span class="nc" id="L144">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L146">			try {</span>
<span class="nc bnc" id="L147" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L148">					conn.close();</span>
				}
<span class="nc" id="L150">			} catch (SQLException e) {</span>
<span class="nc" id="L151">				e.printStackTrace();</span>
<span class="nc" id="L152">			}</span>
<span class="nc" id="L153">		}</span>
<span class="nc" id="L154">		return maxCommRate;</span>
	}
	
	public Map&lt;String, Double&gt; getDefaultCommRateVS(String nbr, String name) {
<span class="nc" id="L158">		double maxSaleVariance = 0.0;</span>
<span class="nc" id="L159">		double maxPwtVariance = 0.0;</span>
<span class="nc" id="L160">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L161">		String sqlQuery = &quot;select retailer_sale_comm_rate 'max_sale_rate',  retailer_pwt_comm_rate  'max_pwt_rate', gov_comm_rate 'max_gov_rate',  prize_payout_ratio  'max_prize_ratio' from st_vs_game_master where  game_status!='TERMINATE' and game_id=&quot; + nbr;</span>
		try {
<span class="nc" id="L163">			PreparedStatement pstmt = conn.prepareStatement(sqlQuery);</span>
<span class="nc" id="L164">			ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L165">			System.out.println(&quot; game name query === DG &quot; + pstmt);</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">			while (rss.next()) {</span>
<span class="nc" id="L167">				double maxSaleCommRate = rss.getDouble(&quot;max_sale_rate&quot;);</span>
<span class="nc" id="L168">				double maxGovRate = rss.getDouble(&quot;max_gov_rate&quot;);</span>
<span class="nc" id="L169">				double maxPrizeRatio = rss.getDouble(&quot;max_prize_ratio&quot;);</span>
<span class="nc" id="L170">				double maxPwtCommRate = rss.getDouble(&quot;max_pwt_rate&quot;);</span>
<span class="nc" id="L171">				maxSaleVariance = 100 - (maxSaleCommRate + maxGovRate + maxPrizeRatio);</span>
<span class="nc" id="L172">				maxPwtVariance = 100 - (maxPwtCommRate + maxGovRate + maxPrizeRatio);</span>
				// maxPwtVariance=100(maxPwtCommRate+)
<span class="nc" id="L174">				maxCommRate.put(&quot;maxSaleVariance&quot;, maxSaleVariance);</span>
<span class="nc" id="L175">				maxCommRate.put(&quot;maxPwtVariance&quot;, maxPwtVariance);</span>
				// maxCommRate.put(&quot;maxPwtVariance&quot;, value)
<span class="nc" id="L177">			}</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">			if (rss != null) {</span>
<span class="nc" id="L179">				rss.close();</span>
			}
<span class="nc bnc" id="L181" title="All 2 branches missed.">			if (pstmt != null) {</span>
<span class="nc" id="L182">				pstmt.close();</span>
			}
<span class="nc" id="L184">		} catch (SQLException e) {</span>
<span class="nc" id="L185">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L187">			try {</span>
<span class="nc bnc" id="L188" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L189">					conn.close();</span>
				}
<span class="nc" id="L191">			} catch (SQLException e) {</span>
<span class="nc" id="L192">				e.printStackTrace();</span>
<span class="nc" id="L193">			}</span>
<span class="nc" id="L194">		}</span>
<span class="nc" id="L195">		return maxCommRate;</span>
	}
	
	public Map&lt;String, Double&gt; getDefaultCommRateCS(String nbr, String prodCode, String provider) {
<span class="nc" id="L199">		double maxSaleVariance = 0.0;</span>
<span class="nc" id="L200">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L201">		String sqlQuery = &quot;select retailer_comm 'max_sale_rate', good_cause_comm  'max_gov_rate' from st_cs_product_master where  status!='INACTIVE' and product_id=&quot;</span>
				+ nbr ;
		try {
<span class="nc" id="L204">			PreparedStatement pstmt = conn.prepareStatement(sqlQuery);</span>
<span class="nc" id="L205">			ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L206">			logger.debug(&quot;product name query for CS === &quot; + pstmt);</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">			while (rss.next()) {</span>
<span class="nc" id="L208">				double maxSaleCommRate = rss.getDouble(&quot;max_sale_rate&quot;);</span>
<span class="nc" id="L209">				double maxGovRate = rss.getDouble(&quot;max_gov_rate&quot;);</span>
<span class="nc" id="L210">				maxSaleVariance = 100 - (maxSaleCommRate + maxGovRate);</span>
<span class="nc" id="L211">				maxCommRate.put(&quot;maxSaleVariance&quot;, maxSaleVariance);</span>
<span class="nc" id="L212">			}</span>
<span class="nc bnc" id="L213" title="All 2 branches missed.">			if (rss != null) {</span>
<span class="nc" id="L214">				rss.close();</span>
			}
<span class="nc bnc" id="L216" title="All 2 branches missed.">			if (pstmt != null) {</span>
<span class="nc" id="L217">				pstmt.close();</span>
			}
<span class="nc" id="L219">		} catch (SQLException e) {</span>
<span class="nc" id="L220">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L222">			try {</span>
<span class="nc bnc" id="L223" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L224">					conn.close();</span>
				}
<span class="nc" id="L226">			} catch (SQLException e) {</span>
<span class="nc" id="L227">				e.printStackTrace();</span>
<span class="nc" id="L228">			}</span>
<span class="nc" id="L229">		}</span>
<span class="nc" id="L230">		return maxCommRate;</span>
	}
	
	public Map&lt;String, Double&gt; getDefaultCommRateForOLA(String id, String name){
<span class="nc" id="L234">		double maxWidVariance = 0.0;</span>
<span class="nc" id="L235">		double maxDepVariance = 0.0;</span>
<span class="nc" id="L236">		double maxNetGVariance = 0.0;</span>
<span class="nc" id="L237">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L238">		String sqlQuery = &quot;select ret_withdrawl_comm 'max_wid_rate',  ret_deposit_comm  'max_dep_rate', ret_net_gaming_comm 'max_netg_rate' from st_ola_wallet_master where  wallet_status ='ACTIVE' and wallet_id=&quot;</span>
			+ id;
		try {
<span class="nc" id="L241">			PreparedStatement pstmt = conn.prepareStatement(sqlQuery);</span>
<span class="nc" id="L242">			ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L243">			System.out.println(&quot; wallet name query === OLA &quot; + pstmt);</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">			while (rss.next()) {</span>
<span class="nc" id="L245">				double maxWidCommRate = rss.getDouble(&quot;max_wid_rate&quot;);</span>
<span class="nc" id="L246">				double maxDepCommRate = rss.getDouble(&quot;max_dep_rate&quot;);</span>
<span class="nc" id="L247">				double maxNetGCommRate = rss.getDouble(&quot;max_netg_rate&quot;);</span>
<span class="nc" id="L248">				maxWidVariance = 100 - (maxWidCommRate + maxDepCommRate + maxNetGCommRate);</span>
<span class="nc" id="L249">				maxDepVariance = 100 - (maxWidCommRate + maxDepCommRate + maxNetGCommRate);</span>
<span class="nc" id="L250">				maxNetGVariance = 100 - (maxWidCommRate + maxDepCommRate + maxNetGCommRate);</span>
				// maxPwtVariance=100(maxPwtCommRate+)
<span class="nc" id="L252">				maxCommRate.put(&quot;maxWidVariance&quot;, maxWidVariance);</span>
<span class="nc" id="L253">				maxCommRate.put(&quot;maxDepVariance&quot;, maxDepVariance);</span>
<span class="nc" id="L254">				maxCommRate.put(&quot;maxNetGVariance&quot;, maxNetGVariance);</span>
				// maxCommRate.put(&quot;maxPwtVariance&quot;, value)
<span class="nc" id="L256">			}</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">			if (rss != null) {</span>
<span class="nc" id="L258">				rss.close();</span>
			}
<span class="nc bnc" id="L260" title="All 2 branches missed.">			if (pstmt != null) {</span>
<span class="nc" id="L261">				pstmt.close();</span>
			}
<span class="nc" id="L263">		} catch (SQLException e) {</span>
<span class="nc" id="L264">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L266">			try {</span>
<span class="nc bnc" id="L267" title="All 12 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L268">					conn.close();</span>
				}
<span class="nc" id="L270">			} catch (SQLException e) {</span>
<span class="nc" id="L271">				e.printStackTrace();</span>
<span class="nc" id="L272">			}</span>
<span class="nc" id="L273">		}</span>
<span class="nc" id="L274">		return maxCommRate;</span>
	}

	public List&lt;SalePwtCommVarBean&gt; getSalePwtGameDetails(String query,
			Connection conn, String gamestatus) throws SQLException {
<span class="nc" id="L279">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L280">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L281">		Connection connection = conn;</span>
<span class="nc" id="L282">		PreparedStatement pstmt = connection.prepareStatement(query);</span>
<span class="nc" id="L283">		ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L284">		System.out.println(&quot; game name query === &quot; + pstmt);</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">		while (rss.next()) {</span>
<span class="nc" id="L286">			bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L287">			String gamename = rss.getInt(&quot;game_nbr&quot;) + &quot;-&quot;</span>
					+ rss.getString(&quot;game_name&quot;);
<span class="nc" id="L289">			bean.setGameName(gamename);</span>

			// retrieve the default Sale commission variance
<span class="nc" id="L292">			double defSaleCommRate = rss.getDouble(&quot;retailer_sale_comm_rate&quot;);</span>
<span class="nc" id="L293">			bean.setDefSaleCommRate(FormatNumber.formatNumber(defSaleCommRate));</span>
			// retrieve the Sale commission variance
<span class="nc" id="L295">			double currentSaleCommVar = 0.0;// rss.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L296">			bean.setCurrentSaleCommVar(FormatNumber</span>
					.formatNumber(currentSaleCommVar));
			// calculate the Sale commission variance
<span class="nc" id="L299">			bean.setNetSaleCommRate(FormatNumber.formatNumber(defSaleCommRate</span>
					+ currentSaleCommVar));

<span class="nc" id="L302">			double defPwtCommRate = rss.getDouble(&quot;retailer_pwt_comm_rate&quot;);</span>
<span class="nc" id="L303">			bean.setDefPwtCommRate(FormatNumber.formatNumber(defPwtCommRate));</span>
			// retrieve the PWT commission variance
<span class="nc" id="L305">			double currentPwtCommVar = 0.0;// rss.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L306">			bean.setCurrentPwtCommVar(FormatNumber</span>
					.formatNumber(currentPwtCommVar));
			// calculate the PWT commission variance
<span class="nc" id="L309">			bean.setNetPwtCommRate(FormatNumber.formatNumber(defPwtCommRate</span>
					+ currentPwtCommVar));

<span class="nc" id="L312">			salePwtCommVarList.add(bean);</span>
<span class="nc" id="L313">		}</span>

<span class="nc" id="L315">		return salePwtCommVarList;</span>
	}

	public List&lt;SalePwtCommVarBean&gt; getSalePwtGameDetailsDg(String query,
			Connection conn, String gamestatus) throws SQLException {
<span class="nc" id="L320">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L321">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L322">		Connection connection = conn;</span>
<span class="nc" id="L323">		PreparedStatement pstmt = connection.prepareStatement(query);</span>
<span class="nc" id="L324">		ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L325">		System.out.println(&quot; game name query === &quot; + pstmt);</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">		while (rss.next()) {</span>
<span class="nc" id="L327">			bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L328">			String gamename = rss.getInt(&quot;game_id&quot;) + &quot;-&quot;</span>
					+ rss.getString(&quot;game_name&quot;);
<span class="nc" id="L330">			bean.setGameName(gamename);</span>

			// retrieve the default Sale commission variance
<span class="nc" id="L333">			double defSaleCommRate = rss.getDouble(&quot;retailer_sale_comm_rate&quot;);</span>
<span class="nc" id="L334">			bean.setDefSaleCommRate(FormatNumber.formatNumber(defSaleCommRate));</span>
			// retrieve the Sale commission variance
<span class="nc" id="L336">			double currentSaleCommVar = 0.0;// rss.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L337">			bean.setCurrentSaleCommVar(FormatNumber</span>
					.formatNumber(currentSaleCommVar));
			// calculate the Sale commission variance
<span class="nc" id="L340">			bean.setNetSaleCommRate(FormatNumber.formatNumber(defSaleCommRate</span>
					+ currentSaleCommVar));

<span class="nc" id="L343">			double defPwtCommRate = rss.getDouble(&quot;retailer_pwt_comm_rate&quot;);</span>
<span class="nc" id="L344">			bean.setDefPwtCommRate(FormatNumber.formatNumber(defPwtCommRate));</span>
			// retrieve the PWT commission variance
<span class="nc" id="L346">			double currentPwtCommVar = 0.0;// rss.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L347">			bean.setCurrentPwtCommVar(FormatNumber</span>
					.formatNumber(currentPwtCommVar));
			// calculate the PWT commission variance
<span class="nc" id="L350">			bean.setNetPwtCommRate(FormatNumber.formatNumber(defPwtCommRate</span>
					+ currentPwtCommVar));

<span class="nc" id="L353">			salePwtCommVarList.add(bean);</span>
<span class="nc" id="L354">		}</span>

<span class="nc" id="L356">		return salePwtCommVarList;</span>
	}

	public List&lt;SalePwtCommVarBean&gt; getSalePwtGameDetailsIW(String query, Connection conn, String gamestatus) throws SQLException {
<span class="nc" id="L360">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L361">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L362">		Connection connection = conn;</span>
<span class="nc" id="L363">		PreparedStatement pstmt = connection.prepareStatement(query);</span>
<span class="nc" id="L364">		ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L365">		System.out.println(&quot; game name query === &quot; + pstmt);</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">		while (rss.next()) {</span>
<span class="nc" id="L367">			bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L368">			String gamename = rss.getInt(&quot;game_id&quot;) + &quot;-&quot; + rss.getString(&quot;game_disp_name&quot;);</span>
<span class="nc" id="L369">			bean.setGameName(gamename);</span>

			// retrieve the default Sale commission variance
<span class="nc" id="L372">			double defSaleCommRate = rss.getDouble(&quot;retailer_sale_comm_rate&quot;);</span>
<span class="nc" id="L373">			bean.setDefSaleCommRate(FormatNumber.formatNumber(defSaleCommRate));</span>
			// retrieve the Sale commission variance
<span class="nc" id="L375">			double currentSaleCommVar = 0.0;// rss.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L376">			bean.setCurrentSaleCommVar(FormatNumber.formatNumber(currentSaleCommVar));</span>
			// calculate the Sale commission variance
<span class="nc" id="L378">			bean.setNetSaleCommRate(FormatNumber.formatNumber(defSaleCommRate + currentSaleCommVar));</span>

<span class="nc" id="L380">			double defPwtCommRate = rss.getDouble(&quot;retailer_pwt_comm_rate&quot;);</span>
<span class="nc" id="L381">			bean.setDefPwtCommRate(FormatNumber.formatNumber(defPwtCommRate));</span>
			// retrieve the PWT commission variance
<span class="nc" id="L383">			double currentPwtCommVar = 0.0;// rss.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L384">			bean.setCurrentPwtCommVar(FormatNumber.formatNumber(currentPwtCommVar));</span>
			// calculate the PWT commission variance
<span class="nc" id="L386">			bean.setNetPwtCommRate(FormatNumber.formatNumber(defPwtCommRate + currentPwtCommVar));</span>

<span class="nc" id="L388">			salePwtCommVarList.add(bean);</span>
<span class="nc" id="L389">		}</span>
<span class="nc" id="L390">		return salePwtCommVarList;</span>
	}
	
	public List&lt;SalePwtCommVarBean&gt; getSalePwtGameDetailsVS(String query, Connection conn, String gamestatus) throws SQLException {
<span class="nc" id="L394">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L395">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L396">		Connection connection = conn;</span>
<span class="nc" id="L397">		PreparedStatement pstmt = connection.prepareStatement(query);</span>
<span class="nc" id="L398">		ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L399">		System.out.println(&quot; game name query === &quot; + pstmt);</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">		while (rss.next()) {</span>
<span class="nc" id="L401">			bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L402">			String gamename = rss.getInt(&quot;game_id&quot;) + &quot;-&quot; + rss.getString(&quot;game_disp_name&quot;);</span>
<span class="nc" id="L403">			bean.setGameName(gamename);</span>

			// retrieve the default Sale commission variance
<span class="nc" id="L406">			double defSaleCommRate = rss.getDouble(&quot;retailer_sale_comm_rate&quot;);</span>
<span class="nc" id="L407">			bean.setDefSaleCommRate(FormatNumber.formatNumber(defSaleCommRate));</span>
			// retrieve the Sale commission variance
<span class="nc" id="L409">			double currentSaleCommVar = 0.0;// rss.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L410">			bean.setCurrentSaleCommVar(FormatNumber.formatNumber(currentSaleCommVar));</span>
			// calculate the Sale commission variance
<span class="nc" id="L412">			bean.setNetSaleCommRate(FormatNumber.formatNumber(defSaleCommRate + currentSaleCommVar));</span>

<span class="nc" id="L414">			double defPwtCommRate = rss.getDouble(&quot;retailer_pwt_comm_rate&quot;);</span>
<span class="nc" id="L415">			bean.setDefPwtCommRate(FormatNumber.formatNumber(defPwtCommRate));</span>
			// retrieve the PWT commission variance
<span class="nc" id="L417">			double currentPwtCommVar = 0.0;// rss.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L418">			bean.setCurrentPwtCommVar(FormatNumber.formatNumber(currentPwtCommVar));</span>
			// calculate the PWT commission variance
<span class="nc" id="L420">			bean.setNetPwtCommRate(FormatNumber.formatNumber(defPwtCommRate + currentPwtCommVar));</span>

<span class="nc" id="L422">			salePwtCommVarList.add(bean);</span>
<span class="nc" id="L423">		}</span>
<span class="nc" id="L424">		return salePwtCommVarList;</span>
	}

	public List&lt;SalePwtCommVarBean&gt; getSaleProdDetailsCS(String query,
			Connection conn, String prodStatus)throws SQLException{
<span class="nc" id="L429">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L430">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L431">		Connection connection = conn;</span>
<span class="nc" id="L432">		PreparedStatement pstmt = connection.prepareStatement(query);</span>
<span class="nc" id="L433">		ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L434">		System.out.println(&quot; products query for comm var === &quot; + pstmt);</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">		while (rss.next()) {</span>
<span class="nc" id="L436">			bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L437">			String prodName = rss.getInt(&quot;product_id&quot;) + &quot;_&quot;</span>
			+ rss.getString(&quot;product_code&quot;)+&quot;_&quot;+rss.getString(&quot;operator_name&quot;)+&quot;_&quot;+rss.getString(&quot;denomination&quot;);
<span class="nc" id="L439">			bean.setGameName(prodName);</span>

			// retrieve the default Sale commission variance
<span class="nc" id="L442">			double defSaleCommRate = rss.getDouble(&quot;retailer_comm&quot;);</span>
<span class="nc" id="L443">			bean.setDefSaleCommRate(FormatNumber.formatNumber(defSaleCommRate));</span>
			// retrieve the Sale commission variance
<span class="nc" id="L445">			double currentSaleCommVar = 0.0;// rss.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L446">			bean.setCurrentSaleCommVar(FormatNumber</span>
					.formatNumber(currentSaleCommVar));
			// calculate the Sale commission variance
<span class="nc" id="L449">			bean.setNetSaleCommRate(FormatNumber.formatNumber(defSaleCommRate</span>
					+ currentSaleCommVar));

<span class="nc" id="L452">			salePwtCommVarList.add(bean);</span>
<span class="nc" id="L453">		}</span>
<span class="nc" id="L454">		return salePwtCommVarList;</span>
	}

	public List&lt;SalePwtCommVarBean&gt; salePwtCommVarList(String agentOrgName,
			String gamestatus, String orgTypeCode) {
<span class="nc" id="L459">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L460">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L461">		con = DBConnect.getConnection();</span>
		
		try {
<span class="nc" id="L464">			int orgId = Integer.parseInt(agentOrgName);</span>
<span class="nc" id="L465">		String sqlQuery = &quot;select * from st_se_agent_retailer_sale_pwt_comm_variance aa, st_se_game_master gm where retailer_org_id=&quot;</span>
							+ orgId+&quot; and gm.game_id=aa.game_id &quot;;
<span class="nc bnc" id="L467" title="All 2 branches missed.">		if (!&quot;ALL&quot;.equalsIgnoreCase(gamestatus)) {</span>
<span class="nc" id="L468">			sqlQuery = sqlQuery + &quot;and gm.game_status='&quot; + gamestatus + &quot;'&quot;;</span>
		}
<span class="nc" id="L470">		System.out.println(&quot;agent organization name is ==== &quot; + agentOrgName</span>
				+ &quot;\n RetailerAgentsalePwtCommVar query = &quot; + sqlQuery);

			
			
<span class="nc" id="L475">			Statement stmt = con</span>
					.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE,
							ResultSet.CONCUR_READ_ONLY);
<span class="nc" id="L478">			rs = stmt.executeQuery(sqlQuery);</span>
			// Point to the last row in resultset.
<span class="nc" id="L480">			rs.last();</span>
			// Get the row position which is also the number of rows in the
			// resultset.
<span class="nc" id="L483">			int rowcount = rs.getRow();</span>
<span class="nc" id="L484">			System.out.println(&quot;row count value is ======== &quot; + rowcount);</span>
<span class="nc" id="L485">			rs.beforeFirst();</span>
<span class="nc bnc" id="L486" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L487">				bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L488">				System.out.println(&quot;inside if row count 11111111111111&quot;);</span>
				// get the game name
<span class="nc" id="L490">				int gameId = rs.getInt(&quot;game_id&quot;);</span>
<span class="nc bnc" id="L491" title="All 2 branches missed.">				if (gameId &lt;= 0) {</span>
<span class="nc bnc" id="L492" title="All 2 branches missed.">					if (gameId == 0) {</span>
<span class="nc" id="L493">						bean.setGameName(&quot;Applicable on All Existing Games&quot;);</span>
<span class="nc bnc" id="L494" title="All 2 branches missed.">					} else if (gameId == -1) {</span>
<span class="nc" id="L495">						bean</span>
								.setGameName(&quot;Applicable on All Existing and New Games&quot;);
					} else {
<span class="nc" id="L498">						bean.setGameName(&quot;Errror occured&quot;);</span>
					}
					// retrieve the default Sale commission variance
<span class="nc" id="L501">					bean.setDefSaleCommRate(null);</span>
					// retrieve the Sale commission variance
<span class="nc" id="L503">					double currentSaleCommVar = rs</span>
							.getDouble(&quot;sale_comm_variance&quot;);
<span class="nc" id="L505">					bean.setCurrentSaleCommVar(FormatNumber</span>
							.formatNumber(currentSaleCommVar));
					// calculate the Sale commission variance
<span class="nc" id="L508">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L510">					bean.setDefPwtCommRate(null);</span>
					// retrieve the PWT commission variance
<span class="nc" id="L512">					double currentPwtCommVar = rs</span>
							.getDouble(&quot;pwt_comm_variance&quot;);
<span class="nc" id="L514">					bean.setCurrentPwtCommVar(FormatNumber</span>
							.formatNumber(currentPwtCommVar));
					// calculate the PWT commission variance
<span class="nc" id="L517">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L519">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L520">					System.out.println(&quot;inside if row count 2222222222&quot;);</span>
<span class="nc" id="L521">				} else {</span>
<span class="nc" id="L522">					System.out</span>
							.println(&quot;inside else rowcount 111111111111111111&quot;);
<span class="nc" id="L524">					bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L525">					bean.setGameName(rs.getInt(&quot;game_nbr&quot;) + &quot;-&quot;</span>
							+ rs.getString(&quot;game_name&quot;));

					// retrieve the default Sale commission variance
<span class="nc" id="L529">					double defSaleCommRate = rs</span>
							.getDouble(&quot;default_sale_comm_rate&quot;);
<span class="nc" id="L531">					bean.setDefSaleCommRate(FormatNumber</span>
							.formatNumber(defSaleCommRate));
					// retrieve the Sale commission variance
<span class="nc" id="L534">					double currentSaleCommVar = rs</span>
							.getDouble(&quot;sale_comm_variance&quot;);
<span class="nc" id="L536">					bean.setCurrentSaleCommVar(FormatNumber</span>
							.formatNumber(currentSaleCommVar));
					// calculate the Sale commission variance
<span class="nc" id="L539">					bean</span>
							.setNetSaleCommRate(FormatNumber
									.formatNumber(defSaleCommRate
											+ currentSaleCommVar));

<span class="nc" id="L544">					double defPwtCommRate = rs</span>
							.getDouble(&quot;default_pwt_comm_rate&quot;);
<span class="nc" id="L546">					bean.setDefPwtCommRate(FormatNumber</span>
							.formatNumber(defPwtCommRate));
					// retrieve the PWT commission variance
<span class="nc" id="L549">					double currentPwtCommVar = rs</span>
							.getDouble(&quot;pwt_comm_variance&quot;);
<span class="nc" id="L551">					bean.setCurrentPwtCommVar(FormatNumber</span>
							.formatNumber(currentPwtCommVar));
					// calculate the PWT commission variance
<span class="nc" id="L554">					bean.setNetPwtCommRate(FormatNumber</span>
							.formatNumber(defPwtCommRate + currentPwtCommVar));

<span class="nc" id="L557">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L558">					System.out.println(&quot;inside else row count 2222222222&quot;);</span>
				}
<span class="nc" id="L560">			}</span>
<span class="nc" id="L561">			rs.close();</span>
<span class="nc" id="L562">			stmt.close();</span>

			// now get the details of games from st_se_game_master thats
			// commission variance are not set
<span class="nc" id="L566">			String query = &quot;select game_id, game_nbr, game_name, retailer_sale_comm_rate, retailer_pwt_comm_rate, govt_comm_rate, prize_payout_ratio from st_se_game_master where game_id NOT IN (select game_id from st_se_agent_retailer_sale_pwt_comm_variance where retailer_org_id=&quot;</span>
							+ orgId + &quot; )&quot;;
<span class="nc bnc" id="L568" title="All 2 branches missed.">			if (!&quot;ALL&quot;.equalsIgnoreCase(gamestatus)) {</span>
<span class="nc" id="L569">				query = query + &quot;and game_status='&quot; + gamestatus + &quot;'&quot;;</span>
			}
<span class="nc" id="L571">			System.out.println(&quot;agent  query = &quot; + query);</span>
<span class="nc" id="L572">			List&lt;SalePwtCommVarBean&gt; remList = getSalePwtGameDetails(query,</span>
					con, gamestatus);
<span class="nc bnc" id="L574" title="All 2 branches missed.">			if (remList.size() &gt; 0) {</span>
<span class="nc" id="L575">				salePwtCommVarList.addAll(remList);</span>
			}

<span class="nc" id="L578">		} catch (SQLException e) {</span>
<span class="nc" id="L579">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L581">			try {</span>
<span class="nc bnc" id="L582" title="All 6 branches missed.">				if (pstmt != null) {</span>
<span class="nc" id="L583">					pstmt.close();</span>
				}
<span class="nc bnc" id="L585" title="All 12 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L586">					con.close();</span>
				}
<span class="nc" id="L588">			} catch (SQLException e) {</span>
<span class="nc" id="L589">				e.printStackTrace();</span>
<span class="nc" id="L590">			}</span>
<span class="nc" id="L591">		}</span>

<span class="nc" id="L593">		System.out.println(&quot;name list ===== &quot; + salePwtCommVarList);</span>
<span class="nc" id="L594">		return salePwtCommVarList;</span>

	}

	public List&lt;SalePwtCommVarBean&gt; salePwtCommVarListForDg(
			String agentOrgName, String gamestatus, String orgTypeCode) {
<span class="nc" id="L600">		System.out.println(&quot;salePwtCommVarListForDg called&quot;);</span>
<span class="nc" id="L601">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L602">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L603">		con = DBConnect.getConnection();</span>
	

		try {
			
<span class="nc" id="L608">			int orgId =Integer.parseInt(agentOrgName);</span>
<span class="nc" id="L609">			String sqlQuery = &quot;select * from st_dg_agent_retailer_sale_pwt_comm_variance aa, st_dg_game_master gm where retailer_org_id=&quot;</span>
							+ orgId +&quot; and gm.game_id=aa.game_id and gm.game_id not in(select game_id from st_dg_game_master where closing_time &lt; now())&quot;;
		/*
		 * if (!(&quot;ALL&quot;.equalsIgnoreCase(gamestatus))) sqlQuery = sqlQuery + &quot;and
		 * gm.game_status='&quot; + gamestatus + &quot;'&quot;;
		 */
<span class="nc" id="L615">		System.out.println(&quot;agent organization name is ==== &quot; + agentOrgName</span>
				+ &quot;\n RetailerAgent query = &quot; + sqlQuery);
			
<span class="nc" id="L618">			Statement stmt = con</span>
					.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE,
							ResultSet.CONCUR_READ_ONLY);
<span class="nc" id="L621">			rs = stmt.executeQuery(sqlQuery);</span>
			// Point to the last row in resultset.
<span class="nc" id="L623">			rs.last();</span>
			// Get the row position which is also the number of rows in the
			// resultset.
<span class="nc" id="L626">			int rowcount = rs.getRow();</span>
<span class="nc" id="L627">			System.out.println(&quot;row count value is ======== &quot; + rowcount);</span>
<span class="nc" id="L628">			rs.beforeFirst();</span>
<span class="nc bnc" id="L629" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L630">				bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L631">				System.out.println(&quot;inside if row count 11111111111111&quot;);</span>
				// get the game name
<span class="nc" id="L633">				int gameId = rs.getInt(&quot;game_id&quot;);</span>
<span class="nc bnc" id="L634" title="All 2 branches missed.">				if (gameId &lt;= 0) {</span>
<span class="nc bnc" id="L635" title="All 2 branches missed.">					if (gameId == 0) {</span>
<span class="nc" id="L636">						bean.setGameName(&quot;Applicable on All Existing Games&quot;);</span>
<span class="nc bnc" id="L637" title="All 2 branches missed.">					} else if (gameId == -1) {</span>
<span class="nc" id="L638">						bean</span>
								.setGameName(&quot;Applicable on All Existing and New Games&quot;);
					} else {
<span class="nc" id="L641">						bean.setGameName(&quot;Errror occured&quot;);</span>
					}
					// retrieve the default Sale commission variance
<span class="nc" id="L644">					bean.setDefSaleCommRate(null);</span>
					// retrieve the Sale commission variance
<span class="nc" id="L646">					double currentSaleCommVar = rs</span>
							.getDouble(&quot;sale_comm_variance&quot;);
<span class="nc" id="L648">					bean.setCurrentSaleCommVar(FormatNumber</span>
							.formatNumber(currentSaleCommVar));
					// calculate the Sale commission variance
<span class="nc" id="L651">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L653">					bean.setDefPwtCommRate(null);</span>
					// retrieve the PWT commission variance
<span class="nc" id="L655">					double currentPwtCommVar = rs</span>
							.getDouble(&quot;pwt_comm_variance&quot;);
<span class="nc" id="L657">					bean.setCurrentPwtCommVar(FormatNumber</span>
							.formatNumber(currentPwtCommVar));
					// calculate the PWT commission vasalePwtCommVarListForDgriance
<span class="nc" id="L660">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L662">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L663">					System.out.println(&quot;inside if row count 2222222222&quot;);</span>
<span class="nc" id="L664">				} else {</span>
<span class="nc" id="L665">					System.out</span>
							.println(&quot;inside else rowcount 111111111111111111&quot;);
<span class="nc" id="L667">					bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L668">					bean.setGameName(rs.getInt(&quot;game_id&quot;) + &quot;-&quot;</span>
							+ rs.getString(&quot;game_name&quot;));

					// retrieve the default Sale commission variance
<span class="nc" id="L672">					double defSaleCommRate = rs</span>
							.getDouble(&quot;default_sale_comm_rate&quot;);
<span class="nc" id="L674">					bean.setDefSaleCommRate(FormatNumber</span>
							.formatNumber(defSaleCommRate));
					// retrieve the Sale commission variance
<span class="nc" id="L677">					double currentSaleCommVar = rs</span>
							.getDouble(&quot;sale_comm_variance&quot;);
<span class="nc" id="L679">					bean.setCurrentSaleCommVar(FormatNumber</span>
							.formatNumber(currentSaleCommVar));
					// calculate the Sale commission variance
<span class="nc" id="L682">					bean</span>
							.setNetSaleCommRate(FormatNumber
									.formatNumber(defSaleCommRate
											+ currentSaleCommVar));

<span class="nc" id="L687">					double defPwtCommRate = rs</span>
							.getDouble(&quot;default_pwt_comm_rate&quot;);
<span class="nc" id="L689">					bean.setDefPwtCommRate(FormatNumber</span>
							.formatNumber(defPwtCommRate));
					// retrieve the PWT commission variance
<span class="nc" id="L692">					double currentPwtCommVar = rs</span>
							.getDouble(&quot;pwt_comm_variance&quot;);
<span class="nc" id="L694">					bean.setCurrentPwtCommVar(FormatNumber</span>
							.formatNumber(currentPwtCommVar));
					// calculate the PWT commission variance
<span class="nc" id="L697">					bean.setNetPwtCommRate(FormatNumber</span>
							.formatNumber(defPwtCommRate + currentPwtCommVar));

<span class="nc" id="L700">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L701">					System.out.println(&quot;inside else row count 2222222222&quot;);</span>
				}
<span class="nc" id="L703">			}</span>
<span class="nc" id="L704">			rs.close();</span>
<span class="nc" id="L705">			stmt.close();</span>

			// now get the details of games from st_dg_game_master thats
			// commission variance are not set
<span class="nc" id="L709">			String query = &quot;select game_id, game_nbr, game_name, retailer_sale_comm_rate, retailer_pwt_comm_rate, govt_comm, prize_payout_ratio from st_dg_game_master where game_id NOT IN (select game_id from st_dg_agent_retailer_sale_pwt_comm_variance where retailer_org_id=&quot;</span>
					+ orgId + &quot; union select game_id from st_dg_game_master where closing_time &lt; now())&quot;;
			/*
			 * if (!(&quot;ALL&quot;.equalsIgnoreCase(gamestatus))) query = query + &quot;and
			 * game_status='&quot; + gamestatus + &quot;'&quot;;
			 */
<span class="nc" id="L715">			System.out.println(&quot;agent  query = &quot; + query);</span>
<span class="nc" id="L716">			List&lt;SalePwtCommVarBean&gt; remList = getSalePwtGameDetailsDg(query,</span>
					con, gamestatus);
<span class="nc bnc" id="L718" title="All 2 branches missed.">			if (remList.size() &gt; 0) {</span>
<span class="nc" id="L719">				salePwtCommVarList.addAll(remList);</span>
			}

<span class="nc" id="L722">		} catch (SQLException e) {</span>
<span class="nc" id="L723">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L725">			try {</span>
<span class="nc bnc" id="L726" title="All 6 branches missed.">				if (pstmt != null) {</span>
<span class="nc" id="L727">					pstmt.close();</span>
				}
<span class="nc bnc" id="L729" title="All 12 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L730">					con.close();</span>
				}
<span class="nc" id="L732">			} catch (SQLException e) {</span>
<span class="nc" id="L733">				e.printStackTrace();</span>
<span class="nc" id="L734">			}</span>
<span class="nc" id="L735">		}</span>

<span class="nc" id="L737">		System.out.println(&quot;name list ===== &quot; + salePwtCommVarList);</span>
<span class="nc" id="L738">		return salePwtCommVarList;</span>

	}
	
	public List&lt;SalePwtCommVarBean&gt; saleCommVarListForCS(
			String agentOrgName, String prodStatus, String orgTypeCode) {

<span class="nc" id="L745">		logger.debug(&quot;saleCommVarListForCS called&quot;);</span>
<span class="nc" id="L746">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L747">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L748">		con = DBConnect.getConnection();</span>
		
		try {
<span class="nc" id="L751">			int orgId =Integer.parseInt(agentOrgName);</span>
			
<span class="nc" id="L753">			String sqlQuery = &quot;select * from st_cs_agent_retailer_sale_comm_variance aa, st_cs_product_master pm, st_cs_operator_master com where pm.operator_code = com.operator_code and pm.status = 'ACTIVE' and retailer_org_id=&quot;</span>
							+ orgId+&quot;	 and pm.status='ACTIVE' and pm.product_id=aa.product_id and pm.operator_code = com.operator_code &quot;;

<span class="nc" id="L756">			logger.debug(&quot;agent organization name is ==== &quot; + agentOrgName</span>
				+ &quot;\n RetailerAgent query = &quot; + sqlQuery);

			
<span class="nc" id="L760">			Statement stmt = con</span>
					.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE,
							ResultSet.CONCUR_READ_ONLY);
<span class="nc" id="L763">			rs = stmt.executeQuery(sqlQuery);</span>
			// Point to the last row in resultset.
<span class="nc" id="L765">			rs.last();</span>
			// Get the row position which is also the number of rows in the
			// resultset.
<span class="nc" id="L768">			int rowcount = rs.getRow();</span>
<span class="nc" id="L769">			logger.debug(&quot;row count value is ======== &quot; + rowcount);</span>
<span class="nc" id="L770">			rs.beforeFirst();</span>
<span class="nc bnc" id="L771" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L772">				bean = new SalePwtCommVarBean();</span>
				// get the product name
<span class="nc" id="L774">				int prodNum = rs.getInt(&quot;product_id&quot;);</span>
<span class="nc bnc" id="L775" title="All 2 branches missed.">				if (prodNum &lt;= 0) {</span>
<span class="nc bnc" id="L776" title="All 2 branches missed.">					if (prodNum == 0) {</span>
<span class="nc" id="L777">						bean.setGameName(&quot;Applicable on All Existing Products&quot;);</span>
<span class="nc bnc" id="L778" title="All 2 branches missed.">					} else if (prodNum == -1) {</span>
<span class="nc" id="L779">						bean</span>
								.setGameName(&quot;Applicable on All Existing and New Games&quot;);
					} else {
<span class="nc" id="L782">						bean.setGameName(&quot;Errror occured&quot;);</span>
					}
					// retrieve the default Sale commission variance
<span class="nc" id="L785">					bean.setDefSaleCommRate(null);</span>
					// retrieve the Sale commission variance
<span class="nc" id="L787">					double currentSaleCommVar = rs</span>
							.getDouble(&quot;sale_comm_variance&quot;);
<span class="nc" id="L789">					bean.setCurrentSaleCommVar(FormatNumber</span>
							.formatNumber(currentSaleCommVar));
					// calculate the Sale commission variance
<span class="nc" id="L792">					bean.setNetSaleCommRate(null);</span>
<span class="nc" id="L793">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L794">				} else {</span>
<span class="nc" id="L795">					bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L796">					bean.setGameName(rs.getInt(&quot;product_id&quot;) + &quot;_&quot;</span>
							+ rs.getString(&quot;product_code&quot;)+&quot;_&quot;+rs.getString(&quot;operator_name&quot;)+&quot;_&quot;+rs.getString(&quot;denomination&quot;));

					// retrieve the default Sale commission variance
<span class="nc" id="L800">					double defSaleCommRate = rs</span>
							.getDouble(&quot;default_sale_comm_rate&quot;);
<span class="nc" id="L802">					bean.setDefSaleCommRate(FormatNumber</span>
							.formatNumber(defSaleCommRate));
					// retrieve the Sale commission variance
<span class="nc" id="L805">					double currentSaleCommVar = rs</span>
							.getDouble(&quot;sale_comm_variance&quot;);
<span class="nc" id="L807">					bean.setCurrentSaleCommVar(FormatNumber</span>
							.formatNumber(currentSaleCommVar));
					// calculate the Sale commission variance
<span class="nc" id="L810">					bean</span>
							.setNetSaleCommRate(FormatNumber
									.formatNumber(defSaleCommRate
											+ currentSaleCommVar));
<span class="nc" id="L814">					salePwtCommVarList.add(bean);</span>
				}
<span class="nc" id="L816">			}</span>
<span class="nc" id="L817">			rs.close();</span>
<span class="nc" id="L818">			stmt.close();</span>

			// now get the details of products from st_cs_product_master thats
			// commission variance are not set
<span class="nc" id="L822">			String query = &quot;select product_id, product_code,operator_name, denomination, retailer_comm, good_cause_comm, operator_name from st_cs_product_master pm, st_cs_operator_master com where pm.status='ACTIVE' and pm.operator_code = com.operator_code and pm.product_id NOT IN (select product_id from st_cs_agent_retailer_sale_comm_variance where retailer_org_id=&quot;</span>
					+orgId + &quot;)&quot;;
<span class="nc" id="L824">			logger.debug(&quot;agent  query = &quot; + query);</span>
<span class="nc" id="L825">			List&lt;SalePwtCommVarBean&gt; remList = getSaleProdDetailsCS(query,</span>
					con, prodStatus);
<span class="nc bnc" id="L827" title="All 2 branches missed.">			if (remList.size() &gt; 0) {</span>
<span class="nc" id="L828">				salePwtCommVarList.addAll(remList);</span>
			}

<span class="nc" id="L831">		} catch (SQLException e) {</span>
<span class="nc" id="L832">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L834">			try {</span>
<span class="nc bnc" id="L835" title="All 6 branches missed.">				if (pstmt != null) {</span>
<span class="nc" id="L836">					pstmt.close();</span>
				}
<span class="nc bnc" id="L838" title="All 12 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L839">					con.close();</span>
				}
<span class="nc" id="L841">			} catch (SQLException e) {</span>
<span class="nc" id="L842">				e.printStackTrace();</span>
<span class="nc" id="L843">			}</span>
<span class="nc" id="L844">		}</span>
<span class="nc" id="L845">		logger.debug(&quot;name list ===== &quot; + salePwtCommVarList);</span>
<span class="nc" id="L846">		return salePwtCommVarList;</span>
	}
	
	public List&lt;SalePwtCommVarBean&gt; salePwtCommVarListOLA(String agentOrgName, String walletStatus, String orgTypeCode){
<span class="nc" id="L850">		System.out.println(&quot;salePwtCommVarListForOLA called&quot;);</span>
<span class="nc" id="L851">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L852">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L853">		con = DBConnect.getConnection();</span>
		

		try {
<span class="nc" id="L857">			int orgId =Integer.parseInt(agentOrgName);</span>
			
<span class="nc" id="L859">			String sqlQuery = &quot;select * from st_ola_agent_retailer_comm_variance aa, st_ola_wallet_master wm where retailer_org_id=&quot;</span>
								+ orgId+&quot; and wm.wallet_id=aa.wallet_id &quot;;
		/*
		 * if (!(&quot;ALL&quot;.equalsIgnoreCase(gamestatus))) sqlQuery = sqlQuery + &quot;and
		 * gm.game_status='&quot; + gamestatus + &quot;'&quot;;
		 */
<span class="nc" id="L865">		logger.debug(&quot;agent organization name is ==== &quot; + agentOrgName</span>
				+ &quot;\n query = &quot; + sqlQuery);
			
<span class="nc" id="L868">			Statement stmt = con</span>
					.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE,
							ResultSet.CONCUR_READ_ONLY);
<span class="nc" id="L871">			rs = stmt.executeQuery(sqlQuery);</span>
			// Point to the last row in resultset.
			//rs.last();
			// Get the row position which is also the number of rows in the
			// resultset.
			//int rowcount = rs.getRow();
			//logger.debug(&quot;row count value is ======== &quot; + rowcount);
			//rs.beforeFirst();
<span class="nc bnc" id="L879" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L880">				bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L881">				logger.debug(&quot;inside if row count 11111111111111&quot;);</span>
				// get the game name
<span class="nc" id="L883">				int walletId = rs.getInt(&quot;wallet_id&quot;);</span>
<span class="nc bnc" id="L884" title="All 2 branches missed.">				if (walletId &lt;= 0) {</span>
<span class="nc bnc" id="L885" title="All 2 branches missed.">					if (walletId == 0) {</span>
<span class="nc" id="L886">						bean.setGameName(&quot;Applicable on All Existing Wallets&quot;);</span>
<span class="nc bnc" id="L887" title="All 2 branches missed.">					} else if (walletId == -1) {</span>
<span class="nc" id="L888">						bean</span>
								.setGameName(&quot;Applicable on All Existing and New Wallets&quot;);
					} else {
<span class="nc" id="L891">						bean.setGameName(&quot;Errror occured&quot;);</span>
					}
					// retrieve the default withdrawal commission variance
<span class="nc" id="L894">					bean.setDefWidCommRate(null);</span>
					// retrieve the withdrawal commission variance
<span class="nc" id="L896">					double currentWidCommVar = rs</span>
							.getDouble(&quot;withdrawl_comm_variance&quot;);
<span class="nc" id="L898">					bean.setCurrentWidCommVar(FormatNumber</span>
							.formatNumber(currentWidCommVar));
					// calculate the withdrawal commission variance
<span class="nc" id="L901">					bean.setNetWidCommRate(null);</span>

<span class="nc" id="L903">					bean.setDefDepCommRate(null);</span>
					// retrieve the Deposit commission variance
<span class="nc" id="L905">					double currentDepCommVar = rs</span>
							.getDouble(&quot;deposit_comm_variance&quot;);
<span class="nc" id="L907">					bean.setCurrentWidCommVar(FormatNumber</span>
							.formatNumber(currentDepCommVar));
					// calculate the Deposit commission variance
<span class="nc" id="L910">					bean.setNetSaleCommRate(null);</span>
					
<span class="nc" id="L912">					bean.setDefNetGCommRate(null);</span>
					// retrieve the Net Gaming commission variance
<span class="nc" id="L914">					double currentNetGCommVar = rs</span>
							.getDouble(&quot;net_gaming_comm_variance&quot;);
<span class="nc" id="L916">					bean.setCurrentWidCommVar(FormatNumber</span>
							.formatNumber(currentNetGCommVar));
					// calculate the Net Gaming commission variance
<span class="nc" id="L919">					bean.setNetNetGCommRate(null);</span>

<span class="nc" id="L921">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L922">					logger.debug(&quot;inside if row count 2222222222&quot;);</span>
<span class="nc" id="L923">				} else {</span>
<span class="nc" id="L924">					logger.debug(&quot;inside else rowcount 111111111111111111&quot;);</span>
<span class="nc" id="L925">					bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L926">					bean.setGameName(rs.getInt(&quot;wallet_id&quot;) + &quot;-&quot;</span>
							+ rs.getString(&quot;wallet_name&quot;));

					// retrieve the default Withdrawal commission variance
<span class="nc" id="L930">					double defWidCommRate = rs</span>
							.getDouble(&quot;default_withdrawl_comm_rate&quot;);
<span class="nc" id="L932">					bean.setDefWidCommRate(FormatNumber</span>
							.formatNumber(defWidCommRate));
					// retrieve the Withdrawal commission variance
<span class="nc" id="L935">					double currentWidCommVar = rs</span>
							.getDouble(&quot;withdrawl_comm_variance&quot;);
<span class="nc" id="L937">					bean.setCurrentWidCommVar(FormatNumber</span>
							.formatNumber(currentWidCommVar));
					// calculate the Withdrawal commission variance
<span class="nc" id="L940">					bean</span>
							.setNetWidCommRate(FormatNumber
									.formatNumber(defWidCommRate
											+ currentWidCommVar));

<span class="nc" id="L945">					double defDepCommRate = rs</span>
							.getDouble(&quot;default_deposit_comm_rate&quot;);
<span class="nc" id="L947">					bean.setDefDepCommRate(FormatNumber</span>
							.formatNumber(defDepCommRate));
					// retrieve the Deposit commission variance
<span class="nc" id="L950">					double currentDepCommVar = rs</span>
							.getDouble(&quot;deposit_comm_variance&quot;);
<span class="nc" id="L952">					bean.setCurrentDepCommVar(FormatNumber</span>
							.formatNumber(currentDepCommVar));
					// calculate the Deposit commission variance
<span class="nc" id="L955">					bean.setNetDepCommRate(FormatNumber</span>
							.formatNumber(defDepCommRate + currentDepCommVar));
					
<span class="nc" id="L958">					double defNetGCommRate = rs</span>
					.getDouble(&quot;default_net_gaming_comm_rate&quot;);
<span class="nc" id="L960">					bean.setDefNetGCommRate(FormatNumber</span>
						.formatNumber(defNetGCommRate));
					// retrieve the Net Gaming commission variance
<span class="nc" id="L963">					double currentNetGCommVar = rs</span>
							.getDouble(&quot;net_gaming_comm_variance&quot;);
<span class="nc" id="L965">					bean.setCurrentNetGCommVar(FormatNumber</span>
							.formatNumber(currentNetGCommVar));
					// calculate the Net Gaming commission variance
<span class="nc" id="L968">					bean.setNetNetGCommRate(FormatNumber</span>
							.formatNumber(defNetGCommRate + currentNetGCommVar));

<span class="nc" id="L971">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L972">					logger.debug(&quot;inside else row count 2222222222&quot;);</span>
				}
<span class="nc" id="L974">			}</span>
<span class="nc" id="L975">			rs.close();</span>
<span class="nc" id="L976">			stmt.close();</span>

			// now get the details of games from st_dg_game_master thats
			// commission variance are not set
<span class="nc" id="L980">			String query = &quot;select wallet_id, wallet_name, ret_withdrawl_comm, ret_deposit_comm, ret_net_gaming_comm from st_ola_wallet_master where wallet_id NOT IN (select wallet_id from st_ola_agent_retailer_comm_variance where retailer_org_id=&quot;</span>
					+ orgId+ &quot;)&quot;;
			/*
			 * if (!(&quot;ALL&quot;.equalsIgnoreCase(gamestatus))) query = query + &quot;and
			 * game_status='&quot; + gamestatus + &quot;'&quot;;
			 */
<span class="nc" id="L986">			System.out.println(&quot;agent  query = &quot; + query);</span>
<span class="nc" id="L987">			List&lt;SalePwtCommVarBean&gt; remList = getWidDepNetgameDetailsOLA(query,</span>
					con, walletStatus);
<span class="nc bnc" id="L989" title="All 2 branches missed.">			if (remList.size() &gt; 0) {</span>
<span class="nc" id="L990">				salePwtCommVarList.addAll(remList);</span>
			}

<span class="nc" id="L993">		} catch (SQLException e) {</span>
<span class="nc" id="L994">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L996">			try {</span>
<span class="nc bnc" id="L997" title="All 6 branches missed.">				if (pstmt != null) {</span>
<span class="nc" id="L998">					pstmt.close();</span>
				}
<span class="nc bnc" id="L1000" title="All 12 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L1001">					con.close();</span>
				}
<span class="nc" id="L1003">			} catch (SQLException e) {</span>
<span class="nc" id="L1004">				e.printStackTrace();</span>
<span class="nc" id="L1005">			}</span>
<span class="nc" id="L1006">		}</span>

<span class="nc" id="L1008">		System.out.println(&quot;name list ===== &quot; + salePwtCommVarList);</span>
<span class="nc" id="L1009">		return salePwtCommVarList;</span>

	
	}
	
	public List&lt;SalePwtCommVarBean&gt; getWidDepNetgameDetailsOLA(String query,
			Connection conn, String walletStatus)throws SQLException{

<span class="nc" id="L1017">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L1018">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L1019">		Connection connection = conn;</span>
<span class="nc" id="L1020">		PreparedStatement pstmt = connection.prepareStatement(query);</span>
<span class="nc" id="L1021">		ResultSet rss = pstmt.executeQuery();</span>
<span class="nc" id="L1022">		System.out.println(&quot; wallet name query === &quot; + pstmt);</span>
<span class="nc bnc" id="L1023" title="All 2 branches missed.">		while (rss.next()) {</span>
<span class="nc" id="L1024">			bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L1025">			String walletname = rss.getInt(&quot;wallet_id&quot;) + &quot;-&quot;</span>
					+ rss.getString(&quot;wallet_name&quot;);
<span class="nc" id="L1027">			bean.setGameName(walletname);</span>

			// retrieve the default Withdrawal commission variance
<span class="nc" id="L1030">			double defWidCommRate = rss.getDouble(&quot;ret_withdrawl_comm&quot;);</span>
<span class="nc" id="L1031">			bean.setDefWidCommRate(FormatNumber.formatNumber(defWidCommRate));</span>
			// retrieve the Withdrawal commission variance
<span class="nc" id="L1033">			double currentWidCommVar = 0.0;// rss.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L1034">			bean.setCurrentWidCommVar(FormatNumber</span>
					.formatNumber(currentWidCommVar));
			// calculate the Sale commission variance
<span class="nc" id="L1037">			bean.setNetWidCommRate(FormatNumber.formatNumber(defWidCommRate</span>
					+ currentWidCommVar));

<span class="nc" id="L1040">			double defDepCommRate = rss.getDouble(&quot;ret_deposit_comm&quot;);</span>
<span class="nc" id="L1041">			bean.setDefDepCommRate(FormatNumber.formatNumber(defDepCommRate));</span>
			// retrieve the Deposit commission variance
<span class="nc" id="L1043">			double currentDepCommVar = 0.0;// rss.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L1044">			bean.setCurrentDepCommVar(FormatNumber</span>
					.formatNumber(currentDepCommVar));
			// calculate the Deposit commission variance
<span class="nc" id="L1047">			bean.setNetDepCommRate(FormatNumber.formatNumber(defDepCommRate</span>
					+ currentDepCommVar));
			
<span class="nc" id="L1050">			double defNetGCommRate = rss.getDouble(&quot;ret_net_gaming_comm&quot;);</span>
<span class="nc" id="L1051">			bean.setDefNetGCommRate(FormatNumber.formatNumber(defNetGCommRate));</span>
			// retrieve the Net Gaming commission variance
<span class="nc" id="L1053">			double currentNetGCommVar = 0.0;// rss.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L1054">			bean.setCurrentNetGCommVar(FormatNumber</span>
					.formatNumber(currentNetGCommVar));
			// calculate the Net Gaming commission variance
<span class="nc" id="L1057">			bean.setNetNetGCommRate(FormatNumber.formatNumber(defNetGCommRate</span>
					+ currentNetGCommVar));

<span class="nc" id="L1060">			salePwtCommVarList.add(bean);</span>
<span class="nc" id="L1061">		}</span>

<span class="nc" id="L1063">		return salePwtCommVarList;</span>
	
	}
	
	
	public List&lt;SalePwtCommVarBean&gt; salePwtCommVarListForIW(String agentOrgName, String gamestatus, String orgTypeCode) {
<span class="nc" id="L1069">		System.out.println(&quot;salePwtCommVarListForIW called&quot;);</span>
<span class="nc" id="L1070">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L1071">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L1072">		con = DBConnect.getConnection();</span>

		try {

<span class="nc" id="L1076">			int orgId = Integer.parseInt(agentOrgName);</span>
<span class="nc" id="L1077">			String sqlQuery = &quot;select * from st_iw_agent_retailer_sale_pwt_comm_variance aa, st_iw_game_master gm where retailer_org_id=&quot; + orgId + &quot; and gm.game_id=aa.game_id and gm.game_id not in(select game_id from st_iw_game_master where closing_time &lt; now())&quot;;</span>
			/*
			 * if (!(&quot;ALL&quot;.equalsIgnoreCase(gamestatus))) sqlQuery = sqlQuery +
			 * &quot;and gm.game_status='&quot; + gamestatus + &quot;'&quot;;
			 */
<span class="nc" id="L1082">			System.out.println(&quot;agent organization name is ==== &quot; + agentOrgName + &quot;\n RetailerAgent query = &quot; + sqlQuery);</span>

<span class="nc" id="L1084">			Statement stmt = con.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_READ_ONLY);</span>
<span class="nc" id="L1085">			rs = stmt.executeQuery(sqlQuery);</span>
<span class="nc" id="L1086">			rs.last();</span>
<span class="nc" id="L1087">			int rowcount = rs.getRow();</span>
<span class="nc" id="L1088">			System.out.println(&quot;row count value is ======== &quot; + rowcount);</span>
<span class="nc" id="L1089">			rs.beforeFirst();</span>
<span class="nc bnc" id="L1090" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1091">				bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L1092">				System.out.println(&quot;inside if row count 11111111111111&quot;);</span>
<span class="nc" id="L1093">				int gameId = rs.getInt(&quot;game_id&quot;);</span>
<span class="nc bnc" id="L1094" title="All 2 branches missed.">				if (gameId &lt;= 0) {</span>
<span class="nc bnc" id="L1095" title="All 2 branches missed.">					if (gameId == 0) {</span>
<span class="nc" id="L1096">						bean.setGameName(&quot;Applicable on All Existing Games&quot;);</span>
<span class="nc bnc" id="L1097" title="All 2 branches missed.">					} else if (gameId == -1) {</span>
<span class="nc" id="L1098">						bean.setGameName(&quot;Applicable on All Existing and New Games&quot;);</span>
					} else {
<span class="nc" id="L1100">						bean.setGameName(&quot;Errror occured&quot;);</span>
					}
					// retrieve the default Sale commission variance
<span class="nc" id="L1103">					bean.setDefSaleCommRate(null);</span>
					// retrieve the Sale commission variance
<span class="nc" id="L1105">					double currentSaleCommVar = rs.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L1106">					bean.setCurrentSaleCommVar(FormatNumber.formatNumber(currentSaleCommVar));</span>
					// calculate the Sale commission variance
<span class="nc" id="L1108">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L1110">					bean.setDefPwtCommRate(null);</span>
					// retrieve the PWT commission variance
<span class="nc" id="L1112">					double currentPwtCommVar = rs.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L1113">					bean.setCurrentPwtCommVar(FormatNumber.formatNumber(currentPwtCommVar));</span>
					// calculate the PWT commission
					// vasalePwtCommVarListForDgriance
<span class="nc" id="L1116">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L1118">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L1119">					System.out.println(&quot;inside if row count 2222222222&quot;);</span>
<span class="nc" id="L1120">				} else {</span>
<span class="nc" id="L1121">					System.out.println(&quot;inside else rowcount 111111111111111111&quot;);</span>
<span class="nc" id="L1122">					bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L1123">					bean.setGameName(rs.getInt(&quot;game_id&quot;) + &quot;-&quot; + rs.getString(&quot;game_disp_name&quot;));</span>

					// retrieve the default Sale commission variance
<span class="nc" id="L1126">					double defSaleCommRate = rs.getDouble(&quot;default_sale_comm_rate&quot;);</span>
<span class="nc" id="L1127">					bean.setDefSaleCommRate(FormatNumber.formatNumber(defSaleCommRate));</span>
					// retrieve the Sale commission variance
<span class="nc" id="L1129">					double currentSaleCommVar = rs.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L1130">					bean.setCurrentSaleCommVar(FormatNumber.formatNumber(currentSaleCommVar));</span>
					// calculate the Sale commission variance
<span class="nc" id="L1132">					bean.setNetSaleCommRate(FormatNumber.formatNumber(defSaleCommRate + currentSaleCommVar));</span>

<span class="nc" id="L1134">					double defPwtCommRate = rs.getDouble(&quot;default_pwt_comm_rate&quot;);</span>
<span class="nc" id="L1135">					bean.setDefPwtCommRate(FormatNumber.formatNumber(defPwtCommRate));</span>
					// retrieve the PWT commission variance
<span class="nc" id="L1137">					double currentPwtCommVar = rs.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L1138">					bean.setCurrentPwtCommVar(FormatNumber.formatNumber(currentPwtCommVar));</span>
					// calculate the PWT commission variance
<span class="nc" id="L1140">					bean.setNetPwtCommRate(FormatNumber.formatNumber(defPwtCommRate + currentPwtCommVar));</span>

<span class="nc" id="L1142">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L1143">					System.out.println(&quot;inside else row count 2222222222&quot;);</span>
				}
<span class="nc" id="L1145">			}</span>
<span class="nc" id="L1146">			rs.close();</span>
<span class="nc" id="L1147">			stmt.close();</span>

<span class="nc" id="L1149">			String query = &quot;select game_id, game_no, game_disp_name, retailer_sale_comm_rate, retailer_pwt_comm_rate, gov_comm_rate, prize_payout_ratio from st_iw_game_master where game_id NOT IN (select game_id from st_iw_agent_retailer_sale_pwt_comm_variance where retailer_org_id=&quot; + orgId + &quot; union select game_id from st_iw_game_master where closing_time &lt; now())&quot;;</span>
			/*
			 * if (!(&quot;ALL&quot;.equalsIgnoreCase(gamestatus))) query = query + &quot;and
			 * game_status='&quot; + gamestatus + &quot;'&quot;;
			 */
<span class="nc" id="L1154">			System.out.println(&quot;agent  query = &quot; + query);</span>
<span class="nc" id="L1155">			List&lt;SalePwtCommVarBean&gt; remList = getSalePwtGameDetailsIW(query, con, gamestatus);</span>
<span class="nc bnc" id="L1156" title="All 2 branches missed.">			if (remList.size() &gt; 0) {</span>
<span class="nc" id="L1157">				salePwtCommVarList.addAll(remList);</span>
			}
<span class="nc" id="L1159">		} catch (SQLException e) {</span>
<span class="nc" id="L1160">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1162">			try {</span>
<span class="nc bnc" id="L1163" title="All 6 branches missed.">				if (pstmt != null) {</span>
<span class="nc" id="L1164">					pstmt.close();</span>
				}
<span class="nc bnc" id="L1166" title="All 12 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L1167">					con.close();</span>
				}
<span class="nc" id="L1169">			} catch (SQLException e) {</span>
<span class="nc" id="L1170">				e.printStackTrace();</span>
<span class="nc" id="L1171">			}</span>
<span class="nc" id="L1172">		}</span>
<span class="nc" id="L1173">		System.out.println(&quot;name list ===== &quot; + salePwtCommVarList);</span>
<span class="nc" id="L1174">		return salePwtCommVarList;</span>
	}
	
	
	public List&lt;SalePwtCommVarBean&gt; salePwtCommVarListForVS(String agentOrgName, String gamestatus, String orgTypeCode) {
<span class="nc" id="L1179">		System.out.println(&quot;salePwtCommVarListForVS called&quot;);</span>
<span class="nc" id="L1180">		List&lt;SalePwtCommVarBean&gt; salePwtCommVarList = new ArrayList&lt;SalePwtCommVarBean&gt;();</span>
<span class="nc" id="L1181">		SalePwtCommVarBean bean = null;</span>
<span class="nc" id="L1182">		con = DBConnect.getConnection();</span>

		try {
<span class="nc" id="L1185">			int orgId = Integer.parseInt(agentOrgName);</span>
<span class="nc" id="L1186">			String sqlQuery = &quot;select * from st_vs_agent_retailer_sale_pwt_comm_variance aa, st_vs_game_master gm where retailer_org_id=&quot; + orgId + &quot; and gm.game_id=aa.game_id and gm.game_id not in(select game_id from st_vs_game_master where closing_time &lt; now())&quot;;</span>
			/*
			 * if (!(&quot;ALL&quot;.equalsIgnoreCase(gamestatus))) sqlQuery = sqlQuery +
			 * &quot;and gm.game_status='&quot; + gamestatus + &quot;'&quot;;
			 */
<span class="nc" id="L1191">			System.out.println(&quot;agent organization name is ==== &quot; + agentOrgName + &quot;\n RetailerAgent query = &quot; + sqlQuery);</span>

<span class="nc" id="L1193">			Statement stmt = con.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_READ_ONLY);</span>
<span class="nc" id="L1194">			rs = stmt.executeQuery(sqlQuery);</span>
<span class="nc" id="L1195">			rs.last();</span>
<span class="nc" id="L1196">			int rowcount = rs.getRow();</span>
<span class="nc" id="L1197">			System.out.println(&quot;row count value is ======== &quot; + rowcount);</span>
<span class="nc" id="L1198">			rs.beforeFirst();</span>
<span class="nc bnc" id="L1199" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1200">				bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L1201">				System.out.println(&quot;inside if row count 11111111111111&quot;);</span>
<span class="nc" id="L1202">				int gameId = rs.getInt(&quot;game_id&quot;);</span>
<span class="nc bnc" id="L1203" title="All 2 branches missed.">				if (gameId &lt;= 0) {</span>
<span class="nc bnc" id="L1204" title="All 2 branches missed.">					if (gameId == 0) {</span>
<span class="nc" id="L1205">						bean.setGameName(&quot;Applicable on All Existing Games&quot;);</span>
<span class="nc bnc" id="L1206" title="All 2 branches missed.">					} else if (gameId == -1) {</span>
<span class="nc" id="L1207">						bean.setGameName(&quot;Applicable on All Existing and New Games&quot;);</span>
					} else {
<span class="nc" id="L1209">						bean.setGameName(&quot;Errror occured&quot;);</span>
					}
					// retrieve the default Sale commission variance
<span class="nc" id="L1212">					bean.setDefSaleCommRate(null);</span>
					// retrieve the Sale commission variance
<span class="nc" id="L1214">					double currentSaleCommVar = rs.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L1215">					bean.setCurrentSaleCommVar(FormatNumber.formatNumber(currentSaleCommVar));</span>
					// calculate the Sale commission variance
<span class="nc" id="L1217">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L1219">					bean.setDefPwtCommRate(null);</span>
					// retrieve the PWT commission variance
<span class="nc" id="L1221">					double currentPwtCommVar = rs.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L1222">					bean.setCurrentPwtCommVar(FormatNumber.formatNumber(currentPwtCommVar));</span>
					// calculate the PWT commission
					// vasalePwtCommVarListForDgriance
<span class="nc" id="L1225">					bean.setNetSaleCommRate(null);</span>

<span class="nc" id="L1227">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L1228">					System.out.println(&quot;inside if row count 2222222222&quot;);</span>
<span class="nc" id="L1229">				} else {</span>
<span class="nc" id="L1230">					System.out.println(&quot;inside else rowcount 111111111111111111&quot;);</span>
<span class="nc" id="L1231">					bean = new SalePwtCommVarBean();</span>
<span class="nc" id="L1232">					bean.setGameName(rs.getInt(&quot;game_id&quot;) + &quot;-&quot; + rs.getString(&quot;game_disp_name&quot;));</span>

					// retrieve the default Sale commission variance
<span class="nc" id="L1235">					double defSaleCommRate = rs.getDouble(&quot;default_sale_comm_rate&quot;);</span>
<span class="nc" id="L1236">					bean.setDefSaleCommRate(FormatNumber.formatNumber(defSaleCommRate));</span>
					// retrieve the Sale commission variance
<span class="nc" id="L1238">					double currentSaleCommVar = rs.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L1239">					bean.setCurrentSaleCommVar(FormatNumber.formatNumber(currentSaleCommVar));</span>
					// calculate the Sale commission variance
<span class="nc" id="L1241">					bean.setNetSaleCommRate(FormatNumber.formatNumber(defSaleCommRate + currentSaleCommVar));</span>

<span class="nc" id="L1243">					double defPwtCommRate = rs.getDouble(&quot;default_pwt_comm_rate&quot;);</span>
<span class="nc" id="L1244">					bean.setDefPwtCommRate(FormatNumber.formatNumber(defPwtCommRate));</span>
					// retrieve the PWT commission variance
<span class="nc" id="L1246">					double currentPwtCommVar = rs.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L1247">					bean.setCurrentPwtCommVar(FormatNumber.formatNumber(currentPwtCommVar));</span>
					// calculate the PWT commission variance
<span class="nc" id="L1249">					bean.setNetPwtCommRate(FormatNumber.formatNumber(defPwtCommRate + currentPwtCommVar));</span>

<span class="nc" id="L1251">					salePwtCommVarList.add(bean);</span>
<span class="nc" id="L1252">					System.out.println(&quot;inside else row count 2222222222&quot;);</span>
				}
<span class="nc" id="L1254">			}</span>
<span class="nc" id="L1255">			rs.close();</span>
<span class="nc" id="L1256">			stmt.close();</span>

<span class="nc" id="L1258">			String query = &quot;select game_id, game_no, game_disp_name, retailer_sale_comm_rate, retailer_pwt_comm_rate, gov_comm_rate, prize_payout_ratio from st_vs_game_master where game_id NOT IN (select game_id from st_vs_agent_retailer_sale_pwt_comm_variance where retailer_org_id=&quot; + orgId + &quot; union select game_id from st_vs_game_master where closing_time &lt; now())&quot;;</span>
			/*
			 * if (!(&quot;ALL&quot;.equalsIgnoreCase(gamestatus))) query = query + &quot;and
			 * game_status='&quot; + gamestatus + &quot;'&quot;;
			 */
<span class="nc" id="L1263">			System.out.println(&quot;agent  query = &quot; + query);</span>
<span class="nc" id="L1264">			List&lt;SalePwtCommVarBean&gt; remList = getSalePwtGameDetailsVS(query, con, gamestatus);</span>
<span class="nc bnc" id="L1265" title="All 2 branches missed.">			if (remList.size() &gt; 0) {</span>
<span class="nc" id="L1266">				salePwtCommVarList.addAll(remList);</span>
			}
<span class="nc" id="L1268">		} catch (SQLException e) {</span>
<span class="nc" id="L1269">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1271">			try {</span>
<span class="nc bnc" id="L1272" title="All 6 branches missed.">				if (pstmt != null) {</span>
<span class="nc" id="L1273">					pstmt.close();</span>
				}
<span class="nc bnc" id="L1275" title="All 12 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L1276">					con.close();</span>
				}
<span class="nc" id="L1278">			} catch (SQLException e) {</span>
<span class="nc" id="L1279">				e.printStackTrace();</span>
<span class="nc" id="L1280">			}</span>
<span class="nc" id="L1281">		}</span>
<span class="nc" id="L1282">		System.out.println(&quot;name list ===== &quot; + salePwtCommVarList);</span>
<span class="nc" id="L1283">		return salePwtCommVarList;</span>
	}

	public String submitUpdatedValue(String agtOrgName, String gname,
			String defSaleCommRate, String saleCommVar, String defPwtCommRate,
			String pwtCommVar, int userOrgId,String countryDep) throws LMSException {

<span class="nc" id="L1290">		String game[] = gname.split(&quot;-&quot;);</span>
<span class="nc" id="L1291">		double dSaleCommRate = Double.parseDouble(defSaleCommRate.trim());</span>
<span class="nc" id="L1292">		double saleCommVar1 = Double.parseDouble(saleCommVar.trim());</span>
<span class="nc" id="L1293">		double dPwtCommRate = Double.parseDouble(defPwtCommRate.trim());</span>
<span class="nc" id="L1294">		double pwtCommVar1 = Double.parseDouble(pwtCommVar.trim());</span>
<span class="nc" id="L1295">		UpdateSalePwtCommVarBean commVarianceBean = null;</span>
<span class="nc" id="L1296">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L1297">		boolean flagforZero = false;</span>
<span class="nc" id="L1298">		double dAgtSaleComm = 0.0;</span>
<span class="nc" id="L1299">		double agtSaleComm = 0.0;</span>
<span class="nc" id="L1300">		double dAgtPwtComm = 0.0;</span>
<span class="nc" id="L1301">		double agtPwtComm = 0.0;</span>
		try {
<span class="nc" id="L1303">			int orgId = Integer.parseInt(agtOrgName);</span>
<span class="nc" id="L1304">			conn.setAutoCommit(false);</span>
<span class="nc" id="L1305">			PreparedStatement pstmt0 = conn</span>
					.prepareStatement(&quot;select agent_org_id, game_id, sale_comm_variance, default_sale_comm_rate, pwt_comm_variance, default_pwt_comm_rate from st_se_bo_agent_sale_pwt_comm_variance  gm where game_id=(select game_id from st_se_game_master where game_nbr=&quot;
							+ game[0]
							+ &quot; ) and agent_org_id=(select parent_id from st_lms_organization_master where organization_id=&quot;
							+ orgId + &quot;)&quot;);
<span class="nc" id="L1310">			ResultSet rs0 = pstmt0.executeQuery();</span>
<span class="nc" id="L1311">			System.out.println(&quot;query = &quot; + pstmt0);</span>
<span class="nc bnc" id="L1312" title="All 2 branches missed.">			if (rs0.next()) {</span>
<span class="nc" id="L1313">				dAgtSaleComm = rs0.getDouble(&quot;default_sale_comm_rate&quot;);</span>
<span class="nc" id="L1314">				agtSaleComm = rs0.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L1315">				dAgtPwtComm = rs0.getDouble(&quot;default_pwt_comm_rate&quot;);</span>
<span class="nc" id="L1316">				agtPwtComm = rs0.getDouble(&quot;pwt_comm_variance&quot;);</span>
			} else {
<span class="nc" id="L1318">				PreparedStatement pstmtGameMaster = conn</span>
						.prepareStatement(&quot;select agent_sale_comm_rate,agent_pwt_comm_rate from st_se_game_master where game_nbr=&quot;
								+ game[0]);
<span class="nc" id="L1321">				ResultSet rsGameMaster = pstmtGameMaster.executeQuery();</span>
<span class="nc" id="L1322">				System.out.println(&quot;query = &quot; + pstmtGameMaster);</span>
<span class="nc bnc" id="L1323" title="All 2 branches missed.">				if (rsGameMaster.next()) {</span>
<span class="nc" id="L1324">					dAgtSaleComm = rsGameMaster</span>
							.getDouble(&quot;agent_sale_comm_rate&quot;);
<span class="nc" id="L1326">					dAgtPwtComm = rsGameMaster.getDouble(&quot;agent_pwt_comm_rate&quot;);</span>
				}
			}
<span class="nc bnc" id="L1329" title="All 4 branches missed.">			double diffSaleComm = dAgtSaleComm</span>
					+ (agtSaleComm &lt; 0 ? agtSaleComm : (&quot;kenya&quot;.equalsIgnoreCase(countryDep)?agtSaleComm:0.0))
					- (dSaleCommRate + saleCommVar1);
<span class="nc bnc" id="L1332" title="All 2 branches missed.">			double diffPwtComm = dAgtPwtComm</span>
					+ (agtPwtComm &lt; 0 ? agtPwtComm : 0.0)
					- (dPwtCommRate + pwtCommVar1);
<span class="nc bnc" id="L1335" title="All 4 branches missed.">			if (diffSaleComm &gt;= 0 &amp;&amp; diffPwtComm &gt;= 0) {</span>
<span class="nc" id="L1336">				PreparedStatement pstmt1 = conn</span>
						.prepareStatement(&quot;select retailer_org_id, game_id, sale_comm_variance, default_sale_comm_rate, pwt_comm_variance, default_pwt_comm_rate from st_se_agent_retailer_sale_pwt_comm_variance where game_id=(select game_id from st_se_game_master where game_nbr=&quot;
								+ game[0]
								+ &quot; ) and retailer_org_id=&quot;
								+ orgId + &quot;&quot;);
<span class="nc" id="L1341">				ResultSet rs1 = pstmt1.executeQuery();</span>
<span class="nc" id="L1342">				System.out.println(&quot;query = &quot; + pstmt1);</span>
<span class="nc bnc" id="L1343" title="All 2 branches missed.">				if (rs1.next()) {</span>
<span class="nc" id="L1344">					System.out.println(&quot;inside pstmt1---11111111&quot;);</span>
<span class="nc" id="L1345">					double oldPwtCommVar = rs1.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L1346">					double oldSaleCommVar = rs1.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc bnc" id="L1347" title="All 4 branches missed.">					if (oldPwtCommVar == pwtCommVar1</span>
							&amp;&amp; saleCommVar1 == oldSaleCommVar) {
<span class="nc" id="L1349">						return &quot;SAME_VALUES&quot;;</span>
					}

<span class="nc" id="L1352">					commVarianceBean = new UpdateSalePwtCommVarBean();</span>
<span class="nc" id="L1353">					commVarianceBean.setRetOrgId(rs1.getInt(&quot;retailer_org_id&quot;));</span>
<span class="nc" id="L1354">					commVarianceBean.setGameId(rs1.getInt(&quot;game_id&quot;));</span>
<span class="nc" id="L1355">					commVarianceBean.setSaleCommVar(oldSaleCommVar);</span>
<span class="nc" id="L1356">					commVarianceBean.setDefaultSaleCommRate(rs1</span>
							.getDouble(&quot;default_sale_comm_rate&quot;));
<span class="nc" id="L1358">					commVarianceBean.setPwtCommVar(oldPwtCommVar);</span>
<span class="nc" id="L1359">					commVarianceBean.setDefaultPwtCommRate(rs1</span>
							.getDouble(&quot;default_pwt_comm_rate&quot;));
<span class="nc" id="L1361">					System.out.println(&quot;inside pstmt1---22222222&quot;);</span>
				}
<span class="nc" id="L1363">				pstmt1.close();</span>
<span class="nc" id="L1364">				rs1.close();</span>

<span class="nc bnc" id="L1366" title="All 2 branches missed.">				if (commVarianceBean != null) {</span>
<span class="nc" id="L1367">					System.out.println(&quot;555555555555555&quot;);</span>
<span class="nc" id="L1368">					PreparedStatement pstmt5 = conn</span>
							.prepareStatement(&quot;delete from st_se_agent_retailer_sale_pwt_comm_variance  where game_id=? and retailer_org_id=?&quot;);
<span class="nc" id="L1370">					pstmt5.setInt(1, commVarianceBean.getGameId());</span>
<span class="nc" id="L1371">					pstmt5.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L1372">					int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L1373">					System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L1374">					System.out</span>
							.println(&quot;Delete entry from st_se_agent_retailer_sale_pwt_comm_variance  table updated rows === &quot;
									+ rows);
<span class="nc" id="L1377">					pstmt5.close();</span>
<span class="nc" id="L1378">					flagforZero = true;</span>
				}

<span class="nc bnc" id="L1381" title="All 4 branches missed.">				if (commVarianceBean != null</span>
						&amp;&amp; saleCommVar1 != commVarianceBean.getSaleCommVar()) {
<span class="nc" id="L1383">					System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L1384">					PreparedStatement pstmt3 = conn</span>
							.prepareStatement(&quot;insert into st_se_agent_retailer_sale_comm_variance_history values(?, ?, ?, ?,?)&quot;);
<span class="nc" id="L1386">					pstmt3.setInt(1, userOrgId);</span>
<span class="nc" id="L1387">					pstmt3.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L1388">					pstmt3.setInt(3, commVarianceBean.getGameId());</span>
<span class="nc" id="L1389">					pstmt3.setDouble(4, commVarianceBean.getSaleCommVar());</span>
<span class="nc" id="L1390">					pstmt3.setTimestamp(5, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L1392">					int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L1393">					System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L1394">					System.out</span>
							.println(&quot;sale comm var history table updated rows === &quot;
									+ rows);
<span class="nc" id="L1397">					pstmt3.close();</span>
				}

<span class="nc bnc" id="L1400" title="All 4 branches missed.">				if (commVarianceBean != null</span>
						&amp;&amp; pwtCommVar1 != commVarianceBean.getPwtCommVar()) {
<span class="nc" id="L1402">					System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L1403">					PreparedStatement pstmt4 = conn</span>
							.prepareStatement(&quot;insert into st_se_agent_retailer_pwt_comm_variance_history values(?, ?, ?, ?,?)&quot;);
<span class="nc" id="L1405">					pstmt4.setInt(1, userOrgId);</span>
<span class="nc" id="L1406">					pstmt4.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L1407">					pstmt4.setInt(3, commVarianceBean.getGameId());</span>
<span class="nc" id="L1408">					pstmt4.setDouble(4, commVarianceBean.getPwtCommVar());</span>
<span class="nc" id="L1409">					pstmt4.setTimestamp(5, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L1411">					int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L1412">					System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L1413">					System.out</span>
							.println(&quot;PWT comm var history table updated rows === &quot;
									+ rows);
<span class="nc" id="L1416">					pstmt4.close();</span>
				}

<span class="nc" id="L1419">				System.out.println(saleCommVar1 + &quot; **saleCommVar1** &quot;</span>
						+ pwtCommVar1);
<span class="nc bnc" id="L1421" title="All 4 branches missed.">				System.out.println(&quot;saleCommVar1!=0.0 ||  pwtCommVar1!=0.0&quot;</span>
						+ (saleCommVar1 != 0.0 || pwtCommVar1 != 0.0));
<span class="nc bnc" id="L1423" title="All 4 branches missed.">				if (saleCommVar1 != 0.0 || pwtCommVar1 != 0.0) {</span>
<span class="nc" id="L1424">					System.out.println(&quot;66666666666666666666666666&quot;);</span>
<span class="nc" id="L1425">					PreparedStatement pstmt6 = conn</span>
							.prepareStatement(&quot; select game_id from st_se_game_master where game_nbr=?   &quot;);
				//	pstmt6.setString(1, agtOrgName.trim());
<span class="nc" id="L1428">					pstmt6.setInt(1, Integer.parseInt(game[0]));</span>
					//pstmt6.setString(3, game[1]);
<span class="nc" id="L1430">					ResultSet rs6 = pstmt6.executeQuery();</span>
<span class="nc" id="L1431">					System.out.println(&quot;query = &quot; + pstmt6);</span>
<span class="nc" id="L1432">					int gameId = 0;</span>
					//int retOrgid = 0;
<span class="nc bnc" id="L1434" title="All 2 branches missed.">					if (rs6.next()) {</span>
<span class="nc" id="L1435">						gameId = rs6.getInt(&quot;game_id&quot;);</span>
					///	retOrgid = rs6.getInt(&quot;organization_id&quot;);
					}
<span class="nc bnc" id="L1438" title="All 4 branches missed.">					if (gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L1439">						PreparedStatement pstmt5 = conn</span>
								.prepareStatement(&quot;insert into st_se_agent_retailer_sale_pwt_comm_variance  values (? , ? , ? ,?,?, ?,?)&quot;);
<span class="nc" id="L1441">						pstmt5.setInt(1, userOrgId);</span>
<span class="nc" id="L1442">						pstmt5.setInt(2, orgId);</span>
<span class="nc" id="L1443">						pstmt5.setInt(3, gameId);</span>
<span class="nc" id="L1444">						pstmt5.setDouble(4, saleCommVar1);</span>
<span class="nc" id="L1445">						pstmt5.setDouble(5, dSaleCommRate);</span>
<span class="nc" id="L1446">						pstmt5.setDouble(6, pwtCommVar1);</span>
<span class="nc" id="L1447">						pstmt5.setDouble(7, dPwtCommRate);</span>
<span class="nc" id="L1448">						int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L1449">						System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L1450">						System.out</span>
								.println(&quot;insert entries st_se_agent_retailer_sale_pwt_comm_variance  table updated rows === &quot;
										+ rows);
<span class="nc" id="L1453">						pstmt5.close();</span>
					}

<span class="nc bnc" id="L1456" title="All 6 branches missed.">					if (commVarianceBean == null &amp;&amp; gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L1457">						System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L1458">						PreparedStatement pstmt3 = conn</span>
								.prepareStatement(&quot;insert into st_se_agent_retailer_sale_comm_variance_history values(?, ?, ?, ?,?)&quot;);
<span class="nc" id="L1460">						pstmt3.setInt(1, userOrgId);</span>
<span class="nc" id="L1461">						pstmt3.setInt(2, orgId);</span>
<span class="nc" id="L1462">						pstmt3.setInt(3, gameId);</span>
<span class="nc" id="L1463">						pstmt3.setDouble(4, 0.0);</span>
<span class="nc" id="L1464">						pstmt3.setTimestamp(5, new java.sql.Timestamp(</span>
								new java.util.Date().getTime()));
<span class="nc" id="L1466">						int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L1467">						System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L1468">						System.out</span>
								.println(&quot;sale comm var history table updated rows === &quot;
										+ rows);
<span class="nc" id="L1471">						pstmt3.close();</span>
					}

<span class="nc bnc" id="L1474" title="All 6 branches missed.">					if (commVarianceBean == null &amp;&amp; gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L1475">						System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L1476">						PreparedStatement pstmt4 = conn</span>
								.prepareStatement(&quot;insert into st_se_agent_retailer_pwt_comm_variance_history values(?, ?, ?, ?,?)&quot;);
<span class="nc" id="L1478">						pstmt4.setInt(1, userOrgId);</span>
<span class="nc" id="L1479">						pstmt4.setInt(2, orgId);</span>
<span class="nc" id="L1480">						pstmt4.setInt(3, gameId);</span>
<span class="nc" id="L1481">						pstmt4.setDouble(4, 0.0);</span>
<span class="nc" id="L1482">						pstmt4.setTimestamp(5, new java.sql.Timestamp(</span>
								new java.util.Date().getTime()));
<span class="nc" id="L1484">						int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L1485">						System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L1486">						System.out</span>
								.println(&quot;PWT comm var history table updated rows === &quot;
										+ rows);
<span class="nc" id="L1489">						pstmt4.close();</span>
					}

				}
<span class="nc" id="L1493">			} else {</span>
<span class="nc bnc" id="L1494" title="All 6 branches missed.">				return &quot;AGENT_DIFF_GREATER;&quot;</span>
						+ (dAgtSaleComm + (agtSaleComm &lt; 0 ? agtSaleComm : (&quot;kenya&quot;.equalsIgnoreCase(countryDep)?agtSaleComm:0.0)))
						+ &quot;;&quot;
						+ (dAgtPwtComm + (agtPwtComm &lt; 0 ? agtPwtComm : 0.0));
			}
<span class="nc" id="L1499">			conn.commit();</span>
<span class="nc" id="L1500">		} catch (SQLException se) {</span>
			try {
<span class="nc" id="L1502">				System.out.println(&quot;rollbacked&quot;);</span>
<span class="nc" id="L1503">				conn.rollback();</span>
<span class="nc" id="L1504">			} catch (SQLException e) {</span>
<span class="nc" id="L1505">				e.printStackTrace();</span>
				// throw new LMSException(e);
<span class="nc" id="L1507">			}</span>
<span class="nc" id="L1508">			se.printStackTrace();</span>
<span class="nc" id="L1509">			throw new LMSException(se);</span>

		} finally {

<span class="nc" id="L1513">			try {</span>
<span class="nc bnc" id="L1514" title="All 16 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L1515">					conn.close();</span>
				}
<span class="nc" id="L1517">			} catch (SQLException e) {</span>
<span class="nc" id="L1518">				e.printStackTrace();</span>
<span class="nc" id="L1519">			}</span>

<span class="nc" id="L1521">		}</span>

<span class="nc" id="L1523">		return &quot;SUCCESS&quot;;</span>
	}

	public String submitUpdatedValueDg(String agtOrgName, String gname,
			String defSaleCommRate, String saleCommVar, String defPwtCommRate,
			String pwtCommVar, int userOrgId,String countryDep) throws LMSException {

<span class="nc" id="L1530">		String game[] = gname.split(&quot;-&quot;);</span>
<span class="nc" id="L1531">		double dSaleCommRate = Double.parseDouble(defSaleCommRate.trim());</span>
<span class="nc" id="L1532">		double saleCommVar1 = Double.parseDouble(saleCommVar.trim());</span>
<span class="nc" id="L1533">		double dPwtCommRate = Double.parseDouble(defPwtCommRate.trim());</span>
<span class="nc" id="L1534">		double pwtCommVar1 = Double.parseDouble(pwtCommVar.trim());</span>
<span class="nc" id="L1535">		UpdateSalePwtCommVarBean commVarianceBean = null;</span>
<span class="nc" id="L1536">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L1537">		boolean flagforZero = false;</span>
<span class="nc" id="L1538">		double dAgtSaleComm = 0.0;</span>
<span class="nc" id="L1539">		double agtSaleComm = 0.0;</span>
<span class="nc" id="L1540">		double dAgtPwtComm = 0.0;</span>
<span class="nc" id="L1541">		double agtPwtComm = 0.0;</span>
		try {
<span class="nc" id="L1543">			int orgId = Integer.parseInt(agtOrgName);</span>
<span class="nc" id="L1544">			conn.setAutoCommit(false);</span>
<span class="nc" id="L1545">			PreparedStatement pstmt0 = conn</span>
					.prepareStatement(&quot;select agent_org_id, game_id, sale_comm_variance, default_sale_comm_rate, pwt_comm_variance, default_pwt_comm_rate from st_dg_bo_agent_sale_pwt_comm_variance  gm where game_id=&quot;
							+ game[0]
							+ &quot; and agent_org_id=(select parent_id from st_lms_organization_master where organization_id=&quot;
							+ orgId + &quot;)&quot;);
<span class="nc" id="L1550">			ResultSet rs0 = pstmt0.executeQuery();</span>
<span class="nc" id="L1551">			System.out.println(&quot;query = &quot; + pstmt0);</span>
<span class="nc bnc" id="L1552" title="All 2 branches missed.">			if (rs0.next()) {</span>
<span class="nc" id="L1553">				dAgtSaleComm = rs0.getDouble(&quot;default_sale_comm_rate&quot;);</span>
<span class="nc" id="L1554">				agtSaleComm = rs0.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L1555">				dAgtPwtComm = rs0.getDouble(&quot;default_pwt_comm_rate&quot;);</span>
<span class="nc" id="L1556">				agtPwtComm = rs0.getDouble(&quot;pwt_comm_variance&quot;);</span>
			} else {
<span class="nc" id="L1558">				PreparedStatement pstmtGameMaster = conn</span>
						.prepareStatement(&quot;select agent_sale_comm_rate,agent_pwt_comm_rate from st_dg_game_master where game_id=&quot;
								+ game[0]);
<span class="nc" id="L1561">				ResultSet rsGameMaster = pstmtGameMaster.executeQuery();</span>
<span class="nc" id="L1562">				System.out.println(&quot;query = &quot; + pstmtGameMaster);</span>
<span class="nc bnc" id="L1563" title="All 2 branches missed.">				if (rsGameMaster.next()) {</span>
<span class="nc" id="L1564">					dAgtSaleComm = rsGameMaster</span>
							.getDouble(&quot;agent_sale_comm_rate&quot;);
<span class="nc" id="L1566">					dAgtPwtComm = rsGameMaster.getDouble(&quot;agent_pwt_comm_rate&quot;);</span>
				}
			}
<span class="nc bnc" id="L1569" title="All 4 branches missed.">			double diffSaleComm = dAgtSaleComm</span>
					+ (agtSaleComm &lt; 0 ? agtSaleComm : (&quot;kenya&quot;.equalsIgnoreCase(countryDep)?agtSaleComm:0.0))
					- (dSaleCommRate + saleCommVar1);
<span class="nc bnc" id="L1572" title="All 2 branches missed.">			double diffPwtComm = dAgtPwtComm</span>
					+ (agtPwtComm &lt; 0 ? agtPwtComm : 0.0)
					- (dPwtCommRate + pwtCommVar1);
<span class="nc bnc" id="L1575" title="All 4 branches missed.">			if (diffSaleComm &gt;= 0 &amp;&amp; diffPwtComm &gt;= 0) {</span>

<span class="nc" id="L1577">				PreparedStatement pstmt1 = conn</span>
						.prepareStatement(&quot;select retailer_org_id, game_id, sale_comm_variance, default_sale_comm_rate, pwt_comm_variance, default_pwt_comm_rate from st_dg_agent_retailer_sale_pwt_comm_variance where game_id=&quot;
								+ game[0]
								+ &quot; and retailer_org_id=&quot;
								+ orgId + &quot;&quot;);
<span class="nc" id="L1582">				ResultSet rs1 = pstmt1.executeQuery();</span>
<span class="nc" id="L1583">				System.out.println(&quot;query = &quot; + pstmt1);</span>
<span class="nc bnc" id="L1584" title="All 2 branches missed.">				if (rs1.next()) {</span>
<span class="nc" id="L1585">					System.out.println(&quot;inside pstmt1---11111111&quot;);</span>
<span class="nc" id="L1586">					double oldPwtCommVar = rs1.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L1587">					double oldSaleCommVar = rs1.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc bnc" id="L1588" title="All 4 branches missed.">					if (oldPwtCommVar == pwtCommVar1</span>
							&amp;&amp; saleCommVar1 == oldSaleCommVar) {
<span class="nc" id="L1590">						return &quot;SAME_VALUES&quot;;</span>
					}

<span class="nc" id="L1593">					commVarianceBean = new UpdateSalePwtCommVarBean();</span>
<span class="nc" id="L1594">					commVarianceBean.setRetOrgId(rs1.getInt(&quot;retailer_org_id&quot;));</span>
<span class="nc" id="L1595">					commVarianceBean.setGameId(rs1.getInt(&quot;game_id&quot;));</span>
<span class="nc" id="L1596">					commVarianceBean.setSaleCommVar(oldSaleCommVar);</span>
<span class="nc" id="L1597">					commVarianceBean.setDefaultSaleCommRate(rs1</span>
							.getDouble(&quot;default_sale_comm_rate&quot;));
<span class="nc" id="L1599">					commVarianceBean.setPwtCommVar(oldPwtCommVar);</span>
<span class="nc" id="L1600">					commVarianceBean.setDefaultPwtCommRate(rs1</span>
							.getDouble(&quot;default_pwt_comm_rate&quot;));
<span class="nc" id="L1602">					System.out.println(&quot;inside pstmt1---22222222&quot;);</span>
				}
<span class="nc" id="L1604">				pstmt1.close();</span>
<span class="nc" id="L1605">				rs1.close();</span>

<span class="nc bnc" id="L1607" title="All 2 branches missed.">				if (commVarianceBean != null) {</span>
<span class="nc" id="L1608">					System.out.println(&quot;555555555555555&quot;);</span>
<span class="nc" id="L1609">					PreparedStatement pstmt5 = conn</span>
							.prepareStatement(&quot;delete from st_dg_agent_retailer_sale_pwt_comm_variance  where game_id=? and retailer_org_id=?&quot;);
<span class="nc" id="L1611">					pstmt5.setInt(1, commVarianceBean.getGameId());</span>
<span class="nc" id="L1612">					pstmt5.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L1613">					int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L1614">					System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L1615">					System.out</span>
							.println(&quot;Delete entry from st_dg_agent_retailer_sale_pwt_comm_variance  table updated rows === &quot;
									+ rows);
<span class="nc" id="L1618">					pstmt5.close();</span>
<span class="nc" id="L1619">					flagforZero = true;</span>
				}

<span class="nc bnc" id="L1622" title="All 4 branches missed.">				if (commVarianceBean != null</span>
						&amp;&amp; saleCommVar1 != commVarianceBean.getSaleCommVar()) {
<span class="nc" id="L1624">					System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L1625">					PreparedStatement pstmt3 = conn</span>
							.prepareStatement(&quot;insert into st_dg_agent_retailer_sale_comm_variance_history values(?, ?, ?, ?,?)&quot;);
<span class="nc" id="L1627">					pstmt3.setInt(1, userOrgId);</span>
<span class="nc" id="L1628">					pstmt3.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L1629">					pstmt3.setInt(3, commVarianceBean.getGameId());</span>
<span class="nc" id="L1630">					pstmt3.setDouble(4, commVarianceBean.getSaleCommVar());</span>
<span class="nc" id="L1631">					pstmt3.setTimestamp(5, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L1633">					int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L1634">					System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L1635">					System.out</span>
							.println(&quot;sale comm var history table updated rows === &quot;
									+ rows);
<span class="nc" id="L1638">					pstmt3.close();</span>
				}

<span class="nc bnc" id="L1641" title="All 4 branches missed.">				if (commVarianceBean != null</span>
						&amp;&amp; pwtCommVar1 != commVarianceBean.getPwtCommVar()) {
<span class="nc" id="L1643">					System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L1644">					PreparedStatement pstmt4 = conn</span>
							.prepareStatement(&quot;insert into st_dg_agent_retailer_pwt_comm_variance_history values(?, ?, ?, ?,?)&quot;);
<span class="nc" id="L1646">					pstmt4.setInt(1, userOrgId);</span>
<span class="nc" id="L1647">					pstmt4.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L1648">					pstmt4.setInt(3, commVarianceBean.getGameId());</span>
<span class="nc" id="L1649">					pstmt4.setDouble(4, commVarianceBean.getPwtCommVar());</span>
<span class="nc" id="L1650">					pstmt4.setTimestamp(5, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L1652">					int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L1653">					System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L1654">					System.out</span>
							.println(&quot;PWT comm var history table updated rows === &quot;
									+ rows);
<span class="nc" id="L1657">					pstmt4.close();</span>
				}

<span class="nc" id="L1660">				System.out.println(saleCommVar1 + &quot; **saleCommVar1** &quot;</span>
						+ pwtCommVar1);
<span class="nc bnc" id="L1662" title="All 4 branches missed.">				System.out.println(&quot;saleCommVar1!=0.0 ||  pwtCommVar1!=0.0&quot;</span>
						+ (saleCommVar1 != 0.0 || pwtCommVar1 != 0.0));
				
<span class="nc" id="L1665">				System.out.println(&quot;66666666666666666666666666&quot;);</span>
			/*	PreparedStatement pstmt6 = conn
						.prepareStatement(&quot; select game_id from st_dg_game_master where game_id=?  &quot;);
				//pstmt6.setString(1, agtOrgName.trim());
				pstmt6.setInt(1, Integer.parseInt(game[0]));
				//pstmt6.setString(3, game[1]);
				ResultSet rs6 = pstmt6.executeQuery();
				System.out.println(&quot;query = &quot; + pstmt6);*/
<span class="nc" id="L1673">				int gameId = Integer.parseInt(game[0]);</span>
				// int retOrgid = 0;
			/*	if (rs6.next()) {
					gameId = rs6.getInt(&quot;game_id&quot;);
				//	retOrgid = rs6.getInt(&quot;organization_id&quot;);
				}	*/			
				
<span class="nc bnc" id="L1680" title="All 4 branches missed.">				if (saleCommVar1 != 0.0 || pwtCommVar1 != 0.0) {					</span>
<span class="nc bnc" id="L1681" title="All 4 branches missed.">					if (gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L1682">						PreparedStatement pstmt5 = conn</span>
								.prepareStatement(&quot;insert into st_dg_agent_retailer_sale_pwt_comm_variance  values (? , ? , ? ,?,?, ?,?)&quot;);
<span class="nc" id="L1684">						pstmt5.setInt(1, userOrgId);</span>
<span class="nc" id="L1685">						pstmt5.setInt(2, orgId);</span>
<span class="nc" id="L1686">						pstmt5.setInt(3, gameId);</span>
<span class="nc" id="L1687">						pstmt5.setDouble(4, saleCommVar1);</span>
<span class="nc" id="L1688">						pstmt5.setDouble(5, dSaleCommRate);</span>
<span class="nc" id="L1689">						pstmt5.setDouble(6, pwtCommVar1);</span>
<span class="nc" id="L1690">						pstmt5.setDouble(7, dPwtCommRate);</span>
<span class="nc" id="L1691">						int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L1692">						System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L1693">						System.out</span>
								.println(&quot;insert entries st_dg_agent_retailer_sale_pwt_comm_variance  table updated rows === &quot;
										+ rows);
<span class="nc" id="L1696">						pstmt5.close();</span>
						
					/*	
						//here update the updated comm rate in the context
					//	System.out.println(&quot;var in context before: &quot; + Util.getSaleCommVariance(retOrgid, gameId));
						double retUpdatedCommVar = CommonFunctionsHelper.fetchDGCommOfOrganization(gameId, retOrgid, &quot;SALE&quot;, &quot;RETAILER&quot;, conn);
						Util.updateSaleCommVariance(retOrgid, gameId,retUpdatedCommVar);
						System.out.println(&quot;var in context after updation: &quot; + Util.getSaleCommVariance(retOrgid, gameId));
					  //updated successfully
*/						
						
					}

<span class="nc bnc" id="L1709" title="All 6 branches missed.">					if (commVarianceBean == null &amp;&amp; gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L1710">						System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L1711">						PreparedStatement pstmt3 = conn</span>
								.prepareStatement(&quot;insert into st_dg_agent_retailer_sale_comm_variance_history values(?, ?, ?, ?,?)&quot;);
<span class="nc" id="L1713">						pstmt3.setInt(1, userOrgId);</span>
<span class="nc" id="L1714">						pstmt3.setInt(2, orgId);</span>
<span class="nc" id="L1715">						pstmt3.setInt(3, gameId);</span>
<span class="nc" id="L1716">						pstmt3.setDouble(4, 0.0);</span>
<span class="nc" id="L1717">						pstmt3.setTimestamp(5, new java.sql.Timestamp(</span>
								new java.util.Date().getTime()));
<span class="nc" id="L1719">						int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L1720">						System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L1721">						System.out</span>
								.println(&quot;sale comm var history table updated rows === &quot;
										+ rows);
<span class="nc" id="L1724">						pstmt3.close();</span>
						
						
					}

<span class="nc bnc" id="L1729" title="All 6 branches missed.">					if (commVarianceBean == null &amp;&amp; gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L1730">						System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L1731">						PreparedStatement pstmt4 = conn</span>
								.prepareStatement(&quot;insert into st_dg_agent_retailer_pwt_comm_variance_history values(?, ?, ?, ?,?)&quot;);
<span class="nc" id="L1733">						pstmt4.setInt(1, userOrgId);</span>
<span class="nc" id="L1734">						pstmt4.setInt(2, orgId);</span>
<span class="nc" id="L1735">						pstmt4.setInt(3, gameId);</span>
<span class="nc" id="L1736">						pstmt4.setDouble(4, 0.0);</span>
<span class="nc" id="L1737">						pstmt4.setTimestamp(5, new java.sql.Timestamp(</span>
								new java.util.Date().getTime()));
<span class="nc" id="L1739">						int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L1740">						System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L1741">						System.out</span>
								.println(&quot;PWT comm var history table updated rows === &quot;
										+ rows);
<span class="nc" id="L1744">						pstmt4.close();</span>
					}

				}				
				
				//here update the updated comm rate in the context
			   //System.out.println(&quot;var in context before: &quot; + Util.getSaleCommVariance(retOrgid, gameId));
<span class="nc" id="L1751">				double retUpdatedCommVar = CommonFunctionsHelper.fetchDGCommOfOrganization(gameId, orgId, &quot;SALE&quot;, &quot;RETAILER&quot;, conn);</span>
<span class="nc" id="L1752">				Util.updateSaleCommVariance(orgId, gameId,retUpdatedCommVar);</span>
<span class="nc" id="L1753">				System.out.println(&quot;var in context after updation: &quot; + Util.getSaleCommVariance(orgId, gameId));</span>
			   //updated successfully
				
<span class="nc" id="L1756">			} else {</span>
<span class="nc bnc" id="L1757" title="All 6 branches missed.">				return &quot;AGENT_DIFF_GREATER;&quot;</span>
						+ (dAgtSaleComm + (agtSaleComm &lt; 0 ? agtSaleComm : (&quot;kenya&quot;.equalsIgnoreCase(countryDep)?agtSaleComm:0.0)))
						+ &quot;;&quot;
						+ (dAgtPwtComm + (agtPwtComm &lt; 0 ? agtPwtComm : 0.0));
			}
<span class="nc" id="L1762">			conn.commit();</span>
<span class="nc" id="L1763">		} catch (SQLException se) {</span>
			try {
<span class="nc" id="L1765">				System.out.println(&quot;rollbacked&quot;);</span>
<span class="nc" id="L1766">				conn.rollback();</span>
<span class="nc" id="L1767">			} catch (SQLException e) {</span>
<span class="nc" id="L1768">				e.printStackTrace();</span>
				// throw new LMSException(e);
<span class="nc" id="L1770">			}</span>
<span class="nc" id="L1771">			se.printStackTrace();</span>
<span class="nc" id="L1772">			throw new LMSException(se);</span>

		} finally {

<span class="nc" id="L1776">			try {</span>
<span class="nc bnc" id="L1777" title="All 16 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L1778">					conn.close();</span>
				}
<span class="nc" id="L1780">			} catch (SQLException e) {</span>
<span class="nc" id="L1781">				e.printStackTrace();</span>
<span class="nc" id="L1782">			}</span>

<span class="nc" id="L1784">		}</span>

<span class="nc" id="L1786">		return &quot;SUCCESS&quot;;</span>
	}
	
	
	public String submitUpdatedValueIW(String agtOrgName, String gname, String defSaleCommRate, String saleCommVar, String defPwtCommRate, String pwtCommVar, int userOrgId, String countryDep) throws LMSException {
<span class="nc" id="L1791">		String game[] = gname.split(&quot;-&quot;);</span>
<span class="nc" id="L1792">		double dSaleCommRate = Double.parseDouble(defSaleCommRate.trim());</span>
<span class="nc" id="L1793">		double saleCommVar1 = Double.parseDouble(saleCommVar.trim());</span>
<span class="nc" id="L1794">		double dPwtCommRate = Double.parseDouble(defPwtCommRate.trim());</span>
<span class="nc" id="L1795">		double pwtCommVar1 = Double.parseDouble(pwtCommVar.trim());</span>
<span class="nc" id="L1796">		UpdateSalePwtCommVarBean commVarianceBean = null;</span>
<span class="nc" id="L1797">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L1798">		boolean flagforZero = false;</span>
<span class="nc" id="L1799">		double dAgtSaleComm = 0.0;</span>
<span class="nc" id="L1800">		double agtSaleComm = 0.0;</span>
<span class="nc" id="L1801">		double dAgtPwtComm = 0.0;</span>
<span class="nc" id="L1802">		double agtPwtComm = 0.0;</span>
		try {
<span class="nc" id="L1804">			int orgId = Integer.parseInt(agtOrgName);</span>
<span class="nc" id="L1805">			conn.setAutoCommit(false);</span>
<span class="nc" id="L1806">			PreparedStatement pstmt0 = conn.prepareStatement(&quot;select agent_org_id, game_id, sale_comm_variance, default_sale_comm_rate, pwt_comm_variance, default_pwt_comm_rate from st_iw_bo_agent_sale_pwt_comm_variance gm where game_id=&quot; + game[0] + &quot; and agent_org_id=(select parent_id from st_lms_organization_master where organization_id=&quot; + orgId + &quot;)&quot;);</span>
<span class="nc" id="L1807">			ResultSet rs0 = pstmt0.executeQuery();</span>
<span class="nc" id="L1808">			System.out.println(&quot;query = &quot; + pstmt0);</span>
<span class="nc bnc" id="L1809" title="All 2 branches missed.">			if (rs0.next()) {</span>
<span class="nc" id="L1810">				dAgtSaleComm = rs0.getDouble(&quot;default_sale_comm_rate&quot;);</span>
<span class="nc" id="L1811">				agtSaleComm = rs0.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L1812">				dAgtPwtComm = rs0.getDouble(&quot;default_pwt_comm_rate&quot;);</span>
<span class="nc" id="L1813">				agtPwtComm = rs0.getDouble(&quot;pwt_comm_variance&quot;);</span>
			} else {
<span class="nc" id="L1815">				PreparedStatement pstmtGameMaster = conn.prepareStatement(&quot;select agent_sale_comm_rate,agent_pwt_comm_rate from st_iw_game_master where game_id=&quot; + game[0]);</span>
<span class="nc" id="L1816">				ResultSet rsGameMaster = pstmtGameMaster.executeQuery();</span>
<span class="nc" id="L1817">				System.out.println(&quot;query = &quot; + pstmtGameMaster);</span>
<span class="nc bnc" id="L1818" title="All 2 branches missed.">				if (rsGameMaster.next()) {</span>
<span class="nc" id="L1819">					dAgtSaleComm = rsGameMaster.getDouble(&quot;agent_sale_comm_rate&quot;);</span>
<span class="nc" id="L1820">					dAgtPwtComm = rsGameMaster.getDouble(&quot;agent_pwt_comm_rate&quot;);</span>
				}
			}
<span class="nc bnc" id="L1823" title="All 4 branches missed.">			double diffSaleComm = dAgtSaleComm + (agtSaleComm &lt; 0 ? agtSaleComm : (&quot;kenya&quot;.equalsIgnoreCase(countryDep) ? agtSaleComm : 0.0)) - (dSaleCommRate + saleCommVar1);</span>
<span class="nc bnc" id="L1824" title="All 2 branches missed.">			double diffPwtComm = dAgtPwtComm + (agtPwtComm &lt; 0 ? agtPwtComm : 0.0) - (dPwtCommRate + pwtCommVar1);</span>
<span class="nc bnc" id="L1825" title="All 4 branches missed.">			if (diffSaleComm &gt;= 0 &amp;&amp; diffPwtComm &gt;= 0) {</span>
<span class="nc" id="L1826">				PreparedStatement pstmt1 = conn.prepareStatement(&quot;select retailer_org_id, game_id, sale_comm_variance, default_sale_comm_rate, pwt_comm_variance, default_pwt_comm_rate from st_iw_agent_retailer_sale_pwt_comm_variance where game_id=&quot; + game[0] + &quot; and retailer_org_id=&quot; + orgId + &quot;&quot;);</span>
<span class="nc" id="L1827">				ResultSet rs1 = pstmt1.executeQuery();</span>
<span class="nc" id="L1828">				System.out.println(&quot;query = &quot; + pstmt1);</span>
<span class="nc bnc" id="L1829" title="All 2 branches missed.">				if (rs1.next()) {</span>
<span class="nc" id="L1830">					System.out.println(&quot;inside pstmt1---11111111&quot;);</span>
<span class="nc" id="L1831">					double oldPwtCommVar = rs1.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L1832">					double oldSaleCommVar = rs1.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc bnc" id="L1833" title="All 4 branches missed.">					if (oldPwtCommVar == pwtCommVar1 &amp;&amp; saleCommVar1 == oldSaleCommVar) {</span>
<span class="nc" id="L1834">						return &quot;SAME_VALUES&quot;;</span>
					}

<span class="nc" id="L1837">					commVarianceBean = new UpdateSalePwtCommVarBean();</span>
<span class="nc" id="L1838">					commVarianceBean.setRetOrgId(rs1.getInt(&quot;retailer_org_id&quot;));</span>
<span class="nc" id="L1839">					commVarianceBean.setGameId(rs1.getInt(&quot;game_id&quot;));</span>
<span class="nc" id="L1840">					commVarianceBean.setSaleCommVar(oldSaleCommVar);</span>
<span class="nc" id="L1841">					commVarianceBean.setDefaultSaleCommRate(rs1.getDouble(&quot;default_sale_comm_rate&quot;));</span>
<span class="nc" id="L1842">					commVarianceBean.setPwtCommVar(oldPwtCommVar);</span>
<span class="nc" id="L1843">					commVarianceBean.setDefaultPwtCommRate(rs1.getDouble(&quot;default_pwt_comm_rate&quot;));</span>
<span class="nc" id="L1844">					System.out.println(&quot;inside pstmt1---22222222&quot;);</span>
				}
<span class="nc" id="L1846">				pstmt1.close();</span>
<span class="nc" id="L1847">				rs1.close();</span>

<span class="nc bnc" id="L1849" title="All 2 branches missed.">				if (commVarianceBean != null) {</span>
<span class="nc" id="L1850">					System.out.println(&quot;555555555555555&quot;);</span>
<span class="nc" id="L1851">					PreparedStatement pstmt5 = conn.prepareStatement(&quot;delete from st_iw_agent_retailer_sale_pwt_comm_variance  where game_id=? and retailer_org_id=?&quot;);</span>
<span class="nc" id="L1852">					pstmt5.setInt(1, commVarianceBean.getGameId());</span>
<span class="nc" id="L1853">					pstmt5.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L1854">					int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L1855">					System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L1856">					System.out.println(&quot;Delete entry from st_iw_agent_retailer_sale_pwt_comm_variance  table updated rows === &quot; + rows);</span>
<span class="nc" id="L1857">					pstmt5.close();</span>
<span class="nc" id="L1858">					flagforZero = true;</span>
				}

<span class="nc bnc" id="L1861" title="All 4 branches missed.">				if (commVarianceBean != null &amp;&amp; saleCommVar1 != commVarianceBean.getSaleCommVar()) {</span>
<span class="nc" id="L1862">					System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L1863">					PreparedStatement pstmt3 = conn.prepareStatement(&quot;insert into st_iw_agent_retailer_sale_comm_variance_history values(?, ?, ?, ?,?)&quot;);</span>
<span class="nc" id="L1864">					pstmt3.setInt(1, userOrgId);</span>
<span class="nc" id="L1865">					pstmt3.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L1866">					pstmt3.setInt(3, commVarianceBean.getGameId());</span>
<span class="nc" id="L1867">					pstmt3.setDouble(4, commVarianceBean.getSaleCommVar());</span>
<span class="nc" id="L1868">					pstmt3.setTimestamp(5, new java.sql.Timestamp(new java.util.Date().getTime()));</span>
<span class="nc" id="L1869">					int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L1870">					System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L1871">					System.out.println(&quot;sale comm var history table updated rows === &quot; + rows);</span>
<span class="nc" id="L1872">					pstmt3.close();</span>
				}

<span class="nc bnc" id="L1875" title="All 4 branches missed.">				if (commVarianceBean != null &amp;&amp; pwtCommVar1 != commVarianceBean.getPwtCommVar()) {</span>
<span class="nc" id="L1876">					System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L1877">					PreparedStatement pstmt4 = conn.prepareStatement(&quot;insert into st_iw_agent_retailer_pwt_comm_variance_history values(?, ?, ?, ?,?)&quot;);</span>
<span class="nc" id="L1878">					pstmt4.setInt(1, userOrgId);</span>
<span class="nc" id="L1879">					pstmt4.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L1880">					pstmt4.setInt(3, commVarianceBean.getGameId());</span>
<span class="nc" id="L1881">					pstmt4.setDouble(4, commVarianceBean.getPwtCommVar());</span>
<span class="nc" id="L1882">					pstmt4.setTimestamp(5, new java.sql.Timestamp(new java.util.Date().getTime()));</span>
<span class="nc" id="L1883">					int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L1884">					System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L1885">					System.out.println(&quot;PWT comm var history table updated rows === &quot; + rows);</span>
<span class="nc" id="L1886">					pstmt4.close();</span>
				}

<span class="nc" id="L1889">				System.out.println(saleCommVar1 + &quot; **saleCommVar1** &quot; + pwtCommVar1);</span>
<span class="nc bnc" id="L1890" title="All 4 branches missed.">				System.out.println(&quot;saleCommVar1!=0.0 ||  pwtCommVar1!=0.0&quot; + (saleCommVar1 != 0.0 || pwtCommVar1 != 0.0));</span>

<span class="nc" id="L1892">				System.out.println(&quot;66666666666666666666666666&quot;);</span>
				/*
				 * PreparedStatement pstmt6 = conn .prepareStatement(
				 * &quot; select game_id from st_dg_game_master where game_id=?  &quot;);
				 * //pstmt6.setString(1, agtOrgName.trim()); pstmt6.setInt(1,
				 * Integer.parseInt(game[0])); //pstmt6.setString(3, game[1]);
				 * ResultSet rs6 = pstmt6.executeQuery();
				 * System.out.println(&quot;query = &quot; + pstmt6);
				 */
<span class="nc" id="L1901">				int gameId = Integer.parseInt(game[0]);</span>
				// int retOrgid = 0;
				/*
				 * if (rs6.next()) { gameId = rs6.getInt(&quot;game_id&quot;); // retOrgid
				 * = rs6.getInt(&quot;organization_id&quot;); }
				 */

<span class="nc bnc" id="L1908" title="All 4 branches missed.">				if (saleCommVar1 != 0.0 || pwtCommVar1 != 0.0) {</span>
<span class="nc bnc" id="L1909" title="All 4 branches missed.">					if (gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L1910">						PreparedStatement pstmt5 = conn.prepareStatement(&quot;insert into st_iw_agent_retailer_sale_pwt_comm_variance  values (?, ?, ?, ?, ?, ?,?)&quot;);</span>
<span class="nc" id="L1911">						pstmt5.setInt(1, userOrgId);</span>
<span class="nc" id="L1912">						pstmt5.setInt(2, orgId);</span>
<span class="nc" id="L1913">						pstmt5.setInt(3, gameId);</span>
<span class="nc" id="L1914">						pstmt5.setDouble(4, saleCommVar1);</span>
<span class="nc" id="L1915">						pstmt5.setDouble(5, dSaleCommRate);</span>
<span class="nc" id="L1916">						pstmt5.setDouble(6, pwtCommVar1);</span>
<span class="nc" id="L1917">						pstmt5.setDouble(7, dPwtCommRate);</span>
<span class="nc" id="L1918">						int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L1919">						System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L1920">						System.out.println(&quot;insert entries st_iw_agent_retailer_sale_pwt_comm_variance table updated rows === &quot; + rows);</span>
<span class="nc" id="L1921">						pstmt5.close();</span>
						/*
						 * //here update the updated comm rate in the context //
						 * System.out.println(&quot;var in context before: &quot; +
						 * Util.getSaleCommVariance(retOrgid, gameId)); double
						 * retUpdatedCommVar =
						 * CommonFunctionsHelper.fetchDGCommOfOrganization
						 * (gameId, retOrgid, &quot;SALE&quot;, &quot;RETAILER&quot;, conn);
						 * Util.updateSaleCommVariance(retOrgid,
						 * gameId,retUpdatedCommVar);
						 * System.out.println(&quot;var in context after updation: &quot;
						 * + Util.getSaleCommVariance(retOrgid, gameId));
						 * //updated successfully
						 */
					}

<span class="nc bnc" id="L1937" title="All 6 branches missed.">					if (commVarianceBean == null &amp;&amp; gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L1938">						System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L1939">						PreparedStatement pstmt3 = conn.prepareStatement(&quot;insert into st_iw_agent_retailer_sale_comm_variance_history values(?, ?, ?, ?,?)&quot;);</span>
<span class="nc" id="L1940">						pstmt3.setInt(1, userOrgId);</span>
<span class="nc" id="L1941">						pstmt3.setInt(2, orgId);</span>
<span class="nc" id="L1942">						pstmt3.setInt(3, gameId);</span>
<span class="nc" id="L1943">						pstmt3.setDouble(4, 0.0);</span>
<span class="nc" id="L1944">						pstmt3.setTimestamp(5, new java.sql.Timestamp(new java.util.Date().getTime()));</span>
<span class="nc" id="L1945">						int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L1946">						System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L1947">						System.out.println(&quot;sale comm var history table updated rows === &quot; + rows);</span>
<span class="nc" id="L1948">						pstmt3.close();</span>
					}

<span class="nc bnc" id="L1951" title="All 6 branches missed.">					if (commVarianceBean == null &amp;&amp; gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L1952">						System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L1953">						PreparedStatement pstmt4 = conn.prepareStatement(&quot;insert into st_iw_agent_retailer_pwt_comm_variance_history values(?, ?, ?, ?,?)&quot;);</span>
<span class="nc" id="L1954">						pstmt4.setInt(1, userOrgId);</span>
<span class="nc" id="L1955">						pstmt4.setInt(2, orgId);</span>
<span class="nc" id="L1956">						pstmt4.setInt(3, gameId);</span>
<span class="nc" id="L1957">						pstmt4.setDouble(4, 0.0);</span>
<span class="nc" id="L1958">						pstmt4.setTimestamp(5, new java.sql.Timestamp(new java.util.Date().getTime()));</span>
<span class="nc" id="L1959">						int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L1960">						System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L1961">						System.out.println(&quot;PWT comm var history table updated rows === &quot; + rows);</span>
<span class="nc" id="L1962">						pstmt4.close();</span>
					}
				}

				// here update the updated comm rate in the context
				// System.out.println(&quot;var in context before: &quot; +
				// Util.getSaleCommVariance(retOrgid, gameId));
<span class="nc" id="L1969">				double retUpdatedCommVar = CommonFunctionsHelper.fetchIWCommOfOrganization(gameId, orgId, &quot;SALE&quot;, &quot;RETAILER&quot;, conn);</span>
<span class="nc" id="L1970">				Util.updateSaleCommVarianceIW(orgId, gameId, retUpdatedCommVar);</span>
<span class="nc" id="L1971">				System.out.println(&quot;var in context after updation: &quot; + Util.getSaleCommVariance(orgId, gameId));</span>
				// updated successfully
<span class="nc" id="L1973">			} else {</span>
<span class="nc bnc" id="L1974" title="All 6 branches missed.">				return &quot;AGENT_DIFF_GREATER;&quot; + (dAgtSaleComm + (agtSaleComm &lt; 0 ? agtSaleComm : (&quot;kenya&quot;.equalsIgnoreCase(countryDep) ? agtSaleComm : 0.0))) + &quot;;&quot; + (dAgtPwtComm + (agtPwtComm &lt; 0 ? agtPwtComm : 0.0));</span>
			}
<span class="nc" id="L1976">			conn.commit();</span>
<span class="nc" id="L1977">		} catch (SQLException se) {</span>
			try {
<span class="nc" id="L1979">				System.out.println(&quot;rollbacked&quot;);</span>
<span class="nc" id="L1980">				conn.rollback();</span>
<span class="nc" id="L1981">			} catch (SQLException e) {</span>
<span class="nc" id="L1982">				e.printStackTrace();</span>
				// throw new LMSException(e);
<span class="nc" id="L1984">			}</span>
<span class="nc" id="L1985">			se.printStackTrace();</span>
<span class="nc" id="L1986">			throw new LMSException(se);</span>
		} finally {
<span class="nc" id="L1988">			try {</span>
<span class="nc bnc" id="L1989" title="All 16 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L1990">					conn.close();</span>
				}
<span class="nc" id="L1992">			} catch (SQLException e) {</span>
<span class="nc" id="L1993">				e.printStackTrace();</span>
<span class="nc" id="L1994">			}</span>
<span class="nc" id="L1995">		}</span>
<span class="nc" id="L1996">		return &quot;SUCCESS&quot;;</span>
	}
	
	public String submitUpdatedValueVS(String agtOrgName, String gname, String defSaleCommRate, String saleCommVar, String defPwtCommRate, String pwtCommVar, int userOrgId, String countryDep) throws LMSException {
<span class="nc" id="L2000">		String game[] = gname.split(&quot;-&quot;);</span>
<span class="nc" id="L2001">		double dSaleCommRate = Double.parseDouble(defSaleCommRate.trim());</span>
<span class="nc" id="L2002">		double saleCommVar1 = Double.parseDouble(saleCommVar.trim());</span>
<span class="nc" id="L2003">		double dPwtCommRate = Double.parseDouble(defPwtCommRate.trim());</span>
<span class="nc" id="L2004">		double pwtCommVar1 = Double.parseDouble(pwtCommVar.trim());</span>
<span class="nc" id="L2005">		UpdateSalePwtCommVarBean commVarianceBean = null;</span>
<span class="nc" id="L2006">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L2007">		boolean flagforZero = false;</span>
<span class="nc" id="L2008">		double dAgtSaleComm = 0.0;</span>
<span class="nc" id="L2009">		double agtSaleComm = 0.0;</span>
<span class="nc" id="L2010">		double dAgtPwtComm = 0.0;</span>
<span class="nc" id="L2011">		double agtPwtComm = 0.0;</span>
		try {
<span class="nc" id="L2013">			int orgId = Integer.parseInt(agtOrgName);</span>
<span class="nc" id="L2014">			conn.setAutoCommit(false);</span>
<span class="nc" id="L2015">			PreparedStatement pstmt0 = conn.prepareStatement(&quot;select agent_org_id, game_id, sale_comm_variance, default_sale_comm_rate, pwt_comm_variance, default_pwt_comm_rate from st_vs_bo_agent_sale_pwt_comm_variance gm where game_id=&quot; + game[0] + &quot; and agent_org_id=(select parent_id from st_lms_organization_master where organization_id=&quot; + orgId + &quot;)&quot;);</span>
<span class="nc" id="L2016">			ResultSet rs0 = pstmt0.executeQuery();</span>
<span class="nc" id="L2017">			System.out.println(&quot;query = &quot; + pstmt0);</span>
<span class="nc bnc" id="L2018" title="All 2 branches missed.">			if (rs0.next()) {</span>
<span class="nc" id="L2019">				dAgtSaleComm = rs0.getDouble(&quot;default_sale_comm_rate&quot;);</span>
<span class="nc" id="L2020">				agtSaleComm = rs0.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc" id="L2021">				dAgtPwtComm = rs0.getDouble(&quot;default_pwt_comm_rate&quot;);</span>
<span class="nc" id="L2022">				agtPwtComm = rs0.getDouble(&quot;pwt_comm_variance&quot;);</span>
			} else {
<span class="nc" id="L2024">				PreparedStatement pstmtGameMaster = conn.prepareStatement(&quot;select agent_sale_comm_rate,agent_pwt_comm_rate from st_vs_game_master where game_id=&quot; + game[0]);</span>
<span class="nc" id="L2025">				ResultSet rsGameMaster = pstmtGameMaster.executeQuery();</span>
<span class="nc" id="L2026">				System.out.println(&quot;query = &quot; + pstmtGameMaster);</span>
<span class="nc bnc" id="L2027" title="All 2 branches missed.">				if (rsGameMaster.next()) {</span>
<span class="nc" id="L2028">					dAgtSaleComm = rsGameMaster.getDouble(&quot;agent_sale_comm_rate&quot;);</span>
<span class="nc" id="L2029">					dAgtPwtComm = rsGameMaster.getDouble(&quot;agent_pwt_comm_rate&quot;);</span>
				}
			}
<span class="nc bnc" id="L2032" title="All 4 branches missed.">			double diffSaleComm = dAgtSaleComm + (agtSaleComm &lt; 0 ? agtSaleComm : (&quot;kenya&quot;.equalsIgnoreCase(countryDep) ? agtSaleComm : 0.0)) - (dSaleCommRate + saleCommVar1);</span>
<span class="nc bnc" id="L2033" title="All 2 branches missed.">			double diffPwtComm = dAgtPwtComm + (agtPwtComm &lt; 0 ? agtPwtComm : 0.0) - (dPwtCommRate + pwtCommVar1);</span>
<span class="nc bnc" id="L2034" title="All 4 branches missed.">			if (diffSaleComm &gt;= 0 &amp;&amp; diffPwtComm &gt;= 0) {</span>
<span class="nc" id="L2035">				PreparedStatement pstmt1 = conn.prepareStatement(&quot;select retailer_org_id, game_id, sale_comm_variance, default_sale_comm_rate, pwt_comm_variance, default_pwt_comm_rate from st_vs_agent_retailer_sale_pwt_comm_variance where game_id=&quot; + game[0] + &quot; and retailer_org_id=&quot; + orgId + &quot;&quot;);</span>
<span class="nc" id="L2036">				ResultSet rs1 = pstmt1.executeQuery();</span>
<span class="nc" id="L2037">				System.out.println(&quot;query = &quot; + pstmt1);</span>
<span class="nc bnc" id="L2038" title="All 2 branches missed.">				if (rs1.next()) {</span>
<span class="nc" id="L2039">					System.out.println(&quot;inside pstmt1---11111111&quot;);</span>
<span class="nc" id="L2040">					double oldPwtCommVar = rs1.getDouble(&quot;pwt_comm_variance&quot;);</span>
<span class="nc" id="L2041">					double oldSaleCommVar = rs1.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc bnc" id="L2042" title="All 4 branches missed.">					if (oldPwtCommVar == pwtCommVar1 &amp;&amp; saleCommVar1 == oldSaleCommVar) {</span>
<span class="nc" id="L2043">						return &quot;SAME_VALUES&quot;;</span>
					}

<span class="nc" id="L2046">					commVarianceBean = new UpdateSalePwtCommVarBean();</span>
<span class="nc" id="L2047">					commVarianceBean.setRetOrgId(rs1.getInt(&quot;retailer_org_id&quot;));</span>
<span class="nc" id="L2048">					commVarianceBean.setGameId(rs1.getInt(&quot;game_id&quot;));</span>
<span class="nc" id="L2049">					commVarianceBean.setSaleCommVar(oldSaleCommVar);</span>
<span class="nc" id="L2050">					commVarianceBean.setDefaultSaleCommRate(rs1.getDouble(&quot;default_sale_comm_rate&quot;));</span>
<span class="nc" id="L2051">					commVarianceBean.setPwtCommVar(oldPwtCommVar);</span>
<span class="nc" id="L2052">					commVarianceBean.setDefaultPwtCommRate(rs1.getDouble(&quot;default_pwt_comm_rate&quot;));</span>
<span class="nc" id="L2053">					System.out.println(&quot;inside pstmt1---22222222&quot;);</span>
				}
<span class="nc" id="L2055">				pstmt1.close();</span>
<span class="nc" id="L2056">				rs1.close();</span>

<span class="nc bnc" id="L2058" title="All 2 branches missed.">				if (commVarianceBean != null) {</span>
<span class="nc" id="L2059">					System.out.println(&quot;555555555555555&quot;);</span>
<span class="nc" id="L2060">					PreparedStatement pstmt5 = conn.prepareStatement(&quot;delete from st_vs_agent_retailer_sale_pwt_comm_variance  where game_id=? and retailer_org_id=?&quot;);</span>
<span class="nc" id="L2061">					pstmt5.setInt(1, commVarianceBean.getGameId());</span>
<span class="nc" id="L2062">					pstmt5.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L2063">					int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L2064">					System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L2065">					System.out.println(&quot;Delete entry from st_iw_agent_retailer_sale_pwt_comm_variance  table updated rows === &quot; + rows);</span>
<span class="nc" id="L2066">					pstmt5.close();</span>
<span class="nc" id="L2067">					flagforZero = true;</span>
				}

<span class="nc bnc" id="L2070" title="All 4 branches missed.">				if (commVarianceBean != null &amp;&amp; saleCommVar1 != commVarianceBean.getSaleCommVar()) {</span>
<span class="nc" id="L2071">					System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L2072">					PreparedStatement pstmt3 = conn.prepareStatement(&quot;insert into st_vs_agent_retailer_sale_comm_variance_history values(?, ?, ?, ?,?)&quot;);</span>
<span class="nc" id="L2073">					pstmt3.setInt(1, userOrgId);</span>
<span class="nc" id="L2074">					pstmt3.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L2075">					pstmt3.setInt(3, commVarianceBean.getGameId());</span>
<span class="nc" id="L2076">					pstmt3.setDouble(4, commVarianceBean.getSaleCommVar());</span>
<span class="nc" id="L2077">					pstmt3.setTimestamp(5, new java.sql.Timestamp(new java.util.Date().getTime()));</span>
<span class="nc" id="L2078">					int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L2079">					System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L2080">					System.out.println(&quot;sale comm var history table updated rows === &quot; + rows);</span>
<span class="nc" id="L2081">					pstmt3.close();</span>
				}

<span class="nc bnc" id="L2084" title="All 4 branches missed.">				if (commVarianceBean != null &amp;&amp; pwtCommVar1 != commVarianceBean.getPwtCommVar()) {</span>
<span class="nc" id="L2085">					System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L2086">					PreparedStatement pstmt4 = conn.prepareStatement(&quot;insert into st_vs_agent_retailer_pwt_comm_variance_history values(?, ?, ?, ?,?)&quot;);</span>
<span class="nc" id="L2087">					pstmt4.setInt(1, userOrgId);</span>
<span class="nc" id="L2088">					pstmt4.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L2089">					pstmt4.setInt(3, commVarianceBean.getGameId());</span>
<span class="nc" id="L2090">					pstmt4.setDouble(4, commVarianceBean.getPwtCommVar());</span>
<span class="nc" id="L2091">					pstmt4.setTimestamp(5, new java.sql.Timestamp(new java.util.Date().getTime()));</span>
<span class="nc" id="L2092">					int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L2093">					System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L2094">					System.out.println(&quot;PWT comm var history table updated rows === &quot; + rows);</span>
<span class="nc" id="L2095">					pstmt4.close();</span>
				}

<span class="nc" id="L2098">				System.out.println(saleCommVar1 + &quot; **saleCommVar1** &quot; + pwtCommVar1);</span>
<span class="nc bnc" id="L2099" title="All 4 branches missed.">				System.out.println(&quot;saleCommVar1!=0.0 ||  pwtCommVar1!=0.0&quot; + (saleCommVar1 != 0.0 || pwtCommVar1 != 0.0));</span>

<span class="nc" id="L2101">				System.out.println(&quot;66666666666666666666666666&quot;);</span>
				/*
				 * PreparedStatement pstmt6 = conn .prepareStatement(
				 * &quot; select game_id from st_dg_game_master where game_id=?  &quot;);
				 * //pstmt6.setString(1, agtOrgName.trim()); pstmt6.setInt(1,
				 * Integer.parseInt(game[0])); //pstmt6.setString(3, game[1]);
				 * ResultSet rs6 = pstmt6.executeQuery();
				 * System.out.println(&quot;query = &quot; + pstmt6);
				 */
<span class="nc" id="L2110">				int gameId = Integer.parseInt(game[0]);</span>
				// int retOrgid = 0;
				/*
				 * if (rs6.next()) { gameId = rs6.getInt(&quot;game_id&quot;); // retOrgid
				 * = rs6.getInt(&quot;organization_id&quot;); }
				 */

<span class="nc bnc" id="L2117" title="All 4 branches missed.">				if (saleCommVar1 != 0.0 || pwtCommVar1 != 0.0) {</span>
<span class="nc bnc" id="L2118" title="All 4 branches missed.">					if (gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2119">						PreparedStatement pstmt5 = conn.prepareStatement(&quot;insert into st_vs_agent_retailer_sale_pwt_comm_variance  values (?, ?, ?, ?, ?, ?,?)&quot;);</span>
<span class="nc" id="L2120">						pstmt5.setInt(1, userOrgId);</span>
<span class="nc" id="L2121">						pstmt5.setInt(2, orgId);</span>
<span class="nc" id="L2122">						pstmt5.setInt(3, gameId);</span>
<span class="nc" id="L2123">						pstmt5.setDouble(4, saleCommVar1);</span>
<span class="nc" id="L2124">						pstmt5.setDouble(5, dSaleCommRate);</span>
<span class="nc" id="L2125">						pstmt5.setDouble(6, pwtCommVar1);</span>
<span class="nc" id="L2126">						pstmt5.setDouble(7, dPwtCommRate);</span>
<span class="nc" id="L2127">						int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L2128">						System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L2129">						System.out.println(&quot;insert entries st_vs_agent_retailer_sale_pwt_comm_variance table updated rows === &quot; + rows);</span>
<span class="nc" id="L2130">						pstmt5.close();</span>
						/*
						 * //here update the updated comm rate in the context //
						 * System.out.println(&quot;var in context before: &quot; +
						 * Util.getSaleCommVariance(retOrgid, gameId)); double
						 * retUpdatedCommVar =
						 * CommonFunctionsHelper.fetchDGCommOfOrganization
						 * (gameId, retOrgid, &quot;SALE&quot;, &quot;RETAILER&quot;, conn);
						 * Util.updateSaleCommVariance(retOrgid,
						 * gameId,retUpdatedCommVar);
						 * System.out.println(&quot;var in context after updation: &quot;
						 * + Util.getSaleCommVariance(retOrgid, gameId));
						 * //updated successfully
						 */
					}

<span class="nc bnc" id="L2146" title="All 6 branches missed.">					if (commVarianceBean == null &amp;&amp; gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2147">						System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L2148">						PreparedStatement pstmt3 = conn.prepareStatement(&quot;insert into st_vs_agent_retailer_sale_comm_variance_history values(?, ?, ?, ?,?)&quot;);</span>
<span class="nc" id="L2149">						pstmt3.setInt(1, userOrgId);</span>
<span class="nc" id="L2150">						pstmt3.setInt(2, orgId);</span>
<span class="nc" id="L2151">						pstmt3.setInt(3, gameId);</span>
<span class="nc" id="L2152">						pstmt3.setDouble(4, 0.0);</span>
<span class="nc" id="L2153">						pstmt3.setTimestamp(5, new java.sql.Timestamp(new java.util.Date().getTime()));</span>
<span class="nc" id="L2154">						int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L2155">						System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L2156">						System.out.println(&quot;sale comm var history table updated rows === &quot; + rows);</span>
<span class="nc" id="L2157">						pstmt3.close();</span>
					}

<span class="nc bnc" id="L2160" title="All 6 branches missed.">					if (commVarianceBean == null &amp;&amp; gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2161">						System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L2162">						PreparedStatement pstmt4 = conn.prepareStatement(&quot;insert into st_vs_agent_retailer_pwt_comm_variance_history values(?, ?, ?, ?,?)&quot;);</span>
<span class="nc" id="L2163">						pstmt4.setInt(1, userOrgId);</span>
<span class="nc" id="L2164">						pstmt4.setInt(2, orgId);</span>
<span class="nc" id="L2165">						pstmt4.setInt(3, gameId);</span>
<span class="nc" id="L2166">						pstmt4.setDouble(4, 0.0);</span>
<span class="nc" id="L2167">						pstmt4.setTimestamp(5, new java.sql.Timestamp(new java.util.Date().getTime()));</span>
<span class="nc" id="L2168">						int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L2169">						System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L2170">						System.out.println(&quot;PWT comm var history table updated rows === &quot; + rows);</span>
<span class="nc" id="L2171">						pstmt4.close();</span>
					}
				}

				// here update the updated comm rate in the context
				// System.out.println(&quot;var in context before: &quot; +
				// Util.getSaleCommVariance(retOrgid, gameId));
<span class="nc" id="L2178">				double retUpdatedCommVar = CommonFunctionsHelper.fetchVSCommOfOrganization(gameId, orgId, &quot;SALE&quot;, &quot;RETAILER&quot;, conn);</span>
<span class="nc" id="L2179">				Util.updateSaleCommVarianceVS(orgId, gameId, retUpdatedCommVar);</span>
<span class="nc" id="L2180">				System.out.println(&quot;var in context after updation: &quot; + Util.getVSSaleCommVariance(orgId, gameId));</span>
				// updated successfully
<span class="nc" id="L2182">			} else {</span>
<span class="nc bnc" id="L2183" title="All 6 branches missed.">				return &quot;AGENT_DIFF_GREATER;&quot; + (dAgtSaleComm + (agtSaleComm &lt; 0 ? agtSaleComm : (&quot;kenya&quot;.equalsIgnoreCase(countryDep) ? agtSaleComm : 0.0))) + &quot;;&quot; + (dAgtPwtComm + (agtPwtComm &lt; 0 ? agtPwtComm : 0.0));</span>
			}
<span class="nc" id="L2185">			conn.commit();</span>
<span class="nc" id="L2186">		} catch (SQLException se) {</span>
			try {
<span class="nc" id="L2188">				System.out.println(&quot;rollbacked&quot;);</span>
<span class="nc" id="L2189">				conn.rollback();</span>
<span class="nc" id="L2190">			} catch (SQLException e) {</span>
<span class="nc" id="L2191">				e.printStackTrace();</span>
				// throw new LMSException(e);
<span class="nc" id="L2193">			}</span>
<span class="nc" id="L2194">			se.printStackTrace();</span>
<span class="nc" id="L2195">			throw new LMSException(se);</span>
		} finally {
<span class="nc" id="L2197">			try {</span>
<span class="nc bnc" id="L2198" title="All 16 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L2199">					conn.close();</span>
				}
<span class="nc" id="L2201">			} catch (SQLException e) {</span>
<span class="nc" id="L2202">				e.printStackTrace();</span>
<span class="nc" id="L2203">			}</span>
<span class="nc" id="L2204">		}</span>
<span class="nc" id="L2205">		return &quot;SUCCESS&quot;;</span>
	}
	
	public String submitUpdatedValueCS(String agtOrgName, String gname,
			String defSaleCommRate, String saleCommVar, int userOrgId,String countryDep) throws LMSException {

<span class="nc" id="L2211">		String game[] = gname.split(&quot;_&quot;);</span>
<span class="nc" id="L2212">		double dSaleCommRate = Double.parseDouble(defSaleCommRate.trim());</span>
<span class="nc" id="L2213">		double saleCommVar1 = Double.parseDouble(saleCommVar.trim());</span>
<span class="nc" id="L2214">		UpdateSalePwtCommVarBean commVarianceBean = null;</span>
<span class="nc" id="L2215">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L2216">		boolean flagforZero = false;</span>
<span class="nc" id="L2217">		double dAgtSaleComm = 0.0;</span>
<span class="nc" id="L2218">		double agtSaleComm = 0.0;</span>
<span class="nc" id="L2219">		double dAgtPwtComm = 0.0;</span>
<span class="nc" id="L2220">		double agtPwtComm = 0.0;</span>
		try {
<span class="nc" id="L2222">			int orgId = Integer.parseInt(agtOrgName);</span>
<span class="nc" id="L2223">			conn.setAutoCommit(false);</span>
<span class="nc" id="L2224">			PreparedStatement pstmt0 = conn</span>
					.prepareStatement(&quot;select agent_org_id, product_id, sale_comm_variance, default_sale_comm_rate from st_cs_bo_agent_sale_comm_variance  gm where product_id=&quot;
							+ game[0]
							+ &quot; and agent_org_id=(select parent_id from st_lms_organization_master where organization_id=&quot;
							+ orgId + &quot;)&quot;);
<span class="nc" id="L2229">			ResultSet rs0 = pstmt0.executeQuery();</span>
<span class="nc" id="L2230">			System.out.println(&quot;query = &quot; + pstmt0);</span>
<span class="nc bnc" id="L2231" title="All 2 branches missed.">			if (rs0.next()) {</span>
<span class="nc" id="L2232">				dAgtSaleComm = rs0.getDouble(&quot;default_sale_comm_rate&quot;);</span>
<span class="nc" id="L2233">				agtSaleComm = rs0.getDouble(&quot;sale_comm_variance&quot;);</span>
			} else {
<span class="nc" id="L2235">				PreparedStatement pstmtGameMaster = conn</span>
						.prepareStatement(&quot;select agent_comm from st_cs_product_master where product_id=&quot;
								+ game[0]);
<span class="nc" id="L2238">				ResultSet rsGameMaster = pstmtGameMaster.executeQuery();</span>
<span class="nc" id="L2239">				System.out.println(&quot;query = &quot; + pstmtGameMaster);</span>
<span class="nc bnc" id="L2240" title="All 2 branches missed.">				if (rsGameMaster.next()) {</span>
<span class="nc" id="L2241">					dAgtSaleComm = rsGameMaster</span>
							.getDouble(&quot;agent_comm&quot;);
				}
			}
<span class="nc bnc" id="L2245" title="All 4 branches missed.">			double diffSaleComm = dAgtSaleComm</span>
					+ (agtSaleComm &lt; 0 ? agtSaleComm : (&quot;kenya&quot;.equalsIgnoreCase(countryDep)?agtSaleComm:0.0))
					- (dSaleCommRate + saleCommVar1);
<span class="nc bnc" id="L2248" title="All 2 branches missed.">			if (diffSaleComm &gt;= 0) {</span>

<span class="nc" id="L2250">				PreparedStatement pstmt1 = conn</span>
						.prepareStatement(&quot;select retailer_org_id, product_id, sale_comm_variance, default_sale_comm_rate from st_cs_agent_retailer_sale_comm_variance where product_id=&quot;
								+ game[0]
								+ &quot; and retailer_org_id=&quot;
								+ orgId + &quot;&quot;);
<span class="nc" id="L2255">				ResultSet rs1 = pstmt1.executeQuery();</span>
<span class="nc" id="L2256">				logger.debug(&quot;query = &quot; + pstmt1);</span>
<span class="nc bnc" id="L2257" title="All 2 branches missed.">				if (rs1.next()) {</span>
<span class="nc" id="L2258">					logger.debug(&quot;inside pstmt1---11111111&quot;);</span>
<span class="nc" id="L2259">					double oldSaleCommVar = rs1.getDouble(&quot;sale_comm_variance&quot;);</span>
<span class="nc bnc" id="L2260" title="All 2 branches missed.">					if (saleCommVar1 == oldSaleCommVar) {</span>
<span class="nc" id="L2261">						return &quot;SAME_VALUES&quot;;</span>
					}

<span class="nc" id="L2264">					commVarianceBean = new UpdateSalePwtCommVarBean();</span>
<span class="nc" id="L2265">					commVarianceBean.setRetOrgId(rs1.getInt(&quot;retailer_org_id&quot;));</span>
<span class="nc" id="L2266">					commVarianceBean.setGameId(rs1.getInt(&quot;product_id&quot;));</span>
<span class="nc" id="L2267">					commVarianceBean.setSaleCommVar(oldSaleCommVar);</span>
<span class="nc" id="L2268">					commVarianceBean.setDefaultSaleCommRate(rs1</span>
							.getDouble(&quot;default_sale_comm_rate&quot;));
<span class="nc" id="L2270">					logger.debug(&quot;inside pstmt1---22222222&quot;);</span>
				}
<span class="nc" id="L2272">				pstmt1.close();</span>
<span class="nc" id="L2273">				rs1.close();</span>

<span class="nc bnc" id="L2275" title="All 2 branches missed.">				if (commVarianceBean != null) {</span>
<span class="nc" id="L2276">					logger.debug(&quot;555555555555555&quot;);</span>
<span class="nc" id="L2277">					PreparedStatement pstmt5 = conn</span>
							.prepareStatement(&quot;delete from st_cs_agent_retailer_sale_comm_variance  where product_id=? and retailer_org_id=?&quot;);
<span class="nc" id="L2279">					pstmt5.setInt(1, commVarianceBean.getGameId());</span>
<span class="nc" id="L2280">					pstmt5.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L2281">					int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L2282">					logger.debug(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L2283">					logger.debug(&quot;Delete entry from st_dg_agent_retailer_sale_pwt_comm_variance  table updated rows === &quot;</span>
									+ rows);
<span class="nc" id="L2285">					pstmt5.close();</span>
<span class="nc" id="L2286">					flagforZero = true;</span>
				}

<span class="nc bnc" id="L2289" title="All 4 branches missed.">				if (commVarianceBean != null</span>
						&amp;&amp; saleCommVar1 != commVarianceBean.getSaleCommVar()) {
<span class="nc" id="L2291">					logger.debug(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L2292">					PreparedStatement pstmt3 = conn</span>
							.prepareStatement(&quot;insert into st_cs_agent_retailer_sale_comm_variance_history values(?, ?, ?, ?,?)&quot;);
<span class="nc" id="L2294">					pstmt3.setInt(1, userOrgId);</span>
<span class="nc" id="L2295">					pstmt3.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L2296">					pstmt3.setInt(3, commVarianceBean.getGameId());</span>
<span class="nc" id="L2297">					pstmt3.setDouble(4, commVarianceBean.getSaleCommVar());</span>
<span class="nc" id="L2298">					pstmt3.setTimestamp(5, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L2300">					int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L2301">					logger.debug(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L2302">					logger.debug(&quot;sale comm var history table updated rows === &quot;</span>
									+ rows);
<span class="nc" id="L2304">					pstmt3.close();</span>
				}

<span class="nc" id="L2307">				logger.debug(saleCommVar1 + &quot; **saleCommVar1** &quot;);</span>
<span class="nc bnc" id="L2308" title="All 2 branches missed.">				logger.debug(&quot;saleCommVar1!=0.0&quot;</span>
						+ (saleCommVar1 != 0.0));
				
<span class="nc" id="L2311">				logger.debug(&quot;66666666666666666666666666&quot;);</span>
<span class="nc" id="L2312">				PreparedStatement pstmt6 = conn</span>
						.prepareStatement(&quot; select product_id from st_cs_product_master where product_id=? &quot;);
				//	pstmt6.setString(1, agtOrgName.trim());
<span class="nc" id="L2315">				pstmt6.setInt(1, Integer.parseInt(game[0]));</span>
<span class="nc" id="L2316">				ResultSet rs6 = pstmt6.executeQuery();</span>
<span class="nc" id="L2317">				logger.debug(&quot;query = &quot; + pstmt6);</span>
<span class="nc" id="L2318">				int gameId = 0;</span>
			//	int retOrgid = 0;
<span class="nc bnc" id="L2320" title="All 2 branches missed.">				if (rs6.next()) {</span>
<span class="nc" id="L2321">					gameId = rs6.getInt(&quot;product_id&quot;);</span>
				//	retOrgid = rs6.getInt(&quot;organization_id&quot;);
				}				
				
<span class="nc bnc" id="L2325" title="All 2 branches missed.">				if (saleCommVar1 != 0.0) {					</span>
<span class="nc bnc" id="L2326" title="All 4 branches missed.">					if (gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2327">						PreparedStatement pstmt5 = conn</span>
								.prepareStatement(&quot;insert into st_cs_agent_retailer_sale_comm_variance  values (? , ? , ? ,?, ?)&quot;);
<span class="nc" id="L2329">						pstmt5.setInt(1, userOrgId);</span>
<span class="nc" id="L2330">						pstmt5.setInt(2, orgId);</span>
<span class="nc" id="L2331">						pstmt5.setInt(3, gameId);</span>
<span class="nc" id="L2332">						pstmt5.setDouble(4, saleCommVar1);</span>
<span class="nc" id="L2333">						pstmt5.setDouble(5, dSaleCommRate);</span>
<span class="nc" id="L2334">						int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L2335">						System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L2336">						System.out</span>
								.println(&quot;insert entries st_cs_agent_retailer_sale_comm_variance  table updated rows === &quot;
										+ rows);
<span class="nc" id="L2339">						pstmt5.close();</span>
						}

<span class="nc bnc" id="L2342" title="All 6 branches missed.">					if (commVarianceBean == null &amp;&amp; gameId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2343">						logger.debug(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L2344">						PreparedStatement pstmt3 = conn</span>
								.prepareStatement(&quot;insert into st_cs_agent_retailer_sale_comm_variance_history values(?, ?, ?, ?,?)&quot;);
<span class="nc" id="L2346">						pstmt3.setInt(1, userOrgId);</span>
<span class="nc" id="L2347">						pstmt3.setInt(2, orgId);</span>
<span class="nc" id="L2348">						pstmt3.setInt(3, gameId);</span>
<span class="nc" id="L2349">						pstmt3.setDouble(4, 0.0);</span>
<span class="nc" id="L2350">						pstmt3.setTimestamp(5, new java.sql.Timestamp(</span>
								new java.util.Date().getTime()));
<span class="nc" id="L2352">						int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L2353">						logger.debug(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L2354">						logger.debug(&quot;sale comm var history table updated rows === &quot;</span>
										+ rows);
<span class="nc" id="L2356">						pstmt3.close();</span>
					}
				}				
				
				//here update the updated comm rate in the context
			   //System.out.println(&quot;var in context before: &quot; + Util.getSaleCommVariance(retOrgid, gameId));
				
<span class="nc" id="L2363">			} else {</span>
<span class="nc bnc" id="L2364" title="All 4 branches missed.">				return &quot;AGENT_DIFF_GREATER;&quot;</span>
						+ (dAgtSaleComm - dSaleCommRate + (agtSaleComm &lt; 0 ? agtSaleComm : (&quot;kenya&quot;.equalsIgnoreCase(countryDep)?agtSaleComm:0.0)));
			}
<span class="nc" id="L2367">			conn.commit();</span>
<span class="nc" id="L2368">		} catch (SQLException se) {</span>
			try {
<span class="nc" id="L2370">				System.out.println(&quot;rollbacked&quot;);</span>
<span class="nc" id="L2371">				conn.rollback();</span>
<span class="nc" id="L2372">			} catch (SQLException e) {</span>
<span class="nc" id="L2373">				e.printStackTrace();</span>
				// throw new LMSException(e);
<span class="nc" id="L2375">			}</span>
<span class="nc" id="L2376">			se.printStackTrace();</span>
<span class="nc" id="L2377">			throw new LMSException(se);</span>

		} finally {

<span class="nc" id="L2381">			try {</span>
<span class="nc bnc" id="L2382" title="All 16 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L2383">					conn.close();</span>
				}
<span class="nc" id="L2385">			} catch (SQLException e) {</span>
<span class="nc" id="L2386">				e.printStackTrace();</span>
<span class="nc" id="L2387">			}</span>

<span class="nc" id="L2389">		}</span>

<span class="nc" id="L2391">		return &quot;SUCCESS&quot;;</span>
		
	}
	
	public String submitUpdatedValueOLA(String agtOrgName, String wname,
			String defWidCommRate, String widCommVar, String defDepCommRate,
			String depCommVar, String defNetGCommRate, 
			String netGCommVar,int userOrgId,String countryDep) throws LMSException{


<span class="nc" id="L2401">		String wallet[] = wname.split(&quot;-&quot;);</span>
<span class="nc" id="L2402">		double dWidCommRate = Double.parseDouble(defWidCommRate.trim());</span>
<span class="nc" id="L2403">		double widCommVar1 = Double.parseDouble(widCommVar.trim());</span>
<span class="nc" id="L2404">		double dDepCommRate = Double.parseDouble(defDepCommRate.trim());</span>
<span class="nc" id="L2405">		double depCommVar1 = Double.parseDouble(depCommVar.trim());</span>
<span class="nc" id="L2406">		double dNetGCommRate = Double.parseDouble(defNetGCommRate.trim());</span>
<span class="nc" id="L2407">		double netGCommVar1 = Double.parseDouble(netGCommVar.trim());</span>
<span class="nc" id="L2408">		UpdateSalePwtCommVarBean commVarianceBean = null;</span>
<span class="nc" id="L2409">		Connection conn = DBConnect.getConnection();</span>
<span class="nc" id="L2410">		boolean flagforZero = false;</span>
<span class="nc" id="L2411">		double dAgtWidComm = 0.0;</span>
<span class="nc" id="L2412">		double agtWidComm = 0.0;</span>
<span class="nc" id="L2413">		double dAgtDepComm = 0.0;</span>
<span class="nc" id="L2414">		double agtDepComm = 0.0;</span>
<span class="nc" id="L2415">		double dAgtNetGComm = 0.0;</span>
<span class="nc" id="L2416">		double agtNetGComm = 0.0;</span>
		try {
<span class="nc" id="L2418">			int orgId =Integer.parseInt(agtOrgName);</span>
<span class="nc" id="L2419">			conn.setAutoCommit(false);</span>
<span class="nc" id="L2420">			PreparedStatement pstmt0 = conn</span>
					.prepareStatement(&quot;select agent_org_id, wallet_id, deposit_comm_variance, default_deposit_comm_rate, withdrawl_comm_variance, default_withdrawl_comm_rate, net_gaming_comm_variance, default_net_gaming_comm_rate from st_ola_bo_agent_comm_variance where wallet_id = &quot;
										+ wallet[0]
										+ &quot; and agent_org_id=(select organization_id from st_lms_organization_master where organization_id=&quot;
										+ orgId +&quot;)&quot;);
<span class="nc" id="L2425">			ResultSet rs0 = pstmt0.executeQuery();</span>
<span class="nc" id="L2426">			System.out.println(&quot;query = &quot; + pstmt0);</span>
<span class="nc bnc" id="L2427" title="All 2 branches missed.">			if (rs0.next()) {</span>
<span class="nc" id="L2428">				System.out.println(&quot;inside pstmt1---11111111&quot;);</span>
<span class="nc" id="L2429">				dAgtDepComm = rs0.getDouble(&quot;default_deposit_comm_rate&quot;);</span>
<span class="nc" id="L2430">				agtDepComm = rs0.getDouble(&quot;deposit_comm_variance&quot;);</span>
<span class="nc" id="L2431">				dAgtWidComm = rs0.getDouble(&quot;default_withdrawl_comm_rate&quot;);</span>
<span class="nc" id="L2432">				agtWidComm = rs0.getDouble(&quot;withdrawl_comm_variance&quot;);</span>
<span class="nc" id="L2433">				dAgtNetGComm = rs0.getDouble(&quot;default_net_gaming_comm_rate&quot;);</span>
<span class="nc" id="L2434">				agtNetGComm = rs0.getDouble(&quot;net_gaming_comm_variance&quot;);</span>
			}else{
<span class="nc" id="L2436">				PreparedStatement pstmtWalletMaster = conn</span>
						.prepareStatement(&quot;select agt_withdrawl_comm, agt_deposit_comm, agt_net_gaming_comm from st_ola_wallet_master where wallet_id=&quot;
								+ wallet[0]);
<span class="nc" id="L2439">				ResultSet rsWalletMaster = pstmtWalletMaster.executeQuery();</span>
<span class="nc" id="L2440">				System.out.println(&quot;query = &quot; + pstmtWalletMaster);</span>
<span class="nc bnc" id="L2441" title="All 2 branches missed.">				if (rsWalletMaster.next()) {</span>
<span class="nc" id="L2442">					dAgtWidComm = rsWalletMaster</span>
							.getDouble(&quot;agt_withdrawl_comm&quot;);
<span class="nc" id="L2444">					dAgtDepComm = rsWalletMaster.getDouble(&quot;agt_deposit_comm&quot;);</span>
<span class="nc" id="L2445">					dAgtNetGComm = rsWalletMaster.getDouble(&quot;agt_net_gaming_comm&quot;);</span>
				}
			}
			
<span class="nc bnc" id="L2449" title="All 2 branches missed.">			double diffWidComm = dAgtWidComm</span>
					+ (agtWidComm &lt; 0 ? agtWidComm : 0.0)
					- (dWidCommRate + widCommVar1);
<span class="nc bnc" id="L2452" title="All 2 branches missed.">			double diffDepComm = dAgtDepComm</span>
					+ (agtDepComm &lt; 0 ? agtDepComm : 0.0)
					- (dDepCommRate + depCommVar1);
<span class="nc bnc" id="L2455" title="All 2 branches missed.">			double diffNetGComm = dAgtNetGComm</span>
				+ (agtNetGComm &lt; 0 ? agtNetGComm : 0.0)
				- (dNetGCommRate + netGCommVar1);
<span class="nc bnc" id="L2458" title="All 6 branches missed.">			if (diffWidComm &gt;= 0 &amp;&amp; diffDepComm &gt;= 0 &amp;&amp; diffNetGComm &gt;= 0) {</span>
				
<span class="nc" id="L2460">				PreparedStatement pstmt1 = conn</span>
				.prepareStatement(&quot;select retailer_org_id, wallet_id, deposit_comm_variance, default_deposit_comm_rate, withdrawl_comm_variance, default_withdrawl_comm_rate, net_gaming_comm_variance, default_net_gaming_comm_rate from st_ola_agent_retailer_comm_variance where wallet_id=(select wallet_id from st_ola_wallet_master where wallet_id=&quot;
						+ wallet[0]
						+ &quot; ) and retailer_org_id=&quot;
						+ orgId + &quot;&quot;);
<span class="nc" id="L2465">				ResultSet rs1 = pstmt1.executeQuery();</span>
<span class="nc" id="L2466">				System.out.println(&quot;query = &quot; + pstmt1);</span>
<span class="nc bnc" id="L2467" title="All 2 branches missed.">				if (rs1.next()) {</span>
<span class="nc" id="L2468">					System.out.println(&quot;inside pstmt1---11111111&quot;);</span>
<span class="nc" id="L2469">					double oldWidCommVar = rs1.getDouble(&quot;withdrawl_comm_variance&quot;);</span>
<span class="nc" id="L2470">					double oldDepCommVar = rs1.getDouble(&quot;deposit_comm_variance&quot;);</span>
<span class="nc" id="L2471">					double oldNetGCommVar = rs1.getDouble(&quot;net_gaming_comm_variance&quot;);</span>
<span class="nc bnc" id="L2472" title="All 6 branches missed.">					if (oldWidCommVar == widCommVar1</span>
							&amp;&amp; depCommVar1 == oldDepCommVar 
							&amp;&amp; netGCommVar1 == oldNetGCommVar) {
<span class="nc" id="L2475">						return &quot;SAME_VALUES&quot;;</span>
					}

<span class="nc" id="L2478">					commVarianceBean = new UpdateSalePwtCommVarBean();</span>
<span class="nc" id="L2479">					commVarianceBean.setRetOrgId(rs1.getInt(&quot;retailer_org_id&quot;));</span>
<span class="nc" id="L2480">					commVarianceBean.setGameId(rs1.getInt(&quot;wallet_id&quot;));</span>
<span class="nc" id="L2481">					commVarianceBean.setWidCommVar(oldWidCommVar);</span>
<span class="nc" id="L2482">					commVarianceBean.setDefaultWidCommRate(rs1</span>
							.getDouble(&quot;default_withdrawl_comm_rate&quot;));
<span class="nc" id="L2484">					commVarianceBean.setDepCommVar(oldDepCommVar);</span>
<span class="nc" id="L2485">					commVarianceBean.setDefaultDepCommRate(rs1</span>
							.getDouble(&quot;default_deposit_comm_rate&quot;));
<span class="nc" id="L2487">					commVarianceBean.setNetGCommVar(oldNetGCommVar);</span>
<span class="nc" id="L2488">					commVarianceBean.setDefaultNetGCommRate(rs1</span>
							.getDouble(&quot;default_net_gaming_comm_rate&quot;));
<span class="nc" id="L2490">					System.out.println(&quot;inside pstmt1---22222222&quot;);</span>
				}
<span class="nc" id="L2492">				pstmt1.close();</span>
<span class="nc" id="L2493">				rs1.close();</span>
				
				
<span class="nc bnc" id="L2496" title="All 2 branches missed.">				if (commVarianceBean != null) {</span>
<span class="nc" id="L2497">					System.out.println(&quot;555555555555555&quot;);</span>
<span class="nc" id="L2498">					PreparedStatement pstmt5 = conn</span>
							.prepareStatement(&quot;delete from st_ola_agent_retailer_comm_variance  where wallet_id=? and retailer_org_id=?&quot;);
<span class="nc" id="L2500">					pstmt5.setInt(1, commVarianceBean.getGameId());</span>
<span class="nc" id="L2501">					pstmt5.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L2502">					int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L2503">					System.out.println(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L2504">					System.out</span>
							.println(&quot;Delete entry from st_ola_agent_retailer_variance  table updated rows === &quot;
									+ rows);
<span class="nc" id="L2507">					pstmt5.close();</span>
<span class="nc" id="L2508">					flagforZero = true;</span>
				}

<span class="nc bnc" id="L2511" title="All 4 branches missed.">				if (commVarianceBean != null</span>
						&amp;&amp; widCommVar1 != commVarianceBean.getWidCommVar()) {
<span class="nc" id="L2513">					System.out.println(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L2514">					PreparedStatement pstmt3 = conn</span>
							.prepareStatement(&quot;insert into st_ola_agent_retailer_withdrawl_comm_variance_history values(?, ?, ?, ?, ?)&quot;);
<span class="nc" id="L2516">					pstmt3.setInt(1, userOrgId);</span>
<span class="nc" id="L2517">					pstmt3.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L2518">					pstmt3.setInt(3, commVarianceBean.getGameId());</span>
<span class="nc" id="L2519">					pstmt3.setDouble(4, commVarianceBean.getWidCommVar());</span>
<span class="nc" id="L2520">					pstmt3.setTimestamp(5, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L2522">					int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L2523">					System.out.println(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L2524">					System.out</span>
							.println(&quot;sale comm var history table updated rows === &quot;
									+ rows);
<span class="nc" id="L2527">					pstmt3.close();</span>
				}

<span class="nc bnc" id="L2530" title="All 4 branches missed.">				if (commVarianceBean != null</span>
						&amp;&amp; depCommVar1 != commVarianceBean.getDepCommVar()) {
<span class="nc" id="L2532">					System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L2533">					PreparedStatement pstmt4 = conn</span>
							.prepareStatement(&quot;insert into st_ola_agent_retailer_deposit_comm_variance_history values(?, ?, ?, ?, ?)&quot;);
<span class="nc" id="L2535">					pstmt4.setInt(1, userOrgId);</span>
<span class="nc" id="L2536">					pstmt4.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L2537">					pstmt4.setInt(3, commVarianceBean.getGameId());</span>
<span class="nc" id="L2538">					pstmt4.setDouble(4, commVarianceBean.getDepCommVar());</span>
<span class="nc" id="L2539">					pstmt4.setTimestamp(5, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L2541">					int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L2542">					System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L2543">					System.out</span>
							.println(&quot;Deposit comm var history table updated rows === &quot;
									+ rows);
<span class="nc" id="L2546">					pstmt4.close();</span>
				}
			
<span class="nc bnc" id="L2549" title="All 4 branches missed.">				if (commVarianceBean != null</span>
						&amp;&amp; netGCommVar1 != commVarianceBean.getNetGCommVar()) {
<span class="nc" id="L2551">					System.out.println(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L2552">					PreparedStatement pstmt4 = conn</span>
							.prepareStatement(&quot;insert into st_ola_agent_retailer_plr_comm_variance_history values(?, ?, ?, ?, ?)&quot;);
<span class="nc" id="L2554">					pstmt4.setInt(1, userOrgId);</span>
<span class="nc" id="L2555">					pstmt4.setInt(2, commVarianceBean.getRetOrgId());</span>
<span class="nc" id="L2556">					pstmt4.setInt(3, commVarianceBean.getGameId());</span>
<span class="nc" id="L2557">					pstmt4.setDouble(4, commVarianceBean.getNetGCommVar());</span>
<span class="nc" id="L2558">					pstmt4.setTimestamp(5, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L2560">					int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L2561">					System.out.println(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L2562">					System.out</span>
							.println(&quot;Net Gaming comm var history table updated rows === &quot;
									+ rows);
<span class="nc" id="L2565">					pstmt4.close();</span>
				}

<span class="nc" id="L2568">				logger.debug(&quot; **widCommVar1** &quot; + widCommVar1 + &quot; **depCommVar1** &quot;</span>
						+ depCommVar1 + &quot; **netGCommVar1** &quot;+ netGCommVar1  +&quot; **&quot;);
<span class="nc bnc" id="L2570" title="All 6 branches missed.">				logger.debug(&quot;widCommVar1!=0.0 ||  depCommVar1!=0.0 || netGCommVar != 0.0&quot;</span>
						+ (widCommVar1 != 0.0 || depCommVar1 != 0.0 || netGCommVar1 != 0.0));

<span class="nc bnc" id="L2573" title="All 6 branches missed.">				if (widCommVar1 != 0.0 || depCommVar1 != 0.0 || netGCommVar1 != 0.0) {</span>
<span class="nc" id="L2574">					System.out.println(&quot;66666666666666666666666666&quot;);</span>
<span class="nc" id="L2575">					PreparedStatement pstmt6 = conn</span>
							.prepareStatement(&quot; select wallet_id from st_ola_wallet_master where wallet_id=? and wallet_name=? &quot;);
					//pstmt6.setString(1, agtOrgName.trim());
<span class="nc" id="L2578">					pstmt6.setInt(1, Integer.parseInt(wallet[0]));</span>
<span class="nc" id="L2579">					pstmt6.setString(2, wallet[1]);</span>
<span class="nc" id="L2580">					ResultSet rs6 = pstmt6.executeQuery();</span>
<span class="nc" id="L2581">					System.out.println(&quot;query = &quot; + pstmt6);</span>
<span class="nc" id="L2582">					int walletId = 0;</span>
					//int retOrgId = 0;
<span class="nc bnc" id="L2584" title="All 2 branches missed.">					if (rs6.next()) {</span>
<span class="nc" id="L2585">						walletId = rs6.getInt(&quot;wallet_id&quot;);</span>
					//	retOrgId = rs6.getInt(&quot;organization_id&quot;);
					}
<span class="nc bnc" id="L2588" title="All 4 branches missed.">					if (walletId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2589">						PreparedStatement pstmt5 = conn</span>
								.prepareStatement(&quot;insert into st_ola_agent_retailer_comm_variance  values (?, ? , ? , ? ,?,?, ?,?,?)&quot;);
<span class="nc" id="L2591">						pstmt5.setInt(1, userOrgId);</span>
<span class="nc" id="L2592">						pstmt5.setInt(2, orgId);</span>
<span class="nc" id="L2593">						pstmt5.setInt(3, walletId);</span>
<span class="nc" id="L2594">						pstmt5.setDouble(4, depCommVar1);</span>
<span class="nc" id="L2595">						pstmt5.setDouble(5, dDepCommRate);</span>
<span class="nc" id="L2596">						pstmt5.setDouble(6, widCommVar1);</span>
<span class="nc" id="L2597">						pstmt5.setDouble(7, dWidCommRate);</span>
<span class="nc" id="L2598">						pstmt5.setDouble(8, netGCommVar1);</span>
<span class="nc" id="L2599">						pstmt5.setDouble(9, dNetGCommRate);</span>
<span class="nc" id="L2600">						int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L2601">						logger.debug(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L2602">						logger.debug(&quot;insert entries st_ola_agent_retailer_comm_variance  table updated rows === &quot;</span>
										+ rows);
<span class="nc" id="L2604">						pstmt5.close();</span>
				
				}

<span class="nc bnc" id="L2608" title="All 6 branches missed.">				if (commVarianceBean == null &amp;&amp; walletId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2609">					logger.debug(&quot;3333333333333333333&quot;);</span>
<span class="nc" id="L2610">					PreparedStatement pstmt3 = conn</span>
							.prepareStatement(&quot;insert into st_ola_agent_retailer_withdrawl_comm_variance_history values(?, ?, ?, ?, ?)&quot;);
<span class="nc" id="L2612">					pstmt3.setInt(1, userOrgId);</span>
<span class="nc" id="L2613">					pstmt3.setInt(2, orgId);</span>
<span class="nc" id="L2614">					pstmt3.setInt(3, walletId);</span>
<span class="nc" id="L2615">					pstmt3.setDouble(4, 0.0);</span>
<span class="nc" id="L2616">					pstmt3.setTimestamp(5, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L2618">					int rows = pstmt3.executeUpdate();</span>
<span class="nc" id="L2619">					logger.debug(&quot;query = &quot; + pstmt3);</span>
<span class="nc" id="L2620">					logger.debug(&quot;withdrawal comm var history table updated rows === &quot;</span>
									+ rows);
<span class="nc" id="L2622">					pstmt3.close();</span>
				}

<span class="nc bnc" id="L2625" title="All 6 branches missed.">				if (commVarianceBean == null &amp;&amp; walletId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2626">					logger.debug(&quot;44444444444444444444444&quot;);</span>
<span class="nc" id="L2627">					PreparedStatement pstmt4 = conn</span>
							.prepareStatement(&quot;insert into st_ola_agent_retailer_deposit_comm_variance_history values(?, ?, ?, ?, ?)&quot;);
<span class="nc" id="L2629">					pstmt4.setInt(1, userOrgId);</span>
<span class="nc" id="L2630">					pstmt4.setInt(2, orgId);</span>
<span class="nc" id="L2631">					pstmt4.setInt(3, walletId);</span>
<span class="nc" id="L2632">					pstmt4.setDouble(4, 0.0);</span>
<span class="nc" id="L2633">					pstmt4.setTimestamp(5, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L2635">					int rows = pstmt4.executeUpdate();</span>
<span class="nc" id="L2636">					logger.debug(&quot;query = &quot; + pstmt4);</span>
<span class="nc" id="L2637">					logger.debug(&quot;Deposit comm var history table updated rows === &quot;</span>
									+ rows);
<span class="nc" id="L2639">					pstmt4.close();</span>
				}
				
<span class="nc bnc" id="L2642" title="All 6 branches missed.">				if (commVarianceBean == null &amp;&amp; walletId &gt; 0 &amp;&amp; orgId &gt; 0) {</span>
<span class="nc" id="L2643">					logger.debug(&quot;55555555555555555555555&quot;);</span>
<span class="nc" id="L2644">					PreparedStatement pstmt5 = conn</span>
							.prepareStatement(&quot;insert into st_ola_agent_retailer_plr_comm_variance_history values(?, ?, ?, ?, ?)&quot;);
<span class="nc" id="L2646">					pstmt5.setInt(1, userOrgId);</span>
<span class="nc" id="L2647">					pstmt5.setInt(2, orgId);</span>
<span class="nc" id="L2648">					pstmt5.setInt(3, walletId);</span>
<span class="nc" id="L2649">					pstmt5.setDouble(4, 0.0);</span>
<span class="nc" id="L2650">					pstmt5.setTimestamp(5, new java.sql.Timestamp(</span>
							new java.util.Date().getTime()));
<span class="nc" id="L2652">					int rows = pstmt5.executeUpdate();</span>
<span class="nc" id="L2653">					logger.debug(&quot;query = &quot; + pstmt5);</span>
<span class="nc" id="L2654">					logger.debug(&quot;Net Gaming comm var history table updated rows === &quot;</span>
									+ rows);
<span class="nc" id="L2656">					pstmt5.close();</span>
				}

			}
			
<span class="nc" id="L2661">		}else{</span>
<span class="nc bnc" id="L2662" title="All 8 branches missed.">				return &quot;AGENT_DIFF_GREATER;&quot;</span>
						+ (dAgtWidComm + (agtWidComm &lt; 0 ? agtWidComm : (&quot;kenya&quot;.equalsIgnoreCase(countryDep)?agtWidComm:0.0)))
						+ &quot;;&quot;
						+ (dAgtDepComm + (agtDepComm &lt; 0 ? agtDepComm : 0.0)
						+ &quot;;&quot;
						+ (dAgtNetGComm + (agtNetGComm &lt; 0 ? agtNetGComm : 0.0)));
			}
			//here update the updated comm rate in the context
			   //System.out.println(&quot;var in context before: &quot; + Util.getSaleCommVariance(retOrgid, gameId));
				//double retUpdatedCommVar = CommonFunctionsHelper.fetchDGCommOfOrganization(gameId, retOrgid, &quot;SALE&quot;, &quot;RETAILER&quot;, conn);
				//Util.updateSaleCommVariance(retOrgid, gameId,retUpdatedCommVar);
				//System.out.println(&quot;var in context after updation: &quot; + Util.getSaleCommVariance(retOrgid, gameId));
			   //updated successfully
			
<span class="nc" id="L2676">			conn.commit();</span>
<span class="nc" id="L2677">		} catch (SQLException se) {</span>
			try {
<span class="nc" id="L2679">				System.out.println(&quot;rolled back&quot;);</span>
<span class="nc" id="L2680">				conn.rollback();</span>
<span class="nc" id="L2681">			} catch (SQLException e) {</span>
<span class="nc" id="L2682">				e.printStackTrace();</span>
				// throw new LMSException(e);
<span class="nc" id="L2684">			}</span>
<span class="nc" id="L2685">			se.printStackTrace();</span>
<span class="nc" id="L2686">			throw new LMSException(se);</span>

		} finally {

<span class="nc" id="L2690">			try {</span>
<span class="nc bnc" id="L2691" title="All 16 branches missed.">				if (conn != null &amp;&amp; !conn.isClosed()) {</span>
<span class="nc" id="L2692">					conn.close();</span>
				}
<span class="nc" id="L2694">			} catch (SQLException e) {</span>
<span class="nc" id="L2695">				e.printStackTrace();</span>
<span class="nc" id="L2696">			}</span>

<span class="nc" id="L2698">		}</span>

<span class="nc" id="L2700">		return &quot;SUCCESS&quot;;</span>
	
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>