<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LmsDrawGameServiceImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.api.drawGames</a> &gt; <span class="el_source">LmsDrawGameServiceImpl.java</span></div><h1>LmsDrawGameServiceImpl.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.api.drawGames;

import javax.servlet.http.HttpServletRequest;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.struts2.ServletActionContext;
import org.codehaus.xfire.transport.http.XFireServletController;

import com.skilrock.lms.api.beans.PanelBean;
import com.skilrock.lms.api.beans.TPKenoPurchaseBean;
//Generated by MyEclipse
import com.skilrock.lms.api.beans.TPLottoPurchaseBean;
import com.skilrock.lms.api.drawGamesImpl.APIUtility;
import com.skilrock.lms.api.drawGamesImpl.DrawGameAPIHelper;
import com.skilrock.lms.api.drawGamesImpl.KenoTwoAction;
import com.skilrock.lms.api.drawGamesImpl.ZimLottoBonusAction;
import com.skilrock.lms.beans.UserInfoBean;

<span class="nc" id="L20">public class LmsDrawGameServiceImpl implements ILmsDrawGameService {</span>
<span class="nc" id="L21">	static Log logger = LogFactory.getLog(LmsDrawGameServiceImpl.class);</span>
	
	public TPLottoPurchaseBean zimLottoBonusSale(TPLottoPurchaseBean zimLottoBonusBean){
		

<span class="nc" id="L26">		String userName = zimLottoBonusBean.getUserName();</span>
<span class="nc" id="L27">		String password = zimLottoBonusBean.getPassword();</span>
<span class="nc" id="L28">		String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc" id="L29">		String usrReqStr = &quot;TP REQUEST bonusBallLottoSale=userName:&quot; + userName</span>
				+ &quot;|pasword:&quot; + password + &quot;|ip:&quot; + ip + &quot;|&quot;;
<span class="nc" id="L31">		String resStr = &quot;TP RESPONSE bonusBallLottoSale=|userName:&quot; + userName;</span>
<span class="nc" id="L32">		StringBuilder raffleData = new StringBuilder(&quot;#Raffle Data:&quot;);</span>
<span class="nc" id="L33">		StringBuilder panelArr = new StringBuilder(&quot;#Panel Data:&quot;);</span>
<span class="nc" id="L34">		String dataStr = &quot;|gameCode:&quot; + zimLottoBonusBean.getGameCode()</span>
				+ &quot;|Balance:&quot; + zimLottoBonusBean.getBalance() + &quot;|ErrorCode:&quot;
				+ zimLottoBonusBean.getErrorCode() + &quot;|AdvancedPlay:&quot;
				+ zimLottoBonusBean.getIsAdvancedPlay() + &quot;|LmsTranxId:&quot;
				+ zimLottoBonusBean.getLmsTranxId() + &quot;|MobileNumber:&quot;
				+ zimLottoBonusBean.getMobileNumber() + &quot;|NoOfDraws:&quot;
				+ zimLottoBonusBean.getNoOfDraws() + &quot;|NoPicked:&quot;
				+ zimLottoBonusBean.getNoPicked() + &quot;|PurchaseTime:&quot;
				+ zimLottoBonusBean.getPurchaseTime() + &quot;|RefTransId:&quot;
				+ zimLottoBonusBean.getRefTransId() + &quot;|TicketCost:&quot;
				+ zimLottoBonusBean.getTicketCost() + &quot;|TicketNumber:&quot;
				+ zimLottoBonusBean.getTicketNumber() + &quot;|TotalPurchaseAmt:&quot;
				+ zimLottoBonusBean.getTotalPurchaseAmt();
<span class="nc bnc" id="L47" title="All 2 branches missed.">		for (int i = 0; i &lt; zimLottoBonusBean.getPickedNumbers().length; i++) {</span>
<span class="nc" id="L48">			panelArr.append(&quot;|Pick Numbers:&quot;</span>
					+ zimLottoBonusBean.getPickedNumbers()[i]);
		}
<span class="nc bnc" id="L51" title="All 2 branches missed.">		if (zimLottoBonusBean.isRaffle()) {</span>
<span class="nc" id="L52">			raffleData.append(&quot;|isRaffle:&quot; + zimLottoBonusBean.isRaffle()</span>
					+ &quot;|RaffleTicketNumber:&quot;
					+ zimLottoBonusBean.getRaffleData().getTicketNumber());
		}
<span class="nc" id="L56">		logger.debug(usrReqStr + dataStr + panelArr + raffleData);</span>
<span class="nc" id="L57">		UserInfoBean userBean = DrawGameAPIHelper.getUserData(userName);</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">		if (userBean != null) {</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">			if (APIUtility.validateUser(userBean, ip, password)) {</span>
<span class="nc" id="L60">				HttpServletRequest request = XFireServletController</span>
						.getRequest();
<span class="nc" id="L62">				request.setAttribute(&quot;code&quot;, &quot;DG&quot;);</span>
<span class="nc" id="L63">				request.setAttribute(&quot;interfaceType&quot;, &quot;LMS_TERMINAL&quot;);</span>
<span class="nc" id="L64">				ServletActionContext.setRequest(request);</span>

				try {
<span class="nc" id="L67">					ZimLottoBonusAction.purchaseTicketProcess(</span>
							zimLottoBonusBean, userBean);
<span class="nc bnc" id="L69" title="All 2 branches missed.">					if (&quot;100&quot;.equalsIgnoreCase(zimLottoBonusBean</span>
							.getErrorCode())) {
<span class="nc" id="L71">						StringBuilder raffleData1 = new StringBuilder(</span>
								&quot;#Raffle Data:&quot;);
<span class="nc" id="L73">						StringBuilder panelArr1 = new StringBuilder(</span>
								&quot;#Panel Data:&quot;);
<span class="nc" id="L75">						String finalResp = &quot;|gameCode:&quot;</span>
								+ zimLottoBonusBean.getGameCode()
								+ &quot;|Balance:&quot; + zimLottoBonusBean.getBalance()
								+ &quot;|ErrorCode:&quot;
								+ zimLottoBonusBean.getErrorCode()
								+ &quot;|AdvancedPlay:&quot;
								+ zimLottoBonusBean.getIsAdvancedPlay()
								+ &quot;|LmsTranxId:&quot;
								+ zimLottoBonusBean.getLmsTranxId()
								+ &quot;|MobileNumber:&quot;
								+ zimLottoBonusBean.getMobileNumber()
								+ &quot;|NoOfDraws:&quot;
								+ zimLottoBonusBean.getNoOfDraws()
								+ &quot;|DrawDateTime:&quot;
								+ zimLottoBonusBean.getDrawDateTime()
								+ &quot;|NoPicked:&quot;
								+ zimLottoBonusBean.getNoPicked()
								+ &quot;|PurchaseTime:&quot;
								+ zimLottoBonusBean.getPurchaseTime()
								+ &quot;|RefTransId:&quot;
								+ zimLottoBonusBean.getRefTransId()
								+ &quot;|TicketCost:&quot;
								+ zimLottoBonusBean.getTicketCost()
								+ &quot;|TicketNumber:&quot;
								+ zimLottoBonusBean.getTicketNumber()
								+ &quot;|TotalPurchaseAmt:&quot;
								+ zimLottoBonusBean.getTotalPurchaseAmt()
								+ &quot;|TopAdMessageList:&quot;
								+ zimLottoBonusBean.getTopAdMessageList()
								+ &quot;|BottomAdMessageList:&quot;
								+ zimLottoBonusBean.getBottomAdMessageList();
<span class="nc bnc" id="L106" title="All 2 branches missed.">						for (int i = 0; i &lt; zimLottoBonusBean</span>
<span class="nc" id="L107">								.getPickedNumbers().length; i++) {</span>
<span class="nc" id="L108">							panelArr1.append(&quot;|Pick Numbers:&quot;</span>
									+ zimLottoBonusBean.getPickedNumbers()[i]
									+ &quot;|QpStatus:&quot;
									+ zimLottoBonusBean.getQpStatus()[i]);
						}
<span class="nc bnc" id="L113" title="All 2 branches missed.">						if (zimLottoBonusBean.isRaffle()) {</span>
<span class="nc" id="L114">							raffleData1.append(&quot;|isRaffle:&quot;</span>
									+ zimLottoBonusBean.isRaffle()
									+ &quot;|RaffleTicketNumber:&quot;
									+ zimLottoBonusBean.getRaffleData()
											.getTicketNumber());
						}
<span class="nc" id="L120">						logger.debug(resStr + finalResp + panelArr1</span>
								+ raffleData1);
<span class="nc" id="L122">					} else {</span>
<span class="nc" id="L123">						logger.debug(resStr + &quot;|ErrorCode:&quot;</span>
								+ zimLottoBonusBean.getErrorCode());
					}
<span class="nc" id="L126">				} catch (Exception e) {</span>
<span class="nc" id="L127">					e.printStackTrace();</span>
<span class="nc" id="L128">					zimLottoBonusBean.setSuccess(false);</span>
<span class="nc" id="L129">					zimLottoBonusBean.setErrorCode(&quot;500&quot;);// internal server</span>
					// error
<span class="nc" id="L131">					logger.debug(resStr + &quot;|ErrorCode:&quot;</span>
							+ zimLottoBonusBean.getErrorCode());
<span class="nc" id="L133">					return zimLottoBonusBean;</span>
<span class="nc" id="L134">				}</span>

<span class="nc" id="L136">			} else {</span>
<span class="nc" id="L137">				zimLottoBonusBean.setSuccess(false);</span>
<span class="nc" id="L138">				zimLottoBonusBean.setErrorCode(&quot;102&quot;);// Invalid User</span>
<span class="nc" id="L139">				logger.debug(resStr + &quot;|ErrorCode:&quot;</span>
						+ zimLottoBonusBean.getErrorCode());
			}

		} else {
<span class="nc" id="L144">			zimLottoBonusBean.setSuccess(false);</span>
<span class="nc" id="L145">			zimLottoBonusBean.setErrorCode(&quot;103&quot;);// Please call gameInfo first</span>
<span class="nc" id="L146">			logger.debug(resStr + &quot;|ErrorCode:&quot;</span>
					+ zimLottoBonusBean.getErrorCode());
<span class="nc" id="L148">			return zimLottoBonusBean;</span>
		}
<span class="nc" id="L150">		return zimLottoBonusBean;</span>
	
	}
	public TPKenoPurchaseBean kenoTwoSale(TPKenoPurchaseBean kenoTwoPurchaseBean){
		
<span class="nc" id="L155">		String userName = kenoTwoPurchaseBean.getUserName();</span>
<span class="nc" id="L156">		String password = kenoTwoPurchaseBean.getPassword();</span>
<span class="nc" id="L157">		String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc" id="L158">		String usrReqStr = &quot;TP REQUEST kenoTwoSale=userName:&quot; + userName</span>
				+ &quot;|pasword:&quot; + password + &quot;|ip:&quot; + ip + &quot;|&quot;;
<span class="nc" id="L160">		String resStr = &quot;TP RESPONSE kenoTwoSale=|userName:&quot; + userName;</span>
<span class="nc" id="L161">		StringBuilder panelStr = new StringBuilder(&quot;#Panel Data&quot;);</span>
<span class="nc" id="L162">		String dataStr = &quot;|gameCode:&quot; + kenoTwoPurchaseBean.getGameCode()</span>
				+ &quot;|Balance:&quot; + kenoTwoPurchaseBean.getBalance() + &quot;|ErrorCode:&quot;
				+ kenoTwoPurchaseBean.getErrorCode() + &quot;|LmsTranxId:&quot;
				+ kenoTwoPurchaseBean.getLmsTranxId() + &quot;|MobileNumber:&quot;
				+ &quot;|IsAdvancePlay:&quot; + kenoTwoPurchaseBean.getIsAdvancePlay()
				+ kenoTwoPurchaseBean.getMobileNumber() + &quot;|NoOfDraws:&quot;
				+ kenoTwoPurchaseBean.getNoOfDraws() + &quot;|DrawDateTimeList:&quot;
				+ kenoTwoPurchaseBean.getDrawDateTimeList() + &quot;|PurchaseTime:&quot;
				+ kenoTwoPurchaseBean.getPurchaseTime() + &quot;|RefTransId:&quot;
				+ kenoTwoPurchaseBean.getRefTransId() + &quot;|TicketCost:&quot;
				+ kenoTwoPurchaseBean.getTicketCost() + &quot;|TicketNumber:&quot;
				+ kenoTwoPurchaseBean.getTicketNumber() + &quot;|TotalPurchaseAmt:&quot;
				+ kenoTwoPurchaseBean.getTotalPurchaseAmt() + &quot;|TopAdMessageList:&quot;
				+ kenoTwoPurchaseBean.getTopAdMessageList()
				+ &quot;|BottomAdMessageList:&quot;
				+ kenoTwoPurchaseBean.getBottomAdMessageList();
<span class="nc bnc" id="L178" title="All 4 branches missed.">		if (kenoTwoPurchaseBean.getPanelList() != null</span>
				&amp;&amp; kenoTwoPurchaseBean.getPanelList().size() &gt; 0) {
<span class="nc bnc" id="L180" title="All 2 branches missed.">			for (PanelBean panelBean : kenoTwoPurchaseBean.getPanelList()) {</span>
<span class="nc" id="L181">				panelStr.append(&quot;|PickedNumbers:&quot;</span>
						+ panelBean.getPickedNumbers() + &quot;|NoPicked:&quot;
						+ panelBean.getNoPicked() + &quot;|PlayType:&quot;
						+ panelBean.getPlayType() + &quot;|BetAmountMultiple:&quot;
						+ panelBean.getBetAmountMultiple() + &quot;|IsQp:&quot;
						+ panelBean.getIsQp());
<span class="nc" id="L187">			}</span>
		}
<span class="nc" id="L189">		logger.debug(usrReqStr + panelStr + dataStr);</span>
		
<span class="nc" id="L191">		UserInfoBean userBean = DrawGameAPIHelper.getUserData(userName);</span>
<span class="nc bnc" id="L192" title="All 2 branches missed.">		if (userBean != null) {</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">			if (APIUtility.validateUser(userBean, ip, password)) {</span>
<span class="nc" id="L194">				HttpServletRequest request = XFireServletController</span>
						.getRequest();
<span class="nc" id="L196">				request.setAttribute(&quot;code&quot;, &quot;DG&quot;);</span>
<span class="nc" id="L197">				request.setAttribute(&quot;interfaceType&quot;, &quot;TERMINAL&quot;);</span>
<span class="nc" id="L198">				ServletActionContext.setRequest(request);</span>
<span class="nc" id="L199">				KenoTwoAction.purchaseTicketProcess(kenoTwoPurchaseBean, userBean);</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">				if (&quot;100&quot;.equalsIgnoreCase(kenoTwoPurchaseBean.getErrorCode())) {</span>
<span class="nc" id="L201">					StringBuilder panelStr1 = new StringBuilder(&quot;#Panel Data&quot;);</span>
<span class="nc" id="L202">					StringBuilder raffleData = new StringBuilder(</span>
							&quot;#Raffle Data:&quot;);
<span class="nc" id="L204">					String finalResp = &quot;|gameCode:&quot;</span>
							+ kenoTwoPurchaseBean.getGameCode() + &quot;|Balance:&quot;
							+ kenoTwoPurchaseBean.getBalance() + &quot;|ErrorCode:&quot;
							+ kenoTwoPurchaseBean.getErrorCode() + &quot;|LmsTranxId:&quot;
							+ kenoTwoPurchaseBean.getLmsTranxId()
							+ &quot;|MobileNumber:&quot;
							+ kenoTwoPurchaseBean.getMobileNumber()
							+ &quot;|NoOfDraws:&quot; + kenoTwoPurchaseBean.getNoOfDraws()
							+ &quot;|IsAdvancePlay:&quot;
							+ kenoTwoPurchaseBean.getIsAdvancePlay()
							+ &quot;|DrawDateTimeList:&quot;
							+ kenoTwoPurchaseBean.getDrawDateTimeList()
							+ &quot;|PurchaseTime:&quot;
							+ kenoTwoPurchaseBean.getPurchaseTime()
							+ &quot;|RefTransId:&quot; + kenoTwoPurchaseBean.getRefTransId()
							+ &quot;|TicketCost:&quot; + kenoTwoPurchaseBean.getTicketCost()
							+ &quot;|TicketNumber:&quot;
							+ kenoTwoPurchaseBean.getTicketNumber()
							+ &quot;|TotalPurchaseAmt:&quot;
							+ kenoTwoPurchaseBean.getTotalPurchaseAmt()
							+ &quot;|TopAdMessageList:&quot;
							+ kenoTwoPurchaseBean.getTopAdMessageList()
							+ &quot;|BottomAdMessageList:&quot;
							+ kenoTwoPurchaseBean.getBottomAdMessageList();
<span class="nc bnc" id="L228" title="All 4 branches missed.">					if (kenoTwoPurchaseBean.getPanelList() != null</span>
							&amp;&amp; kenoTwoPurchaseBean.getPanelList().size() &gt; 0) {
<span class="nc bnc" id="L230" title="All 2 branches missed.">						for (PanelBean panelBean : kenoTwoPurchaseBean</span>
								.getPanelList()) {
<span class="nc" id="L232">							panelStr1.append(&quot;|PickedNumbers:&quot;</span>
									+ panelBean.getPickedNumbers()
									+ &quot;|NoPicked:&quot; + panelBean.getNoPicked()
									+ &quot;|PlayType:&quot; + panelBean.getPlayType()
									+ &quot;|BetAmountMultiple:&quot;
									+ panelBean.getBetAmountMultiple()
									+ &quot;|IsQp:&quot; + panelBean.getIsQp());
<span class="nc" id="L239">						}</span>
					}
<span class="nc bnc" id="L241" title="All 2 branches missed.">					if (kenoTwoPurchaseBean.isRaffle()) {</span>
<span class="nc" id="L242">						raffleData.append(&quot;|isRaffle:&quot;</span>
								+ kenoTwoPurchaseBean.isRaffle()
								+ &quot;|RaffleTicketNumber:&quot;
								+ kenoTwoPurchaseBean.getRaffleData()
										.getTicketNumber());
					}
<span class="nc" id="L248">					logger.debug(resStr + panelStr1 + finalResp + raffleData);</span>
<span class="nc" id="L249">				} else {</span>
<span class="nc" id="L250">					logger.debug(resStr + &quot;|ErrorCode:&quot;</span>
							+ kenoTwoPurchaseBean.getErrorCode());
				}

<span class="nc" id="L254">			} else {</span>
<span class="nc" id="L255">				kenoTwoPurchaseBean.setSuccess(false);</span>
<span class="nc" id="L256">				kenoTwoPurchaseBean.setErrorCode(&quot;102&quot;);// Invalid User</span>
<span class="nc" id="L257">				logger.debug(resStr + &quot;|ErrorCode:&quot;</span>
						+ kenoTwoPurchaseBean.getErrorCode());
			}
		} else {
<span class="nc" id="L261">			kenoTwoPurchaseBean.setSuccess(false);</span>
<span class="nc" id="L262">			kenoTwoPurchaseBean.setErrorCode(&quot;103&quot;);// Please call gameInfo first</span>
<span class="nc" id="L263">			logger.debug(resStr + &quot;|ErrorCode:&quot;</span>
					+ kenoTwoPurchaseBean.getErrorCode());
<span class="nc" id="L265">			return kenoTwoPurchaseBean;</span>
		}

<span class="nc" id="L268">		return kenoTwoPurchaseBean;</span>
		
		
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>