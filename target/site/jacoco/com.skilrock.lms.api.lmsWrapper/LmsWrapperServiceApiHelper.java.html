<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LmsWrapperServiceApiHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.api.lmsWrapper</a> &gt; <span class="el_source">LmsWrapperServiceApiHelper.java</span></div><h1>LmsWrapperServiceApiHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.api.lmsWrapper;

import java.io.IOException;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.TreeMap;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.admin.common.SetResetUserPasswordHelper;
import com.skilrock.lms.api.common.LmsWrapperOrgRegShiftBeanComp;
import com.skilrock.lms.api.lmsWrapper.beans.AgentInfoBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperDrawIdBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperInventoryAssignDataBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperInventoryDetailBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperKenoPurchaseBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperMainPWTDrawBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperOrgRegShiftBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperOrgRegistrationBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperOrganizationRegShiftDataBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperPWTDrawBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperPanelIdBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperPwtApiBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperRetailerInfoBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperRetailerListBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperUserRegistrationBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperVerifyBeforeShiftBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperVerifyBeforeShiftReq;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperVerifyOrgBean;
import com.skilrock.lms.api.lmsWrapper.beans.OrgInvDetails;
import com.skilrock.lms.api.lmsWrapper.common.InventoryHelper;
import com.skilrock.lms.api.lmsWrapper.common.WrapperUtility;
import com.skilrock.lms.beans.AgentRegistrationBean;
import com.skilrock.lms.beans.AvailableServiceBean;
import com.skilrock.lms.beans.HistoryBean;
import com.skilrock.lms.beans.LoginBean;
import com.skilrock.lms.beans.PlayerBean;
import com.skilrock.lms.beans.RetailerRegistrationBean;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.Utility;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.exception.LMSErrors;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.utility.CommonMethods;
import com.skilrock.lms.common.utility.LMSUtility;
import com.skilrock.lms.coreEngine.drawGames.pwtMgmt.BOPwtProcessHelper;
import com.skilrock.lms.coreEngine.inventoryMgmt.ConsNNonConsInvHelper;
import com.skilrock.lms.coreEngine.loginMgmt.common.UserAuthenticationHelper;
import com.skilrock.lms.coreEngine.userMgmt.common.CountryOrgHelper;
import com.skilrock.lms.coreEngine.userMgmt.common.OrgNUserRegHelper;
import com.skilrock.lms.coreEngine.userMgmt.common.OrganizationHelper;
import com.skilrock.lms.dge.beans.DrawIdBean;
import com.skilrock.lms.dge.beans.KenoPurchaseBean;
import com.skilrock.lms.dge.beans.MainPWTDrawBean;
import com.skilrock.lms.dge.beans.PWTDrawBean;
import com.skilrock.lms.dge.beans.PanelIdBean;
import com.skilrock.lms.web.drawGames.common.Util;

<span class="nc" id="L74">public class LmsWrapperServiceApiHelper {</span>
<span class="nc" id="L75">	static Log logger = LogFactory.getLog(LmsWrapperServiceApiHelper.class);</span>
	
	public static void main(String[] args) throws IOException{
<span class="nc" id="L78">		Connection con=DBConnect.getConnection();</span>
<span class="nc" id="L79">		LmsWrapperPWTDrawBean pwtbean =new LmsWrapperPWTDrawBean(); </span>
<span class="nc" id="L80">		LmsWrapperServiceApiHelper help=new LmsWrapperServiceApiHelper();</span>
		
<span class="nc" id="L82">		String[] serNoAll=new String[]{&quot;06277PT10102221&quot;,&quot;06277PT10102230&quot;,&quot;06277PT10102236&quot;,&quot;4354356464656&quot;};</span>
<span class="nc" id="L83">		String[] serNo=new String[4];</span>
<span class="nc" id="L84">		serNo[0]=&quot;06277PT10102221&quot;;</span>
<span class="nc" id="L85">		serNo[1]=&quot;06277PT10102230&quot;;</span>
<span class="nc" id="L86">		serNo[2]=&quot;06277PT10102236&quot;;</span>
		boolean isafg;
<span class="nc bnc" id="L88" title="All 4 branches missed.">		if(pwtbean.isValid() &amp;&amp; pwtbean.isHighPrize()){</span>
<span class="nc" id="L89">			System.out.println(&quot;sfsdf&quot;);</span>
		}
<span class="nc" id="L91">		List&lt;String&gt; dulSerNoList=help.checkDuplicateTerminal(serNo,&quot;1&quot;);</span>
<span class="nc" id="L92">		dulSerNoList.removeAll(Arrays.asList(serNo));</span>
<span class="nc" id="L93">	      System.out.println(dulSerNoList);</span>
<span class="nc" id="L94">	}</span>
	
    public static void onStartWrapperData(){
<span class="nc" id="L97">    	Connection con=DBConnect.getConnection();</span>
    	
<span class="nc" id="L99">    	String wrapperAuthenticateData=&quot;select system_ip,system_username,system_password from st_lms_wrapper_authentication_master&quot;;</span>
    	try{
<span class="nc" id="L101">    		Map&lt;String,String&gt; AuthenticateDataMap=new HashMap&lt;String, String&gt;();</span>
<span class="nc" id="L102">    	Statement stmt=con.createStatement();</span>
<span class="nc" id="L103">    	ResultSet rs=stmt.executeQuery(wrapperAuthenticateData);</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">    	while(rs.next()){</span>
<span class="nc" id="L105">    		AuthenticateDataMap.put(rs.getString(&quot;system_ip&quot;),rs.getString(&quot;system_username&quot;)+&quot;:&quot;+rs.getString(&quot;system_password&quot;));</span>
    	}
<span class="nc" id="L107">    	WrapperUtility.wrapperAuthenticateDataMap=AuthenticateDataMap;</span>
<span class="nc" id="L108">    	System.out.println(&quot;AuthenticateDataMap::&quot;+AuthenticateDataMap);</span>
<span class="nc" id="L109">    	}catch (Exception e) {</span>
			// TODO: handle exception
		}
    	finally {
<span class="nc" id="L113">    		try{</span>
<span class="nc" id="L114">    			con.close();</span>
    		}
<span class="nc" id="L116">    		catch (Exception e) {</span>
				// TODO: handle exception
<span class="nc" id="L118">			}</span>
<span class="nc" id="L119">    	}</span>
<span class="nc" id="L120">    }</span>
	
	
	public List&lt;AgentInfoBean&gt; getAgentList(String listType) {
		
<span class="nc" id="L125">		List&lt;AgentInfoBean&gt; agentInfoList=new ArrayList&lt;AgentInfoBean&gt;();</span>
<span class="nc" id="L126">		Connection con=DBConnect.getConnection();</span>
<span class="nc" id="L127">		String appender = null;</span>
		try {
<span class="nc bnc" id="L129" title="All 2 branches missed.">			if(&quot;ALL&quot;.equals(listType)) {</span>
<span class="nc" id="L130">				appender = &quot; and om.organization_status !='TERMINATE'&quot;;</span>
			} else {
<span class="nc" id="L132">				appender = &quot;&quot;;</span>
			}
<span class="nc" id="L134">			String getAgentQry=&quot;select name,user_id,om.organization_id,(available_credit-claimable_bal) balance from st_lms_organization_master om,st_lms_user_master um where om.organization_type='AGENT' and um.organization_id=om.organization_id&quot;+appender+&quot; group by om.organization_id&quot;;</span>
<span class="nc" id="L135">			System.out.println(&quot;Get agent List Qry::&quot;+getAgentQry);</span>
<span class="nc" id="L136">			Statement stmt=con.createStatement();</span>
<span class="nc" id="L137">			ResultSet rs=stmt.executeQuery(getAgentQry);</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">			while(rs.next()){</span>
<span class="nc" id="L139">				AgentInfoBean agentInfoBean=new AgentInfoBean();</span>
<span class="nc" id="L140">				agentInfoBean.setAgentName(rs.getString(&quot;name&quot;));</span>
<span class="nc" id="L141">				agentInfoBean.setAgentOrgId(rs.getInt(&quot;organization_id&quot;));</span>
<span class="nc" id="L142">				agentInfoBean.setBalance(rs.getString(&quot;balance&quot;));</span>
<span class="nc" id="L143">				agentInfoBean.setUserId(rs.getInt(&quot;user_id&quot;));</span>
<span class="nc" id="L144">				agentInfoList.add(agentInfoBean);</span>
<span class="nc" id="L145">			}</span>
<span class="nc" id="L146">		} catch (SQLException e) {</span>
			
<span class="nc" id="L148">			e.printStackTrace();</span>
		}finally{
<span class="nc" id="L150">			try{</span>
<span class="nc" id="L151">				con.close();</span>
<span class="nc" id="L152">			}catch (Exception e) {</span>
<span class="nc" id="L153">				e.printStackTrace();</span>
<span class="nc" id="L154">			}</span>
<span class="nc" id="L155">		}</span>
<span class="nc" id="L156">		return agentInfoList;</span>
	}
	
	public String getWrapperUserData(){
<span class="nc" id="L160">		String userData=&quot;&quot;;</span>
<span class="nc" id="L161">         Connection con =DBConnect.getConnection();</span>
<span class="nc" id="L162"> 		String fetchuserData=&quot;select organization_id,user_id,organization_type from st_lms_user_master where user_type='wrapper'&quot;;</span>
          try {
<span class="nc" id="L164">			Statement stmt=con.createStatement();</span>
<span class="nc" id="L165">			ResultSet rs=stmt.executeQuery(fetchuserData);</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">			if(rs.next()){</span>
<span class="nc" id="L167">				userData=rs.getInt(&quot;user_id&quot;)+&quot;-&quot;+rs.getInt(&quot;organization_id&quot;)+&quot;-&quot;+rs.getString(&quot;organization_type&quot;);</span>
			}
<span class="nc" id="L169">		} catch (SQLException e) {</span>
			
<span class="nc" id="L171">			e.printStackTrace();</span>
		}finally {
<span class="nc" id="L173">			try{</span>
<span class="nc" id="L174">				con.close();</span>
			}
<span class="nc" id="L176">			catch (Exception e) {</span>
<span class="nc" id="L177">				e.printStackTrace();</span>
<span class="nc" id="L178">			}</span>
<span class="nc" id="L179">		}</span>
          
<span class="nc" id="L181">		return userData;</span>
	}
	public UserInfoBean getUserData(){
<span class="nc" id="L184">		String userName=&quot;&quot;;</span>
<span class="nc" id="L185">		String password=&quot;&quot;;</span>
<span class="nc" id="L186">		Connection con =DBConnect.getConnection();</span>
<span class="nc" id="L187"> 		String fetchuserData=&quot;select user_name,password from st_lms_user_master where user_type='wrapper'&quot;;</span>
          try {
<span class="nc" id="L189">			Statement stmt=con.createStatement();</span>
<span class="nc" id="L190">			ResultSet rs=stmt.executeQuery(fetchuserData);</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">			if(rs.next()){</span>
<span class="nc" id="L192">				userName=rs.getString(&quot;user_name&quot;);</span>
<span class="nc" id="L193">				password=(String)LMSUtility.sc.getAttribute(&quot;WRAPPER_USER_PASSWORD&quot;);</span>
			}
<span class="nc" id="L195">		} catch (SQLException e) {</span>
			
<span class="nc" id="L197">			e.printStackTrace();</span>
		}finally{
<span class="nc" id="L199">			try{</span>
<span class="nc" id="L200">				con.close();</span>
			}
<span class="nc" id="L202">			catch (Exception e) {</span>
<span class="nc" id="L203">				e.printStackTrace();</span>
<span class="nc" id="L204">			}</span>
<span class="nc" id="L205">		}</span>
<span class="nc" id="L206">		UserInfoBean userBean= new UserInfoBean();</span>

		
<span class="nc" id="L209">		LoginBean loginBean = new UserAuthenticationHelper()</span>
				.loginAuthentication(userName, password, &quot;WEB&quot;, &quot;2000&quot;,null,false);
		
<span class="nc bnc" id="L212" title="All 4 branches missed.">		if(&quot;success&quot;.equals(loginBean.getStatus()) || &quot;FirstTime&quot;.equals(loginBean.getStatus())){</span>
<span class="nc" id="L213">			userBean = loginBean.getUserInfo();</span>
	       /* Connection connection = DBConnect.getConnection();
	        try {
				PreparedStatement pstmt = connection.prepareStatement(&quot;select merchant_ip,user_name,password from st_lms_merchant_auth_master where  user_name = ?&quot;);
				pstmt.setString(1, userName);
				ResultSet rs = pstmt.executeQuery();
				String merIp = null;
				String tpPass = null;			
				if(rs.next()){
					merIp = rs.getString(&quot;merchant_ip&quot;);
					tpPass = rs.getString(&quot;password&quot;);
				}
				if(userBean.isTPUser()){
					userBean.setTpIp(merIp);
					userBean.setTpTxnPassword(tpPass);
				}
			} catch (SQLException e) {
				
				e.printStackTrace();
			}	*/
		}else{
<span class="nc" id="L234">			userBean.setStatus(&quot;FAILED&quot;);</span>
<span class="nc" id="L235">			System.out.println(&quot; password does not match&quot;);</span>
<span class="nc" id="L236">			return userBean;</span>
		}
			
<span class="nc" id="L239">		return userBean;</span>
	}
	
	
	
	public UserInfoBean getUserDataFromUserId(int userId){
<span class="nc" id="L245">		UserInfoBean userInfo= null;</span>
<span class="nc" id="L246">		Connection con=DBConnect.getConnection();</span>
<span class="nc" id="L247">		String getUserDataQry=&quot;select user_id,om.organization_id,role_id,parent_user_id,om.organization_type,registration_date,user_name,name,available_credit,credit_limit,claimable_bal,unclaimable_bal,current_credit_amt,organization_status,status,parent_id,pwt_scrap,tp_organization,isrolehead from st_lms_user_master um,st_lms_organization_master om where um.organization_id=om.organization_id and um.user_id=&quot;+userId;</span>
		try{
<span class="nc" id="L249">		Statement stmt=con.createStatement();</span>
<span class="nc" id="L250">		ResultSet rs=stmt.executeQuery(getUserDataQry);</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">		if(rs.next()){</span>
<span class="nc" id="L252">			userInfo = new UserInfoBean();</span>
			
<span class="nc" id="L254">			userInfo.setRoleId(rs.getInt(&quot;role_id&quot;));</span>
<span class="nc" id="L255">			userInfo.setUserId(rs.getInt(&quot;user_id&quot;));</span>
<span class="nc" id="L256">			userInfo.setUserName(rs.getString(&quot;user_name&quot;));</span>
<span class="nc" id="L257">			userInfo.setUserOrgId(rs.getInt(&quot;organization_id&quot;));</span>
<span class="nc" id="L258">			userInfo.setUserType(rs.getString(&quot;om.organization_type&quot;));</span>
<span class="nc" id="L259">			userInfo.setOrgName(rs.getString(&quot;name&quot;));</span>
<span class="nc" id="L260">			userInfo.setAvailableCreditLimit(rs.getDouble(&quot;available_credit&quot;));</span>
<span class="nc" id="L261">			userInfo.setClaimableBal(rs.getDouble(&quot;claimable_bal&quot;));</span>
<span class="nc" id="L262">			userInfo.setUnclaimableBal(rs.getDouble(&quot;unclaimable_bal&quot;));</span>
<span class="nc" id="L263">			userInfo.setCurrentCreditAmt(rs.getDouble(&quot;current_credit_amt&quot;));</span>
<span class="nc" id="L264">			userInfo.setStatus(rs.getString(&quot;status&quot;));</span>
<span class="nc" id="L265">			userInfo.setOrgStatus(rs.getString(&quot;organization_status&quot;));</span>
<span class="nc" id="L266">			userInfo.setPwtSacrap(rs.getString(&quot;pwt_scrap&quot;));</span>
<span class="nc" id="L267">			userInfo.setParentOrgId(rs.getInt(&quot;parent_id&quot;));</span>
<span class="nc" id="L268">			userInfo.setIsRoleHeadUser(rs.getString(&quot;isrolehead&quot;));</span>
			
			
		}
<span class="nc" id="L272">		}catch (Exception e) {</span>
<span class="nc" id="L273">			e.printStackTrace();</span>
			
		}finally{
<span class="nc" id="L276">			try{</span>
<span class="nc" id="L277">				con.close();</span>
<span class="nc" id="L278">			}catch(SQLException e){</span>
<span class="nc" id="L279">				e.printStackTrace();</span>
<span class="nc" id="L280">			}</span>
<span class="nc" id="L281">		}</span>
		
		
<span class="nc" id="L284">		return userInfo;</span>
	}
	
	
	
	public LmsWrapperPwtApiBean verifyDirectPlrTicketNo(UserInfoBean userInfoBean,String ticketNo) throws LMSException{
<span class="nc" id="L290">		 LmsWrapperPwtApiBean pwtApiBean=new LmsWrapperPwtApiBean();</span>
<span class="nc" id="L291">		 boolean isSuccess = true;</span>
		 
<span class="nc" id="L293">		 String pwtAmtForMasterApproval = (String) LMSUtility.sc.getAttribute(&quot;PWT_APPROVAL_LIMIT&quot;);</span>
<span class="nc" id="L294">			String highPrizeScheme = (String) LMSUtility.sc.getAttribute(&quot;DRAW_GAME_HIGH_PRIZE_SCHEME&quot;);</span>
<span class="nc" id="L295">			String highPrizeAmt = (String) LMSUtility.sc.getAttribute(&quot;HIGH_PRIZE_AMT&quot;);</span>
<span class="nc" id="L296">			String refMerchantId = (String) LMSUtility.sc.getAttribute(&quot;REF_MERCHANT_ID&quot;);</span>
<span class="nc" id="L297">			MainPWTDrawBean  mainPwtBean = new MainPWTDrawBean();</span>
<span class="nc" id="L298">			mainPwtBean.setTicketNo(ticketNo.trim());</span>
<span class="nc" id="L299">			logger.debug(&quot;*****ticketNbr***&quot; + ticketNo);</span>
<span class="nc" id="L300">			BOPwtProcessHelper pwtHelper = new BOPwtProcessHelper();</span>
<span class="nc" id="L301">			MainPWTDrawBean pwtWinningBean = pwtHelper.newMethod(mainPwtBean, userInfoBean, pwtAmtForMasterApproval, highPrizeScheme, refMerchantId,highPrizeAmt);</span>
			
<span class="nc bnc" id="L303" title="All 2 branches missed.">			if(&quot;UN_AUTH&quot;.equals(pwtWinningBean.getStatus())) {</span>
<span class="nc" id="L304">				pwtApiBean.setStatus(&quot;-2&quot;);</span>
<span class="nc" id="L305">				return pwtApiBean;</span>
			}
			
<span class="nc bnc" id="L308" title="All 4 branches missed.">			if(&quot;error&quot;.equalsIgnoreCase(pwtWinningBean.getWinningBeanList().get(0).getStatus()) || &quot;ERROR_INVALID&quot;.equals(pwtWinningBean.getStatus())){</span>
<span class="nc" id="L309">				pwtApiBean.setStatus(&quot;ERROR_INVALID&quot;);</span>
<span class="nc" id="L310">				return pwtApiBean;</span>
			}
					
<span class="nc" id="L313">			boolean isMasAppReq = true;</span>
			//pwtWinningBean.setGameDispName(Util.getGameDisplayName(pwtWinningBean
			//		.getGameNo()));
			//session.setAttribute(&quot;PWT_RES&quot;, pwtWinningBean);
			
<span class="nc bnc" id="L318" title="All 2 branches missed.">			for(PWTDrawBean pwtDrawBean : pwtWinningBean.getWinningBeanList()) {</span>
<span class="nc bnc" id="L319" title="All 2 branches missed.">				if(pwtDrawBean.getDrawWinList() != null) {</span>
<span class="nc bnc" id="L320" title="All 2 branches missed.">					for(DrawIdBean drawIdBean : pwtDrawBean.getDrawWinList()) {</span>
<span class="nc bnc" id="L321" title="All 4 branches missed.">						if(drawIdBean.getRankId() == 4 &amp;&amp; &quot;TwelveByTwentyFour&quot;.equals(Util.getGameName(pwtWinningBean.getGameId()))) {</span>
<span class="nc" id="L322">							pwtWinningBean.setStatus(&quot;-1&quot;);</span>
<span class="nc" id="L323">							isSuccess = false;</span>
						}
<span class="nc" id="L325">					}</span>
				}
<span class="nc" id="L327">			}</span>
			
<span class="nc bnc" id="L329" title="All 4 branches missed.">			if (pwtWinningBean.isValid() &amp;&amp; pwtWinningBean.isHighPrize()) {</span>
<span class="nc" id="L330">				pwtApiBean.setTotalTicketPwtAmount(pwtWinningBean.getTotlticketAmount());</span>
				//session.setAttribute(&quot;PWT_AMT&quot;, pwtWinningBean.getTotlticketAmount());
				
<span class="nc bnc" id="L333" title="All 2 branches missed.">				if (&quot;MAS_APP_REQ&quot;.equalsIgnoreCase(pwtWinningBean.getPwtStatus())) {</span>
<span class="nc" id="L334">					isMasAppReq = false;</span>
				}
				
<span class="nc" id="L337">				pwtApiBean.setMessage(&quot;registration&quot;);</span>
			
<span class="nc bnc" id="L339" title="All 6 branches missed.">			} else if (pwtWinningBean.isValid() &amp;&amp; pwtWinningBean.isWinTkt() &amp;&amp; isSuccess) {</span>
<span class="nc" id="L340">				 pwtApiBean= registerAnyPlayer(pwtWinningBean,userInfoBean,pwtApiBean);// register the player as</span>
				
<span class="nc" id="L342">				 String status=pwtApiBean.getStatus();// anonymous</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">				if (status.equals(&quot;SUCCESS&quot;)) {</span>
<span class="nc" id="L344">					pwtApiBean.setMessage(&quot;paySuccess&quot;);</span>
					
				} else {
<span class="nc" id="L347">					pwtApiBean.setMessage(&quot;error&quot;);</span>
<span class="nc" id="L348">					pwtApiBean.setSuccess(false);</span>
				}
<span class="nc" id="L350">			} else {</span>
<span class="nc" id="L351">				pwtApiBean.setMessage(&quot;SUCCESS&quot;);</span>
<span class="nc" id="L352">				pwtApiBean.setSuccess(true);</span>
				
			}
<span class="nc" id="L355">			ArrayList&lt;LmsWrapperPWTDrawBean&gt; lmsPwtBean=new ArrayList&lt;LmsWrapperPWTDrawBean&gt;();</span>
			
<span class="nc bnc" id="L357" title="All 2 branches missed.">			if(pwtWinningBean.getWinningBeanList()!=null){</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">			for(int i=0;i&lt;pwtWinningBean.getWinningBeanList().size();i++){</span>
<span class="nc" id="L359">				List&lt;LmsWrapperDrawIdBean&gt; lmsDrawBean=new ArrayList&lt;LmsWrapperDrawIdBean&gt;();</span>
<span class="nc" id="L360">				PWTDrawBean pwtDrawBean=pwtWinningBean.getWinningBeanList().get(i);</span>
				
<span class="nc bnc" id="L362" title="All 2 branches missed.">				if(pwtDrawBean.getDrawWinList() != null){</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">				for(int j=0;j&lt;pwtDrawBean.getDrawWinList().size();j++){</span>
<span class="nc" id="L364">					DrawIdBean drawBean=pwtDrawBean.getDrawWinList().get(j);</span>
<span class="nc" id="L365">				ArrayList&lt;LmsWrapperPanelIdBean&gt; panelWinList =new ArrayList&lt;LmsWrapperPanelIdBean&gt;();</span>
					
<span class="nc bnc" id="L367" title="All 2 branches missed.">				if(drawBean.getPanelWinList() !=null){</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">				for(int k=0;k&lt;drawBean.getPanelWinList().size();k++){</span>
<span class="nc" id="L369">						PanelIdBean panelBean=drawBean.getPanelWinList().get(k);</span>
<span class="nc" id="L370">						LmsWrapperPanelIdBean lmsWrapperPanelIdBean =new LmsWrapperPanelIdBean();</span>
<span class="nc" id="L371">						lmsWrapperPanelIdBean.setAppReq(panelBean.isAppReq());</span>
<span class="nc" id="L372">						lmsWrapperPanelIdBean.setBetAmtMultiple(panelBean.getBetAmtMultiple());</span>
<span class="nc" id="L373">						lmsWrapperPanelIdBean.setHighLevel(panelBean.isHighLevel());</span>
<span class="nc" id="L374">						lmsWrapperPanelIdBean.setLineId(panelBean.getLineId());</span>
<span class="nc" id="L375">						lmsWrapperPanelIdBean.setMessage(panelBean.getMessage());</span>
<span class="nc" id="L376">						lmsWrapperPanelIdBean.setMessageCode(panelBean.getMessageCode());</span>
<span class="nc" id="L377">						lmsWrapperPanelIdBean.setPanelId(panelBean.getPanelId());</span>
<span class="nc" id="L378">						lmsWrapperPanelIdBean.setPartyId(panelBean.getPartyId());</span>
<span class="nc" id="L379">						lmsWrapperPanelIdBean.setPartyName(panelBean.getPartyName());</span>
<span class="nc" id="L380">						lmsWrapperPanelIdBean.setPickedData(panelBean.getPickedData());</span>
<span class="nc" id="L381">						lmsWrapperPanelIdBean.setPlayType(panelBean.getPlayType());</span>
<span class="nc" id="L382">						lmsWrapperPanelIdBean.setStatus(panelBean.getStatus());</span>
<span class="nc" id="L383">						lmsWrapperPanelIdBean.setValid(panelBean.isValid());</span>
<span class="nc" id="L384">						lmsWrapperPanelIdBean.setVerificationStatus(panelBean.getVerificationStatus());</span>
<span class="nc" id="L385">						lmsWrapperPanelIdBean.setWinningAmt(panelBean.getWinningAmt());</span>
						
<span class="nc" id="L387">						panelWinList.add(lmsWrapperPanelIdBean);</span>
					}
				}
<span class="nc" id="L390">					LmsWrapperDrawIdBean lmsWrapperDrawIdBean =new LmsWrapperDrawIdBean();</span>
<span class="nc" id="L391">					lmsWrapperDrawIdBean.setAppReq(drawBean.isAppReq());</span>
<span class="nc" id="L392">					lmsWrapperDrawIdBean.setClaimedTime(drawBean.getClaimedTime());</span>
<span class="nc" id="L393">					lmsWrapperDrawIdBean.setDrawDateTime(drawBean.getDrawDateTime());</span>
<span class="nc" id="L394">					lmsWrapperDrawIdBean.setDrawId(drawBean.getDrawId());</span>
<span class="nc" id="L395">					lmsWrapperDrawIdBean.setHighLevel(drawBean.isHighLevel());</span>
<span class="nc" id="L396">					lmsWrapperDrawIdBean.setMessage(drawBean.getMessage());</span>
<span class="nc" id="L397">					lmsWrapperDrawIdBean.setMessageCode(drawBean.getMessageCode());</span>
<span class="nc" id="L398">					lmsWrapperDrawIdBean.setPanelWinList(panelWinList);</span>
<span class="nc" id="L399">					lmsWrapperDrawIdBean.setStatus(drawBean.getStatus());</span>
<span class="nc" id="L400">					lmsWrapperDrawIdBean.setTableName(drawBean.getTableName());</span>
<span class="nc" id="L401">					lmsWrapperDrawIdBean.setValid(drawBean.isValid());</span>
<span class="nc" id="L402">					lmsWrapperDrawIdBean.setVerificationStatus(drawBean.getVerificationStatus());</span>
<span class="nc" id="L403">					lmsWrapperDrawIdBean.setWinningAmt(drawBean.getWinningAmt());</span>
<span class="nc" id="L404">					lmsWrapperDrawIdBean.setWinResult(drawBean.getWinResult());</span>
					
<span class="nc" id="L406">					lmsDrawBean.add(lmsWrapperDrawIdBean);</span>
				}
			}
<span class="nc" id="L409">				LmsWrapperPWTDrawBean lmsWrapperPwtDrawBean=new LmsWrapperPWTDrawBean();</span>
				//lmsWrapperPwtDrawBean.setAdvMsg( pwtDrawBean.getAdvMsg());
<span class="nc" id="L411">				lmsWrapperPwtDrawBean.setDrawWinList(lmsDrawBean);</span>
<span class="nc" id="L412">				lmsWrapperPwtDrawBean.setGameDispName(pwtDrawBean.getGameDispName());</span>
<span class="nc" id="L413">				lmsWrapperPwtDrawBean.setGameId(pwtDrawBean.getGameId());</span>
<span class="nc" id="L414">				lmsWrapperPwtDrawBean.setGameNo(pwtDrawBean.getGameNo());</span>
<span class="nc" id="L415">				lmsWrapperPwtDrawBean.setHighPrize(pwtDrawBean.isHighPrize());</span>
<span class="nc" id="L416">				lmsWrapperPwtDrawBean.setPartyId(pwtDrawBean.getPartyId());</span>
<span class="nc" id="L417">				lmsWrapperPwtDrawBean.setPartyType(pwtDrawBean.getPartyType());</span>
<span class="nc" id="L418">				lmsWrapperPwtDrawBean.setPwtStatus(pwtDrawBean.getPwtStatus());</span>
<span class="nc" id="L419">				lmsWrapperPwtDrawBean.setPwtTicketType(pwtDrawBean.getPwtTicketType());</span>
<span class="nc" id="L420">				lmsWrapperPwtDrawBean.setRaffelAssociated(pwtDrawBean.isRaffelAssociated());</span>
			//	lmsWrapperPwtDrawBean.setRaffleDrawIdBeanList(raffleDrawIdBeanList)
<span class="nc" id="L422">				lmsWrapperPwtDrawBean.setRefMerchantId(pwtDrawBean.getRefMerchantId());</span>
<span class="nc" id="L423">				lmsWrapperPwtDrawBean.setReprint(pwtDrawBean.isReprint());</span>
<span class="nc" id="L424">				lmsWrapperPwtDrawBean.setReprintCount(pwtDrawBean.getReprintCount());</span>
<span class="nc" id="L425">				lmsWrapperPwtDrawBean.setResAwaited(pwtDrawBean.isResAwaited());</span>
<span class="nc" id="L426">				lmsWrapperPwtDrawBean.setStatus(pwtDrawBean.getStatus());</span>
<span class="nc" id="L427">				lmsWrapperPwtDrawBean.setTicketNo(pwtDrawBean.getTicketNo());</span>
<span class="nc" id="L428">				lmsWrapperPwtDrawBean.setTotalAmount(pwtDrawBean.getTotalAmount());</span>
<span class="nc" id="L429">				lmsWrapperPwtDrawBean.setUserId(pwtDrawBean.getUserId());</span>
<span class="nc" id="L430">				lmsWrapperPwtDrawBean.setValid(pwtDrawBean.isValid());</span>
<span class="nc" id="L431">				lmsWrapperPwtDrawBean.setWinTkt(pwtDrawBean.isWinTkt());</span>
				
				
<span class="nc" id="L434">				lmsPwtBean.add(lmsWrapperPwtDrawBean);</span>
			}
			
	}			
<span class="nc" id="L438">			LmsWrapperMainPWTDrawBean lmsWrapperPwtWinningBean=new LmsWrapperMainPWTDrawBean();</span>
			//lmsWrapperPwtWinningBean.setAdvMsg(pwtWinningBean.getAdvMsg());
<span class="nc" id="L440">			lmsWrapperPwtWinningBean.setHighPrize(pwtWinningBean.isHighPrize());</span>
<span class="nc" id="L441">			lmsWrapperPwtWinningBean.setIsmPesaEnable(pwtWinningBean.isIsmPesaEnable());</span>
<span class="nc" id="L442">			lmsWrapperPwtWinningBean.setMainTktGameNo(pwtWinningBean.getMainTktGameNo());</span>
<span class="nc" id="L443">			lmsWrapperPwtWinningBean.setMobileNumber(pwtWinningBean.getMobileNumber());</span>
			//lmsWrapperPwtWinningBean.setPurchaseBean((LmsWrapperKenoPurchaseBean) pwtWinningBean.getPurchaseBean());
<span class="nc bnc" id="L445" title="All 2 branches missed.">			if(pwtWinningBean.getPurchaseBean() != null){</span>
<span class="nc" id="L446">				KenoPurchaseBean kenoBean=(KenoPurchaseBean) pwtWinningBean.getPurchaseBean();</span>
<span class="nc" id="L447">				LmsWrapperKenoPurchaseBean wrapperKenoBean=new LmsWrapperKenoPurchaseBean();</span>
<span class="nc" id="L448">				wrapperKenoBean.setAdvMsg(kenoBean.getAdvMsg());</span>
<span class="nc" id="L449">				wrapperKenoBean.setBetAmountMultiple(kenoBean.getBetAmountMultiple());</span>
<span class="nc" id="L450">				wrapperKenoBean.setBonus(kenoBean.getBonus());</span>
<span class="nc" id="L451">				wrapperKenoBean.setDrawDateTime(kenoBean.getDrawDateTime());</span>
<span class="nc" id="L452">				wrapperKenoBean.setDrawIdTableMap(kenoBean.getDrawIdTableMap());</span>
<span class="nc" id="L453">				wrapperKenoBean.setDrawNameList(kenoBean.getDrawNameList());</span>
<span class="nc" id="L454">				wrapperKenoBean.setGame_no(kenoBean.getGame_no());</span>
<span class="nc" id="L455">				wrapperKenoBean.setGameDispName(kenoBean.getGameDispName());</span>
<span class="nc" id="L456">				wrapperKenoBean.setIsAdvancedPlay(kenoBean.getIsAdvancedPlay());</span>
<span class="nc" id="L457">				wrapperKenoBean.setIsQuickPick(kenoBean.getIsQuickPick());</span>
<span class="nc" id="L458">				wrapperKenoBean.setLastSoldTicketNo(kenoBean.getLastSoldTicketNo());</span>
<span class="nc" id="L459">				wrapperKenoBean.setNoOfDraws(kenoBean.getNoOfDraws());</span>
<span class="nc" id="L460">				wrapperKenoBean.setNoOfLines(kenoBean.getNoOfLines());</span>
<span class="nc" id="L461">				wrapperKenoBean.setNoOfPanel(kenoBean.getNoOfPanel());</span>
<span class="nc" id="L462">				wrapperKenoBean.setNoPicked(kenoBean.getNoPicked());</span>
<span class="nc" id="L463">				wrapperKenoBean.setPartyId(kenoBean.getPartyId());</span>
<span class="nc" id="L464">				wrapperKenoBean.setPlayerData(kenoBean.getPlayerData());</span>
<span class="nc" id="L465">				wrapperKenoBean.setPlayerPicked(kenoBean.getPlayerPicked());</span>
<span class="nc" id="L466">				wrapperKenoBean.setPlayType(kenoBean.getPlayType());</span>
<span class="nc" id="L467">				wrapperKenoBean.setPurchaseChannel(kenoBean.getPurchaseChannel());</span>
<span class="nc" id="L468">				wrapperKenoBean.setPurchaseTime(kenoBean.getPurchaseTime());</span>
<span class="nc" id="L469">				wrapperKenoBean.setRaffelAssociated(kenoBean.isRaffelAssociated());</span>
<span class="nc" id="L470">				wrapperKenoBean.setRaffleDrawIdTableMap(kenoBean.getRaffleDrawIdTableMap());</span>
<span class="nc" id="L471">				wrapperKenoBean.setRaffleNo(kenoBean.getRaffleNo());</span>
<span class="nc" id="L472">				wrapperKenoBean.setRefMerchantId(kenoBean.getRefMerchantId());</span>
<span class="nc" id="L473">				wrapperKenoBean.setReprintCount(kenoBean.getReprintCount());</span>
<span class="nc" id="L474">				wrapperKenoBean.setSaleStatus(kenoBean.getSaleStatus());</span>
<span class="nc" id="L475">				wrapperKenoBean.setTicket_no(kenoBean.getTicket_no());</span>
<span class="nc" id="L476">				wrapperKenoBean.setTotalPurchaseAmt(kenoBean.getTotalPurchaseAmt());</span>
<span class="nc" id="L477">				wrapperKenoBean.setUnitPrice(kenoBean.getUnitPrice());</span>
<span class="nc" id="L478">				wrapperKenoBean.setUserId(kenoBean.getUserId());</span>
<span class="nc" id="L479">				wrapperKenoBean.setBarcodeCount(kenoBean.getBarcodeCount());</span>
<span class="nc" id="L480">				wrapperKenoBean.setRetailerName(Util.getOrgNameFromTktNo((kenoBean.getTicket_no() + kenoBean.getReprintCount()),&quot;AGENT&quot;));</span>
<span class="nc" id="L481">				wrapperKenoBean.setExpiryPeriod(Util.getGameMap().get(kenoBean.getGameId()).getTicketExpiryPeriod() );</span>
<span class="nc" id="L482">				wrapperKenoBean.setCurrSymbol((String) LMSUtility.sc.getAttribute(&quot;CURRENCY_SYMBOL&quot;));</span>
<span class="nc" id="L483">				wrapperKenoBean.setOrgAddress((String) LMSUtility.sc.getAttribute(&quot;ORG_ADDRESS&quot;));</span>
<span class="nc" id="L484">				wrapperKenoBean.setOrgName(userInfoBean.getOrgName());</span>
<span class="nc" id="L485">				String ticketExpiryEnabled = (String) LMSUtility.sc.getAttribute(&quot;TICKET_EXPIRY_ENABLED&quot;);</span>
<span class="nc bnc" id="L486" title="All 2 branches missed.">				if (&quot;YES&quot;.equalsIgnoreCase(ticketExpiryEnabled)) {</span>
<span class="nc" id="L487">					wrapperKenoBean.setTicketExpiryEnabled(true);</span>
				}else{
<span class="nc" id="L489">					wrapperKenoBean.setTicketExpiryEnabled(false);</span>
				}
<span class="nc" id="L491">				lmsWrapperPwtWinningBean.setPurchaseBean(wrapperKenoBean);	</span>
			}
			
<span class="nc" id="L494">			lmsWrapperPwtWinningBean.setPwtStatus(pwtWinningBean.getPwtStatus());</span>
<span class="nc" id="L495">			lmsWrapperPwtWinningBean.setPwtTicketType(pwtWinningBean.getPwtTicketType());</span>
<span class="nc" id="L496">			lmsWrapperPwtWinningBean.setRefNumber(pwtWinningBean.getRefNumber());</span>
<span class="nc" id="L497">			lmsWrapperPwtWinningBean.setReprint(pwtWinningBean.isReprint());</span>
<span class="nc" id="L498">			lmsWrapperPwtWinningBean.setStatus(pwtWinningBean.getStatus());</span>
<span class="nc" id="L499">			lmsWrapperPwtWinningBean.setTicketNo(pwtWinningBean.getTicketNo());</span>
<span class="nc" id="L500">			lmsWrapperPwtWinningBean.setTotlticketAmount(pwtWinningBean.getTotlticketAmount());</span>
<span class="nc" id="L501">			lmsWrapperPwtWinningBean.setTransactionIdList(pwtWinningBean.getTransactionIdList());</span>
<span class="nc" id="L502">			lmsWrapperPwtWinningBean.setValid(pwtWinningBean.isValid());</span>
<span class="nc" id="L503">			lmsWrapperPwtWinningBean.setWinningBeanList(lmsPwtBean);</span>
<span class="nc" id="L504">			lmsWrapperPwtWinningBean.setWinTkt(pwtWinningBean.isWinTkt());</span>
<span class="nc" id="L505">			lmsWrapperPwtWinningBean.setOrgName(userInfoBean.getOrgName()+&quot;:&quot;+Util.getOrgNameFromTktNo((pwtWinningBean.getTicketNo()),&quot;AGENT&quot;));</span>
			
<span class="nc" id="L507">			pwtApiBean.setMainPwtDrawBean(lmsWrapperPwtWinningBean);</span>
<span class="nc" id="L508">		 return pwtApiBean;</span>
	}
	public LmsWrapperPwtApiBean registerAnyPlayer(MainPWTDrawBean pwtDrawBean,UserInfoBean userInfoBean,LmsWrapperPwtApiBean pwtApiBean) throws LMSException{

<span class="nc" id="L512">		PlayerBean plrBean = null;</span>
<span class="nc" id="L513">		boolean isAnonymous = true;</span>
		
<span class="nc" id="L515">		Map pwtAppMap = new TreeMap();</span>
<span class="nc" id="L516">		String rootPath =&quot;&quot;;</span>
		
<span class="nc bnc" id="L518" title="All 2 branches missed.">		if (userInfoBean == null) {</span>
<span class="nc" id="L519">			throw new LMSException(&quot;userInfoBean = &quot; + userInfoBean);</span>
		}
		// player registration and approval process
<span class="nc" id="L522">		BOPwtProcessHelper helper = new BOPwtProcessHelper();</span>
<span class="nc" id="L523">		logger.debug(&quot;root path is &quot; + rootPath);</span>
<span class="nc" id="L524">		pwtAppMap = helper.plrRegistrationAndApproval(userInfoBean,</span>
				pwtDrawBean, null, 0, plrBean, rootPath,
				isAnonymous);
<span class="nc" id="L527">		pwtDrawBean=(MainPWTDrawBean) pwtAppMap.get(&quot;PWT_RES_BEAN&quot;);</span>
		
<span class="nc" id="L529">		pwtApiBean.setIsAnonymous(pwtAppMap.get(&quot;isAnonymous&quot;).toString());</span>
<span class="nc" id="L530">		pwtApiBean.setGameName(pwtAppMap.get(&quot;GAME_NAME&quot;).toString());</span>
		
<span class="nc" id="L532">		pwtApiBean.setNetAmountPaid (Double.parseDouble(pwtAppMap.get(&quot;NET_AMOUNT_PAID&quot;).toString()) );</span>
<span class="nc" id="L533">		pwtApiBean.setRecId(pwtAppMap.get(&quot;recId&quot;).toString());</span>
<span class="nc" id="L534">		pwtApiBean.setStatus(&quot;SUCCESS&quot;);</span>
	//	session.setAttribute(&quot;plrPwtAppDetMap&quot;, pwtAppMap);
		//session.setAttribute(&quot;PWT_RES&quot;, pwtAppMap.get(&quot;PWT_RES_BEAN&quot;));

<span class="nc" id="L538">		return pwtApiBean;</span>
	
	}
	
	/*public LinkedList&lt;LmsWrapperOrgRegShiftBean&gt; getOrgRegShiftData(String agentName){
		LinkedList&lt;LmsWrapperOrgRegShiftBean&gt; orgRegShiftBeanList=new LinkedList&lt;LmsWrapperOrgRegShiftBean&gt;();
		try{
		orgRegShiftBeanList=getOrgDataFromAgentName(agentName);
		}
		catch (SQLException se) {
			
		}
		return orgRegShiftBeanList;
	}*/
	
	public LmsWrapperOrganizationRegShiftDataBean getOrgRegShiftData(String agentName) {
<span class="nc" id="L554">		Connection con=DBConnect.getConnection();</span>
<span class="nc" id="L555">		System.out.println(&quot;AGENT NAME::&quot;+agentName);</span>
<span class="nc" id="L556">		LmsWrapperOrganizationRegShiftDataBean orgRegistrationShiftDataBean=new LmsWrapperOrganizationRegShiftDataBean();</span>
<span class="nc bnc" id="L557" title="All 2 branches missed.">		if(WrapperUtility.isTerminateAgent(agentName)){</span>
<span class="nc" id="L558">			orgRegistrationShiftDataBean.setErrorCode(&quot;100&quot;);</span>
<span class="nc" id="L559">			 orgRegistrationShiftDataBean.setSuccess(true);</span>
<span class="nc" id="L560">			return orgRegistrationShiftDataBean;</span>
		}
		
<span class="nc" id="L563">		LinkedList&lt;LmsWrapperOrgRegShiftBean&gt; orgRegShiftBeanList=new LinkedList&lt;LmsWrapperOrgRegShiftBean&gt;();</span>
		
<span class="nc" id="L565">		String organisationData=&quot;select om.organization_id,om.parent_id,name,organization_type,addr_line1,addr_line2,city,state_code,country_code,pin_code,credit_limit,security_deposit,organization_status,vat_registration_nbr,pwt_scrap,recon_report_type,verification_limit,pay_limit,scrap_limit,approval_limit from st_lms_organization_master om,st_lms_oranization_limits ol where (om.name='&quot;+ agentName +&quot;' or om.parent_id in (select organization_id from st_lms_organization_master where name='&quot;+agentName+&quot;')) &quot; </span>
			+&quot;and om.organization_id=ol.organization_id&quot;;
  
		 try{
<span class="nc" id="L569">			Statement stmt=con.createStatement();</span>
<span class="nc" id="L570">			System.out.println(&quot;Get Organization Data::&quot;+organisationData);</span>
<span class="nc" id="L571">			ResultSet rs=stmt.executeQuery(organisationData);</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">			while(rs.next()){</span>
<span class="nc" id="L573">				LmsWrapperOrgRegShiftBean orgRegShiftBean=new LmsWrapperOrgRegShiftBean();</span>
<span class="nc" id="L574">				LmsWrapperOrgRegistrationBean orgRegistrationBean=new LmsWrapperOrgRegistrationBean();</span>
<span class="nc" id="L575">				LmsWrapperUserRegistrationBean userRegistrationBean=new LmsWrapperUserRegistrationBean();</span>
<span class="nc" id="L576">				ArrayList&lt;LmsWrapperInventoryDetailBean&gt; invDeatilBeanList=new ArrayList&lt;LmsWrapperInventoryDetailBean&gt;();</span>
<span class="nc" id="L577">				orgRegistrationBean.setOrgName(rs.getString(&quot;name&quot;));</span>
				
<span class="nc" id="L579">				userRegistrationBean =getuserDataFromAgentName(orgRegistrationBean.getOrgName(),con);</span>
<span class="nc" id="L580">				orgRegShiftBean.setUserRegistrationBean(userRegistrationBean);</span>
				
<span class="nc" id="L582">				orgRegistrationBean.setOrgType(rs.getString(&quot;organization_type&quot;));</span>
<span class="nc" id="L583">				orgRegistrationBean.setAgentName(agentName);</span>
<span class="nc bnc" id="L584" title="All 2 branches missed.">				if(&quot;AGENT&quot;.equalsIgnoreCase(rs.getString(&quot;organization_type&quot;))){</span>
<span class="nc" id="L585">					orgRegistrationBean.setAgtOrgId(rs.getInt(&quot;organization_id&quot;));</span>
				    
				}else{
					
<span class="nc" id="L589">					orgRegistrationBean.setAgtOrgId(rs.getInt(&quot;parent_id&quot;));</span>
<span class="nc" id="L590">					orgRegistrationBean.setOrgId(rs.getInt(&quot;organization_id&quot;));</span>
				}
				
<span class="nc" id="L593">				invDeatilBeanList=getInventoryDataFromOrgId(rs.getString(&quot;organization_id&quot;),orgRegistrationBean.getOrgType(), con);</span>
<span class="nc" id="L594">				orgRegShiftBean.setInvDeatilBeanList(invDeatilBeanList);</span>
				
<span class="nc" id="L596">				orgRegistrationBean.setAddrLine1(rs.getString(&quot;addr_line1&quot;));</span>
<span class="nc" id="L597">				orgRegistrationBean.setAddrLine2(rs.getString(&quot;addr_line2&quot;));</span>
<span class="nc" id="L598">				orgRegistrationBean.setCity(rs.getString(&quot;city&quot;));</span>
				
<span class="nc" id="L600">				Statement stmtCountry=con.createStatement();</span>
<span class="nc" id="L601">				String getCountryAndState=&quot;select ss.name as state_name,cc.name as country_name from st_lms_country_master cc,st_lms_state_master ss where cc.country_code=ss.country_code and cc.country_code='&quot;+rs.getString(&quot;country_code&quot;)+&quot;' and ss.state_code='&quot;+rs.getString(&quot;state_code&quot;)+&quot;'&quot;;</span>
<span class="nc" id="L602">				System.out.println(&quot;Get getCountryAndState Data::&quot;+getCountryAndState);</span>
<span class="nc" id="L603">				ResultSet rsCont=stmtCountry.executeQuery(getCountryAndState);</span>
				
<span class="nc bnc" id="L605" title="All 2 branches missed.">				if(rsCont.next()){</span>
<span class="nc" id="L606">				orgRegistrationBean.setState(rsCont.getString(&quot;state_name&quot;));</span>
<span class="nc" id="L607">				orgRegistrationBean.setCountry(rsCont.getString(&quot;country_name&quot;));</span>
				}
				
<span class="nc" id="L610">				orgRegistrationBean.setPinCode(rs.getString(&quot;pin_code&quot;));</span>
<span class="nc" id="L611">				orgRegistrationBean.setCreditLimit(0.0);</span>
<span class="nc" id="L612">				orgRegistrationBean.setSecurity(0.0);</span>
<span class="nc" id="L613">				orgRegistrationBean.setStatusorg(rs.getString(&quot;organization_status&quot;));</span>
<span class="nc" id="L614">				orgRegistrationBean.setVatRegNo(rs.getString(&quot;vat_registration_nbr&quot;));</span>
<span class="nc" id="L615">				orgRegistrationBean.setReconReportType(rs.getString(&quot;recon_report_type&quot;));</span>
<span class="nc" id="L616">				orgRegistrationBean.setVerLimit(rs.getString(&quot;verification_limit&quot;));</span>
<span class="nc" id="L617">				orgRegistrationBean.setAppLimit(rs.getString(&quot;approval_limit&quot;));</span>
<span class="nc" id="L618">				orgRegistrationBean.setAutoScrap(rs.getString(&quot;pwt_scrap&quot;));</span>
<span class="nc" id="L619">		        orgRegShiftBean.setOrgType(rs.getString(&quot;organization_type&quot;));</span>
<span class="nc" id="L620">		        orgRegShiftBean.setOrgRegistrationBean(orgRegistrationBean);</span>
<span class="nc" id="L621">		        orgRegShiftBean.setOrgName(rs.getString(&quot;name&quot;));</span>
<span class="nc" id="L622">				orgRegShiftBeanList.add(orgRegShiftBean);</span>
<span class="nc" id="L623">			}</span>
<span class="nc" id="L624">			orgRegistrationShiftDataBean.setOrgRegShiftBean(orgRegShiftBeanList);</span>
<span class="nc" id="L625">			orgRegistrationShiftDataBean.setAgentName(agentName);</span>
		 }
<span class="nc" id="L627">		 catch (Exception e) {</span>
<span class="nc" id="L628">			 e.printStackTrace();</span>
<span class="nc" id="L629">			 orgRegistrationShiftDataBean.setSuccess(false);</span>
<span class="nc" id="L630">			 orgRegistrationShiftDataBean.setErrorCode(&quot;500&quot;);</span>
<span class="nc" id="L631">			 return orgRegistrationShiftDataBean;</span>
		}
		 finally{
<span class="nc" id="L634">			 try{</span>
<span class="nc" id="L635">				 con.close();</span>
<span class="nc" id="L636">			 }catch (Exception e) {</span>
<span class="nc" id="L637">				e.printStackTrace();</span>
<span class="nc" id="L638">			}</span>
<span class="nc" id="L639">		 }</span>
<span class="nc" id="L640">		 orgRegistrationShiftDataBean.setErrorCode(&quot;100&quot;);</span>
<span class="nc" id="L641">		 orgRegistrationShiftDataBean.setSuccess(true);</span>
<span class="nc" id="L642">		return orgRegistrationShiftDataBean;</span>
	}
	
	public LmsWrapperOrganizationRegShiftDataBean getOrgRegShiftData(String agentName , String agentUserId) {
<span class="nc" id="L646">		Connection con=DBConnect.getConnection();</span>
<span class="nc" id="L647">		System.out.println(&quot;AGENT NAME::&quot;+agentName);</span>
<span class="nc" id="L648">		LmsWrapperOrganizationRegShiftDataBean orgRegistrationShiftDataBean=new LmsWrapperOrganizationRegShiftDataBean();</span>
<span class="nc bnc" id="L649" title="All 2 branches missed.">		if(WrapperUtility.isTerminateAgent(agentName)){</span>
<span class="nc" id="L650">			orgRegistrationShiftDataBean.setErrorCode(&quot;100&quot;);</span>
<span class="nc" id="L651">			 orgRegistrationShiftDataBean.setSuccess(true);</span>
<span class="nc" id="L652">			return orgRegistrationShiftDataBean;</span>
		}
		
<span class="nc" id="L655">		LinkedList&lt;LmsWrapperOrgRegShiftBean&gt; orgRegShiftBeanList=new LinkedList&lt;LmsWrapperOrgRegShiftBean&gt;();</span>
		
		/*String organisationData=&quot;select om.organization_id,om.parent_id,name,organization_type,addr_line1,addr_line2,city,state_code,country_code,pin_code,credit_limit,security_deposit,organization_status,vat_registration_nbr,pwt_scrap,recon_report_type,verification_limit,pay_limit,scrap_limit,approval_limit from st_lms_organization_master om,st_lms_oranization_limits ol where (om.name='&quot;+ agentName +&quot;' or om.parent_id in (select organization_id from st_lms_organization_master where name='&quot;+agentName+&quot;')) &quot; 
			+&quot;and om.organization_id=ol.organization_id&quot;;*/
		

<span class="nc" id="L661">		String organisationData = &quot;select om.organization_id,om.parent_id,om.org_code,name,organization_type,addr_line1,addr_line2,city,state_code,country_code,pin_code,credit_limit,security_deposit,organization_status,vat_registration_nbr,pwt_scrap,recon_report_type,verification_limit,pay_limit,scrap_limit,approval_limit from st_lms_organization_master om,st_lms_oranization_limits ol , (select a.organization_id from (select organization_id, user_id , organization_type, parent_user_id, user_name from st_lms_user_master where parent_user_id in (select user_id from st_lms_user_master where organization_id in (select organization_id  from st_lms_user_master where user_id  =  '&quot;+agentUserId+&quot;')) and organization_type = 'RETAILER') a inner join st_lms_ret_offline_master b on a.user_id =  b.user_id and serial_number &lt;&gt; '-1' union all select organization_id from st_lms_user_master where user_id  = '&quot;+agentUserId+&quot;') a where om.organization_id=ol.organization_id and ol.organization_id = a.organization_id order by organization_id&quot;; </span>

  
		 try{
<span class="nc" id="L665">			Statement stmt=con.createStatement();</span>
<span class="nc" id="L666">			System.out.println(&quot;Get Organization Data::&quot;+organisationData);</span>
<span class="nc" id="L667">			ResultSet rs=stmt.executeQuery(organisationData);</span>
<span class="nc bnc" id="L668" title="All 2 branches missed.">			while(rs.next()){</span>
<span class="nc" id="L669">				LmsWrapperOrgRegShiftBean orgRegShiftBean=new LmsWrapperOrgRegShiftBean();</span>
<span class="nc" id="L670">				LmsWrapperOrgRegistrationBean orgRegistrationBean=new LmsWrapperOrgRegistrationBean();</span>
<span class="nc" id="L671">				LmsWrapperUserRegistrationBean userRegistrationBean=new LmsWrapperUserRegistrationBean();</span>
<span class="nc" id="L672">				ArrayList&lt;LmsWrapperInventoryDetailBean&gt; invDeatilBeanList=new ArrayList&lt;LmsWrapperInventoryDetailBean&gt;();</span>
<span class="nc" id="L673">				orgRegistrationBean.setOrgName(rs.getString(&quot;name&quot;));</span>
				
<span class="nc" id="L675">				userRegistrationBean =getuserDataFromAgentName(orgRegistrationBean.getOrgName(),con);</span>
<span class="nc" id="L676">				orgRegShiftBean.setUserRegistrationBean(userRegistrationBean);</span>
				
<span class="nc" id="L678">				orgRegistrationBean.setOrgType(rs.getString(&quot;organization_type&quot;));</span>
<span class="nc" id="L679">				orgRegistrationBean.setAgentName(agentName);</span>
<span class="nc bnc" id="L680" title="All 2 branches missed.">				if(&quot;AGENT&quot;.equalsIgnoreCase(rs.getString(&quot;organization_type&quot;))){</span>
<span class="nc" id="L681">					orgRegistrationBean.setAgtOrgId(rs.getInt(&quot;organization_id&quot;));</span>
				    
				}else{
					
<span class="nc" id="L685">					orgRegistrationBean.setAgtOrgId(rs.getInt(&quot;parent_id&quot;));</span>
<span class="nc" id="L686">					orgRegistrationBean.setOrgId(rs.getInt(&quot;organization_id&quot;));</span>
				}
				
<span class="nc" id="L689">				invDeatilBeanList=getInventoryDataFromOrgId(rs.getString(&quot;organization_id&quot;),orgRegistrationBean.getOrgType(), con);</span>
<span class="nc" id="L690">				orgRegShiftBean.setInvDeatilBeanList(invDeatilBeanList);</span>
				
<span class="nc" id="L692">				orgRegistrationBean.setAddrLine1(rs.getString(&quot;addr_line1&quot;));</span>
<span class="nc" id="L693">				orgRegistrationBean.setAddrLine2(rs.getString(&quot;addr_line2&quot;));</span>
<span class="nc" id="L694">				orgRegistrationBean.setCity(rs.getString(&quot;city&quot;));</span>
				
<span class="nc" id="L696">				Statement stmtCountry=con.createStatement();</span>
<span class="nc" id="L697">				String getCountryAndState=&quot;select ss.name as state_name,cc.name as country_name from st_lms_country_master cc,st_lms_state_master ss where cc.country_code=ss.country_code and cc.country_code='&quot;+rs.getString(&quot;country_code&quot;)+&quot;' and ss.state_code='&quot;+rs.getString(&quot;state_code&quot;)+&quot;'&quot;;</span>
<span class="nc" id="L698">				System.out.println(&quot;Get getCountryAndState Data::&quot;+getCountryAndState);</span>
<span class="nc" id="L699">				ResultSet rsCont=stmtCountry.executeQuery(getCountryAndState);</span>
				
<span class="nc bnc" id="L701" title="All 2 branches missed.">				if(rsCont.next()){</span>
<span class="nc" id="L702">				orgRegistrationBean.setState(rsCont.getString(&quot;state_name&quot;));</span>
<span class="nc" id="L703">				orgRegistrationBean.setCountry(rsCont.getString(&quot;country_name&quot;));</span>
				}
				
<span class="nc" id="L706">				orgRegistrationBean.setPinCode(rs.getString(&quot;pin_code&quot;));</span>
<span class="nc" id="L707">				orgRegistrationBean.setCreditLimit(0.0);</span>
<span class="nc" id="L708">				orgRegistrationBean.setSecurity(0.0);</span>
<span class="nc" id="L709">				orgRegistrationBean.setStatusorg(rs.getString(&quot;organization_status&quot;));</span>
<span class="nc" id="L710">				orgRegistrationBean.setVatRegNo(rs.getString(&quot;vat_registration_nbr&quot;));</span>
<span class="nc" id="L711">				orgRegistrationBean.setReconReportType(rs.getString(&quot;recon_report_type&quot;));</span>
<span class="nc" id="L712">				orgRegistrationBean.setVerLimit(rs.getString(&quot;verification_limit&quot;));</span>
<span class="nc" id="L713">				orgRegistrationBean.setAppLimit(rs.getString(&quot;approval_limit&quot;));</span>
<span class="nc" id="L714">				orgRegistrationBean.setAutoScrap(rs.getString(&quot;pwt_scrap&quot;));</span>
<span class="nc" id="L715">		        orgRegShiftBean.setOrgType(rs.getString(&quot;organization_type&quot;));</span>
<span class="nc" id="L716">		        orgRegShiftBean.setOrgRegistrationBean(orgRegistrationBean);</span>
<span class="nc" id="L717">		        orgRegShiftBean.setOrgName(rs.getString(&quot;name&quot;));</span>
<span class="nc" id="L718">		        orgRegistrationBean.setOrgCode(rs.getString(&quot;org_code&quot;));</span>
<span class="nc" id="L719">				orgRegShiftBeanList.add(orgRegShiftBean);</span>
<span class="nc" id="L720">			}</span>
<span class="nc" id="L721">			Collections.sort(orgRegShiftBeanList, new LmsWrapperOrgRegShiftBeanComp());</span>
<span class="nc" id="L722">			orgRegistrationShiftDataBean.setOrgRegShiftBean(orgRegShiftBeanList);</span>
<span class="nc" id="L723">			orgRegistrationShiftDataBean.setAgentName(agentName);</span>
		 }
<span class="nc" id="L725">		 catch (Exception e) {</span>
<span class="nc" id="L726">			 e.printStackTrace();</span>
<span class="nc" id="L727">			 orgRegistrationShiftDataBean.setSuccess(false);</span>
<span class="nc" id="L728">			 orgRegistrationShiftDataBean.setErrorCode(&quot;500&quot;);</span>
<span class="nc" id="L729">			 return orgRegistrationShiftDataBean;</span>
		}
		 finally{
<span class="nc" id="L732">			 try{</span>
<span class="nc" id="L733">				 con.close();</span>
<span class="nc" id="L734">			 }catch (Exception e) {</span>
<span class="nc" id="L735">				e.printStackTrace();</span>
<span class="nc" id="L736">			}</span>
<span class="nc" id="L737">		 }</span>
<span class="nc" id="L738">		 orgRegistrationShiftDataBean.setErrorCode(&quot;100&quot;);</span>
<span class="nc" id="L739">		 orgRegistrationShiftDataBean.setSuccess(true);</span>
<span class="nc" id="L740">		return orgRegistrationShiftDataBean;</span>
	}
	
	public LmsWrapperUserRegistrationBean getuserDataFromAgentName(String orgName,Connection con){
<span class="nc" id="L744">		LmsWrapperUserRegistrationBean userRegistrationBean=new LmsWrapperUserRegistrationBean();</span>
		
<span class="nc" id="L746">		String userData=&quot;select um.user_id,user_name,password,auto_password,secret_ques,secret_ans,first_name,last_name,id_type,id_nbr,email_id,phone_nbr,mobile_nbr from st_lms_user_master um,st_lms_user_contact_details ucd where um.organization_id=(select organization_id from st_lms_organization_master where name='&quot;+orgName+&quot;') and um.user_id=ucd.user_id and isrolehead='Y'&quot;;</span>
  
		 try {
<span class="nc" id="L749">			Statement stmt=con.createStatement();</span>
<span class="nc" id="L750">			System.out.println(&quot;User Data::&quot;+userData);</span>
<span class="nc" id="L751">			ResultSet rs=stmt.executeQuery(userData);</span>
<span class="nc bnc" id="L752" title="All 2 branches missed.">			while(rs.next()){</span>
<span class="nc" id="L753">				userRegistrationBean.setUserName(rs.getString(&quot;user_name&quot;));</span>
<span class="nc" id="L754">				userRegistrationBean.setSecQues(rs.getString(&quot;secret_ques&quot;));</span>
<span class="nc" id="L755">                userRegistrationBean.setSecAns(rs.getString(&quot;secret_ans&quot;));</span>
<span class="nc" id="L756">                userRegistrationBean.setFirstName(rs.getString(&quot;first_name&quot;));</span>
<span class="nc" id="L757">                userRegistrationBean.setLastName(rs.getString(&quot;last_name&quot;));</span>
<span class="nc" id="L758">				userRegistrationBean.setIdNo(rs.getString(&quot;id_nbr&quot;)+rs.getInt(&quot;user_id&quot;));</span>
<span class="nc" id="L759">				userRegistrationBean.setOriIdNo(rs.getString(&quot;id_nbr&quot;));</span>
<span class="nc" id="L760">				userRegistrationBean.setIdType(rs.getString(&quot;id_type&quot;));</span>
<span class="nc" id="L761">				userRegistrationBean.setEmail(rs.getString(&quot;email_id&quot;));</span>
<span class="nc" id="L762">				userRegistrationBean.setPhone(rs.getLong(&quot;phone_nbr&quot;));</span>
<span class="nc" id="L763">				userRegistrationBean.setPassword(rs.getString(&quot;password&quot;));</span>
<span class="nc" id="L764">				userRegistrationBean.setAutoPassword(rs.getInt(&quot;auto_password&quot;));</span>
<span class="nc bnc" id="L765" title="All 2 branches missed.">				if(rs.getString(&quot;mobile_nbr&quot;) != null){</span>
<span class="nc" id="L766">					userRegistrationBean.setMobileNum(rs.getString(&quot;mobile_nbr&quot;));</span>
				}else{
<span class="nc" id="L768">					userRegistrationBean.setMobileNum(&quot;0&quot;);</span>
				}
				
			}
			
			
<span class="nc" id="L774">		} catch (SQLException e) {</span>
			
<span class="nc" id="L776">			e.printStackTrace();</span>
<span class="nc" id="L777">		}</span>
		
		
<span class="nc" id="L780">		return userRegistrationBean;</span>
	}
	
	public ArrayList&lt;LmsWrapperInventoryDetailBean&gt; getInventoryDataFromOrgId(String orgId,String orgType,Connection con){
		
<span class="nc" id="L785">		ArrayList&lt;LmsWrapperInventoryDetailBean&gt; invDataBeanList=new ArrayList&lt;LmsWrapperInventoryDetailBean&gt;();</span>
		
		
<span class="nc" id="L788">		String invData=&quot;select inv_model_id,serial_no,cost_to_bo,is_new,brand_id,inv_id  from (select inv_model_id,serial_no,cost_to_bo,is_new from st_lms_inv_status where current_owner_id= &quot;+orgId+&quot; union all select inv_model_id,serial_no,cost_to_bo,is_new from st_lms_inv_status where current_owner_id in (select organization_id from&quot;</span>
		               + &quot; st_lms_organization_master where parent_id= &quot;+orgId+&quot; ) ) aaa inner join st_lms_inv_model_master mm on aaa.inv_model_id=mm.model_id order by inv_model_id asc&quot;;
  
		 try {
<span class="nc" id="L792">			 HashMap&lt;String,ArrayList&lt;String&gt;&gt; invDetMap=new HashMap&lt;String, ArrayList&lt;String&gt;&gt;();</span>
<span class="nc" id="L793">			Statement stmt=con.createStatement();</span>
<span class="nc" id="L794">			System.out.println(&quot;Get inventory Data From Organization Id::&quot;+invData);</span>
<span class="nc" id="L795">			ResultSet rs=stmt.executeQuery(invData);</span>
<span class="nc bnc" id="L796" title="All 2 branches missed.">			while(rs.next()){</span>
				
<span class="nc" id="L798">				ArrayList&lt;String&gt; serNoList=new ArrayList&lt;String&gt;();</span>
				
<span class="nc bnc" id="L800" title="All 2 branches missed.">				if(invDetMap.get(rs.getString(&quot;inv_model_id&quot;)+&quot;-&quot;+rs.getString(&quot;cost_to_bo&quot;)+&quot;-&quot;+rs.getString(&quot;is_new&quot;)+&quot;-&quot;+rs.getString(&quot;brand_id&quot;)+&quot;-&quot;+rs.getString(&quot;inv_id&quot;)) != null){</span>
<span class="nc" id="L801">					invDetMap.get(rs.getString(&quot;inv_model_id&quot;)+&quot;-&quot;+rs.getString(&quot;cost_to_bo&quot;)+&quot;-&quot;+rs.getString(&quot;is_new&quot;)+&quot;-&quot;+rs.getString(&quot;brand_id&quot;)+&quot;-&quot;+rs.getString(&quot;inv_id&quot;)).add(rs.getString(&quot;serial_no&quot;));</span>
				}else{
					
<span class="nc" id="L804">					serNoList.add(rs.getString(&quot;serial_no&quot;));</span>
<span class="nc" id="L805">				    invDetMap.put(rs.getString(&quot;inv_model_id&quot;)+&quot;-&quot;+rs.getString(&quot;cost_to_bo&quot;)+&quot;-&quot;+rs.getString(&quot;is_new&quot;)+&quot;-&quot;+rs.getString(&quot;brand_id&quot;)+&quot;-&quot;+rs.getString(&quot;inv_id&quot;), serNoList);</span>
<span class="nc" id="L806">				   System.out.println(&quot;Inventor Detail Map for OrgId&quot;+orgId+&quot;:::&quot;+invDetMap);</span>
				}
<span class="nc" id="L808">			}</span>
			
			//set datav to model,brand and inventory map
<span class="nc" id="L811">               InventoryHelper.setInventoryDataToMap();</span>
			
			
<span class="nc" id="L814">			Set&lt;String&gt; invItr=invDetMap.keySet();</span>
<span class="nc bnc" id="L815" title="All 2 branches missed.">			for(String modelinv: invItr){</span>
<span class="nc" id="L816">				LmsWrapperInventoryDetailBean invDataBean=new LmsWrapperInventoryDetailBean();</span>
<span class="nc" id="L817">				invDataBean.setModelId(modelinv.split(&quot;-&quot;)[0]);</span>
<span class="nc" id="L818">				invDataBean.setNonConsModelName(InventoryHelper.modelIdMap.get(modelinv.split(&quot;-&quot;)[0]));</span>
<span class="nc" id="L819">				invDataBean.setCost(Double.parseDouble(modelinv.split(&quot;-&quot;)[1]));</span>
<span class="nc" id="L820">				invDataBean.setIsNew(modelinv.split(&quot;-&quot;)[2]);</span>
<span class="nc" id="L821">				invDataBean.setBrandsId(modelinv.split(&quot;-&quot;)[3]);</span>
<span class="nc" id="L822">				invDataBean.setNonConsBrandName(InventoryHelper.brandIdMap.get(modelinv.split(&quot;-&quot;)[3]));</span>
<span class="nc" id="L823">				invDataBean.setInvId(modelinv.split(&quot;-&quot;)[4]);</span>
<span class="nc" id="L824">				invDataBean.setNonConsInvName(InventoryHelper.inventoryIdMap.get(modelinv.split(&quot;-&quot;)[4]));</span>
<span class="nc" id="L825">				invDataBean.setOrgId(Integer.parseInt(orgId));</span>
<span class="nc" id="L826">				List&lt;String&gt; serNoList=new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L827">				serNoList=invDetMap.get(modelinv);</span>
				//String[] serNo= serNoList.toArray(new String[serNoList.size()]);
<span class="nc" id="L829">				String[] serNo= new String[1];</span>
<span class="nc" id="L830">				serNo[0]=serNoList.toString().replace(&quot;[&quot;, &quot;&quot;).replace(&quot;]&quot;, &quot;&quot;);</span>
<span class="nc" id="L831">				invDataBean.setSerNo(serNo);</span>
				
<span class="nc" id="L833">				invDataBeanList.add(invDataBean);</span>
<span class="nc" id="L834">			}</span>
			
<span class="nc" id="L836">		} catch (SQLException e) {</span>
			
<span class="nc" id="L838">			e.printStackTrace();</span>
<span class="nc" id="L839">		}</span>
		
		
<span class="nc" id="L842">		return invDataBeanList;</span>
	}
	
	public String agentRetailerRegistrationAction(LmsWrapperOrgRegShiftBean orgRegShiftBean){
<span class="nc" id="L846">		String status=&quot;FAILED&quot;;</span>
		
<span class="nc bnc" id="L848" title="All 2 branches missed.">		if(orgRegShiftBean !=null){</span>
							
<span class="nc bnc" id="L850" title="All 2 branches missed.">				if(&quot;AGENT&quot;.equalsIgnoreCase(orgRegShiftBean.getOrgType())){</span>
<span class="nc" id="L851">					status=agentOrgUserReg(orgRegShiftBean);</span>
<span class="nc bnc" id="L852" title="All 2 branches missed.">					if(&quot;FAILED&quot;.equalsIgnoreCase(status)){</span>
<span class="nc" id="L853">						return status;</span>
					}
				}else{
<span class="nc" id="L856">					status=createRetailerOrgAtBO(orgRegShiftBean);</span>
					
<span class="nc bnc" id="L858" title="All 2 branches missed.">					if(&quot;FAILED&quot;.equalsIgnoreCase(status)){</span>
<span class="nc" id="L859">						return status;</span>
					}
				}
			}
<span class="nc" id="L863">		status=&quot;SUCCESS&quot;;</span>
<span class="nc" id="L864">		return status;</span>
		
	}
	
	public String agentOrgUserReg(LmsWrapperOrgRegShiftBean orgRegShiftBean){
<span class="nc" id="L869">		String status=&quot;FAILED&quot;;</span>
<span class="nc" id="L870">		UserInfoBean userInfoBean = getUserData();</span>
<span class="nc bnc" id="L871" title="All 2 branches missed.">		if(&quot;FAILED&quot;.equalsIgnoreCase(userInfoBean.getStatus())){</span>
<span class="nc" id="L872">			return status;</span>
		}
		
<span class="nc" id="L875">		LmsWrapperOrgRegistrationBean orgRegistrationBean=orgRegShiftBean.getOrgRegistrationBean();</span>
<span class="nc" id="L876">		LmsWrapperUserRegistrationBean userRegistrationBean=orgRegShiftBean.getUserRegistrationBean();</span>
<span class="nc" id="L877">		List&lt;LmsWrapperInventoryDetailBean&gt; invDetBeanList=orgRegShiftBean.getInvDeatilBeanList();</span>
		try{
		
			
			
		//set data to agentRegistrationBean
<span class="nc" id="L883">        AgentRegistrationBean agentRegistrationBean=new AgentRegistrationBean();</span>
<span class="nc" id="L884">        agentRegistrationBean.setAddrLine1(orgRegistrationBean.getAddrLine1());</span>
<span class="nc" id="L885">        agentRegistrationBean.setAddrLine2(orgRegistrationBean.getAddrLine2());</span>
<span class="nc" id="L886">        agentRegistrationBean.setAutoScrap(orgRegistrationBean.getAutoScrap());</span>
<span class="nc" id="L887">        agentRegistrationBean.setCity(orgRegistrationBean.getCity());</span>
<span class="nc" id="L888">        agentRegistrationBean.setCountry(orgRegistrationBean.getCountry());</span>
<span class="nc" id="L889">        agentRegistrationBean.setState(orgRegistrationBean.getState());</span>
<span class="nc" id="L890">        agentRegistrationBean.setCreditLimit(orgRegistrationBean.getCreditLimit());</span>
<span class="nc" id="L891">        agentRegistrationBean.setEmail(userRegistrationBean.getEmail());</span>
<span class="nc" id="L892">        Set&lt;Integer&gt; emailPrivIdList=getEmailPrivListId(orgRegistrationBean.getOrgType());</span>
<span class="nc" id="L893">        String[] emailPrivId=new String[emailPrivIdList.size()];</span>
<span class="nc" id="L894">        int count=0;</span>
<span class="nc bnc" id="L895" title="All 2 branches missed.">        for(Integer emPId : emailPrivIdList){</span>
<span class="nc" id="L896">            emailPrivId[count]=emPId.toString();</span>
<span class="nc" id="L897">            count++;</span>
<span class="nc" id="L898">        }</span>
          
<span class="nc" id="L900">        agentRegistrationBean.setEmailPrivId(emailPrivId);</span>
<span class="nc" id="L901">        agentRegistrationBean.setFirstName(userRegistrationBean.getFirstName());</span>
<span class="nc" id="L902">        agentRegistrationBean.setIdNo(userRegistrationBean.getIdNo());</span>
<span class="nc" id="L903">        agentRegistrationBean.setIdType(userRegistrationBean.getIdType());</span>
<span class="nc" id="L904">        agentRegistrationBean.setLastName(userRegistrationBean.getLastName());</span>
<span class="nc" id="L905">        agentRegistrationBean.setOrgName(orgRegistrationBean.getOrgName());</span>
<span class="nc" id="L906">        agentRegistrationBean.setOrgType(orgRegistrationBean.getOrgType());</span>
<span class="nc" id="L907">        agentRegistrationBean.setPhone(userRegistrationBean.getPhone());</span>
<span class="nc" id="L908">        agentRegistrationBean.setMobile(Long.parseLong(userRegistrationBean.getMobileNum()));</span>
<span class="nc" id="L909">        agentRegistrationBean.setSecAns(userRegistrationBean.getSecAns());</span>
<span class="nc" id="L910">        agentRegistrationBean.setSecQues(userRegistrationBean.getSecQues());</span>
<span class="nc" id="L911">        agentRegistrationBean.setUserName(userRegistrationBean.getUserName());</span>
<span class="nc" id="L912">        agentRegistrationBean.setPin(userRegistrationBean.getPin());</span>
<span class="nc" id="L913">        agentRegistrationBean.setSecurity(orgRegistrationBean.getSecurity());</span>
<span class="nc" id="L914">        agentRegistrationBean.setVerLimit((String)LMSUtility.sc.getAttribute(&quot;agtVerLimit&quot;));</span>
<span class="nc" id="L915">        agentRegistrationBean.setPayLimit((String)LMSUtility.sc.getAttribute(&quot;agtPayLimit&quot;));</span>
<span class="nc" id="L916">        agentRegistrationBean.setVatRegNo(orgRegistrationBean.getVatRegNo());</span>
<span class="nc" id="L917">        agentRegistrationBean.setStatusorg(orgRegistrationBean.getStatusorg());</span>
<span class="nc" id="L918">        agentRegistrationBean.setReconReportType(orgRegistrationBean.getReconReportType());</span>
<span class="nc" id="L919">        agentRegistrationBean.setAppLimit((String)LMSUtility.sc.getAttribute(&quot;agtAppLimit&quot;));</span>
<span class="nc" id="L920">        agentRegistrationBean.setScrapLimit((String)LMSUtility.sc.getAttribute(&quot;agtScrapLimit&quot;));</span>
<span class="nc" id="L921">        agentRegistrationBean.setStatus(&quot;ACTIVE&quot;);</span>
<span class="nc" id="L922">        agentRegistrationBean.setMaxPerDayPayLimit(Double.parseDouble(((String)LMSUtility.sc.getAttribute(&quot;MAX_PER_DAY_PAY_LIMIT_FOR_AGENT&quot;))));</span>
<span class="nc" id="L923">        agentRegistrationBean.setSelfClaim(Utility.getPropertyValue(&quot;SELF_CLAIM_AGT&quot;));</span>
<span class="nc" id="L924">        agentRegistrationBean.setOtherClaim(Utility.getPropertyValue(&quot;OTHER_CLAIM_AGT&quot;));</span>
<span class="nc" id="L925">        agentRegistrationBean.setMinClaimPerTicket(Double.parseDouble(Utility.getPropertyValue(&quot;MIN_CLAIM_PER_TICKET_AGT&quot;)));</span>
<span class="nc" id="L926">        agentRegistrationBean.setMaxClaimPerTicket(Double.parseDouble(Utility.getPropertyValue(&quot;MAX_CLAIM_PER_TICKET_AGT&quot;)));</span>
<span class="nc" id="L927">        agentRegistrationBean.setBlockAmt(Double.parseDouble(Utility.getPropertyValue(&quot;BLOCK_AMT&quot;)));</span>
<span class="nc" id="L928">        agentRegistrationBean.setBlockDays(Integer.parseInt(Utility.getPropertyValue(&quot;BLOCK_DAYS&quot;)));</span>
<span class="nc" id="L929">        agentRegistrationBean.setBlockAction(Utility.getPropertyValue(&quot;BLOCK_ACTION&quot;));</span>
<span class="nc" id="L930">        agentRegistrationBean.setRegFrom(&quot;WRAPPER&quot;);</span>
        
<span class="nc" id="L932">        List serviceListBean=fetchService(orgRegistrationBean.getOrgType());</span>
<span class="nc" id="L933">        int[] serviceList=null;</span>
<span class="nc" id="L934">        String[] statusTable=null;</span>
<span class="nc bnc" id="L935" title="All 2 branches missed.">        if(serviceListBean != null){</span>
<span class="nc" id="L936">        	serviceList =new int[serviceListBean.size()];</span>
<span class="nc" id="L937">			statusTable=new String[serviceListBean.size()];</span>
<span class="nc bnc" id="L938" title="All 2 branches missed.">			for(int i=0;i&lt; serviceListBean.size();i++){</span>
<span class="nc" id="L939">				AvailableServiceBean  serviceBean=(AvailableServiceBean) serviceListBean.get(i);</span>
				
<span class="nc" id="L941">				serviceList[i]=serviceBean.getMappingId();</span>
<span class="nc" id="L942">				statusTable[i]=&quot;ACTIVE-&quot;+serviceBean.getPrivRepTable();</span>
			}
		}
        
        
<span class="nc" id="L947">        agentRegistrationBean.setId(serviceList);</span>
<span class="nc" id="L948">        agentRegistrationBean.setStatusTable(statusTable);</span>
<span class="nc" id="L949">		OrgNUserRegHelper helper = new OrgNUserRegHelper();</span>
<span class="nc" id="L950">		Map&lt;String, String&gt; errorMap = helper.createNewAgentOrgNUser(</span>
				userInfoBean, agentRegistrationBean,&quot;BO&quot;);
		
<span class="nc" id="L953">		System.out.println(&quot;*****errorMap&quot; + errorMap);</span>
		
		
		
		
<span class="nc bnc" id="L958" title="All 2 branches missed.">		if (errorMap.containsKey(&quot;returnTypeError&quot;)) {</span>
<span class="nc bnc" id="L959" title="All 2 branches missed.">			if(errorMap.containsValue(&quot;User Name already exists !! !!&quot;)){</span>
<span class="nc" id="L960">				agentRegistrationBean.setUserName(agentRegistrationBean.getUserName()+&quot;_temp&quot;);</span>
<span class="nc" id="L961">				logger.error(&quot; USER Name Already Exists!!&quot;);</span>
<span class="nc bnc" id="L962" title="All 2 branches missed.">			} if (errorMap.containsValue(&quot;Id Number is Already exits !!&quot;)) {</span>
<span class="nc" id="L963">				agentRegistrationBean.setIdNo(agentRegistrationBean.getIdNo()+&quot;_1&quot;);</span>
<span class="nc" id="L964">				logger.error(&quot;Id Number Already Exists!!&quot;);</span>
<span class="nc bnc" id="L965" title="All 2 branches missed.">			} if (errorMap.containsValue(&quot;Organization Name Already exits !!&quot;)) {</span>
<span class="nc" id="L966">				logger.error(&quot;Organization  Already Exists!!&quot;);</span>
<span class="nc" id="L967">				return status;</span>
				//agentRegistrationBean.setOrgName(agentRegistrationBean.getOrgName()+&quot;_1&quot;);
				
			}
			
<span class="nc" id="L972">			errorMap = helper.createNewAgentOrgNUser(</span>
					userInfoBean, agentRegistrationBean,&quot;BO&quot;);
<span class="nc bnc" id="L974" title="All 2 branches missed.">			if (errorMap.containsKey(&quot;returnTypeError&quot;)) {</span>
<span class="nc" id="L975">				return status;</span>
			}
			
		}
		
<span class="nc" id="L980">				status=WrapperUtility.setPassword(agentRegistrationBean.getUserName(), userRegistrationBean.getPassword(),userRegistrationBean.getAutoPassword());</span>
<span class="nc bnc" id="L981" title="All 2 branches missed.">		if(&quot;FAILED&quot;.equalsIgnoreCase(status)){</span>
<span class="nc" id="L982">			return status;</span>
		}
		
		//inventoryUpload for at BO
<span class="nc bnc" id="L986" title="All 4 branches missed.">		if(invDetBeanList !=null &amp;&amp; invDetBeanList.size()&gt;0){</span>
		
<span class="nc" id="L988">			InventoryHelper.setInventoryDataToMap();</span>
			
<span class="nc bnc" id="L990" title="All 2 branches missed.">		for(int j=0;j&lt;invDetBeanList.size();j++){</span>
<span class="nc" id="L991">				LmsWrapperInventoryDetailBean invDetBean=invDetBeanList.get(j);</span>
<span class="nc bnc" id="L992" title="All 2 branches missed.">				if(invDetBean.getOrgId() == orgRegistrationBean.getAgtOrgId()){</span>
					
					
					
					// upload inventory at BO
					
<span class="nc" id="L998">					ConsNNonConsInvHelper helperNonCons = new ConsNNonConsInvHelper();</span>
					
<span class="nc" id="L1000">					String nonConsModelId=InventoryHelper.modelNameMap.get(invDetBean.getNonConsModelName());</span>
<span class="nc" id="L1001">					String nonConsBrandId=InventoryHelper.brandNameMap.get(invDetBean.getNonConsBrandName());</span>
<span class="nc" id="L1002">					String nonConsInvId=InventoryHelper.inventoryNameMap.get(invDetBean.getNonConsInvName());</span>
					
					//check duplicate terminal id
<span class="nc" id="L1005">					List&lt;String&gt; dupSerialNoList=checkDuplicateTerminal(invDetBean.getSerNo(),nonConsModelId);</span>
					
					//change status from REMOVED TO BO
<span class="nc bnc" id="L1008" title="All 2 branches missed.">					if(dupSerialNoList.size()&gt;0){</span>
<span class="nc" id="L1009">					status=WrapperUtility.changeStatusFromRemovedToBo(dupSerialNoList,nonConsModelId);</span>
<span class="nc bnc" id="L1010" title="All 2 branches missed.">					if(&quot;FAILED&quot;.equalsIgnoreCase(status)){</span>
<span class="nc" id="L1011">						return status;</span>
					}
					}
					
<span class="nc" id="L1015">					String[] serialNo=invDetBean.getSerNo();</span>
<span class="nc" id="L1016">					List&lt;String&gt; serialNoList=new LinkedList&lt;String&gt;(Arrays.asList(serialNo[0].split(&quot;,&quot;)));</span>
					
				
<span class="nc bnc" id="L1019" title="All 2 branches missed.">					if(dupSerialNoList.size()&gt;0){</span>
<span class="nc bnc" id="L1020" title="All 2 branches missed.">						for(int k=0;k&lt;dupSerialNoList.size();k++){</span>
<span class="nc" id="L1021">							serialNoList.remove(dupSerialNoList.get(k));</span>
							//dupSerialNoList.remove(serialNoList.get(j));
						}
						
					}
<span class="nc bnc" id="L1026" title="All 4 branches missed.">					if(serialNoList.size()&gt;0 &amp;&amp; serialNoList !=null){</span>
<span class="nc" id="L1027">						String[] serialNoUpload=serialNoList.toArray(new String[serialNoList.size()]);</span>
<span class="nc" id="L1028">					ArrayList arr = helperNonCons.nonConsInvUpload(nonConsModelId+&quot;-&quot;+nonConsBrandId, invDetBean.getCost(), invDetBean.getIsNew(),</span>
							null, serialNoUpload, userInfoBean.getUserId(), userInfoBean
									.getUserOrgId(), userInfoBean.getUserType());
					
					}

					// assign inventory to Agent
					
<span class="nc" id="L1036">					int[] non_cons_inv_id=new int[1];</span>
<span class="nc" id="L1037">					non_cons_inv_id[0]=Integer.parseInt(nonConsInvId);</span>
					
<span class="nc" id="L1039">					int[] non_cons_model_id=new int[1];</span>
<span class="nc" id="L1040">					non_cons_model_id[0]=Integer.parseInt(nonConsModelId);</span>
			
<span class="nc" id="L1042">					int[] non_cons_brand_id=new int[1];</span>
<span class="nc" id="L1043">					non_cons_brand_id[0]=Integer.parseInt(nonConsBrandId);</span>
					
<span class="nc" id="L1045">					int[] consInvId =new int[1];</span>
<span class="nc" id="L1046">					consInvId[0]=-1;</span>
					
<span class="nc" id="L1048">					int[] consModelId=new int[1];</span>
<span class="nc" id="L1049">					consModelId[0]=-1;</span>
					
<span class="nc" id="L1051">					int[] consQty=new int[1];</span>
					
<span class="nc" id="L1053">					int agentOrgId=WrapperUtility.getAgentIdFromAgentName(orgRegistrationBean.getAgentName());</span>
					
<span class="nc" id="L1055">					int DNID = helperNonCons.assignConsNNonConsInv(</span>
							userInfoBean.getUserOrgId(), userInfoBean.getUserId(), orgRegistrationBean.getOrgType(),
							agentOrgId, -1, non_cons_inv_id, non_cons_model_id,
							non_cons_brand_id, invDetBean.getSerNo(), consInvId, consModelId, null,
							userInfoBean.getUserType());
					
					
				}
			}
		}
		
		
		/*if (errorMap.containsKey(&quot;returnTypeError&quot;)) {
			//session.setAttribute(&quot;ORGANIZATION_NAME&quot;, this.getOrgName());
			//session.setAttribute(&quot;USER_NAME&quot;, this.getUserName());
			//return SUCCESS;
		} else {
			//this.errorMap = errorMap;
			logger.error(&quot;Organization and USER Name Already Exists!!&quot;);
			logger.debug(&quot;Organization and USER Name Already Exists!!&quot;);
			//return INPUT;
		}*/
		}
<span class="nc" id="L1078">		catch (Exception e) {</span>
<span class="nc" id="L1079">			e.printStackTrace();</span>
<span class="nc" id="L1080">			return status;</span>
<span class="nc" id="L1081">		}</span>
<span class="nc" id="L1082">		status=&quot;SUCCESS&quot;;</span>
<span class="nc" id="L1083">		return status;</span>
	}
	
	public Set&lt;Integer&gt; getEmailPrivListId(String privType) throws IOException {
		// get the email mailing privilege list from database
		
<span class="nc" id="L1089">		OrganizationHelper orgReg = new OrganizationHelper();</span>
<span class="nc" id="L1090">		Map&lt;Integer, String&gt; reportTypeTitleMap = orgReg</span>
				.getMailingReportTitle(privType);
<span class="nc" id="L1092">		logger.debug(&quot;Inside getEmailPrivListId&quot;);</span>
<span class="nc" id="L1093">		logger.debug(&quot;email privilege list in orgnization creation == &quot;</span>
				+ reportTypeTitleMap);
<span class="nc" id="L1095">		Set&lt;Integer&gt; emailPrivIdList=reportTypeTitleMap.keySet();</span>
<span class="nc" id="L1096">      return emailPrivIdList;</span>
	}
	
	public List fetchService(String userType) {
		
<span class="nc" id="L1101">		logger.info(&quot;********User Services Fatch**********&quot;);</span>
<span class="nc" id="L1102">		CountryOrgHelper country = new CountryOrgHelper();</span>
<span class="nc" id="L1103">		List serviceListBean=country.getAvlSerInterface(userType);</span>
		
		
<span class="nc" id="L1106">		return serviceListBean;</span>
	}
	
	public String createRetailerOrgAtBO(LmsWrapperOrgRegShiftBean orgRegShiftBean){
<span class="nc" id="L1110">		String status=&quot;FAILED&quot;;</span>
<span class="nc" id="L1111">		String terminalId=null;</span>
<span class="nc" id="L1112">		String modelName=null;</span>
<span class="nc" id="L1113">		 String sim[]=null;</span>
<span class="nc" id="L1114">		 String simModelName[]=null;</span>
<span class="nc" id="L1115">		UserInfoBean agtInfoBean = null;</span>
<span class="nc" id="L1116">		LmsWrapperOrgRegistrationBean orgRegistrationBean=orgRegShiftBean.getOrgRegistrationBean();</span>
<span class="nc" id="L1117">		LmsWrapperUserRegistrationBean userRegistrationBean=orgRegShiftBean.getUserRegistrationBean();</span>
<span class="nc" id="L1118">		List&lt;LmsWrapperInventoryDetailBean&gt; invDetBeanList=orgRegShiftBean.getInvDeatilBeanList();</span>
		try{
		//set data to retailerRegistrationBean
<span class="nc" id="L1121">		RetailerRegistrationBean retailerRegistrationBean=new RetailerRegistrationBean();</span>
<span class="nc" id="L1122">		retailerRegistrationBean.setAddrLine1(orgRegistrationBean.getAddrLine1());</span>
<span class="nc" id="L1123">		retailerRegistrationBean.setAddrLine2(orgRegistrationBean.getAddrLine2());</span>
<span class="nc" id="L1124">		retailerRegistrationBean.setAgtOrgId(orgRegistrationBean.getAgtOrgId());</span>
<span class="nc" id="L1125">		retailerRegistrationBean.setAppLimit((String)LMSUtility.sc.getAttribute(&quot;agtAppLimit&quot;));</span>
<span class="nc" id="L1126">		retailerRegistrationBean.setAutoScrap(orgRegistrationBean.getAutoScrap());</span>
<span class="nc" id="L1127">		retailerRegistrationBean.setCity(orgRegistrationBean.getCity());</span>
<span class="nc" id="L1128">		retailerRegistrationBean.setCountry(orgRegistrationBean.getCountry());</span>
<span class="nc" id="L1129">		retailerRegistrationBean.setCreditLimit(orgRegistrationBean.getCreditLimit());</span>
<span class="nc" id="L1130">		retailerRegistrationBean.setEmail(userRegistrationBean.getEmail());</span>
<span class="nc" id="L1131">		retailerRegistrationBean.setIsRetailerOnline(&quot;NO&quot;);</span>
<span class="nc" id="L1132">		Set&lt;Integer&gt; emailPrivIdList=getEmailPrivListId(orgRegistrationBean.getOrgType());</span>
<span class="nc" id="L1133">        String[] emailPrivId=new String[emailPrivIdList.size()];</span>
<span class="nc" id="L1134">        int count=0;</span>
<span class="nc bnc" id="L1135" title="All 2 branches missed.">        for(Integer emPId : emailPrivIdList){</span>
<span class="nc" id="L1136">            emailPrivId[count]=emPId.toString();</span>
<span class="nc" id="L1137">            count++;</span>
<span class="nc" id="L1138">        }</span>
<span class="nc" id="L1139">		retailerRegistrationBean.setEmailPrivId(emailPrivId);</span>
<span class="nc" id="L1140">		retailerRegistrationBean.setFirstName(userRegistrationBean.getFirstName());</span>
		
<span class="nc" id="L1142">		retailerRegistrationBean.setIdNo(userRegistrationBean.getIdNo());</span>
<span class="nc" id="L1143">		retailerRegistrationBean.setIdType(userRegistrationBean.getIdType());</span>
<span class="nc" id="L1144">		retailerRegistrationBean.setIsOffLine(&quot;NO&quot;);</span>
<span class="nc" id="L1145">		retailerRegistrationBean.setLastName(userRegistrationBean.getLastName());</span>
		
<span class="nc" id="L1147">		retailerRegistrationBean.setOlaDepositLimit((String)LMSUtility.sc.getAttribute(&quot;retDepositLimit&quot;));</span>
<span class="nc" id="L1148">		retailerRegistrationBean.setOlaWithdrawalLimit((String)LMSUtility.sc.getAttribute(&quot;olaWithdrawalLimit&quot;));</span>
<span class="nc" id="L1149">		retailerRegistrationBean.setOrgName(orgRegistrationBean.getOrgName());</span>
<span class="nc" id="L1150">		retailerRegistrationBean.setOrgType(orgRegistrationBean.getOrgType());</span>
<span class="nc" id="L1151">		retailerRegistrationBean.setPayLimit((String)LMSUtility.sc.getAttribute(&quot;agtPayLimit&quot;));</span>
<span class="nc" id="L1152">		retailerRegistrationBean.setPhone(userRegistrationBean.getPhone());</span>
<span class="nc" id="L1153">		retailerRegistrationBean.setMobile(Long.parseLong(userRegistrationBean.getMobileNum()));</span>
<span class="nc" id="L1154">		retailerRegistrationBean.setPin(userRegistrationBean.getPin());</span>
<span class="nc" id="L1155">		retailerRegistrationBean.setPntId(userRegistrationBean.getPntId());</span>
<span class="nc" id="L1156">		retailerRegistrationBean.setReconReportType(orgRegistrationBean.getReconReportType());</span>
<span class="nc" id="L1157">		retailerRegistrationBean.setScrapLimit((String)LMSUtility.sc.getAttribute(&quot;agtScrapLimit&quot;));</span>
<span class="nc" id="L1158">		retailerRegistrationBean.setSecAns(userRegistrationBean.getSecAns());</span>
<span class="nc" id="L1159">		retailerRegistrationBean.setSecQues(userRegistrationBean.getSecQues());</span>
<span class="nc" id="L1160">		retailerRegistrationBean.setSecurity(orgRegistrationBean.getSecurity());</span>
<span class="nc" id="L1161">		retailerRegistrationBean.setState(orgRegistrationBean.getState());</span>
<span class="nc" id="L1162">		retailerRegistrationBean.setStatus(&quot;ACTIVE&quot;);</span>
<span class="nc" id="L1163">		retailerRegistrationBean.setStatusorg(orgRegistrationBean.getStatusorg());</span>
<span class="nc" id="L1164">		retailerRegistrationBean.setMaxPerDayPayLimit(Double.parseDouble(((String)LMSUtility.sc.getAttribute(&quot;MAX_PER_DAY_PAY_LIMIT_FOR_RET&quot;))));</span>
<span class="nc" id="L1165">		retailerRegistrationBean.setSelfClaim(Utility.getPropertyValue(&quot;SELF_CLAIM_RET&quot;));</span>
<span class="nc" id="L1166">		retailerRegistrationBean.setOtherClaim(Utility.getPropertyValue(&quot;OTHER_CLAIM_RET&quot;));</span>
<span class="nc" id="L1167">		retailerRegistrationBean.setMinClaimPerTicket(Double.parseDouble(Utility.getPropertyValue(&quot;MIN_CLAIM_PER_TICKET_RET&quot;)));</span>
<span class="nc" id="L1168">		retailerRegistrationBean.setMaxClaimPerTicket(Double.parseDouble(Utility.getPropertyValue(&quot;MAX_CLAIM_PER_TICKET_RET&quot;)));</span>
<span class="nc" id="L1169">		retailerRegistrationBean.setBlockAmt(Double.parseDouble(Utility.getPropertyValue(&quot;BLOCK_AMT&quot;)));</span>
<span class="nc" id="L1170">		retailerRegistrationBean.setBlockDays(Integer.parseInt(Utility.getPropertyValue(&quot;BLOCK_DAYS&quot;)));</span>
<span class="nc" id="L1171">		retailerRegistrationBean.setBlockAction(Utility.getPropertyValue(&quot;BLOCK_ACTION&quot;));</span>
<span class="nc" id="L1172">		 List serviceListBean=fetchService(orgRegistrationBean.getOrgType());</span>
<span class="nc" id="L1173">	        int[] serviceList=null;</span>
<span class="nc" id="L1174">	        String[] statusTable=null;</span>
<span class="nc bnc" id="L1175" title="All 2 branches missed.">	        if(serviceListBean != null){</span>
<span class="nc" id="L1176">	        	serviceList =new int[serviceListBean.size()];</span>
<span class="nc" id="L1177">				statusTable=new String[serviceListBean.size()];</span>
<span class="nc bnc" id="L1178" title="All 2 branches missed.">				for(int i=0;i&lt; serviceListBean.size();i++){</span>
<span class="nc" id="L1179">					AvailableServiceBean  serviceBean=(AvailableServiceBean) serviceListBean.get(i);</span>
					
<span class="nc" id="L1181">					serviceList[i]=serviceBean.getMappingId();</span>
<span class="nc" id="L1182">					statusTable[i]=&quot;ACTIVE-&quot;+serviceBean.getPrivRepTable();</span>
				}
			}
	        
	        
<span class="nc" id="L1187">		retailerRegistrationBean.setId(serviceList);</span>
<span class="nc" id="L1188">		retailerRegistrationBean.setStatusTable(statusTable);</span>
		
		
<span class="nc" id="L1191">		retailerRegistrationBean.setUserName(userRegistrationBean.getUserName());</span>
<span class="nc" id="L1192">		retailerRegistrationBean.setVatRegNo(orgRegistrationBean.getVatRegNo());</span>
<span class="nc" id="L1193">		retailerRegistrationBean.setVerLimit((String)LMSUtility.sc.getAttribute(&quot;agtVerLimit&quot;));</span>
	
<span class="nc bnc" id="L1195" title="All 2 branches missed.">		if(&quot;YES&quot;.equalsIgnoreCase(Utility.getPropertyValue(&quot;sim_binding&quot;))){</span>
<span class="nc" id="L1196">			sim =orgRegistrationBean.getSim();</span>
<span class="nc" id="L1197">			simModelName=orgRegistrationBean.getSimModelName();</span>
<span class="nc bnc" id="L1198" title="All 2 branches missed.">			if(isValidSim(sim,simModelName)){</span>
<span class="nc" id="L1199">				retailerRegistrationBean.setSim(sim);</span>
<span class="nc" id="L1200">				retailerRegistrationBean.setSimModelName(simModelName);</span>
			}else{
		
<span class="nc" id="L1203">				logger.debug(&quot;Invalid Sim Input&quot;);</span>
<span class="nc" id="L1204">				return status;</span>
			}
			
		
		}
<span class="nc bnc" id="L1209" title="All 2 branches missed.">		if(invDetBeanList !=null){</span>
<span class="nc bnc" id="L1210" title="All 2 branches missed.">			for(int j=0;j&lt;invDetBeanList.size();j++){</span>
<span class="nc" id="L1211">				LmsWrapperInventoryDetailBean invDetBean=invDetBeanList.get(j);</span>
<span class="nc bnc" id="L1212" title="All 2 branches missed.">				if(invDetBean.getOrgId() == orgRegistrationBean.getOrgId()){</span>
<span class="nc" id="L1213">					terminalId=invDetBean.getSerNo()[0];</span>
<span class="nc" id="L1214">					modelName=invDetBean.getNonConsModelName();</span>
				}
			}
		}
<span class="nc" id="L1218">		retailerRegistrationBean.setTerminalId(terminalId);</span>
<span class="nc" id="L1219">		retailerRegistrationBean.setModelName(modelName);</span>
		
<span class="nc" id="L1221">		Map&lt;String, String&gt; errorMap = null;</span>
<span class="nc" id="L1222">		OrgNUserRegHelper helper = new OrgNUserRegHelper();</span>
<span class="nc" id="L1223">		logger.info(&quot;---------------Check BAL&quot;);</span>
<span class="nc" id="L1224">		System.out.println(&quot;---------------Check BAL&quot;);</span>
		// get agent Org id from agent name
<span class="nc" id="L1226">		int agentOrgId=WrapperUtility.getAgentIdFromAgentName(orgRegistrationBean.getAgentName());</span>
<span class="nc" id="L1227">		String errMsg = CommonMethods.chkCreditLimitAgt(agentOrgId, orgRegistrationBean.getCreditLimit());</span>

<span class="nc bnc" id="L1229" title="All 2 branches missed.">		if (!&quot;TRUE&quot;.equals(errMsg)) {</span>
<span class="nc" id="L1230">			errorMap  = new HashMap&lt;String, String&gt;();</span>
<span class="nc" id="L1231">			errorMap.put(&quot;orgError&quot;, errMsg);</span>
			//this.errorMap = errorMap;
			//return INPUT;
		}

		// create agent info bean
<span class="nc" id="L1237">		agtInfoBean = helper.createAgtBean(agentOrgId);</span>
<span class="nc" id="L1238">		System.out</span>
				.println( &quot;*******verLimit***&quot; + orgRegistrationBean.getVerLimit());
<span class="nc" id="L1240">		errorMap = helper.createNewRetailerOrgNUser(agtInfoBean, retailerRegistrationBean,&quot;BO&quot;);</span>
<span class="nc" id="L1241">		System.out.println(&quot;*****errorMap&quot; + errorMap);</span>
		
		
		
		
<span class="nc bnc" id="L1246" title="All 2 branches missed.">		if (errorMap.containsKey(&quot;returnTypeError&quot;)) {</span>
<span class="nc bnc" id="L1247" title="All 2 branches missed.">			if(errorMap.containsValue(&quot;User Name already exists !! !!&quot;)){</span>
<span class="nc" id="L1248">				retailerRegistrationBean.setUserName(retailerRegistrationBean.getUserName()+&quot;_temp&quot;);</span>
<span class="nc" id="L1249">				logger.error(&quot; USER Name Already Exists!!&quot;);</span>
<span class="nc bnc" id="L1250" title="All 2 branches missed.">			} if (errorMap.containsValue(&quot;Id Number is Already exits !!&quot;)) {</span>
<span class="nc" id="L1251">				retailerRegistrationBean.setIdNo(retailerRegistrationBean.getIdNo()+&quot;_1&quot;);</span>
<span class="nc" id="L1252">				logger.error(&quot;Id Number Already Exists!!&quot;);</span>
<span class="nc bnc" id="L1253" title="All 2 branches missed.">			} if (errorMap.containsValue(&quot;Organization Name Already exits !!&quot;)) {</span>
<span class="nc" id="L1254">				retailerRegistrationBean.setOrgName(retailerRegistrationBean.getOrgName()+&quot;_1&quot;);</span>
<span class="nc" id="L1255">				logger.error(&quot;Organization  Already Exists!!&quot;);</span>
			}
			
<span class="nc" id="L1258">			errorMap = helper.createNewRetailerOrgNUser(agtInfoBean, retailerRegistrationBean,&quot;BO&quot;);</span>

<span class="nc bnc" id="L1260" title="All 2 branches missed.">			if (errorMap.containsKey(&quot;returnTypeError&quot;)) {</span>
<span class="nc" id="L1261">				return status;</span>
			}
			
		}
		
		// update password of retailer
<span class="nc" id="L1267">					status=WrapperUtility.setPassword(retailerRegistrationBean.getUserName(), userRegistrationBean.getPassword(),userRegistrationBean.getAutoPassword());</span>
<span class="nc bnc" id="L1268" title="All 2 branches missed.">					if(&quot;FAILED&quot;.equalsIgnoreCase(status)){</span>
<span class="nc" id="L1269">						return status;</span>
					}
	/*	System.out.println(&quot;*****errorMap&quot; + errorMap);
		
		if(errorMap.containsValue(&quot;User Name already exists !! !!&quot;)){
			retailerRegistrationBean.setUserName(retailerRegistrationBean.getUserName()+&quot;_1&quot;);
			errorMap = helper.createNewRetailerOrgNUser(agtInfoBean, retailerRegistrationBean,&quot;BO&quot;);
			// update password of retailer
			status=WrapperUtility.setPassword(retailerRegistrationBean.getUserName(), userRegistrationBean.getPassword(),userRegistrationBean.getAutoPassword());
			if(&quot;FAILED&quot;.equalsIgnoreCase(status)){
				return status;
			}
		}else{
			// update password of retailer
			status=WrapperUtility.setPassword(retailerRegistrationBean.getUserName(), userRegistrationBean.getPassword(),userRegistrationBean.getAutoPassword());
			if(&quot;FAILED&quot;.equalsIgnoreCase(status)){
				return status;
			}
		}
		 */
		
<span class="nc bnc" id="L1290" title="All 2 branches missed.">		if (!errorMap.containsKey(&quot;returnTypeError&quot;)) {</span>
<span class="nc bnc" id="L1291" title="All 2 branches missed.">			if (terminalId != null) {</span>
<span class="nc" id="L1292">				helper.assignInventoryToRetailer(agtInfoBean,retailerRegistrationBean);</span>
			}

		//	session.setAttribute(&quot;ORGANIZATION_NAME&quot;, this.getOrgName());
			//session.setAttribute(&quot;USER_NAME&quot;, this.getUserName().toLowerCase());
			//session.setAttribute(&quot;RETAILER_PASSWORD&quot;, errorMap
					//.get(&quot;NewPassword&quot;));
			//return SUCCESS;
		} else {
		//	this.errorMap = errorMap;
			/*logger.error(&quot;Organization and USER Name Already Exists!!&quot;);
			System.out.println(&quot;Organization and USER Name Already Exists!!&quot;);*/
			//return INPUT;
		}
		}	
<span class="nc" id="L1307">     catch (Exception e) {</span>
<span class="nc" id="L1308">         return status;</span>
<span class="nc" id="L1309">  }</span>
<span class="nc" id="L1310">     status=&quot;SUCCESS&quot;;</span>
<span class="nc" id="L1311">     return status;</span>
	}


	
	public LmsWrapperRetailerListBean getRetailerListBean(String agentUserId) {
<span class="nc" id="L1317">		LmsWrapperRetailerListBean retailerListBean=new LmsWrapperRetailerListBean();</span>
<span class="nc" id="L1318">		List&lt;LmsWrapperRetailerInfoBean&gt; retailerInfoList=new ArrayList&lt;LmsWrapperRetailerInfoBean&gt;();</span>
<span class="nc" id="L1319">		Connection con=DBConnect.getConnection();</span>
		try {
			//String getRetailerQry=&quot;select name,user_id,om.organization_id,(available_credit-claimable_bal) balance,organization_status from st_lms_organization_master om,st_lms_user_master um where om.organization_type='RETAILER' and um.organization_id=om.organization_id and um.parent_user_id = &quot;+agentUserId+&quot; group by om.organization_id&quot;;
<span class="nc" id="L1322">			String getRetailerQry =  &quot;select name,a.user_id,a.organization_id, balance,organization_status  from (select name,user_id,om.organization_id,(available_credit-claimable_bal) balance,organization_status from st_lms_organization_master om,st_lms_user_master um where om.organization_type='RETAILER' and um.organization_id=om.organization_id and um.parent_user_id in (select user_id from st_lms_user_master where organization_id in (select organization_id  from st_lms_user_master where user_id  =  &quot;+agentUserId+&quot;))  group by om.organization_id) a inner join st_lms_ret_offline_master b on a.user_id =  b.user_id and serial_number &lt;&gt; '-1'&quot;;</span>
<span class="nc" id="L1323">			Statement stmt=con.createStatement();</span>
<span class="nc" id="L1324">			System.out.println(&quot;Get Retailer Qry From Agent UserId::&quot;+getRetailerQry);</span>
<span class="nc" id="L1325">			ResultSet rs=stmt.executeQuery(getRetailerQry);</span>
<span class="nc bnc" id="L1326" title="All 2 branches missed.">			while(rs.next()){</span>
<span class="nc" id="L1327">				LmsWrapperRetailerInfoBean retailerInfoBean=new LmsWrapperRetailerInfoBean();</span>
<span class="nc" id="L1328">				retailerInfoBean.setRetailerName(rs.getString(&quot;name&quot;));</span>
<span class="nc" id="L1329">				retailerInfoBean.setRetailerOrgId(rs.getInt(&quot;organization_id&quot;));</span>
<span class="nc" id="L1330">				retailerInfoBean.setBalance(rs.getDouble(&quot;balance&quot;));</span>
<span class="nc" id="L1331">				retailerInfoBean.setUserId(rs.getInt(&quot;user_id&quot;));</span>
<span class="nc" id="L1332">				retailerInfoBean.setStatus(rs.getString(&quot;organization_status&quot;));</span>
<span class="nc" id="L1333">				retailerInfoList.add(retailerInfoBean);</span>
<span class="nc" id="L1334">			}</span>
<span class="nc" id="L1335">			retailerListBean.setRetailerInfoBean(retailerInfoList);</span>
<span class="nc" id="L1336">		} catch (SQLException e) {</span>
<span class="nc" id="L1337">			e.printStackTrace();</span>
<span class="nc" id="L1338">			retailerListBean.setSuccess(false);</span>
<span class="nc" id="L1339">			retailerListBean.setErrorCode(&quot;500&quot;);</span>
<span class="nc" id="L1340">			return retailerListBean;</span>
		}finally{
<span class="nc" id="L1342">			try{</span>
<span class="nc" id="L1343">				con.close();</span>
<span class="nc" id="L1344">			}catch (Exception e) {</span>
<span class="nc" id="L1345">				e.printStackTrace();</span>
<span class="nc" id="L1346">			}</span>
<span class="nc" id="L1347">		}</span>
<span class="nc" id="L1348">		retailerListBean.setSuccess(true);</span>
<span class="nc" id="L1349">		retailerListBean.setErrorCode(&quot;100&quot;);</span>
<span class="nc" id="L1350">		return retailerListBean;</span>
	}
	
	
	
	public String  removeStatusOfAgentRetailer(String agentOrgId, String requestIp){
		
		
<span class="nc" id="L1358">		String status=&quot;FAILED&quot;;</span>
<span class="nc" id="L1359">		Connection con=DBConnect.getConnection();</span>
<span class="nc" id="L1360">		UserInfoBean userInfo =getUserData();</span>
<span class="nc" id="L1361">		String dateAppender = new SimpleDateFormat(&quot;ddMMyyyy&quot;).format(Util.getCurrentTimeStamp());</span>
<span class="nc bnc" id="L1362" title="All 2 branches missed.">		if(&quot;FAILED&quot;.equalsIgnoreCase(userInfo.getStatus())){</span>
<span class="nc" id="L1363">			return status;</span>
		}
		try {
		
		
		// return terminal from retailer to agent
<span class="nc" id="L1369">		status=agtNonConsInvReturn(agentOrgId,con);</span>
<span class="nc bnc" id="L1370" title="All 2 branches missed.">		if(&quot;FAILED&quot;.equalsIgnoreCase(status)){</span>
<span class="nc" id="L1371">			return status;</span>
		}
		
<span class="nc" id="L1374">		SetResetUserPasswordHelper.logOutAllRetsOfAgent(Integer.parseInt(agentOrgId));</span>
		
		
		//list of terminals at agent
<span class="nc" id="L1378">		List&lt;String&gt; serialNoList=WrapperUtility.getSerialNoFromAgentOrgId(agentOrgId);</span>
		
		
		//return terminal from agent to BO
<span class="nc" id="L1382">		status=consNonConsReturnInvSave(agentOrgId,con,userInfo);</span>
		
<span class="nc bnc" id="L1384" title="All 2 branches missed.">		if(&quot;FAILED&quot;.equalsIgnoreCase(status)){</span>
<span class="nc" id="L1385">			return status;</span>
		}
		//remove terminal from BO
		
<span class="nc" id="L1389">		String removeTerminalQry=&quot;update st_lms_inv_status set current_owner_type='REMOVED'  where serial_no in ('&quot;+serialNoList.toString().substring(1, serialNoList.toString().length()-1).replaceAll(&quot;,&quot;,&quot;','&quot;).replaceAll(&quot; &quot;,&quot;&quot;)+&quot;')&quot;;</span>
	
<span class="nc" id="L1391">		System.out.println(&quot;REMOVE TERMINAL FROM BO::&quot;+removeTerminalQry);</span>
<span class="nc" id="L1392">			Statement stmt=con.createStatement();</span>
<span class="nc" id="L1393">			stmt.executeUpdate(removeTerminalQry);</span>

			//	Update Organization and User Status to BLOCK
<span class="nc" id="L1396">			int orgId = 0;</span>
<span class="nc" id="L1397">			int userId = 0;</span>
<span class="nc" id="L1398">			String orgStatus = null;</span>
<span class="nc" id="L1399">			String userStatus = null;</span>

<span class="nc" id="L1401">			HistoryBean historyBean = new HistoryBean();</span>
<span class="nc" id="L1402">			historyBean.setDoneByUserId(userInfo.getUserId());</span>
<span class="nc" id="L1403">			historyBean.setComments(&quot;BLOCKED FOR AGENT SHIFTING&quot;);</span>
<span class="nc" id="L1404">			historyBean.setRequestIp(requestIp);</span>
<span class="nc" id="L1405">			historyBean.setUpdatedValue(&quot;BLOCK&quot;);</span>
<span class="nc" id="L1406">			historyBean.setDateAppender(dateAppender);</span>
<span class="nc" id="L1407">			stmt = con.createStatement();</span>
<span class="nc" id="L1408">			ResultSet rs = stmt.executeQuery(&quot;SELECT slom.organization_id, organization_status, user_id, status FROM st_lms_organization_master slom INNER JOIN st_lms_user_master slum ON slom.organization_id=slum.organization_id WHERE isrolehead = 'Y' and  (slom.organization_id=&quot;+agentOrgId+&quot; OR parent_id=&quot;+agentOrgId+&quot;);&quot;);</span>
<span class="nc bnc" id="L1409" title="All 2 branches missed.">			while(rs.next()) {</span>
<span class="nc" id="L1410">				orgId = rs.getInt(&quot;organization_id&quot;);</span>
<span class="nc" id="L1411">				userId = rs.getInt(&quot;user_id&quot;);</span>
<span class="nc" id="L1412">				orgStatus = rs.getString(&quot;organization_status&quot;);</span>
<span class="nc" id="L1413">				userStatus = rs.getString(&quot;status&quot;);</span>

<span class="nc bnc" id="L1415" title="All 4 branches missed.">				if(&quot;ACTIVE&quot;.equals(orgStatus) || &quot;INACTIVE&quot;.equals(orgStatus)) {</span>
<span class="nc" id="L1416">					historyBean.setOrganizationId(orgId);</span>
<span class="nc" id="L1417">					historyBean.setChangeType(&quot;ORGANIZATION_STATUS&quot;);</span>
<span class="nc" id="L1418">					historyBean.setChangeValue(orgStatus);</span>
<span class="nc" id="L1419">					CommonMethods.insertUpdateOrganizationHistoryForAGTShift(historyBean, con);</span>
				}

<span class="nc bnc" id="L1422" title="All 4 branches missed.">				if(&quot;ACTIVE&quot;.equals(userStatus) || &quot;INACTIVE&quot;.equals(userStatus)) {</span>
<span class="nc" id="L1423">					historyBean.setOrganizationId(userId);</span>
<span class="nc" id="L1424">					historyBean.setChangeType(&quot;USER_STATUS&quot;);</span>
<span class="nc" id="L1425">					historyBean.setChangeValue(userStatus);</span>
<span class="nc" id="L1426">					CommonMethods.insertUpdateUserHistoryForAGTShift(historyBean, con);</span>
				}
			}

			/*
			String terminateOrgStatus=&quot;update st_lms_organization_master set organization_status='TERMINATE' where (organization_id= &quot;+agentOrgId+&quot; or parent_id= &quot;+agentOrgId+&quot; )&quot;;
	        stmt.executeUpdate(terminateOrgStatus);
	        System.out.println(&quot;Update Organization status of agent and retailer::&quot;+terminateOrgStatus);
	      
	        PreparedStatement st = con.prepareStatement(&quot;update st_lms_user_master user,(select organization_id,parent_id from st_lms_organization_master where parent_id=?) org set status=?,termination_date=? where (user.organization_id=org.organization_id or org.parent_id=user.organization_id)&quot;);
	        st.setInt(1, Integer.parseInt(agentOrgId));
	        st.setString(2, &quot;TERMINATE&quot;);
			st.setTimestamp(3, new Timestamp(new Date().getTime()));
			st.executeUpdate();
			
			System.out
					.println(&quot;REMOVE TERMINAL FROM AGENT SUCCESSFULLY&quot;);
			*/
<span class="nc" id="L1444">		} catch (SQLException e) {</span>
<span class="nc" id="L1445">			e.printStackTrace();</span>
<span class="nc" id="L1446">			return status;</span>
<span class="nc" id="L1447">		} catch (LMSException e) {</span>
<span class="nc" id="L1448">			e.printStackTrace();</span>
<span class="nc" id="L1449">			return status;</span>
		}
		finally{
<span class="nc" id="L1452">			try{</span>
<span class="nc" id="L1453">				con.close();</span>
<span class="nc" id="L1454">			}catch (Exception e) {</span>
				// TODO: handle exception
<span class="nc" id="L1456">			}</span>
<span class="nc" id="L1457">		}</span>
<span class="nc" id="L1458">		status=&quot;SUCCESS&quot;;</span>
<span class="nc" id="L1459">		return status;</span>
	 }
	
	public String agtNonConsInvReturn(String agentOrgId,Connection con){
<span class="nc" id="L1463">		String status=&quot;FAILED&quot;;</span>
<span class="nc" id="L1464">		String userType=&quot;&quot;;</span>
<span class="nc" id="L1465">		int agtUserId=-1;</span>
		//terminal-EFT930G-123456
<span class="nc" id="L1467">		String fetchAgentQry=&quot;select user_id,organization_type from st_lms_user_master where organization_id='&quot;+agentOrgId+&quot;' and isrolehead='Y'&quot;;</span>
<span class="nc" id="L1468">		String fetchRetailerTerminalQry=&quot;select inv_model_id,serial_no,current_owner_id,current_owner_type from st_lms_inv_status where current_owner_type='RETAILER' and current_owner_id in(select organization_id from st_lms_organization_master where parent_id= &quot;+agentOrgId+&quot; )&quot;;</span>
		try{
			
		
<span class="nc" id="L1472">		Statement stmt=con.createStatement();</span>
<span class="nc" id="L1473">		ResultSet rs=stmt.executeQuery(fetchAgentQry);</span>
<span class="nc bnc" id="L1474" title="All 2 branches missed.">		if(rs.next()){</span>
<span class="nc" id="L1475">			agtUserId=rs.getInt(&quot;user_id&quot;);</span>
<span class="nc" id="L1476">			userType=rs.getString(&quot;organization_type&quot;);</span>
		}
		
<span class="nc" id="L1479">		rs=stmt.executeQuery(fetchRetailerTerminalQry);</span>
		
<span class="nc bnc" id="L1481" title="All 2 branches missed.">			while(rs.next()){</span>
<span class="nc" id="L1482">				int retOrgId=rs.getInt(&quot;current_owner_id&quot;);</span>
<span class="nc" id="L1483">				String retModelId=rs.getInt(&quot;inv_model_id&quot;)+&quot;-&quot;+rs.getString(&quot;serial_no&quot;);</span>
<span class="nc" id="L1484">				ConsNNonConsInvHelper helper = new ConsNNonConsInvHelper();</span>
<span class="nc" id="L1485">				status = helper.agtNonConsInvReturnSave(retOrgId, rs.getString(&quot;serial_no&quot;),Integer.parseInt(agentOrgId),retModelId, userType,agtUserId);</span>
<span class="nc" id="L1486">			}</span>
		
		}
<span class="nc" id="L1489">		catch (Exception e) {</span>
<span class="nc" id="L1490">			return status;</span>
			// TODO: handle exception
<span class="nc" id="L1492">		}</span>
<span class="nc" id="L1493">		status=&quot;SUCCESS&quot;;</span>
<span class="nc" id="L1494">		return status;</span>
	}
	
	
	public String consNonConsReturnInvSave(String agentOrgId,Connection con,UserInfoBean userInfo)  {
<span class="nc" id="L1499">            String status=&quot;FAILED&quot;;</span>
<span class="nc" id="L1500">            ResultSet rs=null;</span>
<span class="nc" id="L1501">		String fetchAgentTerminalQry=&quot;select inv_model_id,serial_no,brand_id,inv_id,current_owner_type  from (select inv_model_id,serial_no,current_owner_type from st_lms_inv_status where current_owner_id= &quot;+agentOrgId+&quot; ) aaa inner join st_lms_inv_model_master mm on aaa.inv_model_id=mm.model_id order by inv_model_id asc&quot;;</span>
<span class="nc" id="L1502">			System.out.println(&quot;FETCH AGENT TERMINAL SHIFT TO BO::&quot;+fetchAgentTerminalQry);</span>
<span class="nc" id="L1503">			HashMap&lt;String,ArrayList&lt;String&gt;&gt; invDetMap=new HashMap&lt;String, ArrayList&lt;String&gt;&gt;();</span>
<span class="nc" id="L1504">			String ownerType=&quot;&quot;;</span>
<span class="nc" id="L1505">			int count=0;</span>
			try{
		
<span class="nc" id="L1508">			Statement stmt=con.createStatement();</span>
<span class="nc" id="L1509">			 rs=stmt.executeQuery(fetchAgentTerminalQry);</span>
			
<span class="nc bnc" id="L1511" title="All 2 branches missed.">				while(rs.next()){</span>
<span class="nc" id="L1512">					ownerType=rs.getString(&quot;current_owner_type&quot;);</span>
					 
<span class="nc" id="L1514">						ArrayList&lt;String&gt; serNoList=new ArrayList&lt;String&gt;();</span>
<span class="nc bnc" id="L1515" title="All 2 branches missed.">						if(invDetMap.get(rs.getString(&quot;inv_model_id&quot;)+&quot;-&quot;+rs.getString(&quot;brand_id&quot;)+&quot;-&quot;+rs.getString(&quot;inv_id&quot;)) != null){</span>
<span class="nc" id="L1516">							invDetMap.get(rs.getString(&quot;inv_model_id&quot;)+&quot;-&quot;+rs.getString(&quot;brand_id&quot;)+&quot;-&quot;+rs.getString(&quot;inv_id&quot;)).add(rs.getString(&quot;serial_no&quot;));</span>
						}else{
							
<span class="nc" id="L1519">							serNoList.add(rs.getString(&quot;serial_no&quot;));</span>
<span class="nc" id="L1520">						    invDetMap.put(rs.getString(&quot;inv_model_id&quot;)+&quot;-&quot;+rs.getString(&quot;brand_id&quot;)+&quot;-&quot;+rs.getString(&quot;inv_id&quot;), serNoList);</span>
<span class="nc" id="L1521">						   System.out.println(&quot;Inventor Detail Map for OrgId&quot;+agentOrgId+&quot;:::&quot;+invDetMap);</span>
						
					}
<span class="nc" id="L1524">				}</span>
			
<span class="nc" id="L1526">					Set&lt;String&gt; invItr=invDetMap.keySet();</span>
					
<span class="nc" id="L1528">					int[] non_cons_inv_id=new int[invItr.size()];</span>
<span class="nc" id="L1529">					int[] non_cons_model_id=new int[invItr.size()];</span>
<span class="nc" id="L1530">					int[] non_cons_brand_id=new int[invItr.size()];</span>
<span class="nc" id="L1531">					int[] consModelId=new int[1];</span>
<span class="nc" id="L1532">					int[] consInvId =new int[1];</span>
<span class="nc" id="L1533">					String[] serNo =new String[invItr.size()];</span>
					
<span class="nc bnc" id="L1535" title="All 2 branches missed.">					for(String modelinv: invItr){</span>
						
<span class="nc" id="L1537">						non_cons_model_id[count]=Integer.parseInt(modelinv.split(&quot;-&quot;)[0]);</span>
<span class="nc" id="L1538">						non_cons_brand_id[count]=Integer.parseInt(modelinv.split(&quot;-&quot;)[1]);</span>
<span class="nc" id="L1539">						non_cons_inv_id[count]=Integer.parseInt(modelinv.split(&quot;-&quot;)[2]);</span>
												
<span class="nc" id="L1541">						List&lt;String&gt; serNoList=new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L1542">						serNoList=invDetMap.get(modelinv);</span>
<span class="nc" id="L1543">						serNo[count] = serNoList.toString().substring(1, serNoList.toString().length()-1).replaceAll(&quot; &quot;, &quot;&quot;) ;</span>
						
						
<span class="nc" id="L1546">						consInvId[0]=-1;</span>
						
		
<span class="nc" id="L1549">						consModelId[0]=-1;</span>
<span class="nc" id="L1550">						count ++;</span>
						
<span class="nc" id="L1552">					}</span>
<span class="nc" id="L1553">					ConsNNonConsInvHelper helper = new ConsNNonConsInvHelper();</span>
<span class="nc" id="L1554">					int DNID = helper.returnConsNNonConsInv(</span>
							userInfo.getUserOrgId(), userInfo.getUserId(), ownerType,
							Integer.parseInt(agentOrgId), -1, non_cons_inv_id, non_cons_model_id,
							non_cons_brand_id, serNo, consInvId, consModelId, null,
							userInfo.getUserType());
					
			}
<span class="nc" id="L1561">			catch (Exception e) {</span>
<span class="nc" id="L1562">				return status;</span>
<span class="nc" id="L1563">			}</span>
<span class="nc" id="L1564">			status=&quot;SUCCESS&quot;;</span>
<span class="nc" id="L1565">			return status;</span>
				}

	
	
	public List&lt;String&gt; checkDuplicateTerminal(String[] serialNo, String modelId){
		
<span class="nc" id="L1572">		List&lt;String&gt; SerList=Arrays.asList(serialNo);</span>
<span class="nc" id="L1573">		List&lt;String&gt; duplicateSerialNoList=new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L1574">		System.out.println(SerList);</span>
<span class="nc" id="L1575">		System.out.println(&quot;CHECK TERMINAL::&quot;+SerList+&quot;::modelId::&quot;+modelId);</span>
<span class="nc" id="L1576">		Connection con =DBConnect.getConnection();</span>
		try {
<span class="nc" id="L1578">			String chkDulicateInvQry=&quot;select inv_model_id,serial_no from st_lms_inv_status where serial_no in ('&quot;+SerList.toString().substring(1, SerList.toString().length()-1).replaceAll(&quot;,&quot;,&quot;','&quot;).replaceAll(&quot; &quot;,&quot;&quot;)+&quot;') and current_owner_type in ('REMOVED') and inv_model_id='&quot;+modelId+&quot;';&quot;;</span>
<span class="nc" id="L1579">			Statement stmt=con.createStatement();</span>
<span class="nc" id="L1580">			System.out.println(&quot;Check Duplicate Terminal::&quot;+chkDulicateInvQry);</span>
<span class="nc" id="L1581">		ResultSet rs=stmt.executeQuery(chkDulicateInvQry);</span>
		
<span class="nc bnc" id="L1583" title="All 2 branches missed.">			while(rs.next()){</span>
<span class="nc" id="L1584">				duplicateSerialNoList.add(rs.getString(&quot;serial_no&quot;));</span>
			}
		
		
<span class="nc" id="L1588">		} catch (SQLException e) {</span>
		
<span class="nc" id="L1590">			e.printStackTrace();</span>
		}finally{
<span class="nc" id="L1592">			try{</span>
<span class="nc" id="L1593">				con.close();</span>
			}
<span class="nc" id="L1595">			catch(Exception e){</span>
<span class="nc" id="L1596">				e.printStackTrace();</span>
<span class="nc" id="L1597">			}</span>
<span class="nc" id="L1598">		}</span>
<span class="nc" id="L1599">	System.out.println(&quot;DUPLICAT SERIAL NO::&quot;+duplicateSerialNoList);</span>
<span class="nc" id="L1600">	return duplicateSerialNoList;</span>
	}
	
	
	public String checkRetailerLoginPlace(String userName, String terminalId) throws LMSException
	{
<span class="nc" id="L1606">		String Location=&quot;false&quot;;</span>
<span class="nc" id="L1607">		Connection con = null;</span>
<span class="nc" id="L1608">		con = DBConnect.getConnection();</span>
		try {
<span class="nc" id="L1610">			String query=&quot;select current_owner_type from st_lms_inv_status where serial_no like'%&quot;+terminalId+&quot;' and current_owner_type != 'REMOVED'&quot;;</span>
<span class="nc" id="L1611">			Statement stmt = con.createStatement();</span>
<span class="nc" id="L1612">			ResultSet rs = stmt.executeQuery(query);</span>
<span class="nc bnc" id="L1613" title="All 2 branches missed.">			if(rs.next())</span>
			{
<span class="nc" id="L1615">				System.out.println(rs.getString(1));</span>
<span class="nc" id="L1616">				Location=&quot;true&quot;;</span>
			}
			else
			{
<span class="nc" id="L1620">				Location=&quot;false&quot;;</span>
			}
		}
<span class="nc" id="L1623">		catch(NullPointerException ex)</span>
		{
<span class="nc" id="L1625">			System.out.println(&quot;NullPointerException:...&quot;);</span>
<span class="nc" id="L1626">			ex.printStackTrace();</span>
		}
<span class="nc" id="L1628">		catch (Exception e) {</span>
<span class="nc" id="L1629">			e.printStackTrace();</span>
		}
		finally {
<span class="nc" id="L1632">			try {</span>
<span class="nc bnc" id="L1633" title="All 16 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L1634">					con.close();</span>
				}
<span class="nc" id="L1636">			} catch (SQLException e) {</span>
<span class="nc" id="L1637">				e.printStackTrace();</span>
<span class="nc" id="L1638">				throw new LMSException(e);</span>
<span class="nc" id="L1639">			}</span>
		}
<span class="nc" id="L1641">		System.out.println(Location);</span>
<span class="nc" id="L1642">		return Location;</span>
	}
	
	public String removeConsNNonConsInv(LmsWrapperInventoryAssignDataBean invAssignDataBean){
<span class="nc" id="L1646">		String status=&quot;FAILED&quot;;</span>
<span class="nc" id="L1647">		InventoryHelper.setInventoryDataToMap();</span>
		
<span class="nc" id="L1649">		 String[] nonConsInvId=invAssignDataBean.getNonConsInvId();</span>
<span class="nc" id="L1650">		 String[] nonConsModelId=invAssignDataBean.getNonConsModelId();</span>
<span class="nc" id="L1651">		 String[] nonConsBrandId=invAssignDataBean.getNonConsBrandId();</span>
<span class="nc" id="L1652">		 String[] consInvId=invAssignDataBean.getConsInvId();</span>
<span class="nc" id="L1653">	     String[] consModelId=invAssignDataBean.getConsModelId();</span>
	   
<span class="nc" id="L1655">		int[] nonConsumableInvId=new int[nonConsInvId.length];</span>
<span class="nc bnc" id="L1656" title="All 2 branches missed.">		for(int i=0;i&lt;nonConsInvId.length;i++){</span>
<span class="nc bnc" id="L1657" title="All 2 branches missed.">			if(nonConsInvId[i] != null){</span>
<span class="nc" id="L1658">			nonConsumableInvId[i]=Integer.parseInt(InventoryHelper.inventoryNameMap.get(nonConsInvId[i]));</span>
			}
		}
		
<span class="nc" id="L1662">		int[] nonConsumableModelId=new int[nonConsModelId.length];</span>
<span class="nc bnc" id="L1663" title="All 2 branches missed.">		for(int i=0;i&lt;nonConsModelId.length;i++){</span>
<span class="nc bnc" id="L1664" title="All 2 branches missed.">			if(nonConsModelId[i] != null){</span>
<span class="nc" id="L1665">			nonConsumableModelId[i]=Integer.parseInt(InventoryHelper.modelNameMap.get(nonConsModelId[i]));</span>
			}
		}
		
<span class="nc" id="L1669">		int[] nonConsumableBrandId=new int[nonConsBrandId.length];</span>
<span class="nc bnc" id="L1670" title="All 2 branches missed.">		for(int i=0;i&lt;nonConsBrandId.length;i++){</span>
<span class="nc bnc" id="L1671" title="All 2 branches missed.">			if(nonConsBrandId[i] != null){</span>
<span class="nc" id="L1672">			nonConsumableBrandId[i]=Integer.parseInt(InventoryHelper.brandNameMap.get(nonConsBrandId[i]));</span>
			}
		}
		
		/*int[] consumableInvId=new int[consInvId.length];
		for(int i=0;i&lt;consInvId.length;i++){
			consumableInvId[i]=Integer.parseInt(InventoryHelper.consInventoryNameMap.get(consInvId[i]));
		}
		
		int[] consumableModelId=new int[consModelId.length];
		for(int i=0;i&lt;consModelId.length;i++){
			consumableModelId[i]=Integer.parseInt(InventoryHelper.consModelIdMap.get(consModelId[i]));
		}
		*/
<span class="nc" id="L1686">		UserInfoBean userInfo = getUserData();</span>
<span class="nc bnc" id="L1687" title="All 2 branches missed.">		if(&quot;FAILED&quot;.equalsIgnoreCase(userInfo.getStatus())){</span>
<span class="nc" id="L1688">			return status;</span>
		}
		
<span class="nc" id="L1691">		ConsNNonConsInvHelper invHelper = new ConsNNonConsInvHelper();</span>
<span class="nc" id="L1692">		Connection conn = DBConnect.getConnection();</span>
		try {
			
			// return non consumable inventory
<span class="nc" id="L1696">			String nonConsInvRes = removeNonConsInv(userInfo.getUserOrgId(),</span>
					nonConsumableInvId, nonConsumableModelId, nonConsumableBrandId, invAssignDataBean.getSerNo(), conn);
			// assign consumable inventory
			/*String consInvRes = verifyAssignConsInv(userOrgId, consInvId,
					consModelId, consQty, conn);*/

			
			
<span class="nc" id="L1704">		} catch (SQLException e) {</span>
<span class="nc" id="L1705">			e.printStackTrace();</span>
			
<span class="nc" id="L1707">		} catch (LMSException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L1709">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1711">			try {</span>
<span class="nc" id="L1712">				conn.close();</span>
<span class="nc" id="L1713">			} catch (SQLException e) {</span>
<span class="nc" id="L1714">				e.printStackTrace();</span>
				
<span class="nc" id="L1716">			}</span>
<span class="nc" id="L1717">		}</span>
<span class="nc" id="L1718">      status=&quot;SUCCESS&quot;;</span>
<span class="nc" id="L1719">	return status;</span>
	}
	
	public String removeNonConsInv(int userOrgId, int[] nonConsInvId,
			int[] nonConsModelId, int[] nonConsBrandId, String[] serNo,
			Connection conn) throws SQLException,LMSException{
<span class="nc" id="L1725">		String status=&quot;FAILED&quot;;</span>
<span class="nc" id="L1726">		logger.debug(&quot;removeNonConsInv called&quot;);</span>
<span class="nc" id="L1727">		List&lt;String&gt; validSerNoList = new ArrayList&lt;String&gt;();</span>
		
<span class="nc" id="L1729">		String assignSerNoQuery = null;</span>
<span class="nc" id="L1730">		Statement assignSerNoPstmt = conn.createStatement();</span>
<span class="nc" id="L1731">		ResultSet rs = null;</span>

<span class="nc" id="L1733">		String[] serNoArr = null;</span>
<span class="nc" id="L1734">		List&lt;String&gt; dbEntries = new ArrayList&lt;String&gt;();</span>

<span class="nc bnc" id="L1736" title="All 2 branches missed.">		if (nonConsModelId != null) {</span>
<span class="nc bnc" id="L1737" title="All 2 branches missed.">			for (int i = 0, len = nonConsModelId.length; i &lt; len; i = i + 1) {</span>
<span class="nc bnc" id="L1738" title="All 8 branches missed.">				if (nonConsInvId[i] &gt; 0 &amp;&amp; nonConsModelId[i] &gt; 0</span>
						&amp;&amp; nonConsBrandId[i] &gt; 0 &amp;&amp; !&quot;&quot;.equals(serNo[i].trim())) {

<span class="nc" id="L1741">					assignSerNoQuery = &quot;select serial_no from st_lms_inv_status  where inv_model_id = &quot;</span>
							+ nonConsModelId[i]
							+ &quot; and serial_no in ( &quot;
							+ &quot;'&quot;
							+ serNo[i].replace(&quot;,&quot;, &quot;','&quot;).toUpperCase()
							+ &quot;'&quot;
							+ &quot; ) and  current_owner_type !='REMOVED' and current_owner_id = &quot; + userOrgId;
<span class="nc" id="L1748">					logger.debug(&quot;fetch nonCons list1 Pstmt = &quot;</span>
							+ assignSerNoQuery);
<span class="nc" id="L1750">					rs = assignSerNoPstmt.executeQuery(assignSerNoQuery);</span>
<span class="nc" id="L1751">					dbEntries.clear();</span>
<span class="nc bnc" id="L1752" title="All 2 branches missed.">					while (rs.next()) {</span>
<span class="nc" id="L1753">						dbEntries.add(rs.getString(&quot;serial_no&quot;));</span>
					}

<span class="nc" id="L1756">					serNoArr = serNo[i].split(&quot;,&quot;);</span>
<span class="nc bnc" id="L1757" title="All 2 branches missed.">					for (int k = 0, klen = serNoArr.length; k &lt; klen; k = k + 1) {</span>
<span class="nc bnc" id="L1758" title="All 2 branches missed.">						if (!&quot;&quot;.equals(serNoArr[k].trim())) {</span>
<span class="nc bnc" id="L1759" title="All 2 branches missed.">							if (dbEntries.contains(serNoArr[k].trim()</span>
									.toUpperCase())) {
<span class="nc" id="L1761">								validSerNoList.add(serNoArr[k].trim());</span>
							}
						}
					}

				} else {
					// values are not in valid format
<span class="nc" id="L1768">					logger.debug(&quot;inside else ==== &quot; + nonConsInvId[i] + &quot; == &quot;</span>
							+ nonConsModelId[i] + &quot; === &quot; + nonConsBrandId[i]
							+ &quot;==&quot; + serNo[i].trim());
				}
				
<span class="nc" id="L1773">				status=WrapperUtility.changeStatusFromBoToRemoved(validSerNoList, nonConsModelId[i], conn);</span>
				
			}
		}

<span class="nc" id="L1778">		logger.debug(&quot;valid list = &quot; + validSerNoList);</span>
				
<span class="nc" id="L1780">		return status;</span>
	}
	
	public  boolean isValidSim(String sim[],String simModelName[]){
		try{
<span class="nc" id="L1785">			Set&lt;String&gt; modelSet = new HashSet&lt;String&gt;();</span>
<span class="nc" id="L1786">			boolean oneSelected =false;</span>
<span class="nc bnc" id="L1787" title="All 2 branches missed.">			if(simModelName!=null){</span>
				
<span class="nc bnc" id="L1789" title="All 2 branches missed.">				for(String simModel :simModelName){</span>
					
<span class="nc bnc" id="L1791" title="All 4 branches missed.">					if(simModel!=null&amp;&amp;!&quot;-1&quot;.equalsIgnoreCase(simModel.trim())){</span>
<span class="nc bnc" id="L1792" title="All 2 branches missed.">						if(!modelSet.add(simModel)){</span>
<span class="nc" id="L1793">							logger.info(&quot;Cannot Assign Multiple Sim of Same Model !!&quot;);</span>
<span class="nc" id="L1794">							return false;</span>
						}else{
							
<span class="nc" id="L1797">							oneSelected=true;</span>
						}
					}
					
				}
<span class="nc bnc" id="L1802" title="All 2 branches missed.">				if(!oneSelected){</span>
					
<span class="nc" id="L1804">					logger.info(&quot;Please Select Atleast One Sim&quot;);</span>
<span class="nc" id="L1805">					return false;</span>
				}
				
			}else{
				
<span class="nc" id="L1810">				return false;</span>
			}
<span class="nc" id="L1812">			oneSelected=false;</span>
<span class="nc bnc" id="L1813" title="All 2 branches missed.">			if(sim!=null){</span>
				
<span class="nc bnc" id="L1815" title="All 2 branches missed.">				for(String simSrNo :sim){</span>
					
<span class="nc bnc" id="L1817" title="All 4 branches missed.">					if(simSrNo!=null&amp;&amp;!&quot;&quot;.equalsIgnoreCase(simSrNo.trim())){</span>
<span class="nc" id="L1818">						oneSelected=true;</span>
					}
					
				}
						
<span class="nc bnc" id="L1823" title="All 2 branches missed.">				if(!oneSelected){</span>
					
<span class="nc" id="L1825">					logger.info(&quot;Please provide Atleast One Sim Serial Number &quot;);</span>
<span class="nc" id="L1826">					return false;</span>
				}
			}else{
				
<span class="nc" id="L1830">				return false;</span>
			}
			
<span class="nc" id="L1833">			return true;</span>
			
<span class="nc" id="L1835">		}catch(Exception e){</span>
			
<span class="nc" id="L1837">			logger.error(&quot;Exception invalid Sim Input&quot;,e);</span>
			
		}
		
<span class="nc" id="L1841">		return false;</span>
	}	
	
	public List&lt;LmsWrapperVerifyBeforeShiftBean&gt; verifyBeforeShift(LmsWrapperVerifyBeforeShiftReq lmsWrapperVerifyBeforeShiftReq) throws
				LMSException{

<span class="nc" id="L1847">		Connection con = null;</span>
<span class="nc" id="L1848">		ResultSet rs = null;</span>
<span class="nc" id="L1849">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1850">		Set&lt;String&gt; duplicateInv = null;</span>
<span class="nc" id="L1851">		Set&lt;String&gt; outerDuplicateInv = null;</span>
<span class="nc" id="L1852">		List&lt;LmsWrapperVerifyBeforeShiftBean&gt; orgList = null;;</span>

		try {
<span class="nc" id="L1855">			StringBuilder query = new StringBuilder(&quot;select sum(INV_ID) INV_ID , sum(USER_NAME) USER_NAME, sum(ORGANIZATION_NAME) ORGANIZATION_NAME , sum(ORGANIZATION_CODE) ORGANIZATION_CODE, sum(ID_NO_ID_TYPE) ID_NO_ID_TYPE from  (&quot;)</span>
				.append(&quot;select count(*) 'INV_ID' , 0 'USER_NAME' , 0 'ORGANIZATION_NAME', 0 'ORGANIZATION_CODE',0 'ID_NO_ID_TYPE'  from st_lms_inv_status where serial_no = ? and inv_model_id = ?   and current_owner_type &lt;&gt; 'REMOVED' union all &quot;) 
				.append(&quot;select  0 'INV_ID',count(*) 'USER_NAME' ,0 'ORGANIZATION_NAME',0 'ORGANIZATION_CODE',0 'ID_NO_ID_TYPE' from st_lms_user_master where user_name = ? union all &quot;) 
				.append(&quot;select  0 'INV_ID', 0 'USER_NAME' ,count(*) 'ORGANIZATION_NAME'  ,0 'ORGANIZATION_CODE',0 'ID_NO_ID_TYPE' from st_lms_organization_master where name = ? union all &quot;)
				.append(&quot;select  0 'INV_ID', 0 'USER_NAME' , 0 ORGANIZATION_NAME,count(*) 'ORGANIZATION_CODE',0 'ID_NO_ID_TYPE' from st_lms_organization_master where org_code = ? union all &quot;)
				.append(&quot;select  0 'INV_ID', 0 'USER_NAME' , 0 ORGANIZATION_NAME,0 'ORGANIZATION_CODE' , count(*) 'ID_NO_ID_TYPE' from st_lms_user_contact_details where id_type = ? and id_nbr = ?	) a&quot;);
			
<span class="nc" id="L1862">			con = DBConnect.getConnection();</span>
<span class="nc" id="L1863">			pstmt = con.prepareStatement(query.toString());</span>
			
<span class="nc" id="L1865">			Iterator&lt;LmsWrapperVerifyOrgBean&gt; beanIterator = lmsWrapperVerifyBeforeShiftReq.getOrgListToValidate().iterator();</span>
<span class="nc" id="L1866">			orgList = new ArrayList&lt;LmsWrapperVerifyBeforeShiftBean&gt;();</span>
<span class="nc" id="L1867">			outerDuplicateInv =  new HashSet&lt;String&gt;();</span>
<span class="nc bnc" id="L1868" title="All 2 branches missed.">			while (beanIterator.hasNext()) {</span>
				
<span class="nc" id="L1870">				LmsWrapperVerifyOrgBean lmsWrapperVerifyOrgBean = beanIterator.next();</span>
				
<span class="nc" id="L1872">				List&lt;OrgInvDetails&gt; orgInvList = lmsWrapperVerifyOrgBean.getOrgInvList();</span>
				
<span class="nc" id="L1874">				pstmt.setString(3, lmsWrapperVerifyOrgBean.getUserName());</span>
<span class="nc" id="L1875">				pstmt.setString(4, lmsWrapperVerifyOrgBean.getOrgName());</span>
<span class="nc" id="L1876">				pstmt.setString(5, lmsWrapperVerifyOrgBean.getOrgCode());</span>
<span class="nc" id="L1877">				pstmt.setString(6, lmsWrapperVerifyOrgBean.getIdType());</span>
<span class="nc" id="L1878">				pstmt.setString(7, lmsWrapperVerifyOrgBean.getIdNumber());</span>
				
<span class="nc" id="L1880">				Iterator&lt;OrgInvDetails&gt; it = orgInvList.iterator();</span>
<span class="nc" id="L1881">				duplicateInv = new HashSet&lt;String&gt;();</span>
<span class="nc bnc" id="L1882" title="All 2 branches missed.">				while(it.hasNext()){</span>
<span class="nc" id="L1883">					OrgInvDetails tempBean = it.next();</span>
<span class="nc" id="L1884">					pstmt.setString(2, tempBean.getInvModelId());</span>
					
<span class="nc" id="L1886">					String[] serialNos = tempBean.getSerialNo().split(&quot;,&quot;);</span>
<span class="nc bnc" id="L1887" title="All 2 branches missed.">					 for(int i = 0 ; i &lt; serialNos.length ; i++){</span>
<span class="nc" id="L1888">						 String serialId = serialNos[i].trim();</span>
<span class="nc" id="L1889">						 pstmt.setString(1, serialId);</span>
<span class="nc" id="L1890">						 rs = pstmt.executeQuery();</span>
<span class="nc" id="L1891">						 rs.next();</span>
<span class="nc bnc" id="L1892" title="All 4 branches missed.">						 if(rs.getBoolean(&quot;INV_ID&quot;) &amp;&amp; outerDuplicateInv.add(serialId)){</span>
<span class="nc" id="L1893">							 duplicateInv.add(serialId);</span>
						 }
					 }
<span class="nc" id="L1896">				}</span>
				
<span class="nc" id="L1898">				LmsWrapperVerifyBeforeShiftBean orgResBean =  new LmsWrapperVerifyBeforeShiftBean();</span>
<span class="nc" id="L1899">				orgResBean.setOrgName(lmsWrapperVerifyOrgBean.getOrgName());</span>

<span class="nc" id="L1901">				HashMap &lt;String, String&gt; errorMap = new HashMap&lt;String, String&gt;();</span>
<span class="nc bnc" id="L1902" title="All 2 branches missed.">				errorMap.put(&quot;INV_ID&quot;, (duplicateInv.size()&gt;0)?duplicateInv.toString().replace(&quot;[&quot;, &quot;&quot;).replace(&quot;]&quot;, &quot;&quot;):&quot;OK&quot;);</span>
<span class="nc bnc" id="L1903" title="All 2 branches missed.">				errorMap.put(&quot;USER_NAME&quot;, (rs.getBoolean(&quot;USER_NAME&quot;))?&quot;DUPLICATE&quot;:&quot;OK&quot;);</span>
<span class="nc bnc" id="L1904" title="All 2 branches missed.">				errorMap.put(&quot;ORGANIZATION_NAME&quot;, (rs.getBoolean(&quot;ORGANIZATION_NAME&quot;))?&quot;DUPLICATE&quot;:&quot;OK&quot;);</span>
<span class="nc bnc" id="L1905" title="All 2 branches missed.">				errorMap.put(&quot;ORGANIZATION_CODE&quot;, (rs.getBoolean(&quot;ORGANIZATION_CODE&quot;))?&quot;DUPLICATE&quot;:&quot;OK&quot;);</span>
<span class="nc bnc" id="L1906" title="All 2 branches missed.">				errorMap.put(&quot;ID_NO_ID_TYPE&quot;, (rs.getBoolean(&quot;ID_NO_ID_TYPE&quot;))?&quot;DUPLICATE&quot;:&quot;OK&quot;);</span>
<span class="nc" id="L1907">				orgResBean.setErrorMap(errorMap);</span>
<span class="nc" id="L1908">				orgList.add(orgResBean);</span>
<span class="nc" id="L1909">				pstmt.clearParameters();</span>
<span class="nc" id="L1910">			}</span>
<span class="nc" id="L1911">		}catch (SQLException e) {</span>
<span class="nc" id="L1912">			e.printStackTrace();</span>
<span class="nc" id="L1913">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE , LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1914">		} catch (Exception e) {</span>
<span class="nc" id="L1915">			e.printStackTrace();</span>
<span class="nc" id="L1916">			throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE , LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
		}finally{
<span class="nc" id="L1918">			DBConnect.closeConnection(con, pstmt, rs);</span>
<span class="nc" id="L1919">		}</span>
<span class="nc" id="L1920">		return orgList;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>