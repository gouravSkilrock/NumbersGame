<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LmsWrapperServiceImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.api.lmsWrapper</a> &gt; <span class="el_source">LmsWrapperServiceImpl.java</span></div><h1>LmsWrapperServiceImpl.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.api.lmsWrapper;


import java.sql.Connection;
import java.sql.SQLException;
import java.sql.Timestamp;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.LinkedHashMap;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.Map.Entry;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.struts2.ServletActionContext;
import org.apache.struts2.interceptor.ServletRequestAware;
import org.apache.struts2.interceptor.ServletResponseAware;
import org.codehaus.xfire.transport.http.XFireServletController;

import com.skilrock.lms.api.lmsWrapper.beans.AgentInfoBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperAgentListBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperAllRetInfoBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperBankDepositBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperCashPaymentBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperCashierDrawerDataForPWTBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperCashierDrawerDataReportBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperCollectionReportOverAllBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperCompleteCollectionBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperDrawscheduleBeanResult;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperGameDataBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperInventoryAssignDataBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperInventoryMenuDataBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperOnStartGameDataBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperOrgRegShiftBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperOrganizationRegShiftDataBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperPerformDrawDataBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperPwtApiBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperRandomIdRequestBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperRandomIdResponseBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperResultSubmissionDrawDataBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperRetailerListBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperSearchInventoryRequestDataBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperSearchInventoryResponseDataBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperToBeCollectedBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperUserDetailsBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperVerifyBeforeShiftBean;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperVerifyBeforeShiftReq;
import com.skilrock.lms.api.lmsWrapper.beans.LmsWrapperVerifyBeforeShiftRes;
import com.skilrock.lms.api.lmsWrapper.common.InventoryHelper;
import com.skilrock.lms.api.lmsWrapper.common.LmsWrapperDrawGameMgmtHelper;
import com.skilrock.lms.api.lmsWrapper.common.LmsWrapperUserMgmtHelper;
import com.skilrock.lms.api.lmsWrapper.common.WrapperUtility;
import com.skilrock.lms.api.lmsWrapper.reportsMgmt.LmsWrapperCashierDrawerDataAction;
import com.skilrock.lms.api.lmsWrapper.reportsMgmt.LmsWrapperSearchInventoryReportAction;
import com.skilrock.lms.beans.CashierDrawerDataForPWTBean;
import com.skilrock.lms.beans.CollectionReportOverAllBean;
import com.skilrock.lms.beans.CompleteCollectionBean;
import com.skilrock.lms.beans.DateBeans;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.exception.LMSErrors;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.utility.FormatNumber;
import com.skilrock.lms.coreEngine.accMgmt.common.AgentBankDepositHelper;
import com.skilrock.lms.coreEngine.accMgmt.common.AgentPaymentSubmitHelper;
import com.skilrock.lms.coreEngine.inventoryMgmt.ConsNNonConsInvHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.CashChqReportsHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.ToBeCollectedReportForLagosHelper;
import com.skilrock.lms.coreEngine.userMgmt.common.OrganizationManagementHelper;
import com.skilrock.lms.dge.beans.GameMasterLMSBean;
import com.skilrock.lms.web.drawGames.common.Util;
import com.skilrock.lms.web.reportsMgmt.common.ReportUtility;

<span class="nc" id="L86">public class LmsWrapperServiceImpl implements ILmsWrapperService,  ServletRequestAware,</span>
ServletResponseAware {
<span class="nc" id="L88">	static Log logger = LogFactory.getLog(LmsWrapperServiceImpl.class);</span>
	final static long oneDay = 1 * 24 * 60 * 60 * 1000;
	private HttpServletRequest request;
	private HttpServletResponse response;
	
	public LmsWrapperCashPaymentBean depositCashPayment(LmsWrapperCashPaymentBean cashPaymentBean) {
<span class="nc" id="L94">		System.out.println(&quot;CASH PAYMENT REQUEST DATA:: userName=&quot;+cashPaymentBean.getSystemUserName()+&quot;|AgentOrgId=&quot;+cashPaymentBean.getAgentOrgId()+&quot;&quot; </span>
				+&quot; |AgentName=&quot;+cashPaymentBean.getAgentName()+&quot;|cashPayment=&quot;+cashPaymentBean.getCashAmount() );
		
<span class="nc" id="L97">		String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc" id="L98">		Connection con = null;</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">		if(!WrapperUtility.validateUser(ip,cashPaymentBean.getSystemUserName(),cashPaymentBean.getSystemPassword())){</span>
<span class="nc" id="L100">			cashPaymentBean.setErrorCode(&quot;101&quot;);</span>
<span class="nc" id="L101">			cashPaymentBean.setSuccess(false);</span>
<span class="nc" id="L102">			return cashPaymentBean;</span>
		}
		
<span class="nc" id="L105">		HttpServletRequest request = XFireServletController.getRequest();</span>
<span class="nc" id="L106">          request.setAttribute(&quot;code&quot;, &quot;MGMT&quot;);</span>
<span class="nc" id="L107">          request.setAttribute(&quot;interfaceType&quot;, &quot;API&quot;);</span>
<span class="nc" id="L108">          ServletActionContext.setRequest(request);</span>
<span class="nc" id="L109">		AgentPaymentSubmitHelper helper=new AgentPaymentSubmitHelper();</span>
		     String autoGeneRecieptNoAndId;
		try {
<span class="nc" id="L112">			con=DBConnect.getConnection();</span>
<span class="nc" id="L113">			con.setAutoCommit(false);</span>
<span class="nc" id="L114">			LmsWrapperServiceApiHelper wrapperHelper=new LmsWrapperServiceApiHelper();</span>
			//String userData=wrapperHelper.getWrapperUserData();
<span class="nc" id="L116">			UserInfoBean userBean = wrapperHelper.getUserDataFromUserId(cashPaymentBean.getUserId());</span>
			//String[] userDataArr=userData.split(&quot;-&quot;);
			
<span class="nc" id="L119">			int orgId=WrapperUtility.getAgentIdFromAgentName(cashPaymentBean.getAgentName());</span>
<span class="nc" id="L120">			autoGeneRecieptNoAndId = helper.submitCashAgentAmt(orgId,&quot;AGENT&quot;,cashPaymentBean.getCashAmount(), userBean.getUserId(),userBean.getUserOrgId(),userBean.getUserType(),null,null,null,null,con);</span>
<span class="nc" id="L121">			con.commit();</span>
<span class="nc" id="L122">			String[] autoGeneReceipt=autoGeneRecieptNoAndId.split(&quot;#&quot;);</span>
<span class="nc" id="L123">			String autoGeneRecieptNo=autoGeneReceipt[0];</span>
<span class="nc" id="L124">			int id=Integer.parseInt(autoGeneReceipt[1]);</span>
<span class="nc" id="L125">			cashPaymentBean.setRecieptNo(autoGeneRecieptNo);</span>
<span class="nc" id="L126">            cashPaymentBean.setSuccess(true);</span>
<span class="nc" id="L127">            cashPaymentBean.setErrorCode(&quot;100&quot;);</span>
<span class="nc" id="L128">		} catch (LMSException e) {</span>
			
<span class="nc" id="L130">			e.printStackTrace();</span>
<span class="nc" id="L131">			 cashPaymentBean.setSuccess(false);</span>
<span class="nc" id="L132">	            cashPaymentBean.setErrorCode(&quot;500&quot;);</span>
<span class="nc" id="L133">		}catch (Exception e) {</span>
<span class="nc" id="L134">			logger.error(&quot;Exception&quot;,e);</span>
<span class="nc" id="L135">			logger.info(&quot;RESPONSE_CASH_PAYMENT_SUBMIT-: ErrorCode:&quot;+LMSErrors.GENERAL_EXCEPTION_ERROR_CODE+&quot; ErrorMessage:&quot;+LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L136">			request.setAttribute(&quot;LMS_EXCEPTION&quot;,LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
		}finally{
<span class="nc" id="L138">			try{</span>
<span class="nc" id="L139">				con.close();</span>
<span class="nc" id="L140">			}catch(SQLException e){</span>
<span class="nc" id="L141">				e.printStackTrace();</span>
<span class="nc" id="L142">			}</span>
<span class="nc" id="L143">		}</span>
		
<span class="nc" id="L145">		System.out.println(&quot;CASH PAYMENT RESPONSE DATA:: userName=&quot;+cashPaymentBean.getSystemUserName()+&quot;|AgentOrgId=&quot;+cashPaymentBean.getAgentOrgId()+&quot;|AgentName=&quot;+cashPaymentBean.getAgentName()+&quot;|cashPayment=&quot;+cashPaymentBean.getCashAmount()+&quot;|getRecieptNo=&quot;+cashPaymentBean.getRecieptNo()+&quot;|isSuccess=&quot;+cashPaymentBean.isSuccess()+&quot;Errorcode=&quot;+cashPaymentBean.getErrorCode() );</span>

<span class="nc" id="L147">		return cashPaymentBean; </span>
	}
	
	public LmsWrapperAgentListBean getAgentList(String systemUserName,String systemPassword){
<span class="nc" id="L151">		LmsWrapperAgentListBean agentListBean=new LmsWrapperAgentListBean();</span>
<span class="nc" id="L152">		String[] params = systemUserName.split(&quot;_&quot;);</span>
<span class="nc" id="L153">		systemUserName = params[0];</span>
<span class="nc" id="L154">		String listType = &quot;ALL&quot;;</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">		if(params.length &gt; 1) {</span>
<span class="nc" id="L156">			listType = params[1];</span>
		}

<span class="nc" id="L159">		System.out.println(&quot;Get Agent List Request::userName=&quot;+systemUserName);</span>
<span class="nc" id="L160">		String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc" id="L161">		System.out.println(&quot;ip::&quot;+ip);</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">		if(!WrapperUtility.validateUser(ip,systemUserName,systemPassword)){</span>
<span class="nc" id="L163">			agentListBean.setErrorCode(&quot;101&quot;);</span>
<span class="nc" id="L164">			agentListBean.setSuccess(false);</span>
<span class="nc" id="L165">			return agentListBean;</span>
		}
		
		
<span class="nc bnc" id="L169" title="All 2 branches missed.">		if(WrapperUtility.validateUser(ip,systemUserName,systemPassword)){</span>
<span class="nc" id="L170">		List&lt;AgentInfoBean&gt; agentInfoList=new ArrayList&lt;AgentInfoBean&gt;();</span>
	try{
<span class="nc" id="L172">		LmsWrapperServiceApiHelper helper=new LmsWrapperServiceApiHelper();</span>
<span class="nc" id="L173">		agentInfoList=helper.getAgentList(listType);</span>
<span class="nc" id="L174">		agentListBean.setAgentInfoBean(agentInfoList);</span>
<span class="nc" id="L175">		agentListBean.setSuccess(true);</span>
<span class="nc" id="L176">		agentListBean.setErrorCode(&quot;100&quot;);</span>
	}
<span class="nc" id="L178">	catch (Exception e) {</span>
<span class="nc" id="L179">		agentListBean.setSuccess(false);</span>
<span class="nc" id="L180">		agentListBean.setErrorCode(&quot;500&quot;);</span>
<span class="nc" id="L181">	}</span>
		}else{
			
		}
<span class="nc" id="L185">	System.out.println(&quot;Agent List Response Data::Issuccess=&quot;+agentListBean.isSuccess()+&quot;|ErrorCode=&quot;+agentListBean.getErrorCode());</span>
<span class="nc" id="L186">		return agentListBean;</span>
	}
	
      public LmsWrapperPwtApiBean verifyDirectPlrTicketNo(String systemUserName,String systemPassword,String ticketNo,int userId){
    	 
<span class="nc" id="L191">    	  System.out.println(&quot;REQUEST Verification Direct Player Ticket NO Request data:: TicketNo=&quot;+ticketNo+&quot;|userName=&quot;+systemUserName);</span>
<span class="nc" id="L192">    	  String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc" id="L193">    	  LmsWrapperPwtApiBean pwtApiBean=new LmsWrapperPwtApiBean();</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">    	  if(!WrapperUtility.validateUser(ip,systemUserName,systemPassword)){</span>
<span class="nc" id="L195">    		  pwtApiBean.setErrorCode(&quot;101&quot;);</span>
<span class="nc" id="L196">    		  pwtApiBean.setSuccess(false);</span>
<span class="nc" id="L197">  			return pwtApiBean;</span>
  		}
  		
    	  
<span class="nc" id="L201">    	  HttpServletRequest request = XFireServletController.getRequest();</span>
<span class="nc" id="L202">          request.setAttribute(&quot;code&quot;, &quot;MGMT&quot;);</span>
<span class="nc" id="L203">          request.setAttribute(&quot;interfaceType&quot;, &quot;API&quot;);</span>
<span class="nc" id="L204">          ServletActionContext.setRequest(request);</span>
    	 
<span class="nc" id="L206">    		LmsWrapperServiceApiHelper helper=new LmsWrapperServiceApiHelper();</span>
<span class="nc" id="L207">		UserInfoBean userInfoBean = helper.getUserDataFromUserId(userId);</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">		if(&quot;FAILED&quot;.equalsIgnoreCase(userInfoBean.getStatus())){</span>
<span class="nc" id="L209">			pwtApiBean.setSuccess(false);</span>
<span class="nc" id="L210">			pwtApiBean.setErrorCode(&quot;102&quot;);</span>
<span class="nc" id="L211">			return pwtApiBean;</span>
		}
		try {
<span class="nc" id="L214">			pwtApiBean =helper.verifyDirectPlrTicketNo(userInfoBean,ticketNo);</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">			if(&quot;ERROR_INVALID&quot;.equalsIgnoreCase(pwtApiBean.getStatus())){</span>
<span class="nc" id="L216">				pwtApiBean.setSuccess(false);</span>
<span class="nc" id="L217">				pwtApiBean.setErrorCode(&quot;110&quot;);</span>
<span class="nc" id="L218">				return pwtApiBean;</span>
			}
<span class="nc" id="L220">			pwtApiBean.setSuccess(true);</span>
<span class="nc" id="L221">			pwtApiBean.setErrorCode(&quot;100&quot;);</span>
<span class="nc" id="L222">		} catch (LMSException e) {</span>
			
<span class="nc" id="L224">			e.printStackTrace();</span>
<span class="nc" id="L225">			pwtApiBean.setSuccess(false);</span>
<span class="nc" id="L226">			pwtApiBean.setErrorCode(&quot;500&quot;);</span>
<span class="nc" id="L227">		}</span>
<span class="nc" id="L228">		System.out.println(&quot;Verification TicketNo Response data:: TotalPwtAmount=&quot;+pwtApiBean.getTotalTicketPwtAmount()+&quot;|message=&quot;+pwtApiBean.getMessage()</span>
				                                                                  +&quot;|isSuccess=&quot;+pwtApiBean.isSuccess()+&quot;|Errorcode=&quot;+pwtApiBean.getErrorCode()); 
<span class="nc" id="L230">    	  return pwtApiBean;</span>
      }
      
      public String authenticateRetailer(String systemUserName,String systemPassword,String retUserName,String terminalId) {
<span class="nc" id="L234">    	  String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">    	  if(!WrapperUtility.validateUser(ip,systemUserName,systemPassword)){</span>
    		  // set code 101 for invalid username or password
<span class="nc" id="L237">  			return &quot;101&quot;;</span>
  		}
<span class="nc" id="L239">    	  LmsWrapperServiceApiHelper helper=new LmsWrapperServiceApiHelper();</span>
		
<span class="nc" id="L241">		String isValid=&quot;false&quot;;</span>
		try {
<span class="nc" id="L243">			isValid = helper.checkRetailerLoginPlace(retUserName,terminalId);</span>
<span class="nc" id="L244">		} catch (LMSException e) {</span>
<span class="nc" id="L245">			System.out.println(&quot;INSIDE LMSEXCEPTION......&quot;);</span>
<span class="nc" id="L246">			e.printStackTrace();</span>
<span class="nc" id="L247">		}</span>
<span class="nc" id="L248">		System.out.println(&quot;RESPONSE fetchLmsLocationForRetailer......&quot;+isValid);</span>
<span class="nc" id="L249">     	return isValid;</span>
		}
      
      
    public LmsWrapperOrganizationRegShiftDataBean getOrgRegistrationShiftDataList(String systemUserName,String systemPassword,String agentUserId){
<span class="nc" id="L254">    	System.out.println(&quot;REQUEST AGENT ID FOR SHIFT DATA::&quot;+agentUserId);  </span>
<span class="nc" id="L255">    	  LmsWrapperOrganizationRegShiftDataBean orgRegistrationShiftDataBean=new LmsWrapperOrganizationRegShiftDataBean();</span>
<span class="nc" id="L256">    	String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">    	 if(!WrapperUtility.validateUser(ip,systemUserName,systemPassword)){</span>
<span class="nc" id="L258">    		 orgRegistrationShiftDataBean.setErrorCode(&quot;101&quot;);</span>
<span class="nc" id="L259">    		 orgRegistrationShiftDataBean.setSuccess(false);</span>
<span class="nc" id="L260"> 			return orgRegistrationShiftDataBean;</span>
 		}
<span class="nc" id="L262">    	LmsWrapperServiceApiHelper helper=new LmsWrapperServiceApiHelper();</span>
<span class="nc" id="L263">    	   String agentName=WrapperUtility.getAgentNameFromAgentUserId(agentUserId);</span>
    	    //orgRegistrationShiftDataBean=helper.getOrgRegShiftData(agentName);
<span class="nc" id="L265">    	   orgRegistrationShiftDataBean=helper.getOrgRegShiftData(agentName , agentUserId);</span>
<span class="nc" id="L266">			System.out.println(&quot;RESPONSE::&quot;+orgRegistrationShiftDataBean);</span>
		
<span class="nc" id="L268">        return orgRegistrationShiftDataBean;</span>
       }
      
    public String agentRetailerRegistrationAction(LmsWrapperOrgRegShiftBean orgRegShiftBean){
    	
<span class="nc" id="L273">    	String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">    	if(!WrapperUtility.validateUser(ip,orgRegShiftBean.getSystemUserName(),orgRegShiftBean.getSystemPassword())){</span>
  		  // set code 101 for invalid username or password
<span class="nc" id="L276">			return &quot;101&quot;;</span>
		}
<span class="nc" id="L278">    	String status=&quot;FAILED&quot;;</span>
<span class="nc" id="L279">    	 LmsWrapperServiceApiHelper helper=new LmsWrapperServiceApiHelper();</span>
<span class="nc" id="L280">    	 status=helper.agentRetailerRegistrationAction(orgRegShiftBean);</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">    	 if(&quot;FAILED&quot;.equalsIgnoreCase(status)){</span>
<span class="nc" id="L282">    		 return status;</span>
    	 }
<span class="nc" id="L284">    	 status=&quot;SUCCESS&quot;;</span>
<span class="nc" id="L285">    	return status;</span>
    }
    
    public String removeStatusOfAgentRetailer(String agentUserId,String systemUserName,String systemPassword){
<span class="nc" id="L289">    	String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">    	 if(!WrapperUtility.validateUser(ip,systemUserName,systemPassword)){</span>
   		  // set code 101 for invalid username or password
<span class="nc" id="L292"> 			return &quot;101&quot;;</span>
 		}
    	
<span class="nc" id="L295">    	String status=&quot;FAILED&quot;;</span>
<span class="nc" id="L296">    	String agentOrgId=WrapperUtility.getAgentOrgIdFromAgentUserId(agentUserId);</span>
<span class="nc" id="L297">    	 LmsWrapperServiceApiHelper helper=new LmsWrapperServiceApiHelper();</span>
<span class="nc" id="L298">    	 status=helper.removeStatusOfAgentRetailer(agentOrgId, ip);</span>
<span class="nc" id="L299">    	return status;</span>
    }
    
    public LmsWrapperRetailerListBean getRetailerList(String systemUserName,String systemPassword,String agentUserId){
<span class="nc" id="L303">    	LmsWrapperRetailerListBean retailerListBean =new LmsWrapperRetailerListBean();</span>
<span class="nc" id="L304">    	String ip = XFireServletController.getRequest().getRemoteHost();</span>
    	
<span class="nc bnc" id="L306" title="All 2 branches missed.">    	 if(!WrapperUtility.validateUser(ip,systemUserName,systemPassword)){</span>
<span class="nc" id="L307">    		 retailerListBean.setErrorCode(&quot;101&quot;);</span>
<span class="nc" id="L308">    		 retailerListBean.setSuccess(false);</span>
<span class="nc" id="L309"> 			return retailerListBean;</span>
 		}
    	     	
<span class="nc" id="L312">    	LmsWrapperServiceApiHelper helper=new LmsWrapperServiceApiHelper();</span>
<span class="nc" id="L313">    	retailerListBean=helper.getRetailerListBean(agentUserId);</span>
<span class="nc" id="L314">    	return retailerListBean;</span>
    }
    public LmsWrapperDrawscheduleBeanResult fetchDrawListForResSubmission(LmsWrapperResultSubmissionDrawDataBean resultSubmissionDrawDataBean){
    	
<span class="nc" id="L318">    	LmsWrapperDrawscheduleBeanResult drawScheduleBeanResult=new LmsWrapperDrawscheduleBeanResult();</span>
<span class="nc" id="L319">    	String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc bnc" id="L320" title="All 2 branches missed.">    	 if(!WrapperUtility.validateUser(ip,resultSubmissionDrawDataBean.getSystemUserName(),resultSubmissionDrawDataBean.getSystemPassword())){</span>
<span class="nc" id="L321">    		 drawScheduleBeanResult.setErrorCode(&quot;101&quot;);</span>
<span class="nc" id="L322">    		 drawScheduleBeanResult.setSuccess(false);</span>
<span class="nc" id="L323"> 			return drawScheduleBeanResult;</span>
 		}
    	
<span class="nc" id="L326">		logger.debug(&quot;INside getManualEntryData&quot;);</span>
<span class="nc" id="L327">		logger.debug(&quot;action call------------------&quot;);</span>
<span class="nc" id="L328">		logger.debug(&quot;Before--&quot; + new Date());</span>
<span class="nc" id="L329">        LmsWrapperDrawGameMgmtHelper helper=new LmsWrapperDrawGameMgmtHelper();</span>
	
<span class="nc" id="L331">        drawScheduleBeanResult=helper.fetchDrawListForResSubmission(resultSubmissionDrawDataBean);</span>
		
<span class="nc" id="L333">		return drawScheduleBeanResult;</span>
	}	

   public String performManualWinningEntry(LmsWrapperPerformDrawDataBean performDrawDataBean) {
	  
<span class="nc" id="L338">	   String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc bnc" id="L339" title="All 2 branches missed.">	   if(!WrapperUtility.validateUser(ip,performDrawDataBean.getSystemUserName(),performDrawDataBean.getSystemPassword())){</span>
 		  // set code 101 for invalid username or password
<span class="nc" id="L341">			return &quot;101&quot;;</span>
		}
<span class="nc" id="L343">	   LmsWrapperDrawGameMgmtHelper helper=new LmsWrapperDrawGameMgmtHelper();</span>
<span class="nc" id="L344">	   String result=&quot;&quot;;</span>
<span class="nc" id="L345">	   result=helper.performManualWinningEntry(performDrawDataBean);</span>
<span class="nc bnc" id="L346" title="All 2 branches missed.">	   if(&quot;FAILED&quot;.equalsIgnoreCase(result)){</span>
<span class="nc" id="L347">		   return &quot;102&quot;;</span>
	   }
<span class="nc" id="L349">		return result;</span>
	}

	
	public LmsWrapperOnStartGameDataBean getGameData(String systemUserName,String systemPassword) {
<span class="nc" id="L354">		String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc" id="L355">		LmsWrapperOnStartGameDataBean returnGameDataBean=new LmsWrapperOnStartGameDataBean();</span>
		
<span class="nc bnc" id="L357" title="All 2 branches missed.">		if(!WrapperUtility.validateUser(ip,systemUserName,systemPassword)){</span>
<span class="nc" id="L358">			returnGameDataBean.setErrorCode(&quot;101&quot;);</span>
<span class="nc" id="L359">			returnGameDataBean.setSuccess(false);</span>
<span class="nc" id="L360">			return returnGameDataBean;</span>
		}
		
<span class="nc" id="L363">		HashMap&lt;Integer, GameMasterLMSBean&gt; GameMap=(HashMap&lt;Integer, GameMasterLMSBean&gt;) Util.getGameMap();</span>
<span class="nc" id="L364">		LmsWrapperGameDataBean gameDataBean=null;</span>
<span class="nc" id="L365">		LinkedHashMap&lt;String, LmsWrapperGameDataBean&gt; localGameMap=new LinkedHashMap&lt;String, LmsWrapperGameDataBean&gt;();</span>
		
<span class="nc bnc" id="L367" title="All 2 branches missed.">		for (Map.Entry&lt;Integer, GameMasterLMSBean&gt; entry : GameMap.entrySet())</span>
		{
<span class="nc" id="L369">			gameDataBean=new LmsWrapperGameDataBean();</span>
		
<span class="nc" id="L371">			Integer game=entry.getKey();</span>
<span class="nc" id="L372">			GameMasterLMSBean bean=(GameMasterLMSBean)entry.getValue();</span>
<span class="nc" id="L373">			gameDataBean.setGameId(bean.getGameId());</span>
<span class="nc" id="L374">			String gameName=bean.getGameName();</span>
<span class="nc" id="L375">			gameDataBean.setGameName(gameName);</span>
<span class="nc" id="L376">			gameDataBean.setGameDevName(bean.getGameNameDev());</span>
<span class="nc" id="L377">			String gameN=new Integer(bean.getGameNo()).toString();</span>
<span class="nc" id="L378">			gameDataBean.setGameNo(gameN);</span>
<span class="nc" id="L379">			gameDataBean.setGameStatus(bean.getGameStatus());</span>
<span class="nc" id="L380">			localGameMap.put(gameName, gameDataBean);</span>
<span class="nc" id="L381">		}</span>
<span class="nc" id="L382">		returnGameDataBean.setReturnGameDataBean(localGameMap);</span>
<span class="nc" id="L383">		return returnGameDataBean;</span>
	}
	
	public LmsWrapperInventoryMenuDataBean consNonConsAsignInvMenuData(String systemUserName,String systemPassword){
<span class="nc" id="L387">		LmsWrapperInventoryMenuDataBean invMenuDataBean=new LmsWrapperInventoryMenuDataBean();</span>
		
<span class="nc" id="L389">		String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc bnc" id="L390" title="All 2 branches missed.">		if(!WrapperUtility.validateUser(ip,systemUserName,systemPassword)){</span>
<span class="nc" id="L391">			invMenuDataBean.setErrorcode(&quot;101&quot;);</span>
<span class="nc" id="L392">			invMenuDataBean.setSuccess(false);</span>
<span class="nc" id="L393">			return invMenuDataBean;</span>
		}
		
<span class="nc" id="L396">		ConsNNonConsInvHelper helper = new ConsNNonConsInvHelper();</span>
		try {
<span class="nc" id="L398">			Map&lt;String, HashMap&lt;String, String&gt;&gt; map = helper.fetchAgentNRetList();</span>
<span class="nc" id="L399">			invMenuDataBean.setNonConsInvMap(map.get(&quot;nonConsInvMap&quot;));</span>
<span class="nc" id="L400">			invMenuDataBean.setConsInvMap(map.get(&quot;consInvMap&quot;));</span>
<span class="nc" id="L401">			invMenuDataBean.setBrandMap( map.get(&quot;brandMap&quot;));</span>
<span class="nc" id="L402">			invMenuDataBean.setAgentMap( map.get(&quot;agentMap&quot;));</span>
<span class="nc" id="L403">			invMenuDataBean.setRetMap(map.get(&quot;retMap&quot;));</span>
<span class="nc" id="L404">			invMenuDataBean.setInvSpecMap(map.get(&quot;invSpecMap&quot;));</span>
<span class="nc" id="L405">			invMenuDataBean.setModelMap( map.get(&quot;modelMap&quot;));</span>
			
<span class="nc" id="L407">			InventoryHelper.setInventoryDataToMap();</span>
<span class="nc" id="L408">			invMenuDataBean.setModelIdMap(InventoryHelper.modelIdMap);</span>
<span class="nc" id="L409">			invMenuDataBean.setModelNameMap(InventoryHelper.modelNameMap);</span>
<span class="nc" id="L410">			invMenuDataBean.setBrandIdMap(InventoryHelper.brandIdMap);</span>
<span class="nc" id="L411">			invMenuDataBean.setBrandNameMap(InventoryHelper.brandNameMap);</span>
<span class="nc" id="L412">			invMenuDataBean.setConsInventoryIdMap(InventoryHelper.consInventoryIdMap);</span>
<span class="nc" id="L413">			invMenuDataBean.setConsInventoryNameMap(InventoryHelper.consInventoryNameMap);</span>
<span class="nc" id="L414">			invMenuDataBean.setConsModelIdMap(InventoryHelper.consModelIdMap);</span>
<span class="nc" id="L415">			invMenuDataBean.setInventoryIdMap(InventoryHelper.inventoryIdMap);</span>
<span class="nc" id="L416">			invMenuDataBean.setInventoryNameMap(InventoryHelper.inventoryNameMap);</span>
<span class="nc" id="L417">			invMenuDataBean.setConsInvIdFromModelMap(InventoryHelper.consInvIdFromModelMap);</span>
<span class="nc" id="L418">			invMenuDataBean.setStatus(&quot;SUCCESS&quot;);</span>
<span class="nc" id="L419">			invMenuDataBean.setErrorcode(&quot;100&quot;);</span>
<span class="nc" id="L420">		} catch (LMSException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L422">			e.printStackTrace();</span>
<span class="nc" id="L423">			invMenuDataBean.setStatus(&quot;FAILED&quot;);</span>
<span class="nc" id="L424">			invMenuDataBean.setErrorcode(&quot;500&quot;);</span>
<span class="nc" id="L425">		}</span>
<span class="nc" id="L426">		return invMenuDataBean;</span>
	}
	
	public String verifyConsNNonConsInv(LmsWrapperInventoryAssignDataBean invAssignDataBean){
<span class="nc" id="L430">		String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc bnc" id="L431" title="All 2 branches missed.">		if(!WrapperUtility.validateUser(ip,invAssignDataBean.getSystemUserName(),invAssignDataBean.getSystemPassword())){</span>
	 		  // set code 101 for invalid username or password
<span class="nc" id="L433">				return &quot;101&quot;;</span>
			}
		
<span class="nc" id="L436">		InventoryHelper.setInventoryDataToMap();</span>
		
<span class="nc" id="L438">		 String[] nonConsInvId=invAssignDataBean.getNonConsInvId();</span>
<span class="nc" id="L439">		 String[] nonConsModelId=invAssignDataBean.getNonConsModelId();</span>
<span class="nc" id="L440">		 String[] nonConsBrandId=invAssignDataBean.getNonConsBrandId();</span>
<span class="nc" id="L441">		 String[] consInvId=invAssignDataBean.getConsInvId();</span>
<span class="nc" id="L442">	     String[] consModelId=invAssignDataBean.getConsModelId(); </span>
	   
<span class="nc" id="L444">		int[] nonConsumableInvId=new int[nonConsInvId.length];</span>
<span class="nc bnc" id="L445" title="All 2 branches missed.">		for(int i=0;i&lt;nonConsInvId.length;i++){</span>
<span class="nc" id="L446">			nonConsumableInvId[i]=Integer.parseInt(InventoryHelper.inventoryNameMap.get(nonConsInvId[i]));</span>
		}
		
<span class="nc" id="L449">		int[] nonConsumableModelId=new int[nonConsModelId.length];</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">		for(int i=0;i&lt;nonConsModelId.length;i++){</span>
<span class="nc" id="L451">			nonConsumableModelId[i]=Integer.parseInt(InventoryHelper.modelNameMap.get(nonConsModelId[i]));</span>
		}
		
<span class="nc" id="L454">		int[] nonConsumableBrandId=new int[nonConsBrandId.length];</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">		for(int i=0;i&lt;nonConsBrandId.length;i++){</span>
<span class="nc" id="L456">			nonConsumableBrandId[i]=Integer.parseInt(InventoryHelper.brandNameMap.get(nonConsBrandId[i]));</span>
		}
		
<span class="nc" id="L459">		int[] consumableInvId=new int[consInvId.length];</span>
<span class="nc bnc" id="L460" title="All 2 branches missed.">		for(int i=0;i&lt;consInvId.length;i++){</span>
<span class="nc" id="L461">			consumableInvId[i]=Integer.parseInt(InventoryHelper.consInventoryNameMap.get(consInvId[i]));</span>
		}
		
<span class="nc" id="L464">		int[] consumableModelId=new int[consInvId.length];</span>
<span class="nc bnc" id="L465" title="All 2 branches missed.">		for(int i=0;i&lt;consInvId.length;i++){			</span>
<span class="nc" id="L466">			String consInv=InventoryHelper.consInventoryNameMap.get(consInvId[i]);</span>
<span class="nc" id="L467">			consumableModelId[i]=Integer.parseInt(InventoryHelper.consModelIdMap.get(consInv));</span>
		}
		
<span class="nc" id="L470">		LmsWrapperServiceApiHelper helper=new LmsWrapperServiceApiHelper();</span>
<span class="nc" id="L471">		UserInfoBean userInfo = helper.getUserData();</span>
<span class="nc bnc" id="L472" title="All 2 branches missed.">		if(&quot;FAILED&quot;.equalsIgnoreCase(userInfo.getStatus())){</span>
<span class="nc" id="L473">			return &quot;102&quot;;</span>
		}
		
<span class="nc" id="L476">		ConsNNonConsInvHelper invHelper = new ConsNNonConsInvHelper();</span>
		 
		
		
<span class="nc" id="L480">		String verifyConsNNonConsInv=&quot;&quot;;</span>
		try {
<span class="nc bnc" id="L482" title="All 2 branches missed.">			if(!&quot;ASSIGN_INVENTORY&quot;.equals(invAssignDataBean.getStatus())){</span>
<span class="nc" id="L483">				int agtOrgId=Integer.parseInt(WrapperUtility.getAgentOrgIdFromAgentUserId(invAssignDataBean.getAgtOrgId()+&quot;&quot;));</span>
<span class="nc" id="L484">				verifyConsNNonConsInv = invHelper.verifyConsNNonConsInv(agtOrgId</span>
						, nonConsumableInvId,nonConsumableModelId, nonConsumableBrandId,
						invAssignDataBean.getSerNo(), consumableInvId, consumableModelId, invAssignDataBean.getConsQty(), userInfo.getUserType());
		
<span class="nc" id="L488">			}else{</span>
<span class="nc" id="L489">			verifyConsNNonConsInv = invHelper.verifyConsNNonConsInv(userInfo</span>
						.getUserOrgId(), nonConsumableInvId,nonConsumableModelId, nonConsumableBrandId,
						invAssignDataBean.getSerNo(), consumableInvId, consumableModelId, invAssignDataBean.getConsQty(), userInfo.getUserType(),invAssignDataBean.getAgtOrgId());
			}
<span class="nc" id="L493">			} catch (LMSException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L495">			e.printStackTrace();</span>
<span class="nc" id="L496">		}</span>
<span class="nc" id="L497">			System.out.println(&quot;Return Verify Inventory::&quot;+verifyConsNNonConsInv);</span>
<span class="nc" id="L498">		return verifyConsNNonConsInv;</span>
	}
	
	public String assignConsNNonConsInv(LmsWrapperInventoryAssignDataBean invAssignDataBean){
<span class="nc" id="L502">		String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc bnc" id="L503" title="All 2 branches missed.">		if(!WrapperUtility.validateUser(ip,invAssignDataBean.getSystemUserName(),invAssignDataBean.getSystemPassword())){</span>
	 		  // set code 101 for invalid username or password
<span class="nc" id="L505">				return &quot;101&quot;;</span>
			}
<span class="nc" id="L507">		String status=&quot;&quot;;</span>
<span class="nc" id="L508">         LmsWrapperServiceApiHelper helper=new LmsWrapperServiceApiHelper();</span>
<span class="nc" id="L509">         UserInfoBean userInfo = helper.getUserData();</span>
         
<span class="nc bnc" id="L511" title="All 2 branches missed.">         if(&quot;FAILED&quot;.equalsIgnoreCase(userInfo.getStatus())){</span>
<span class="nc" id="L512"> 			return &quot;102&quot;;</span>
 		}
<span class="nc" id="L514">         ConsNNonConsInvHelper invHelper = new ConsNNonConsInvHelper();</span>
         try {
<span class="nc" id="L516">        	 InventoryHelper.setInventoryDataToMap();</span>
     		
<span class="nc" id="L518">    		 String[] nonConsInvId=invAssignDataBean.getNonConsInvId();</span>
<span class="nc" id="L519">    		 String[] nonConsModelId=invAssignDataBean.getNonConsModelId();</span>
<span class="nc" id="L520">    		 String[] nonConsBrandId=invAssignDataBean.getNonConsBrandId();</span>
<span class="nc" id="L521">    		 String[] consInvId=invAssignDataBean.getConsInvId();</span>
<span class="nc" id="L522">    	     String[] consModelId=invAssignDataBean.getConsModelId();</span>
    	   
<span class="nc" id="L524">    		int[] nonConsumableInvId=new int[nonConsInvId.length];</span>
<span class="nc bnc" id="L525" title="All 2 branches missed.">    		if(nonConsInvId[0] != null){</span>
<span class="nc bnc" id="L526" title="All 2 branches missed.">    		for(int i=0;i&lt;nonConsInvId.length;i++){</span>
<span class="nc" id="L527">    			nonConsumableInvId[i]=Integer.parseInt(InventoryHelper.inventoryNameMap.get(nonConsInvId[i]));</span>
    		}
    		}
    		
    		
<span class="nc" id="L532">    		int[] nonConsumableModelId=new int[nonConsModelId.length];</span>
<span class="nc bnc" id="L533" title="All 2 branches missed.">    		if(nonConsModelId[0] != null){</span>
<span class="nc bnc" id="L534" title="All 2 branches missed.">    		for(int i=0;i&lt;nonConsModelId.length;i++){</span>
<span class="nc" id="L535">    			nonConsumableModelId[i]=Integer.parseInt(InventoryHelper.modelNameMap.get(nonConsModelId[i]));</span>
    		}
    		}
    		
<span class="nc" id="L539">    		int[] nonConsumableBrandId=new int[nonConsBrandId.length];</span>
<span class="nc bnc" id="L540" title="All 2 branches missed.">    		if(nonConsBrandId[0] != null){</span>
<span class="nc bnc" id="L541" title="All 2 branches missed.">    		for(int i=0;i&lt;nonConsBrandId.length;i++){</span>
<span class="nc" id="L542">    			nonConsumableBrandId[i]=Integer.parseInt(InventoryHelper.brandNameMap.get(nonConsBrandId[i]));</span>
    		}
    		}
    		
<span class="nc" id="L546">    		int[] consumableInvId=new int[consInvId.length];</span>
<span class="nc bnc" id="L547" title="All 2 branches missed.">    		if(consInvId[0] != null){</span>
<span class="nc bnc" id="L548" title="All 2 branches missed.">    		for(int i=0;i&lt;consInvId.length;i++){</span>
<span class="nc" id="L549">    			consumableInvId[i]=Integer.parseInt(InventoryHelper.consInventoryNameMap.get(consInvId[i]));</span>
    		}
    		}
    		
<span class="nc" id="L553">    		int[] consumableModelId=new int[consInvId.length];</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">    		if(consInvId[0] != null){</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">    		for(int i=0;i&lt;consInvId.length;i++){</span>
<span class="nc" id="L556">    			String consInv=InventoryHelper.consInventoryNameMap.get(consInvId[i]);</span>
<span class="nc" id="L557">    			consumableModelId[i]=Integer.parseInt(InventoryHelper.consModelIdMap.get(consInv));</span>
    		}
    		}
    		
<span class="nc bnc" id="L561" title="All 2 branches missed.">    		if(nonConsModelId[0] != null){</span>
<span class="nc bnc" id="L562" title="All 2 branches missed.">    		for(int i=0;i&lt;nonConsModelId.length;i++){</span>
    			
    		
    		//check duplicate terminal id
<span class="nc" id="L566">			List&lt;String&gt; dupSerialNoList=helper.checkDuplicateTerminal(invAssignDataBean.getSerNo(),InventoryHelper.modelNameMap.get(nonConsModelId[i]));</span>
			
			//change status from REMOVED TO BO
<span class="nc bnc" id="L569" title="All 2 branches missed.">			if(dupSerialNoList.size()&gt;0){</span>
<span class="nc" id="L570">			status=WrapperUtility.changeStatusFromRemovedToBo(dupSerialNoList,InventoryHelper.modelNameMap.get(nonConsModelId[i]));</span>
<span class="nc bnc" id="L571" title="All 2 branches missed.">			if(&quot;FAILED&quot;.equalsIgnoreCase(status)){</span>
<span class="nc" id="L572">				return status;</span>
			}
			}
			
<span class="nc" id="L576">			String[] serialNo=invAssignDataBean.getSerNo();</span>
<span class="nc" id="L577">			List&lt;String&gt; serialNoList=new LinkedList&lt;String&gt;(Arrays.asList(serialNo[i].split(&quot;,&quot;)));</span>
			
<span class="nc bnc" id="L579" title="All 2 branches missed.">			if(dupSerialNoList.size()&gt;0){</span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">				for(int j=0;j&lt;dupSerialNoList.size();j++){</span>
<span class="nc" id="L581">					serialNoList.remove(dupSerialNoList.get(j));</span>
					//dupSerialNoList.remove(serialNoList.get(j));
				}
				
			}
				
<span class="nc bnc" id="L587" title="All 4 branches missed.">				if(serialNoList.size()&gt;0 &amp;&amp; serialNoList !=null){</span>
<span class="nc" id="L588">				String[] serialNoUpload=serialNoList.toArray(new String[serialNoList.size()]);</span>
<span class="nc" id="L589">				String[] invCodeUpload=new String[serialNoList.size()];// Set to Null...  Fetch Inv code from serial numbers  </span>
		/*	ArrayList arr = invHelper.nonConsInvUpload(InventoryHelper.modelNameMap.get(nonConsModelId[i])+&quot;-&quot;+InventoryHelper.brandNameMap.get(nonConsBrandId[i]), 1000.00, &quot;Y&quot;,
					null, serialNoUpload, userInfo.getUserId(), userInfo
							.getUserOrgId(), userInfo.getUserType());*/
			
	
<span class="nc" id="L595">			ArrayList arr1 = invHelper.nonConsInvUpload(serialNoUpload, invCodeUpload, null, Integer.parseInt(InventoryHelper.modelNameMap.get(nonConsModelId[i])), 1000.00, &quot;Y&quot;, null, userInfo.getUserId(), userInfo</span>
					.getUserOrgId(), userInfo.getUserType());
			
			
			
    		}
    		}
    		}
    		
<span class="nc" id="L604">        	 int agtOrgId=Integer.parseInt(WrapperUtility.getAgentOrgIdFromAgentUserId(&quot;&quot;+invAssignDataBean.getAgtOrgId()));</span>
<span class="nc" id="L605">			int DNID = invHelper.assignConsNNonConsInv(</span>
						userInfo.getUserOrgId(), userInfo.getUserId(), &quot;AGENT&quot;,
						agtOrgId,invAssignDataBean.getRetOrgId(), nonConsumableInvId, nonConsumableModelId,
						nonConsumableBrandId, invAssignDataBean.getSerNo(), consumableInvId, consumableModelId,
						invAssignDataBean.getConsQty(),	userInfo.getUserType());
<span class="nc" id="L610">		} catch (LMSException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L612">			e.printStackTrace();</span>
<span class="nc" id="L613">		}</span>
<span class="nc" id="L614">		return status;</span>
	}
	
	
	public String returnConsNNonConsInv(LmsWrapperInventoryAssignDataBean invAssignDataBean){
<span class="nc" id="L619">		String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc bnc" id="L620" title="All 2 branches missed.">		if(!WrapperUtility.validateUser(ip,invAssignDataBean.getSystemUserName(),invAssignDataBean.getSystemPassword())){</span>
	 		  // set code 101 for invalid username or password
<span class="nc" id="L622">				return &quot;101&quot;;</span>
			}
<span class="nc" id="L624">		String status=&quot;&quot;;</span>
<span class="nc" id="L625">         LmsWrapperServiceApiHelper helper=new LmsWrapperServiceApiHelper();</span>
<span class="nc" id="L626">         UserInfoBean userInfo = helper.getUserData();</span>
         
<span class="nc bnc" id="L628" title="All 2 branches missed.">         if(&quot;FAILED&quot;.equalsIgnoreCase(userInfo.getStatus())){</span>
<span class="nc" id="L629"> 			return &quot;102&quot;;</span>
 		}
<span class="nc" id="L631">         ConsNNonConsInvHelper invHelper = new ConsNNonConsInvHelper();</span>
         try {
<span class="nc" id="L633">        	 InventoryHelper.setInventoryDataToMap();</span>
     		
<span class="nc" id="L635">    		 String[] nonConsInvId=invAssignDataBean.getNonConsInvId();</span>
<span class="nc" id="L636">    		 String[] nonConsModelId=invAssignDataBean.getNonConsModelId();</span>
<span class="nc" id="L637">    		 String[] nonConsBrandId=invAssignDataBean.getNonConsBrandId();</span>
<span class="nc" id="L638">    		 String[] consInvId=invAssignDataBean.getConsInvId();</span>
<span class="nc" id="L639">    	     String[] consModelId=invAssignDataBean.getConsModelId();</span>
    	   
<span class="nc" id="L641">    		int[] nonConsumableInvId=new int[nonConsInvId.length];</span>
<span class="nc bnc" id="L642" title="All 2 branches missed.">    		if(nonConsInvId[0] != null){</span>
<span class="nc bnc" id="L643" title="All 2 branches missed.">    		for(int i=0;i&lt;nonConsInvId.length;i++){</span>
<span class="nc" id="L644">    			nonConsumableInvId[i]=Integer.parseInt(InventoryHelper.inventoryNameMap.get(nonConsInvId[i]));</span>
    		}
    		}
<span class="nc" id="L647">    		int[] nonConsumableModelId=new int[nonConsModelId.length];</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">    		if(nonConsModelId[0] != null){</span>
<span class="nc bnc" id="L649" title="All 2 branches missed.">    		for(int i=0;i&lt;nonConsModelId.length;i++){</span>
<span class="nc" id="L650">    			nonConsumableModelId[i]=Integer.parseInt(InventoryHelper.modelNameMap.get(nonConsModelId[i]));</span>
    		}
    		}
    		
<span class="nc" id="L654">    		int[] nonConsumableBrandId=new int[nonConsBrandId.length];</span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">    		if(nonConsBrandId[0] != null){</span>
<span class="nc bnc" id="L656" title="All 2 branches missed.">    		for(int i=0;i&lt;nonConsBrandId.length;i++){</span>
<span class="nc" id="L657">    			nonConsumableBrandId[i]=Integer.parseInt(InventoryHelper.brandNameMap.get(nonConsBrandId[i]));</span>
    		}
    		}
    		
<span class="nc" id="L661">    		int[] consumableInvId=new int[consInvId.length];</span>
<span class="nc bnc" id="L662" title="All 2 branches missed.">    		for(int i=0;i&lt;consInvId.length;i++){</span>
<span class="nc" id="L663">    			consumableInvId[i]=Integer.parseInt(InventoryHelper.consInventoryNameMap.get(consInvId[i]));</span>
    		}
    		
<span class="nc" id="L666">    		int[] consumableModelId=new int[consModelId.length];</span>
<span class="nc bnc" id="L667" title="All 2 branches missed.">    		for(int i=0;i&lt;consModelId.length;i++){</span>
<span class="nc" id="L668">    			consumableModelId[i]=Integer.parseInt(InventoryHelper.consModelIdMap.get(consModelId[i]));</span>
    		}
<span class="nc" id="L670">    		String[] serialNo=new String[nonConsModelId.length];</span>
    		
<span class="nc bnc" id="L672" title="All 2 branches missed.">    		for(int i=0;i&lt;nonConsModelId.length;i++){</span>
    		
<span class="nc" id="L674">			 serialNo=invAssignDataBean.getSerNo();</span>
			
			
    		}
    	
			
<span class="nc" id="L680">        	 int agtOrgId=Integer.parseInt(WrapperUtility.getAgentOrgIdFromAgentUserId(&quot;&quot;+invAssignDataBean.getAgtOrgId()));</span>
        	 
<span class="nc" id="L682">				int DNID = invHelper.returnConsNNonConsInv(</span>
						userInfo.getUserOrgId(), userInfo.getUserId(), &quot;AGENT&quot;,
						agtOrgId, -1, nonConsumableInvId, nonConsumableModelId,
						nonConsumableBrandId, serialNo, consumableInvId, consumableModelId, invAssignDataBean.getConsQty(),
						userInfo.getUserType());
<span class="nc" id="L687">		} catch (LMSException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L689">			e.printStackTrace();</span>
<span class="nc" id="L690">		}</span>
<span class="nc" id="L691">		return status;</span>
	}
	
	public String removeConsNNonConsInv(LmsWrapperInventoryAssignDataBean invAssignDataBean){
<span class="nc" id="L695">		String ip = XFireServletController.getRequest().getRemoteHost();</span>
		
<span class="nc bnc" id="L697" title="All 2 branches missed.">		if(!WrapperUtility.validateUser(ip,invAssignDataBean.getSystemUserName(),invAssignDataBean.getSystemPassword())){</span>
	 		  // set code 101 for invalid username or password
<span class="nc" id="L699">				return &quot;101&quot;;</span>
			}
<span class="nc" id="L701">		String status=&quot;FAILED&quot;;</span>
<span class="nc" id="L702">		LmsWrapperServiceApiHelper helper=new LmsWrapperServiceApiHelper();</span>
<span class="nc" id="L703">		status=helper.removeConsNNonConsInv( invAssignDataBean);</span>
<span class="nc" id="L704">		return status;</span>
		
	}
	
	public LmsWrapperBankDepositBean agentBankDeposit(LmsWrapperBankDepositBean bankDepositBean){
<span class="nc" id="L709">		System.out.println(&quot;Bank Deposit REQUEST DATA:: userName=&quot;+bankDepositBean.getSystemUserName()+&quot;|AgentOrgId=&quot;+bankDepositBean.getAgentOrgId()+&quot;&quot; </span>
				+&quot; |AgentName=&quot;+bankDepositBean.getAgentName()+&quot;|cashPayment=&quot;+bankDepositBean.getDepositAmount() );
		
<span class="nc" id="L712">		String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc bnc" id="L713" title="All 2 branches missed.">		if(!WrapperUtility.validateUser(ip,bankDepositBean.getSystemUserName(),bankDepositBean.getSystemPassword())){</span>
<span class="nc" id="L714">			bankDepositBean.setErrorCode(&quot;101&quot;);</span>
<span class="nc" id="L715">			bankDepositBean.setSuccess(false);</span>
<span class="nc" id="L716">			return bankDepositBean;</span>
		}
		
<span class="nc" id="L719">		HttpServletRequest request = XFireServletController.getRequest();</span>
<span class="nc" id="L720">          request.setAttribute(&quot;code&quot;, &quot;MGMT&quot;);</span>
<span class="nc" id="L721">          request.setAttribute(&quot;interfaceType&quot;, &quot;API&quot;);</span>
<span class="nc" id="L722">          ServletActionContext.setRequest(request);</span>
<span class="nc" id="L723">          AgentBankDepositHelper helper=new AgentBankDepositHelper();</span>
	     String autoGeneRecieptNoAndId;
	try {
<span class="nc" id="L726">		LmsWrapperServiceApiHelper wrapperHelper=new LmsWrapperServiceApiHelper();</span>
<span class="nc" id="L727">		UserInfoBean userBean = wrapperHelper.getUserDataFromUserId(bankDepositBean.getUserId());</span>
		
<span class="nc" id="L729">		int agentUserId=Integer.parseInt(WrapperUtility.getAgentOrgIdFromAgentUserId(bankDepositBean.getAgentOrgId()+&quot;&quot;));</span>
		
<span class="nc" id="L731">		autoGeneRecieptNoAndId = helper.submitBankDepositAmt(agentUserId,&quot;AGENT&quot;, bankDepositBean.getDepositAmount(),bankDepositBean.getBankRecieptNo(),bankDepositBean.getBankName(),bankDepositBean.getBranchName(),bankDepositBean.getDepositDate(),userBean );</span>
		
<span class="nc" id="L733">		String[] autoGeneReceipt=autoGeneRecieptNoAndId.split(&quot;-&quot;);</span>
<span class="nc" id="L734">		String autoGeneRecieptNo=autoGeneRecieptNoAndId.split(&quot;Nxt&quot;)[1];</span>
<span class="nc" id="L735">		int id=Integer.parseInt(autoGeneRecieptNoAndId.split(&quot;Nxt&quot;)[0]);</span>
<span class="nc" id="L736">		bankDepositBean.setRecieptNo(autoGeneRecieptNo);</span>
<span class="nc" id="L737">		bankDepositBean.setSuccess(true);</span>
<span class="nc" id="L738">		bankDepositBean.setErrorCode(&quot;100&quot;);</span>
<span class="nc" id="L739">	} catch (LMSException e) {</span>
		
<span class="nc" id="L741">		e.printStackTrace();</span>
<span class="nc" id="L742">		bankDepositBean.setSuccess(false);</span>
<span class="nc" id="L743">		bankDepositBean.setErrorCode(&quot;500&quot;);</span>
<span class="nc" id="L744">	}</span>
<span class="nc" id="L745">	System.out.println(&quot;Bank Deposit RESPONSE DATA:: userName=&quot;+bankDepositBean.getSystemUserName()+&quot;|AgentOrgId=&quot;+bankDepositBean.getAgentOrgId()+&quot;|AgentName=&quot;+bankDepositBean.getAgentName()+&quot;|DepositAmount=&quot;+bankDepositBean.getDepositAmount()+&quot;|getRecieptNo=&quot;+bankDepositBean.getRecieptNo()+&quot;|isSuccess=&quot;+bankDepositBean.isSuccess()+&quot;Errorcode=&quot;+bankDepositBean.getErrorCode() );</span>
<span class="nc" id="L746">		return bankDepositBean;		</span>
	}
	
	public String RegisterNewSubUser(LmsWrapperUserDetailsBean wrapperUserDetailsBean){
<span class="nc" id="L750">		String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc bnc" id="L751" title="All 2 branches missed.">		if(!WrapperUtility.validateUser(ip,wrapperUserDetailsBean.getSystemUserName(),wrapperUserDetailsBean.getSystemPassword())){</span>
<span class="nc" id="L752">			wrapperUserDetailsBean.setErrorCode(&quot;101&quot;);</span>
<span class="nc" id="L753">			wrapperUserDetailsBean.setSuccess(false);</span>
<span class="nc" id="L754">			return &quot;101&quot;;</span>
		}
<span class="nc" id="L756">		LmsWrapperUserMgmtHelper helper=new LmsWrapperUserMgmtHelper();</span>
		
<span class="nc" id="L758">		return helper.RegisterNewSubUser(wrapperUserDetailsBean);</span>
		
	}

	
	public HashMap&lt;String,LmsWrapperCashierDrawerDataReportBean&gt; fetchCashierWiseDrawerData(
			LmsWrapperCashierDrawerDataReportBean cashierDrawerDataBean)
			 {
<span class="nc" id="L766">		String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc bnc" id="L767" title="All 2 branches missed.">		if(!WrapperUtility.validateUser(ip,cashierDrawerDataBean.getSystemUserName(),cashierDrawerDataBean.getSystemPassword())){</span>
<span class="nc" id="L768">			cashierDrawerDataBean.setErrorCode(&quot;101&quot;);</span>
<span class="nc" id="L769">			cashierDrawerDataBean.setSuccess(false);</span>
<span class="nc" id="L770">		      return null;</span>
		}
<span class="nc" id="L772">		LmsWrapperCashierDrawerDataAction drawerAction=new LmsWrapperCashierDrawerDataAction();</span>
<span class="nc" id="L773">		HashMap&lt;String,LmsWrapperCashierDrawerDataReportBean&gt; cahierDataMap=new HashMap&lt;String, LmsWrapperCashierDrawerDataReportBean&gt;();</span>
		try {
<span class="nc" id="L775">		cahierDataMap=drawerAction.fetchCashierWiseDrawerData(cashierDrawerDataBean);</span>
		
			
<span class="nc" id="L778">		} catch (NumberFormatException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L780">			e.printStackTrace();</span>
<span class="nc" id="L781">		} catch (LMSException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L783">			e.printStackTrace();</span>
<span class="nc" id="L784">		} catch (ParseException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L786">			e.printStackTrace();</span>
<span class="nc" id="L787">		}</span>
<span class="nc" id="L788">		return cahierDataMap;</span>
	}

	public String collectionAgentWiseWithOpeningBal(
			String orgName)
			 {
<span class="nc" id="L794">		String outstandingBal = &quot;&quot; ;</span>
<span class="nc" id="L795">		HttpServletRequest request = XFireServletController.getRequest();</span>
<span class="nc" id="L796">		HttpSession session = request.getSession() ;</span>
<span class="nc" id="L797">		OrganizationManagementHelper agtHelper = new OrganizationManagementHelper() ;</span>
		try {
<span class="nc" id="L799">			outstandingBal = FormatNumber.formatNumberForJSP(agtHelper.getAgentOutstandingBal(Util.fetchOrgIdOfUser(Integer.parseInt(orgName)), request, session)) ;</span>
<span class="nc" id="L800">		}  catch (Exception e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L802">			e.printStackTrace();</span>
<span class="nc" id="L803">		}</span>
		// TODO Auto-generated method stub
<span class="nc" id="L805">		return outstandingBal;</span>
	}

	
	public LmsWrapperSearchInventoryResponseDataBean consNonConsSearchInvDetail(
			LmsWrapperSearchInventoryRequestDataBean searchInventoryReqBean) {
<span class="nc" id="L811">		LmsWrapperSearchInventoryReportAction searchInvAction=new LmsWrapperSearchInventoryReportAction();</span>
<span class="nc" id="L812">		LmsWrapperSearchInventoryResponseDataBean responseDataBean =new LmsWrapperSearchInventoryResponseDataBean();</span>
		try {
<span class="nc" id="L814">			responseDataBean = searchInvAction.consNonConsSearchInvDetail(searchInventoryReqBean);</span>
<span class="nc" id="L815">		} catch (LMSException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L817">			e.printStackTrace();</span>
<span class="nc" id="L818">		}</span>
<span class="nc" id="L819">		return responseDataBean;</span>
	}

	public ArrayList&lt;LmsWrapperCashierDrawerDataForPWTBean&gt; fetchDataForExportToExcelOfPWT(
			LmsWrapperCashierDrawerDataForPWTBean lmsWrapperCashierDrawerDataForPWTBean) {

<span class="nc" id="L825">		CashChqReportsHelper helper = null;</span>
<span class="nc" id="L826">		SimpleDateFormat sdf=new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L827">		LmsWrapperCashierDrawerDataForPWTBean pwtDataBean=null;</span>
<span class="nc" id="L828">		List&lt;CashierDrawerDataForPWTBean&gt; detailsForPwtTicketsCashierWiseList=null;</span>
<span class="nc" id="L829">		ArrayList&lt;LmsWrapperCashierDrawerDataForPWTBean&gt; lmsWrapperCashierDrawerDataForPWTBeanList=null;</span>
		
<span class="nc" id="L831">		String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc bnc" id="L832" title="All 2 branches missed.">		if (!WrapperUtility.validateUser(ip,</span>
				lmsWrapperCashierDrawerDataForPWTBean.getSystemUserName(),
				lmsWrapperCashierDrawerDataForPWTBean.getSystemPassword())) {
<span class="nc" id="L835">				lmsWrapperCashierDrawerDataForPWTBean.setErrorCode(&quot;101&quot;);</span>
<span class="nc" id="L836">				lmsWrapperCashierDrawerDataForPWTBean.setSuccess(false);</span>
<span class="nc" id="L837">			return null;</span>
		}

		try {
<span class="nc" id="L841">			DateBeans dateBeans=new DateBeans();</span>
<span class="nc" id="L842">			dateBeans.setStartDate(new java.util.Date(sdf.parse(lmsWrapperCashierDrawerDataForPWTBean.getStartDate()).getTime()));</span>
<span class="nc" id="L843">			dateBeans.setEndDate(new java.util.Date(sdf.parse(lmsWrapperCashierDrawerDataForPWTBean.getEndDate()).getTime()));</span>
<span class="nc" id="L844">			helper = new CashChqReportsHelper(dateBeans);</span>
			
<span class="nc bnc" id="L846" title="All 2 branches missed.">			if(&quot;SELF&quot;.equals(lmsWrapperCashierDrawerDataForPWTBean.getCashierType()))</span>
<span class="nc" id="L847">					lmsWrapperCashierDrawerDataForPWTBean.setUserId(WrapperUtility.getUserIdFromUserName(lmsWrapperCashierDrawerDataForPWTBean.getCashierName()));</span>
			
<span class="nc" id="L849">			detailsForPwtTicketsCashierWiseList = helper</span>
					.getDetailsForPwtTicketsCashierWise(dateBeans,
							lmsWrapperCashierDrawerDataForPWTBean
									.getCashierType(),
							lmsWrapperCashierDrawerDataForPWTBean.getUserId());
<span class="nc" id="L854">		} catch (Exception e) {</span>
<span class="nc" id="L855">			e.printStackTrace();</span>
<span class="nc" id="L856">			lmsWrapperCashierDrawerDataForPWTBean.setErrorCode(&quot;101&quot;);</span>
<span class="nc" id="L857">			lmsWrapperCashierDrawerDataForPWTBean.setSuccess(false);</span>
<span class="nc" id="L858">			return null;</span>
<span class="nc" id="L859">		}</span>
		
		
<span class="nc" id="L862">		Iterator&lt;CashierDrawerDataForPWTBean&gt; detailsForPwtTicketsCashierWiseiterator =detailsForPwtTicketsCashierWiseList.iterator();</span>
<span class="nc" id="L863">		lmsWrapperCashierDrawerDataForPWTBeanList=new ArrayList&lt;LmsWrapperCashierDrawerDataForPWTBean&gt;();</span>
<span class="nc bnc" id="L864" title="All 2 branches missed.">		while (detailsForPwtTicketsCashierWiseiterator.hasNext()) {</span>
<span class="nc" id="L865">			pwtDataBean=new LmsWrapperCashierDrawerDataForPWTBean();</span>
<span class="nc" id="L866">			CashierDrawerDataForPWTBean cashierDrawerDataForPWTBean = (CashierDrawerDataForPWTBean) detailsForPwtTicketsCashierWiseiterator</span>
					.next();
<span class="nc" id="L868">			pwtDataBean.setCashierName(cashierDrawerDataForPWTBean.getCashierName());</span>
<span class="nc" id="L869">			pwtDataBean.setUserId(cashierDrawerDataForPWTBean.getUserId());</span>
<span class="nc" id="L870">			pwtDataBean.setTicketNumber(cashierDrawerDataForPWTBean.getTicketNumber());</span>
<span class="nc" id="L871">			pwtDataBean.setGameName(cashierDrawerDataForPWTBean.getGameName());</span>
<span class="nc" id="L872">			pwtDataBean.setClaimedTime(cashierDrawerDataForPWTBean.getClaimedTime().toString());</span>
<span class="nc" id="L873">			pwtDataBean.setClaimedAmount(cashierDrawerDataForPWTBean.getClaimedAmount());</span>
<span class="nc" id="L874">			lmsWrapperCashierDrawerDataForPWTBeanList.add(pwtDataBean);</span>
<span class="nc" id="L875">		}</span>

<span class="nc" id="L877">		return lmsWrapperCashierDrawerDataForPWTBeanList;</span>
	}
	
	@Override
	public LmsWrapperDrawscheduleBeanResult fetchDrawListForResSubmissionForMacNumber(
			LmsWrapperResultSubmissionDrawDataBean resultSubmissionDrawDataBean) {

    	
<span class="nc" id="L885">    	LmsWrapperDrawscheduleBeanResult drawScheduleBeanResult=new LmsWrapperDrawscheduleBeanResult();</span>
<span class="nc" id="L886">    	String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc bnc" id="L887" title="All 2 branches missed.">    	 if(!WrapperUtility.validateUser(ip,resultSubmissionDrawDataBean.getSystemUserName(),resultSubmissionDrawDataBean.getSystemPassword())){</span>
<span class="nc" id="L888">    		 drawScheduleBeanResult.setErrorCode(&quot;101&quot;);</span>
<span class="nc" id="L889">    		 drawScheduleBeanResult.setSuccess(false);</span>
<span class="nc" id="L890"> 			return drawScheduleBeanResult;</span>
 		}
    	
<span class="nc" id="L893">		logger.debug(&quot;INside getManualEntryData&quot;);</span>
<span class="nc" id="L894">		logger.debug(&quot;action call------------------&quot;);</span>
<span class="nc" id="L895">		logger.debug(&quot;Before--&quot; + new Date());</span>
<span class="nc" id="L896">        LmsWrapperDrawGameMgmtHelper helper=new LmsWrapperDrawGameMgmtHelper();</span>
	
<span class="nc" id="L898">        drawScheduleBeanResult=helper.fetchDrawListForMachineResSubmission(resultSubmissionDrawDataBean);</span>
		
<span class="nc" id="L900">		return drawScheduleBeanResult;</span>
	
	}

	@Override
	public String performManualWinningMachineNumberEntry(
			LmsWrapperPerformDrawDataBean performDrawDataBean) {

		  
<span class="nc" id="L909">		   String ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc bnc" id="L910" title="All 2 branches missed.">		   if(!WrapperUtility.validateUser(ip,performDrawDataBean.getSystemUserName(),performDrawDataBean.getSystemPassword())){</span>
	 		  // set code 101 for invalid username or password
<span class="nc" id="L912">				return &quot;101&quot;;</span>
			}
<span class="nc" id="L914">		   LmsWrapperDrawGameMgmtHelper helper=new LmsWrapperDrawGameMgmtHelper();</span>
<span class="nc" id="L915">		   String result=&quot;&quot;;</span>
<span class="nc" id="L916">		   result=helper.performManualWinningMachineNumberEntry(performDrawDataBean);</span>
<span class="nc bnc" id="L917" title="All 2 branches missed.">		   if(&quot;FAILED&quot;.equalsIgnoreCase(result)){</span>
<span class="nc" id="L918">			   return &quot;102&quot;;</span>
		   }
<span class="nc" id="L920">			return result;</span>
	}

	public LmsWrapperToBeCollectedBean fetchToBeCollectedDataForAgent(
			LmsWrapperCollectionReportOverAllBean lmsWrapperCollectionReportOverAllBean) {

<span class="nc" id="L926">		Timestamp strtDate = null;</span>
<span class="nc" id="L927">		Timestamp deployDate = null;</span>
<span class="nc" id="L928">		LmsWrapperToBeCollectedBean lmsWrapperToBeCollectedBean = null;</span>
<span class="nc" id="L929">		LmsWrapperCollectionReportOverAllBean lmsWrapperCollectionReportBean = null;</span>
		//HashMap&lt;Integer, LmsWrapperCollectionReportOverAllBean&gt; resultReportMap = null;
<span class="nc" id="L931">		HashMap&lt;String, LmsWrapperCollectionReportOverAllBean&gt; resultReportMap = null;</span>
<span class="nc" id="L932">		HashMap&lt;String, LmsWrapperCompleteCollectionBean&gt; gameBeanMapForWrapper = null;</span>
		try {
<span class="nc bnc" id="L934" title="All 2 branches missed.">			if (lmsWrapperCollectionReportOverAllBean.getStartDate() != null) {</span>
<span class="nc" id="L935">				strtDate = new Timestamp(new SimpleDateFormat(&quot;yyyy-MM-dd&quot;)</span>
						.parse(
								lmsWrapperCollectionReportOverAllBean
										.getStartDate()).getTime());
<span class="nc" id="L939">				deployDate = new Timestamp(new SimpleDateFormat(</span>
						lmsWrapperCollectionReportOverAllBean
								.getLmsDateFormat()).parse(
						lmsWrapperCollectionReportOverAllBean.getEndDate())
						.getTime());

<span class="nc" id="L945">				ToBeCollectedReportForLagosHelper helper = new ToBeCollectedReportForLagosHelper();</span>
				/*Map&lt;Integer, CollectionReportOverAllBean&gt; resultMap = helper
						.fetchDataForAgent(deployDate, strtDate);*/
				
<span class="nc" id="L949">				Map&lt;String, CollectionReportOverAllBean&gt; resultMap = helper</span>
				.fetchDataForAgent(deployDate, strtDate);

				//resultReportMap = new HashMap&lt;Integer, LmsWrapperCollectionReportOverAllBean&gt;();
<span class="nc" id="L953">				resultReportMap = new HashMap&lt;String, LmsWrapperCollectionReportOverAllBean&gt;();</span>
				/*for (Map.Entry&lt;Integer, CollectionReportOverAllBean&gt; tempEntry : resultMap
						.entrySet()) {*/
<span class="nc bnc" id="L956" title="All 2 branches missed.">				for (Map.Entry&lt;String, CollectionReportOverAllBean&gt; tempEntry : resultMap</span>
						.entrySet()) {
<span class="nc" id="L958">					lmsWrapperCollectionReportBean = new LmsWrapperCollectionReportOverAllBean();</span>
<span class="nc" id="L959">					CollectionReportOverAllBean tempBean = tempEntry.getValue();</span>
<span class="nc" id="L960">					lmsWrapperCollectionReportBean.setOpeningBal(tempBean</span>
							.getOpeningBal());
<span class="nc" id="L962">					lmsWrapperCollectionReportBean.setCash(tempBean.getCash());</span>
<span class="nc" id="L963">					lmsWrapperCollectionReportBean.setCheque(tempBean</span>
							.getCheque());
<span class="nc" id="L965">					lmsWrapperCollectionReportBean.setChequeReturn(tempBean</span>
							.getChequeReturn());
<span class="nc" id="L967">					lmsWrapperCollectionReportBean.setCredit(tempBean</span>
							.getCredit());
<span class="nc" id="L969">					lmsWrapperCollectionReportBean</span>
							.setDebit(tempBean.getDebit());
<span class="nc" id="L971">					lmsWrapperCollectionReportBean.setBankDep(tempBean</span>
							.getBankDep());
<span class="nc" id="L973">					lmsWrapperCollectionReportBean.setDgSale(tempBean</span>
							.getDgSale());
<span class="nc" id="L975">					lmsWrapperCollectionReportBean</span>
							.setDgPwt(tempBean.getDgPwt());
<span class="nc" id="L977">					lmsWrapperCollectionReportBean.setDgCancel(tempBean</span>
							.getDgCancel());
<span class="nc" id="L979">					lmsWrapperCollectionReportBean.setDgDirPlyPwt(tempBean</span>
							.getDgDirPlyPwt());
<span class="nc" id="L981">					lmsWrapperCollectionReportBean.setIwSale(tempBean.getIwSale());</span>
<span class="nc" id="L982">					lmsWrapperCollectionReportBean.setIwPwt(tempBean.getIwPwt());</span>
<span class="nc" id="L983">					lmsWrapperCollectionReportBean.setIwCancel(tempBean.getIwCancel());</span>
<span class="nc" id="L984">					lmsWrapperCollectionReportBean.setIwDirPlyPwt(tempBean.getIwDirPlyPwt());</span>
<span class="nc" id="L985">					lmsWrapperCollectionReportBean.setAgentName(tempBean</span>
							.getAgentName());
<span class="nc" id="L987">					gameBeanMapForWrapper = new HashMap&lt;String, LmsWrapperCompleteCollectionBean&gt;();</span>

<span class="nc bnc" id="L989" title="All 2 branches missed.">					if (tempBean.getGameBeanMap() != null) {</span>
<span class="nc bnc" id="L990" title="All 2 branches missed.">						for (Entry&lt;String, CompleteCollectionBean&gt; innerTempEntry : tempBean</span>
								.getGameBeanMap().entrySet()) {
<span class="nc" id="L992">							LmsWrapperCompleteCollectionBean lmsWrapperCompleteCollectionBean = new LmsWrapperCompleteCollectionBean();</span>
<span class="nc" id="L993">							CompleteCollectionBean innerTempBean = innerTempEntry</span>
									.getValue();
<span class="nc" id="L995">							lmsWrapperCompleteCollectionBean</span>
									.setOrgName(innerTempBean.getOrgName());
<span class="nc" id="L997">							lmsWrapperCompleteCollectionBean</span>
									.setDrawSale(innerTempBean.getDrawSale());
<span class="nc" id="L999">							lmsWrapperCompleteCollectionBean</span>
							.setIwSale(innerTempBean.getIwSale());
<span class="nc" id="L1001">							gameBeanMapForWrapper.put(innerTempEntry.getKey(),</span>
									lmsWrapperCompleteCollectionBean);
<span class="nc" id="L1003">						}</span>
						/*lmsWrapperCollectionReportBean
								.setGameBeanMap(gameBeanMapForWrapper);
						resultReportMap.put(tempEntry.getKey(),
								lmsWrapperCollectionReportBean);*/
					}/* else {
						lmsWrapperCollectionReportBean.setGameBeanMap(gameBeanMapForWrapper);
				resultReportMap.put(tempEntry.getKey(),
						lmsWrapperCollectionReportBean);
						//resultReportMap.remove(tempEntry.getKey());
					}*/
					
<span class="nc" id="L1015">					lmsWrapperCollectionReportBean.setGameBeanMap(gameBeanMapForWrapper);</span>
<span class="nc" id="L1016">					resultReportMap.put(tempEntry.getKey(),lmsWrapperCollectionReportBean);</span>
					
<span class="nc" id="L1018">				}</span>
<span class="nc" id="L1019">				lmsWrapperToBeCollectedBean = new LmsWrapperToBeCollectedBean();</span>
<span class="nc" id="L1020">				lmsWrapperToBeCollectedBean.setAgentMap(resultReportMap);</span>
<span class="nc" id="L1021">				lmsWrapperToBeCollectedBean.setGameNameMap(ReportUtility.allGameMap(new Timestamp(strtDate.getTime()-1000)));</span>
<span class="nc" id="L1022">			} else {</span>
<span class="nc" id="L1023">				logger.debug(&quot;DATE CAME NULL FORM THE OTHER SIDE .....&quot;);</span>
			}
<span class="nc" id="L1025">		} catch (Exception e) {</span>
<span class="nc" id="L1026">			e.printStackTrace();</span>
<span class="nc" id="L1027">		}</span>
<span class="nc" id="L1028">		return lmsWrapperToBeCollectedBean;</span>
	}

	/*public List&lt;LmsWrapperCashierDrawerDataReportBean&gt; fetchCashierWiseDrawerData(LmsWrapperCashierDrawerDataReportBean cashierDrawerDataBean) throws LMSException{
		String ip = XFireServletController.getRequest().getRemoteHost();
		if(!WrapperUtility.validateUser(ip,cashierDrawerDataBean.getSystemUserName(),cashierDrawerDataBean.getSystemPassword())){
			cashierDrawerDataBean.setErrorCode(&quot;101&quot;);
			cashierDrawerDataBean.setSuccess(false);
			throw new LMSException(&quot;Invalid user Name&quot;);
		}
	LmsWrapperCashierDrawerDataAction drawerAction=new LmsWrapperCashierDrawerDataAction();
	
		return drawerAction.fetchCashierWiseDrawerData(cashierDrawerDataBean);
	}*/

	@Override
	public LmsWrapperAllRetInfoBean getAllRetailerUserId(String systemUserName , String systemUserPassword) {

<span class="nc" id="L1046">		String ip = null;</span>
<span class="nc" id="L1047">		LmsWrapperAllRetInfoBean lmsWrapperAllRetInfoBean = null;</span>
		try {
<span class="nc" id="L1049">			logger.info(&quot;Request for getAllRetailerUserId() Initiated @ &quot; + new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;).format(new Timestamp(System.currentTimeMillis()))</span>
			+ &quot;With systemUserName and Password resp.&quot; + systemUserName	+ &quot; &quot; + systemUserPassword);
			
<span class="nc" id="L1052">			ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc" id="L1053">			lmsWrapperAllRetInfoBean = new LmsWrapperAllRetInfoBean();</span>
<span class="nc bnc" id="L1054" title="All 2 branches missed.">			  if(!WrapperUtility.validateUser(ip,systemUserName,systemUserPassword)) {</span>
<span class="nc" id="L1055">				  lmsWrapperAllRetInfoBean.setErrorCode(101);</span>
<span class="nc" id="L1056">				  lmsWrapperAllRetInfoBean.setErrorMessage(&quot;Invalid Authentication &quot;);</span>
<span class="nc" id="L1057">				  throw new LMSException(); // TEMP</span>
			  }else{
<span class="nc" id="L1059">				  lmsWrapperAllRetInfoBean.setAllRetUserId(new LmsWrapperDrawGameMgmtHelper().getAllUserIds());</span>
<span class="nc" id="L1060">				  lmsWrapperAllRetInfoBean.setErrorCode(100);</span>
			  }
<span class="nc" id="L1062">		} catch (LMSException e) {</span>
<span class="nc" id="L1063">			logger.error(&quot;&quot;, e);</span>
<span class="nc" id="L1064">		} catch (Exception e) {</span>
<span class="nc" id="L1065">			logger.error(&quot;&quot;, e);</span>
<span class="nc" id="L1066">		}</span>
<span class="nc" id="L1067">		return lmsWrapperAllRetInfoBean;</span>
	}

	@Override
	public LmsWrapperRandomIdResponseBean updateInsertRandomIdInLMS(LmsWrapperRandomIdRequestBean lmsWrapperRandomIdRequestBean) {

<span class="nc" id="L1073">		String ip = null;</span>
<span class="nc" id="L1074">		String requesInitiateTime = null;</span>
<span class="nc" id="L1075">		LmsWrapperRandomIdResponseBean lmsWrapperRandomIdResponseBean = null; </span>
		try {
<span class="nc" id="L1077">			requesInitiateTime = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;).format(new Timestamp(System.currentTimeMillis()));</span>
<span class="nc" id="L1078">			logger.info(&quot;Request Initiated @ &quot; + requesInitiateTime + &quot;With systemUserName and Password resp.&quot; + lmsWrapperRandomIdRequestBean.getSystemUserName() </span>
					+ &quot; &quot; + lmsWrapperRandomIdRequestBean.getSystemUserPassword());
<span class="nc" id="L1080">			ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc" id="L1081">			lmsWrapperRandomIdResponseBean = new LmsWrapperRandomIdResponseBean();</span>
<span class="nc bnc" id="L1082" title="All 2 branches missed.">			  if(!WrapperUtility.validateUser(ip,lmsWrapperRandomIdRequestBean.getSystemUserName(),lmsWrapperRandomIdRequestBean.getSystemUserPassword())) {</span>
<span class="nc" id="L1083">				  lmsWrapperRandomIdResponseBean.setErrorCode(101);</span>
<span class="nc" id="L1084">				  lmsWrapperRandomIdResponseBean.setErrorMessage(&quot;Invalid Authentication &quot;);</span>
<span class="nc" id="L1085">				  logger.error(&quot;Invalid Authentication &quot;);</span>
<span class="nc" id="L1086">				  throw new LMSException(); // TEMP</span>
			  }else{
<span class="nc" id="L1088">				  new LmsWrapperDrawGameMgmtHelper().updateInsertRandomIdInLMS(lmsWrapperRandomIdRequestBean , lmsWrapperRandomIdResponseBean);</span>
			  }
<span class="nc" id="L1090">		} catch (LMSException e) {</span>
<span class="nc" id="L1091">			logger.error(&quot;EXCEPTION&quot;, e);</span>
<span class="nc" id="L1092">		} catch (Exception e) {</span>
<span class="nc" id="L1093">			logger.error(&quot;EXCEPTION&quot;, e);</span>
<span class="nc" id="L1094">		}</span>
<span class="nc" id="L1095">		return lmsWrapperRandomIdResponseBean;</span>
	}

	@Override
	public LmsWrapperVerifyBeforeShiftRes verifyBeforeShift(LmsWrapperVerifyBeforeShiftReq lmsWrapperVerifyBeforeShiftReq) {

<span class="nc" id="L1101">		String ip = null;</span>
<span class="nc" id="L1102">		int errorCode = 0;</span>
<span class="nc" id="L1103">		String requesInitiateTime = null;</span>
<span class="nc" id="L1104">		LmsWrapperVerifyBeforeShiftRes lmsWrapperVerifyBeforeShiftRes = null; </span>
<span class="nc" id="L1105">		List&lt;LmsWrapperVerifyBeforeShiftBean&gt; orgList = null;</span>
		try {
<span class="nc" id="L1107">			requesInitiateTime = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;).format(new Timestamp(System.currentTimeMillis()));</span>
<span class="nc" id="L1108">			logger.info(&quot;Request Initiated to verifyBeforeShift() @ &quot; + requesInitiateTime + &quot;With systemUserName and Password resp.&quot; + lmsWrapperVerifyBeforeShiftReq.getSysUserName() </span>
					+ &quot; &quot; + lmsWrapperVerifyBeforeShiftReq.getSysUserPass());
			
<span class="nc" id="L1111">			ip = XFireServletController.getRequest().getRemoteHost();</span>
<span class="nc" id="L1112">			lmsWrapperVerifyBeforeShiftRes = new LmsWrapperVerifyBeforeShiftRes();</span>
<span class="nc bnc" id="L1113" title="All 2 branches missed.">			  if(!WrapperUtility.validateUser(ip,lmsWrapperVerifyBeforeShiftReq.getSysUserName(),lmsWrapperVerifyBeforeShiftReq.getSysUserPass())) {</span>
<span class="nc" id="L1114">				  lmsWrapperVerifyBeforeShiftRes.setErrorCode(101);</span>
<span class="nc" id="L1115">				  logger.error(&quot;Invalid Authentication &quot;);</span>
<span class="nc" id="L1116">				  errorCode  = 101;</span>
			  }else{
<span class="nc" id="L1118">				  orgList = new LmsWrapperServiceApiHelper().verifyBeforeShift(lmsWrapperVerifyBeforeShiftReq);</span>
			  }
<span class="nc" id="L1120">		} catch (LMSException e) {</span>
<span class="nc" id="L1121">			errorCode = e.getErrorCode();</span>
<span class="nc" id="L1122">			logger.error(&quot;EXCEPTION&quot;, e);</span>
<span class="nc" id="L1123">		}catch (Exception e) {</span>
<span class="nc bnc" id="L1124" title="All 2 branches missed.">			if(lmsWrapperVerifyBeforeShiftRes == null)</span>
<span class="nc" id="L1125">				lmsWrapperVerifyBeforeShiftRes = new LmsWrapperVerifyBeforeShiftRes();</span>

<span class="nc" id="L1127">			errorCode = LMSErrors.GENERAL_EXCEPTION_ERROR_CODE;</span>
<span class="nc" id="L1128">		}</span>
		
<span class="nc" id="L1130">		lmsWrapperVerifyBeforeShiftRes.setErrorCode(errorCode);</span>
<span class="nc" id="L1131">		lmsWrapperVerifyBeforeShiftRes.setOrgList(orgList);</span>
<span class="nc" id="L1132">		return lmsWrapperVerifyBeforeShiftRes;</span>
	}

	

	public HttpServletRequest getRequest() {
<span class="nc" id="L1138">		return request;</span>
	}

	public void setRequest(HttpServletRequest request) {
<span class="nc" id="L1142">		this.request = request;</span>
<span class="nc" id="L1143">	}</span>

	@Override
	public void setServletResponse(HttpServletResponse response) {
		// TODO Auto-generated method stub
<span class="nc" id="L1148">		this.response = response ;</span>
		
<span class="nc" id="L1150">	}</span>

	public HttpServletResponse getResponse() {
<span class="nc" id="L1153">		return response;</span>
	}

	public void setResponse(HttpServletResponse response) {
<span class="nc" id="L1157">		this.response = response;</span>
<span class="nc" id="L1158">	}</span>

	@Override
	public void setServletRequest(HttpServletRequest request) {
		// TODO Auto-generated method stub
<span class="nc" id="L1163">		this.request = request;</span>
		
<span class="nc" id="L1165">	}</span>
	
	
	
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>