<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NetGamingForRummyHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.ola</a> &gt; <span class="el_source">NetGamingForRummyHelper.java</span></div><h1>NetGamingForRummyHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.ola;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.io.InputStream;
import java.sql.Connection;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.Timestamp;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.api.ola.beans.OlaRummyNGDepositRepBean;
import com.skilrock.lms.api.ola.beans.OlaRummyNGPlrTxnRepBean;
import com.skilrock.lms.api.ola.beans.OlaRummyNGTxnRepBean;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.exception.LMSErrors;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.coreEngine.ola.common.OLAClient;
import com.skilrock.lms.coreEngine.ola.common.OLAConstants;
import com.skilrock.lms.coreEngine.ola.common.OLAUtility;
import com.skilrock.lms.csv.CSVReader;
<span class="nc" id="L36">public class NetGamingForRummyHelper {</span>
	
<span class="nc" id="L38">	private static Log logger =LogFactory.getLog(NetGamingForRummyHelper.class);</span>
	public static void main(String[] args) throws LMSException {
		/*Connection con=DBConnect.getConnection();
		insertPlrDepositDateWise(con);
		*/
	   /* DateFormat dateFormat = new SimpleDateFormat(&quot;yyyy/MM/dd&quot;);
	    Calendar cal = Calendar.getInstance();
	    cal.add(Calendar.DAY_OF_MONTH,-1);
	    endDate=dateFormat.format(new Date(cal.getTimeInMillis()))+&quot;23:59:59&quot;;*/
<span class="nc" id="L47">		 Calendar calStart=Calendar.getInstance();</span>
<span class="nc" id="L48">		 calStart.add(Calendar.DAY_OF_MONTH, -1);</span>
		
<span class="nc" id="L50">		System.out.println(new Date(calStart.getTime().getTime())+&quot; 23:59:59&quot;);</span>
		//insertPlrDepositDateWise(con);
		//insertDepositPlrFromCsv(con);
		//insertWageredPlrFromCsv(con);
		/*Calendar calStart=Calendar.getInstance();
		calStart.add(Calendar.DAY_OF_MONTH, -7);
		Date startDate=new Date(calStart.getTime().getTime());
		System.out.println(&quot;start_date:&quot;+startDate);
		
		calStart.add(Calendar.DAY_OF_MONTH,6);
		Date endDate=new Date(calStart.getTime().getTime());
		System.out.println(&quot;end_date:&quot;+endDate);
		insertRetailerCommWeekely(con,2,startDate,endDate);*/
		//insertPlrConsolidateDeposit(con,startDate,endDate,2,1,2);
		//insertPlrConsolidateCommission(new Date(21),new Date(2024, 1, 1),2,2);
		//insertPlrCommissionDateWise();
		//insertPlrDepositDateWise();
		//Connection con =null;
		try{
<span class="nc" id="L69">			insertNetGamingData();</span>
<span class="nc" id="L70">			String stDate =&quot;2013-07-15&quot;;</span>
<span class="nc" id="L71">			String enDate =&quot;2013-07-21&quot;;</span>
			//SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);
			//new NetGamingForRummyHelper().updateNetGamingDataWeeklyWise(1,2,&quot;CUMMULATIVE&quot;,1,new Date(sdf.parse(stDate).getTime()),new Date(sdf.parse(enDate).getTime()));
<span class="nc" id="L74">		}catch(Exception e){</span>
<span class="nc" id="L75">			logger.error(&quot;Exception &quot;,e);</span>
<span class="nc" id="L76">		}finally{</span>
		//	DBConnect.closeCon(con);
<span class="nc" id="L78">		}</span>
		
<span class="nc" id="L80">	}</span>
	
	public void insertDepositWageredData(File[] filesUpload,String fromDate,String olaNetGamingDistributionModel) throws ParseException, LMSException{
<span class="nc" id="L83">		Connection con=DBConnect.getConnection();</span>
		try {
<span class="nc" id="L85">			con.setAutoCommit(false);</span>
<span class="nc" id="L86">			insertWageredPlrFromCsv(con,filesUpload[0]);</span>
<span class="nc" id="L87">			insertDepositPlrFromCsv(con,filesUpload[1]);</span>
<span class="nc" id="L88">			insertWinningPlrFromCsv(con, filesUpload[2]);</span>
<span class="nc" id="L89">			insertBonusDepositPlrFromCsvModule1(con,filesUpload[3]);</span>
			
<span class="nc" id="L91">			insertPlrDepositDateWise(con);</span>
			
<span class="nc" id="L93">			con.commit();</span>
<span class="nc" id="L94">		} catch (LMSException e) {</span>
<span class="nc" id="L95">			e.printStackTrace();</span>
<span class="nc" id="L96">			throw new LMSException(&quot;Some problem occured while uploding files please check the sequence of files or contact Support Team&quot;);</span>
<span class="nc" id="L97">		}catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L99">			e.printStackTrace();</span>
<span class="nc" id="L100">			throw new LMSException(&quot;Some problem occured while uploding files please check the sequence of files or contact Support Team&quot;);</span>
		}finally{
<span class="nc" id="L102">			try{</span>
<span class="nc" id="L103">				con.close();</span>
<span class="nc" id="L104">			}catch (Exception e) {</span>
<span class="nc" id="L105">				e.printStackTrace();</span>
<span class="nc" id="L106">			}</span>
<span class="nc" id="L107">		}</span>
		
<span class="nc" id="L109">	}</span>
	
	
	public void insertDepositWageredWinningData(File[] filesUpload,String fromDate,String olaNetGamingDistributionModel) throws ParseException{
<span class="nc" id="L113">		Connection con=DBConnect.getConnection();</span>
		try {
<span class="nc" id="L115">			con.setAutoCommit(false);</span>
<span class="nc" id="L116">			insertWageredPlrFromCsv(con,filesUpload[0]);</span>
<span class="nc" id="L117">			insertDepositPlrFromCsv(con,filesUpload[1]);</span>
<span class="nc" id="L118">			insertWinningPlrFromCsv(con, filesUpload[2]);</span>
<span class="nc" id="L119">			insertBonusDepositPlrFromCsv(con,filesUpload[3]);</span>
<span class="nc" id="L120">			insertPlrDepositWageredWinningDateWise(con);</span>
<span class="nc" id="L121">			con.commit();</span>
<span class="nc" id="L122">		} catch (LMSException e) {</span>
<span class="nc" id="L123">			e.printStackTrace();</span>
<span class="nc" id="L124">		}catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L126">			e.printStackTrace();</span>
		}finally{
<span class="nc" id="L128">			try{</span>
<span class="nc" id="L129">				con.close();</span>
<span class="nc" id="L130">			}catch (Exception e) {</span>
<span class="nc" id="L131">				e.printStackTrace();</span>
<span class="nc" id="L132">			}</span>
<span class="nc" id="L133">		}</span>
		
<span class="nc" id="L135">	}</span>
	
	
	public static void insertDepositPlrFromCsv(Connection con,File depositCsvFile) throws LMSException{
        //Connection con=DBConnect.getConnection();
<span class="nc" id="L140">        int count=0;</span>
		try{
<span class="nc" id="L142">			Statement stmt=con.createStatement();</span>
<span class="nc" id="L143">		CSVReader reader = new CSVReader(new FileReader(depositCsvFile));</span>
	    String [] nextLine;
<span class="nc" id="L145">	    String insertDeposit=&quot;insert into st_ola_rummy_plr_deposit_transaction(plr_id,plr_alias,transaction_id,deposit_amount,deposit_mode,date_time) values &quot;;</span>
<span class="nc" id="L146">            StringBuilder sb=new StringBuilder();</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">	    while ((nextLine = reader.readNext()) != null) {</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">	    	if(nextLine.length &lt;=1){</span>
<span class="nc" id="L149">	    		sb.delete(0, sb.length());</span>
<span class="nc" id="L150">	    		break;</span>
	    	}
<span class="nc" id="L152">	    	count++;</span>
	    	String depositMode;
<span class="nc bnc" id="L154" title="All 2 branches missed.">	    	if(&quot;PIN&quot;.equalsIgnoreCase(nextLine[4].trim())){</span>
<span class="nc" id="L155">	    		 depositMode=&quot;Cash Card&quot;;</span>
	    	}else{
<span class="nc" id="L157">	    		depositMode=nextLine[4].trim();</span>
	    	}
	    	
	    	  // nextLine[] is an array of values from the line
<span class="nc" id="L161">	       sb.append(&quot;('&quot;+nextLine[0]+&quot;','&quot;+nextLine[1].trim()+&quot;','&quot;+nextLine[2]+&quot;',&quot;+nextLine[3]+&quot;,'&quot;+depositMode+&quot;','&quot;+nextLine[5]+&quot;'),&quot;);</span>
    	 //System.out.println(&quot;query:&quot;+insertDeposit+sb.toString());
<span class="nc bnc" id="L163" title="All 2 branches missed.">	   if(count==2000){</span>
<span class="nc" id="L164">		   sb.deleteCharAt(sb.length() - 1);</span>
<span class="nc" id="L165">		   System.out.println(&quot;query:&quot;+insertDeposit+sb.toString());</span>
<span class="nc" id="L166">		   stmt.addBatch(insertDeposit+sb.toString());</span>
<span class="nc" id="L167">		   sb.delete(0, sb.length());</span>
<span class="nc" id="L168">		   count=0;</span>
	  }
<span class="nc" id="L170">	    }</span>
	    
<span class="nc bnc" id="L172" title="All 2 branches missed.">	    if(sb.length() &gt; 2){</span>
<span class="nc" id="L173">	    	sb.deleteCharAt(sb.length() - 1);</span>
<span class="nc" id="L174">			   System.out.println(&quot;query:&quot;+insertDeposit+sb.toString());</span>
<span class="nc" id="L175">			   stmt.addBatch(insertDeposit+sb.toString());</span>
<span class="nc" id="L176">			   sb.delete(0, sb.length());</span>
<span class="nc" id="L177">			   count=0;</span>
	    }
	    
<span class="nc" id="L180">	    stmt.executeBatch();</span>
<span class="nc" id="L181">	}catch (FileNotFoundException fe) {</span>
<span class="nc" id="L182">		fe.printStackTrace();</span>
<span class="nc" id="L183">		throw new LMSException();</span>
		// TODO: handle exception
	}
<span class="nc" id="L186">	catch (IOException e) {</span>
<span class="nc" id="L187">		e.printStackTrace();</span>
<span class="nc" id="L188">		throw new LMSException();</span>
		// TODO: handle exception
<span class="nc" id="L190">	} catch (SQLException e) {</span>
		// TODO Auto-generated catch block
<span class="nc" id="L192">		e.printStackTrace();</span>
<span class="nc" id="L193">		throw new LMSException();</span>
<span class="nc" id="L194">	}</span>
<span class="nc" id="L195">		}</span>
	
	
	public static void insertBonusDepositPlrFromCsvModule1(Connection con,File depositCsvFile) throws LMSException, ParseException{
        //Connection con=DBConnect.getConnection();
<span class="nc" id="L200">        int count=0;</span>
		try{
<span class="nc" id="L202">			Statement stmt=con.createStatement();</span>
<span class="nc" id="L203">		CSVReader reader = new CSVReader(new FileReader(depositCsvFile));</span>
	    String [] nextLine;
<span class="nc" id="L205">	    String insertDeposit=&quot;insert into st_ola_rummy_plr_bonus_deposit_transaction(plr_id,plr_alias,promo_code_used,bonus_amount_credit,date_of_issue,expiry_date,total_no_of_chunks,no_of_chunks_released,released_amount) values &quot;;</span>
<span class="nc" id="L206">            StringBuilder sb=new StringBuilder();</span>
<span class="nc" id="L207">            Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L208">            SimpleDateFormat sdf = new SimpleDateFormat(&quot;dd MMM yyyy&quot;);</span>
<span class="nc" id="L209">            Timestamp dateOfIssue = null;</span>
<span class="nc" id="L210">            Timestamp expiryDate = null;</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">	    while ((nextLine = reader.readNext()) != null) {</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">	    	if(nextLine.length &lt;=1){</span>
<span class="nc" id="L213">	    		sb.delete(0, sb.length());</span>
<span class="nc" id="L214">	    		break;</span>
	    	}
<span class="nc" id="L216">	    	count++;</span>
<span class="nc" id="L217">	    	cal.setTimeInMillis(sdf.parse(nextLine[4]).getTime());</span>
<span class="nc" id="L218">	    	dateOfIssue=new Timestamp(cal.getTimeInMillis());</span>
<span class="nc" id="L219">	    	cal.setTimeInMillis(sdf.parse(nextLine[5]).getTime());</span>
<span class="nc" id="L220">	    	expiryDate=new Timestamp(cal.getTimeInMillis());</span>
	    	  // nextLine[] is an array of values from the line
<span class="nc" id="L222">	       sb.append(&quot;('&quot;+nextLine[0]+&quot;','&quot;+nextLine[1].trim()+&quot;','&quot;+nextLine[2]+&quot;',&quot;+nextLine[3]+&quot;,'&quot;+dateOfIssue+&quot;','&quot;+expiryDate+&quot;','&quot;+nextLine[6]+&quot;','&quot;+nextLine[7]+&quot;',&quot;+nextLine[8]+&quot;),&quot;);</span>
    	 //System.out.println(&quot;query:&quot;+insertDeposit+sb.toString());
<span class="nc bnc" id="L224" title="All 2 branches missed.">	   if(count==2000){</span>
<span class="nc" id="L225">		   sb.deleteCharAt(sb.length() - 1);</span>
<span class="nc" id="L226">		   System.out.println(&quot;query:&quot;+insertDeposit+sb.toString());</span>
<span class="nc" id="L227">		   stmt.addBatch(insertDeposit+sb.toString());</span>
<span class="nc" id="L228">		   sb.delete(0, sb.length());</span>
<span class="nc" id="L229">		   count=0;</span>
	  }
	    }
	    
<span class="nc bnc" id="L233" title="All 2 branches missed.">	    if(sb.length() &gt; 2){</span>
<span class="nc" id="L234">	    	sb.deleteCharAt(sb.length() - 1);</span>
<span class="nc" id="L235">			   System.out.println(&quot;query:&quot;+insertDeposit+sb.toString());</span>
<span class="nc" id="L236">			   stmt.addBatch(insertDeposit+sb.toString());</span>
<span class="nc" id="L237">			   sb.delete(0, sb.length());</span>
<span class="nc" id="L238">			   count=0;</span>
	    }
	    
<span class="nc" id="L241">	    stmt.executeBatch();</span>
	    
<span class="nc" id="L243">		}catch (FileNotFoundException fe) {</span>
<span class="nc" id="L244">		fe.printStackTrace();</span>
<span class="nc" id="L245">		throw new LMSException();</span>
		// TODO: handle exception
	}
<span class="nc" id="L248">	catch (IOException e) {</span>
<span class="nc" id="L249">		e.printStackTrace();</span>
<span class="nc" id="L250">		throw new LMSException();</span>
		// TODO: handle exception
<span class="nc" id="L252">	} catch (SQLException e) {</span>
		// TODO Auto-generated catch block
<span class="nc" id="L254">		e.printStackTrace();</span>
<span class="nc" id="L255">		throw new LMSException();</span>
<span class="nc" id="L256">	}</span>
<span class="nc" id="L257">		}</span>
	
	
	public static void insertBonusDepositPlrFromCsv(Connection con,File depositCsvFile) throws LMSException, ParseException{
        //Connection con=DBConnect.getConnection();
<span class="nc" id="L262">        int count=0;</span>
		try{
<span class="nc" id="L264">			Statement stmt=con.createStatement();</span>
<span class="nc" id="L265">		CSVReader reader = new CSVReader(new FileReader(depositCsvFile));</span>
	    String [] nextLine;
<span class="nc" id="L267">	    String insertDeposit=&quot;insert into st_ola_rummy_plr_bonus_deposit_transaction(plr_id,plr_alias,promo_code_used,bonus_amount_credit,date_of_issue,expiry_date,total_no_of_chunks,no_of_chunks_released,released_amount) values &quot;;</span>
<span class="nc" id="L268">            StringBuilder sb=new StringBuilder();</span>
<span class="nc" id="L269">            Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L270">            SimpleDateFormat sdf = new SimpleDateFormat(&quot;dd MMM yyyy&quot;);</span>
<span class="nc" id="L271">            Timestamp dateOfIssue = null;</span>
<span class="nc" id="L272">            Timestamp expiryDate = null;</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">	    while ((nextLine = reader.readNext()) != null) {</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">	    	if(nextLine.length &lt;=1){</span>
<span class="nc" id="L275">	    		sb.delete(0, sb.length());</span>
<span class="nc" id="L276">	    		break;</span>
	    	}
<span class="nc" id="L278">	    	count++;</span>
<span class="nc" id="L279">	    	cal.setTimeInMillis(sdf.parse(nextLine[4]).getTime());</span>
<span class="nc" id="L280">	    	dateOfIssue=new Timestamp(cal.getTimeInMillis());</span>
<span class="nc" id="L281">	    	cal.setTimeInMillis(sdf.parse(nextLine[5]).getTime());</span>
<span class="nc" id="L282">	    	expiryDate=new Timestamp(cal.getTimeInMillis());</span>
	    	  // nextLine[] is an array of values from the line
<span class="nc" id="L284">	       sb.append(&quot;('&quot;+nextLine[0]+&quot;','&quot;+nextLine[1].trim()+&quot;','&quot;+nextLine[2]+&quot;',&quot;+nextLine[3]+&quot;,'&quot;+dateOfIssue+&quot;','&quot;+expiryDate+&quot;','&quot;+nextLine[6]+&quot;','&quot;+nextLine[7]+&quot;',&quot;+nextLine[8]+&quot;),&quot;);</span>
    	 //System.out.println(&quot;query:&quot;+insertDeposit+sb.toString());
<span class="nc bnc" id="L286" title="All 2 branches missed.">	   if(count==2000){</span>
<span class="nc" id="L287">		   sb.deleteCharAt(sb.length() - 1);</span>
<span class="nc" id="L288">		   System.out.println(&quot;query:&quot;+insertDeposit+sb.toString());</span>
<span class="nc" id="L289">		   stmt.addBatch(insertDeposit+sb.toString());</span>
<span class="nc" id="L290">		   sb.delete(0, sb.length());</span>
<span class="nc" id="L291">		   count=0;</span>
	  }
	    }
	    
<span class="nc bnc" id="L295" title="All 2 branches missed.">	    if(sb.length() &gt; 2){</span>
<span class="nc" id="L296">	    	sb.deleteCharAt(sb.length() - 1);</span>
<span class="nc" id="L297">			   System.out.println(&quot;query:&quot;+insertDeposit+sb.toString());</span>
<span class="nc" id="L298">			   stmt.addBatch(insertDeposit+sb.toString());</span>
<span class="nc" id="L299">			   sb.delete(0, sb.length());</span>
<span class="nc" id="L300">			   count=0;</span>
	    }
	    
<span class="nc" id="L303">	    stmt.executeBatch();</span>
	    
<span class="nc" id="L305">	    String insertDepositTransactionQry=&quot;insert into st_ola_rummy_plr_deposit_transaction(plr_id,transaction_id,deposit_amount,deposit_mode,date_time,plr_alias) select plr_id,promo_code_used,bonus_amount_credit,'BONUS_DEPOSIT',date_of_issue,plr_alias from st_ola_rummy_plr_bonus_deposit_transaction where date_of_issue&gt; ifnull((select max(date_time) from st_ola_rummy_plr_deposit_transaction where deposit_mode='BONUS_DEPOSIT'),'2012-06-16')&quot;;</span>
<span class="nc" id="L306">	     Statement insertStmt=con.createStatement();</span>
<span class="nc" id="L307">	     insertStmt.executeUpdate(insertDepositTransactionQry);</span>
		
<span class="nc" id="L309">		}catch (FileNotFoundException fe) {</span>
<span class="nc" id="L310">		fe.printStackTrace();</span>
<span class="nc" id="L311">		throw new LMSException();</span>
		// TODO: handle exception
	}
<span class="nc" id="L314">	catch (IOException e) {</span>
<span class="nc" id="L315">		e.printStackTrace();</span>
<span class="nc" id="L316">		throw new LMSException();</span>
		// TODO: handle exception
<span class="nc" id="L318">	} catch (SQLException e) {</span>
		// TODO Auto-generated catch block
<span class="nc" id="L320">		e.printStackTrace();</span>
<span class="nc" id="L321">		throw new LMSException();</span>
<span class="nc" id="L322">	}</span>
<span class="nc" id="L323">		}</span>
	
	
	public static void insertWageredPlrFromCsv(Connection con,File wageredCsvFile) throws LMSException{
      //  Connection con=DBConnect.getConnection();
<span class="nc" id="L328">        int count=0;</span>
		try{
<span class="nc" id="L330">			Statement stmt=con.createStatement();</span>
<span class="nc" id="L331">		CSVReader reader = new CSVReader(new FileReader(wageredCsvFile));</span>
	    String [] nextLine;
<span class="nc" id="L333">	    String insertWagere=&quot;insert into st_ola_rummy_plr_wagered_transaction &quot; +</span>
		&quot;(plr_id,plr_alias,ref_transaction_id,wagered_amount,table_id,game_id,transaction_type,game_name,date_time,amount_type) values &quot;;
<span class="nc" id="L335">          StringBuilder sb=new StringBuilder();</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">	    while ((nextLine = reader.readNext()) != null) {</span>
<span class="nc" id="L337">	    	count++;</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">	    	if(nextLine.length &lt;=1){</span>
<span class="nc" id="L339">	    		sb.delete(0, sb.length());</span>
<span class="nc" id="L340">	    		break;</span>
	    	}
<span class="nc" id="L342">	      sb.append(&quot;('&quot;+nextLine[0]+&quot;','&quot;+nextLine[1].trim()+&quot;','&quot;+nextLine[2].trim()+&quot;',&quot;+nextLine[3]+&quot;,&quot;+nextLine[4]+&quot;,&quot;+nextLine[5]+&quot;,'&quot;+nextLine[6]+&quot;','&quot;+nextLine[7]+&quot;','&quot;+nextLine[8]+&quot;','&quot;+nextLine[9]+&quot;'),&quot;);</span>

<span class="nc bnc" id="L344" title="All 2 branches missed.">	   if(count==2000){</span>
<span class="nc" id="L345">		   sb.deleteCharAt(sb.length() - 1);</span>
<span class="nc" id="L346">		   System.out.println(&quot;query:&quot;+insertWagere+sb.toString());</span>
<span class="nc" id="L347">		   stmt.addBatch(insertWagere+sb.toString());</span>
<span class="nc" id="L348">		   sb.delete(0, sb.length());</span>
<span class="nc" id="L349">		   count=0;</span>
		  
	   }
	    }
<span class="nc bnc" id="L353" title="All 2 branches missed.">	    if(sb.length() &gt; 2){</span>
<span class="nc" id="L354">	    	sb.deleteCharAt(sb.length() - 1);</span>
<span class="nc" id="L355">			   System.out.println(&quot;query:&quot;+insertWagere+sb.toString());</span>
<span class="nc" id="L356">			   stmt.addBatch(insertWagere+sb.toString());</span>
<span class="nc" id="L357">			   sb.delete(0, sb.length());</span>
<span class="nc" id="L358">			   count=0;</span>
	    }
<span class="nc" id="L360">	    stmt.executeBatch();</span>
<span class="nc" id="L361">	}catch (FileNotFoundException fe) {</span>
		// TODO: handle exception
<span class="nc" id="L363">		throw new LMSException();</span>
	}
<span class="nc" id="L365">	catch (IOException e) {</span>
		// TODO: handle exception
<span class="nc" id="L367">		throw new LMSException();</span>
<span class="nc" id="L368">	} catch (SQLException e) {</span>
		// TODO Auto-generated catch block
<span class="nc" id="L370">		e.printStackTrace();</span>
<span class="nc" id="L371">		throw new LMSException();</span>
<span class="nc" id="L372">	}</span>
<span class="nc" id="L373">   }</span>
	
	
	public static void insertWinningPlrFromCsv(Connection con,File winningCsvFile) throws LMSException{
	      //  Connection con=DBConnect.getConnection();
<span class="nc" id="L378">	        int count=0;</span>
			try{
<span class="nc" id="L380">				Statement stmt=con.createStatement();</span>
<span class="nc" id="L381">			CSVReader reader = new CSVReader(new FileReader(winningCsvFile));</span>
		    String [] nextLine;
<span class="nc" id="L383">		    String insertWinning=&quot;insert into st_ola_rummy_plr_winning_transaction(plr_id,plr_alias,table_id,cash_win_amount,bb_win_amount,chip_win_amount,game_name,date_time) values &quot;;</span>
<span class="nc" id="L384">	          StringBuilder sb=new StringBuilder();</span>
<span class="nc bnc" id="L385" title="All 2 branches missed.">		    while ((nextLine = reader.readNext()) != null) {</span>
<span class="nc" id="L386">		    	count++;</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">		    	if(nextLine.length &lt;=1){</span>
<span class="nc" id="L388">		    		sb.delete(0, sb.length());</span>
<span class="nc" id="L389">		    		break;</span>
		    	}
<span class="nc" id="L391">		      sb.append(&quot;('&quot;+nextLine[0]+&quot;','&quot;+nextLine[1].trim()+&quot;','&quot;+nextLine[2].trim()+&quot;',&quot;+nextLine[3]+&quot;,&quot;+nextLine[4]+&quot;,&quot;+nextLine[5]+&quot;,'&quot;+nextLine[6]+&quot;','&quot;+nextLine[7]+&quot;'),&quot;);</span>

<span class="nc bnc" id="L393" title="All 2 branches missed.">		   if(count==2000){</span>
<span class="nc" id="L394">			   sb.deleteCharAt(sb.length() - 1);</span>
<span class="nc" id="L395">			   System.out.println(&quot;query:&quot;+insertWinning+sb.toString());</span>
<span class="nc" id="L396">			   stmt.addBatch(insertWinning+sb.toString());</span>
<span class="nc" id="L397">			   sb.delete(0, sb.length());</span>
<span class="nc" id="L398">			   count=0;</span>
			  
		   }
		    }
<span class="nc bnc" id="L402" title="All 2 branches missed.">		    if(sb.length() &gt; 2){</span>
<span class="nc" id="L403">		    	sb.deleteCharAt(sb.length() - 1);</span>
<span class="nc" id="L404">				   System.out.println(&quot;query:&quot;+insertWinning+sb.toString());</span>
<span class="nc" id="L405">				   stmt.addBatch(insertWinning+sb.toString());</span>
<span class="nc" id="L406">				   sb.delete(0, sb.length());</span>
<span class="nc" id="L407">				   count=0;</span>
		    }
<span class="nc" id="L409">		    stmt.executeBatch();</span>
<span class="nc" id="L410">		}catch (FileNotFoundException fe) {</span>
			// TODO: handle exception
<span class="nc" id="L412">			throw new LMSException();</span>
		}
<span class="nc" id="L414">		catch (IOException e) {</span>
			// TODO: handle exception
<span class="nc" id="L416">			throw new LMSException();</span>
<span class="nc" id="L417">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L419">			e.printStackTrace();</span>
<span class="nc" id="L420">			throw new LMSException();</span>
<span class="nc" id="L421">		}</span>
<span class="nc" id="L422">	   }</span>
	
	public static void insertPlrDepositWageredWinningDateWise(Connection con){
		//Connection con=DBConnect.getConnection();
<span class="nc" id="L426">		String getLastDate=&quot;select max(date) as date from st_ola_rummy_plr_deposit_datewise&quot;;</span>
		try{
<span class="nc" id="L428">		Statement stmt=con.createStatement();</span>
<span class="nc" id="L429">		ResultSet rs=stmt.executeQuery(getLastDate);</span>
<span class="nc" id="L430">		String last_date=&quot;2000-11-01&quot;;</span>
<span class="nc bnc" id="L431" title="All 2 branches missed.">		if(rs.next()){</span>
<span class="nc bnc" id="L432" title="All 2 branches missed.">			if(rs.getString(&quot;date&quot;) != null){</span>
<span class="nc" id="L433">			last_date=rs.getString(&quot;date&quot;);</span>
			}
		}
<span class="nc" id="L436">		System.out.println(&quot;LAST DATE:&quot;+last_date);</span>
		
<span class="nc" id="L438">		String insertQuery=&quot;insert into st_ola_rummy_plr_deposit_datewise(plr_id,ref_ret_org_id,date,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ola_bind_deposit,tech_process_deposit,ola_non_bind_deposit,bonus_deposit,inhouse_deposit,wire_transfer_deposit,status,total_deposit,total_play,total_winning) select plr_alias,ref_user_org_id,date,sum(debit_card_deposit),sum(credit_card_deposit),sum(net_banking_deposit),sum(cash_card_deposit),sum(ola_bind_deposit),sum(tech_process_deposit),sum(ola_non_bind_deposit),sum(bonus_deposit),sum(inhouse_deposit),sum(wire_transfer_deposit),status,sum(total_deposit) total_deposit,sum(total_play) total_play,sum(total_win) total_win from &quot; </span>
			               +&quot;(select plr_alias,ref_user_org_id,date(date_time) as date,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ifnull(ola_bind_deposit,0.00)ola_bind_deposit,tech_process_deposit,ifnull(ola_non_bind_deposit,0.00)ola_non_bind_deposit,bonus_deposit,inhouse_deposit,wire_transfer_deposit,if(ola_deposit=ifnull(amount,0.00),'MATCHED','UNMATCHED') as status,total_deposit,0 as total_play,0 as total_win from(select plr_alias,sum(total_deposit) as total_deposit,sum(debit_card_deposit)as debit_card_deposit,sum(credit_card_deposit) as credit_card_deposit,sum(net_banking_deposit) as net_banking_deposit,&quot; 
			               +&quot;sum(cash_card_deposit) as cash_card_deposit,sum(ola_deposit) as ola_deposit,sum(tech_process_deposit) tech_process_deposit,sum(bonus_deposit) bonus_deposit,sum(inhouse_deposit) inhouse_deposit,sum(wire_transfer_deposit) wire_transfer_deposit,date_time,ref_user_org_id from( select plr_alias,sum(deposit_amount) as total_deposit,if(deposit_mode='Debit Card',sum(deposit_amount),0.0) as debit_card_deposit,if(deposit_mode='Credit Card',sum(deposit_amount),0.0) as credit_card_deposit,if(deposit_mode='Net Banking',sum(deposit_amount),0.0) as net_banking_deposit,if(deposit_mode='Cash Card',sum(deposit_amount),0.0) as cash_card_deposit,if(deposit_mode='OLA',sum(deposit_amount),0.0) as ola_deposit,&quot; 
			               +&quot;if(deposit_mode='TechProcess',sum(deposit_amount),0.0) as tech_process_deposit,if(deposit_mode='BONUS_DEPOSIT',sum(deposit_amount),0.0) as bonus_deposit,if(deposit_mode='Inhouse',sum(deposit_amount),0.0) as inhouse_deposit,if(deposit_mode='Wire Transfer',sum(deposit_amount),0.0) as wire_transfer_deposit,deposit_mode,date_time,ref_user_org_id from st_ola_rummy_plr_deposit_transaction tt,st_ola_affiliate_plr_mapping mm  where mm.player_id=tt.plr_alias and date(date_time)&gt; '&quot;+last_date+&quot;'  group by plr_alias,deposit_mode,date(date_time) order by date(date_time)) ddd group by plr_alias,date(date_time))deposit_tlb left join (select player_id,sum(ola_non_bind_deposit) as ola_non_bind_deposit,sum(ola_bind_deposit) as ola_bind_deposit,sum(amount) amount,verification_date from(select ifnull(mapTlb.player_id,odTlb.player_id) player_id,&quot; 
			               +&quot;if(ref_user_org_id is NULL,'OLA_Non_Bind','OLA_Bind') as ola_deposit_mode,if(ref_user_org_id is NULL,sum(amount),0.0) as ola_non_bind_deposit,if(ref_user_org_id is NOT NULL,sum(amount),0.0) as ola_bind_deposit,ifnull(ref_user_org_id,retailer_org_id) as ret_org_id,sum(amount) as amount,verification_date,verification_status from st_ola_affiliate_plr_mapping mapTlb right join (select player_id,sum(amount) amount,verification_date,verification_status,retailer_org_id from st_ola_pin_rep_rm_2 rr,st_ola_ret_deposit dd where rr.lms_transaction_id=dd.transaction_id and rr.player_id=dd.party_id and date(rr.verification_date)&gt; '&quot;+last_date+&quot;' and &quot; 
			               +&quot; verification_status='DONE' group by player_id,retailer_org_id,date(verification_date),verification_status ) odTlb on mapTlb.player_id=odTlb.player_id and ref_user_org_id=retailer_org_id group by player_id,date(verification_date),ola_deposit_mode)aaa group by player_id,date(verification_date)) ola_tlb on deposit_tlb.plr_alias=ola_tlb.player_id and date(deposit_tlb.date_time)=date(verification_date) union all select plr_alias,ref_user_org_id,date(date_time) date,0 debit_card_deposit,0 credit_card_deposit,0 net_banking_deposit,0 cash_card_deposit,0 ola_bind_deposit,0 tech_process_deposit,0 ola_non_bind_deposit,0 bonus_deposit,0 inhouse_deposit,0 wire_transfer_deposit,'MATCHED'status,0 total_deposit,&quot; 
			               +&quot;sum(wagered_amount)total_play,0 total_win from st_ola_rummy_plr_wagered_transaction wt inner join st_ola_affiliate_plr_mapping pm on wt.plr_alias=pm.player_id where date(date_time)&gt; '&quot;+last_date+&quot;' group by plr_alias,date(date_time) union all select plr_alias,ref_user_org_id,date(date_time) date,0 debit_card_deposit,0 credit_card_deposit,0 net_banking_deposit,0 cash_card_deposit,0 ola_bind_deposit,0 tech_process_deposit,0 ola_non_bind_deposit,0 bonus_deposit,0 inhouse_deposit,0 wire_transfer_deposit,'MATCHED'status,0 total_deposit,0 total_play,sum(cash_win_amount)+sum(bb_win_amount) total_win from st_ola_rummy_plr_winning_transaction wt inner join st_ola_affiliate_plr_mapping pm on wt.plr_alias=pm.player_id &quot; 
			               +&quot; where date(date_time)&gt; '&quot;+last_date+&quot;' group by plr_alias,date(date_time) )dateWiseTlb where (total_win&gt;0.0 or total_play&gt;0 or total_deposit&gt;0) group by plr_alias,date&quot;;
	
<span class="nc" id="L447">		Statement insertStmt=con.createStatement();</span>
<span class="nc" id="L448">		System.out.println(insertQuery);</span>
<span class="nc" id="L449">		insertStmt.executeUpdate(insertQuery);</span>
		
<span class="nc" id="L451">	}catch (SQLException e) {</span>
<span class="nc" id="L452">		e.printStackTrace();</span>
<span class="nc" id="L453">	}</span>
<span class="nc" id="L454">	}</span>
	
	
	
	public static void insertPlrDepositDateWise(Connection con) throws LMSException{
		//Connection con=DBConnect.getConnection();
<span class="nc" id="L460">		Statement stmt=null;</span>
<span class="nc" id="L461">		ResultSet rs=null;</span>
<span class="nc" id="L462">		String getLastDate=&quot;select max(date) as date from st_ola_rummy_plr_cummulative_deposit_datewise&quot;;</span>
		try{
<span class="nc" id="L464">		stmt=con.createStatement();</span>
<span class="nc" id="L465">		rs=stmt.executeQuery(getLastDate);</span>
<span class="nc" id="L466">		String last_date=&quot;2000-11-01&quot;;</span>
<span class="nc bnc" id="L467" title="All 2 branches missed.">		if(rs.next()){</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">			if(rs.getString(&quot;date&quot;) != null){</span>
<span class="nc" id="L469">			last_date=rs.getString(&quot;date&quot;);</span>
			}
		}
<span class="nc" id="L472">		logger.info(&quot;LAST DATE DateWise:&quot;+last_date);</span>
		
<span class="nc" id="L474">		String insertQuery=&quot; insert into st_ola_rummy_plr_cummulative_deposit_datewise(plr_id,ref_ret_org_id,date,dep_wallet_id,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ola_bind_deposit,tech_process_deposit,ola_non_bind_deposit,wire_transfer_deposit,cheque_transfer_deposit,cash_payment_deposit,status,total_deposit,total_play) &quot; </span>
							+&quot; select plr_alias,ref_user_org_id,date,wallet_id,sum(debit_card_deposit),sum(credit_card_deposit),sum(net_banking_deposit),sum(cash_card_deposit),sum(ola_bind_deposit),sum(tech_process_deposit),sum(ola_non_bind_deposit),sum(wire_transfer_deposit),sum(cheque_transfer_deposit),sum(cash_payment_deposit),status,sum(total_deposit) total_deposit,sum(total_play) total_play from( select plr_alias,ref_user_org_id,date(date_time) as date,deposit_tlb.wallet_id,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ifnull(ola_bind_deposit,0.00)ola_bind_deposit,tech_process_deposit,ifnull(ola_non_bind_deposit,0.00)ola_non_bind_deposit,wire_transfer_deposit,cheque_transfer_deposit,cash_payment_deposit,if(ola_deposit=ifnull(amount,0.00),'MATCHED','UNMATCHED') as status,total_deposit,0 as total_play from(&quot;
							+&quot; select plr_alias,dep_wallet_id wallet_id, sum(total_deposit) as total_deposit,sum(debit_card_deposit)as debit_card_deposit,sum(credit_card_deposit) as credit_card_deposit,sum(net_banking_deposit) as net_banking_deposit, sum(cash_card_deposit) as cash_card_deposit,sum(ola_deposit) as ola_deposit,sum(tech_process_deposit) tech_process_deposit,sum(wire_transfer_deposit) wire_transfer_deposit,sum(cheque_transfer_deposit) cheque_transfer_deposit,sum(cash_payment_deposit) cash_payment_deposit,date_time,ref_user_org_id from( select plr_alias,dep_wallet_id,sum(deposit_amount) as total_deposit,if(deposit_mode='DEBIT CARD',sum(deposit_amount),0.0) as debit_card_deposit,if(deposit_mode='CREDIT CARD',sum(deposit_amount),0.0) as credit_card_deposit,if(deposit_mode='Net Banking',sum(deposit_amount),0.0) as net_banking_deposit,if(deposit_mode='CASH CARD',sum(deposit_amount),0.0) as cash_card_deposit,if(deposit_mode='OLA',sum(deposit_amount),0.0) as ola_deposit, &quot;
							+&quot; if(deposit_mode in('TechProcess','CITRUS','Essecom'),sum(deposit_amount),0.0) as tech_process_deposit,if(deposit_mode='Wire Transfer',sum(deposit_amount),0.0) as wire_transfer_deposit,if(deposit_mode='CHEQUE_TRANS',sum(deposit_amount),0.0) as cheque_transfer_deposit,if(deposit_mode='CASH_PAYMENT',sum(deposit_amount),0.0) as cash_payment_deposit,deposit_mode,date_time,ref_user_org_id from st_ola_rummy_plr_deposit_transaction tt,st_ola_affiliate_plr_mapping mm  where mm.player_id=tt.plr_alias and mm.wallet_id =tt.dep_wallet_id and date(date_time)&gt; '&quot;+last_date+&quot;'   group by plr_alias,deposit_mode,date(date_time),dep_wallet_id order by date(date_time)) ddd group by plr_alias,date(date_time),dep_wallet_id )deposit_tlb left join ( select player_id,sum(ola_non_bind_deposit) as ola_non_bind_deposit,sum(ola_bind_deposit) as ola_bind_deposit,sum(amount) amount,trnDate,wallet_id from( select ifnull(mapTlb.player_id,odTlb.party_id) player_id,if(ref_user_org_id is NULL,'OLA_Non_Bind','OLA_Bind') as ola_deposit_mode,if(ref_user_org_id is NULL,sum(amount),0.0) as ola_non_bind_deposit,if(ref_user_org_id is NOT NULL,sum(amount),0.0) as ola_bind_deposit,ifnull(ref_user_org_id,retailer_org_id) as ret_org_id,sum(amount) as amount,trnDate,odTlb.wallet_id  from st_ola_affiliate_plr_mapping mapTlb right join ( &quot;
							+&quot; select party_id,sum(amount) amount,olaDeposit.retailer_org_id,date(transaction_date) trnDate,olaDeposit.wallet_id from (select  retDep.transaction_id ,retDep.wallet_id,retDep.party_id,sum(retDep.deposit_amt) amount,retDep.retailer_org_id from st_ola_ret_deposit  retDep left join st_ola_ret_deposit_refund retDepRef on ola_ref_transaction_id=retDep.transaction_id where ola_ref_transaction_id is null group by  retDep.party_id,retDep.retailer_org_id,retDep.transaction_id ) olaDeposit inner join st_lms_retailer_transaction_master  tm on  olaDeposit.transaction_id= tm.transaction_id where  date(transaction_date)&gt; '&quot;+last_date+&quot;'  group by party_id,olaDeposit.retailer_org_id,date(transaction_date),olaDeposit.wallet_id ) odTlb  on mapTlb.player_id=odTlb.party_id and ref_user_org_id=retailer_org_id and mapTlb.wallet_id=odTlb.wallet_id group by player_id,trnDate,ola_deposit_mode,odTlb.wallet_id  ) aaa  group by player_id,trnDate,wallet_id ) ola_tlb on deposit_tlb.plr_alias=ola_tlb.player_id and date(deposit_tlb.date_time)=date(trnDate) and deposit_tlb.wallet_id =ola_tlb.wallet_id union all select plr_alias,ref_user_org_id,date(date_time) date,dep_wallet_id wallet_id,0 debit_card_deposit,0 credit_card_deposit,0 net_banking_deposit,0 cash_card_deposit,0 ola_bind_deposit,0 tech_process_deposit,0 ola_non_bind_deposit,0 wire_transfer_deposit,0 cheque_transfer_deposit,0 cash_payment_deposit,'MATCHED'status,0 total_deposit,sum(wagered_amount)total_play from st_ola_rummy_plr_wagered_transaction wt inner join st_ola_affiliate_plr_mapping pm on wt.plr_alias=pm.player_id and wt.dep_wallet_id=pm.wallet_id  where date(date_time)&gt; '&quot;+last_date+&quot;' and (ref_transaction_id &gt;0 ) group by plr_alias,date(date_time),wallet_id &quot;
							+&quot; )dateWiseTlb where ( total_play&gt;0 or total_deposit&gt;0)   group by plr_alias,date,wallet_id &quot;;
		/*String insertQuery=&quot;insert into st_ola_rummy_plr_cummulative_deposit_datewise(plr_id,ref_ret_org_id,date,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ola_bind_deposit,tech_process_deposit,ola_non_bind_deposit,wire_transfer_deposit,status,total_deposit,total_play) select plr_alias,ref_user_org_id,date,sum(debit_card_deposit),sum(credit_card_deposit),sum(net_banking_deposit),sum(cash_card_deposit),sum(ola_bind_deposit),sum(tech_process_deposit),sum(ola_non_bind_deposit),sum(wire_transfer_deposit),status,sum(total_deposit) total_deposit,sum(total_play) total_play from &quot; 
			               +&quot;(select plr_alias,ref_user_org_id,date(date_time) as date,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ifnull(ola_bind_deposit,0.00)ola_bind_deposit,tech_process_deposit,ifnull(ola_non_bind_deposit,0.00)ola_non_bind_deposit,wire_transfer_deposit,if(ola_deposit=ifnull(amount,0.00),'MATCHED','UNMATCHED') as status,total_deposit,0 as total_play from(select plr_alias,sum(total_deposit) as total_deposit,sum(debit_card_deposit)as debit_card_deposit,sum(credit_card_deposit) as credit_card_deposit,sum(net_banking_deposit) as net_banking_deposit,&quot; 
			               +&quot;sum(cash_card_deposit) as cash_card_deposit,sum(ola_deposit) as ola_deposit,sum(tech_process_deposit) tech_process_deposit,sum(wire_transfer_deposit) wire_transfer_deposit,date_time,ref_user_org_id from( select plr_alias,sum(deposit_amount) as total_deposit,if(deposit_mode='Debit Card',sum(deposit_amount),0.0) as debit_card_deposit,if(deposit_mode='Credit Card',sum(deposit_amount),0.0) as credit_card_deposit,if(deposit_mode='Net Banking',sum(deposit_amount),0.0) as net_banking_deposit,if(deposit_mode='Cash Card',sum(deposit_amount),0.0) as cash_card_deposit,if(deposit_mode='OLA',sum(deposit_amount),0.0) as ola_deposit,&quot; 
			               +&quot;if(deposit_mode in('TechProcess','CITRUS','Essecom'),sum(deposit_amount),0.0) as tech_process_deposit,if(deposit_mode='Wire Transfer',sum(deposit_amount),0.0) as wire_transfer_deposit,deposit_mode,date_time,ref_user_org_id from st_ola_rummy_plr_deposit_transaction tt,st_ola_affiliate_plr_mapping mm  where mm.player_id=tt.plr_alias and date(date_time)&gt; '&quot;+last_date+&quot;'  group by plr_alias,deposit_mode,date(date_time) order by date(date_time)) ddd group by plr_alias,date(date_time))deposit_tlb left join (select player_id,sum(ola_non_bind_deposit) as ola_non_bind_deposit,sum(ola_bind_deposit) as ola_bind_deposit,sum(amount) amount,verification_date from(select ifnull(mapTlb.player_id,odTlb.player_id) player_id,&quot; 
			               +&quot;if(ref_user_org_id is NULL,'OLA_Non_Bind','OLA_Bind') as ola_deposit_mode,if(ref_user_org_id is NULL,sum(amount),0.0) as ola_non_bind_deposit,if(ref_user_org_id is NOT NULL,sum(amount),0.0) as ola_bind_deposit,ifnull(ref_user_org_id,retailer_org_id) as ret_org_id,sum(amount) as amount,verification_date,verification_status from st_ola_affiliate_plr_mapping mapTlb right join (select player_id,sum(amount) amount,verification_date,verification_status,retailer_org_id from st_ola_pin_rep_rm_2 rr,st_ola_ret_deposit dd where rr.lms_transaction_id=dd.transaction_id and rr.player_id=dd.party_id and date(rr.verification_date)&gt; '&quot;+last_date+&quot;' and &quot; 
			               +&quot; verification_status='DONE' group by player_id,retailer_org_id,date(verification_date),verification_status ) odTlb on mapTlb.player_id=odTlb.player_id and ref_user_org_id=retailer_org_id group by player_id,date(verification_date),ola_deposit_mode)aaa group by player_id,date(verification_date)) ola_tlb on deposit_tlb.plr_alias=ola_tlb.player_id and date(deposit_tlb.date_time)=date(verification_date) union all select plr_alias,ref_user_org_id,date(date_time) date,0 debit_card_deposit,0 credit_card_deposit,0 net_banking_deposit,0 cash_card_deposit,0 ola_bind_deposit,0 tech_process_deposit,0 ola_non_bind_deposit,0 wire_transfer_deposit,'MATCHED'status,0 total_deposit,&quot; 
			               +&quot;sum(wagered_amount)total_play from st_ola_rummy_plr_wagered_transaction wt inner join st_ola_affiliate_plr_mapping pm on wt.plr_alias=pm.player_id where date(date_time)&gt; '&quot;+last_date+&quot;' and (ref_transaction_id &gt;0 or amount_type='Real Chips') group by plr_alias,date(date_time) )dateWiseTlb where ( total_play&gt;0 or total_deposit&gt;0) group by plr_alias,date&quot;;
		*/
<span class="nc" id="L488">	PreparedStatement insertPstmt=con.prepareStatement(insertQuery);</span>
<span class="nc" id="L489">	logger.info(&quot;insert st_ola_rummy_plr_cummulative_deposit_datewise Qry:&quot;+insertQuery);</span>
<span class="nc" id="L490">	int updatedRow=insertPstmt.executeUpdate();</span>
<span class="nc" id="L491">	logger.info(&quot;row Effected&quot;+updatedRow);</span>
<span class="nc" id="L492">	con.commit();</span>
<span class="nc" id="L493">	}catch(SQLException e){</span>
<span class="nc" id="L494">		logger.error(&quot;SQL Exception&quot;,e);</span>
		try {
<span class="nc" id="L496">			con.rollback();</span>
<span class="nc" id="L497">		} catch (SQLException e1) {</span>
<span class="nc" id="L498">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE,LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L499">		}</span>
<span class="nc" id="L500">		throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE,LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L501">	}catch(Exception e){</span>
<span class="nc" id="L502">		logger.error(&quot; Exception&quot;+e);</span>
<span class="nc" id="L503">		throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE,LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
	}finally{
<span class="nc" id="L505">		DBConnect.closeRs(rs);</span>
<span class="nc" id="L506">		DBConnect.closeStmt(stmt);</span>
<span class="nc" id="L507">	}</span>
<span class="nc" id="L508">	}</span>
	
	
	public void updateNetGamingDataWeeklyWise(int agtTierId,int retTierId,String olaNetGamingDistributionModel,int settlementAfter,Date startDate,Date endDate) throws LMSException{
		
		//System.out.println(&quot;startDate:&quot;+startDate);
		//System.out.println(&quot;endDate:&quot;+endDate);
<span class="nc" id="L515">		logger.info(&quot;updateNetGamingData statDate:&quot;+startDate+&quot; EndDate :&quot;+endDate);</span>
		 
<span class="nc" id="L517">		Connection con=null;</span>
		//Statement stmt=null;
		//ResultSet rsWallet=null;
		try{
		
<span class="nc" id="L522">		con=DBConnect.getConnection();</span>
			
<span class="nc" id="L524">		Date settlementDate=getSettlementDateForPlayerCommission(settlementAfter,con);</span>
		
		//String selectWalletQry=&quot;select wallet_id from st_ola_wallet_master where wallet_status='ACTIVE'&quot;;
		//stmt=con.createStatement();
<span class="nc" id="L528">		con.setAutoCommit(false);</span>
		//rsWallet=stmt.executeQuery(selectWalletQry);
		  //settlementPlayerCommission(con,settlementDate);
<span class="nc bnc" id="L531" title="All 2 branches missed.">		for(Entry&lt;Integer, String&gt; entry :OLAUtility.getOlaWalletDataMap().entrySet()){</span>
<span class="nc" id="L532">			  int walletId=entry.getKey();</span>
<span class="nc bnc" id="L533" title="All 2 branches missed.">			  if(&quot;DEPOSITRATIO&quot;.equalsIgnoreCase(olaNetGamingDistributionModel)){</span>
<span class="nc" id="L534">				  insertPlrConsolidateDeposit(con, startDate, endDate, walletId, agtTierId, retTierId);</span>
<span class="nc" id="L535">				  insertRetailerCommWeekely(con,walletId,startDate,endDate);</span>
<span class="nc bnc" id="L536" title="All 2 branches missed.">			  }else if(&quot;CUMMULATIVE&quot;.equalsIgnoreCase(olaNetGamingDistributionModel)){      </span>
				
<span class="nc bnc" id="L538" title="All 2 branches missed.">				  if(getZeroTimeDate(settlementDate).compareTo(getZeroTimeDate(startDate))==0){</span>
<span class="nc" id="L539">				  settlementPlayerCommission(con,settlementDate);</span>
				  }
				  
<span class="nc" id="L542">				  insertPlrConsolidateCommission(con,startDate,endDate,walletId,agtTierId,retTierId);</span>
<span class="nc" id="L543">				  insertCummulativeRetailerCommWeekely(con,walletId,startDate,endDate);</span>
			  }
			  
			  
			  
<span class="nc" id="L548">		  }</span>
		  
<span class="nc" id="L550">		  con.commit();</span>
		}
<span class="nc" id="L552">		catch (SQLException e) {</span>
<span class="nc" id="L553">		logger.info(&quot;SQL EXCEPTION&quot;,e);</span>
<span class="nc" id="L554">		throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE,LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
		}finally{
<span class="nc" id="L556">			DBConnect.closeCon(con);</span>
						
<span class="nc" id="L558">		}</span>
		
<span class="nc" id="L560">	}</span>
	
     public void updateNetGamingDataMonthlyWise(int agtTierId,int retTierId,String olaNetGamingDistributionModel,int settlementAfter,Date startDate,Date endDate ) throws LMSException{
<span class="nc" id="L563">    	 System.out.println(&quot;startDate:&quot;+startDate);</span>
<span class="nc" id="L564"> 		System.out.println(&quot;endDate:&quot;+endDate);</span>
 		
    	/* Calendar calendar = Calendar.getInstance();
		  int year = calendar.get(Calendar.YEAR);
		  System.out.println(year);
		  int month = calendar.get(Calendar.MONTH);
		  System.out.println(month);
		  int date = 1;
		  
		 
		  calendar.set(year, month-1, date);
		  
		  Date startDate=new Date(calendar.getTime().getTime());
	 		System.out.println(&quot;start_date:&quot;+startDate);
	 		int noOfdays=calendar.getActualMaximum(Calendar.DAY_OF_MONTH);
			  System.out.println(noOfdays);
			  calendar.set(year, month-1, noOfdays);
			  Date endDate=new Date(calendar.getTime().getTime());
		 		System.out.println(&quot;end_date:&quot;+endDate);*/
 		
<span class="nc" id="L584"> 		Connection con=null;</span>
 		//Statement stmt=null;
 		//ResultSet rsWallet=null;
 		try{
<span class="nc" id="L588"> 			con=DBConnect.getConnection();</span>
 		/*String selectWalletQry=&quot;select wallet_id from st_ola_wallet_master where wallet_status='ACTIVE'&quot;;
 		 stmt=con.createStatement();*/
<span class="nc" id="L591"> 		 con.setAutoCommit(false);</span>
 		  //rsWallet=stmt.executeQuery(selectWalletQry);
 		  
<span class="nc bnc" id="L594" title="All 2 branches missed."> 		 for(Entry&lt;Integer, String&gt; entry :OLAUtility.getOlaWalletDataMap().entrySet()){</span>
<span class="nc" id="L595"> 			  int walletId=entry.getKey();</span>
 			  
<span class="nc bnc" id="L597" title="All 2 branches missed."> 			 if(&quot;DEPOSITRATIO&quot;.equalsIgnoreCase(olaNetGamingDistributionModel)){</span>
<span class="nc" id="L598">				  insertPlrConsolidateDeposit(con, startDate, endDate, walletId, agtTierId, retTierId);</span>
<span class="nc bnc" id="L599" title="All 2 branches missed.">			  }else if(&quot;CUMMULATIVE&quot;.equalsIgnoreCase(olaNetGamingDistributionModel)){</span>
<span class="nc" id="L600">				  insertPlrConsolidateCommission(con,startDate,endDate,walletId,agtTierId,retTierId);</span>
			  }
<span class="nc" id="L602"> 			 insertRetailerCommMonthly(con,walletId,startDate,endDate);</span>
 			  
<span class="nc" id="L604"> 		  }</span>
 		  
<span class="nc" id="L606"> 		  con.commit();</span>
 		}
<span class="nc" id="L608"> 		catch (SQLException e) {</span>
<span class="nc" id="L609"> 			e.printStackTrace();</span>
<span class="nc" id="L610"> 		throw new LMSException(&quot;Error in Net Gaming &quot;);</span>
 		}
 		finally{
<span class="nc" id="L613"> 			try{</span>
<span class="nc bnc" id="L614" title="All 4 branches missed."> 				if(con != null){</span>
<span class="nc" id="L615"> 				con.close();</span>
 				}
 			}
<span class="nc" id="L618"> 			catch (Exception e) {</span>
<span class="nc" id="L619"> 				e.printStackTrace();</span>
<span class="nc" id="L620"> 				throw new LMSException();</span>
<span class="nc" id="L621"> 			}</span>
 		}
<span class="nc" id="L623">	}</span>
	
     
     public static void settlementPlayerCommission(Connection con,Date settlementDate) throws LMSException{
<span class="nc" id="L627">    	 String insertSettlementHistoryQry= &quot; insert into st_ola_rummy_plr_deposit_comm_history(plr_id,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ola_bind_deposit,ola_non_bind_deposit,tech_process_deposit,wire_transfer_deposit,cheque_transfer_deposit,cash_payment_deposit,total_deposit,total_play,ret_debit_card_comm,ret_credit_card_comm,ret_net_banking_comm,ret_cash_card_comm,ret_ola_bind_comm,ret_ola_non_bind_comm,ret_tech_process_comm,ret_wire_transfer_comm,ret_cheque_transfer_comm,ret_cash_payment_comm,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_wire_transfer_comm,agt_cheque_transfer_comm,agt_cash_payment_comm,till_date,settlement_upto_date,status) select plr_id,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ola_bind_deposit,ola_non_bind_deposit,tech_process_deposit,wire_transfer_deposit,cheque_transfer_deposit,cash_payment_deposit,total_deposit,total_play,ret_debit_card_comm,ret_credit_card_comm,ret_net_banking_comm,ret_cash_card_comm,ret_ola_bind_comm,ret_ola_non_bind_comm,ret_tech_process_comm,ret_wire_transfer_comm,ret_cheque_transfer_comm,ret_cash_payment_comm,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_wire_transfer_comm,agt_cheque_transfer_comm,agt_cash_payment_comm,till_date,settlement_upto_date,status from st_ola_rummy_plr_deposit_comm_status  &quot;;</span>

    		 
    		 
    	//	 &quot;insert into st_ola_rummy_plr_deposit_comm_history(plr_id,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ola_bind_deposit,ola_non_bind_deposit,tech_process_deposit,wire_transfer_deposit,total_deposit,total_play,ret_debit_card_comm,ret_credit_card_comm,ret_net_banking_comm,ret_cash_card_comm,ret_ola_bind_comm,ret_ola_non_bind_comm,ret_tech_process_comm,ret_wire_transfer_comm,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_wire_transfer_comm,till_date,settlement_upto_date,status) select plr_id,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ola_bind_deposit,ola_non_bind_deposit,tech_process_deposit,wire_transfer_deposit,total_deposit,total_play,ret_debit_card_comm,ret_credit_card_comm,ret_net_banking_comm,ret_cash_card_comm,ret_ola_bind_comm,ret_ola_non_bind_comm,ret_tech_process_comm,ret_wire_transfer_comm,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_wire_transfer_comm,till_date,settlement_upto_date,status from st_ola_rummy_plr_deposit_comm_status&quot;;
    	 
<span class="nc" id="L633">    	 String settlementPlrCommStatusQry= &quot;update st_ola_rummy_plr_deposit_comm_status set total_play=0.0,ret_debit_card_comm=0.0,ret_credit_card_comm=0.0,ret_net_banking_comm=0.0,ret_cash_card_comm=0.0,ret_ola_bind_comm=0.0,ret_ola_non_bind_comm=0.0,ret_tech_process_comm=0.0,ret_wire_transfer_comm=0.0,ret_cheque_transfer_comm=0.0,ret_cash_payment_comm=0.0,agt_debit_card_comm=0.0,agt_credit_card_comm=0.0,agt_net_banking_comm=0.0,agt_cash_card_comm=0.0,agt_ola_bind_comm=0.0,agt_ola_non_bind_comm=0.0,agt_tech_process_comm=0.0,agt_wire_transfer_comm=0.0,agt_cheque_transfer_comm=0.0,agt_cash_payment_comm=0.0,till_date='&quot;+settlementDate+&quot;' - INTERVAL 1 DAY,settlement_upto_date='&quot;+settlementDate+&quot;' - INTERVAL 1 DAY where status='DONE'&quot;;</span>
    		 
    //		 &quot;update st_ola_rummy_plr_deposit_comm_status set total_play=0.0,ret_debit_card_comm=0.0,ret_credit_card_comm=0.0,ret_net_banking_comm=0.0,ret_cash_card_comm=0.0,ret_ola_bind_comm=0.0,ret_ola_non_bind_comm=0.0,ret_tech_process_comm=0.0,ret_wire_transfer_comm=0.0,agt_debit_card_comm=0.0,agt_credit_card_comm=0.0,agt_net_banking_comm=0.0,agt_cash_card_comm=0.0,agt_ola_bind_comm=0.0,agt_ola_non_bind_comm=0.0,agt_tech_process_comm=0.0,agt_wire_transfer_comm=0.0,till_date='&quot;+settlementDate+&quot;' - INTERVAL 1 DAY,settlement_upto_date='&quot;+settlementDate+&quot;' - INTERVAL 1 DAY where status='DONE'&quot;;
<span class="nc" id="L636">    	 Statement stmt =null;</span>
    		try{
    			
<span class="nc" id="L639">    			stmt=con.createStatement();</span>
<span class="nc" id="L640">    			logger.info(&quot;insertSettlementHistoryQry&quot;+insertSettlementHistoryQry);</span>
<span class="nc" id="L641">    			logger.info(&quot;settlementPlrCommStatusQry&quot;+settlementPlrCommStatusQry);</span>
<span class="nc" id="L642">    			stmt.executeUpdate(insertSettlementHistoryQry);</span>
<span class="nc" id="L643">    			stmt.executeUpdate(settlementPlrCommStatusQry);</span>
    			
<span class="nc" id="L645">    		}catch (SQLException e) {</span>
<span class="nc" id="L646">    			logger.info(&quot;SQL Exception&quot;,e);</span>
<span class="nc" id="L647">    			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE,LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
    		}finally{
<span class="nc" id="L649">    			DBConnect.closeStmt(stmt);</span>
<span class="nc" id="L650">    		}</span>
     
     
<span class="nc" id="L653">     }</span>
     //for module1 of net Gaming
	public static void insertPlrConsolidateCommission(Connection con,Date startDate,Date endDate,int wallet_id,int agtTierId,int retTierId) throws LMSException{
				
<span class="nc" id="L657">		String updatePlrStatus=&quot; update st_ola_rummy_plr_deposit_comm_status ss inner join (select * from(select plr_id,dep_wallet_id,date,if(status='MATCHED','CONTINUE','HOLD')status from st_ola_rummy_plr_cummulative_deposit_datewise where date&gt;='&quot;+startDate+&quot;' and date &lt;= '&quot;+endDate+&quot;'  order by status desc) dateWise  group by plr_id,dep_wallet_id ) dd on ss.plr_id=dd.plr_id and ss.dep_wallet_id=dd.dep_wallet_id set ss.status=dd.status &quot;;   </span>
			
			//&quot;update st_ola_rummy_plr_deposit_comm_status ss inner join (select * from(select plr_id,date,if(status='MATCHED','CONTINUE','HOLD')status from st_ola_rummy_plr_cummulative_deposit_datewise where date&gt;='&quot;+startDate+&quot;' and date &lt;= '&quot;+endDate+&quot;'  order by status desc) dateWise  group by plr_id ) dd on ss.plr_id=dd.plr_id  set ss.status=dd.status&quot;;

<span class="nc" id="L661">		String insertRetailerCommQuery=&quot; insert into st_ola_rummy_plr_retailer_commission(plr_id,start_date,end_date,ret_debit_card_comm,ret_credit_card_comm,ret_net_banking_comm,ret_cash_card_comm,ret_ola_bind_comm,ret_ola_non_bind_comm,ret_tech_process_comm,ret_wire_transfer_comm,ret_cheque_transfer_comm,ret_cash_payment_comm)&quot;</span>
									   +&quot; select plr_id,'&quot;+startDate+&quot;','&quot;+endDate+&quot;',((ifnull((debit_card_deposit/total_deposit),0.0)*total_play)*(debit_card_comm_rate*.01))-ret_debit_card_comm as ret_debit_card_comm,((ifnull((credit_card_deposit/total_deposit),0.0)*total_play)*(credit_card_comm_rate*.01)) -ret_credit_card_comm as credit_card_comm,((ifnull((net_banking_deposit/total_deposit),0.0)*total_play)*(net_banking_comm_rate*.01))-ret_net_banking_comm as ret_net_banking_comm,((ifnull((cash_card_deposit/total_deposit),0.0)*total_play)*(cash_card_comm_rate*.01))-ret_cash_card_comm as ret_cash_card_comm,((ifnull((ola_bind_deposit/total_deposit),0.0)*total_play)*(ola_bind_comm_rate*.01))-ret_ola_bind_comm as ret_ola_bind_comm,((ifnull((ola_non_bind_deposit/total_deposit),0.0)*total_play)*(ola_non_bind_comm_rate*.01))-ret_ola_non_bind_comm as ret_ola_non_bind_comm,((ifnull((tech_process_deposit/total_deposit),0.0)*total_play)*(tech_process_comm_rate*.01))-ret_tech_process_comm as ret_tech_process_comm,((ifnull((wire_transfer_deposit/total_deposit),0.0)*total_play)*(wire_transfer_comm_rate*.01))-ret_wire_transfer_comm as ret_wire_transfer_comm,((ifnull((cheque_transfer_deposit/total_deposit),0.0)*total_play)*(cheque_transfer_comm_rate*.01))-ret_cheque_transfer_comm as ret_cheque_transfer_comm,((ifnull((cash_payment_deposit/total_deposit),0.0)*total_play)*(cash_payment_comm_rate*.01))-ret_cash_payment_comm as ret_cash_payment_comm &quot; 
									   +&quot; from(select tlb1.plr_id,tlb1.date,tlb1.dep_wallet_id,ifnull((sum(tlb1.debit_card_deposit)+tlb2.debit_card_deposit),0.0) as debit_card_deposit,ifnull((sum(tlb1.credit_card_deposit)+tlb2.credit_card_deposit),0.0) as credit_card_deposit,ifnull((sum(tlb1.net_banking_deposit)+tlb2.net_banking_deposit),0.0) as net_banking_deposit,ifnull((sum(tlb1.cash_card_deposit)+tlb2.cash_card_deposit),0.0) as cash_card_deposit,ifnull((sum(tlb1.ola_bind_deposit)+tlb2.ola_bind_deposit),0.0) as ola_bind_deposit,ifnull((sum(tlb1.ola_non_bind_deposit)+tlb2.ola_non_bind_deposit),0.0) as ola_non_bind_deposit,ifnull((sum(tlb1.tech_process_deposit)+tlb2.tech_process_deposit),0.0) as tech_process_deposit,ifnull((sum(tlb1.wire_transfer_deposit)+tlb2.wire_transfer_deposit),0.0) as wire_transfer_deposit,ifnull((sum(tlb1.cheque_transfer_deposit)+tlb2.cheque_transfer_deposit),0.0) as cheque_transfer_deposit,ifnull((sum(tlb1.cash_payment_deposit)+tlb2.cash_payment_deposit),0.0) as cash_payment_deposit,ifnull((sum(tlb1.total_deposit)+tlb2.total_deposit),0.0)total_deposit,ifnull((sum(tlb1.total_play)+tlb2.total_play),0.0)total_play,ret_debit_card_comm,ret_credit_card_comm,ret_net_banking_comm,ret_cash_card_comm,ret_ola_bind_comm,ret_ola_non_bind_comm,ret_tech_process_comm,ret_wire_transfer_comm,ret_cheque_transfer_comm,ret_cash_payment_comm,ref_ret_org_id from st_ola_rummy_plr_cummulative_deposit_datewise tlb1 , st_ola_rummy_plr_deposit_comm_status tlb2 &quot; +
									   		&quot;where tlb1.date&gt;='&quot;+startDate+&quot;' and tlb1.date&lt;='&quot;+endDate+&quot;' and tlb1.plr_id=tlb2.plr_id  and tlb1.dep_wallet_id=&quot;+wallet_id+&quot; and tlb2.dep_wallet_id=&quot;+wallet_id+&quot; and tlb2.status='CONTINUE' group by plr_id ) ddd ,st_ola_commission_master cc where cc.wallet_id=&quot;+wallet_id+&quot; and cc.tier_id=&quot;+retTierId;

			
			
			/*&quot;insert into st_ola_rummy_plr_retailer_commission(plr_id,start_date,end_date,ret_debit_card_comm,ret_credit_card_comm,ret_net_banking_comm,ret_cash_card_comm,ret_ola_bind_comm,ret_ola_non_bind_comm,ret_tech_process_comm,ret_wire_transfer_comm)
			 *  select plr_id,'&quot;+startDate+&quot;','&quot;+endDate+&quot;',((ifnull((debit_card_deposit/total_deposit),0.0)*total_play)*(debit_card_comm_rate*.01))-ret_debit_card_comm as ret_debit_card_comm,((ifnull((credit_card_deposit/total_deposit),0.0)*total_play)*(credit_card_comm_rate*.01)) -ret_credit_card_comm as credit_card_comm,((ifnull((net_banking_deposit/total_deposit),0.0)*total_play)*(net_banking_comm_rate*.01))-ret_net_banking_comm as ret_net_banking_comm,((ifnull((cash_card_deposit/total_deposit),0.0)*total_play)*(cash_card_comm_rate*.01))-ret_cash_card_comm as ret_cash_card_comm,((ifnull((ola_bind_deposit/total_deposit),0.0)*total_play)*(ola_bind_comm_rate*.01))-ret_ola_bind_comm as ret_ola_bind_comm,((ifnull((ola_non_bind_deposit/total_deposit),0.0)*total_play)*(ola_non_bind_comm_rate*.01))-ret_ola_non_bind_comm as ret_ola_non_bind_comm,((ifnull((tech_process_deposit/total_deposit),0.0)*total_play)*(tech_process_comm_rate*.01))-ret_tech_process_comm as ret_tech_process_comm,((ifnull((wire_transfer_deposit/total_deposit),0.0)*total_play)*(wire_transfer_comm_rate*.01))-ret_wire_transfer_comm as ret_wire_transfer_comm &quot; 
			                 + &quot;from(select tlb1.plr_id,tlb1.date,ifnull((sum(tlb1.debit_card_deposit)+tlb2.debit_card_deposit),0.0) as debit_card_deposit,ifnull((sum(tlb1.credit_card_deposit)+tlb2.credit_card_deposit),0.0) as credit_card_deposit,ifnull((sum(tlb1.net_banking_deposit)+tlb2.net_banking_deposit),0.0) as net_banking_deposit,ifnull((sum(tlb1.cash_card_deposit)+tlb2.cash_card_deposit),0.0) as cash_card_deposit,ifnull((sum(tlb1.ola_bind_deposit)+tlb2.ola_bind_deposit),0.0) as ola_bind_deposit,ifnull((sum(tlb1.ola_non_bind_deposit)+tlb2.ola_non_bind_deposit),0.0) as ola_non_bind_deposit,ifnull((sum(tlb1.tech_process_deposit)+tlb2.tech_process_deposit),0.0) as tech_process_deposit,ifnull((sum(tlb1.wire_transfer_deposit)+tlb2.wire_transfer_deposit),0.0) as wire_transfer_deposit,ifnull((sum(tlb1.total_deposit)+tlb2.total_deposit),0.0)total_deposit,ifnull((sum(tlb1.total_play)+tlb2.total_play),0.0)total_play,ret_debit_card_comm,ret_credit_card_comm,ret_net_banking_comm,ret_cash_card_comm,ret_ola_bind_comm,ret_ola_non_bind_comm,ret_tech_process_comm,ret_wire_transfer_comm,ref_ret_org_id from st_ola_rummy_plr_cummulative_deposit_datewise tlb1 , st_ola_rummy_plr_deposit_comm_status tlb2 where tlb1.date&gt;='&quot;+startDate+&quot;' and &quot; 
			                 + &quot;tlb1.date&lt;='&quot;+endDate+&quot;' and tlb1.plr_id=tlb2.plr_id and tlb2.status='CONTINUE' group by plr_id) ddd ,st_ola_commission_master cc where cc.wallet_id=&quot;+wallet_id+&quot; and cc.tier_id=&quot;+retTierId;
		*/
		
<span class="nc" id="L674">		String insertAgentCommQuery=&quot; insert into st_ola_rummy_plr_agent_commission(plr_id,start_date,end_date,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_wire_transfer_comm,agt_cheque_transfer_comm,agt_cash_payment_comm)&quot; </span>
									+&quot; select plr_id,'&quot;+startDate+&quot;','&quot;+endDate+&quot;',((ifnull((debit_card_deposit/total_deposit),0.0)*total_play)*(debit_card_comm_rate*.01))-agt_debit_card_comm as agt_debit_card_comm,((ifnull((credit_card_deposit/total_deposit),0.0)*total_play)*(credit_card_comm_rate*.01)) -agt_credit_card_comm as credit_card_comm,((ifnull((net_banking_deposit/total_deposit),0.0)*total_play)*(net_banking_comm_rate*.01))-agt_net_banking_comm as agt_net_banking_comm,((ifnull((cash_card_deposit/total_deposit),0.0)*total_play)*(cash_card_comm_rate*.01))-agt_cash_card_comm as agt_cash_card_comm,((ifnull((ola_bind_deposit/total_deposit),0.0)*total_play)*(ola_bind_comm_rate*.01))-agt_ola_bind_comm as agt_ola_bind_comm,((ifnull((ola_non_bind_deposit/total_deposit),0.0)*total_play)*(ola_non_bind_comm_rate*.01))-agt_ola_non_bind_comm as agt_ola_non_bind_comm,((ifnull((tech_process_deposit/total_deposit),0.0)*total_play)*(tech_process_comm_rate*.01))-agt_tech_process_comm as agt_tech_process_comm,((ifnull((wire_transfer_deposit/total_deposit),0.0)*total_play)*(wire_transfer_comm_rate*.01))-agt_wire_transfer_comm as agt_wire_transfer_comm,((ifnull((cheque_transfer_deposit/total_deposit),0.0)*total_play)*(cheque_transfer_comm_rate*.01))-agt_cheque_transfer_comm as agt_cheque_transfer_comm,((ifnull((cash_payment_deposit/total_deposit),0.0)*total_play)*(cash_payment_comm_rate*.01))-agt_cash_payment_comm as agt_cash_payment_comm&quot;
									+&quot;	from(	select tlb1.plr_id,tlb1.date,ifnull((sum(tlb1.debit_card_deposit)+tlb2.debit_card_deposit),0.0) as debit_card_deposit,ifnull((sum(tlb1.credit_card_deposit)+tlb2.credit_card_deposit),0.0) as credit_card_deposit,ifnull((sum(tlb1.net_banking_deposit)+tlb2.net_banking_deposit),0.0) as net_banking_deposit,ifnull((sum(tlb1.cash_card_deposit)+tlb2.cash_card_deposit),0.0) as cash_card_deposit,ifnull((sum(tlb1.ola_bind_deposit)+tlb2.ola_bind_deposit),0.0) as ola_bind_deposit,ifnull((sum(tlb1.ola_non_bind_deposit)+tlb2.ola_non_bind_deposit),0.0) as ola_non_bind_deposit,ifnull((sum(tlb1.tech_process_deposit)+tlb2.tech_process_deposit),0.0) as tech_process_deposit,ifnull((sum(tlb1.wire_transfer_deposit)+tlb2.wire_transfer_deposit),0.0) as wire_transfer_deposit,ifnull((sum(tlb1.cheque_transfer_deposit)+tlb2.cheque_transfer_deposit),0.0) as cheque_transfer_deposit,ifnull((sum(tlb1.cash_payment_deposit)+tlb2.cash_payment_deposit),0.0) as cash_payment_deposit,ifnull((sum(tlb1.total_deposit)+tlb2.total_deposit),0.0)total_deposit,ifnull((sum(tlb1.total_play)+tlb2.total_play),0.0)total_play,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_wire_transfer_comm,agt_cheque_transfer_comm,agt_cash_payment_comm,ref_ret_org_id from st_ola_rummy_plr_cummulative_deposit_datewise tlb1 , st_ola_rummy_plr_deposit_comm_status tlb2&quot; 
									+ &quot; where tlb1.date&gt;='&quot;+startDate+&quot;' and tlb1.date&lt;='&quot;+endDate+&quot;' and tlb1.plr_id=tlb2.plr_id and tlb1.dep_wallet_id=&quot;+wallet_id+&quot; and tlb2.dep_wallet_id=&quot;+wallet_id+&quot; and tlb2.status='CONTINUE' group by plr_id) ddd ,st_ola_commission_master cc where cc.wallet_id=&quot;+wallet_id+&quot; and cc.tier_id=&quot;+agtTierId; 
			
			
		/*	&quot;insert into st_ola_rummy_plr_agent_commission(plr_id,start_date,end_date,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_wire_transfer_comm)  select plr_id,'&quot;+startDate+&quot;','&quot;+endDate+&quot;',((ifnull((debit_card_deposit/total_deposit),0.0)*total_play)*(debit_card_comm_rate*.01))-agt_debit_card_comm as agt_debit_card_comm,((ifnull((credit_card_deposit/total_deposit),0.0)*total_play)*(credit_card_comm_rate*.01)) -agt_credit_card_comm as credit_card_comm,((ifnull((net_banking_deposit/total_deposit),0.0)*total_play)*(net_banking_comm_rate*.01))-agt_net_banking_comm as agt_net_banking_comm,((ifnull((cash_card_deposit/total_deposit),0.0)*total_play)*(cash_card_comm_rate*.01))-agt_cash_card_comm as agt_cash_card_comm,((ifnull((ola_bind_deposit/total_deposit),0.0)*total_play)*(ola_bind_comm_rate*.01))-agt_ola_bind_comm as agt_ola_bind_comm,((ifnull((ola_non_bind_deposit/total_deposit),0.0)*total_play)*(ola_non_bind_comm_rate*.01))-agt_ola_non_bind_comm as agt_ola_non_bind_comm,((ifnull((tech_process_deposit/total_deposit),0.0)*total_play)*(tech_process_comm_rate*.01))-agt_tech_process_comm as agt_tech_process_comm,((ifnull((wire_transfer_deposit/total_deposit),0.0)*total_play)*(wire_transfer_comm_rate*.01))-agt_wire_transfer_comm as agt_wire_transfer_comm &quot; 
        + &quot;from(select tlb1.plr_id,tlb1.date,ifnull((sum(tlb1.debit_card_deposit)+tlb2.debit_card_deposit),0.0) as debit_card_deposit,ifnull((sum(tlb1.credit_card_deposit)+tlb2.credit_card_deposit),0.0) as credit_card_deposit,ifnull((sum(tlb1.net_banking_deposit)+tlb2.net_banking_deposit),0.0) as net_banking_deposit,ifnull((sum(tlb1.cash_card_deposit)+tlb2.cash_card_deposit),0.0) as cash_card_deposit,ifnull((sum(tlb1.ola_bind_deposit)+tlb2.ola_bind_deposit),0.0) as ola_bind_deposit,ifnull((sum(tlb1.ola_non_bind_deposit)+tlb2.ola_non_bind_deposit),0.0) as ola_non_bind_deposit,ifnull((sum(tlb1.tech_process_deposit)+tlb2.tech_process_deposit),0.0) as tech_process_deposit,ifnull((sum(tlb1.wire_transfer_deposit)+tlb2.wire_transfer_deposit),0.0) as wire_transfer_deposit,ifnull((sum(tlb1.total_deposit)+tlb2.total_deposit),0.0)total_deposit,ifnull((sum(tlb1.total_play)+tlb2.total_play),0.0)total_play,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_wire_transfer_comm,ref_ret_org_id from st_ola_rummy_plr_cummulative_deposit_datewise tlb1 , st_ola_rummy_plr_deposit_comm_status tlb2 where tlb1.date&gt;='&quot;+startDate+&quot;' and &quot; 
        + &quot;tlb1.date&lt;='&quot;+endDate+&quot;' and tlb1.plr_id=tlb2.plr_id and tlb2.status='CONTINUE' group by plr_id) ddd ,st_ola_commission_master cc where cc.wallet_id=&quot;+wallet_id+&quot; and cc.tier_id=&quot;+agtTierId;
*/
		
<span class="nc" id="L685">		String insertDepositCommHistoryQry=&quot; insert into st_ola_rummy_plr_deposit_comm_history(plr_id,dep_wallet_id,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ola_bind_deposit,ola_non_bind_deposit,tech_process_deposit,wire_transfer_deposit,cheque_transfer_deposit,cash_payment_deposit,total_deposit,total_play,ret_debit_card_comm,ret_credit_card_comm,ret_net_banking_comm,ret_cash_card_comm,ret_ola_bind_comm,ret_ola_non_bind_comm,ret_tech_process_comm,ret_wire_transfer_comm,ret_cheque_transfer_comm,ret_cash_payment_comm,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_wire_transfer_comm,agt_cheque_transfer_comm,agt_cash_payment_comm,till_date,settlement_upto_date,status) &quot; +</span>
											&quot; select ss.plr_id,&quot;+wallet_id+&quot;,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ola_bind_deposit,ola_non_bind_deposit,tech_process_deposit,wire_transfer_deposit,cheque_transfer_deposit,cash_payment_deposit,total_deposit,total_play,ss.ret_debit_card_comm,ss.ret_credit_card_comm,ss.ret_net_banking_comm,ss.ret_cash_card_comm,ss.ret_ola_bind_comm,ss.ret_ola_non_bind_comm,ss.ret_tech_process_comm,ss.ret_wire_transfer_comm,ss.ret_cheque_transfer_comm,ss.ret_cash_payment_comm,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_wire_transfer_comm,agt_cheque_transfer_comm,agt_cash_payment_comm,till_date,settlement_upto_date,status from st_ola_rummy_plr_deposit_comm_status ss &quot; +
											&quot; inner join st_ola_rummy_plr_retailer_commission rc on ss.plr_id=rc.plr_id and rc.start_date&gt;='&quot;+startDate+&quot;' and rc.end_date &lt;='&quot; +endDate+ &quot;'&quot;;
			
			
			
			
			/*&quot;insert into st_ola_rummy_plr_deposit_comm_history(plr_id,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ola_bind_deposit,ola_non_bind_deposit,tech_process_deposit,wire_transfer_deposit,total_deposit,total_play,ret_debit_card_comm,ret_credit_card_comm,ret_net_banking_comm,ret_cash_card_comm,ret_ola_bind_comm,ret_ola_non_bind_comm,ret_tech_process_comm,ret_wire_transfer_comm,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_wire_transfer_comm,till_date,settlement_upto_date,status) &quot; 
            +&quot;select ss.plr_id,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ola_bind_deposit,ola_non_bind_deposit,tech_process_deposit,wire_transfer_deposit,total_deposit,total_play,ss.ret_debit_card_comm,ss.ret_credit_card_comm,ss.ret_net_banking_comm,ss.ret_cash_card_comm,ss.ret_ola_bind_comm,ss.ret_ola_non_bind_comm,ss.ret_tech_process_comm,ss.ret_wire_transfer_comm,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_wire_transfer_comm,till_date,settlement_upto_date,status &quot; 
            +&quot;from st_ola_rummy_plr_deposit_comm_status ss inner join st_ola_rummy_plr_retailer_commission rc on ss.plr_id=rc.plr_id and rc.start_date&gt;='&quot;+startDate+&quot;' and rc.end_date &lt;='&quot; +endDate+ &quot;'&quot;;
		*/
		
<span class="nc" id="L697">		String updateDepositCommPlrStatusQry=&quot; update st_ola_rummy_plr_deposit_comm_status stlb inner join ( select cc.plr_id,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ola_bind_deposit,ola_non_bind_deposit,tech_process_deposit,wire_transfer_deposit,total_deposit,total_play,(cc.ret_debit_card_comm+ss.ret_debit_card_comm) ret_debit_card_comm,(cc.ret_credit_card_comm+ss.ret_credit_card_comm) ret_credit_card_comm,(cc.ret_net_banking_comm+ss.ret_net_banking_comm) ret_net_banking_comm,(cc.ret_cash_card_comm+ss.ret_cash_card_comm) ret_cash_card_comm,(cc.ret_ola_bind_comm+ss.ret_ola_bind_comm) ret_ola_bind_comm,(cc.ret_ola_non_bind_comm+ss.ret_ola_non_bind_comm) ret_ola_non_bind_comm,(cc.ret_tech_process_comm+ss.ret_tech_process_comm) ret_tech_process_comm,(cc.ret_wire_transfer_comm+ss.ret_wire_transfer_comm) ret_wire_transfer_comm,(cc.agt_debit_card_comm+ss.agt_debit_card_comm) agt_debit_card_comm,(cc.agt_credit_card_comm+ss.agt_credit_card_comm) agt_credit_card_comm,(cc.agt_net_banking_comm+ss.agt_net_banking_comm) agt_net_banking_comm,(cc.agt_cash_card_comm+ss.agt_cash_card_comm) agt_cash_card_comm,(cc.agt_ola_bind_comm+ss.agt_ola_bind_comm) agt_ola_bind_comm,(cc.agt_ola_non_bind_comm+ss.agt_ola_non_bind_comm) agt_ola_non_bind_comm,(cc.agt_tech_process_comm+ss.agt_tech_process_comm) agt_tech_process_comm,(cc.agt_wire_transfer_comm+ss.agt_wire_transfer_comm) agt_wire_transfer_comm from (select rc.plr_id ,ret_debit_card_comm,ret_credit_card_comm,ret_net_banking_comm,ret_cash_card_comm,ret_ola_bind_comm,ret_ola_non_bind_comm,ret_tech_process_comm,ret_wire_transfer_comm,ret_cheque_transfer_comm,ret_cash_payment_comm,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_wire_transfer_comm,agt_cheque_transfer_comm,agt_cash_payment_comm from st_ola_rummy_plr_retailer_commission rc &quot; +</span>
												&quot; inner join st_ola_rummy_plr_agent_commission ac on rc.plr_id=ac.plr_id and rc.start_date&gt;='&quot;+startDate+&quot;' and rc.end_date &lt;='&quot;+endDate+&quot;' and ac.start_date&gt;='&quot;+startDate+&quot;' and ac.end_date &lt;= '&quot;+endDate+&quot;' and rc.dep_wallet_id=&quot;+wallet_id+&quot; and ac.dep_wallet_id=&quot;+wallet_id+&quot; ) cc inner join ( select tlb1.plr_id as plr_id,tlb1.date,ifnull((sum(tlb1.debit_card_deposit)+tlb2.debit_card_deposit),0.0) as debit_card_deposit,ifnull((sum(tlb1.credit_card_deposit)+tlb2.credit_card_deposit),0.0) as credit_card_deposit,ifnull((sum(tlb1.net_banking_deposit)+tlb2.net_banking_deposit),0.0) as net_banking_deposit,ifnull((sum(tlb1.cash_card_deposit)+tlb2.cash_card_deposit),0.0) as cash_card_deposit,ifnull((sum(tlb1.ola_bind_deposit)+tlb2.ola_bind_deposit),0.0) as ola_bind_deposit,ifnull((sum(tlb1.ola_non_bind_deposit)+tlb2.ola_non_bind_deposit),0.0) as ola_non_bind_deposit,ifnull((sum(tlb1.tech_process_deposit)+tlb2.tech_process_deposit),0.0) as tech_process_deposit,ifnull((sum(tlb1.wire_transfer_deposit)+tlb2.wire_transfer_deposit),0.0) as wire_transfer_deposit,ifnull((sum(tlb1.cheque_transfer_deposit)+tlb2.cheque_transfer_deposit),0.0) as cheque_transfer_deposit,ifnull((sum(tlb1.cash_payment_deposit)+tlb2.cash_payment_deposit),0.0) as cash_payment_deposit,ifnull((sum(tlb1.total_deposit)+tlb2.total_deposit),0.0)total_deposit,ifnull((sum(tlb1.total_play)+tlb2.total_play),0.0)total_play,ret_debit_card_comm,ret_credit_card_comm,ret_net_banking_comm,ret_cash_card_comm,ret_ola_bind_comm,ret_ola_non_bind_comm,ret_tech_process_comm,ret_wire_transfer_comm,ret_cheque_transfer_comm,ret_cash_payment_comm,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_wire_transfer_comm,agt_cheque_transfer_comm,agt_cash_payment_comm,ref_ret_org_id from st_ola_rummy_plr_cummulative_deposit_datewise tlb1 , st_ola_rummy_plr_deposit_comm_status tlb2 &quot; +
												&quot; where  tlb1.date&gt;='&quot;+startDate+&quot;' and tlb1.date&lt;='&quot;+endDate+&quot;' and tlb1.plr_id=tlb2.plr_id and tlb2.status='CONTINUE' and tlb1.dep_wallet_id=&quot;+wallet_id+&quot; and tlb2.dep_wallet_id=&quot;+wallet_id+&quot;  group by plr_id ) ss on cc.plr_id= ss.plr_id) dtlb on  stlb.plr_id=dtlb.plr_id  set stlb.debit_card_deposit=dtlb.debit_card_deposit, stlb.credit_card_deposit =dtlb.credit_card_deposit,stlb.net_banking_deposit=dtlb.net_banking_deposit, stlb.cash_card_deposit  =dtlb.cash_card_deposit,stlb.ola_bind_deposit=dtlb.ola_bind_deposit,stlb.ola_non_bind_deposit  =dtlb.ola_non_bind_deposit,stlb.tech_process_deposit=dtlb.tech_process_deposit,stlb.wire_transfer_deposit=dtlb.wire_transfer_deposit,stlb.total_deposit =dtlb.total_deposit, stlb.total_play=dtlb.total_play, stlb.ret_debit_card_comm=dtlb.ret_debit_card_comm,  stlb.ret_credit_card_comm=dtlb.ret_credit_card_comm,stlb.ret_net_banking_comm=dtlb.ret_net_banking_comm,stlb.ret_cash_card_comm=dtlb.ret_cash_card_comm, stlb.ret_ola_bind_comm=dtlb.ret_ola_bind_comm,  stlb.ret_ola_non_bind_comm=dtlb.ret_ola_non_bind_comm, stlb.ret_tech_process_comm=dtlb.ret_tech_process_comm, stlb.ret_wire_transfer_comm=dtlb.ret_wire_transfer_comm,  stlb.agt_debit_card_comm=dtlb.agt_debit_card_comm,stlb.agt_credit_card_comm=dtlb.agt_credit_card_comm,  stlb.agt_net_banking_comm =dtlb.agt_net_banking_comm, stlb.agt_cash_card_comm=dtlb.agt_cash_card_comm,  stlb.agt_ola_bind_comm=dtlb.agt_ola_bind_comm,stlb.agt_ola_non_bind_comm=dtlb.agt_ola_non_bind_comm,  stlb.agt_tech_process_comm=dtlb.agt_tech_process_comm,  stlb.agt_wire_transfer_comm=dtlb.agt_wire_transfer_comm,stlb.till_date='&quot;+endDate+&quot;',stlb.status='DONE' where stlb.dep_wallet_id=&quot;+wallet_id; 

			
			
			
			/*&quot;update st_ola_rummy_plr_deposit_comm_status stlb inner join ( select cc.plr_id,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ola_bind_deposit,ola_non_bind_deposit,tech_process_deposit,wire_transfer_deposit,total_deposit,total_play,(cc.ret_debit_card_comm+ss.ret_debit_card_comm) ret_debit_card_comm,(cc.ret_credit_card_comm+ss.ret_credit_card_comm) ret_credit_card_comm,(cc.ret_net_banking_comm+ss.ret_net_banking_comm) ret_net_banking_comm,(cc.ret_cash_card_comm+ss.ret_cash_card_comm) ret_cash_card_comm,(cc.ret_ola_bind_comm+ss.ret_ola_bind_comm) ret_ola_bind_comm,(cc.ret_ola_non_bind_comm+ss.ret_ola_non_bind_comm) ret_ola_non_bind_comm,(cc.ret_tech_process_comm+ss.ret_tech_process_comm) ret_tech_process_comm,(cc.ret_wire_transfer_comm+ss.ret_wire_transfer_comm) ret_wire_transfer_comm,(cc.agt_debit_card_comm+ss.agt_debit_card_comm) agt_debit_card_comm,(cc.agt_credit_card_comm+ss.agt_credit_card_comm) agt_credit_card_comm,(cc.agt_net_banking_comm+ss.agt_net_banking_comm) agt_net_banking_comm,(cc.agt_cash_card_comm+ss.agt_cash_card_comm) agt_cash_card_comm,(cc.agt_ola_bind_comm+ss.agt_ola_bind_comm) agt_ola_bind_comm,(cc.agt_ola_non_bind_comm+ss.agt_ola_non_bind_comm) agt_ola_non_bind_comm,(cc.agt_tech_process_comm+ss.agt_tech_process_comm) agt_tech_process_comm,(cc.agt_wire_transfer_comm+ss.agt_wire_transfer_comm) agt_wire_transfer_comm from &quot; 
            +&quot;(select rc.plr_id ,ret_debit_card_comm,ret_credit_card_comm,ret_net_banking_comm,ret_cash_card_comm,ret_ola_bind_comm,ret_ola_non_bind_comm,ret_tech_process_comm,ret_wire_transfer_comm,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_wire_transfer_comm from st_ola_rummy_plr_retailer_commission rc inner join st_ola_rummy_plr_agent_commission ac on rc.plr_id=ac.plr_id and rc.start_date&gt;='&quot;+startDate+&quot;' and rc.end_date &lt;= '&quot;+endDate+&quot;' and ac.start_date&gt;='&quot;+startDate+&quot;' and ac.end_date &lt;= '&quot;+endDate+&quot;') cc inner join (select tlb1.plr_id as plr_id,tlb1.date,ifnull((sum(tlb1.debit_card_deposit)+tlb2.debit_card_deposit),0.0) as debit_card_deposit,ifnull((sum(tlb1.credit_card_deposit)+tlb2.credit_card_deposit),0.0) as credit_card_deposit,ifnull((sum(tlb1.net_banking_deposit)+tlb2.net_banking_deposit),0.0) as net_banking_deposit,ifnull((sum(tlb1.cash_card_deposit)+tlb2.cash_card_deposit),0.0) as cash_card_deposit,ifnull((sum(tlb1.ola_bind_deposit)+tlb2.ola_bind_deposit),0.0) as ola_bind_deposit,ifnull((sum(tlb1.ola_non_bind_deposit)+tlb2.ola_non_bind_deposit),0.0) as ola_non_bind_deposit,ifnull((sum(tlb1.tech_process_deposit)+tlb2.tech_process_deposit),0.0) as tech_process_deposit,ifnull((sum(tlb1.wire_transfer_deposit)+tlb2.wire_transfer_deposit),0.0) as wire_transfer_deposit,ifnull((sum(tlb1.total_deposit)+tlb2.total_deposit),0.0)total_deposit,&quot; 
            + &quot;ifnull((sum(tlb1.total_play)+tlb2.total_play),0.0)total_play,ret_debit_card_comm,ret_credit_card_comm,ret_net_banking_comm,ret_cash_card_comm,ret_ola_bind_comm,ret_ola_non_bind_comm,ret_tech_process_comm,ret_wire_transfer_comm,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_wire_transfer_comm,ref_ret_org_id from st_ola_rummy_plr_cummulative_deposit_datewise tlb1 , st_ola_rummy_plr_deposit_comm_status tlb2 where tlb1.date&gt;='&quot;+startDate+&quot;' and tlb1.date&lt;='&quot;+endDate+&quot;' and tlb1.plr_id=tlb2.plr_id and tlb2.status='CONTINUE' group by plr_id) ss on cc.plr_id= ss.plr_id) dtlb on  stlb.plr_id=dtlb.plr_id set stlb.debit_card_deposit=dtlb.debit_card_deposit, stlb.credit_card_deposit =dtlb.credit_card_deposit,stlb.net_banking_deposit=dtlb.net_banking_deposit, stlb.cash_card_deposit  =dtlb.cash_card_deposit,stlb.ola_bind_deposit=dtlb.ola_bind_deposit,stlb.ola_non_bind_deposit  =dtlb.ola_non_bind_deposit,stlb.tech_process_deposit=dtlb.tech_process_deposit,stlb.wire_transfer_deposit=dtlb.wire_transfer_deposit,stlb.total_deposit =dtlb.total_deposit, stlb.total_play=dtlb.total_play, stlb.ret_debit_card_comm=dtlb.ret_debit_card_comm,  stlb.ret_credit_card_comm=dtlb.ret_credit_card_comm,stlb.ret_net_banking_comm=dtlb.ret_net_banking_comm,  &quot; 
            +&quot;stlb.ret_cash_card_comm=dtlb.ret_cash_card_comm, stlb.ret_ola_bind_comm=dtlb.ret_ola_bind_comm,  stlb.ret_ola_non_bind_comm=dtlb.ret_ola_non_bind_comm, stlb.ret_tech_process_comm=dtlb.ret_tech_process_comm, stlb.ret_wire_transfer_comm=dtlb.ret_wire_transfer_comm,  stlb.agt_debit_card_comm=dtlb.agt_debit_card_comm,stlb.agt_credit_card_comm=dtlb.agt_credit_card_comm,  stlb.agt_net_banking_comm =dtlb.agt_net_banking_comm, stlb.agt_cash_card_comm=dtlb.agt_cash_card_comm,  stlb.agt_ola_bind_comm=dtlb.agt_ola_bind_comm,stlb.agt_ola_non_bind_comm=dtlb.agt_ola_non_bind_comm,  stlb.agt_tech_process_comm=dtlb.agt_tech_process_comm,  stlb.agt_wire_transfer_comm=dtlb.agt_wire_transfer_comm,stlb.till_date='&quot;+endDate+&quot;',stlb.status='DONE'&quot;;
*/
<span class="nc" id="L709">		System.out.println(&quot;UPDATE PLAYER STATUS:&quot;+updatePlrStatus);</span>
<span class="nc" id="L710">		System.out.println(&quot;INSERT COMMISSION QUERY:&quot;+insertRetailerCommQuery);</span>
<span class="nc" id="L711">		System.out.println(&quot;INSERT COMMISSION QUERY:&quot;+insertAgentCommQuery);</span>
<span class="nc" id="L712">		System.out.println(&quot;insert Deposit commission history:&quot;+insertDepositCommHistoryQry);</span>
<span class="nc" id="L713">		System.out.println(&quot;Update plr_deposit status table:&quot;+updateDepositCommPlrStatusQry);</span>

	try{
<span class="nc" id="L716">		Statement stmt=con.createStatement();</span>
<span class="nc" id="L717">	int rowsEffected=stmt.executeUpdate(updatePlrStatus);</span>
<span class="nc" id="L718">	System.out.println(&quot;Update plr_deposit status table:&quot;+rowsEffected);</span>
<span class="nc" id="L719">	rowsEffected=	stmt.executeUpdate(insertRetailerCommQuery);</span>
<span class="nc" id="L720">	System.out.println(&quot;insertRetailerCommQuery:&quot;+rowsEffected);</span>
<span class="nc" id="L721">	rowsEffected=stmt.executeUpdate(insertAgentCommQuery);</span>
<span class="nc" id="L722">	System.out.println(&quot;insertAgentCommQuery:&quot;+rowsEffected);</span>
<span class="nc" id="L723">	rowsEffected=stmt.executeUpdate(insertDepositCommHistoryQry);</span>
<span class="nc" id="L724">	System.out.println(&quot;insertDepositCommHistoryQry:&quot;+rowsEffected);</span>
<span class="nc" id="L725">	rowsEffected=stmt.executeUpdate(updateDepositCommPlrStatusQry);</span>
<span class="nc" id="L726">	System.out.println(&quot;updateDepositCommPlrStatusQry:&quot;+rowsEffected);</span>
<span class="nc" id="L727">	}catch (SQLException e) {</span>
<span class="nc" id="L728">		e.printStackTrace();</span>
<span class="nc" id="L729">		throw new LMSException();</span>
<span class="nc" id="L730">	}</span>
	
<span class="nc" id="L732">	}</span>
	
	public static void insertRetailerCommWeekely(Connection con,int walletId,Date startDate,Date endDate) throws LMSException{
		
<span class="nc" id="L736">		String insertRetailerCommWeekelyExp=&quot;insert into st_ola_retailer_weekly_commission_exp(wallet_id,date,retailer_org_id,net_gaming,agt_comm_amt,ret_comm_amt,refTransactionId,status) select &quot;+walletId+&quot;,'&quot;+endDate+&quot;',ref_ret_org_id,sum(total_play),sum(agt_total_comm),sum(ret_total_comm),0,'PENDING' from( select plr_id,ref_ret_org_id,sum(total_play)total_play,0 agt_total_comm ,0 ret_total_comm  from st_ola_rummy_plr_deposit_datewise &quot; </span>
		                                   +&quot;where date&gt;='&quot;+startDate+&quot;' and date &lt;= '&quot;+endDate+&quot;' group by plr_id union all select plr_id,0 ref_ret_id,0 total_play,0 agt_total_comm,(ret_debit_card_comm+ret_credit_card_comm+ret_net_banking_comm+ret_cash_card_comm+ret_ola_bind_comm+ret_ola_non_bind_comm+ret_tech_process_comm+ret_bonus_comm+ret_inhouse_comm+ret_wire_transfer_comm) as ret_total_comm  from st_ola_rummy_plr_retailer_commission where &quot; 
		                                   +&quot; start_date &gt;= '&quot;+startDate+&quot;' and end_date &lt;='&quot;+endDate+&quot;' union all select plr_id,0 ref_ret_id,0 total_play,(agt_debit_card_comm+agt_credit_card_comm+agt_net_banking_comm+agt_cash_card_comm+agt_ola_bind_comm+agt_ola_non_bind_comm+agt_tech_process_comm+agt_bonus_comm+agt_inhouse_comm+agt_wire_transfer_comm) as agt_total_comm,0 as ret_total_comm  from st_ola_rummy_plr_agent_commission where start_date &gt;= '&quot;+startDate+&quot;' and end_date &lt;='&quot;+endDate+&quot;')mainTlb where (total_play&gt;0 or agt_total_comm&gt;0 or ret_total_comm &gt;0) group by plr_id&quot;;
		
		
		try{
<span class="nc" id="L742">	    PreparedStatement pstmtRet=con.prepareStatement(insertRetailerCommWeekelyExp);</span>
	    //PreparedStatement pstmtAgt=con.prepareStatement(insertAgentCommExp);
<span class="nc" id="L744">	    System.out.println(&quot;insert retailer Comm Exp:&quot;+pstmtRet);</span>
	    //System.out.println(&quot;insert agent Comm Exp:&quot;+pstmtAgt);
<span class="nc" id="L746">	    pstmtRet.executeUpdate();</span>
	   // pstmtAgt.executeUpdate();
	}
<span class="nc" id="L749">	catch (Exception e) {</span>
<span class="nc" id="L750">		e.printStackTrace();</span>
<span class="nc" id="L751">		throw new LMSException();</span>
<span class="nc" id="L752">	}</span>
<span class="nc" id="L753">	}</span>
	
	
	public static void insertCummulativeRetailerCommWeekely(Connection con,int walletId,Date startDate,Date endDate) throws LMSException{
		
<span class="nc" id="L758">		String insertRetailerCommWeekelyExp=&quot;insert into st_ola_retailer_weekly_commission_exp(wallet_id,date,retailer_org_id,net_gaming,agt_comm_amt,ret_comm_amt,refTransactionId,status)&quot; +</span>
											&quot; select &quot;+walletId+&quot;,'&quot;+endDate+&quot;',ref_ret_org_id,sum(total_play),sum(agt_total_comm),sum(ret_total_comm),0,'PENDING' from(select ref_ret_org_id,sum(total_play)total_play,sum(agt_total_comm)agt_total_comm,sum(ret_total_comm)ret_total_comm from( select plr_id,ref_ret_org_id,sum(total_play)total_play,0 agt_total_comm ,0 ret_total_comm  from st_ola_rummy_plr_cummulative_deposit_datewise  where date&gt;='&quot;+startDate+&quot;' and date &lt;= '&quot;+endDate+&quot;' and dep_wallet_id=&quot;+walletId+&quot; group by plr_id union all select plr_id,0 ref_ret_id,0 total_play,0 agt_total_comm,(ret_debit_card_comm+ret_credit_card_comm+ret_net_banking_comm+ret_cash_card_comm+ret_ola_bind_comm+ret_ola_non_bind_comm+ret_tech_process_comm+ret_bonus_comm+ret_inhouse_comm+ret_wire_transfer_comm+ret_cheque_transfer_comm+ret_cash_payment_comm) as ret_total_comm  from st_ola_rummy_plr_retailer_commission where start_date &gt;= '&quot;+startDate+&quot;' and end_date &lt;='&quot;+endDate+&quot;' and dep_wallet_id=&quot;+walletId+&quot;  &quot; +
											&quot; union all select plr_id,0 ref_ret_id,0 total_play,(agt_debit_card_comm+agt_credit_card_comm+agt_net_banking_comm+agt_cash_card_comm+agt_ola_bind_comm+agt_ola_non_bind_comm+agt_tech_process_comm+agt_bonus_comm+agt_inhouse_comm+agt_wire_transfer_comm+agt_cheque_transfer_comm+agt_cash_payment_comm) as agt_total_comm,0 as ret_total_comm  from st_ola_rummy_plr_agent_commission where start_date &gt;= '&quot;+startDate+&quot;' and end_date &lt;='&quot;+endDate+&quot;' and dep_wallet_id=&quot;+walletId+&quot;  )mainTlb&quot; +
											&quot; where (total_play&gt;0 or agt_total_comm!=0 or ret_total_comm !=0) group by plr_id )bbb group by ref_ret_org_id &quot; ;
		
			
			
			
			/*&quot;insert into st_ola_retailer_weekly_commission_exp(wallet_id,date,retailer_org_id,net_gaming,agt_comm_amt,ret_comm_amt,refTransactionId,status) select &quot;+walletId+&quot;,'&quot;+endDate+&quot;',ref_ret_org_id,sum(total_play),sum(agt_total_comm),sum(ret_total_comm),0,'PENDING' from(select ref_ret_org_id,sum(total_play)total_play,sum(agt_total_comm)agt_total_comm,sum(ret_total_comm)ret_total_comm from( select plr_id,ref_ret_org_id,sum(total_play)total_play,0 agt_total_comm ,0 ret_total_comm  from st_ola_rummy_plr_cummulative_deposit_datewise &quot; 
		                                   +&quot;where date&gt;='&quot;+startDate+&quot;' and date &lt;= '&quot;+endDate+&quot;' group by plr_id union all select plr_id,0 ref_ret_id,0 total_play,0 agt_total_comm,(ret_debit_card_comm+ret_credit_card_comm+ret_net_banking_comm+ret_cash_card_comm+ret_ola_bind_comm+ret_ola_non_bind_comm+ret_tech_process_comm+ret_bonus_comm+ret_inhouse_comm+ret_wire_transfer_comm) as ret_total_comm  from st_ola_rummy_plr_retailer_commission where &quot; 
		                                   +&quot; start_date &gt;= '&quot;+startDate+&quot;' and end_date &lt;='&quot;+endDate+&quot;' union all select plr_id,0 ref_ret_id,0 total_play,(agt_debit_card_comm+agt_credit_card_comm+agt_net_banking_comm+agt_cash_card_comm+agt_ola_bind_comm+agt_ola_non_bind_comm+agt_tech_process_comm+agt_bonus_comm+agt_inhouse_comm+agt_wire_transfer_comm) as agt_total_comm,0 as ret_total_comm  from st_ola_rummy_plr_agent_commission where start_date &gt;= '&quot;+startDate+&quot;' and end_date &lt;='&quot;+endDate+&quot;')mainTlb where (total_play&gt;0 or agt_total_comm!=0 or ret_total_comm !=0) group by plr_id )bbb group by ref_ret_org_id&quot;;
		*/
		try{
<span class="nc" id="L771">	    PreparedStatement pstmtRet=con.prepareStatement(insertRetailerCommWeekelyExp);</span>
	    //PreparedStatement pstmtAgt=con.prepareStatement(insertAgentCommExp);
<span class="nc" id="L773">	    System.out.println(&quot;insert retailer Comm Exp:&quot;+pstmtRet);</span>
	    //System.out.println(&quot;insert agent Comm Exp:&quot;+pstmtAgt);
<span class="nc" id="L775">	    int insertedRows = pstmtRet.executeUpdate();</span>
<span class="nc" id="L776">	    System.out.println(&quot;insert retailer Comm Exp Records:&quot;+insertedRows);</span>
	   // pstmtAgt.executeUpdate();
	}
<span class="nc" id="L779">	catch (Exception e) {</span>
<span class="nc" id="L780">		e.printStackTrace();</span>
<span class="nc" id="L781">		throw new LMSException();</span>
<span class="nc" id="L782">	}</span>
<span class="nc" id="L783">	}</span>
	
public static void insertRetailerCommMonthly(Connection con,int walletId,Date startDate,Date endDate) throws LMSException{
		
<span class="nc" id="L787">	String insertRetailerCommMonthlyExp=&quot; insert into st_ola_retailer_monthly_commission_exp(wallet_id,date,retailer_org_id,net_gaming,agt_comm_amt,ret_comm_amt,refTransactionId,status) select &quot;+walletId+&quot;,'&quot;+endDate+&quot;',ref_ret_org_id,sum(total_play),sum(agt_total_comm),sum(ret_total_comm),0,'PENDING' from( &quot; +</span>
										&quot;  select plr_id,ref_ret_org_id,sum(total_play)total_play,0 agt_total_comm ,0 ret_total_comm  from st_ola_rummy_plr_deposit_datewise where date&gt;='&quot;+startDate+&quot;' and date &lt;= '&quot;+endDate+&quot;' and dep_wallet_id=&quot;+walletId+&quot;  group by plr_id&quot; +
										&quot; union all select plr_id,0 ref_ret_id,0 total_play,0 agt_total_comm,(ret_debit_card_comm+ret_credit_card_comm+ret_net_banking_comm+ret_cash_card_comm+ret_ola_bind_comm+ret_ola_non_bind_comm+ret_tech_process_comm+ret_cheque_transfer_comm+ret_cash_payment_comm) as ret_total_comm  from st_ola_rummy_plr_retailer_commission where  start_date &gt;= '&quot;+startDate+&quot;' and end_date &lt;='&quot;+endDate+&quot;' and dep_wallet_id=&quot;+walletId+&quot;&quot; +
												&quot; union all select plr_id,0 ref_ret_id,0 total_play,(agt_debit_card_comm+agt_credit_card_comm+agt_net_banking_comm+agt_cash_card_comm+agt_ola_bind_comm+agt_ola_non_bind_comm+agt_tech_process_comm+agt_cheque_transfer_comm+agt_cash_payment_comm) as agt_total_comm,0 as ret_total_comm  from st_ola_rummy_plr_agent_commission where start_date &gt;= '&quot;+startDate+&quot;' and end_date &lt;='&quot;+endDate+&quot;' and dep_wallet_id=&quot;+walletId+&quot; )mainTlb where (total_play&gt;0 or agt_total_comm&gt;0 or ret_total_comm &gt;0) group by plr_id&quot;;
		
		
		
		/*&quot;insert into st_ola_retailer_monthly_commission_exp(wallet_id,date,retailer_org_id,net_gaming,agt_comm_amt,ret_comm_amt,refTransactionId,status) select &quot;+walletId+&quot;,'&quot;+endDate+&quot;',ref_ret_org_id,sum(total_play),sum(agt_total_comm),sum(ret_total_comm),0,'PENDING' from( select plr_id,ref_ret_org_id,sum(total_play)total_play,0 agt_total_comm ,0 ret_total_comm  from st_ola_rummy_plr_deposit_datewise &quot; 
    +&quot;where date&gt;='&quot;+startDate+&quot;' and date &lt;= '&quot;+endDate+&quot;' group by plr_id union all select plr_id,0 ref_ret_id,0 total_play,0 agt_total_comm,(ret_debit_card_comm+ret_credit_card_comm+ret_net_banking_comm+ret_cash_card_comm+ret_ola_bind_comm+ret_ola_non_bind_comm+ret_tech_process_comm) as ret_total_comm  from st_ola_rummy_plr_retailer_commission where &quot; 
    +&quot; start_date &gt;= '&quot;+startDate+&quot;' and end_date &lt;='&quot;+endDate+&quot;' union all select plr_id,0 ref_ret_id,0 total_play,(agt_debit_card_comm+agt_credit_card_comm+agt_net_banking_comm+agt_cash_card_comm+agt_ola_bind_comm+agt_ola_non_bind_comm+agt_tech_process_comm) as agt_total_comm,0 as ret_total_comm  from st_ola_rummy_plr_agent_commission where start_date &gt;= '&quot;+startDate+&quot;' and end_date &lt;='&quot;+endDate+&quot;')mainTlb where (total_play&gt;0 or agt_total_comm&gt;0 or ret_total_comm &gt;0) group by plr_id&quot;;
*/
	   	try{
<span class="nc" id="L799">	    PreparedStatement pstmtRet=con.prepareStatement(insertRetailerCommMonthlyExp);</span>
	   // PreparedStatement pstmtAgt=con.prepareStatement(insertAgentCommExp);
<span class="nc" id="L801">	    System.out.println(&quot;insert retailer Comm Exp:&quot;+pstmtRet);</span>
	    //System.out.println(&quot;insert agent Comm Exp:&quot;+pstmtAgt);
<span class="nc" id="L803">	    pstmtRet.executeUpdate(); </span>
	   // pstmtAgt.executeUpdate();
	}
<span class="nc" id="L806">	catch (Exception e) {</span>
<span class="nc" id="L807">		e.printStackTrace();</span>
<span class="nc" id="L808">		throw new LMSException();</span>
<span class="nc" id="L809">	}</span>
<span class="nc" id="L810">	}</span>





// for module2 of Net Gaming

public static void insertPlrConsolidateDeposit(Connection con,Date startDate,Date endDate,int wallet_id,int agtTierId,int retTierId) throws LMSException{
	
<span class="nc" id="L820">	String updatePlrStatus=&quot;update st_ola_rummy_plr_deposit_status ss inner join (select * from(select plr_id,date,if(status='MATCHED','CONTINUE','HOLD')status from st_ola_rummy_plr_deposit_datewise where date&gt;='&quot;+startDate+&quot;' and date &lt;= '&quot;+endDate+&quot;'  order by status desc) dateWise  group by plr_id ) dd on ss.plr_id=dd.plr_id  set ss.status=dd.status&quot;;</span>
	
<span class="nc" id="L822">	String insertRetailerCommQuery=&quot;insert into st_ola_rummy_plr_retailer_commission(plr_id,start_date,end_date,ret_debit_card_comm,ret_credit_card_comm,ret_net_banking_comm,ret_cash_card_comm,ret_ola_bind_comm,ret_ola_non_bind_comm,ret_tech_process_comm,ret_bonus_comm,ret_inhouse_comm,ret_wire_transfer_comm) select plr_id,'&quot;+startDate+&quot;','&quot;+endDate+&quot;',&quot; </span>
                                  +	&quot;((debit_card_deposit/total_deposit)*total_play*debit_card_comm_rate*.01) debit_card_comm,((credit_card_deposit/total_deposit)*total_play*credit_card_comm_rate*.01) credit_card_comm,((net_banking_deposit/total_deposit)*total_play*net_banking_comm_rate*.01) net_banking_comm,&quot; 
                                  +	&quot;((cash_card_deposit/total_deposit)*total_play*debit_card_comm_rate*.01) cash_card_comm,((ola_bind_deposit/total_deposit)*total_play*ola_bind_comm_rate*.01) ola_bind_comm,((ola_non_bind_deposit/total_deposit)*total_play*ola_non_bind_comm_rate*.01) ola_non_bind_comm,&quot; 
                                  +	&quot;((tech_process_deposit/total_deposit)*total_play*tech_process_comm_rate*.01) tech_process_comm,((bonus_deposit/total_deposit)*total_play*bonus_comm_rate*.01) bonus_comm,((inhouse_deposit/total_deposit)*total_play*inhouse_comm_rate*.01) inhouse_comm,((wire_transfer_deposit/total_deposit)*total_play*wire_transfer_comm_rate*.01) wire_transfer_comm from(select dd.plr_id,(sum(dd.debit_card_deposit) + ss.debit_card_deposit) as debit_card_deposit,(sum(dd.credit_card_deposit) + ss.credit_card_deposit) as credit_card_deposit,&quot; 
                                  +	&quot;(sum(dd.net_banking_deposit) + ss.net_banking_deposit) as net_banking_deposit,(sum(dd.cash_card_deposit) + ss.cash_card_deposit) as cash_card_deposit,(sum(dd.ola_bind_deposit) + ss.ola_bind_deposit) as ola_bind_deposit ,(sum(dd.ola_non_bind_deposit) + ss.ola_non_bind_deposit) as ola_non_bind_deposit,(sum(dd.tech_process_deposit) + ss.tech_process_deposit) as tech_process_deposit,(sum(dd.bonus_deposit) + ss.bonus_deposit) as bonus_deposit,(sum(dd.inhouse_deposit) + ss.inhouse_deposit) as inhouse_deposit,(sum(dd.wire_transfer_deposit) + ss.wire_transfer_deposit) as wire_transfer_deposit,(sum(dd.total_deposit) + ss.total_deposit) as total_deposit,sum(total_play) total_play,sum(dd.total_deposit)+ ss.total_deposit+sum(total_winning)-sum(total_play) balance from st_ola_rummy_plr_deposit_datewise dd ,st_ola_rummy_plr_deposit_status ss where dd.plr_id=ss.plr_id and date&gt;='&quot;+startDate+&quot;' and date &lt;= '&quot;+endDate+&quot;' and dd.status='MATCHED' group by plr_id)depositTlb inner join st_ola_commission_master cc where wallet_id=&quot;+wallet_id+&quot; and tier_id=&quot;+retTierId;

<span class="nc" id="L828">	String insertAgentCommQuery=&quot;insert into st_ola_rummy_plr_agent_commission(plr_id,start_date,end_date,agt_debit_card_comm,agt_credit_card_comm,agt_net_banking_comm,agt_cash_card_comm,agt_ola_bind_comm,agt_ola_non_bind_comm,agt_tech_process_comm,agt_bonus_comm,agt_inhouse_comm,agt_wire_transfer_comm) select plr_id,'&quot;+startDate+&quot;','&quot;+endDate+&quot;',&quot; </span>
                                 +	&quot;((debit_card_deposit/total_deposit)*total_play*debit_card_comm_rate*.01) debit_card_comm,((credit_card_deposit/total_deposit)*total_play*credit_card_comm_rate*.01) credit_card_comm,((net_banking_deposit/total_deposit)*total_play*net_banking_comm_rate*.01) net_banking_comm,&quot; 
                                 +	&quot;((cash_card_deposit/total_deposit)*total_play*debit_card_comm_rate*.01) cash_card_comm,((ola_bind_deposit/total_deposit)*total_play*ola_bind_comm_rate*.01) ola_bind_comm,((ola_non_bind_deposit/total_deposit)*total_play*ola_non_bind_comm_rate*.01) ola_non_bind_comm,&quot; 
                                 +	&quot;((tech_process_deposit/total_deposit)*total_play*tech_process_comm_rate*.01) tech_process_comm,((bonus_deposit/total_deposit)*total_play*bonus_comm_rate*.01) bonus_comm,((inhouse_deposit/total_deposit)*total_play*inhouse_comm_rate*.01) inhouse_comm,((wire_transfer_deposit/total_deposit)*total_play*wire_transfer_comm_rate*.01) wire_transfer_comm from(select dd.plr_id,(sum(dd.debit_card_deposit) + ss.debit_card_deposit) as debit_card_deposit,(sum(dd.credit_card_deposit) + ss.credit_card_deposit) as credit_card_deposit,&quot; 
                                  +	&quot;(sum(dd.net_banking_deposit) + ss.net_banking_deposit) as net_banking_deposit,(sum(dd.cash_card_deposit) + ss.cash_card_deposit) as cash_card_deposit,(sum(dd.ola_bind_deposit) + ss.ola_bind_deposit) as ola_bind_deposit ,(sum(dd.ola_non_bind_deposit) + ss.ola_non_bind_deposit) as ola_non_bind_deposit,(sum(dd.tech_process_deposit) + ss.tech_process_deposit) as tech_process_deposit,(sum(dd.bonus_deposit) + ss.bonus_deposit) as bonus_deposit,(sum(dd.inhouse_deposit) + ss.inhouse_deposit) as inhouse_deposit,(sum(dd.wire_transfer_deposit) + ss.wire_transfer_deposit) as wire_transfer_deposit,(sum(dd.total_deposit) + ss.total_deposit) as total_deposit,sum(total_play) total_play,sum(dd.total_deposit)+ ss.total_deposit+sum(total_winning)-sum(total_play) balance from st_ola_rummy_plr_deposit_datewise dd ,st_ola_rummy_plr_deposit_status ss where dd.plr_id=ss.plr_id and date&gt;='&quot;+startDate+&quot;' and date &lt;= '&quot;+endDate+&quot;' and dd.status='MATCHED' group by plr_id)depositTlb inner join st_ola_commission_master cc where wallet_id=&quot;+wallet_id+&quot; and tier_id=&quot;+agtTierId;

	
<span class="nc" id="L835">	String insertDepositHistoryQry=&quot;insert into st_ola_rummy_plr_deposit_history(plr_id,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ola_bind_deposit,ola_non_bind_deposit,tech_process_deposit,bonus_deposit,inhouse_deposit,wire_transfer_deposit,total_deposit,till_date,status) &quot; </span>
                                  +	&quot; select ss.plr_id,debit_card_deposit,credit_card_deposit,net_banking_deposit,cash_card_deposit,ola_bind_deposit,ola_non_bind_deposit,tech_process_deposit,bonus_deposit,inhouse_deposit,wire_transfer_deposit,total_deposit,till_date,status from st_ola_rummy_plr_deposit_status ss inner join st_ola_rummy_plr_retailer_commission rc on ss.plr_id=rc.plr_id and rc.start_date&gt;='&quot;+startDate+&quot;' and rc.end_date &lt;='&quot;+endDate+&quot;'&quot;;
	
<span class="nc" id="L838">	String updateDepositCommPlrStatusQry=&quot;update st_ola_rummy_plr_deposit_status ss inner join (select plr_id,ifnull(((debit_card_deposit/total_deposit)*balance),0.0) debit_card_deposit ,ifnull(((credit_card_deposit/total_deposit)*balance),0.0) credit_card_deposit ,ifnull(((net_banking_deposit/total_deposit)*balance),0.0) net_banking_deposit ,ifnull(((cash_card_deposit/total_deposit)*balance),0.0) cash_card_deposit ,ifnull(((ola_bind_deposit/total_deposit)*balance),0.0) ola_bind_deposit ,ifnull(((ola_non_bind_deposit/total_deposit)*balance),0.0) ola_non_bind_deposit ,&quot; </span>
                                          +&quot;ifnull(((tech_process_deposit/total_deposit)*balance),0.0) tech_process_deposit,ifnull(((bonus_deposit/total_deposit)*balance),0.0) bonus_deposit ,ifnull(((inhouse_deposit/total_deposit)*balance),0.0) inhouse_deposit,ifnull(((wire_transfer_deposit/total_deposit)*balance),0.0) wire_transfer_deposit,balance as total_deposit from (select dd.plr_id,(sum(dd.debit_card_deposit) + ss.debit_card_deposit) as debit_card_deposit,(sum(dd.credit_card_deposit) + ss.credit_card_deposit) as credit_card_deposit,(sum(dd.net_banking_deposit) + ss.net_banking_deposit) as net_banking_deposit,(sum(dd.cash_card_deposit) + ss.cash_card_deposit) as cash_card_deposit,(sum(dd.ola_bind_deposit) + ss.ola_bind_deposit) as ola_bind_deposit ,&quot; 
                                          +&quot;(sum(dd.ola_non_bind_deposit) + ss.ola_non_bind_deposit) as ola_non_bind_deposit,(sum(dd.tech_process_deposit) + ss.tech_process_deposit) as tech_process_deposit,(sum(dd.bonus_deposit) + ss.bonus_deposit) as bonus_deposit,(sum(dd.inhouse_deposit) + ss.inhouse_deposit) as inhouse_deposit,(sum(dd.wire_transfer_deposit) + ss.wire_transfer_deposit) as wire_transfer_deposit,(sum(dd.total_deposit) + ss.total_deposit) as total_deposit,sum(total_play) total_play,sum(dd.total_deposit)+ ss.total_deposit+sum(total_winning)-sum(total_play) balance from st_ola_rummy_plr_deposit_datewise dd ,st_ola_rummy_plr_deposit_status ss where dd.plr_id=ss.plr_id and date&gt;='&quot;+startDate+&quot;' and date &lt;= '&quot;+endDate+&quot;' and dd.status='MATCHED' group by plr_id)depositTlb) dd &quot; 
                                          +	&quot;on ss.plr_id=dd.plr_id set ss.debit_card_deposit=dd.debit_card_deposit,ss.debit_card_deposit=dd.debit_card_deposit,ss.credit_card_deposit=dd.credit_card_deposit,ss.net_banking_deposit=dd.net_banking_deposit,ss.cash_card_deposit=dd.cash_card_deposit,ss.ola_bind_deposit=dd.ola_bind_deposit,ss.ola_non_bind_deposit=dd.ola_non_bind_deposit,ss.tech_process_deposit=dd.tech_process_deposit,ss.bonus_deposit=dd.bonus_deposit,ss.inhouse_deposit=dd.inhouse_deposit,ss.wire_transfer_deposit=dd.wire_transfer_deposit,ss.total_deposit=dd.total_deposit,ss.till_date='&quot;+endDate+&quot;',ss.status='DONE'&quot;;
<span class="nc" id="L842">	System.out.println(&quot;UPDATE PLAYER STATUS:&quot;+updatePlrStatus);</span>
<span class="nc" id="L843">	System.out.println(&quot;INSERT COMMISSION QUERY:&quot;+insertRetailerCommQuery);</span>
<span class="nc" id="L844">	System.out.println(&quot;INSERT COMMISSION QUERY:&quot;+insertAgentCommQuery);</span>
<span class="nc" id="L845">	System.out.println(&quot;insert Deposit commission history:&quot;+insertDepositHistoryQry);</span>
<span class="nc" id="L846">	System.out.println(&quot;Update plr_deposit status table:&quot;+updateDepositCommPlrStatusQry);</span>

try{
<span class="nc" id="L849">	Statement stmt=con.createStatement();</span>
<span class="nc" id="L850">	stmt.executeUpdate(updatePlrStatus);</span>
<span class="nc" id="L851">	stmt.executeUpdate(insertRetailerCommQuery);</span>
<span class="nc" id="L852">	stmt.executeUpdate(insertAgentCommQuery);</span>
<span class="nc" id="L853">	stmt.executeUpdate(insertDepositHistoryQry);</span>
<span class="nc" id="L854">	stmt.executeUpdate(updateDepositCommPlrStatusQry);</span>
<span class="nc" id="L855">}catch (SQLException e) {</span>
<span class="nc" id="L856">	e.printStackTrace();</span>
<span class="nc" id="L857">	throw new LMSException();</span>
<span class="nc" id="L858">}</span>

<span class="nc" id="L860">}</span>


public Date getLastDateForPlayerCommission() throws LMSException{

	
	
<span class="nc" id="L867">	Date lastDate=null;</span>
<span class="nc" id="L868">	Connection con=null;</span>
<span class="nc" id="L869">	Statement stmt=null;</span>
<span class="nc" id="L870">	ResultSet rs=null;</span>
	try{
<span class="nc" id="L872">		con=DBConnect.getConnection();</span>
<span class="nc" id="L873">	String selectLastDateQry=&quot;select max(date) date from st_ola_retailer_weekly_commission_exp&quot;;</span>
<span class="nc" id="L874">	 stmt=con.createStatement();</span>
	
<span class="nc" id="L876">	 rs=stmt.executeQuery(selectLastDateQry);</span>
	  
<span class="nc bnc" id="L878" title="All 2 branches missed.">	  while(rs.next()){</span>
<span class="nc" id="L879">		  lastDate=rs.getDate(&quot;date&quot;);</span>
<span class="nc bnc" id="L880" title="All 2 branches missed.">		  if(lastDate==null){</span>
<span class="nc" id="L881">			  Calendar cal=Calendar.getInstance();</span>
<span class="nc" id="L882">			  cal.set(2012, 5, 17);</span>
<span class="nc" id="L883">			  lastDate=new Date(cal.getTime().getTime());</span>
			  
<span class="nc" id="L885">		  }</span>
	  }
	  
	 
	}
<span class="nc" id="L890">	catch (SQLException e) {</span>
<span class="nc" id="L891">		e.printStackTrace();</span>
<span class="nc" id="L892">	throw new LMSException(&quot;Error in Net Gaming &quot;);</span>
	}
	finally{
<span class="nc" id="L895">		try{</span>
<span class="nc bnc" id="L896" title="All 4 branches missed.">			if(con != null){</span>
<span class="nc" id="L897">			con.close();</span>
			}
		}
<span class="nc" id="L900">		catch (Exception e) {</span>
<span class="nc" id="L901">			e.printStackTrace();</span>
<span class="nc" id="L902">			throw new LMSException();</span>
<span class="nc" id="L903">		}</span>
	}
<span class="nc" id="L905">	return lastDate;</span>
	

}

public Date getSettlementDateForPlayerCommission(int week,Connection con) throws LMSException{

	
	
<span class="nc" id="L914">	Date lastDate=null;</span>
	//Connection con=null;
<span class="nc" id="L916">	Statement stmt=null;</span>
<span class="nc" id="L917">	ResultSet rs=null;</span>
	try{
		//con=DBConnect.getConnection();
<span class="nc" id="L920">	String selectLastDateQry=&quot;select DATE_ADD(date,INTERVAL 1 DAY) settlement_date from (select DATE_ADD(max(settlement_upto_date),INTERVAL &quot;+week+&quot; WEEK) date from st_ola_rummy_plr_deposit_comm_status)aa&quot;;</span>
<span class="nc" id="L921">	 stmt=con.createStatement();</span>
<span class="nc" id="L922">	 logger.info(&quot;SettlementDateQuery&quot;+selectLastDateQry);</span>
<span class="nc" id="L923">	 rs=stmt.executeQuery(selectLastDateQry);</span>
<span class="nc bnc" id="L924" title="All 2 branches missed.">	  if(rs.next()){</span>
<span class="nc" id="L925">		  lastDate=rs.getDate(&quot;settlement_date&quot;);</span>
		  
	  }
	 
<span class="nc" id="L929">	}catch (SQLException e) {</span>
<span class="nc" id="L930">		logger.error(&quot;SQL Exception &quot;,e);</span>
<span class="nc" id="L931">		throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE,LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
	}finally{
<span class="nc" id="L933">		DBConnect.closeRs(rs);</span>
<span class="nc" id="L934">		DBConnect.closeStmt(stmt);</span>
<span class="nc" id="L935">	}</span>
<span class="nc" id="L936">	return lastDate;</span>
	

}
public static Date getZeroTimeDate(Date fecha) {
<span class="nc" id="L941">    Date res = fecha;</span>
<span class="nc" id="L942">    Calendar calendar = Calendar.getInstance();</span>

<span class="nc" id="L944">    calendar.setTime( fecha );</span>
<span class="nc" id="L945">    calendar.set(Calendar.HOUR_OF_DAY, 0);</span>
<span class="nc" id="L946">    calendar.set(Calendar.MINUTE, 0);</span>
<span class="nc" id="L947">    calendar.set(Calendar.SECOND, 0);</span>
<span class="nc" id="L948">    calendar.set(Calendar.MILLISECOND, 0);</span>

<span class="nc" id="L950">    res = new Date(calendar.getTime().getTime());</span>

<span class="nc" id="L952">    return res;</span>
}

public static void insertNetGamingData() throws LMSException{
<span class="nc" id="L956">	Connection con =null;</span>
	try{
<span class="nc" id="L958">		con =DBConnect.getConnection();</span>
<span class="nc" id="L959">		con.setAutoCommit(false);</span>
<span class="nc bnc" id="L960" title="All 2 branches missed.">		for(Entry&lt;Integer, String&gt; entry :OLAUtility.getOlaWalletDataMap().entrySet()){</span>
				//insertDepositTransactions( con,entry.getKey());
				//insertWageringTransactions( con,entry.getKey());
			
<span class="nc" id="L964">		}</span>
<span class="nc" id="L965">		insertPlrDepositDateWise(con);</span>
<span class="nc" id="L966">	}catch (SQLException e) {</span>
<span class="nc" id="L967">		logger.info(&quot;SQL Exception &quot;,e);</span>
<span class="nc" id="L968">		throw new LMSException(&quot;SQL Exception &quot;+e.getMessage());</span>
<span class="nc" id="L969">	}catch (Exception e) {</span>
<span class="nc" id="L970">		logger.info(&quot;Exception &quot;,e);</span>
<span class="nc" id="L971">		throw new LMSException(&quot;Exception&quot;+e.getMessage());</span>
	} finally {
<span class="nc" id="L973">		DBConnect.closeCon(con);</span>
<span class="nc" id="L974">	}</span>


<span class="nc" id="L977">}</span>
private static void insertWageringTransactions(Connection con,int walletId) throws LMSException {

<span class="nc" id="L980">	Statement stmt =null;</span>
<span class="nc" id="L981">	ResultSet rs =null;</span>
<span class="nc" id="L982">	PreparedStatement pstmt =null;</span>
	try{
		
<span class="nc" id="L985">		String query =&quot; select DATE_ADD(date(date_time) ,INTERVAL 1 DAY) date  from st_ola_rummy_plr_wagered_transaction where dep_wallet_id =&quot;+walletId+&quot; order by date_time  desc limit 1&quot; ;</span>
<span class="nc" id="L986">		stmt =con.createStatement();</span>
<span class="nc" id="L987">		rs= stmt.executeQuery(query);</span>
<span class="nc" id="L988">		String startDate =&quot;2000-01-01 00:00:00&quot;;</span>
<span class="nc bnc" id="L989" title="All 2 branches missed.">		if(rs.next()){</span>
<span class="nc" id="L990">			startDate=rs.getString(&quot;date&quot;)+&quot; 00:00:00&quot;;</span>
			
		}
<span class="nc" id="L993">		logger.info(&quot;Start DATE Wagering:&quot;+startDate);</span>
<span class="nc" id="L994">		Calendar calStart=Calendar.getInstance();</span>
<span class="nc" id="L995">		calStart.add(Calendar.DAY_OF_MONTH, -1);</span>
<span class="nc" id="L996">		String endDate=new Date(calStart.getTime().getTime())+&quot; 23:59:59&quot;;</span>
<span class="nc" id="L997">		Map&lt;String,String&gt; bindReqMap = new HashMap&lt;String, String&gt;();</span>
<span class="nc" id="L998">		bindReqMap.put(&quot;requestType&quot;,&quot;NG_WAGER_REPORT&quot;);</span>
		//bindReqMap.put(&quot;domainName&quot;,OLAUtility.getWalletIntBean(walletId+&quot;&quot;).getTpIp());
<span class="nc" id="L1000">		 bindReqMap.put(&quot;fromDate&quot;,startDate);		 //bindReqMap.put(&quot;fromDate&quot;,&quot;2013-09-01 00:00:00&quot;);</span>
<span class="nc" id="L1001">		 bindReqMap.put(&quot;toDate&quot;,endDate);//	bindReqMap.put(&quot;toDate&quot;,&quot;2013-09-03 23:59:59&quot;);	</span>
		// int walletId =2;
		//String reqType =&quot;/Weaver/service/rest/weaverTxnReport&quot;;
<span class="nc" id="L1004">		InputStream bindResponse =OLAClient.callKhelPlayRummy(OLAUtility.prepareXMLFromData(bindReqMap),walletId,OLAConstants.repReq);</span>
<span class="nc" id="L1005">		OlaRummyNGDepositRepBean olaNgDepRepBean=OLAUtility.prepareBeanDataFromXml(bindResponse);</span>
<span class="nc" id="L1006">		logger.info(olaNgDepRepBean);</span>
<span class="nc bnc" id="L1007" title="All 2 branches missed.">		if(olaNgDepRepBean==null){</span>
<span class="nc" id="L1008">			logger.info(&quot;player binding msg:&quot;+olaNgDepRepBean);</span>
			
		}else {
		
<span class="nc" id="L1012">			String query1= &quot;insert into st_ola_rummy_plr_wagered_transaction(dep_wallet_id,plr_id,plr_alias,ref_transaction_id,wagered_amount,transaction_type,game_name,date_time) values(?,?,?,?,?,?,?,?) &quot;;</span>
<span class="nc" id="L1013">			pstmt = con.prepareStatement(query1);</span>
<span class="nc bnc" id="L1014" title="All 2 branches missed.">			if(olaNgDepRepBean.getRummyngTxnList()==null){</span>
<span class="nc" id="L1015">				logger.info(olaNgDepRepBean.getErrorCode()+olaNgDepRepBean.getErrorMsg());</span>
			}else{
<span class="nc" id="L1017">				List&lt;OlaRummyNGTxnRepBean&gt; rummyngTxnList  =olaNgDepRepBean.getRummyngTxnList();</span>
<span class="nc bnc" id="L1018" title="All 2 branches missed.">				for(int i=0;i&lt;rummyngTxnList.size();i++){</span>
<span class="nc" id="L1019">					String wallet = rummyngTxnList.get(i).getDomainName();</span>
<span class="nc" id="L1020">					List&lt;OlaRummyNGPlrTxnRepBean&gt; rummyngplrTxnList  =rummyngTxnList.get(i).getRummyngplrTxnList();</span>
					
<span class="nc bnc" id="L1022" title="All 2 branches missed.">					for(int j=0;j&lt;rummyngplrTxnList.size();j++){</span>
<span class="nc" id="L1023">						pstmt.setInt(1, OLAUtility.getWalletIntBean(wallet).getWalletId());</span>
<span class="nc" id="L1024">						OlaRummyNGPlrTxnRepBean bean = rummyngplrTxnList.get(j);</span>
<span class="nc" id="L1025">						pstmt.setString(2,bean.getAccountId());</span>
<span class="nc" id="L1026">						pstmt.setString(3,bean.getUserName());</span>
<span class="nc" id="L1027">						pstmt.setString(4,bean.getTxnId());</span>
<span class="nc" id="L1028">						pstmt.setDouble(5,bean.getAmount());</span>
<span class="nc" id="L1029">						pstmt.setString(6,&quot;Wagering&quot;);</span>
<span class="nc" id="L1030">						pstmt.setString(7,bean.getGameType());</span>
<span class="nc" id="L1031">						pstmt.setString(8,bean.getTxnTime());</span>
<span class="nc" id="L1032">						pstmt.addBatch();</span>
					}
					
					
				}
<span class="nc" id="L1037">			int[] recordsInserted=pstmt.executeBatch();</span>
<span class="nc" id="L1038">			con.commit();</span>
<span class="nc" id="L1039">			logger.info(&quot;rowsUpdated&quot;+recordsInserted.length);</span>
			}
			
		}
<span class="nc" id="L1043">	}catch(SQLException e){</span>
<span class="nc" id="L1044">		logger.error(&quot;SQL Exception&quot;,e);</span>
		try {
<span class="nc" id="L1046">			con.rollback();</span>
<span class="nc" id="L1047">		} catch (SQLException e1) {</span>
<span class="nc" id="L1048">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE,LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1049">		}</span>
<span class="nc" id="L1050">		throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE,LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1051">	}catch(Exception e){</span>
<span class="nc" id="L1052">		logger.error(&quot;Exception&quot;,e);</span>
<span class="nc" id="L1053">		throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE,LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
	}finally{
<span class="nc" id="L1055">		DBConnect.closePstmt(pstmt);</span>
<span class="nc" id="L1056">		DBConnect.closeStmt(stmt);</span>
<span class="nc" id="L1057">		DBConnect.closeRs(rs);</span>
<span class="nc" id="L1058">	}	</span>
	
	


	
<span class="nc" id="L1064">}</span>

public static void insertDepositTransactions(Connection con,int walletId) throws LMSException{
<span class="nc" id="L1067">	Statement stmt =null;</span>
<span class="nc" id="L1068">	ResultSet rs =null;</span>
<span class="nc" id="L1069">	PreparedStatement pstmt=null;</span>
	try{
		
<span class="nc" id="L1072">		String query =&quot; select DATE_ADD(date(date_time) ,INTERVAL 1 DAY) date from st_ola_rummy_plr_deposit_transaction where dep_wallet_id=&quot;+walletId+&quot; order by date_time  desc limit 1&quot; ;</span>
<span class="nc" id="L1073">		stmt =con.createStatement();</span>
<span class="nc" id="L1074">		rs= stmt.executeQuery(query);</span>
<span class="nc" id="L1075">		String startDate =&quot;2000-01-01 00:00:00&quot;;</span>
<span class="nc bnc" id="L1076" title="All 2 branches missed.">		if(rs.next()){</span>
<span class="nc" id="L1077">			startDate=rs.getString(&quot;date&quot;)+&quot; 00:00:00&quot;;</span>
			
		}
<span class="nc" id="L1080">		logger.info(&quot;Start DATE Deposit:&quot;+startDate);</span>
<span class="nc" id="L1081">		Calendar calStart=Calendar.getInstance();</span>
<span class="nc" id="L1082">		calStart.add(Calendar.DAY_OF_MONTH, -1);</span>
<span class="nc" id="L1083">		String endDate=new Date(calStart.getTime().getTime())+&quot; 23:59:59&quot;;</span>
<span class="nc" id="L1084">		Map&lt;String,String&gt; bindReqMap = new HashMap&lt;String, String&gt;();</span>
<span class="nc" id="L1085">		bindReqMap.put(&quot;requestType&quot;,&quot;NG_DEPOSIT_REPORT&quot;);</span>
<span class="nc" id="L1086">		bindReqMap.put(&quot;domainName&quot;,OLAUtility.getWalletIntBean(walletId+&quot;&quot;).getTpIp());</span>
<span class="nc" id="L1087">		bindReqMap.put(&quot;fromDate&quot;,startDate);			//  	bindReqMap.put(&quot;fromDate&quot;,&quot;2013-09-01 00:00:00&quot;);</span>
<span class="nc" id="L1088">		bindReqMap.put(&quot;toDate&quot;,endDate); // 	 bindReqMap.put(&quot;toDate&quot;,&quot;2013-09-03 23:59:59&quot;);</span>
		// int walletId =2;
		//String reqType =&quot;/Weaver/service/rest/weaverTxnReport&quot;;
<span class="nc" id="L1091">		InputStream bindResponse =OLAClient.callKhelPlayRummy(OLAUtility.prepareXMLFromData(bindReqMap),walletId,OLAConstants.repReq);</span>
<span class="nc" id="L1092">		OlaRummyNGDepositRepBean olaNgDepRepBean=OLAUtility.prepareBeanDataFromXml(bindResponse);</span>
<span class="nc" id="L1093">		logger.info(olaNgDepRepBean);</span>
<span class="nc bnc" id="L1094" title="All 2 branches missed.">		if(olaNgDepRepBean==null){</span>
<span class="nc" id="L1095">			logger.info(&quot;player binding msg:&quot;+olaNgDepRepBean);</span>
			
		}else {
		
<span class="nc" id="L1099">			String query1= &quot;insert into st_ola_rummy_plr_deposit_transaction(dep_wallet_id,plr_id,transaction_id,deposit_amount,deposit_mode,payment_provider,date_time,plr_alias) values(?,?,?,?,?,?,?,?) &quot;;</span>
<span class="nc" id="L1100">			pstmt = con.prepareStatement(query1);</span>
<span class="nc bnc" id="L1101" title="All 2 branches missed.">			if(olaNgDepRepBean.getRummyngTxnList()==null){</span>
<span class="nc" id="L1102">				logger.info(olaNgDepRepBean.getErrorCode()+olaNgDepRepBean.getErrorMsg());</span>
			}else{
<span class="nc" id="L1104">				List&lt;OlaRummyNGTxnRepBean&gt; rummyngTxnList  =olaNgDepRepBean.getRummyngTxnList();</span>
<span class="nc bnc" id="L1105" title="All 2 branches missed.">				for(int i=0;i&lt;rummyngTxnList.size();i++){</span>
<span class="nc" id="L1106">					String wallet = rummyngTxnList.get(i).getDomainName();</span>
<span class="nc" id="L1107">					List&lt;OlaRummyNGPlrTxnRepBean&gt; rummyngplrTxnList  =rummyngTxnList.get(i).getRummyngplrTxnList();</span>
					
<span class="nc bnc" id="L1109" title="All 2 branches missed.">					for(int j=0;j&lt;rummyngplrTxnList.size();j++){</span>
<span class="nc" id="L1110">						pstmt.setInt(1, OLAUtility.getWalletIntBean(wallet).getWalletId());</span>
<span class="nc" id="L1111">						OlaRummyNGPlrTxnRepBean bean = rummyngplrTxnList.get(j);</span>
<span class="nc" id="L1112">						pstmt.setString(2, rummyngplrTxnList.get(j).getAccountId());</span>
<span class="nc" id="L1113">						pstmt.setString(3, rummyngplrTxnList.get(j).getTxnId());</span>
<span class="nc" id="L1114">						pstmt.setDouble(4, rummyngplrTxnList.get(j).getAmount());</span>
<span class="nc" id="L1115">						System.out.println(bean.getPaymentType()+&quot;asdasd&quot;+bean.getProviderName());</span>
<span class="nc" id="L1116">						String paymentType =&quot;other&quot;;</span>
<span class="nc bnc" id="L1117" title="All 4 branches missed.">						if(bean.getPaymentType().equalsIgnoreCase(&quot;Cash_Payment&quot;)&amp;&amp;bean.getProviderName().equalsIgnoreCase(&quot;OLA&quot;) ){</span>
<span class="nc" id="L1118">							paymentType=&quot;OLA&quot;;</span>
<span class="nc bnc" id="L1119" title="All 4 branches missed.">						}else if(bean.getProviderName().equalsIgnoreCase(&quot;OLA&quot;)&amp;&amp; bean.getPaymentType().equalsIgnoreCase(&quot;CASH_CARD&quot;)){</span>
<span class="nc" id="L1120">							paymentType=&quot;Cash Card&quot;;</span>
<span class="nc bnc" id="L1121" title="All 4 branches missed.">						}else if(bean.getProviderName().equalsIgnoreCase(&quot;HDFC Bank&quot;)&amp;&amp; bean.getPaymentType().equalsIgnoreCase(&quot;CHEQUE_TRANS&quot;)){</span>
<span class="nc" id="L1122">							paymentType=&quot;CHEQUE_TRANS&quot;;</span>
<span class="nc bnc" id="L1123" title="All 4 branches missed.">						}else if(bean.getProviderName().equalsIgnoreCase(&quot;HDFC Bank&quot;)&amp;&amp; bean.getPaymentType().equalsIgnoreCase(&quot;WIRE_TRANS&quot;)){</span>
<span class="nc" id="L1124">							paymentType=&quot;Wire Transfer&quot;;</span>
<span class="nc bnc" id="L1125" title="All 2 branches missed.">						}else if(bean.getPaymentType().equalsIgnoreCase(&quot;DEBIT_CARD&quot;)){</span>
<span class="nc" id="L1126">							paymentType=&quot;Debit Card&quot;;</span>
<span class="nc bnc" id="L1127" title="All 2 branches missed.">						}else if(bean.getPaymentType().equalsIgnoreCase(&quot;CREDIT_CARD&quot;)){</span>
<span class="nc" id="L1128">							paymentType=&quot;Credit Card&quot;;</span>
<span class="nc bnc" id="L1129" title="All 2 branches missed.">						}else if(bean.getPaymentType().equalsIgnoreCase(&quot;NET_BANKING&quot;)){</span>
<span class="nc" id="L1130">							paymentType=&quot;Net Banking&quot;;</span>
<span class="nc bnc" id="L1131" title="All 4 branches missed.">						}else if(bean.getPaymentType().equalsIgnoreCase(&quot;CASH_PAYMENT&quot;)&amp;&amp;bean.getProviderName().equalsIgnoreCase(&quot;GharPay&quot;)){</span>
<span class="nc" id="L1132">							paymentType=&quot;CASH_PAYMENT&quot;;</span>
						}else {
<span class="nc" id="L1134">							paymentType=bean.getPaymentType();</span>
							
						}
						
						
<span class="nc" id="L1139">						pstmt.setString(5,paymentType);</span>
<span class="nc" id="L1140">						pstmt.setString(6,bean.getProviderName());</span>
<span class="nc" id="L1141">						pstmt.setString(7,rummyngplrTxnList.get(j).getTxnTime());</span>
<span class="nc" id="L1142">						pstmt.setString(8,rummyngplrTxnList.get(j).getUserName());</span>
<span class="nc" id="L1143">						logger.info(&quot;deposit query&quot;+pstmt);</span>
<span class="nc" id="L1144">						pstmt.addBatch();</span>
						//pstmt.execute();
					}
					
					
				}
<span class="nc" id="L1150">				logger.info(&quot;deposit query&quot;+pstmt);</span>
<span class="nc" id="L1151">				int[] recordsInserted=pstmt.executeBatch();</span>
<span class="nc" id="L1152">				con.commit();</span>
<span class="nc" id="L1153">				logger.info(&quot;rowsUpdated&quot;+recordsInserted.length);</span>
			}
			
		}
<span class="nc" id="L1157">	}catch(SQLException e){</span>
<span class="nc" id="L1158">		logger.error(&quot;SQL Exception&quot;,e);</span>
		try {
<span class="nc" id="L1160">			con.rollback();</span>
<span class="nc" id="L1161">		} catch (SQLException e1) {</span>
<span class="nc" id="L1162">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE,LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1163">		}</span>
<span class="nc" id="L1164">		throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE,LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1165">	}catch(Exception e){</span>
<span class="nc" id="L1166">		logger.error(&quot;Exception&quot;,e);</span>
<span class="nc" id="L1167">		throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE,LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
	}finally{
<span class="nc" id="L1169">		DBConnect.closePstmt(pstmt);</span>
<span class="nc" id="L1170">		DBConnect.closeStmt(stmt);</span>
<span class="nc" id="L1171">		DBConnect.closeRs(rs);</span>
<span class="nc" id="L1172">	}	</span>
	
	

<span class="nc" id="L1176">}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>