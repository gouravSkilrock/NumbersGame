<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>OlaAgentReportDaoImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.ola.reportsMgmt.daoImpl</a> &gt; <span class="el_source">OlaAgentReportDaoImpl.java</span></div><h1>OlaAgentReportDaoImpl.java</h1><pre class="source lang-java linenums">package com.skilrock.ola.reportsMgmt.daoImpl;

import java.sql.Connection;
import java.sql.Date;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.Timestamp;
import java.text.SimpleDateFormat;
import java.util.HashMap;
import java.util.Map;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.exception.GenericException;
import com.skilrock.lms.common.exception.LMSErrors;
import com.skilrock.lms.web.reportsMgmt.common.ReportUtility;
import com.skilrock.ola.reportsMgmt.javaBeans.OlaOrgReportRequestBean;
import com.skilrock.ola.reportsMgmt.javaBeans.OlaOrgReportResponseBean;

<span class="nc" id="L23">public class OlaAgentReportDaoImpl {</span>
<span class="nc" id="L24">	private static final Logger logger = LoggerFactory.getLogger(&quot;OlaAgentReportDaoImpl&quot;);</span>
	
	public static void main(String[] args) throws Exception {
<span class="nc" id="L27">		OlaOrgReportRequestBean requestBean = new OlaOrgReportRequestBean();</span>
<span class="nc" id="L28">		requestBean.setOrgId(3);</span>
<span class="nc" id="L29">		requestBean.setFromDate(&quot;2014-08-28 00:00:00&quot;);</span>
<span class="nc" id="L30">		requestBean.setToDate(&quot;2014-08-29 00:00:00&quot;);</span>
<span class="nc" id="L31">		OlaOrgReportResponseBean responseBean = fetchDepositDataSingleAgent(requestBean, DBConnect.getConnection());</span>
<span class="nc" id="L32">		System.out.println(responseBean);</span>
<span class="nc" id="L33">	}</span>
	
	/**
	 * 
	 * @param requestBean
	 * @param connection
	 * @return
	 * @throws GenericException
	 */
	public static OlaOrgReportResponseBean fetchDepositDataSingleAgent(OlaOrgReportRequestBean requestBean, Connection connection) throws GenericException {
<span class="nc" id="L43">		OlaOrgReportResponseBean responseBean = null;</span>
<span class="nc" id="L44">		Statement stmt = null;</span>
<span class="nc" id="L45">		ResultSet rs = null;</span>
<span class="nc" id="L46">		StringBuilder depositQueryBuilder = null;</span>
		try {
<span class="nc bnc" id="L48" title="All 2 branches missed.">			String walletAppender = (requestBean.getWalletId() == 0)?&quot;&quot;:&quot; AND wallet_id=&quot;+requestBean.getWalletId();</span>
<span class="nc" id="L49">			String archiveAppender = &quot; UNION ALL SELECT organization_id, SUM(deposit_mrp-ref_deposit_mrp) mrp_dep_amt, SUM(deposit_net-ref_deposit_net_amt) net_dep_amt FROM st_rep_ola_agent WHERE  finaldate&gt;='&quot;+requestBean.getFromDate()+&quot;' AND finaldate&lt;='&quot;+requestBean.getToDate()+&quot;' AND organization_id=&quot;+requestBean.getOrgId()+walletAppender;</span>

<span class="nc" id="L51">			depositQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L52">			depositQueryBuilder.append(&quot;SELECT parent_id agent_org_id, IFNULL(SUM(mrp_dep_amt),0.0) mrp_dep_amt, IFNULL(SUM(net_dep_amt),0.00) net_dep_amt FROM (SELECT rtm.retailer_org_id, deposit_amt mrp_dep_amt, agent_net_amt net_dep_amt FROM st_lms_retailer_transaction_master rtm INNER JOIN st_ola_ret_deposit dp ON rtm.transaction_id=dp.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND rtm.transaction_type='OLA_DEPOSIT' UNION ALL SELECT rtm.retailer_org_id, -deposit_amt mrp_refund_amt, -agent_net_amt net_refund_amt FROM st_lms_retailer_transaction_master rtm INNER JOIN st_ola_ret_deposit_refund dpr ON rtm.transaction_id=dpr.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND rtm.transaction_type='OLA_DEPOSIT_REFUND')main INNER JOIN st_lms_organization_master om ON om.organization_id=main.retailer_org_id WHERE parent_id=&quot;).append(requestBean.getOrgId()).append(archiveAppender);</span>
<span class="nc" id="L53">			logger.debug(&quot;fetchDepositDataSingleAgent - &quot;+depositQueryBuilder.toString());</span>

<span class="nc" id="L55">			stmt = connection.createStatement();</span>
<span class="nc" id="L56">			rs = stmt.executeQuery(depositQueryBuilder.toString());</span>
<span class="nc" id="L57">			responseBean = new OlaOrgReportResponseBean();</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L59">				responseBean = new OlaOrgReportResponseBean();</span>
<span class="nc" id="L60">				responseBean.setOrgId(rs.getInt(&quot;agent_org_id&quot;));</span>
<span class="nc" id="L61">				responseBean.setMrpDepositAmt(responseBean.getMrpDepositAmt() + rs.getDouble(&quot;mrp_dep_amt&quot;));</span>
<span class="nc" id="L62">				responseBean.setNetDepositAmt(responseBean.getNetDepositAmt() + rs.getDouble(&quot;net_dep_amt&quot;));</span>
			}
<span class="nc" id="L64">		} catch(SQLException se) {</span>
<span class="nc" id="L65">			se.printStackTrace();</span>
<span class="nc" id="L66">			throw new GenericException(LMSErrors.SQL_EXCEPTION_CODE, se);</span>
<span class="nc" id="L67">		} catch(Exception e) {</span>
<span class="nc" id="L68">			e.printStackTrace();</span>
<span class="nc" id="L69">			throw new GenericException(LMSErrors.GENERAL_EXCEPTION_CODE, e);</span>
<span class="nc" id="L70">		}</span>

<span class="nc" id="L72">		return responseBean;</span>
	}
	
	/**
	 * 
	 * @param requestBean
	 * @param connection
	 * @return
	 * @throws GenericException
	 */
	public static Map&lt;String, OlaOrgReportResponseBean&gt; fetchDepositDataSingleAgentDateWise(OlaOrgReportRequestBean requestBean, Connection connection) throws GenericException {
<span class="nc" id="L83">		Map&lt;String, OlaOrgReportResponseBean&gt; responseBeanMap = null;</span>
<span class="nc" id="L84">		OlaOrgReportResponseBean responseBean = null;</span>
<span class="nc" id="L85">		Statement stmt = null;</span>
<span class="nc" id="L86">		ResultSet rs = null;</span>
<span class="nc" id="L87">		StringBuilder depositQueryBuilder = null;</span>
		try {
<span class="nc" id="L89">			responseBeanMap = new HashMap&lt;String, OlaOrgReportResponseBean&gt;();</span>

<span class="nc bnc" id="L91" title="All 2 branches missed.">			String walletAppender = (requestBean.getWalletId() == 0)?&quot;&quot;:&quot; AND wallet_id=&quot;+requestBean.getWalletId();</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">			String agentAppender = (requestBean.getOrgId() == 0)?&quot;&quot;:&quot; WHERE parent_id=&quot;+requestBean.getOrgId();</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">			String agentArchiveAppender = (requestBean.getOrgId() == 0)?&quot;&quot;:&quot; AND organization_id = &quot;+requestBean.getOrgId();</span>
<span class="nc" id="L94">			String archiveAppender = &quot; UNION ALL SELECT organization_id, deposit_mrp-ref_deposit_mrp mrp_dep_amt, deposit_net-ref_deposit_net_amt net_dep_amt, finaldate FROM st_rep_ola_agent Where  finaldate&gt;='&quot;+requestBean.getFromDate()+&quot;' AND finaldate&lt;='&quot;+requestBean.getToDate()+&quot;' &quot;+walletAppender+agentArchiveAppender;</span>

<span class="nc" id="L96">			depositQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L97">			depositQueryBuilder.append(&quot;SELECT parent_id agent_org_id, IFNULL(SUM(mrp_dep_amt),0.0) mrp_dep_amt, IFNULL(SUM(net_dep_amt),0.00) net_dep_amt, DATE(transaction_date) transaction_date FROM (SELECT rtm.retailer_org_id, deposit_amt mrp_dep_amt, agent_net_amt net_dep_amt, transaction_date FROM st_lms_retailer_transaction_master rtm INNER JOIN st_ola_ret_deposit dp ON rtm.transaction_id=dp.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND rtm.transaction_type='OLA_DEPOSIT' UNION ALL SELECT rtm.retailer_org_id, -deposit_amt mrp_refund_amt, -agent_net_amt net_refund_amt, transaction_date FROM st_lms_retailer_transaction_master rtm INNER JOIN st_ola_ret_deposit_refund dpr ON rtm.transaction_id=dpr.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND rtm.transaction_type='OLA_DEPOSIT_REFUND')main INNER JOIN st_lms_organization_master om ON om.organization_id=main.retailer_org_id&quot;).append(agentAppender).append(&quot; GROUP BY DATE(transaction_date)&quot;).append(archiveAppender);</span>
<span class="nc" id="L98">			logger.debug(&quot;fetchDepositDataSingleRetailer - &quot;+depositQueryBuilder.toString());</span>

<span class="nc" id="L100">			stmt = connection.createStatement();</span>
<span class="nc" id="L101">			rs = stmt.executeQuery(depositQueryBuilder.toString());</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L103">				responseBean = responseBeanMap.get(rs.getInt(&quot;transaction_date&quot;));</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">				if(responseBean == null) {</span>
<span class="nc" id="L105">					responseBean = new OlaOrgReportResponseBean();</span>
				}
<span class="nc" id="L107">				responseBean.setOrgId(rs.getInt(&quot;agent_org_id&quot;));</span>
<span class="nc" id="L108">				responseBean.setMrpDepositAmt(responseBean.getMrpDepositAmt() + rs.getDouble(&quot;mrp_dep_amt&quot;));</span>
<span class="nc" id="L109">				responseBean.setNetDepositAmt(responseBean.getNetDepositAmt() + rs.getDouble(&quot;net_dep_amt&quot;));</span>
<span class="nc" id="L110">				responseBeanMap.put(rs.getString(&quot;transaction_date&quot;), responseBean);</span>
			}
<span class="nc" id="L112">		} catch(SQLException se) {</span>
<span class="nc" id="L113">			se.printStackTrace();</span>
<span class="nc" id="L114">			throw new GenericException(LMSErrors.SQL_EXCEPTION_CODE, se);</span>
<span class="nc" id="L115">		} catch(Exception e) {</span>
<span class="nc" id="L116">			e.printStackTrace();</span>
<span class="nc" id="L117">			throw new GenericException(LMSErrors.GENERAL_EXCEPTION_CODE, e);</span>
<span class="nc" id="L118">		}</span>

<span class="nc" id="L120">		return responseBeanMap;</span>
	}
	
	/**
	 * 
	 * @param requestBean
	 * @param connection
	 * @return
	 * @throws GenericException
	 */
	public static OlaOrgReportResponseBean fetchDepositDirectPlayerDataSingleAgent(OlaOrgReportRequestBean requestBean, Connection connection) throws GenericException {
<span class="nc" id="L131">		OlaOrgReportResponseBean responseBean = null;</span>
<span class="nc" id="L132">		Statement stmt = null;</span>
<span class="nc" id="L133">		ResultSet rs = null;</span>
<span class="nc" id="L134">		StringBuilder depositQueryBuilder = null;</span>
		try {
<span class="nc bnc" id="L136" title="All 2 branches missed.">			String walletAppender = (requestBean.getWalletId() == 0)?&quot;&quot;:&quot; AND wallet_id=&quot;+requestBean.getWalletId();</span>
<span class="nc" id="L137">			String archiveAppender = &quot; UNION ALL SELECT organization_id, SUM(deposit_mrp-ref_deposit_mrp) mrp_dep_amt, SUM(deposit_net-ref_deposit_net_amt) net_dep_amt FROM st_rep_ola_agent WHERE  finaldate&gt;='&quot;+requestBean.getFromDate()+&quot;' AND finaldate&lt;='&quot;+requestBean.getToDate()+&quot;' AND organization_id=&quot;+requestBean.getOrgId()+walletAppender;</span>

<span class="nc" id="L139">			depositQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L140">			depositQueryBuilder.append(&quot;SELECT agent_org_id, IFNULL(SUM(mrp_dep_amt),0.0) mrp_dep_amt, IFNULL(SUM(net_dep_amt),0.00) net_dep_amt FROM (SELECT agent_org_id,deposit_amt mrp_dep_amt, net_amt net_dep_amt FROM st_lms_agent_transaction_master atm INNER JOIN st_ola_agt_direct_plr_deposit dp ON atm.transaction_id=dp.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND atm.transaction_type='OLA_DEPOSIT_PLR' AND agent_org_id=&quot;).append(requestBean.getOrgId()).append(&quot; UNION ALL SELECT agent_org_id, -deposit_amt mrp_refund_amt, -net_amt net_refund_amt FROM st_lms_agent_transaction_master atm INNER JOIN st_ola_agt_direct_plr_deposit_refund dpr ON atm.transaction_id=dpr.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND atm.transaction_type='OLA_DEPOSIT_REFUND_PLR' AND agent_org_id=&quot;).append(requestBean.getOrgId()).append(archiveAppender).append(&quot;)main;&quot;);</span>
<span class="nc" id="L141">			logger.debug(&quot;fetchDepositDirectPlayerDataSingleAgent - &quot;+depositQueryBuilder.toString());</span>

<span class="nc" id="L143">			stmt = connection.createStatement();</span>
<span class="nc" id="L144">			rs = stmt.executeQuery(depositQueryBuilder.toString());</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L146">				responseBean = new OlaOrgReportResponseBean();</span>
<span class="nc" id="L147">				responseBean.setOrgId(rs.getInt(&quot;agent_org_id&quot;));</span>
<span class="nc" id="L148">				responseBean.setMrpDepositAmt(rs.getDouble(&quot;mrp_dep_amt&quot;));</span>
<span class="nc" id="L149">				responseBean.setNetDepositAmt(rs.getDouble(&quot;net_dep_amt&quot;));</span>
			}
<span class="nc" id="L151">		} catch(SQLException se) {</span>
<span class="nc" id="L152">			se.printStackTrace();</span>
<span class="nc" id="L153">			throw new GenericException(LMSErrors.SQL_EXCEPTION_CODE, se);</span>
<span class="nc" id="L154">		} catch(Exception e) {</span>
<span class="nc" id="L155">			e.printStackTrace();</span>
<span class="nc" id="L156">			throw new GenericException(LMSErrors.GENERAL_EXCEPTION_CODE, e);</span>
<span class="nc" id="L157">		}</span>

<span class="nc" id="L159">		return responseBean;</span>
	}
	
	/**
	 * 
	 * @param requestBean
	 * @param connection
	 * @return
	 * @throws GenericException
	 */
	public static Map&lt;String, OlaOrgReportResponseBean&gt; fetchDepositDirectPlayerDataSingleAgentDateWise(OlaOrgReportRequestBean requestBean, Connection connection) throws GenericException {
<span class="nc" id="L170">		Map&lt;String, OlaOrgReportResponseBean&gt; responseBeanMap = null;</span>
<span class="nc" id="L171">		OlaOrgReportResponseBean responseBean = null;</span>
<span class="nc" id="L172">		Statement stmt = null;</span>
<span class="nc" id="L173">		ResultSet rs = null;</span>
<span class="nc" id="L174">		StringBuilder depositQueryBuilder = null;</span>
		try {			
<span class="nc bnc" id="L176" title="All 2 branches missed.">				String walletAppender = (requestBean.getWalletId() == 0)?&quot;&quot;:&quot; AND wallet_id=&quot;+requestBean.getWalletId();</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">				String agentAppender = (requestBean.getOrgId() == 0)?&quot;&quot;:&quot; AND agent_org_id=&quot;+requestBean.getOrgId();</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">				String agentArchiveAppender = (requestBean.getOrgId() == 0)?&quot;&quot;:&quot; AND organization_id=&quot;+requestBean.getOrgId();</span>
<span class="nc" id="L179">				String archiveAppender = &quot; UNION ALL SELECT organization_id, deposit_mrp-ref_deposit_mrp mrp_dep_amt, deposit_net-ref_deposit_net_amt net_dep_amt, finaldate FROM st_rep_ola_agt_dir WHERE  finaldate&gt;='&quot;+requestBean.getFromDate()+&quot;' AND finaldate&lt;='&quot;+requestBean.getToDate()+&quot;'&quot;+agentArchiveAppender+walletAppender;</span>
<span class="nc" id="L180">				responseBeanMap = new HashMap&lt;String, OlaOrgReportResponseBean&gt;();</span>
<span class="nc" id="L181">				depositQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L182">				depositQueryBuilder.append(&quot;SELECT agent_org_id, IFNULL(SUM(mrp_dep_amt),0.0) mrp_dep_amt, IFNULL(SUM(net_dep_amt),0.00) net_dep_amt, DATE(transaction_date) transaction_date FROM (SELECT agent_org_id,deposit_amt mrp_dep_amt, net_amt net_dep_amt, transaction_date FROM st_lms_agent_transaction_master atm INNER JOIN st_ola_agt_direct_plr_deposit dp ON atm.transaction_id=dp.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND atm.transaction_type='OLA_DEPOSIT_PLR'&quot;).append(agentAppender).append(&quot; UNION ALL SELECT agent_org_id, -deposit_amt mrp_refund_amt, -net_amt net_refund_amt, transaction_date FROM st_lms_agent_transaction_master atm INNER JOIN st_ola_agt_direct_plr_deposit_refund dpr ON atm.transaction_id=dpr.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND atm.transaction_type='OLA_DEPOSIT_REFUND_PLR'&quot;).append(agentAppender).append(&quot;)main GROUP BY DATE(transaction_date)&quot;).append(archiveAppender);</span>
<span class="nc" id="L183">				logger.debug(&quot;fetchDepositDirectPlayerDataSingleAgentDateWise - &quot;+depositQueryBuilder.toString());</span>

<span class="nc" id="L185">				stmt = connection.createStatement();</span>
<span class="nc" id="L186">				rs = stmt.executeQuery(depositQueryBuilder.toString());</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L188">					responseBean = new OlaOrgReportResponseBean();</span>
<span class="nc" id="L189">					responseBean.setOrgId(rs.getInt(&quot;agent_org_id&quot;));</span>
<span class="nc" id="L190">					responseBean.setMrpDepositAmt(rs.getDouble(&quot;mrp_dep_amt&quot;));</span>
<span class="nc" id="L191">					responseBean.setNetDepositAmt(rs.getDouble(&quot;net_dep_amt&quot;));</span>
<span class="nc" id="L192">					responseBeanMap.put(rs.getString(&quot;transaction_date&quot;), responseBean);</span>
				}
<span class="nc" id="L194">			} catch(SQLException se) {</span>
<span class="nc" id="L195">				se.printStackTrace();</span>
<span class="nc" id="L196">				throw new GenericException(LMSErrors.SQL_EXCEPTION_CODE, se);</span>
<span class="nc" id="L197">			} catch(Exception e) {</span>
<span class="nc" id="L198">				e.printStackTrace();</span>
<span class="nc" id="L199">				throw new GenericException(LMSErrors.GENERAL_EXCEPTION_CODE, e);</span>
<span class="nc" id="L200">			}</span>
<span class="nc" id="L201">			return responseBeanMap;</span>
		}
	
	/**
	 * 
	 * @param requestBean
	 * @param connection
	 * @return
	 * @throws GenericException
	 */
	public static Map&lt;Integer, OlaOrgReportResponseBean&gt; fetchDepositDataMultipleAgent(OlaOrgReportRequestBean requestBean, Connection connection) throws GenericException {
<span class="nc" id="L212">		Map&lt;Integer, OlaOrgReportResponseBean&gt; responseBeanMap = null;</span>
<span class="nc" id="L213">		OlaOrgReportResponseBean responseBean = null;</span>
<span class="nc" id="L214">		Statement stmt = null;</span>
<span class="nc" id="L215">		ResultSet rs = null;</span>
<span class="nc" id="L216">		StringBuilder depositQueryBuilder = null;</span>
		try {
<span class="nc bnc" id="L218" title="All 2 branches missed.">			String walletAppender = (requestBean.getWalletId() == 0)?&quot;&quot;:&quot; AND wallet_id=&quot;+requestBean.getWalletId();</span>
<span class="nc" id="L219">			String archiveAppender = &quot; UNION ALL SELECT organization_id, SUM(deposit_mrp-ref_deposit_mrp) mrp_dep_amt, SUM(deposit_net-ref_deposit_net_amt) net_dep_amt FROM st_rep_ola_agent WHERE  finaldate&gt;='&quot;+requestBean.getFromDate()+&quot;' AND finaldate&lt;='&quot;+requestBean.getToDate()+&quot;'&quot;+walletAppender+&quot; group by organization_id&quot;;</span>
<span class="nc" id="L220">			responseBeanMap = new HashMap&lt;Integer, OlaOrgReportResponseBean&gt;();</span>
<span class="nc" id="L221">			depositQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L222">			depositQueryBuilder.append(&quot;select agent_org_id, IFNULL(SUM(mrp_dep_amt),0.0) mrp_dep_amt, IFNULL(SUM(net_dep_amt),0.00) net_dep_amt FROM (SELECT om.parent_id agent_org_id, IFNULL(SUM(mrp_dep_amt),0.0) mrp_dep_amt, IFNULL(SUM(net_dep_amt),0.00) net_dep_amt FROM (SELECT rtm.retailer_org_id, deposit_amt mrp_dep_amt, agent_net_amt net_dep_amt FROM st_lms_retailer_transaction_master rtm INNER JOIN st_ola_ret_deposit dp ON rtm.transaction_id=dp.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND rtm.transaction_type='OLA_DEPOSIT' UNION ALL SELECT rtm.retailer_org_id, -deposit_amt mrp_refund_amt, -agent_net_amt net_refund_amt FROM st_lms_retailer_transaction_master rtm INNER JOIN st_ola_ret_deposit_refund dpr ON rtm.transaction_id=dpr.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND rtm.transaction_type='OLA_DEPOSIT_REFUND')main INNER JOIN st_lms_organization_master om ON om.organization_id=main.retailer_org_id GROUP BY om.parent_id &quot;).append(archiveAppender).append(&quot; )tmp group by agent_org_id&quot;);</span>
<span class="nc" id="L223">			logger.debug(&quot;fetchDepositDataMultipleAgent - &quot;+depositQueryBuilder.toString());</span>

<span class="nc" id="L225">			stmt = connection.createStatement();</span>
<span class="nc" id="L226">			rs = stmt.executeQuery(depositQueryBuilder.toString());</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L228">				responseBean = new OlaOrgReportResponseBean();</span>
<span class="nc" id="L229">				responseBean.setMrpDepositAmt(rs.getDouble(&quot;mrp_dep_amt&quot;));</span>
<span class="nc" id="L230">				responseBean.setNetDepositAmt(rs.getDouble(&quot;net_dep_amt&quot;));</span>
<span class="nc" id="L231">				responseBeanMap.put(rs.getInt(&quot;agent_org_id&quot;), responseBean);</span>
			}
<span class="nc" id="L233">		} catch(SQLException se) {</span>
<span class="nc" id="L234">			se.printStackTrace();</span>
<span class="nc" id="L235">			throw new GenericException(LMSErrors.SQL_EXCEPTION_CODE, se);</span>
<span class="nc" id="L236">		} catch(Exception e) {</span>
<span class="nc" id="L237">			e.printStackTrace();</span>
<span class="nc" id="L238">			throw new GenericException(LMSErrors.GENERAL_EXCEPTION_CODE, e);</span>
<span class="nc" id="L239">		}</span>

<span class="nc" id="L241">		return responseBeanMap;</span>
	}
	
	/**
	 * 
	 * @param requestBean
	 * @param connection
	 * @return
	 * @throws GenericException
	 */
	public static Map&lt;Integer, OlaOrgReportResponseBean&gt; fetchDepositDirectPlayerDataMultipleAgent(OlaOrgReportRequestBean requestBean, Connection connection) throws GenericException {
<span class="nc" id="L252">		Map&lt;Integer, OlaOrgReportResponseBean&gt; responseBeanMap = null;</span>
<span class="nc" id="L253">		OlaOrgReportResponseBean responseBean = null;</span>
<span class="nc" id="L254">		Statement stmt = null;</span>
<span class="nc" id="L255">		ResultSet rs = null;</span>
<span class="nc" id="L256">		StringBuilder depositQueryBuilder = null;</span>
		try {
<span class="nc bnc" id="L258" title="All 2 branches missed.">			String walletAppender = (requestBean.getWalletId() == 0)?&quot;&quot;:&quot; AND wallet_id=&quot;+requestBean.getWalletId();</span>
<span class="nc" id="L259">			String archiveAppender = &quot; UNION ALL SELECT organization_id, SUM(deposit_mrp-ref_deposit_mrp) mrp_dep_amt, SUM(deposit_net-ref_deposit_net_amt) net_dep_amt FROM st_rep_ola_agt_dir WHERE   date(finaldate)&gt;=date('&quot;+requestBean.getFromDate()+&quot;') AND date(finaldate)&lt;=date('&quot;+requestBean.getToDate()+&quot;')&quot;+walletAppender+&quot; group by organization_id &quot;;</span>
<span class="nc" id="L260">			responseBeanMap = new HashMap&lt;Integer, OlaOrgReportResponseBean&gt;();</span>
<span class="nc" id="L261">			depositQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L262">			depositQueryBuilder.append(&quot;SELECT agent_org_id, IFNULL(SUM(mrp_dep_amt),0.0) mrp_dep_amt, IFNULL(SUM(net_dep_amt),0.00) net_dep_amt FROM (SELECT agent_org_id, deposit_amt mrp_dep_amt, net_amt net_dep_amt FROM st_lms_agent_transaction_master atm INNER JOIN st_ola_agt_direct_plr_deposit dp ON atm.transaction_id=dp.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND atm.transaction_type='OLA_DEPOSIT_PLR' UNION ALL SELECT agent_org_id, -deposit_amt mrp_refund_amt, -net_amt net_refund_amt FROM st_lms_agent_transaction_master atm INNER JOIN st_ola_agt_direct_plr_deposit_refund dpr ON atm.transaction_id=dpr.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND atm.transaction_type='OLA_DEPOSIT_REFUND_PLR' &quot;).append(archiveAppender).append(&quot; )main GROUP BY agent_org_id;&quot;);</span>
<span class="nc" id="L263">			logger.debug(&quot;fetchDepositDirectPlayerDataMultipleAgent - &quot;+depositQueryBuilder.toString());</span>

<span class="nc" id="L265">			stmt = connection.createStatement();</span>
<span class="nc" id="L266">			rs = stmt.executeQuery(depositQueryBuilder.toString());</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L268">				responseBean = new OlaOrgReportResponseBean();</span>
<span class="nc" id="L269">				responseBean.setMrpDepositAmt(rs.getDouble(&quot;mrp_dep_amt&quot;));</span>
<span class="nc" id="L270">				responseBean.setNetDepositAmt(rs.getDouble(&quot;net_dep_amt&quot;));</span>
<span class="nc" id="L271">				responseBeanMap.put(rs.getInt(&quot;agent_org_id&quot;), responseBean);</span>
			}
<span class="nc" id="L273">		} catch(SQLException se) {</span>
<span class="nc" id="L274">			se.printStackTrace();</span>
<span class="nc" id="L275">			throw new GenericException(LMSErrors.SQL_EXCEPTION_CODE, se);</span>
<span class="nc" id="L276">		} catch(Exception e) {</span>
<span class="nc" id="L277">			e.printStackTrace();</span>
<span class="nc" id="L278">			throw new GenericException(LMSErrors.GENERAL_EXCEPTION_CODE, e);</span>
<span class="nc" id="L279">		}</span>

<span class="nc" id="L281">		return responseBeanMap;</span>
	}
	
	/**
	 * 
	 * @param requestBean
	 * @param connection
	 * @return
	 * @throws GenericException
	 */
	public static OlaOrgReportResponseBean fetchWithdrawDataSingleAgent(OlaOrgReportRequestBean requestBean, Connection connection) throws GenericException {
<span class="nc" id="L292">		OlaOrgReportResponseBean responseBean = null;</span>
<span class="nc" id="L293">		Statement stmt = null;</span>
<span class="nc" id="L294">		ResultSet rs = null;</span>
<span class="nc" id="L295">		StringBuilder withdrawQueryBuilder = null;</span>
		try {
<span class="nc bnc" id="L297" title="All 2 branches missed.">			String walletAppender = (requestBean.getWalletId() == 0)?&quot;&quot;:&quot; AND wallet_id=&quot;+requestBean.getWalletId();</span>
<span class="nc" id="L298">			String archiveAppender = &quot; union all SELECT organization_id, SUM(withdrawal_mrp) mrp_with_amt, SUM(withdrawal_net_amt) net_with_amt FROM st_rep_ola_retailer WHERE  finaldate&gt;='&quot;+requestBean.getFromDate()+&quot;' AND finaldate&lt;='&quot;+requestBean.getToDate()+&quot;' AND organization_id=&quot;+requestBean.getOrgId()+walletAppender;</span>
<span class="nc" id="L299">			withdrawQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L300">			withdrawQueryBuilder.append(&quot;SELECT parent_id agent_org_id, IFNULL(SUM(mrp_wid_amt),0.0) mrp_with_amt, IFNULL(SUM(net_wid_amt),0.00) net_with_amt FROM (SELECT rtm.retailer_org_id,withdrawl_amt mrp_wid_amt, agent_net_amt net_wid_amt FROM st_lms_retailer_transaction_master rtm INNER JOIN st_ola_ret_withdrawl wd ON rtm.transaction_id=wd.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND rtm.transaction_type='OLA_WITHDRAWL' &quot;).append(archiveAppender).append(&quot;)main INNER JOIN st_lms_organization_master om ON om.organization_id=main.retailer_org_id WHERE parent_id=&quot;).append(requestBean.getOrgId());</span>
<span class="nc" id="L301">			logger.debug(&quot;fetchWithdrawDataSingleAgent - &quot;+withdrawQueryBuilder.toString());</span>

<span class="nc" id="L303">			stmt = connection.createStatement();</span>
<span class="nc" id="L304">			rs = stmt.executeQuery(withdrawQueryBuilder.toString());</span>
<span class="nc bnc" id="L305" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L306">				responseBean = new OlaOrgReportResponseBean();</span>
<span class="nc" id="L307">				responseBean.setOrgId(rs.getInt(&quot;agent_org_id&quot;));</span>
<span class="nc" id="L308">				responseBean.setMrpWithdrawalAmt(rs.getDouble(&quot;mrp_with_amt&quot;));</span>
<span class="nc" id="L309">				responseBean.setNetWithdrawalAmt(rs.getDouble(&quot;net_with_amt&quot;));</span>
			}
<span class="nc" id="L311">		} catch(SQLException se) {</span>
<span class="nc" id="L312">			se.printStackTrace();</span>
<span class="nc" id="L313">			throw new GenericException(LMSErrors.SQL_EXCEPTION_CODE, se);</span>
<span class="nc" id="L314">		} catch(Exception e) {</span>
<span class="nc" id="L315">			e.printStackTrace();</span>
<span class="nc" id="L316">			throw new GenericException(LMSErrors.GENERAL_EXCEPTION_CODE, e);</span>
<span class="nc" id="L317">		}</span>

<span class="nc" id="L319">		return responseBean;</span>
	}
	
	/**
	 * 
	 * @param requestBean
	 * @param connection
	 * @return
	 * @throws GenericException
	 */
	public static Map&lt;String, OlaOrgReportResponseBean&gt; fetchWithdrawDataSingleAgentDateWise(OlaOrgReportRequestBean requestBean, Connection connection) throws GenericException {
<span class="nc" id="L330">		Map&lt;String, OlaOrgReportResponseBean&gt; responseBeanMap = null;</span>
<span class="nc" id="L331">		OlaOrgReportResponseBean responseBean = null;</span>
<span class="nc" id="L332">		Statement stmt = null;</span>
<span class="nc" id="L333">		ResultSet rs = null;</span>
<span class="nc" id="L334">		StringBuilder withdrawQueryBuilder = null;</span>
		try {
<span class="nc bnc" id="L336" title="All 2 branches missed.">			String walletAppender = (requestBean.getWalletId() == 0)?&quot;&quot;:&quot; AND wallet_id=&quot;+requestBean.getWalletId();</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">			String agentAppender = (requestBean.getOrgId() == 0)?&quot;&quot;:&quot; AND parent_id=&quot;+requestBean.getOrgId();</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">			String agentArchiveAppender = (requestBean.getOrgId() == 0)?&quot;&quot;:&quot; AND organization_id=&quot;+requestBean.getOrgId();</span>
<span class="nc" id="L339">			String archiveAppender = &quot; union all SELECT organization_id, SUM(withdrawal_mrp) mrp_with_amt, SUM(withdrawal_net_amt) net_with_amt, finaldate FROM st_rep_ola_agent WHERE  finaldate&gt;='&quot;+requestBean.getFromDate()+&quot;' AND finaldate&lt;='&quot;+requestBean.getToDate()+&quot;'&quot;+agentArchiveAppender+walletAppender+&quot; group by finaldate&quot;;</span>
<span class="nc" id="L340">			responseBeanMap = new HashMap&lt;String, OlaOrgReportResponseBean&gt;();</span>
<span class="nc" id="L341">			withdrawQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L342">			withdrawQueryBuilder.append(&quot;select agent_org_id, IFNULL(SUM(mrp_with_amt),0.0) mrp_withd_amt, IFNULL(SUM(net_with_amt),0.00) net_withd_amt, DATE(transaction_date) transaction_date FROM ( SELECT parent_id agent_org_id, IFNULL(SUM(mrp_wid_amt),0.0) mrp_with_amt, IFNULL(SUM(net_wid_amt),0.00) net_with_amt, DATE(transaction_date) transaction_date FROM (SELECT rtm.retailer_org_id,withdrawl_amt mrp_wid_amt, agent_net_amt net_wid_amt, transaction_date FROM st_lms_retailer_transaction_master rtm INNER JOIN st_ola_ret_withdrawl wd ON rtm.transaction_id=wd.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND rtm.transaction_type='OLA_WITHDRAWL')main INNER JOIN st_lms_organization_master om ON om.organization_id=main.retailer_org_id&quot;).append(agentAppender).append( &quot; GROUP BY DATE(transaction_date) &quot;).append(archiveAppender).append(&quot; )tmp group by transaction_date&quot;);;</span>
<span class="nc" id="L343">			logger.debug(&quot;fetchWithdrawDataSingleAgentDateWise - &quot;+withdrawQueryBuilder.toString());</span>

<span class="nc" id="L345">			stmt = connection.createStatement();</span>
<span class="nc" id="L346">			rs = stmt.executeQuery(withdrawQueryBuilder.toString());</span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L348">				responseBean = new OlaOrgReportResponseBean();</span>
<span class="nc" id="L349">				responseBean.setOrgId(rs.getInt(&quot;agent_org_id&quot;));</span>
<span class="nc" id="L350">				responseBean.setMrpWithdrawalAmt(rs.getDouble(&quot;mrp_withd_amt&quot;));</span>
<span class="nc" id="L351">				responseBean.setNetWithdrawalAmt(rs.getDouble(&quot;net_withd_amt&quot;));</span>
<span class="nc" id="L352">				responseBeanMap.put(rs.getString(&quot;transaction_date&quot;), responseBean);</span>
			}
<span class="nc" id="L354">		} catch(SQLException se) {</span>
<span class="nc" id="L355">			se.printStackTrace();</span>
<span class="nc" id="L356">			throw new GenericException(LMSErrors.SQL_EXCEPTION_CODE, se);</span>
<span class="nc" id="L357">		} catch(Exception e) {</span>
<span class="nc" id="L358">			e.printStackTrace();</span>
<span class="nc" id="L359">			throw new GenericException(LMSErrors.GENERAL_EXCEPTION_CODE, e);</span>
<span class="nc" id="L360">		}</span>

<span class="nc" id="L362">		return responseBeanMap;</span>
	}
	
	/**
	 * 
	 * @param requestBean
	 * @param connection
	 * @return
	 * @throws GenericException
	 */
	public static OlaOrgReportResponseBean fetchWithdrawDirectPlayerDataSingleAgent(OlaOrgReportRequestBean requestBean, Connection connection) throws GenericException {
<span class="nc" id="L373">		OlaOrgReportResponseBean responseBean = null;</span>
<span class="nc" id="L374">		Statement stmt = null;</span>
<span class="nc" id="L375">		ResultSet rs = null;</span>
<span class="nc" id="L376">		StringBuilder withdrawQueryBuilder = null;</span>
		try {
<span class="nc bnc" id="L378" title="All 2 branches missed.">			String walletAppender = (requestBean.getWalletId() == 0)?&quot;&quot;:&quot; AND wallet_id=&quot;+requestBean.getWalletId();</span>
<span class="nc bnc" id="L379" title="All 2 branches missed.">			String agentAppender = (requestBean.getOrgId() == 0)?&quot;&quot;:&quot; AND agent_org_id=&quot;+requestBean.getOrgId();</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">			String agentArchAppender = (requestBean.getOrgId() == 0)?&quot;&quot;:&quot; AND organization_id=&quot;+requestBean.getOrgId();</span>
<span class="nc" id="L381">			String archiveAppender = &quot; UNION ALL SELECT ifNULL(organization_id,0), SUM(withdrawal_mrp) mrp_with_amt, SUM(withdrawal_net_amt) net_with_amt FROM st_rep_ola_agt_dir WHERE finaldate&gt;='&quot;+requestBean.getFromDate()+&quot;' AND finaldate&lt;='&quot;+requestBean.getToDate()+&quot;'&quot;+agentArchAppender+walletAppender;</span>
<span class="nc" id="L382">			withdrawQueryBuilder = new StringBuilder();			</span>
<span class="nc" id="L383">			withdrawQueryBuilder.append(&quot;SELECT IFNULL(agent_org_id,0) agent_org_id, IFNULL(SUM(withdrawl_amt),0.0) mrp_with_amt, IFNULL(SUM(net_amt),0.0) net_with_amt FROM st_lms_agent_transaction_master atm INNER JOIN st_ola_agt_direct_plr_withdrawl dw ON atm.transaction_id=dw.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;' AND atm.transaction_type='OLA_WITHDRAWL_PLR' &quot;).append(agentAppender).append(archiveAppender);</span>
<span class="nc" id="L384">			logger.debug(&quot;fetchWithdrawDirectPlayerDataSingleAgent - &quot;+withdrawQueryBuilder.toString());</span>

<span class="nc" id="L386">			stmt = connection.createStatement();</span>
<span class="nc" id="L387">			rs = stmt.executeQuery(withdrawQueryBuilder.toString());</span>
<span class="nc" id="L388">			int orgId = 0;</span>
<span class="nc" id="L389">			double mrpWithAmt = 0.0;</span>
<span class="nc" id="L390">			double netAmt = 0.0;</span>
<span class="nc" id="L391">			responseBean = new OlaOrgReportResponseBean();</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">			while (rs.next()) {				</span>
<span class="nc" id="L393">				orgId = orgId + rs.getInt(&quot;agent_org_id&quot;);</span>
<span class="nc" id="L394">				mrpWithAmt = mrpWithAmt + rs.getDouble(&quot;mrp_with_amt&quot;);</span>
<span class="nc" id="L395">				netAmt = netAmt+ rs.getDouble(&quot;net_with_amt&quot;);</span>
			}
<span class="nc" id="L397">			responseBean.setOrgId(orgId);</span>
<span class="nc" id="L398">			responseBean.setMrpWithdrawalAmt(mrpWithAmt);</span>
<span class="nc" id="L399">			responseBean.setNetWithdrawalAmt(netAmt);</span>
<span class="nc" id="L400">		} catch(SQLException se) {</span>
<span class="nc" id="L401">			se.printStackTrace();</span>
<span class="nc" id="L402">			throw new GenericException(LMSErrors.SQL_EXCEPTION_CODE, se);</span>
<span class="nc" id="L403">		} catch(Exception e) {</span>
<span class="nc" id="L404">			e.printStackTrace();</span>
<span class="nc" id="L405">			throw new GenericException(LMSErrors.GENERAL_EXCEPTION_CODE, e);</span>
<span class="nc" id="L406">		}</span>

<span class="nc" id="L408">		return responseBean;</span>
	}
	
	/**
	 * 
	 * @param requestBean
	 * @param connection
	 * @return
	 * @throws GenericException
	 */
	public static Map&lt;String, OlaOrgReportResponseBean&gt; fetchWithdrawDirectPlayerDataSingleAgentDateWise(OlaOrgReportRequestBean requestBean, Connection connection) throws GenericException {
<span class="nc" id="L419">		Map&lt;String, OlaOrgReportResponseBean&gt; responseBeanMap = null;</span>
<span class="nc" id="L420">		OlaOrgReportResponseBean responseBean = null;</span>
<span class="nc" id="L421">		Statement stmt = null;</span>
<span class="nc" id="L422">		ResultSet rs = null;</span>
<span class="nc" id="L423">		StringBuilder withdrawQueryBuilder = null;</span>
		try {
<span class="nc bnc" id="L425" title="All 2 branches missed.">			String walletAppender = (requestBean.getWalletId() == 0)?&quot;&quot;:&quot; AND wallet_id=&quot;+requestBean.getWalletId();</span>
<span class="nc bnc" id="L426" title="All 2 branches missed.">			String agentAppender = (requestBean.getOrgId() == 0)?&quot;&quot;:&quot; AND agent_org_id=&quot;+requestBean.getOrgId();</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">			String agentArchAppender = (requestBean.getOrgId() == 0)?&quot;&quot;:&quot; AND organization_id=&quot;+requestBean.getOrgId();</span>
<span class="nc" id="L428">			String archiveAppender = &quot;  UNION ALL SELECT IFNULL(organization_id,0) agent_org_id, SUM(withdrawal_mrp) mrp_with_amt, SUM(withdrawal_net_amt) net_with_amt, finaldate FROM st_rep_ola_agt_dir WHERE  finaldate&gt;='&quot;+requestBean.getFromDate()+&quot;' AND finaldate&lt;='&quot;+requestBean.getToDate()+&quot;'&quot;+agentArchAppender+walletAppender+&quot; group by finaldate&quot;;</span>
<span class="nc" id="L429">			responseBeanMap = new HashMap&lt;String, OlaOrgReportResponseBean&gt;();</span>
<span class="nc" id="L430">			withdrawQueryBuilder = new StringBuilder();			</span>
<span class="nc" id="L431">			withdrawQueryBuilder.append(&quot;SELECT IFNULL(agent_org_id,0) agent_org_id, IFNULL(sum(withdrawl_amt),0.0) mrp_with_amt, IFNULL(SUM(net_amt),0.0) net_with_amt, DATE(transaction_date) transaction_date FROM st_lms_agent_transaction_master atm INNER JOIN st_ola_agt_direct_plr_withdrawl dw ON atm.transaction_id=dw.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND atm.transaction_type='OLA_WITHDRAWL_PLR' &quot;).append(agentAppender).append(&quot; GROUP BY DATE(transaction_date) &quot;).append(archiveAppender);</span>
<span class="nc" id="L432">			logger.debug(&quot;fetchWithdrawDirectPlayerDataSingleAgentDateWise - &quot;+withdrawQueryBuilder.toString());</span>

<span class="nc" id="L434">			stmt = connection.createStatement();</span>
<span class="nc" id="L435">			rs = stmt.executeQuery(withdrawQueryBuilder.toString());			</span>
<span class="nc bnc" id="L436" title="All 2 branches missed.">			while (rs.next()) {				</span>
<span class="nc" id="L437">				responseBean = new OlaOrgReportResponseBean();</span>
<span class="nc" id="L438">				responseBean.setOrgId(rs.getInt(&quot;agent_org_id&quot;));</span>
<span class="nc" id="L439">				responseBean.setMrpWithdrawalAmt(rs.getDouble(&quot;mrp_with_amt&quot;));</span>
<span class="nc" id="L440">				responseBean.setNetWithdrawalAmt(rs.getDouble(&quot;net_with_amt&quot;));</span>
<span class="nc" id="L441">				responseBeanMap.put(rs.getString(&quot;transaction_date&quot;), responseBean);</span>
			}
<span class="nc" id="L443">		} catch(SQLException se) {</span>
<span class="nc" id="L444">			se.printStackTrace();</span>
<span class="nc" id="L445">			throw new GenericException(LMSErrors.SQL_EXCEPTION_CODE, se);</span>
<span class="nc" id="L446">		} catch(Exception e) {</span>
<span class="nc" id="L447">			e.printStackTrace();</span>
<span class="nc" id="L448">			throw new GenericException(LMSErrors.GENERAL_EXCEPTION_CODE, e);</span>
<span class="nc" id="L449">		}</span>

<span class="nc" id="L451">		return responseBeanMap;</span>
	}
	
	/**
	 * 
	 * @param requestBean
	 * @param connection
	 * @return
	 * @throws GenericException
	 */
	public static Map&lt;Integer, OlaOrgReportResponseBean&gt; fetchWithdrawDataMultipleAgent(OlaOrgReportRequestBean requestBean, Connection connection) throws GenericException {
<span class="nc" id="L462">		Map&lt;Integer, OlaOrgReportResponseBean&gt; responseBeanMap = null;</span>
<span class="nc" id="L463">		OlaOrgReportResponseBean responseBean = null;</span>
<span class="nc" id="L464">		Statement stmt = null;</span>
<span class="nc" id="L465">		ResultSet rs = null;</span>
<span class="nc" id="L466">		StringBuilder withdrawQueryBuilder = null;</span>
		try {
<span class="nc bnc" id="L468" title="All 2 branches missed.">			String walletAppender = (requestBean.getWalletId() == 0)?&quot;&quot;:&quot; AND wallet_id=&quot;+requestBean.getWalletId();</span>
<span class="nc" id="L469">			String archiveAppender = &quot; UNION ALL SELECT organization_id, SUM(withdrawal_mrp) mrp_with_amt, SUM(withdrawal_net_amt) net_with_amt FROM st_rep_ola_agent WHERE  finaldate&gt;='&quot;+requestBean.getFromDate()+&quot;' AND finaldate&lt;='&quot;+requestBean.getToDate()+&quot;'&quot;+walletAppender+&quot; group by organization_id&quot;;</span>
<span class="nc" id="L470">			responseBeanMap = new HashMap&lt;Integer, OlaOrgReportResponseBean&gt;();</span>
<span class="nc" id="L471">			withdrawQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L472">			withdrawQueryBuilder.append(&quot;SELECT agent_org_id, IFNULL(SUM(mrp_with_amt),0.0) mrp_withd_amt, IFNULL(SUM(net_with_amt),0.00) net_withd_amt FROM ( SELECT parent_id agent_org_id, IFNULL(SUM(mrp_wid_amt),0.0) mrp_with_amt, IFNULL(SUM(net_wid_amt),0.00) net_with_amt FROM (SELECT rtm.retailer_org_id, withdrawl_amt mrp_wid_amt, agent_net_amt net_wid_amt FROM st_lms_retailer_transaction_master rtm INNER JOIN st_ola_ret_withdrawl wd ON rtm.transaction_id=wd.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND rtm.transaction_type='OLA_WITHDRAWL' )main INNER JOIN st_lms_organization_master om ON om.organization_id=main.retailer_org_id GROUP BY parent_id &quot;).append(archiveAppender).append(&quot; )tmp group by agent_org_id&quot;);</span>
<span class="nc" id="L473">			logger.debug(&quot;fetchWithdrawDataMultipleAgent - &quot;+withdrawQueryBuilder.toString());</span>

<span class="nc" id="L475">			stmt = connection.createStatement();</span>
<span class="nc" id="L476">			rs = stmt.executeQuery(withdrawQueryBuilder.toString());</span>
<span class="nc bnc" id="L477" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L478">				responseBean = new OlaOrgReportResponseBean();</span>
<span class="nc" id="L479">				responseBean.setMrpWithdrawalAmt(rs.getDouble(&quot;mrp_withd_amt&quot;));</span>
<span class="nc" id="L480">				responseBean.setNetWithdrawalAmt(rs.getDouble(&quot;net_withd_amt&quot;));</span>
<span class="nc" id="L481">				responseBeanMap.put(rs.getInt(&quot;agent_org_id&quot;), responseBean);</span>
			}
<span class="nc" id="L483">		} catch(SQLException se) {</span>
<span class="nc" id="L484">			se.printStackTrace();</span>
<span class="nc" id="L485">			throw new GenericException(LMSErrors.SQL_EXCEPTION_CODE, se);</span>
<span class="nc" id="L486">		} catch(Exception e) {</span>
<span class="nc" id="L487">			e.printStackTrace();</span>
<span class="nc" id="L488">			throw new GenericException(LMSErrors.GENERAL_EXCEPTION_CODE, e);</span>
<span class="nc" id="L489">		}</span>

<span class="nc" id="L491">		return responseBeanMap;</span>
	}
	
	/**
	 * 
	 * @param requestBean
	 * @param connection
	 * @return
	 * @throws GenericException
	 */
	public static Map&lt;Integer, OlaOrgReportResponseBean&gt; fetchWithdrawDirectPlayerDataMultipleAgent(OlaOrgReportRequestBean requestBean, Connection connection) throws GenericException {
<span class="nc" id="L502">		Map&lt;Integer, OlaOrgReportResponseBean&gt; responseBeanMap = null;</span>
<span class="nc" id="L503">		OlaOrgReportResponseBean responseBean = null;</span>
<span class="nc" id="L504">		Statement stmt = null;</span>
<span class="nc" id="L505">		ResultSet rs = null;</span>
<span class="nc" id="L506">		StringBuilder withdrawQueryBuilder = null;</span>
		try {
<span class="nc bnc" id="L508" title="All 2 branches missed.">			String walletAppender = (requestBean.getWalletId() == 0)?&quot;&quot;:&quot; AND wallet_id=&quot;+requestBean.getWalletId();</span>
<span class="nc" id="L509">			String archiveAppender = &quot; union all SELECT organization_id, (withdrawal_mrp) mrp_with_amt, (withdrawal_net_amt) net_with_amt FROM st_rep_ola_agt_dir WHERE  finaldate&gt;='&quot;+requestBean.getFromDate()+&quot;' AND finaldate&lt;='&quot;+requestBean.getToDate()+&quot;'&quot;+walletAppender;</span>
<span class="nc" id="L510">			responseBeanMap = new HashMap&lt;Integer, OlaOrgReportResponseBean&gt;();</span>
<span class="nc" id="L511">			withdrawQueryBuilder = new StringBuilder();</span>
<span class="nc" id="L512">			withdrawQueryBuilder.append(&quot;SELECT agent_org_id, IFNULL(SUM(withdrawl_amt),0.0) mrp_with_amt, IFNULL(SUM(net_amt),0.0) net_with_amt FROM st_lms_agent_transaction_master atm INNER JOIN st_ola_agt_direct_plr_withdrawl dw ON atm.transaction_id=dw.transaction_id WHERE transaction_date&gt;='&quot;).append(requestBean.getFromDate()).append(&quot;' AND transaction_date&lt;='&quot;).append(requestBean.getToDate()).append(&quot;'&quot;).append(walletAppender).append(&quot; AND atm.transaction_type='OLA_WITHDRAWL_PLR' GROUP BY agent_org_id &quot;).append(archiveAppender);</span>
<span class="nc" id="L513">			logger.debug(&quot;fetchWithdrawDirectPlayerDataMultipleAgent - &quot;+withdrawQueryBuilder.toString());</span>

<span class="nc" id="L515">			stmt = connection.createStatement();</span>
<span class="nc" id="L516">			rs = stmt.executeQuery(withdrawQueryBuilder.toString());</span>
<span class="nc bnc" id="L517" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L518">				responseBean = new OlaOrgReportResponseBean();</span>
<span class="nc" id="L519">				responseBean.setMrpWithdrawalAmt(rs.getDouble(&quot;mrp_with_amt&quot;));</span>
<span class="nc" id="L520">				responseBean.setNetWithdrawalAmt(rs.getDouble(&quot;net_with_amt&quot;));</span>
<span class="nc" id="L521">				responseBeanMap.put(rs.getInt(&quot;agent_org_id&quot;), responseBean);</span>
			}
<span class="nc" id="L523">		} catch(SQLException se) {</span>
<span class="nc" id="L524">			se.printStackTrace();</span>
<span class="nc" id="L525">			throw new GenericException(LMSErrors.SQL_EXCEPTION_CODE, se);</span>
<span class="nc" id="L526">		} catch(Exception e) {</span>
<span class="nc" id="L527">			e.printStackTrace();</span>
<span class="nc" id="L528">			throw new GenericException(LMSErrors.GENERAL_EXCEPTION_CODE, e);</span>
<span class="nc" id="L529">		}</span>

<span class="nc" id="L531">		return responseBeanMap;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>