<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MessageInboxAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.web.userMgmt.common</a> &gt; <span class="el_source">MessageInboxAction.java</span></div><h1>MessageInboxAction.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.web.userMgmt.common;

import java.io.PrintWriter;
import java.sql.Timestamp;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpSession;

import net.sf.json.JSONArray;
import net.sf.json.JSONObject;

import com.google.gson.JsonArray;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;
import com.opensymphony.xwork2.ModelDriven;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.BaseAction;
import com.skilrock.lms.common.exception.GenericException;
import com.skilrock.lms.common.utility.LMSUtility;
import com.skilrock.lms.coreEngine.instantWin.common.IWUtil;
import com.skilrock.lms.coreEngine.ola.common.OLAUtility;
import com.skilrock.lms.coreEngine.sportsLottery.common.SLEUtil;
import com.skilrock.lms.coreEngine.sportsLottery.common.controllerImpl.CommonMethodsControllerImpl;
import com.skilrock.lms.coreEngine.userMgmt.common.AdvMsgHelper;
import com.skilrock.lms.coreEngine.userMgmt.javaBeans.MessageInboxBean;
import com.skilrock.lms.coreEngine.userMgmt.serviceImpl.MessageInboxServiceImpl;
import com.skilrock.lms.web.drawGames.common.Util;
import com.skilrock.lms.web.reportsMgmt.common.ReportUtility;

public class MessageInboxAction extends BaseAction implements
		ModelDriven&lt;MessageInboxBean&gt; {
	private static final long serialVersionUID = 1L;

	private String orgType;
	private String interfaceType;
	private Map&lt;String, String&gt; userTypeMap;
	private int mode;
<span class="nc" id="L44">	private List&lt;MessageInboxBean&gt; messageList = null;</span>
	private MessageInboxBean messageBean;
	private String[] retName;
	private String messages;

	/* Additional Variables for Add Messages for Player Start */
	private HashMap&lt;Integer, String&gt; commSerList;
	private HashMap&lt;Integer, String&gt; drawSerList;
	private Map&lt;Integer, String&gt; olaSerList;
	private Map&lt;Integer, String&gt; sleServiceMap;
	private Map&lt;Integer, String&gt; iwServiceMap;

	private String[] gameName;
	private String[] categoryName;
	private String[] walletName;
	private String[] gameNo;
	private String[] sleGameNo;
	private String[] iwGameNo;
	private String[] categoryNo;
	private String[] walletNo;
	private String serviceId;
	private String serviceType;
	private String message;
	private String msgLocation;
	private String activity;
	private String activity2;
	private String activity3;

	/* Additional Variables for Add Messages for Player End */

	public HashMap&lt;Integer, String&gt; getCommSerList() {
<span class="nc" id="L75">		return commSerList;</span>
	}

	public void setCommSerList(HashMap&lt;Integer, String&gt; commSerList) {
<span class="nc" id="L79">		this.commSerList = commSerList;</span>
<span class="nc" id="L80">	}</span>

	public HashMap&lt;Integer, String&gt; getDrawSerList() {
<span class="nc" id="L83">		return drawSerList;</span>
	}

	public void setDrawSerList(HashMap&lt;Integer, String&gt; drawSerList) {
<span class="nc" id="L87">		this.drawSerList = drawSerList;</span>
<span class="nc" id="L88">	}</span>

	public Map&lt;Integer, String&gt; getOlaSerList() {
<span class="nc" id="L91">		return olaSerList;</span>
	}

	public void setOlaSerList(Map&lt;Integer, String&gt; olaSerList) {
<span class="nc" id="L95">		this.olaSerList = olaSerList;</span>
<span class="nc" id="L96">	}</span>

	public Map&lt;Integer, String&gt; getSleServiceMap() {
<span class="nc" id="L99">		return sleServiceMap;</span>
	}

	public void setSleServiceMap(Map&lt;Integer, String&gt; sleServiceMap) {
<span class="nc" id="L103">		this.sleServiceMap = sleServiceMap;</span>
<span class="nc" id="L104">	}</span>

	public String getOrgType() {
<span class="nc" id="L107">		return orgType;</span>
	}

	public void setOrgType(String orgType) {
<span class="nc" id="L111">		this.orgType = orgType;</span>
<span class="nc" id="L112">	}</span>

	public String getInterfaceType() {
<span class="nc" id="L115">		return interfaceType;</span>
	}

	public void setInterfaceType(String interfaceType) {
<span class="nc" id="L119">		this.interfaceType = interfaceType;</span>
<span class="nc" id="L120">	}</span>

	public Map&lt;String, String&gt; getUserTypeMap() {
<span class="nc" id="L123">		return userTypeMap;</span>
	}

	public void setUserTypeMap(Map&lt;String, String&gt; userTypeMap) {
<span class="nc" id="L127">		this.userTypeMap = userTypeMap;</span>
<span class="nc" id="L128">	}</span>

	public int getMode() {
<span class="nc" id="L131">		return mode;</span>
	}

	public void setMode(int mode) {
<span class="nc" id="L135">		this.mode = mode;</span>
<span class="nc" id="L136">	}</span>

	public List&lt;MessageInboxBean&gt; getMessageList() {
<span class="nc" id="L139">		return messageList;</span>
	}

	public void setMessageList(List&lt;MessageInboxBean&gt; messageList) {
<span class="nc" id="L143">		this.messageList = messageList;</span>
<span class="nc" id="L144">	}</span>

	public MessageInboxBean getMessageBean() {
<span class="nc" id="L147">		return messageBean;</span>
	}

	public void setMessageBean(MessageInboxBean messageBean) {
<span class="nc" id="L151">		this.messageBean = messageBean;</span>
<span class="nc" id="L152">	}</span>

	public String[] getRetName() {
<span class="nc" id="L155">		return retName;</span>
	}

	public void setRetName(String[] retName) {
<span class="nc" id="L159">		this.retName = retName;</span>
<span class="nc" id="L160">	}</span>

	public String getMessages() {
<span class="nc" id="L163">		return messages;</span>
	}

	public void setMessages(String messages) {
<span class="nc" id="L167">		this.messages = messages;</span>
<span class="nc" id="L168">	}</span>

	public String[] getGameName() {
<span class="nc" id="L171">		return gameName;</span>
	}

	public void setGameName(String[] gameName) {
<span class="nc" id="L175">		this.gameName = gameName;</span>
<span class="nc" id="L176">	}</span>

	public String[] getCategoryName() {
<span class="nc" id="L179">		return categoryName;</span>
	}

	public void setCategoryName(String[] categoryName) {
<span class="nc" id="L183">		this.categoryName = categoryName;</span>
<span class="nc" id="L184">	}</span>

	public String[] getWalletName() {
<span class="nc" id="L187">		return walletName;</span>
	}

	public void setWalletName(String[] walletName) {
<span class="nc" id="L191">		this.walletName = walletName;</span>
<span class="nc" id="L192">	}</span>

	public String[] getGameNo() {
<span class="nc" id="L195">		return gameNo;</span>
	}

	public void setGameNo(String[] gameNo) {
<span class="nc" id="L199">		this.gameNo = gameNo;</span>
<span class="nc" id="L200">	}</span>

	public String[] getSleGameNo() {
<span class="nc" id="L203">		return sleGameNo;</span>
	}

	public void setSleGameNo(String[] sleGameNo) {
<span class="nc" id="L207">		this.sleGameNo = sleGameNo;</span>
<span class="nc" id="L208">	}</span>

	public String[] getCategoryNo() {
<span class="nc" id="L211">		return categoryNo;</span>
	}

	public void setCategoryNo(String[] categoryNo) {
<span class="nc" id="L215">		this.categoryNo = categoryNo;</span>
<span class="nc" id="L216">	}</span>

	public String[] getWalletNo() {
<span class="nc" id="L219">		return walletNo;</span>
	}

	public void setWalletNo(String[] walletNo) {
<span class="nc" id="L223">		this.walletNo = walletNo;</span>
<span class="nc" id="L224">	}</span>

	public String getServiceId() {
<span class="nc" id="L227">		return serviceId;</span>
	}

	public void setServiceId(String serviceId) {
<span class="nc" id="L231">		this.serviceId = serviceId;</span>
<span class="nc" id="L232">	}</span>

	public String getServiceType() {
<span class="nc" id="L235">		return serviceType;</span>
	}

	public void setServiceType(String serviceType) {
<span class="nc" id="L239">		this.serviceType = serviceType;</span>
<span class="nc" id="L240">	}</span>

	public String getMessage() {
<span class="nc" id="L243">		return message;</span>
	}

	public void setMessage(String message) {
<span class="nc" id="L247">		this.message = message;</span>
<span class="nc" id="L248">	}</span>

	public String getMsgLocation() {
<span class="nc" id="L251">		return msgLocation;</span>
	}

	public void setMsgLocation(String msgLocation) {
<span class="nc" id="L255">		this.msgLocation = msgLocation;</span>
<span class="nc" id="L256">	}</span>

	public String getActivity() {
<span class="nc" id="L259">		return activity;</span>
	}

	public void setActivity(String activity) {
<span class="nc" id="L263">		this.activity = activity;</span>
<span class="nc" id="L264">	}</span>

	public String getActivity2() {
<span class="nc" id="L267">		return activity2;</span>
	}

	public void setActivity2(String activity2) {
<span class="nc" id="L271">		this.activity2 = activity2;</span>
<span class="nc" id="L272">	}</span>

	public String getActivity3() {
<span class="nc" id="L275">		return activity3;</span>
	}

	public void setActivity3(String activity3) {
<span class="nc" id="L279">		this.activity3 = activity3;</span>
<span class="nc" id="L280">	}</span>

	public String[] getIwGameNo() {
<span class="nc" id="L283">		return iwGameNo;</span>
	}

	public void setIwGameNo(String[] iwGameNo) {
<span class="nc" id="L287">		this.iwGameNo = iwGameNo;</span>
<span class="nc" id="L288">	}</span>
	
	public Map&lt;Integer, String&gt; getIwServiceMap() {
<span class="nc" id="L291">		return iwServiceMap;</span>
	}

	public void setIwServiceMap(Map&lt;Integer, String&gt; iwServiceMap) {
<span class="nc" id="L295">		this.iwServiceMap = iwServiceMap;</span>
<span class="nc" id="L296">	}</span>

	@Override
	public MessageInboxBean getModel() {
<span class="nc" id="L300">		messageBean = new MessageInboxBean();</span>
<span class="nc" id="L301">		return messageBean;</span>
	}

	public MessageInboxAction() {
<span class="nc" id="L305">		super(MessageInboxAction.class);</span>
<span class="nc" id="L306">	}</span>

	public String addNewMessageMenu() {
		try {
<span class="nc" id="L310">			commSerList = ReportUtility.fetchActiveCategoriesCommSerData();</span>
<span class="nc" id="L311">			drawSerList = ReportUtility.fetchActiveGameDrawDataMenu();</span>
<span class="nc" id="L312">			olaSerList = OLAUtility.getOlaWalletDataMap();</span>
<span class="nc" id="L313">			sleServiceMap = CommonMethodsControllerImpl.getInstance().getSLEGameMapForAdvMessage();</span>
<span class="nc" id="L314">			iwServiceMap = com.skilrock.lms.coreEngine.instantWin.common.controllerImpl.CommonMethodsControllerImpl.getInstance().getIWGameMapForAdvMessage();</span>

<span class="nc" id="L316">			userTypeMap = new LinkedHashMap&lt;String, String&gt;();</span>

<span class="nc" id="L318">			List&lt;String&gt; userTypeList = MessageInboxServiceImpl.getSingleInstance().getActiveUserType();</span>
<span class="nc bnc" id="L319" title="All 2 branches missed.">			if(userTypeList.contains(&quot;BO&quot;))</span>
<span class="nc" id="L320">				userTypeMap.put(&quot;BO&quot;, getText(&quot;BOUser&quot;));</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">			if(userTypeList.contains(&quot;AGENT&quot;))</span>
<span class="nc" id="L322">				userTypeMap.put(&quot;AGENT&quot;, getText(&quot;AGENT&quot;));</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">			if(userTypeList.contains(&quot;RETAILER&quot;))</span>
<span class="nc" id="L324">				userTypeMap.put(&quot;RETAILER&quot;, getText(&quot;Retailer&quot;));</span>

<span class="nc" id="L326">			userTypeMap.put(&quot;PLAYER&quot;, getText(&quot;label.plr&quot;));</span>
<span class="nc" id="L327">		} catch (GenericException e) {</span>
<span class="nc" id="L328">			e.printStackTrace();</span>
			// return
			// Response.status(e.getErrorCode()).entity(LMSErrorProperty.getPropertyValue(e.getErrorCode())).build();
<span class="nc" id="L331">		}</span>

<span class="nc" id="L333">		return SUCCESS;</span>
	}

	public String getInterfaceList() {
<span class="nc" id="L337">		PrintWriter out = null;</span>
<span class="nc" id="L338">		List&lt;String&gt; interfaceList = null;</span>
<span class="nc" id="L339">		JSONObject jsonObject = new JSONObject();</span>
		try {
<span class="nc" id="L341">			interfaceList = MessageInboxServiceImpl.getSingleInstance()</span>
					.getActiveInterfaceType(orgType);
<span class="nc" id="L343">			out = response.getWriter();</span>
<span class="nc" id="L344">			response.setContentType(&quot;application/json&quot;);</span>
			// out.write(new Gson().toJson(interfaceList));
<span class="nc" id="L346">			jsonObject.put(&quot;isSuccess&quot;, true);</span>
<span class="nc" id="L347">			jsonObject.put(&quot;responseData&quot;, interfaceList);</span>
<span class="nc" id="L348">		} catch (Exception ex) {</span>
<span class="nc" id="L349">			ex.printStackTrace();</span>
<span class="nc" id="L350">			jsonObject.put(&quot;isSuccess&quot;, false);</span>
<span class="nc" id="L351">			jsonObject.put(&quot;errorMsg&quot;, getText(&quot;msg.some.error&quot;));</span>
		} finally {
<span class="nc" id="L353">			out.print(jsonObject);</span>
<span class="nc" id="L354">			out.flush();</span>
<span class="nc" id="L355">			out.close();</span>
<span class="nc" id="L356">		}</span>

<span class="nc" id="L358">		return SUCCESS;</span>
	}

	public String getModeList() {
<span class="nc" id="L362">		PrintWriter out = null;</span>
<span class="nc" id="L363">		Map&lt;Integer, String&gt; modeMap = null;</span>
<span class="nc" id="L364">		JSONObject jsonObject = new JSONObject();</span>
		try {
<span class="nc" id="L366">			modeMap = MessageInboxServiceImpl.getSingleInstance()</span>
					.getActiveModes(orgType, interfaceType);
<span class="nc" id="L368">			out = response.getWriter();</span>
<span class="nc" id="L369">			response.setContentType(&quot;application/json&quot;);</span>
			// out.write(new Gson().toJson(modeMap));
<span class="nc" id="L371">			jsonObject.put(&quot;isSuccess&quot;, true);</span>
<span class="nc" id="L372">			jsonObject.put(&quot;responseData&quot;, modeMap);</span>
<span class="nc" id="L373">		} catch (Exception ex) {</span>
<span class="nc" id="L374">			ex.printStackTrace();</span>
<span class="nc" id="L375">			jsonObject.put(&quot;isSuccess&quot;, false);</span>
<span class="nc" id="L376">			jsonObject.put(&quot;errorMsg&quot;, getText(&quot;msg.some.error&quot;));</span>
		} finally {
<span class="nc" id="L378">			out.print(jsonObject);</span>
<span class="nc" id="L379">			out.flush();</span>
<span class="nc" id="L380">			out.close();</span>
<span class="nc" id="L381">		}</span>

<span class="nc" id="L383">		return SUCCESS;</span>
	}

	@SuppressWarnings(&quot;unchecked&quot;)
	public String addNewMessageSubmit() throws Exception {
<span class="nc" id="L388">		UserInfoBean userBean = null;</span>
<span class="nc" id="L389">		String result = &quot;error&quot;;</span>
		try {
<span class="nc" id="L391">			userBean = getUserBean();</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">			if (&quot;PLAYER&quot;.equalsIgnoreCase(orgType)) {</span>
<span class="nc" id="L393">				int srvcId = 0;</span>
<span class="nc" id="L394">				AdvMsgHelper helper = new AdvMsgHelper();</span>

<span class="nc" id="L396">				message = message.replaceAll(&quot;_&quot;, &quot;&quot;).replaceAll(&quot;,&quot;, &quot;&quot;);</span>

<span class="nc" id="L398">				srvcId = ((HashMap&lt;String, Integer&gt;) LMSUtility.sc</span>
						.getAttribute(&quot;SERVICES_CODE_ID_MAP&quot;)).get(serviceId);
<span class="nc bnc" id="L400" title="All 2 branches missed.">				if (&quot;DG&quot;.equalsIgnoreCase(serviceType)) {</span>
<span class="nc" id="L401">					result = helper.saveAdvMessageData(orgType, gameNo,</span>
							retName, message, userBean.getUserId(),
							msgLocation, activity, srvcId);
<span class="nc" id="L404">					gameName = new String[gameNo.length];</span>
<span class="nc bnc" id="L405" title="All 2 branches missed.">					for (int i = 0; i &lt; gameNo.length; i++) {</span>
<span class="nc" id="L406">						gameName[i] = Util.getGameDisplayName(Integer</span>
								.parseInt(gameNo[i]));
					}
<span class="nc" id="L409">					setGameName(gameName);</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">				} else if (&quot;CS&quot;.equalsIgnoreCase(serviceType)) {</span>
<span class="nc" id="L411">					categoryName = new String[categoryNo.length];</span>
<span class="nc" id="L412">					result = helper.saveAdvMessageData(orgType, categoryNo,</span>
							retName, message, userBean.getUserId(),
							msgLocation, activity2, srvcId);
<span class="nc bnc" id="L415" title="All 2 branches missed.">					for (int i = 0; i &lt; categoryNo.length; i++) {</span>
<span class="nc" id="L416">						categoryName[i] = Util.getCategoryName(Integer</span>
								.parseInt(categoryNo[i]));
					}
<span class="nc" id="L419">					setCategoryName(categoryName);</span>
<span class="nc bnc" id="L420" title="All 2 branches missed.">				} else if (&quot;OLA&quot;.equalsIgnoreCase(serviceType)) {</span>
<span class="nc" id="L421">					walletName = new String[walletNo.length];</span>
<span class="nc" id="L422">					result = helper.saveAdvMessageData(orgType, walletNo,</span>
							retName, message, userBean.getUserId(),
							msgLocation, activity3, srvcId);
<span class="nc bnc" id="L425" title="All 2 branches missed.">					for (int i = 0; i &lt; walletNo.length; i++) {</span>
<span class="nc" id="L426">						walletName[i] = OLAUtility.getWalletName(Integer</span>
								.parseInt(walletNo[i]));
					}
<span class="nc" id="L429">					setWalletName(walletName);</span>
<span class="nc bnc" id="L430" title="All 2 branches missed.">				} else if (&quot;SLE&quot;.equalsIgnoreCase(serviceType)) {</span>
<span class="nc" id="L431">					result = helper.saveAdvMessageData(orgType, sleGameNo,</span>
							retName, message, userBean.getUserId(),
							msgLocation, activity, srvcId);
<span class="nc" id="L434">					gameName = new String[sleGameNo.length];</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">					for (int i = 0; i &lt; sleGameNo.length; i++) {</span>
<span class="nc" id="L436">						gameName[i] = SLEUtil.gameTypeInfoMap.get(Integer.parseInt(sleGameNo[i])).getGameTypeDispName();</span>
					}
<span class="nc" id="L438">					setGameName(gameName);</span>

<span class="nc" id="L440">					SLEUtil.advMessageMap = CommonMethodsControllerImpl.getInstance().getSLEAdvMessageMap();</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">				} else if (&quot;IW&quot;.equalsIgnoreCase(serviceType)) {</span>
<span class="nc" id="L442">					result = helper.saveAdvMessageData(orgType, iwGameNo, retName, message, userBean.getUserId(), msgLocation, activity, srvcId);</span>
<span class="nc" id="L443">					gameName = new String[iwGameNo.length];</span>
<span class="nc bnc" id="L444" title="All 2 branches missed.">					for (int i = 0; i &lt; iwGameNo.length; i++) {</span>
<span class="nc" id="L445">						gameName[i] = IWUtil.gameInfoMap.get(Integer.parseInt(iwGameNo[i])).getGameDispName();</span>
					}
<span class="nc" id="L447">					setGameName(gameName);</span>

<span class="nc" id="L449">					IWUtil.advMessageMap = com.skilrock.lms.coreEngine.instantWin.common.controllerImpl.CommonMethodsControllerImpl.getInstance().getIWAdvMessageMap();</span>
				}
<span class="nc" id="L451">			} else {</span>
				// AdvMsgHelper helper = new AdvMsgHelper();
				// result = helper.saveAdvMessageDataForRetailer(orgType,
				// agtName, retName, message, userInfoBean.getUserId(), &quot;NA&quot;,
				// activity1);
<span class="nc bnc" id="L456" title="All 2 branches missed.">				if (&quot;TERMINAL&quot;.equals(interfaceType)) {</span>
<span class="nc" id="L457">					messageBean.setMessageSubject(messageBean.getMessageSubject()</span>
								.replaceAll(&quot;[\n\r]&quot;, &quot;&quot;)
								.replaceAll(&quot;~&quot;, &quot;&quot;)
								.replaceAll(&quot;%&quot;, &quot;&quot;)
								.replaceAll(&quot;|&quot;, &quot;&quot;)
								.replaceAll(&quot;_&quot;, &quot;&quot;)
								.replaceAll(&quot;,&quot;, &quot;&quot;)
								.replaceAll(&quot;#&quot;, &quot;&quot;)
								.replaceAll(&quot;( )+&quot;, &quot; &quot;).trim());
				}

<span class="nc" id="L468">				Timestamp expiryPeriod = null;</span>
<span class="nc bnc" id="L469" title="All 4 branches missed.">				if ((&quot;FLASH&quot;.equals(messageBean.getMessageType()) || &quot;RETAILER&quot;</span>
						.equals(orgType))) {
<span class="nc" id="L471">					SimpleDateFormat simpleDateFormat = new SimpleDateFormat(</span>
							&quot;yyyy-MM-dd HH:mm:ss&quot;);
<span class="nc" id="L473">					expiryPeriod = new Timestamp(simpleDateFormat.parse(</span>
							messageBean.getExpiryDate() + &quot; &quot;
									+ messageBean.getExpHr() + &quot;:&quot;
									+ messageBean.getExpMin() + &quot;:&quot;
									+ messageBean.getExpSec()).getTime());
				}
<span class="nc" id="L479">				messageBean.setExpiryPeriod(expiryPeriod);</span>
<span class="nc" id="L480">				messageBean.setMessageTypeId(mode);</span>
<span class="nc" id="L481">				messageBean.setMessageFor(orgType);</span>
<span class="nc" id="L482">				messageBean.setUserId(userBean.getUserId());</span>
<span class="nc" id="L483">				MessageInboxServiceImpl.getSingleInstance().addNewMessage(</span>
						messageBean, retName);

<span class="nc" id="L486">				result = &quot;SUCCESS_BAR&quot;;</span>
			}

			// if(!&quot;REGISTRATION&quot;.equals(messageBean.getMessageType())) {
<span class="nc bnc" id="L490" title="All 2 branches missed.">			if (!&quot;ALL&quot;.equals(messageBean.getUserSelection())) {</span>
<span class="nc bnc" id="L491" title="All 2 branches missed.">				if (!Arrays.asList(retName).contains(&quot;-1&quot;)) {</span>
<span class="nc bnc" id="L492" title="All 2 branches missed.">					for (int i = 0; i &lt; retName.length; i++) {</span>
<span class="nc" id="L493">						retName[i] = retName[i].split(&quot;~&quot;)[1];</span>
					}
				}
			}
<span class="nc" id="L497">		} catch (Exception ex) {</span>
<span class="nc" id="L498">			ex.printStackTrace();</span>
<span class="nc" id="L499">		}</span>

<span class="nc" id="L501">		return result;</span>
	}

	public String fetchWebMessages() throws Exception {
<span class="nc" id="L505">		UserInfoBean userBean = null;</span>
<span class="nc" id="L506">		List&lt;String&gt; statusList = null;</span>
<span class="nc" id="L507">		JsonArray statusArray = null;</span>
<span class="nc" id="L508">		JsonObject statusObject = null;</span>

<span class="nc" id="L510">		int noOfMessages = 0;</span>
<span class="nc" id="L511">		int messageCount = 0;</span>
<span class="nc" id="L512">		int index = 0;</span>
<span class="nc" id="L513">		JSONArray jsonArray = null;</span>
<span class="nc" id="L514">		JSONObject jsonObject = null;</span>
<span class="nc" id="L515">		JSONObject responseObject = new JSONObject();</span>
<span class="nc" id="L516">		PrintWriter out = null;</span>
		try {
<span class="nc" id="L518">			userBean = getUserBean();</span>
<span class="nc" id="L519">			statusArray = new JsonParser().parse(messages).getAsJsonArray();</span>
<span class="nc" id="L520">			statusList = new ArrayList&lt;String&gt;();</span>
<span class="nc bnc" id="L521" title="All 2 branches missed.">			for (int i = 0; i &lt; statusArray.size(); i++) {</span>
<span class="nc" id="L522">				statusObject = statusArray.get(i).getAsJsonObject();</span>
<span class="nc" id="L523">				statusList.add(&quot;'&quot; + statusObject.get(&quot;status&quot;).getAsString()</span>
						+ &quot;'&quot;);
			}

<span class="nc" id="L527">			messageList = MessageInboxServiceImpl.getSingleInstance()</span>
					.fetchWebMessages(userBean.getUserId(),
							userBean.getUserType(), statusList,
							messageBean.getMessageNumber());
<span class="nc" id="L531">			noOfMessages = MessageInboxServiceImpl.getSingleInstance()</span>
					.getTotalNoOfMessages(userBean.getUserId(),
							userBean.getUserType(), statusList);
<span class="nc" id="L534">			messageCount = MessageInboxServiceImpl.getSingleInstance()</span>
					.getMessageCount(&quot;INBOX&quot;, userBean.getUserType(), &quot;WEB&quot;);
			// messageList =
			// MessageInboxServiceImpl.getSingleInstance().fetchWebMessages(11067,
			// &quot;BO&quot;, statusList, messageBean.getMessageNumber());
			// noOfMessages =
			// MessageInboxServiceImpl.getSingleInstance().getTotalNoOfMessages(11067,
			// &quot;BO&quot;, statusList);
			// messageCount =
			// MessageInboxServiceImpl.getSingleInstance().getMessageCount(&quot;INBOX&quot;,
			// &quot;BO&quot;, &quot;WEB&quot;);

<span class="nc" id="L546">			jsonArray = new JSONArray();</span>
<span class="nc bnc" id="L547" title="All 2 branches missed.">			for (MessageInboxBean bean : messageList) {</span>
<span class="nc" id="L548">				jsonObject = new JSONObject();</span>
<span class="nc" id="L549">				jsonObject.put(&quot;messageId&quot;, bean.getMessageId());</span>
<span class="nc" id="L550">				jsonObject.put(&quot;creatorUserName&quot;, bean.getCreatorUserName());</span>
<span class="nc" id="L551">				String content = bean.getMessageSubject();</span>
<span class="nc bnc" id="L552" title="All 2 branches missed.">				if (content.length() &gt; 20) {</span>
<span class="nc" id="L553">					index = content.lastIndexOf(&quot; &quot;, 20);</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">					if (index == -1) {</span>
<span class="nc" id="L555">						index = 20;</span>
					}
<span class="nc" id="L557">					content = content.substring(0, index);</span>
				}
<span class="nc" id="L559">				jsonObject.put(&quot;messageSubject&quot;, content);</span>
<span class="nc" id="L560">				content = bean.getMessageContent();</span>
<span class="nc bnc" id="L561" title="All 2 branches missed.">				if (content.length() &gt; 30) {</span>
<span class="nc" id="L562">					index = content.lastIndexOf(&quot; &quot;, 30);</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">					if (index == -1) {</span>
<span class="nc" id="L564">						index = 30;</span>
					}
<span class="nc" id="L566">					content = content.substring(0, index);</span>
				}
<span class="nc" id="L568">				jsonObject.put(&quot;messageContent&quot;, content);</span>
<span class="nc" id="L569">				jsonObject.put(&quot;messageDate&quot;, bean.getMessageDate());</span>
<span class="nc" id="L570">				jsonObject.put(&quot;mandatoryStatus&quot;, bean.getMandatoryStatus());</span>
<span class="nc" id="L571">				jsonObject.put(&quot;status&quot;, bean.getStatus());</span>
<span class="nc" id="L572">				jsonArray.add(jsonObject);</span>
<span class="nc" id="L573">			}</span>

<span class="nc" id="L575">			jsonObject = new JSONObject();</span>
<span class="nc" id="L576">			jsonObject.put(&quot;noOfMessages&quot;, noOfMessages);</span>
<span class="nc" id="L577">			jsonObject.put(&quot;messageCount&quot;, messageCount);</span>
<span class="nc" id="L578">			jsonObject.put(&quot;messageList&quot;, jsonArray);</span>
<span class="nc" id="L579">			out = response.getWriter();</span>
<span class="nc" id="L580">			response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L581">			responseObject.put(&quot;isSuccess&quot;, true);</span>
<span class="nc" id="L582">			responseObject.put(&quot;responseData&quot;, jsonObject);</span>
<span class="nc" id="L583">		} catch (Exception ex) {</span>
<span class="nc" id="L584">			ex.printStackTrace();</span>
<span class="nc" id="L585">			responseObject.put(&quot;isSuccess&quot;, false);</span>
<span class="nc" id="L586">			responseObject.put(&quot;errorMsg&quot;, getText(&quot;msg.some.error&quot;));</span>
		} finally {
<span class="nc" id="L588">			out.print(responseObject);</span>
<span class="nc" id="L589">			out.flush();</span>
<span class="nc" id="L590">			out.close();</span>
<span class="nc" id="L591">		}</span>

<span class="nc" id="L593">		return SUCCESS;</span>
	}

	public String fetchWebMessageDetail() throws Exception {
<span class="nc" id="L597">		UserInfoBean userBean = null;</span>
<span class="nc" id="L598">		List&lt;Integer&gt; messageList = null;</span>
<span class="nc" id="L599">		JSONObject jsonObject = null;</span>
<span class="nc" id="L600">		JSONObject responseObject = new JSONObject();</span>
<span class="nc" id="L601">		PrintWriter out = null;</span>
		try {
<span class="nc" id="L603">			userBean = getUserBean();</span>
<span class="nc bnc" id="L604" title="All 2 branches missed.">			if (&quot;UNREAD&quot;.equals(messageBean.getStatus())) {</span>
<span class="nc" id="L605">				messageList = new ArrayList&lt;Integer&gt;();</span>
<span class="nc" id="L606">				messageList.add(messageBean.getMessageId());</span>
<span class="nc" id="L607">				MessageInboxServiceImpl.getSingleInstance()</span>
						.updateUserMessageStatus(messageList, &quot;READ&quot;);
			}
<span class="nc" id="L610">			messageBean = MessageInboxServiceImpl.getSingleInstance()</span>
					.fetchWebMessageDetail(messageBean.getMessageId(),
							userBean.getUserId());
			// messageBean =
			// MessageInboxServiceImpl.getSingleInstance().fetchWebMessageDetail(messageBean.getMessageId(),
			// 11067);

<span class="nc" id="L617">			jsonObject = new JSONObject();</span>
<span class="nc" id="L618">			jsonObject.put(&quot;messageId&quot;, messageBean.getMessageId());</span>
<span class="nc" id="L619">			jsonObject.put(&quot;messageSubject&quot;, messageBean.getMessageSubject());</span>
<span class="nc" id="L620">			jsonObject.put(&quot;messageContent&quot;, messageBean.getMessageContent());</span>
<span class="nc" id="L621">			jsonObject.put(&quot;messageDate&quot;, messageBean.getMessageDate());</span>
<span class="nc" id="L622">			jsonObject.put(&quot;mandatoryStatus&quot;, messageBean.getMandatoryStatus());</span>
<span class="nc" id="L623">			jsonObject.put(&quot;creatorUserName&quot;, messageBean.getCreatorUserName());</span>

<span class="nc" id="L625">			out = response.getWriter();</span>
<span class="nc" id="L626">			response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L627">			responseObject.put(&quot;isSuccess&quot;, true);</span>
<span class="nc" id="L628">			responseObject.put(&quot;responseData&quot;, jsonObject);</span>
<span class="nc" id="L629">		} catch (Exception ex) {</span>
<span class="nc" id="L630">			ex.printStackTrace();</span>
<span class="nc" id="L631">			responseObject.put(&quot;isSuccess&quot;, false);</span>
<span class="nc" id="L632">			responseObject.put(&quot;errorMsg&quot;, getText(&quot;msg.some.error&quot;));</span>
		} finally {
<span class="nc" id="L634">			out.print(responseObject);</span>
<span class="nc" id="L635">			out.flush();</span>
<span class="nc" id="L636">			out.close();</span>
<span class="nc" id="L637">		}</span>

<span class="nc" id="L639">		return SUCCESS;</span>
	}

	public String searchWebMessages() throws Exception {
<span class="nc" id="L643">		UserInfoBean userBean = null;</span>

<span class="nc" id="L645">		JSONArray jsonArray = null;</span>
<span class="nc" id="L646">		JSONObject jsonObject = null;</span>
<span class="nc" id="L647">		JSONObject responseObject = new JSONObject();</span>
<span class="nc" id="L648">		int index = 0;</span>
<span class="nc" id="L649">		PrintWriter out = null;</span>
		try {
<span class="nc" id="L651">			userBean = getUserBean();</span>
<span class="nc" id="L652">			messageList = MessageInboxServiceImpl.getSingleInstance()</span>
					.searchWebMessages(userBean.getUserId(),
							userBean.getUserType(), messages);
			// messageList =
			// MessageInboxServiceImpl.getSingleInstance().searchWebMessages(11067,
			// &quot;BO&quot;, messages);

<span class="nc" id="L659">			jsonArray = new JSONArray();</span>
<span class="nc bnc" id="L660" title="All 2 branches missed.">			for (MessageInboxBean bean : messageList) {</span>
<span class="nc" id="L661">				jsonObject = new JSONObject();</span>
<span class="nc" id="L662">				jsonObject.put(&quot;messageId&quot;, bean.getMessageId());</span>
<span class="nc" id="L663">				jsonObject.put(&quot;creatorUserName&quot;, bean.getCreatorUserName());</span>
<span class="nc" id="L664">				String content = bean.getMessageSubject();</span>
<span class="nc bnc" id="L665" title="All 2 branches missed.">				if (content.length() &gt; 20) {</span>
<span class="nc" id="L666">					index = content.lastIndexOf(&quot; &quot;, 20);</span>
<span class="nc bnc" id="L667" title="All 2 branches missed.">					if (index == -1) {</span>
<span class="nc" id="L668">						index = 20;</span>
					}
<span class="nc" id="L670">					content = content.substring(0, index);</span>
				}
<span class="nc" id="L672">				jsonObject.put(&quot;messageSubject&quot;, content);</span>
<span class="nc" id="L673">				content = bean.getMessageContent();</span>
<span class="nc bnc" id="L674" title="All 2 branches missed.">				if (content.length() &gt; 30) {</span>
<span class="nc" id="L675">					index = content.lastIndexOf(&quot; &quot;, 30);</span>
<span class="nc bnc" id="L676" title="All 2 branches missed.">					if (index == -1) {</span>
<span class="nc" id="L677">						index = 30;</span>
					}
<span class="nc" id="L679">					content = content.substring(0, index);</span>
				}
<span class="nc" id="L681">				jsonObject.put(&quot;messageContent&quot;, content);</span>
<span class="nc" id="L682">				jsonObject.put(&quot;messageDate&quot;, bean.getMessageDate());</span>
<span class="nc" id="L683">				jsonObject.put(&quot;mandatoryStatus&quot;, bean.getMandatoryStatus());</span>
<span class="nc" id="L684">				jsonObject.put(&quot;status&quot;, bean.getStatus());</span>
<span class="nc" id="L685">				jsonArray.add(jsonObject);</span>
<span class="nc" id="L686">			}</span>
<span class="nc" id="L687">			out = response.getWriter();</span>
<span class="nc" id="L688">			response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L689">			responseObject.put(&quot;isSuccess&quot;, true);</span>
<span class="nc" id="L690">			responseObject.put(&quot;responseData&quot;, jsonArray);</span>
<span class="nc" id="L691">		} catch (Exception ex) {</span>
<span class="nc" id="L692">			ex.printStackTrace();</span>
<span class="nc" id="L693">			responseObject.put(&quot;isSuccess&quot;, false);</span>
<span class="nc" id="L694">			responseObject.put(&quot;errorMsg&quot;, getText(&quot;msg.some.error&quot;));</span>
		} finally {
<span class="nc" id="L696">			out.print(responseObject);</span>
<span class="nc" id="L697">			out.flush();</span>
<span class="nc" id="L698">			out.close();</span>
<span class="nc" id="L699">		}</span>

<span class="nc" id="L701">		return SUCCESS;</span>
	}

	public String deleteWebMessage() throws Exception {
<span class="nc" id="L705">		List&lt;Integer&gt; messageList = null;</span>
<span class="nc" id="L706">		JSONObject responseObject = new JSONObject();</span>
<span class="nc" id="L707">		PrintWriter out = null;</span>
		try {
<span class="nc" id="L709">			messageList = new ArrayList&lt;Integer&gt;();</span>
<span class="nc" id="L710">			messageList.add(messageBean.getMessageId());</span>
<span class="nc" id="L711">			MessageInboxServiceImpl.getSingleInstance()</span>
					.updateUserMessageStatus(messageList, &quot;DELETE&quot;);
<span class="nc" id="L713">			out = response.getWriter();</span>
<span class="nc" id="L714">			response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L715">			responseObject.put(&quot;isSuccess&quot;, true);</span>
<span class="nc" id="L716">		} catch (Exception ex) {</span>
<span class="nc" id="L717">			ex.printStackTrace();</span>
<span class="nc" id="L718">			responseObject.put(&quot;isSuccess&quot;, false);</span>
<span class="nc" id="L719">			responseObject.put(&quot;errorMsg&quot;, getText(&quot;msg.some.error&quot;));</span>
		} finally {
<span class="nc" id="L721">			out.print(responseObject);</span>
<span class="nc" id="L722">			out.flush();</span>
<span class="nc" id="L723">			out.close();</span>
<span class="nc" id="L724">		}</span>
<span class="nc" id="L725">		return SUCCESS;</span>
	}

	public String changeMessageStatus() throws Exception {
<span class="nc" id="L729">		List&lt;Integer&gt; messageList = null;</span>
<span class="nc" id="L730">		JsonObject messageObject = null;</span>
<span class="nc" id="L731">		JSONObject responseObject = new JSONObject();</span>
<span class="nc" id="L732">		PrintWriter out = null;</span>
		try {
<span class="nc" id="L734">			System.out.println(messages + &quot;-&quot; + messageBean.getStatus());</span>
<span class="nc" id="L735">			JsonArray messageIdArray = new JsonParser().parse(messages)</span>
					.getAsJsonArray();
<span class="nc" id="L737">			messageList = new ArrayList&lt;Integer&gt;();</span>
<span class="nc bnc" id="L738" title="All 2 branches missed.">			for (int i = 0; i &lt; messageIdArray.size(); i++) {</span>
<span class="nc" id="L739">				messageObject = messageIdArray.get(i).getAsJsonObject();</span>
<span class="nc" id="L740">				messageList.add(messageObject.get(&quot;messageId&quot;).getAsInt());</span>
			}

<span class="nc" id="L743">			MessageInboxServiceImpl.getSingleInstance()</span>
					.updateUserMessageStatus(messageList,
							messageBean.getStatus());
<span class="nc" id="L746">			out = response.getWriter();</span>
<span class="nc" id="L747">			response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L748">			responseObject.put(&quot;isSuccess&quot;, true);</span>
<span class="nc" id="L749">		} catch (Exception ex) {</span>
<span class="nc" id="L750">			ex.printStackTrace();</span>
<span class="nc" id="L751">			responseObject.put(&quot;isSuccess&quot;, false);</span>
<span class="nc" id="L752">			responseObject.put(&quot;errorMsg&quot;, getText(&quot;msg.some.error&quot;));</span>
		} finally {
<span class="nc" id="L754">			out.print(responseObject);</span>
<span class="nc" id="L755">			out.flush();</span>
<span class="nc" id="L756">			out.close();</span>
<span class="nc" id="L757">		}</span>
<span class="nc" id="L758">		return SUCCESS;</span>
	}

	public String editNewMessageMenu() {
<span class="nc" id="L762">		HttpSession session = null;</span>
<span class="nc" id="L763">		AdvMsgHelper helper = null;</span>
		try {
<span class="nc" id="L765">			userTypeMap = new LinkedHashMap&lt;String, String&gt;();</span>

<span class="nc" id="L767">			List&lt;String&gt; userTypeList = MessageInboxServiceImpl.getSingleInstance().getActiveUserType();</span>
<span class="nc bnc" id="L768" title="All 2 branches missed.">			if(userTypeList.contains(&quot;BO&quot;))</span>
<span class="nc" id="L769">				userTypeMap.put(&quot;BO&quot;, getText(&quot;BOUser&quot;));</span>
<span class="nc bnc" id="L770" title="All 2 branches missed.">			if(userTypeList.contains(&quot;AGENT&quot;))</span>
<span class="nc" id="L771">				userTypeMap.put(&quot;AGENT&quot;, getText(&quot;AGENT&quot;));</span>
<span class="nc bnc" id="L772" title="All 2 branches missed.">			if(userTypeList.contains(&quot;RETAILER&quot;))</span>
<span class="nc" id="L773">				userTypeMap.put(&quot;RETAILER&quot;, getText(&quot;Retailer&quot;));</span>

<span class="nc" id="L775">			userTypeMap.put(&quot;PLAYER&quot;, getText(&quot;label.plr&quot;));</span>

<span class="nc" id="L777">			session = getSession();</span>
<span class="nc" id="L778">			helper = new AdvMsgHelper();</span>
<span class="nc" id="L779">			session.setAttribute(&quot;ADV_MSG_MAP&quot;, helper.getAdvMsgForEdit());</span>
<span class="nc" id="L780">		} catch (Exception ex) {</span>
<span class="nc" id="L781">			ex.printStackTrace();</span>
<span class="nc" id="L782">		}</span>
<span class="nc" id="L783">		return SUCCESS;</span>
	}

	public String getMessageListForEdit() throws Exception {
		try {
<span class="nc" id="L788">			messageList = MessageInboxServiceImpl.getSingleInstance()</span>
					.getMessageListForEdit(mode);
<span class="nc" id="L790">		} catch (Exception ex) {</span>
<span class="nc" id="L791">			ex.printStackTrace();</span>
<span class="nc" id="L792">		}</span>
<span class="nc" id="L793">		return SUCCESS;</span>
	}

	public String updateMessageStatus() throws Exception {
		try {
<span class="nc" id="L798">			MessageInboxServiceImpl.getSingleInstance().updateMessageStatus(</span>
					messageBean.getMessageId(), messageBean.getStatus());
<span class="nc" id="L800">		} catch (Exception ex) {</span>
<span class="nc" id="L801">			ex.printStackTrace();</span>
<span class="nc" id="L802">		}</span>
<span class="nc" id="L803">		return SUCCESS;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>