<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CommonFunctions.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.web.userMgmt.common</a> &gt; <span class="el_source">CommonFunctions.java</span></div><h1>CommonFunctions.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.web.userMgmt.common;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import javax.servlet.ServletContext;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.struts2.ServletActionContext;
import org.apache.struts2.interceptor.ServletRequestAware;
import org.apache.struts2.interceptor.ServletResponseAware;

import com.opensymphony.xwork2.ActionContext;
import com.opensymphony.xwork2.ActionSupport;
import com.skilrock.lms.ajax.AjaxRequestHelper;
import com.skilrock.lms.beans.OrgBean;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.filter.LMSFilterDispatcher;
import com.skilrock.lms.coreEngine.drawGames.playMgmt.DrawGameRPOSHelper;
import com.skilrock.lms.coreEngine.userMgmt.common.CommonFunctionsHelper;
import com.skilrock.lms.embedded.drawGames.common.EmbeddedErrors;
import com.skilrock.lms.web.drawGames.common.Util;

<span class="nc" id="L32">public class CommonFunctions extends ActionSupport implements</span>
		ServletRequestAware, ServletResponseAware {
	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	private String agentOrgId;
	private String country;
<span class="nc" id="L40">	Log logger = LogFactory.getLog(CommonFunctions.class);</span>
	private String orgType;
	private HttpServletRequest request;
	private HttpServletResponse response;

	private String state;

	private String userName;
	private String modelName;
	private String city;
	private String area;
	private long LSTktNo;

	public void fetchTerminalIds() throws Exception {
<span class="nc" id="L54">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L55">		UserInfoBean userInfoBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);

		try {
<span class="nc" id="L59">			PrintWriter out = getResponse().getWriter();</span>

<span class="nc" id="L61">			CommonFunctionsHelper comFunHelper = new CommonFunctionsHelper();</span>
<span class="nc" id="L62">			ArrayList&lt;String&gt; termIdList = null;</span>
<span class="nc bnc" id="L63" title="All 2 branches missed.">			if (agentOrgId == null) {</span>
<span class="nc" id="L64">				termIdList = comFunHelper.fetchTerminalIds(userInfoBean</span>
						.getUserOrgId());
			} else {
<span class="nc" id="L67">				termIdList = comFunHelper.fetchTerminalIds(Integer</span>
						.parseInt(agentOrgId));
			}
			/*
			 * String html =
			 * &quot; &lt;select class=\&quot;option\&quot; name=\&quot;terminalId\&quot; id ='termId'&gt;&lt;option value=-1&gt;--PleaseSelect--&lt;/option&gt;&quot;
			 * ; for (String name : termIdList) { html +=
			 * &quot;&lt;option class=\&quot;option\&quot; value=\&quot;&quot; + name + &quot;\&quot;&gt;&quot; + name +
			 * &quot;&lt;/option&gt;&quot;; } html += &quot;&lt;/select&gt;&quot;;
			 * response.setContentType(&quot;text/html&quot;);
			 */
<span class="nc" id="L78">			String html = termIdList.toString().replace(&quot;[&quot;, &quot;&quot;).replace(&quot;]&quot;,</span>
					&quot;&quot;).replace(&quot;, &quot;, &quot;:&quot;);
<span class="nc" id="L80">			System.out.println(&quot;Terminal Ids:&quot; + html);</span>
<span class="nc" id="L81">			out.print(html);</span>
<span class="nc" id="L82">		} catch (Exception e) {</span>
<span class="nc" id="L83">			e.printStackTrace();</span>
<span class="nc" id="L84">			throw new LMSException(e);</span>
<span class="nc" id="L85">		}</span>

<span class="nc" id="L87">	}</span>

	public void fetchTerminalModelNames() throws Exception {
<span class="nc" id="L90">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L91">		UserInfoBean userInfoBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
		try {
<span class="nc" id="L94">			ArrayList&lt;String&gt; modelNamesList = null;</span>
<span class="nc bnc" id="L95" title="All 4 branches missed.">			if (agentOrgId == null || &quot;null&quot;.equalsIgnoreCase(agentOrgId)) {</span>
<span class="nc" id="L96">				modelNamesList = new CommonFunctionsHelper()</span>
						.fetchTerminalModelNames(userInfoBean.getUserOrgId());
			} else {
<span class="nc" id="L99">				modelNamesList = new CommonFunctionsHelper()</span>
						.fetchTerminalModelNames(Integer.parseInt(agentOrgId));
			}
<span class="nc" id="L102">			String modelNamesStr = modelNamesList.toString().replace(&quot;[&quot;, &quot;&quot;)</span>
					.replace(&quot;]&quot;, &quot;&quot;).replace(&quot;, &quot;, &quot;:&quot;);
<span class="nc" id="L104">			System.out.println(&quot;Terminal Model Names List:&quot; + modelNamesStr);</span>
<span class="nc" id="L105">			getResponse().getWriter().print(modelNamesStr);</span>
<span class="nc" id="L106">		} catch (Exception e) {</span>
<span class="nc" id="L107">			e.printStackTrace();</span>
<span class="nc" id="L108">			throw new LMSException(e);</span>
<span class="nc" id="L109">		}</span>
<span class="nc" id="L110">	}</span>

	public void fetchInvModelNames() throws Exception {
<span class="nc" id="L113">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L114">		UserInfoBean userInfoBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
		try {
<span class="nc" id="L117">			ArrayList&lt;String&gt; modelNamesList = null;</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">			if (agentOrgId == null) {</span>
<span class="nc" id="L119">				modelNamesList = new CommonFunctionsHelper()</span>
						.fetchInvModelNames(userInfoBean.getUserOrgId());
			} else {
<span class="nc" id="L122">				modelNamesList = new CommonFunctionsHelper()</span>
						.fetchInvModelNames(Integer.parseInt(agentOrgId));
			}
<span class="nc" id="L125">			String modelNamesStr = modelNamesList.toString().replace(&quot;[&quot;, &quot;&quot;)</span>
					.replace(&quot;]&quot;, &quot;&quot;).replace(&quot;, &quot;, &quot;:&quot;);
<span class="nc" id="L127">			logger.debug(&quot;Inv Model Names List:&quot; + modelNamesStr);</span>
<span class="nc" id="L128">			getResponse().getWriter().print(modelNamesStr);</span>
<span class="nc" id="L129">		} catch (Exception e) {</span>
<span class="nc" id="L130">			e.printStackTrace();</span>
<span class="nc" id="L131">			throw new LMSException(e);</span>
<span class="nc" id="L132">		}</span>
<span class="nc" id="L133">	}</span>

	public void fetchTerminalSerialNos() throws Exception {
<span class="nc" id="L136">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L137">		UserInfoBean userInfoBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
		try {
<span class="nc" id="L140">			ArrayList&lt;String&gt; serialNoList = null;</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">			if (agentOrgId == null) {</span>
<span class="nc" id="L142">				serialNoList = new CommonFunctionsHelper()</span>
						.fetchTerminalSerialNos(userInfoBean.getUserOrgId(),
								modelName);
			} else {
<span class="nc" id="L146">				serialNoList = new CommonFunctionsHelper()</span>
						.fetchTerminalSerialNos(Integer.parseInt(agentOrgId),
								modelName);
			}
<span class="nc" id="L150">			String serialNoStr = serialNoList.toString().replace(&quot;[&quot;, &quot;&quot;)</span>
					.replace(&quot;]&quot;, &quot;&quot;).replace(&quot;, &quot;, &quot;:&quot;);
<span class="nc" id="L152">			System.out.println(&quot;Terminal Serial No List:&quot; + serialNoStr);</span>
<span class="nc" id="L153">			getResponse().getWriter().print(serialNoStr);</span>
<span class="nc" id="L154">		} catch (Exception e) {</span>
<span class="nc" id="L155">			e.printStackTrace();</span>
<span class="nc" id="L156">			throw new LMSException(e);</span>
<span class="nc" id="L157">		}</span>
<span class="nc" id="L158">	}</span>

	public String fetchUnClmablePwtDetail() throws LMSException {
<span class="nc" id="L161">		HttpSession session = request.getSession();</span>
<span class="nc" id="L162">		UserInfoBean userInfoBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L164">		logger.debug(&quot;fetchUnClmablePwtDetail = &quot;);</span>
<span class="nc" id="L165">		System.out.println(&quot;fetchUnClmablePwtDetail = &quot;);</span>
<span class="nc" id="L166">		CommonFunctionsHelper helper = new CommonFunctionsHelper();</span>
<span class="nc" id="L167">		Map map = helper.fetchUnCLMPwtDetailsOfOrg(userInfoBean.getUserOrgId(),</span>
				userInfoBean.getUserType(), &quot;UNCLAIM_BAL&quot;);

<span class="nc" id="L170">		session.setAttribute(&quot;totalUnclmBal&quot;, map.get(&quot;totalUnclmBal&quot;));</span>
<span class="nc" id="L171">		session.setAttribute(&quot;unclmPwtDet&quot;, map.get(&quot;unclmPwtDet&quot;));</span>
<span class="nc" id="L172">		session.setAttribute(&quot;newDRGameWiseTotAmt&quot;, map</span>
				.get(&quot;newDRGameWiseTotAmt&quot;));
<span class="nc" id="L174">		session.setAttribute(&quot;DRClmPwtDetailMap&quot;, map.get(&quot;DRClmPwtDetailMap&quot;));</span>

<span class="nc" id="L176">		return SUCCESS;</span>
	}

	public String getAgent() throws IOException {
<span class="nc" id="L180">		PrintWriter out = getResponse().getWriter();</span>
<span class="nc" id="L181">		List&lt;OrgBean&gt; characters = new CommonFunctionsHelper()</span>
				.getAgentOrgList();
<span class="nc" id="L183">		String html = &quot;&amp;nbsp;&amp;nbsp;&quot;;</span>
<span class="nc" id="L184">		html = &quot;&lt;select class=\&quot;option\&quot; name=\&quot;agentOrgId\&quot;  onchange = \&quot;getRetailerList('getRetailerList.action','retlist',this.value)\&quot;&gt;&lt;option value=''&gt;--PleaseSelect--&lt;/option&gt;&quot;;</span>

<span class="nc bnc" id="L186" title="All 2 branches missed.">		for (OrgBean orgBean : characters) {</span>
<span class="nc" id="L187">			html += &quot;&lt;option class=\&quot;option\&quot; value=\&quot;&quot; + orgBean.getOrgId()</span>
					+ &quot;\&quot;&gt;&quot; + orgBean.getOrgName() + &quot;&lt;/option&gt;&quot;;
<span class="nc" id="L189">		}</span>

<span class="nc" id="L191">		html += &quot;&lt;/select&gt;&quot;;</span>
<span class="nc" id="L192">		response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L193">		out.print(html);</span>
<span class="nc" id="L194">		return null;</span>
	}

	public String getAgentForEditPriv() throws IOException {
<span class="nc" id="L198">		PrintWriter out = getResponse().getWriter();</span>
<span class="nc" id="L199">		HttpSession session = request.getSession();</span>
<span class="nc" id="L200">		UserInfoBean uib = (UserInfoBean) session.getAttribute(&quot;USER_INFO&quot;);</span>
<span class="nc" id="L201">		int userOrgId = 0;</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">		if (uib != null) {</span>
<span class="nc" id="L203">			userOrgId = uib.getUserOrgId();</span>
		}

<span class="nc" id="L206">		String agtOrgList = &quot;&quot;;</span>
		try {
<span class="nc" id="L208">			agtOrgList = new AjaxRequestHelper().getOrgIdList(userOrgId,</span>
					&quot;AGENT&quot;);
<span class="nc" id="L210">		} catch (LMSException e) {</span>

<span class="nc" id="L212">			e.printStackTrace();</span>
<span class="nc" id="L213">		}</span>
		/*
		 * String html = &quot;&amp;nbsp;&amp;nbsp;&quot;; html =
		 * &quot;&lt;select class=\&quot;option\&quot; name=\&quot;agentOrgId\&quot;  onchange = \&quot;getRetailerList('bo_rep_searchReceipt_FetchRetailer.action','retlist',this.value)\&quot;&gt;&lt;option value=''&gt;--PleaseSelect--&lt;/option&gt;&quot;
		 * ;
		 * 
		 * for (OrgBean orgBean : characters) { html +=
		 * &quot;&lt;option class=\&quot;option\&quot; value=\&quot;&quot; + orgBean.getOrgId() + &quot;\&quot;&gt;&quot; +
		 * orgBean.getOrgName() + &quot;&lt;/option&gt;&quot;; }
		 * 
		 * html += &quot;&lt;/select&gt;&quot;;
		 */
<span class="nc" id="L225">		response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L226">		response.setCharacterEncoding(&quot;UTF-8&quot;);</span>
<span class="nc" id="L227">		out.print(agtOrgList);</span>
<span class="nc" id="L228">		return null;</span>

	}

	public String getAgentOrgId() {
<span class="nc" id="L233">		return agentOrgId;</span>
	}

	public String getAgentWithOrgIdNACA() throws IOException, LMSException {
<span class="nc" id="L237">		PrintWriter out = getResponse().getWriter();</span>
<span class="nc" id="L238">		String characters = new CommonFunctionsHelper().getAgentOrgWithIdNACA();</span>

<span class="nc" id="L240">		response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L241">		response.setCharacterEncoding(&quot;UTF-8&quot;);</span>
<span class="nc" id="L242">		out.print(characters);</span>
<span class="nc" id="L243">		return null;</span>
	}

	public void getCityNameList() throws LMSException {
		try {
<span class="nc" id="L248">			PrintWriter out = getResponse().getWriter();</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">			if (country == null) {</span>
<span class="nc" id="L250">				country = &quot;&quot;;</span>
			}

<span class="nc bnc" id="L253" title="All 2 branches missed.">			if (state == null) {</span>
<span class="nc" id="L254">				state = &quot;&quot;;</span>
			}

<span class="nc" id="L257">			CommonFunctionsHelper comFunHelper = new CommonFunctionsHelper();</span>
<span class="nc" id="L258">			System.out.println(&quot;*****&quot; + country + &quot;***&quot; + state + &quot;******&quot;);</span>
<span class="nc" id="L259">			ArrayList&lt;String&gt; cityNameList = comFunHelper.getCityNameList(</span>
					country.trim(), state.trim());

<span class="nc" id="L262">			String html = &quot; &lt;select class=\&quot;option\&quot; name=\&quot;city\&quot; id ='plrCity' onchange=\&quot;return fetchAreaList()\&quot;&gt;&lt;option value=-1&gt;--PleaseSelect--&lt;/option&gt;&quot;;</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">			for (String name : cityNameList) {</span>
<span class="nc" id="L264">				html += &quot;&lt;option class=\&quot;option\&quot; value=\&quot;&quot; + name + &quot;\&quot;&gt;&quot;</span>
						+ name + &quot;&lt;/option&gt;&quot;;
<span class="nc" id="L266">			}</span>
<span class="nc" id="L267">			html += &quot;&lt;/select&gt;&quot;;</span>
<span class="nc" id="L268">			response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L269">			response.setCharacterEncoding(&quot;UTF-8&quot;);</span>
<span class="nc" id="L270">			out.print(html);</span>
<span class="nc" id="L271">		} catch (Exception e) {</span>
<span class="nc" id="L272">			e.printStackTrace();</span>
<span class="nc" id="L273">			throw new LMSException(e);</span>
<span class="nc" id="L274">		}</span>
<span class="nc" id="L275">	}</span>

	public String getCountry() {
<span class="nc" id="L278">		return country;</span>
	}

	public String getOrgType() {
<span class="nc" id="L282">		return orgType;</span>
	}

	public HttpServletRequest getRequest() {
<span class="nc" id="L286">		return request;</span>
	}

	public HttpServletResponse getResponse() {
<span class="nc" id="L290">		return response;</span>
	}

	public String getRetailerList() throws IOException {
<span class="nc" id="L294">		PrintWriter out = getResponse().getWriter();</span>
<span class="nc" id="L295">		HttpSession session = request.getSession();</span>
<span class="nc" id="L296">		UserInfoBean infoBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc bnc" id="L298" title="All 2 branches missed.">		if (&quot;AGENT&quot;.equalsIgnoreCase(infoBean.getUserType().trim())) {</span>
<span class="nc" id="L299">			agentOrgId = Integer.toString(infoBean.getUserOrgId());</span>
		}
<span class="nc" id="L301">		List&lt;OrgBean&gt; characters = new CommonFunctionsHelper()</span>
				.getRetailerOrgList(agentOrgId);
<span class="nc" id="L303">		String html = &quot;&amp;nbsp;&amp;nbsp;&quot;;</span>
<span class="nc" id="L304">		html = &quot;&lt;select class=\&quot;option\&quot; name=\&quot;retOrgId\&quot; &gt;&lt;option value='-1'&gt;--PleaseSelect--&lt;/option&gt;&quot;;</span>
<span class="nc bnc" id="L305" title="All 2 branches missed.">		for (OrgBean orgBean : characters) {</span>
<span class="nc" id="L306">			html += &quot;&lt;option class=\&quot;option\&quot; value=\&quot;&quot; + orgBean.getOrgId()</span>
					+ &quot;\&quot;&gt;&quot; + orgBean.getOrgName() + &quot;&lt;/option&gt;&quot;;
<span class="nc" id="L308">		}</span>
<span class="nc" id="L309">		html += &quot;&lt;/select&gt;&quot;;</span>
<span class="nc" id="L310">		response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L311">		response.setCharacterEncoding(&quot;UTF-8&quot;);</span>
<span class="nc" id="L312">		out.print(html);</span>
<span class="nc" id="L313">		return null;</span>
	}

	public String getRetailerListForEditPriv() throws IOException {
<span class="nc" id="L317">		PrintWriter out = getResponse().getWriter();</span>
<span class="nc" id="L318">		HttpSession session = request.getSession();</span>
<span class="nc" id="L319">		UserInfoBean infoBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc bnc" id="L321" title="All 2 branches missed.">		if (&quot;AGENT&quot;.equalsIgnoreCase(infoBean.getUserType().trim())) {</span>
<span class="nc" id="L322">			agentOrgId = Integer.toString(infoBean.getUserOrgId());</span>
		}
<span class="nc" id="L324">		String retList = new AjaxRequestHelper().getUserIdList(Integer</span>
				.parseInt(agentOrgId));
		/*
		 * List&lt;OrgBean&gt; characters = new CommonFunctionsHelper()
		 * .getRetailerOrgList(agentOrgId); String html = &quot;&amp;nbsp;&amp;nbsp;&quot;; html =
		 * &quot;&lt;select class=\&quot;option\&quot; name=\&quot;retOrgId\&quot; onchange = \&quot;getOrgPriveledges(this.value)\&quot; &gt;&lt;option value='-1'&gt;--PleaseSelect--&lt;/option&gt;&quot;
		 * ; for (OrgBean orgBean : characters) { html +=
		 * &quot;&lt;option class=\&quot;option\&quot; value=\&quot;&quot; + orgBean.getOrgId() + &quot;\&quot;&gt;&quot; +
		 * orgBean.getOrgName() + &quot;&lt;/option&gt;&quot;; } html += &quot;&lt;/select&gt;&quot;;
		 */
<span class="nc" id="L334">		response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L335">		response.setCharacterEncoding(&quot;UTF-8&quot;);</span>
<span class="nc" id="L336">		out.print(retList);</span>
<span class="nc" id="L337">		return null;</span>
	}

	public String getRetailerWithOrgIdNACA() throws IOException, LMSException {
<span class="nc" id="L341">		PrintWriter out = getResponse().getWriter();</span>
<span class="nc" id="L342">		HttpSession session = request.getSession();</span>
<span class="nc" id="L343">		UserInfoBean infoBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L345">		String characters = new CommonFunctionsHelper()</span>
				.getRetailerOrgWithIdNACA(infoBean.getUserOrgId());

<span class="nc" id="L348">		response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L349">		response.setCharacterEncoding(&quot;UTF-8&quot;);</span>
<span class="nc" id="L350">		out.print(characters);</span>
<span class="nc" id="L351">		return null;</span>
	}

	public String getState() {
<span class="nc" id="L355">		return state;</span>
	}

	public void getStateNameList() throws LMSException {
		try {
<span class="nc" id="L360">			PrintWriter out = getResponse().getWriter();</span>
<span class="nc bnc" id="L361" title="All 2 branches missed.">			if (country == null) {</span>
<span class="nc" id="L362">				country = &quot;&quot;;</span>
			}

<span class="nc" id="L365">			CommonFunctionsHelper comFunHelper = new CommonFunctionsHelper();</span>
<span class="nc" id="L366">			ArrayList&lt;String&gt; stateNameList = comFunHelper</span>
					.getStateNameList(country.trim());

<span class="nc" id="L369">			String html = &quot; &lt;select class=\&quot;option\&quot; name=\&quot;state\&quot; id ='plrState' onchange=\&quot;return fetchCityList()\&quot;&gt;&lt;option value=-1&gt;--PleaseSelect--&lt;/option&gt;&quot;;</span>
<span class="nc bnc" id="L370" title="All 2 branches missed.">			for (String name : stateNameList) {</span>
<span class="nc" id="L371">				html += &quot;&lt;option class=\&quot;option\&quot; value=\&quot;&quot; + name + &quot;\&quot;&gt;&quot;</span>
						+ name + &quot;&lt;/option&gt;&quot;;
<span class="nc" id="L373">			}</span>
<span class="nc" id="L374">			html += &quot;&lt;/select&gt;&quot;;</span>
<span class="nc" id="L375">			response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L376">			response.setCharacterEncoding(&quot;UTF-8&quot;);</span>
<span class="nc" id="L377">			out.print(html);</span>
<span class="nc" id="L378">		} catch (Exception e) {</span>
<span class="nc" id="L379">			e.printStackTrace();</span>
<span class="nc" id="L380">			throw new LMSException(e);</span>
<span class="nc" id="L381">		}</span>
<span class="nc" id="L382">	}</span>

	public void getCountryPhnCodeList() throws LMSException {

		try {
<span class="nc" id="L387">			PrintWriter out = getResponse().getWriter();</span>
<span class="nc bnc" id="L388" title="All 2 branches missed.">			if (country == null) {</span>
<span class="nc" id="L389">				country = &quot;&quot;;</span>
			}

<span class="nc" id="L392">			CommonFunctionsHelper comFunHelper = new CommonFunctionsHelper();</span>

<span class="nc" id="L394">			String phoneCode = comFunHelper.getCountryPhnCode(country.trim());</span>
<span class="nc" id="L395">			response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L396">			response.setCharacterEncoding(&quot;UTF-8&quot;);</span>
<span class="nc" id="L397">			out.print(phoneCode);</span>

<span class="nc" id="L399">		} catch (IOException e) {</span>
<span class="nc" id="L400">			e.printStackTrace();</span>
<span class="nc" id="L401">			throw new LMSException();</span>
<span class="nc" id="L402">		}</span>
<span class="nc" id="L403">	}</span>

	public void getCityCode() throws LMSException {
<span class="nc" id="L406">		String code = null;</span>
		try {
<span class="nc" id="L408">			PrintWriter out = getResponse().getWriter();</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">			if (city == null) {</span>
<span class="nc" id="L410">				city = &quot;&quot;;</span>
			}

<span class="nc" id="L413">			CommonFunctionsHelper comFunHelper = new CommonFunctionsHelper();</span>
<span class="nc" id="L414">			code = comFunHelper.getCityCode(city.trim());</span>

<span class="nc" id="L416">			response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L417">			response.setCharacterEncoding(&quot;UTF-8&quot;);</span>
<span class="nc" id="L418">			out.print(code);</span>
<span class="nc" id="L419">		} catch (IOException e) {</span>
<span class="nc" id="L420">			e.printStackTrace();</span>
<span class="nc" id="L421">			throw new LMSException();</span>
<span class="nc" id="L422">		}</span>
<span class="nc" id="L423">	}</span>

	public String getCity() {
<span class="nc" id="L426">		return city;</span>
	}

	public void setCity(String city) {
<span class="nc" id="L430">		this.city = city;</span>
<span class="nc" id="L431">	}</span>

	public String getUserName() {
<span class="nc" id="L434">		return userName;</span>
	}

	public void setAgentOrgId(String agentOrgId) {
<span class="nc" id="L438">		this.agentOrgId = agentOrgId;</span>
<span class="nc" id="L439">	}</span>

	public void setCountry(String country) {
<span class="nc" id="L442">		this.country = country;</span>
<span class="nc" id="L443">	}</span>

	public void setOrgType(String orgType) {
<span class="nc" id="L446">		this.orgType = orgType;</span>
<span class="nc" id="L447">	}</span>

	public void setServletRequest(HttpServletRequest request) {
<span class="nc" id="L450">		this.request = request;</span>
<span class="nc" id="L451">	}</span>

	public void setServletResponse(HttpServletResponse response) {
<span class="nc" id="L454">		this.response = response;</span>
<span class="nc" id="L455">	}</span>

	public void setState(String state) {
<span class="nc" id="L458">		this.state = state;</span>
<span class="nc" id="L459">	}</span>

	public void setUserName(String userName) {
<span class="nc" id="L462">		this.userName = userName;</span>
<span class="nc" id="L463">	}</span>

	public void updateClmableBalOfOrg() {
<span class="nc" id="L466">		PrintWriter out = null;</span>
		try {
<span class="nc" id="L468">			out = response.getWriter();</span>
<span class="nc" id="L469">			HttpSession session = request.getSession();</span>
<span class="nc" id="L470">			UserInfoBean userInfoBean = (UserInfoBean) session</span>
					.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L472">			String rootPath = (String) session.getAttribute(&quot;ROOT_PATH&quot;);</span>
<span class="nc" id="L473">			String ledgerStatus = null;</span>
<span class="nc" id="L474">			String amtStr = null;</span>
<span class="nc bnc" id="L475" title="All 2 branches missed.">			if (&quot;YES&quot;.equalsIgnoreCase(LMSFilterDispatcher.claimByClick)) {</span>

<span class="nc" id="L477">				CommonFunctionsHelper helper = new CommonFunctionsHelper();</span>
<span class="nc" id="L478">				ledgerStatus = helper.updateClmableBalOfOrg(userInfoBean</span>
						.getUserId(), userInfoBean.getUserOrgId(), userInfoBean
						.getUserType(), userInfoBean.getParentOrgId());
<span class="nc" id="L481">				logger.debug(&quot; Ledger Status = &quot; + ledgerStatus</span>
						+ &quot; for Organization = &quot; + userInfoBean.getUserOrgId());
<span class="nc" id="L483">				System.out.println(&quot; Ledger Status = &quot; + ledgerStatus</span>
						+ &quot; for Organization = &quot; + userInfoBean.getUserOrgId());
			}
<span class="nc bnc" id="L486" title="All 2 branches missed.">			if (!&quot;AlreadyUpdated&quot;.equalsIgnoreCase(ledgerStatus)) {</span>
<span class="nc" id="L487">				AjaxRequestHelper ajxHelper = new AjaxRequestHelper();</span>
<span class="nc" id="L488">				amtStr = ajxHelper.getAvlblCreditAmt(userInfoBean);</span>
<span class="nc" id="L489">			} else {</span>
<span class="nc" id="L490">				amtStr = &quot;AlreadyUpdated&quot;;</span>
			}
<span class="nc" id="L492">			out.print(amtStr);</span>

<span class="nc" id="L494">		} catch (Exception e) {</span>
<span class="nc" id="L495">			e.printStackTrace();</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">			if (out != null) {</span>
<span class="nc" id="L497">				out.print(&quot;&quot;);</span>
			}
<span class="nc" id="L499">		}</span>

<span class="nc" id="L501">	}</span>

	public void updateClmableBalOfOrgEmbd() {
<span class="nc" id="L504">		String amtStr = null;</span>
		try {

<span class="nc" id="L507">			ServletContext sc = ServletActionContext.getServletContext();</span>
<span class="nc" id="L508">			Map currentUserSessionMap = (Map) sc</span>
					.getAttribute(&quot;LOGGED_IN_USERS&quot;);
<span class="nc bnc" id="L510" title="All 2 branches missed.">			if (currentUserSessionMap == null) {</span>
<span class="nc" id="L511">				response</span>
						.getOutputStream()
						.write(
								(&quot;ErrorMsg:&quot; + EmbeddedErrors.SESSION_EXPIRED + &quot;ErrorCode:01|&quot;)
										.getBytes());
<span class="nc" id="L516">				return;</span>
			}
			/*
			 * logger.debug(&quot; LOGGED_IN_USERS maps is &quot; +
			 * currentUserSessionMap); System.out.println(&quot; LOGGED_IN_USERS maps
			 * is &quot; + currentUserSessionMap);
			 */
<span class="nc" id="L523">			logger.debug(&quot; user name is &quot; + userName);</span>
<span class="nc" id="L524">			System.out.println(&quot; user name is &quot; + userName);</span>

<span class="nc" id="L526">			HttpSession session = (HttpSession) currentUserSessionMap</span>
					.get(userName);
<span class="nc bnc" id="L528" title="All 2 branches missed.">			if (!CommonFunctionsHelper.isSessionValid(session)) {</span>
<span class="nc" id="L529">				response</span>
						.getOutputStream()
						.write(
								(&quot;ErrorMsg:&quot; + EmbeddedErrors.SESSION_EXPIRED + &quot;ErrorCode:01|&quot;)
										.getBytes());
<span class="nc" id="L534">				return;</span>
			}
<span class="nc" id="L536">			Map virnMap = null;</span>
			// HttpSession session = request.getSession();
<span class="nc" id="L538">			UserInfoBean userInfoBean = (UserInfoBean) session</span>
					.getAttribute(&quot;USER_INFO&quot;);

<span class="nc" id="L541">			String refMerchantId = (String) sc.getAttribute(&quot;REF_MERCHANT_ID&quot;);</span>
<span class="nc" id="L542">			int autoCancelHoldDays = Integer.parseInt((String) sc</span>
					.getAttribute(&quot;AUTO_CANCEL_CLOSER_DAYS&quot;));
<span class="nc" id="L544">			long lastPrintedTicket = 0;</span>
<span class="nc" id="L545">			int gameId = 0;</span>
<span class="nc bnc" id="L546" title="All 2 branches missed.">			if (LSTktNo != 0) {</span>
<span class="nc" id="L547">				lastPrintedTicket = LSTktNo</span>
						/ Util.getDivValueForLastSoldTkt(String
								.valueOf(LSTktNo).length());
				;
<span class="nc" id="L551">				gameId = Util.getGameIdFromGameNumber(Util</span>
						.getGamenoFromTktnumber(String.valueOf(LSTktNo)));
			}

<span class="nc" id="L555">			String actionName = ActionContext.getContext().getName();</span>
<span class="nc" id="L556">			DrawGameRPOSHelper drawGameRPOSHelper = new DrawGameRPOSHelper();</span>
<span class="nc" id="L557">			drawGameRPOSHelper.checkLastPrintedTicketStatusAndUpdate(</span>
					userInfoBean, lastPrintedTicket, &quot;TERMINAL&quot;, refMerchantId,
					autoCancelHoldDays, actionName, gameId);

<span class="nc" id="L561">			String rootPath = (String) session.getAttribute(&quot;ROOT_PATH&quot;);</span>
<span class="nc" id="L562">			String ledgerStatus = null;</span>

<span class="nc bnc" id="L564" title="All 2 branches missed.">			if (&quot;YES&quot;.equalsIgnoreCase(LMSFilterDispatcher.claimByClick)) {</span>

<span class="nc" id="L566">				CommonFunctionsHelper helper = new CommonFunctionsHelper();</span>
<span class="nc" id="L567">				ledgerStatus = helper.updateClmableBalOfOrg(userInfoBean</span>
						.getUserId(), userInfoBean.getUserOrgId(), userInfoBean
						.getUserType(), userInfoBean.getParentOrgId());
<span class="nc" id="L570">				logger.debug(&quot; Ledger Status = &quot; + ledgerStatus</span>
						+ &quot; for Organization = &quot; + userInfoBean.getUserOrgId());
<span class="nc" id="L572">				System.out.println(&quot; Ledger Status = &quot; + ledgerStatus</span>
						+ &quot; for Organization = &quot; + userInfoBean.getUserOrgId());
			}
<span class="nc bnc" id="L575" title="All 2 branches missed.">			if (!&quot;AlreadyUpdated&quot;.equalsIgnoreCase(ledgerStatus)) {</span>
<span class="nc" id="L576">				AjaxRequestHelper ajxHelper = new AjaxRequestHelper();</span>
<span class="nc" id="L577">				amtStr = ajxHelper.getAvlblCreditAmt(userInfoBean);</span>
<span class="nc" id="L578">			} else {</span>
<span class="nc" id="L579">				amtStr = &quot;AlreadyUpdated&quot;;</span>
			}

<span class="nc" id="L582">		} catch (Exception e) {</span>
<span class="nc" id="L583">			e.printStackTrace();</span>
<span class="nc" id="L584">		}</span>

		try {
			// ------first data is actual balance..(AC-CB)-----
<span class="nc bnc" id="L588" title="All 2 branches missed.">			if (&quot;AlreadyUpdated&quot;.equalsIgnoreCase(amtStr)) {</span>
<span class="nc" id="L589">				response.getOutputStream().write(amtStr.getBytes());</span>
			} else {
				// String[] bal=amtStr.split(&quot;=&quot;);

<span class="nc" id="L593">				response.getOutputStream().write(</span>
						&quot;Ledger Updated Successfully&quot;.getBytes());
				// response.getOutputStream().write((FormatNumber.formatNumber(bal[0])+&quot;,&quot;+FormatNumber.formatNumber(bal[1])+&quot;,&quot;+FormatNumber.formatNumber(bal[2])+&quot;,&quot;+FormatNumber.formatNumber(bal[3])).getBytes());
			}
			/*
			 * response.getOutputStream() .write( (FormatNumber.formatNumber(&quot;&quot;)
			 * + &quot;,&quot; + FormatNumber.formatNumber(&quot;&quot;) + &quot;,&quot; + FormatNumber
			 * .formatNumber
			 * (&quot;&quot;)+&quot;,&quot;+FormatNumber.formatNumber(&quot;&quot;)+&quot;,&quot;+FormatNumber
			 * .formatNumber(&quot;&quot;)).getBytes());
			 * 
			 * System.out.println(&quot; send data is &quot; +
			 * FormatNumber.formatNumber(availableCredit) + &quot;,&quot; +
			 * FormatNumber.formatNumber(clmBal) + &quot;,&quot; +
			 * FormatNumber.formatNumber(unClmBal)+&quot;,&quot;
			 * +FormatNumber.formatNumber(extendedCreditLimit)+&quot;,&quot;
			 * +FormatNumber.formatNumber(currentCreditAmount));
			 */
<span class="nc" id="L611">		} catch (IOException e) {</span>
<span class="nc" id="L612">			e.printStackTrace();</span>
<span class="nc" id="L613">		}</span>

<span class="nc" id="L615">	}</span>

	public void logoutAnyUserForcefully(int userOrgId) {
<span class="nc" id="L618">		ServletContext sc = ServletActionContext.getServletContext();</span>
<span class="nc" id="L619">		Map currentUserSessionMap = (Map) sc.getAttribute(&quot;LOGGED_IN_USERS&quot;);</span>
<span class="nc" id="L620">		HttpSession session = null;</span>
<span class="nc" id="L621">		List&lt;String&gt; userNameList = CommonFunctionsHelper</span>
				.chkStatusAndFetchUsers(userOrgId);
<span class="nc" id="L623">		String userName = null;</span>
<span class="nc bnc" id="L624" title="All 2 branches missed.">		for (int i = 0; i &lt; userNameList.size(); i++) {</span>
<span class="nc" id="L625">			userName = userNameList.get(i);</span>
<span class="nc" id="L626">			session = (HttpSession) currentUserSessionMap.get(userName);</span>
<span class="nc bnc" id="L627" title="All 2 branches missed.">			if (session != null) {</span>
<span class="nc" id="L628">				currentUserSessionMap.remove(userName);</span>
<span class="nc" id="L629">				session.removeAttribute(&quot;USER_INFO&quot;);</span>
<span class="nc" id="L630">				session.removeAttribute(&quot;ACTION_LIST&quot;);</span>
<span class="nc" id="L631">				session.removeAttribute(&quot;PRIV_MAP&quot;);</span>
<span class="nc" id="L632">				session.invalidate();</span>
<span class="nc" id="L633">				session = null;</span>
			}
		}
<span class="nc" id="L636">	}</span>

	public void getStateListWithCode() throws LMSException {
		try {
<span class="nc" id="L640">			logger</span>
					.info(&quot;Get State  List With State Code for country&quot;
							+ country);
<span class="nc" id="L643">			PrintWriter out = getResponse().getWriter();</span>
<span class="nc bnc" id="L644" title="All 2 branches missed.">			if (country == null) {</span>
<span class="nc" id="L645">				country = &quot;&quot;;</span>
			}
<span class="nc" id="L647">			String stateListWithCode = CommonFunctionsHelper</span>
					.getStateListWithCode(country);
<span class="nc" id="L649">			response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L650">			out.print(stateListWithCode);</span>
<span class="nc" id="L651">			logger.info(&quot;Get State  List :&quot; + stateListWithCode);</span>
<span class="nc" id="L652">		} catch (Exception e) {</span>
<span class="nc" id="L653">			e.printStackTrace();</span>
<span class="nc" id="L654">			throw new LMSException(e);</span>
<span class="nc" id="L655">		}</span>
<span class="nc" id="L656">	}</span>

	public void getCityListWithCode() throws LMSException {
		try {
<span class="nc" id="L660">			logger.info(&quot;Get City  List With City Code For Country&quot; + country</span>
					+ &quot;state&quot; + state);
<span class="nc" id="L662">			PrintWriter out = getResponse().getWriter();</span>
<span class="nc bnc" id="L663" title="All 4 branches missed.">			if (country == null || state == null) {</span>
<span class="nc" id="L664">				country = &quot;&quot;;</span>
<span class="nc" id="L665">				state = &quot;&quot;;</span>
			}
<span class="nc" id="L667">			String cityListWithCode = CommonFunctionsHelper</span>
					.getCityListWithCode(country, state);
<span class="nc" id="L669">			response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L670">			out.print(cityListWithCode);</span>
<span class="nc" id="L671">			logger.info(&quot;City List:&quot; + cityListWithCode);</span>
<span class="nc" id="L672">		} catch (Exception e) {</span>
<span class="nc" id="L673">			e.printStackTrace();</span>
<span class="nc" id="L674">			throw new LMSException(e);</span>
<span class="nc" id="L675">		}</span>
<span class="nc" id="L676">	}</span>

	public void getAreaListWithCode() throws LMSException {
		try {
<span class="nc" id="L680">			logger.info(&quot;Get Area  List With Area Code For Country&quot; + country</span>
					+ &quot;state&quot; + state + &quot;city&quot; + city);
<span class="nc" id="L682">			PrintWriter out = getResponse().getWriter();</span>
<span class="nc bnc" id="L683" title="All 6 branches missed.">			if (country == null || state == null || city == null) {</span>
<span class="nc" id="L684">				country = &quot;&quot;;</span>
<span class="nc" id="L685">				state = &quot;&quot;;</span>
<span class="nc" id="L686">				city = &quot;&quot;;</span>
			}
<span class="nc" id="L688">			String areaListWithCode = CommonFunctionsHelper</span>
					.getAreaListWithCode(country, state, city);
<span class="nc" id="L690">			response.setContentType(&quot;text/html&quot;);</span>
			
<span class="nc" id="L692">			out.print(areaListWithCode);</span>
<span class="nc" id="L693">			logger.info(&quot;City List:&quot; + areaListWithCode);</span>
<span class="nc" id="L694">		} catch (Exception e) {</span>
<span class="nc" id="L695">			e.printStackTrace();</span>
<span class="nc" id="L696">			throw new LMSException(e);</span>
<span class="nc" id="L697">		}</span>
<span class="nc" id="L698">	}</span>

	public void getDivisionListWithCode() throws LMSException {
		try {
<span class="nc" id="L702">			logger.info(&quot;Get Area  List With Area Code For Country&quot; + country</span>
					+ &quot;state&quot; + state + &quot;city&quot; + city + &quot;area&quot; + area);

<span class="nc" id="L705">			PrintWriter out = getResponse().getWriter();</span>
<span class="nc bnc" id="L706" title="All 8 branches missed.">			if (country == null || state == null || city == null</span>
					|| area == null) {
<span class="nc" id="L708">				country = &quot;&quot;;</span>
<span class="nc" id="L709">				state = &quot;&quot;;</span>
<span class="nc" id="L710">				city = &quot;&quot;;</span>
<span class="nc" id="L711">				area = &quot;&quot;;</span>
			}
<span class="nc" id="L713">			String divisionListWithCode = CommonFunctionsHelper</span>
					.getDivisionListWithCode(country, state, city, area);
<span class="nc" id="L715">			response.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L716">			out.print(divisionListWithCode);</span>
<span class="nc" id="L717">			logger.info(&quot;City List:&quot; + divisionListWithCode);</span>
<span class="nc" id="L718">		} catch (Exception e) {</span>
<span class="nc" id="L719">			e.printStackTrace();</span>
<span class="nc" id="L720">			throw new LMSException(e);</span>
<span class="nc" id="L721">		}</span>
<span class="nc" id="L722">	}</span>

	public String getModelName() {
<span class="nc" id="L725">		return modelName;</span>
	}

	public void setModelName(String modelName) {
<span class="nc" id="L729">		this.modelName = modelName;</span>
<span class="nc" id="L730">	}</span>

	public long getLSTktNo() {
<span class="nc" id="L733">		return LSTktNo;</span>
	}

	public void setLSTktNo(long lSTktNo) {
<span class="nc" id="L737">		LSTktNo = lSTktNo;</span>
<span class="nc" id="L738">	}</span>

	public String getArea() {
<span class="nc" id="L741">		return area;</span>
	}

	public void setArea(String area) {
<span class="nc" id="L745">		this.area = area;</span>
<span class="nc" id="L746">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>