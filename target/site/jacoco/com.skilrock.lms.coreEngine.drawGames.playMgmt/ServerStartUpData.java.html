<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ServerStartUpData.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.drawGames.playMgmt</a> &gt; <span class="el_source">ServerStartUpData.java</span></div><h1>ServerStartUpData.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.drawGames.playMgmt;

import java.lang.reflect.Type;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.TreeMap;
import java.util.concurrent.ConcurrentHashMap;

import javax.servlet.ServletContext;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.google.gson.Gson;
import com.google.gson.JsonArray;
import com.google.gson.reflect.TypeToken;
import com.skilrock.lms.beans.MessageDetailsBean;
import com.skilrock.lms.beans.OrgDataBean;
import com.skilrock.lms.beans.PromoGameBean;
import com.skilrock.lms.beans.ServiceRequest;
import com.skilrock.lms.beans.ServiceResponse;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.coreEngine.drawGames.common.CommonFunctionsHelper;
import com.skilrock.lms.coreEngine.instantWin.common.IWUtil;
import com.skilrock.lms.coreEngine.service.IServiceDelegate;
import com.skilrock.lms.coreEngine.service.ServiceDelegate;
import com.skilrock.lms.coreEngine.service.dge.ServiceMethodName;
import com.skilrock.lms.coreEngine.service.dge.ServiceName;
import com.skilrock.lms.coreEngine.sportsLottery.common.SLEUtil;
import com.skilrock.lms.coreEngine.sportsLottery.common.controllerImpl.CommonMethodsControllerImpl;
import com.skilrock.lms.coreEngine.virtualSport.common.VSUtil;
import com.skilrock.lms.dge.beans.DrawDetailsBean;
import com.skilrock.lms.dge.beans.GameMasterLMSBean;
import com.skilrock.lms.web.drawGames.common.Util;


<span class="nc" id="L45">public class ServerStartUpData {</span>
<span class="nc" id="L46">	static Log logger = LogFactory.getLog(ServerStartUpData.class);</span>
	public static void onStartGameData(ServletContext servletContext) {
<span class="nc" id="L48">		logger.debug(&quot;---- ENTERING INTO onStartGameData ----&quot;);</span>
<span class="nc" id="L49">		ServiceResponse sRes = new ServiceResponse();</span>
<span class="nc" id="L50">		ServiceRequest sReq = new ServiceRequest();</span>
<span class="nc" id="L51">		sReq.setServiceName(ServiceName.DATA_MGMT);</span>
<span class="nc" id="L52">		sReq.setServiceMethod(ServiceMethodName.ON_START_GAME_DATA);</span>
	
<span class="nc" id="L54">		IServiceDelegate delegate = ServiceDelegate.getInstance();</span>
		
<span class="nc" id="L56">		sRes = delegate.getResponse(sReq);</span>
		
<span class="nc" id="L58">		String responseString=sRes.getResponseData().toString();</span>
		//Type elementType = new TypeToken&lt;Map&lt;Integer, GameMasterLMSBean&gt;&gt;() {}.getType();
<span class="nc" id="L60">		Type elementType = new TypeToken&lt;Map&lt;Integer, GameMasterLMSBean&gt;&gt;() {}.getType();</span>
		
		
<span class="nc" id="L63">		Map&lt;Integer, GameMasterLMSBean&gt; lmsMap = null;</span>
<span class="nc" id="L64">		Map&lt;Integer, GameMasterLMSBean&gt; dgMap = null;</span>
		
<span class="nc" id="L66">		Connection con = DBConnect.getConnection();</span>
	
	
<span class="nc bnc" id="L69" title="All 2 branches missed.">		if (sRes.getIsSuccess()) {</span>
			try {
<span class="nc" id="L71">				lmsMap = new HashMap&lt;Integer, GameMasterLMSBean&gt;();</span>
<span class="nc" id="L72">				dgMap=new Gson().fromJson(responseString, elementType);</span>
				
<span class="nc" id="L74">				String query2 = &quot;select game_id,game_name_dev,agent_sale_comm_rate,agent_pwt_comm_rate,retailer_sale_comm_rate,retailer_pwt_comm_rate,vat_amt,govt_comm,govt_comm_pwt,high_prize_amt,prize_payout_ratio,game_status,bonus_ball_enable from st_dg_game_master order by display_order&quot;;</span>
	
<span class="nc" id="L76">				PreparedStatement pstmt2 = con.prepareStatement(query2);</span>
<span class="nc" id="L77">				ResultSet rs2 = pstmt2.executeQuery();</span>
<span class="nc" id="L78">				int gameId = 0;</span>
<span class="nc" id="L79">		    	GameMasterLMSBean gameMasterLMSBean = null;</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">				while (rs2.next()) {</span>
<span class="nc" id="L81">					gameId = rs2.getInt(&quot;game_id&quot;);</span>
	
<span class="nc" id="L83">					logger.debug(gameId);</span>
	
<span class="nc" id="L85">					gameMasterLMSBean = dgMap.get(gameId);</span>
<span class="nc bnc" id="L86" title="All 2 branches missed.">	             if(gameMasterLMSBean != null){</span>
<span class="nc" id="L87">					gameMasterLMSBean.setAgentSaleCommRate(rs2</span>
							.getDouble(&quot;agent_sale_comm_rate&quot;));
<span class="nc" id="L89">					gameMasterLMSBean.setAgentPwtCommRate(rs2</span>
							.getDouble(&quot;agent_pwt_comm_rate&quot;));
<span class="nc" id="L91">					gameMasterLMSBean.setRetSaleCommRate(rs2</span>
							.getDouble(&quot;retailer_sale_comm_rate&quot;));
<span class="nc" id="L93">					gameMasterLMSBean.setRetPwtCommRate(rs2</span>
							.getDouble(&quot;retailer_pwt_comm_rate&quot;));
<span class="nc" id="L95">					gameMasterLMSBean.setVatAmount(rs2.getDouble(&quot;vat_amt&quot;));</span>
<span class="nc" id="L96">					gameMasterLMSBean.setGovtComm(rs2.getDouble(&quot;govt_comm&quot;));</span>
<span class="nc" id="L97">					gameMasterLMSBean.setGovtCommPwt(rs2.getDouble(&quot;govt_comm_pwt&quot;));</span>
<span class="nc" id="L98">					gameMasterLMSBean.setHighPrizeAmount(rs2</span>
							.getDouble(&quot;high_prize_amt&quot;));
<span class="nc" id="L100">					gameMasterLMSBean.setPrizePayoutRatio(rs2</span>
							.getDouble(&quot;prize_payout_ratio&quot;));
<span class="nc" id="L102">					gameMasterLMSBean.setGameStatus(rs2</span>
							.getString(&quot;game_status&quot;));
<span class="nc" id="L104">					gameMasterLMSBean.setBonusBallEnable(rs2</span>
							.getString(&quot;bonus_ball_enable&quot;));
<span class="nc" id="L106">					dgMap.put(gameId, gameMasterLMSBean);</span>
<span class="nc" id="L107">					lmsMap.put(gameId,gameMasterLMSBean);</span>
				}
				}
				// Utility.gameLMSMap=lmsMap;
	
<span class="nc" id="L112">			} catch (Exception ex) {</span>
<span class="nc" id="L113">				ex.printStackTrace();</span>
			}
	
			finally {
<span class="nc bnc" id="L117" title="All 6 branches missed.">				if (con != null) {</span>
					try {
<span class="nc" id="L119">						con.close();</span>
<span class="nc" id="L120">					} catch (SQLException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L122">						e.printStackTrace();</span>
<span class="nc" id="L123">					}</span>
				}
			}
		}
<span class="nc" id="L127">		Util.setGameMap(dgMap);</span>
<span class="nc" id="L128">		Util.setLmsGameMap(lmsMap);</span>
		
<span class="nc" id="L130">		logger.debug(&quot;**********In onStartGameData***********&quot;</span>
				+ Util.getGameMap());
		
<span class="nc" id="L133">		 getUpdatedData(servletContext);</span>
		
<span class="nc" id="L135">	}</span>
	
	public static void onStartSLEGameData(){
<span class="nc" id="L138">		long startTime = System.currentTimeMillis();</span>
<span class="nc" id="L139">		logger.debug(&quot;---- ENTERING INTO onStartSLEGameData ----&quot;);</span>
<span class="nc" id="L140">		ResultSet rs = null;</span>
<span class="nc" id="L141">		Connection con = null;</span>
<span class="nc" id="L142">		Statement stmt = null;</span>
<span class="nc" id="L143">		Map&lt;Integer, GameMasterLMSBean&gt; sleGameMap = null;</span>
			try {
<span class="nc" id="L145">				con = DBConnect.getConnection();				</span>
<span class="nc" id="L146">				stmt = con.createStatement();</span>
<span class="nc" id="L147">				rs = stmt.executeQuery(&quot;select game_type_id,type_dev_name,agent_sale_comm_rate,agent_pwt_comm_rate,govt_pwt_comm_rate,retailer_sale_comm_rate,retailer_pwt_comm_rate,vat_amt,gov_comm_rate,type_status,prize_payout_ratio from st_sle_game_type_master order by display_order&quot;);</span>
<span class="nc" id="L148">				sleGameMap = new HashMap&lt;Integer, GameMasterLMSBean&gt;();</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L150">					GameMasterLMSBean gameMasterLMSBean = new GameMasterLMSBean();</span>
<span class="nc" id="L151">					gameMasterLMSBean.setAgentSaleCommRate(rs.getDouble(&quot;agent_sale_comm_rate&quot;));</span>
<span class="nc" id="L152">					gameMasterLMSBean.setAgentPwtCommRate(rs.getDouble(&quot;agent_pwt_comm_rate&quot;));</span>
<span class="nc" id="L153">					gameMasterLMSBean.setRetSaleCommRate(rs.getDouble(&quot;retailer_sale_comm_rate&quot;));</span>
<span class="nc" id="L154">					gameMasterLMSBean.setRetPwtCommRate(rs.getDouble(&quot;retailer_pwt_comm_rate&quot;));</span>
<span class="nc" id="L155">					gameMasterLMSBean.setGovtCommPwt(rs.getDouble(&quot;govt_pwt_comm_rate&quot;));</span>
<span class="nc" id="L156">					gameMasterLMSBean.setVatAmount(rs.getDouble(&quot;vat_amt&quot;));</span>
<span class="nc" id="L157">					gameMasterLMSBean.setGovtComm(rs.getDouble(&quot;gov_comm_rate&quot;));</span>
<span class="nc" id="L158">					gameMasterLMSBean.setGameStatus(rs.getString(&quot;type_status&quot;));</span>
<span class="nc" id="L159">					gameMasterLMSBean.setPrizePayoutRatio(rs.getDouble(&quot;prize_payout_ratio&quot;));</span>
<span class="nc" id="L160">					sleGameMap.put(rs.getInt(&quot;game_type_id&quot;), gameMasterLMSBean);</span>
<span class="nc" id="L161">				}</span>
<span class="nc" id="L162">			}catch (Exception ex) {</span>
<span class="nc" id="L163">				ex.printStackTrace();</span>
<span class="nc" id="L164">			}finally {</span>
<span class="nc" id="L165">			}</span>
<span class="nc" id="L166">			Util.setSLEGameMap(sleGameMap);</span>
<span class="nc" id="L167">			long endTime = System.currentTimeMillis();</span>
<span class="nc" id="L168">			logger.info(&quot;TIME TAKEN BY onStartSLEGameData &quot; + ((endTime-startTime)/1000)+ &quot; SECONDS&quot;);</span>
<span class="nc" id="L169">		}</span>
	public static void getUpdatedData(ServletContext servletContext) {
<span class="nc" id="L171">		ServiceResponse sRes = new ServiceResponse();</span>
<span class="nc" id="L172">		ServiceRequest sReq = new ServiceRequest();</span>
<span class="nc" id="L173">		sReq.setServiceName(ServiceName.DATA_MGMT);</span>
<span class="nc" id="L174">		sReq.setServiceMethod(ServiceMethodName.DRAWGAME_FETCH_UPDATED_DATA);</span>

<span class="nc" id="L176">		IServiceDelegate delegate = ServiceDelegate.getInstance();</span>
<span class="nc" id="L177">		sRes = delegate.getResponse(sReq);</span>
			
<span class="nc" id="L179">		JsonArray updatedDataListArray=(JsonArray) sRes.getResponseData();</span>
		
<span class="nc" id="L181">		  String drawIdTableMapString= updatedDataListArray.get(0).getAsJsonObject().toString();</span>
<span class="nc" id="L182">		  Type drawIdTableMapType = new TypeToken&lt;Map&lt;Integer, Map&lt;Integer, String&gt;&gt;&gt;() {}.getType();</span>
<span class="nc" id="L183">		  Map&lt;Integer, Map&lt;Integer, String&gt;&gt; drawIdTableMap=new Gson().fromJson(drawIdTableMapString, drawIdTableMapType);</span>
			
<span class="nc" id="L185">		  String jackPotMapString= updatedDataListArray.get(3).getAsJsonObject().toString();</span>
<span class="nc" id="L186">		  Type jackPotMapType = new TypeToken&lt;Map&lt;Integer, Double&gt;&gt;() {}.getType();</span>
<span class="nc" id="L187">		  Map&lt;Integer, Double&gt; jackPotMap=new Gson().fromJson(jackPotMapString, jackPotMapType);</span>
		
<span class="nc" id="L189">		  String drawIdDateMapString= updatedDataListArray.get(4).getAsJsonObject().toString();</span>
<span class="nc" id="L190">		  Type drawIdDateMapType = new TypeToken&lt;Map&lt;String, Map&lt;Long, String&gt;&gt;&gt;() {}.getType();</span>
<span class="nc" id="L191">		  Map&lt;String, Map&lt;Long, String&gt;&gt; drawIdDateMap=new Gson().fromJson(drawIdDateMapString, drawIdDateMapType);</span>
		
		  
<span class="nc" id="L194">		  String drawDetailsMapString= updatedDataListArray.get(5).getAsJsonObject().toString();</span>
<span class="nc" id="L195">		  Type drawDetailsMapType = new TypeToken&lt;Map&lt;Integer, Map&lt;Integer, DrawDetailsBean&gt;&gt;&gt;() {}.getType();</span>
<span class="nc" id="L196">		  Map&lt;Integer, Map&lt;Integer, DrawDetailsBean&gt;&gt; drawDetailsMap=new Gson().fromJson(drawDetailsMapString, drawDetailsMapType);</span>
		
		  
<span class="nc" id="L199">		  String drawNameListMapString= updatedDataListArray.get(6).getAsJsonObject().toString();</span>
<span class="nc" id="L200">		  Type drawNameListMapType = new TypeToken&lt;TreeMap&lt;Integer, List&lt;String&gt;&gt;&gt;() {}.getType();</span>
<span class="nc" id="L201">		  TreeMap&lt;Integer, List&lt;String&gt;&gt; drawNameListMap=new Gson().fromJson(drawNameListMapString, drawNameListMapType);</span>
		
<span class="nc" id="L203">		  String freezTimeMapString= updatedDataListArray.get(7).getAsJsonObject().toString();</span>
<span class="nc" id="L204">		  Type freezTimeMapType = new TypeToken&lt;TreeMap&lt;Integer, String&gt;&gt;() {}.getType();</span>
<span class="nc" id="L205">		  TreeMap&lt;Integer, String&gt; freezTimeMap=new Gson().fromJson(freezTimeMapString, freezTimeMapType);</span>
		
<span class="nc" id="L207">		  String gameNameListString= updatedDataListArray.get(8).getAsJsonArray().toString();</span>
<span class="nc" id="L208">		  Type gameNameListType = new TypeToken&lt;List&lt;String&gt;&gt;() {}.getType();</span>
<span class="nc" id="L209">		  List&lt;String&gt; gameNameList=new Gson().fromJson(gameNameListString, gameNameListType);</span>
		
<span class="nc" id="L211">		  String gameDataString= updatedDataListArray.get(1).getAsJsonObject().toString();</span>
<span class="nc" id="L212">		  Type gameDataType = new TypeToken&lt;TreeMap&lt;Integer, List&lt;List&gt;&gt;&gt;() {}.getType();</span>
<span class="nc" id="L213">		  TreeMap&lt;Integer, List&lt;List&gt;&gt; gameData=new Gson().fromJson(gameDataString, gameDataType);</span>
		

<span class="nc" id="L216">		Util.drawIdTableMap = drawIdTableMap;</span>
<span class="nc" id="L217">		Util.gameData = gameData;</span>
<span class="nc" id="L218">		Util.jackPotMap = jackPotMap;</span>
<span class="nc" id="L219">		Util.drawIdDateMap = drawIdDateMap;</span>
<span class="nc" id="L220">		Util.drawDetailsMap = drawDetailsMap;</span>
<span class="nc" id="L221">		Util.drawNameListMap = drawNameListMap;</span>
		
		
		
<span class="nc" id="L225">		servletContext.setAttribute(&quot;GAME_DATA&quot;,gameData);</span>
<span class="nc" id="L226">		servletContext.setAttribute(&quot;drawIdTableMap&quot;,drawIdTableMap);</span>
<span class="nc" id="L227">		servletContext.setAttribute(&quot;jackPotMap&quot;,jackPotMap);</span>
<span class="nc" id="L228">		servletContext.setAttribute(&quot;drawIdDateMap&quot;,drawIdDateMap);</span>
<span class="nc" id="L229">		servletContext.setAttribute(&quot;drawDetailsMap&quot;,drawDetailsMap);</span>
<span class="nc" id="L230">		servletContext.setAttribute(&quot;FREEZE_TIME_MAP_NEW&quot;,freezTimeMap);</span>
<span class="nc" id="L231">		servletContext.setAttribute(&quot;gameNameList&quot;,gameNameList);</span>
		 
		 
<span class="nc" id="L234">	}</span>
	
	

	public static void onStartOrganizationData() {
<span class="nc" id="L239">		logger.debug(&quot;---- ENTERING INTO onStartOrganizationData ----&quot;);</span>
<span class="nc" id="L240">		Map&lt;String, GameMasterLMSBean&gt; lmsMap = null;</span>
<span class="nc" id="L241">		Connection con = DBConnect.getConnection();</span>
		try {
<span class="nc" id="L243">			String orgQuery = &quot;select organization_id,organization_type from st_lms_organization_master where organization_type!='BO'&quot;;</span>
<span class="nc" id="L244">			PreparedStatement pstmtOrgQry = con.prepareStatement(orgQuery);</span>
<span class="nc" id="L245">			ResultSet rsOrgQry = pstmtOrgQry.executeQuery();</span>
<span class="nc" id="L246">			Map&lt;Integer, Map&lt;Integer, OrgDataBean&gt;&gt; orgDataMap = new HashMap&lt;Integer, Map&lt;Integer, OrgDataBean&gt;&gt;();</span>
<span class="nc" id="L247">			Map&lt;Integer, OrgDataBean&gt; gameDataMap = null;</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">			while (rsOrgQry.next()) {</span>
<span class="nc" id="L249">				gameDataMap = getOrgGameData(</span>
						rsOrgQry.getInt(&quot;organization_id&quot;), con, rsOrgQry
								.getString(&quot;organization_type&quot;));
<span class="nc" id="L252">				orgDataMap.put(rsOrgQry.getInt(&quot;organization_id&quot;), gameDataMap);</span>
			}
<span class="nc" id="L254">			Util.orgDataMap = orgDataMap;</span>

<span class="nc" id="L256">			Util.promoGameBeanMap=getPromoGameBeanMap(con);</span>
	
<span class="nc" id="L258">			Util.setRespGamingCriteriaStatusMap();</span>
			
<span class="nc" id="L260">		} catch (Exception ex) {</span>
<span class="nc" id="L261">			ex.printStackTrace();</span>
		}

		finally {
<span class="nc bnc" id="L265" title="All 6 branches missed.">			if (con != null) {</span>
				try {
<span class="nc" id="L267">					con.close();</span>
<span class="nc" id="L268">				} catch (SQLException e) {</span>
<span class="nc" id="L269">					e.printStackTrace();</span>
<span class="nc" id="L270">				}</span>
			}
		}
<span class="nc" id="L273">	}</span>


	public static void onStartOrgDataForSLE() {
<span class="nc" id="L277">		long startTime  = System.currentTimeMillis();</span>
<span class="nc" id="L278">		logger.debug(&quot; ---- ENTERING INTO onStartOrganizationData for SLE----&quot;);</span>
<span class="nc" id="L279">		Connection con = null;</span>
<span class="nc" id="L280">		ResultSet rs = null;</span>
<span class="nc" id="L281">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L282">		Map&lt;Integer, Map&lt;Integer, OrgDataBean&gt;&gt; orgDataMap = null;</span>
		try {
<span class="nc" id="L284">			String query = &quot;select game_type_id game_id , organization_id ,sum(agent_pwt_comm_rate) pwt_comm_variance , sum(agent_sale_comm_rate) sale_comm_variance from (select game_type_id ,organization_id , IF(organization_type='AGENT', agent_pwt_comm_rate, retailer_pwt_comm_rate) agent_pwt_comm_rate, IF(organization_type='AGENT', agent_sale_comm_rate, retailer_sale_comm_rate) agent_sale_comm_rate from st_sle_game_type_master  gm , st_lms_organization_master om where  organization_type &lt;&gt; 'BO' union all select  game_id , agent_org_id organization_id , pwt_comm_variance , sale_comm_variance from st_sle_bo_agent_sale_pwt_comm_variance union all select  game_id , retailer_org_id organization_id , pwt_comm_variance , sale_comm_variance from st_sle_agent_retailer_sale_pwt_comm_variance) a group by organization_id , game_type_id order by  pwt_comm_variance DESC&quot;;</span>
<span class="nc" id="L285">			con = DBConnect.getConnection();</span>
<span class="nc" id="L286">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L287">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L288">			orgDataMap = new ConcurrentHashMap&lt;Integer, Map&lt;Integer, OrgDataBean&gt;&gt;();</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L290">				int orgId = rs.getInt(&quot;organization_id&quot;);</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">				if(orgDataMap.containsKey(orgId)){</span>
<span class="nc" id="L292">					Map&lt;Integer, OrgDataBean&gt; gameDataMap = orgDataMap.get(orgId);</span>
<span class="nc" id="L293">					OrgDataBean orgBean = new OrgDataBean();</span>
<span class="nc" id="L294">					orgBean.setOrganizationId(orgId);</span>
<span class="nc" id="L295">					orgBean.setPwtCommVar(rs.getDouble(&quot;pwt_comm_variance&quot;));</span>
<span class="nc" id="L296">					orgBean.setSaleCommVar(rs.getDouble(&quot;sale_comm_variance&quot;));</span>
<span class="nc" id="L297">					gameDataMap.put(rs.getInt(&quot;game_id&quot;), orgBean);</span>
<span class="nc" id="L298">				}else{</span>
<span class="nc" id="L299">					Map&lt;Integer, OrgDataBean&gt; gameDataMap = new HashMap&lt;Integer, OrgDataBean&gt;();;</span>
<span class="nc" id="L300">					OrgDataBean orgBean = new OrgDataBean();</span>
<span class="nc" id="L301">					orgBean.setOrganizationId(orgId);</span>
<span class="nc" id="L302">					orgBean.setPwtCommVar(rs.getDouble(&quot;pwt_comm_variance&quot;));</span>
<span class="nc" id="L303">					orgBean.setSaleCommVar(rs.getDouble(&quot;sale_comm_variance&quot;));</span>
<span class="nc" id="L304">					gameDataMap.put(rs.getInt(&quot;game_id&quot;), orgBean);</span>
<span class="nc" id="L305">					orgDataMap.put(orgId, gameDataMap);</span>
				}
<span class="nc" id="L307">			}</span>
			
<span class="nc" id="L309">			Util.sleOrgDataMap = orgDataMap;</span>
<span class="nc" id="L310">			long endTime  = System.currentTimeMillis();</span>
			
<span class="nc" id="L312">			logger.info(&quot;TIME TAKEN &quot; + ((endTime-startTime)/1000) +&quot; Seconds....&quot;);</span>
<span class="nc" id="L313">			logger.info(&quot;ORG DATA SIZE... &quot;+orgDataMap.size());</span>
			
<span class="nc" id="L315">		} catch (Exception ex) {</span>
<span class="nc" id="L316">			ex.printStackTrace();</span>
		}
		finally {
<span class="nc" id="L319">			DBConnect.closeConnection(con, pstmt , rs);</span>
<span class="nc" id="L320">		}</span>
<span class="nc" id="L321">	}</span>
	
	public static void updateOrgDataForSLE(String orgType , int organizationId , Connection con) throws Exception {
<span class="nc" id="L324">		long startTime  = System.currentTimeMillis();</span>
<span class="nc" id="L325">		logger.debug(&quot; ---- ENTERING INTO onStartOrganizationData for SLE----&quot;);</span>
<span class="nc" id="L326">		ResultSet rs = null;</span>
<span class="nc" id="L327">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L328">		Map&lt;Integer, OrgDataBean&gt; gameDataMap = null;</span>

		try {
<span class="nc" id="L331">			String query = &quot;select  &quot; +organizationId+&quot; organization_id  ,game_type_id game_id,  retailer_sale_comm_rate , retailer_pwt_comm_rate , agent_sale_comm_rate , agent_pwt_comm_rate from st_sle_game_type_master&quot;;</span>
<span class="nc" id="L332">			con = DBConnect.getConnection();</span>
<span class="nc" id="L333">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L334">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L335">			gameDataMap = new HashMap&lt;Integer, OrgDataBean&gt;();</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">			if(&quot;RETAILER&quot;.equalsIgnoreCase(orgType)){</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L338">					int gameId = rs.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L339">						OrgDataBean orgBean = new OrgDataBean();</span>
<span class="nc" id="L340">						orgBean.setOrganizationId(organizationId);</span>
<span class="nc" id="L341">						orgBean.setPwtCommVar(rs.getDouble(&quot;retailer_pwt_comm_rate&quot;));</span>
<span class="nc" id="L342">						orgBean.setSaleCommVar(rs.getDouble(&quot;retailer_sale_comm_rate&quot;));</span>
<span class="nc" id="L343">						gameDataMap.put(gameId , orgBean);</span>
<span class="nc" id="L344">				}</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">			}else if(&quot;AGENT&quot;.equalsIgnoreCase(orgType)){</span>
<span class="nc bnc" id="L346" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L347">					int gameId = rs.getInt(&quot;game_id&quot;);</span>
<span class="nc" id="L348">						OrgDataBean orgBean = new OrgDataBean();</span>
<span class="nc" id="L349">						orgBean.setOrganizationId(organizationId);</span>
<span class="nc" id="L350">						orgBean.setPwtCommVar(rs.getDouble(&quot;agent_pwt_comm_rate&quot;));</span>
<span class="nc" id="L351">						orgBean.setSaleCommVar(rs.getDouble(&quot;agent_sale_comm_rate&quot;));</span>
<span class="nc" id="L352">						gameDataMap.put(gameId , orgBean);</span>
<span class="nc" id="L353">				}</span>
			}else{
<span class="nc" id="L355">				throw new Exception(); // TEMP</span>
			}
			
<span class="nc" id="L358">			Util.sleOrgDataMap.put(organizationId, gameDataMap);</span>
<span class="nc" id="L359">			long endTime  = System.currentTimeMillis();</span>
<span class="nc" id="L360">			logger.info(&quot;TIME TAKEN &quot; + ((endTime-startTime)/1000) +&quot; Seconds....&quot;);</span>
<span class="nc" id="L361">		} catch (Exception ex) {</span>
<span class="nc" id="L362">			ex.printStackTrace();</span>
<span class="nc" id="L363">			throw ex;</span>
		}
		finally {
<span class="nc" id="L366">			DBConnect.closeConnection(pstmt , rs);</span>
<span class="nc" id="L367">		}</span>

<span class="nc" id="L369">	}</span>
	
	
	
	public static Map&lt;Integer, OrgDataBean&gt; getOrgGameData(int organizationId,
			Connection con, String orgType) throws LMSException {
<span class="nc" id="L375">		Map&lt;Integer, OrgDataBean&gt; gameDataMap = new HashMap&lt;Integer, OrgDataBean&gt;();</span>
<span class="nc" id="L376">		OrgDataBean orgDataBean = null;</span>
<span class="nc" id="L377">		PreparedStatement pstmtgameQry = null;</span>
<span class="nc" id="L378">		ResultSet rsGameQry = null;</span>
<span class="nc" id="L379">		String gameQuery = null;</span>
<span class="nc" id="L380">		gameQuery = &quot;select game_id from st_dg_game_master order by game_nbr&quot;;</span>
		try {
<span class="nc" id="L382">			pstmtgameQry = con.prepareStatement(gameQuery);</span>
<span class="nc" id="L383">			rsGameQry = pstmtgameQry.executeQuery();</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">			while (rsGameQry.next()) {</span>
<span class="nc" id="L385">				orgDataBean = new OrgDataBean();</span>
<span class="nc" id="L386">				double orgSaleCommVar = CommonFunctionsHelper</span>
						.fetchDGCommOfOrganization(rsGameQry.getInt(&quot;game_id&quot;),
								organizationId, &quot;SALE&quot;, orgType, con);
<span class="nc" id="L389">				orgDataBean.setOrganizationId(organizationId);</span>
<span class="nc" id="L390">				orgDataBean.setSaleCommVar(orgSaleCommVar);</span>
<span class="nc" id="L391">				gameDataMap.put(rsGameQry.getInt(&quot;game_id&quot;), orgDataBean);</span>
<span class="nc" id="L392">			}</span>
<span class="nc" id="L393">			return gameDataMap;</span>
<span class="nc" id="L394">		} catch (SQLException se) {</span>
<span class="nc" id="L395">			se.printStackTrace();</span>
<span class="nc" id="L396">			throw new LMSException();</span>
		}
	}

	public static Map&lt;Integer, OrgDataBean&gt; getOrgGameDataIW(int organizationId, Connection con, String orgType) throws LMSException {
<span class="nc" id="L401">		Map&lt;Integer, OrgDataBean&gt; gameDataMap = new HashMap&lt;Integer, OrgDataBean&gt;();</span>
<span class="nc" id="L402">		OrgDataBean orgDataBean = null;</span>
<span class="nc" id="L403">		PreparedStatement pstmtgameQry = null;</span>
<span class="nc" id="L404">		ResultSet rsGameQry = null;</span>
<span class="nc" id="L405">		String gameQuery = null;</span>
<span class="nc" id="L406">		gameQuery = &quot;select game_id from st_iw_game_master where game_status = 'SALE_OPEN' order by game_no&quot;;</span>
		try {
<span class="nc" id="L408">			pstmtgameQry = con.prepareStatement(gameQuery);</span>
<span class="nc" id="L409">			rsGameQry = pstmtgameQry.executeQuery();</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">			while (rsGameQry.next()) {</span>
<span class="nc" id="L411">				orgDataBean = new OrgDataBean();</span>
<span class="nc" id="L412">				double orgSaleCommVar = CommonFunctionsHelper.fetchIWCommOfOrganization(rsGameQry.getInt(&quot;game_id&quot;), organizationId, &quot;SALE&quot;, orgType, con);</span>
<span class="nc" id="L413">				orgDataBean.setOrganizationId(organizationId);</span>
<span class="nc" id="L414">				orgDataBean.setSaleCommVar(orgSaleCommVar);</span>
<span class="nc" id="L415">				gameDataMap.put(rsGameQry.getInt(&quot;game_id&quot;), orgDataBean);</span>
<span class="nc" id="L416">			}</span>
<span class="nc" id="L417">			return gameDataMap;</span>
<span class="nc" id="L418">		} catch (SQLException se) {</span>
<span class="nc" id="L419">			se.printStackTrace();</span>
<span class="nc" id="L420">			throw new LMSException();</span>
		}
	}
	
	public static Map&lt;Integer, OrgDataBean&gt; getOrgGameDataVS(int organizationId, Connection con, String orgType) throws LMSException {
<span class="nc" id="L425">		Map&lt;Integer, OrgDataBean&gt; gameDataMap = new HashMap&lt;Integer, OrgDataBean&gt;();</span>
<span class="nc" id="L426">		OrgDataBean orgDataBean = null;</span>
<span class="nc" id="L427">		PreparedStatement pstmtgameQry = null;</span>
<span class="nc" id="L428">		ResultSet rsGameQry = null;</span>
<span class="nc" id="L429">		String gameQuery = null;</span>
<span class="nc" id="L430">		gameQuery = &quot;select game_id from st_vs_game_master where game_status = 'SALE_OPEN' order by game_no&quot;;</span>
		try {
<span class="nc" id="L432">			pstmtgameQry = con.prepareStatement(gameQuery);</span>
<span class="nc" id="L433">			rsGameQry = pstmtgameQry.executeQuery();</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">			while (rsGameQry.next()) {</span>
<span class="nc" id="L435">				orgDataBean = new OrgDataBean();</span>
<span class="nc" id="L436">				double orgSaleCommVar = CommonFunctionsHelper.fetchVSCommOfOrganization(rsGameQry.getInt(&quot;game_id&quot;), organizationId, &quot;SALE&quot;, orgType, con);</span>
<span class="nc" id="L437">				orgDataBean.setOrganizationId(organizationId);</span>
<span class="nc" id="L438">				orgDataBean.setSaleCommVar(orgSaleCommVar);</span>
<span class="nc" id="L439">				gameDataMap.put(rsGameQry.getInt(&quot;game_id&quot;), orgDataBean);</span>
<span class="nc" id="L440">			}</span>
<span class="nc" id="L441">			return gameDataMap;</span>
<span class="nc" id="L442">		} catch (SQLException se) {</span>
<span class="nc" id="L443">			se.printStackTrace();</span>
<span class="nc" id="L444">			throw new LMSException();</span>
		}
	}

	public static Map&lt;Integer, List&lt;PromoGameBean&gt;&gt; getPromoGameBeanMap(Connection con) throws SQLException {
		
		
<span class="nc" id="L451">		Map&lt;Integer,List&lt;PromoGameBean&gt;&gt; promoGameBeanMap=new HashMap&lt;Integer, List&lt;PromoGameBean&gt;&gt;();</span>
<span class="nc" id="L452">		Statement stmt=con.createStatement();</span>
<span class="nc" id="L453">		ResultSet gameRs=stmt.executeQuery(&quot;select game_id,game_name_dev,game_name from st_dg_game_master where game_status !='SALE_CLOSE'&quot;);</span>
<span class="nc bnc" id="L454" title="All 2 branches missed.">		while(gameRs.next()){</span>
<span class="nc" id="L455">		PreparedStatement promoPstmt=con.prepareStatement(&quot;select scheme_id,sale_ticket_amt,start_time,end_time,promo_game_id,promo_ticket_type,promo_game_type,no_of_free_tickets,no_of_draws,game_name_dev as promo_game_name,game_name promo_display_name from st_dg_promo_scheme ps,st_dg_game_master gm where ps.promo_game_id=gm.game_id and sale_game_id=&quot;+gameRs.getShort(&quot;game_id&quot;)+&quot;  and status='ACTIVE'&quot;);</span>
<span class="nc" id="L456">		ResultSet rs=promoPstmt.executeQuery();</span>
<span class="nc" id="L457">		PromoGameBean promoBean=null;</span>
<span class="nc" id="L458">		List&lt;PromoGameBean&gt; promoGameList=new ArrayList&lt;PromoGameBean&gt;();</span>
<span class="nc" id="L459">		String  gameName= gameRs.getString(&quot;game_name&quot;);</span>
<span class="nc bnc" id="L460" title="All 2 branches missed.">			while(rs.next()){</span>
			
<span class="nc" id="L462">			promoBean = new PromoGameBean();</span>
<span class="nc" id="L463">			promoBean.setSchemeId(rs.getInt(&quot;scheme_id&quot;));</span>
<span class="nc" id="L464">			promoBean.setPromoGameNo(rs.getInt(&quot;promo_game_id&quot;));</span>
<span class="nc" id="L465">			promoBean.setPromoGametype(rs.getString(&quot;promo_game_type&quot;));</span>
<span class="nc" id="L466">			promoBean.setPromoTicketType(rs.getString(&quot;promo_ticket_type&quot;));</span>
<span class="nc" id="L467">			promoBean.setPromoGameDisplayName(rs.getString(&quot;promo_display_name&quot;));</span>
<span class="nc" id="L468">			promoBean.setSaleStartTime(rs.getString(&quot;start_time&quot;));</span>
<span class="nc" id="L469">			promoBean.setSaleEndTime(rs.getString(&quot;end_time&quot;));</span>
<span class="nc" id="L470">			promoBean.setSaleTicketAmt(rs.getDouble(&quot;sale_ticket_amt&quot;));</span>
<span class="nc bnc" id="L471" title="All 2 branches missed.">			if(rs.getString(&quot;promo_game_name&quot;) != null){</span>
<span class="nc" id="L472">				promoBean.setPromoGameName(rs.getString(&quot;promo_game_name&quot;));</span>
				}
<span class="nc bnc" id="L474" title="All 2 branches missed.">			if(rs.getString(&quot;no_of_free_tickets&quot;) != null){</span>
<span class="nc" id="L475">				promoBean.setNoOfPromoTickets(rs.getInt(&quot;no_of_free_tickets&quot;));</span>
			}
<span class="nc bnc" id="L477" title="All 2 branches missed.">			if(rs.getString(&quot;no_of_draws&quot;) != null){</span>
<span class="nc" id="L478">				promoBean.setNoOfDraws(rs.getInt(&quot;no_of_draws&quot;));</span>
				}
<span class="nc bnc" id="L480" title="All 2 branches missed.">			if(gameName!=null){</span>
<span class="nc" id="L481">				promoBean.setMainGameName(gameName);</span>
			}
			
<span class="nc" id="L484">			promoGameList.add(promoBean);</span>
		}
<span class="nc" id="L486">		promoGameBeanMap.put(gameRs.getInt(&quot;game_id&quot;), promoGameList);</span>
		
<span class="nc" id="L488">		}</span>
<span class="nc" id="L489">		return promoGameBeanMap;</span>
	}
	public static void onStartAdvMessageData()
	{
<span class="nc" id="L493">		logger.info(&quot;---- ENTERING INTO onStartAdvMessageData ----&quot;);</span>

<span class="nc" id="L495">			Util.advMsgDataMap = new ServerStartUpData().getAdvMsgDataMap();</span>
<span class="nc" id="L496">			SLEUtil.advMessageMap = CommonMethodsControllerImpl.getInstance().getSLEAdvMessageMap();</span>
<span class="nc" id="L497">			IWUtil.advMessageMap = com.skilrock.lms.coreEngine.instantWin.common.controllerImpl.CommonMethodsControllerImpl.getInstance().getIWAdvMessageMap();</span>
<span class="nc" id="L498">			VSUtil.advMessageMap = com.skilrock.lms.coreEngine.virtualSport.common.controllerImpl.CommonMethodsControllerImpl.getInstance().getVSAdvMessageMap();</span>
<span class="nc" id="L499">	}</span>



	public Map&lt;Integer, Map&lt;Integer, List&lt;MessageDetailsBean&gt;&gt;&gt; getAdvMsgDataMap() {

<span class="nc" id="L505">		ResultSet set = null;</span>
<span class="nc" id="L506">		Connection con = null;</span>
<span class="nc" id="L507">		Statement statement=null;</span>
<span class="nc" id="L508">		List&lt;MessageDetailsBean&gt; tempList = null;</span>
<span class="nc" id="L509">		MessageDetailsBean messageDetailsBean = null;</span>
<span class="nc" id="L510">		Map&lt;Integer, Map&lt;Integer, List&lt;MessageDetailsBean&gt;&gt;&gt; orgMsgDetailMap = null;</span>
		
		try {
<span class="nc" id="L513">			con = DBConnect.getConnection();</span>
<span class="nc" id="L514">			statement = con.createStatement();</span>
<span class="nc" id="L515">			set = statement.executeQuery(&quot;select advMap.org_id, advMap.game_id, advMas.msg_id, advMas.date, advMas.creator_user_id, advMas.msg_text, advMas.status, advMas.editable, advMas.msg_for, advMas.msg_location, advMas.activity from st_dg_adv_msg_org_mapping advMap inner join st_dg_adv_msg_master advMas on advMap.msg_id = advMas.msg_id and advMas.status = 'ACTIVE' and advMas.activity in('SALE','ALL') and advMas.msg_for = 'PLAYER' and advMap.service_id = (select service_id from st_lms_service_master where service_code='DG') order by game_id,org_id&quot;);</span>

<span class="nc" id="L517">			orgMsgDetailMap = new HashMap&lt;Integer, Map&lt;Integer,List&lt;MessageDetailsBean&gt;&gt;&gt;();</span>
<span class="nc bnc" id="L518" title="All 2 branches missed.">			while(set.next())</span>
			{
<span class="nc" id="L520">				messageDetailsBean = new MessageDetailsBean();</span>
<span class="nc" id="L521">				messageDetailsBean.setMessageId(set.getInt(&quot;msg_id&quot;));</span>
<span class="nc" id="L522">				messageDetailsBean.setDate(set.getTimestamp(&quot;date&quot;));</span>
<span class="nc" id="L523">				messageDetailsBean.setCreatorUserId(set.getInt(&quot;creator_user_id&quot;));</span>
<span class="nc" id="L524">				messageDetailsBean.setMessageText(set.getString(&quot;msg_text&quot;));</span>
<span class="nc" id="L525">				messageDetailsBean.setStatus(set.getString(&quot;status&quot;));</span>
<span class="nc" id="L526">				messageDetailsBean.setEditable(set.getString(&quot;editable&quot;));</span>
<span class="nc" id="L527">				messageDetailsBean.setMessageFor(set.getString(&quot;msg_for&quot;));</span>
<span class="nc" id="L528">				messageDetailsBean.setMessageLocation(set.getString(&quot;msg_location&quot;));</span>
<span class="nc" id="L529">				messageDetailsBean.setActivity(set.getString(&quot;activity&quot;));</span>

<span class="nc" id="L531">				int orgId = set.getInt(&quot;org_id&quot;);</span>
<span class="nc" id="L532">				int gameId = set.getInt(&quot;game_id&quot;);</span>
				
<span class="nc bnc" id="L534" title="All 2 branches missed.">				if(orgMsgDetailMap.containsKey(orgId)){</span>
<span class="nc" id="L535">					Map&lt;Integer, List&lt;MessageDetailsBean&gt;&gt; gameMsgDetailMap = orgMsgDetailMap.get(orgId);</span>
<span class="nc bnc" id="L536" title="All 2 branches missed.">					if(gameMsgDetailMap.containsKey(gameId)) {</span>
<span class="nc" id="L537">						gameMsgDetailMap.get(gameId).add(messageDetailsBean);</span>
					} else {
<span class="nc" id="L539">						tempList = new ArrayList&lt;MessageDetailsBean&gt;();</span>
<span class="nc" id="L540">						tempList.add(messageDetailsBean);</span>
<span class="nc" id="L541">						gameMsgDetailMap.put(gameId, tempList);</span>
					}
<span class="nc" id="L543">				} else {</span>
<span class="nc" id="L544">					Map&lt;Integer, List&lt;MessageDetailsBean&gt;&gt; gameMsgDetailMap = new HashMap&lt;Integer, List&lt;MessageDetailsBean&gt;&gt;();</span>
<span class="nc" id="L545">					tempList = new ArrayList&lt;MessageDetailsBean&gt;();</span>
<span class="nc" id="L546">					tempList.add(messageDetailsBean);</span>
<span class="nc" id="L547">					gameMsgDetailMap.put(gameId, tempList);</span>
<span class="nc" id="L548">					orgMsgDetailMap.put(orgId, gameMsgDetailMap);</span>
				}
<span class="nc" id="L550">			}</span>
		}
<span class="nc" id="L552">		catch (SQLException e) {</span>
<span class="nc" id="L553">			logger.error(&quot;SQL Exception  :- &quot; + e);</span>
<span class="nc" id="L554">		}catch (Exception e) {</span>
<span class="nc" id="L555">			logger.error(&quot;General Exception  :- &quot; + e);</span>
		}
		finally {
<span class="nc" id="L558">			DBConnect.closeConnection(con, statement, set);</span>
<span class="nc" id="L559">		}</span>
<span class="nc" id="L560">		return orgMsgDetailMap;</span>
	}
	
	public static void setServicesMaps(Map&lt;String,String&gt; serviceCodeNameMap, Map&lt;String,Integer&gt; serviceCodeIdMap){
<span class="nc" id="L564">		Connection con = DBConnect.getConnection();</span>
		try{
<span class="nc" id="L566">			PreparedStatement pstmt = con.prepareStatement(&quot;select service_id, service_code, service_display_name from st_lms_service_master where status='ACTIVE' and service_display_name &lt;&gt; 'HOME' AND service_display_name &lt;&gt; 'SCRATCH'&quot;);</span>
<span class="nc" id="L567">			System.out.println(&quot;Service Query:&quot; + pstmt + &quot;***&quot;);</span>
<span class="nc" id="L568">			ResultSet rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L569" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L570">				serviceCodeNameMap.put(rs.getString(&quot;service_code&quot;), rs.getString(&quot;service_display_name&quot;));</span>
<span class="nc" id="L571">				serviceCodeIdMap.put(rs.getString(&quot;service_code&quot;), rs.getInt(&quot;service_id&quot;));</span>
			}
<span class="nc" id="L573">		} catch(SQLException se){</span>
<span class="nc" id="L574">			se.printStackTrace();</span>
		} finally{
<span class="nc" id="L576">			DBConnect.closeCon(con);</span>
<span class="nc" id="L577">		}</span>
<span class="nc" id="L578">	}</span>
	
	public static void onStartIWGameData() {
<span class="nc" id="L581">		long startTime = System.currentTimeMillis();</span>
<span class="nc" id="L582">		logger.debug(&quot;---- ENTERING INTO onStartIWGameData ----&quot;);</span>
<span class="nc" id="L583">		ResultSet rs = null;</span>
<span class="nc" id="L584">		Connection con = null;</span>
<span class="nc" id="L585">		Statement stmt = null;</span>
<span class="nc" id="L586">		Map&lt;Integer, GameMasterLMSBean&gt; iwGameMap = null;</span>
		try {
<span class="nc" id="L588">			con = DBConnect.getConnection();</span>
<span class="nc" id="L589">			stmt = con.createStatement();</span>
<span class="nc" id="L590">			rs = stmt.executeQuery(&quot;select game_id, game_dev_name, agent_sale_comm_rate, agent_pwt_comm_rate, retailer_sale_comm_rate, retailer_pwt_comm_rate, vat_amt, gov_comm_rate, game_status, prize_payout_ratio from st_iw_game_master order by display_order;&quot;);</span>
<span class="nc" id="L591">			iwGameMap = new HashMap&lt;Integer, GameMasterLMSBean&gt;();</span>
<span class="nc bnc" id="L592" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L593">				GameMasterLMSBean gameMasterLMSBean = new GameMasterLMSBean();</span>
<span class="nc" id="L594">				gameMasterLMSBean.setAgentSaleCommRate(rs.getDouble(&quot;agent_sale_comm_rate&quot;));</span>
<span class="nc" id="L595">				gameMasterLMSBean.setAgentPwtCommRate(rs.getDouble(&quot;agent_pwt_comm_rate&quot;));</span>
<span class="nc" id="L596">				gameMasterLMSBean.setRetSaleCommRate(rs.getDouble(&quot;retailer_sale_comm_rate&quot;));</span>
<span class="nc" id="L597">				gameMasterLMSBean.setRetPwtCommRate(rs.getDouble(&quot;retailer_pwt_comm_rate&quot;));</span>
<span class="nc" id="L598">				gameMasterLMSBean.setVatAmount(rs.getDouble(&quot;vat_amt&quot;));</span>
<span class="nc" id="L599">				gameMasterLMSBean.setGovtComm(rs.getDouble(&quot;gov_comm_rate&quot;));</span>
<span class="nc" id="L600">				gameMasterLMSBean.setGameStatus(rs.getString(&quot;game_status&quot;));</span>
<span class="nc" id="L601">				gameMasterLMSBean.setPrizePayoutRatio(rs.getDouble(&quot;prize_payout_ratio&quot;));</span>
<span class="nc" id="L602">				iwGameMap.put(rs.getInt(&quot;game_id&quot;), gameMasterLMSBean);</span>
<span class="nc" id="L603">			}</span>
<span class="nc" id="L604">		} catch (Exception ex) {</span>
<span class="nc" id="L605">			ex.printStackTrace();</span>
<span class="nc" id="L606">		} finally {</span>
<span class="nc" id="L607">		}</span>
<span class="nc" id="L608">		Util.setIWGameMap(iwGameMap);</span>
<span class="nc" id="L609">		long endTime = System.currentTimeMillis();</span>
<span class="nc" id="L610">		logger.info(&quot;TIME TAKEN BY onStartIWGameData &quot; + ((endTime - startTime) / 1000) + &quot; SECONDS&quot;);</span>
<span class="nc" id="L611">	}</span>
	
	public static void onStartOrgDataForIW() {
<span class="nc" id="L614">		long startTime = System.currentTimeMillis();</span>
<span class="nc" id="L615">		logger.debug(&quot; ---- ENTERING INTO onStartOrganizationData for IW----&quot;);</span>
<span class="nc" id="L616">		Connection con = null;</span>
<span class="nc" id="L617">		ResultSet rs = null;</span>
<span class="nc" id="L618">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L619">		Map&lt;Integer, Map&lt;Integer, OrgDataBean&gt;&gt; orgDataMap = null;</span>
		try {
<span class="nc" id="L621">			String query = &quot;select game_id , organization_id ,sum(agent_pwt_comm_rate) pwt_comm_variance , sum(agent_sale_comm_rate) sale_comm_variance from (select game_id ,organization_id, IF(organization_type='AGENT', agent_pwt_comm_rate, retailer_pwt_comm_rate) agent_pwt_comm_rate, IF(organization_type='AGENT', agent_sale_comm_rate, retailer_sale_comm_rate) agent_sale_comm_rate from st_iw_game_master  gm , st_lms_organization_master om where  organization_type &lt;&gt; 'BO' union all select  game_id , agent_org_id organization_id, pwt_comm_variance , sale_comm_variance from st_iw_bo_agent_sale_pwt_comm_variance union all select  game_id , retailer_org_id organization_id , pwt_comm_variance, sale_comm_variance from st_iw_agent_retailer_sale_pwt_comm_variance) a group by organization_id , game_id order by  pwt_comm_variance DESC;&quot;;</span>
<span class="nc" id="L622">			con = DBConnect.getConnection();</span>
<span class="nc" id="L623">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L624">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L625">			orgDataMap = new ConcurrentHashMap&lt;Integer, Map&lt;Integer, OrgDataBean&gt;&gt;();</span>
<span class="nc bnc" id="L626" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L627">				int orgId = rs.getInt(&quot;organization_id&quot;);</span>
<span class="nc bnc" id="L628" title="All 2 branches missed.">				if (orgDataMap.containsKey(orgId)) {</span>
<span class="nc" id="L629">					Map&lt;Integer, OrgDataBean&gt; gameDataMap = orgDataMap.get(orgId);</span>
<span class="nc" id="L630">					OrgDataBean orgBean = new OrgDataBean();</span>
<span class="nc" id="L631">					orgBean.setOrganizationId(orgId);</span>
<span class="nc" id="L632">					orgBean.setPwtCommVar(rs.getDouble(&quot;pwt_comm_variance&quot;));</span>
<span class="nc" id="L633">					orgBean.setSaleCommVar(rs.getDouble(&quot;sale_comm_variance&quot;));</span>
<span class="nc" id="L634">					gameDataMap.put(rs.getInt(&quot;game_id&quot;), orgBean);</span>
<span class="nc" id="L635">				} else {</span>
<span class="nc" id="L636">					Map&lt;Integer, OrgDataBean&gt; gameDataMap = new HashMap&lt;Integer, OrgDataBean&gt;();</span>
<span class="nc" id="L637">					OrgDataBean orgBean = new OrgDataBean();</span>
<span class="nc" id="L638">					orgBean.setOrganizationId(orgId);</span>
<span class="nc" id="L639">					orgBean.setPwtCommVar(rs.getDouble(&quot;pwt_comm_variance&quot;));</span>
<span class="nc" id="L640">					orgBean.setSaleCommVar(rs.getDouble(&quot;sale_comm_variance&quot;));</span>
<span class="nc" id="L641">					gameDataMap.put(rs.getInt(&quot;game_id&quot;), orgBean);</span>
<span class="nc" id="L642">					orgDataMap.put(orgId, gameDataMap);</span>
				}
<span class="nc" id="L644">			}</span>
<span class="nc" id="L645">			Util.iwOrgDataMap = orgDataMap;</span>
<span class="nc" id="L646">			long endTime = System.currentTimeMillis();</span>

<span class="nc" id="L648">			logger.info(&quot;TIME TAKEN &quot; + ((endTime - startTime) / 1000) + &quot; Seconds....&quot;);</span>
<span class="nc" id="L649">			logger.info(&quot;IW ORG DATA SIZE... &quot; + orgDataMap.size());</span>
<span class="nc" id="L650">		} catch (Exception ex) {</span>
<span class="nc" id="L651">			ex.printStackTrace();</span>
		} finally {
<span class="nc" id="L653">			DBConnect.closeConnection(con, pstmt, rs);</span>
<span class="nc" id="L654">		}</span>
<span class="nc" id="L655">	}</span>
	
	public static void onStartVSGameData() {
<span class="nc" id="L658">		long startTime = System.currentTimeMillis();</span>
<span class="nc" id="L659">		logger.debug(&quot;---- ENTERING INTO onStartVSGameData ----&quot;);</span>
<span class="nc" id="L660">		ResultSet rs = null;</span>
<span class="nc" id="L661">		Connection con = null;</span>
<span class="nc" id="L662">		Statement stmt = null;</span>
<span class="nc" id="L663">		Map&lt;Integer, GameMasterLMSBean&gt; vsGameMap = null;</span>
		try {
<span class="nc" id="L665">			con = DBConnect.getConnection();</span>
<span class="nc" id="L666">			stmt = con.createStatement();</span>
<span class="nc" id="L667">			rs = stmt.executeQuery(&quot;select game_id, game_dev_name, agent_sale_comm_rate, agent_pwt_comm_rate, retailer_sale_comm_rate, retailer_pwt_comm_rate, vat_amt, gov_comm_rate, game_status, prize_payout_ratio from st_vs_game_master order by display_order;&quot;);</span>
<span class="nc" id="L668">			vsGameMap = new HashMap&lt;Integer, GameMasterLMSBean&gt;();</span>
<span class="nc bnc" id="L669" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L670">				GameMasterLMSBean gameMasterLMSBean = new GameMasterLMSBean();</span>
<span class="nc" id="L671">				gameMasterLMSBean.setAgentSaleCommRate(rs.getDouble(&quot;agent_sale_comm_rate&quot;));</span>
<span class="nc" id="L672">				gameMasterLMSBean.setAgentPwtCommRate(rs.getDouble(&quot;agent_pwt_comm_rate&quot;));</span>
<span class="nc" id="L673">				gameMasterLMSBean.setRetSaleCommRate(rs.getDouble(&quot;retailer_sale_comm_rate&quot;));</span>
<span class="nc" id="L674">				gameMasterLMSBean.setRetPwtCommRate(rs.getDouble(&quot;retailer_pwt_comm_rate&quot;));</span>
<span class="nc" id="L675">				gameMasterLMSBean.setVatAmount(rs.getDouble(&quot;vat_amt&quot;));</span>
<span class="nc" id="L676">				gameMasterLMSBean.setGovtComm(rs.getDouble(&quot;gov_comm_rate&quot;));</span>
<span class="nc" id="L677">				gameMasterLMSBean.setGameStatus(rs.getString(&quot;game_status&quot;));</span>
<span class="nc" id="L678">				gameMasterLMSBean.setPrizePayoutRatio(rs.getDouble(&quot;prize_payout_ratio&quot;));</span>
<span class="nc" id="L679">				vsGameMap.put(rs.getInt(&quot;game_id&quot;), gameMasterLMSBean);</span>
<span class="nc" id="L680">			}</span>
<span class="nc" id="L681">		} catch (Exception ex) {</span>
<span class="nc" id="L682">			ex.printStackTrace();</span>
<span class="nc" id="L683">		} finally {</span>
<span class="nc" id="L684">		}</span>
<span class="nc" id="L685">		Util.setVSGameMap(vsGameMap);</span>
<span class="nc" id="L686">		long endTime = System.currentTimeMillis();</span>
<span class="nc" id="L687">		logger.info(&quot;TIME TAKEN BY onStartVSGameData &quot; + ((endTime - startTime) / 1000) + &quot; SECONDS&quot;);</span>
<span class="nc" id="L688">	}</span>
	
	public static void onStartOrgDataForVS() {
<span class="nc" id="L691">		long startTime = System.currentTimeMillis();</span>
<span class="nc" id="L692">		logger.debug(&quot; ---- ENTERING INTO onStartOrganizationData for VS----&quot;);</span>
<span class="nc" id="L693">		Connection con = null;</span>
<span class="nc" id="L694">		ResultSet rs = null;</span>
<span class="nc" id="L695">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L696">		Map&lt;Integer, Map&lt;Integer, OrgDataBean&gt;&gt; orgDataMap = null;</span>
		try {
<span class="nc" id="L698">			String query = &quot;select game_id, organization_id, sum(agent_pwt_comm_rate) pwt_comm_variance, sum(agent_sale_comm_rate) sale_comm_variance from (select game_id ,organization_id, IF(organization_type='AGENT', agent_pwt_comm_rate, retailer_pwt_comm_rate) agent_pwt_comm_rate, IF(organization_type='AGENT', agent_sale_comm_rate, retailer_sale_comm_rate) agent_sale_comm_rate from st_vs_game_master gm , st_lms_organization_master om where  organization_type &lt;&gt; 'BO' union all select  game_id , agent_org_id organization_id, pwt_comm_variance , sale_comm_variance from st_vs_bo_agent_sale_pwt_comm_variance union all select  game_id , retailer_org_id organization_id , pwt_comm_variance, sale_comm_variance from st_vs_agent_retailer_sale_pwt_comm_variance) a group by organization_id , game_id order by  pwt_comm_variance DESC;&quot;;</span>
<span class="nc" id="L699">			con = DBConnect.getConnection();</span>
<span class="nc" id="L700">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L701">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L702">			orgDataMap = new ConcurrentHashMap&lt;Integer, Map&lt;Integer, OrgDataBean&gt;&gt;();</span>
<span class="nc bnc" id="L703" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L704">				int orgId = rs.getInt(&quot;organization_id&quot;);</span>
<span class="nc bnc" id="L705" title="All 2 branches missed.">				if (orgDataMap.containsKey(orgId)) {</span>
<span class="nc" id="L706">					Map&lt;Integer, OrgDataBean&gt; gameDataMap = orgDataMap.get(orgId);</span>
<span class="nc" id="L707">					OrgDataBean orgBean = new OrgDataBean();</span>
<span class="nc" id="L708">					orgBean.setOrganizationId(orgId);</span>
<span class="nc" id="L709">					orgBean.setPwtCommVar(rs.getDouble(&quot;pwt_comm_variance&quot;));</span>
<span class="nc" id="L710">					orgBean.setSaleCommVar(rs.getDouble(&quot;sale_comm_variance&quot;));</span>
<span class="nc" id="L711">					gameDataMap.put(rs.getInt(&quot;game_id&quot;), orgBean);</span>
<span class="nc" id="L712">				} else {</span>
<span class="nc" id="L713">					Map&lt;Integer, OrgDataBean&gt; gameDataMap = new HashMap&lt;Integer, OrgDataBean&gt;();</span>
<span class="nc" id="L714">					OrgDataBean orgBean = new OrgDataBean();</span>
<span class="nc" id="L715">					orgBean.setOrganizationId(orgId);</span>
<span class="nc" id="L716">					orgBean.setPwtCommVar(rs.getDouble(&quot;pwt_comm_variance&quot;));</span>
<span class="nc" id="L717">					orgBean.setSaleCommVar(rs.getDouble(&quot;sale_comm_variance&quot;));</span>
<span class="nc" id="L718">					gameDataMap.put(rs.getInt(&quot;game_id&quot;), orgBean);</span>
<span class="nc" id="L719">					orgDataMap.put(orgId, gameDataMap);</span>
				}
<span class="nc" id="L721">			}</span>
<span class="nc" id="L722">			Util.vsOrgDataMap = orgDataMap;</span>
<span class="nc" id="L723">			long endTime = System.currentTimeMillis();</span>

<span class="nc" id="L725">			logger.info(&quot;TIME TAKEN &quot; + ((endTime - startTime) / 1000) + &quot; Seconds....&quot;);</span>
<span class="nc" id="L726">			logger.info(&quot;VS ORG DATA SIZE... &quot; + orgDataMap.size());</span>
<span class="nc" id="L727">		} catch (Exception ex) {</span>
<span class="nc" id="L728">			ex.printStackTrace();</span>
		} finally {
<span class="nc" id="L730">			DBConnect.closeConnection(con, pstmt, rs);</span>
<span class="nc" id="L731">		}</span>
<span class="nc" id="L732">	}</span>
	

public static void main(String[] args) {
	
<span class="nc" id="L737">	ServiceResponse sRes = new ServiceResponse();</span>
<span class="nc" id="L738">	ServiceRequest sReq = new ServiceRequest();</span>
<span class="nc" id="L739">	sReq.setServiceName(ServiceName.DATA_MGMT);</span>
<span class="nc" id="L740">	sReq.setServiceMethod(ServiceMethodName.DRAWGAME_FETCH_UPDATED_DATA);</span>
	//KenoPurchaseBean kenoBean=new KenoPurchaseBean();
	//kenoBean.setGameDispName(&quot;keno&quot;);
	//kenoBean.setDrawDateTime(null);
	//sReq.setServiceData(kenoBean);
<span class="nc" id="L745">	IServiceDelegate delegate = ServiceDelegate.getInstance();</span>
<span class="nc" id="L746">	sRes = delegate.getResponse(sReq);</span>
		
<span class="nc" id="L748">	JsonArray updatedDataListArray=(JsonArray) sRes.getResponseData();</span>
	
<span class="nc" id="L750">	String drawIdTableMapString= updatedDataListArray.get(0).getAsJsonObject().toString();</span>
<span class="nc" id="L751">	  Type drawIdTableMapType = new TypeToken&lt;Map&lt;Integer, Map&lt;Integer, String&gt;&gt;&gt;() {}.getType();</span>
<span class="nc" id="L752">	  Map&lt;Integer, Map&lt;Integer, String&gt;&gt; drawIdTableMap=new Gson().fromJson(drawIdTableMapString, drawIdTableMapType);</span>
		
<span class="nc" id="L754">	  String jackPotMapString= updatedDataListArray.get(3).getAsJsonObject().toString();</span>
<span class="nc" id="L755">	  Type jackPotMapType = new TypeToken&lt;Map&lt;Integer, Double&gt;&gt;() {}.getType();</span>
<span class="nc" id="L756">	  Map&lt;Integer, Double&gt; jackPotMap=new Gson().fromJson(jackPotMapString, jackPotMapType);</span>
	
<span class="nc" id="L758">	  String drawIdDateMapString= updatedDataListArray.get(4).getAsJsonObject().toString();</span>
<span class="nc" id="L759">	  Type drawIdDateMapType = new TypeToken&lt;Map&lt;String, Map&lt;Long, String&gt;&gt;&gt;() {}.getType();</span>
<span class="nc" id="L760">	  Map&lt;String, Map&lt;Long, String&gt;&gt; drawIdDateMap=new Gson().fromJson(drawIdDateMapString, drawIdDateMapType);</span>
	
	  
<span class="nc" id="L763">	  String drawDetailsMapString= updatedDataListArray.get(5).getAsJsonObject().toString();</span>
<span class="nc" id="L764">	  Type drawDetailsMapType = new TypeToken&lt;Map&lt;Integer, Map&lt;Integer, DrawDetailsBean&gt;&gt;&gt;() {}.getType();</span>
<span class="nc" id="L765">	  Map&lt;Integer, Map&lt;Integer, DrawDetailsBean&gt;&gt; drawDetailsMap=new Gson().fromJson(drawDetailsMapString, drawDetailsMapType);</span>
	
	  
<span class="nc" id="L768">	  String drawNameListMapString= updatedDataListArray.get(6).getAsJsonObject().toString();</span>
<span class="nc" id="L769">	  Type drawNameListMapType = new TypeToken&lt;TreeMap&lt;Integer, List&lt;String&gt;&gt;&gt;() {}.getType();</span>
<span class="nc" id="L770">	  TreeMap&lt;Integer, List&lt;String&gt;&gt; drawNameListMap=new Gson().fromJson(drawNameListMapString, drawNameListMapType);</span>
	
<span class="nc" id="L772">	  String freezTimeMapString= updatedDataListArray.get(7).getAsJsonObject().toString();</span>
<span class="nc" id="L773">	  Type freezTimeMapType = new TypeToken&lt;Map&lt;Integer, String&gt;&gt;() {}.getType();</span>
<span class="nc" id="L774">	  Map&lt;Integer, String&gt; freezTimeMap=new Gson().fromJson(freezTimeMapString, freezTimeMapType);</span>
	
<span class="nc" id="L776">	  String gameNameListString= updatedDataListArray.get(8).getAsJsonArray().toString();</span>
<span class="nc" id="L777">	  Type gameNameListType = new TypeToken&lt;List&lt;String&gt;&gt;() {}.getType();</span>
<span class="nc" id="L778">	  List&lt;String&gt; gameNameList=new Gson().fromJson(gameNameListString, gameNameListType);</span>
	
<span class="nc" id="L780">	  String gameDataString= updatedDataListArray.get(1).getAsJsonObject().toString();</span>
<span class="nc" id="L781">	  Type gameDataType = new TypeToken&lt;TreeMap&lt;Integer, List&lt;List&gt;&gt;&gt;() {}.getType();</span>
<span class="nc" id="L782">	  TreeMap&lt;Integer, List&lt;List&gt;&gt; gameData=new Gson().fromJson(gameDataString, gameDataType);</span>
	
	 

<span class="nc" id="L786">	Util.drawIdTableMap = drawIdTableMap;</span>
<span class="nc" id="L787">	Util.gameData = gameData;</span>
<span class="nc" id="L788">	Util.jackPotMap = jackPotMap;</span>
<span class="nc" id="L789">	Util.drawIdDateMap = drawIdDateMap;</span>
<span class="nc" id="L790">	Util.drawDetailsMap = drawDetailsMap;</span>
<span class="nc" id="L791">	Util.drawNameListMap = drawNameListMap;</span>
	
	 
	
	 
	 
	
	/*
	ServiceResponse sRes = new ServiceResponse();
	ServiceRequest sReq = new ServiceRequest();
	sReq.setServiceName(ServiceName.DATA_MGMT);
	sReq.setServiceMethod(ServiceMethodName.ON_START_GAME_DATA);
	IServiceDelegate delegate = ServiceDelegate.getInstance();
	
	sRes = delegate.getResponse(sReq);
	
	String responseString=sRes.getResponseData().toString();
	//Type elementType = new TypeToken&lt;Map&lt;Integer, GameMasterLMSBean&gt;&gt;() {}.getType();
	Type elementType = new TypeToken&lt;Map&lt;Integer, GameMasterLMSBean&gt;&gt;() {}.getType();
	
	Map&lt;Integer, GameMasterLMSBean&gt; lmsMap=new Gson().fromJson(responseString, elementType);
	
	
	
	
	
	//Map&lt;Integer, GameMasterLMSBean&gt; lmsMap = null;
	Connection con = DBConnect.getConnection();

	if (sRes.getIsSuccess()) {
		
			lmsMap = (Map&lt;Integer, GameMasterLMSBean&gt;) sRes
					.getResponseData();
			
		
			
			
			System.out.println(lmsMap.get(2));
			for(Entry&lt;Integer, GameMasterLMSBean&gt; entry:lmsMap.entrySet())
				
			System.out.println(entry.getKey()+&quot;   &quot;+entry.getValue().getPriceMap());
			}
			
			
<span class="nc" id="L835">	*/}</span>


	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>