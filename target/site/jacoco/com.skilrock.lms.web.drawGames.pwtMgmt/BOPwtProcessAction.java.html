<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BOPwtProcessAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.web.drawGames.pwtMgmt</a> &gt; <span class="el_source">BOPwtProcessAction.java</span></div><h1>BOPwtProcessAction.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.web.drawGames.pwtMgmt;

import java.util.List;
import java.util.Map;

import javax.servlet.ServletContext;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.struts2.ServletActionContext;
import org.apache.struts2.interceptor.ServletRequestAware;
import org.apache.struts2.interceptor.ServletResponseAware;

import com.opensymphony.xwork2.ActionSupport;
import com.skilrock.lms.beans.DrawPwtApproveRequestNPlrBean;
import com.skilrock.lms.beans.PlayerBean;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.CommonValidation;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.utility.LMSUtility;
import com.skilrock.lms.coreEngine.drawGames.pwtMgmt.BOPwtProcessHelper;
import com.skilrock.lms.dge.beans.DrawIdBean;
import com.skilrock.lms.dge.beans.MainPWTDrawBean;
import com.skilrock.lms.dge.beans.PWTDrawBean;
import com.skilrock.lms.web.drawGames.common.Util;

<span class="nc" id="L30">public class BOPwtProcessAction extends ActionSupport implements</span>
		ServletRequestAware, ServletResponseAware {
	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	private int agentOrgId;
	private String bankAccNbr;
	private String bankBranch;

	private String bankName;
	private String chequeDate;
	private String chqNbr;
	private String country;
	private String denyPwtStatus;

	private String draweeBank;

	// private String virnNbr;
	private int drawId;

	private String emailId;
	// private int approvedById;
	private String firstName;

	private int gameId;
	private String gameIdNbrName;
	private int gameNbr;

	private String gameType;
	private String generatedReceiptNumber;

	private String idNumber;
	private String idType;
	private String issuiningParty;
	private String lastName;
	private String locationCity;
<span class="nc" id="L67">	Log logger = LogFactory.getLog(BOPwtProcessAction.class);</span>
	private double netAmt;
	private String panelId;
	private int partyId;
	private String partyType;
	private String paymentPendingAt;
	private String paymentType;
	private String phone;
	private int playerId;

	private String playerType;
	private String plrAddr1;
	private String plrAddr2;
	private String plrAlreadyReg;
	private String plrCity;
	private String plrCountry;
	private String plrPin;
	DrawPwtApproveRequestNPlrBean plrPwtBean;
	private double pwtAmount;
	private Map pwtAppMap;
	List&lt;DrawPwtApproveRequestNPlrBean&gt; pwtPayDetailsList;
	List&lt;DrawPwtApproveRequestNPlrBean&gt; pwtReqDetailsList;
	HttpServletRequest request;
	private int requestedById;
	private String requesterType;
	private String requestId;
	HttpServletResponse response;
	private int retOrgId;
	private String state;
	private String status;

	private int taskId;
	private double taxAmt;
	private String ticketNbr;
	
	private String ticketNbrDraw;
	private String city;
	MainPWTDrawBean mainPwtBean;


	public MainPWTDrawBean getMainPwtBean() {
<span class="nc" id="L108">		return mainPwtBean;</span>
	}

	public void setMainPwtBean(MainPWTDrawBean mainPwtBean) {
<span class="nc" id="L112">		this.mainPwtBean = mainPwtBean;</span>
<span class="nc" id="L113">	}</span>

	public String approvePendingPwtsByMas() throws LMSException {
<span class="nc" id="L116">		String pwtAmtForMasterApproval = (String) ServletActionContext</span>
				.getServletContext().getAttribute(&quot;PWT_APPROVAL_LIMIT&quot;);
<span class="nc" id="L118">		BOPwtProcessHelper processHelper = new BOPwtProcessHelper();</span>
<span class="nc" id="L119">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L120">		UserInfoBean userBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L122">		int approvedByOrgId = userBean.getUserOrgId();</span>
<span class="nc" id="L123">		int approvedByUserId = userBean.getUserId();</span>
<span class="nc" id="L124">		String remarks = processHelper.approvePendingPwtsByMas(taskId,</span>
				pwtAmount, requestedById, requesterType, approvedByOrgId,
				approvedByUserId, gameId, gameNbr, drawId, panelId, ticketNbr,
				pwtAmtForMasterApproval);
<span class="nc" id="L128">		session.setAttribute(&quot;REMARKS&quot;, remarks);</span>
<span class="nc" id="L129">		return SUCCESS;</span>
	}

	public String denyRequestedPwts() throws LMSException {
<span class="nc" id="L133">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L134">		UserInfoBean userBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L136">		BOPwtProcessHelper processHelper = new BOPwtProcessHelper();</span>
<span class="nc" id="L137">		boolean isDenied = processHelper.denyPWTProcess(taskId, drawId, gameId,</span>
				ticketNbr, denyPwtStatus, gameNbr, userBean.getUserId(),
				userBean.getUserOrgId(), panelId);
<span class="nc bnc" id="L140" title="All 2 branches missed.">		if (isDenied) {</span>
<span class="nc" id="L141">			return SUCCESS;</span>
		} else {
<span class="nc" id="L143">			return ERROR;</span>
		}
	}

	public int getAgentOrgId() {
<span class="nc" id="L148">		return agentOrgId;</span>
	}

	// added by amit on 04/08/10 for anonymous player

	public String getBankAccNbr() {
<span class="nc" id="L154">		return bankAccNbr;</span>
	}

	public String getBankBranch() {
<span class="nc" id="L158">		return bankBranch;</span>
	}

	public String getBankName() {
<span class="nc" id="L162">		return bankName;</span>
	}

	public String getChequeDate() {
<span class="nc" id="L166">		return chequeDate;</span>
	}

	public String getChqNbr() {
<span class="nc" id="L170">		return chqNbr;</span>
	}

	public String getCountry() {
<span class="nc" id="L174">		return country;</span>
	}

	public String getDenyPwtStatus() {
<span class="nc" id="L178">		return denyPwtStatus;</span>
	}

	public String getDraweeBank() {
<span class="nc" id="L182">		return draweeBank;</span>
	}

	public int getDrawId() {
<span class="nc" id="L186">		return drawId;</span>
	}

	public String getEmailId() {
<span class="nc" id="L190">		return emailId;</span>
	}

	public String getFirstName() {
<span class="nc" id="L194">		return firstName;</span>
	}

	public int getGameId() {
<span class="nc" id="L198">		return gameId;</span>
	}

	public String getGameIdNbrName() {
<span class="nc" id="L202">		return gameIdNbrName;</span>
	}

	public int getGameNbr() {
<span class="nc" id="L206">		return gameNbr;</span>
	}

	public String getGameType() {
<span class="nc" id="L210">		return gameType;</span>
	}

	public String getGeneratedReceiptNumber() {
<span class="nc" id="L214">		return generatedReceiptNumber;</span>
	}

	public String getIdNumber() {
<span class="nc" id="L218">		return idNumber;</span>
	}

	public String getIdType() {
<span class="nc" id="L222">		return idType;</span>
	}

	public String getIssuiningParty() {
<span class="nc" id="L226">		return issuiningParty;</span>
	}

	public String getLastName() {
<span class="nc" id="L230">		return lastName;</span>
	}

	public String getLocationCity() {
<span class="nc" id="L234">		return locationCity;</span>
	}

	public double getNetAmt() {
<span class="nc" id="L238">		return netAmt;</span>
	}

	public String getPanelId() {
<span class="nc" id="L242">		return panelId;</span>
	}

	public int getPartyId() {
<span class="nc" id="L246">		return partyId;</span>
	}

	public String getPartyType() {
<span class="nc" id="L250">		return partyType;</span>
	}

	public String getPaymentPendingAt() {
<span class="nc" id="L254">		return paymentPendingAt;</span>
	}
	
	public String getPaymentType() {
<span class="nc" id="L258">		return paymentType;</span>
	}

	public String getCity() {
<span class="nc" id="L262">		return city;</span>
	}

	public void setCity(String city) {
<span class="nc" id="L266">		this.city = city;</span>
<span class="nc" id="L267">	}</span>

	public String getPendingPwtToPay() throws LMSException {
<span class="nc" id="L270">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L271">		UserInfoBean userBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L273">		int payByOrgId = 0;</span>
<span class="nc" id="L274">		BOPwtProcessHelper processHelper = new BOPwtProcessHelper();</span>

		// pwtPayDetailsList=processHelper.getRequestsPwtsToPay(requestId,agentOrgId,firstName,lastName,status,payByOrgId,partyType);

<span class="nc bnc" id="L278" title="All 2 branches missed.">		if (&quot;BO&quot;.equals(paymentPendingAt)) {</span>
<span class="nc" id="L279">			payByOrgId = userBean.getUserOrgId();</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">		} else if (&quot;AGENT&quot;.equals(paymentPendingAt)) {</span>
<span class="nc" id="L281">			payByOrgId = agentOrgId;</span>
		}
<span class="nc" id="L283">		pwtPayDetailsList = processHelper.getRequestsPwtsToPay(requestId,</span>
				agentOrgId, firstName, lastName, status, payByOrgId,
				paymentPendingAt, partyType);

<span class="nc" id="L287">		return SUCCESS;</span>
	}

	public String getPendingPwtToPayDetails() throws LMSException {
<span class="nc" id="L291">		ServletContext sc = ServletActionContext.getServletContext();</span>
<span class="nc" id="L292">		String raffleTktType = (String)sc.getAttribute(&quot;raffle_ticket_type&quot;);</span>
<span class="nc" id="L293">		BOPwtProcessHelper processHelper = new BOPwtProcessHelper();</span>
<span class="nc" id="L294">		plrPwtBean = processHelper.getRequestDetails(taskId, partyType,raffleTktType);</span>
		// plrBean=(PlayerBean)plrPetDetails.get(0);
		// plrPwtBean=(PwtApproveRequestNPlrBean)plrPetDetails.get(1);
<span class="nc" id="L297">		return SUCCESS;</span>
	}

	public String getPhone() {
<span class="nc" id="L301">		return phone;</span>
	}

	public int getPlayerId() {
<span class="nc" id="L305">		return playerId;</span>
	}

	public String getPlayerType() {
<span class="nc" id="L309">		return playerType;</span>
	}

	public String getPlrAddr1() {
<span class="nc" id="L313">		return plrAddr1;</span>
	}

	public String getPlrAddr2() {
<span class="nc" id="L317">		return plrAddr2;</span>
	}

	public String getPlrAlreadyReg() {
<span class="nc" id="L321">		return plrAlreadyReg;</span>
	}

	public String getPlrCity() {
<span class="nc" id="L325">		return plrCity;</span>
	}

	public String getPlrCountry() {
<span class="nc" id="L329">		return plrCountry;</span>
	}

	public String getPlrPin() {
<span class="nc" id="L333">		return plrPin;</span>
	}

	public DrawPwtApproveRequestNPlrBean getPlrPwtBean() {
<span class="nc" id="L337">		return plrPwtBean;</span>
	}

	public double getPwtAmount() {
<span class="nc" id="L341">		return pwtAmount;</span>
	}

	public Map getPwtAppMap() {
<span class="nc" id="L345">		return pwtAppMap;</span>
	}

	public List&lt;DrawPwtApproveRequestNPlrBean&gt; getPwtPayDetailsList() {
<span class="nc" id="L349">		return pwtPayDetailsList;</span>
	}

	public List&lt;DrawPwtApproveRequestNPlrBean&gt; getPwtReqDetailsList() {
<span class="nc" id="L353">		return pwtReqDetailsList;</span>
	}

	public HttpServletRequest getRequest() {
<span class="nc" id="L357">		return request;</span>
	}

	public int getRequestedById() {
<span class="nc" id="L361">		return requestedById;</span>
	}

	public String getRequesterType() {
<span class="nc" id="L365">		return requesterType;</span>
	}

	public String getRequestId() {
<span class="nc" id="L369">		return requestId;</span>
	}

	public HttpServletResponse getResponse() {
<span class="nc" id="L373">		return response;</span>
	}

	public int getRetOrgId() {
<span class="nc" id="L377">		return retOrgId;</span>
	}

	public String getState() {
<span class="nc" id="L381">		return state;</span>
	}

	public String getStatus() {
<span class="nc" id="L385">		return status;</span>
	}

	public int getTaskId() {
<span class="nc" id="L389">		return taskId;</span>
	}

	public double getTaxAmt() {
<span class="nc" id="L393">		return taxAmt;</span>
	}

	public String getTicketNbr() {
<span class="nc" id="L397">		return ticketNbr;</span>
	}

	public String getTicketNbrDraw() {
<span class="nc" id="L401">		return ticketNbrDraw;</span>
	}

	public String getUnapprovedPwtForMas() throws LMSException {

<span class="nc" id="L406">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L407">		UserInfoBean userBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L409">		int approvalByOrgId = userBean.getUserOrgId();</span>

<span class="nc bnc" id="L411" title="All 2 branches missed.">		if (retOrgId &gt; 0) {</span>
<span class="nc" id="L412">			requestedById = retOrgId;</span>
		} else {
<span class="nc" id="L414">			requestedById = agentOrgId;</span>
		}

<span class="nc" id="L417">		logger.debug(&quot;requested by id is in draw game  &quot; + requestedById</span>
				+ &quot;:retorg id :&quot; + retOrgId);

<span class="nc" id="L420">		BOPwtProcessHelper processHelper = new BOPwtProcessHelper();</span>
<span class="nc" id="L421">		pwtReqDetailsList = processHelper.getRequestedPwts(requestId,</span>
				requestedById, requesterType, firstName, lastName, status,
				approvalByOrgId, partyType);
<span class="nc" id="L424">		logger.debug(&quot;before success&quot;);</span>

<span class="nc" id="L426">		return SUCCESS;</span>
	}

	public String getUnapprovedPwtForMasDetails() throws LMSException {
<span class="nc" id="L430">		ServletContext sc = ServletActionContext.getServletContext();</span>
<span class="nc" id="L431">		String raffleTktType = (String)sc.getAttribute(&quot;raffle_ticket_type&quot;);</span>
<span class="nc" id="L432">		BOPwtProcessHelper processHelper = new BOPwtProcessHelper();</span>
<span class="nc" id="L433">		plrPwtBean = processHelper.getRequestDetails(taskId, partyType,raffleTktType);</span>
		// plrBean=(PlayerBean)plrPetDetails.get(0);
		// plrPwtBean=(PwtApproveRequestNPlrBean)plrPetDetails.get(1);
<span class="nc" id="L436">		return SUCCESS;</span>
	}

	public String getUnapprovePwts() throws LMSException {
<span class="nc" id="L440">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L441">		UserInfoBean userBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L443">		int approvalByOrgId = userBean.getUserOrgId();</span>

<span class="nc bnc" id="L445" title="All 2 branches missed.">		if (retOrgId &gt; 0) {</span>
<span class="nc" id="L446">			requestedById = retOrgId;</span>
		} else {
<span class="nc" id="L448">			requestedById = agentOrgId;</span>
		}

<span class="nc" id="L451">		logger.debug(&quot;requested by id is &quot; + requestedById + &quot;:retorg id :&quot;</span>
				+ retOrgId);

<span class="nc" id="L454">		BOPwtProcessHelper processHelper = new BOPwtProcessHelper();</span>
<span class="nc" id="L455">		pwtReqDetailsList = processHelper.getRequestedPwts(requestId,</span>
				requestedById, requesterType, firstName, lastName, status,
				approvalByOrgId, partyType);
<span class="nc" id="L458">		logger.debug(&quot;before success&quot;);</span>
<span class="nc" id="L459">		return SUCCESS;</span>

	}

	public String payPendingPwts() throws LMSException {
<span class="nc" id="L464">		BOPwtProcessHelper processHelper = new BOPwtProcessHelper();</span>
<span class="nc" id="L465">		HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L466">		UserInfoBean userBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L468">		int payByOrgId = userBean.getUserOrgId();</span>
<span class="nc" id="L469">		int payByUserId = userBean.getUserId();</span>
<span class="nc" id="L470">		String payByOrgName = userBean.getOrgName();</span>
<span class="nc" id="L471">		String rootPath = (String) session.getAttribute(&quot;ROOT_PATH&quot;);</span>
<span class="nc" id="L472">		generatedReceiptNumber = processHelper.payPendingPwt(taskId, pwtAmount,</span>
				taxAmt, netAmt, partyId, partyType, ticketNbr, drawId, panelId,
				gameId, payByOrgId, payByUserId, payByOrgName, paymentType,
				chqNbr, draweeBank, chequeDate, issuiningParty, gameNbr,
				rootPath);
<span class="nc" id="L477">		session.setAttribute(&quot;generatedReceiptNumber&quot;, generatedReceiptNumber);</span>
<span class="nc" id="L478">		return SUCCESS;</span>
	}

	/**
	 * Player registration process
	 * 
	 * @return
	 * @throws LMSException
	 */

	@SuppressWarnings(&quot;unchecked&quot;)
	public String plrRegistrationAndApprovalReq() throws LMSException {
<span class="nc" id="L490">		PlayerBean plrBean = null;</span>
<span class="nc" id="L491">		logger.debug(&quot;plrAlreadyReg = &quot; + plrAlreadyReg + &quot;  , playerType = &quot;</span>
				+ playerType + &quot;  , playerId = &quot; + playerId);
<span class="nc bnc" id="L493" title="All 4 branches missed.">		if(plrCity==null &amp;&amp; city !=null)</span>
<span class="nc" id="L494">			plrCity=city;</span>
<span class="nc bnc" id="L495" title="All 4 branches missed.">		if (!&quot;YES&quot;.equalsIgnoreCase(plrAlreadyReg.trim())</span>
				&amp;&amp; &quot;player&quot;.equalsIgnoreCase(playerType.trim())) {
<span class="nc" id="L497">			plrBean = new PlayerBean();</span>
<span class="nc" id="L498">			plrBean.setFirstName(firstName);</span>
<span class="nc" id="L499">			plrBean.setLastName(lastName);</span>
<span class="nc" id="L500">			plrBean.setIdType(idType);</span>
<span class="nc" id="L501">			plrBean.setIdNumber(idNumber);</span>
<span class="nc" id="L502">			plrBean.setEmailId(emailId);</span>
<span class="nc" id="L503">			plrBean.setPhone(phone);</span>
<span class="nc" id="L504">			plrBean.setPlrAddr1(plrAddr1);</span>
<span class="nc" id="L505">			plrBean.setPlrAddr2(plrAddr2);</span>
<span class="nc" id="L506">			plrBean.setPlrState(state);</span>
<span class="nc" id="L507">			plrBean.setPlrCity(plrCity);</span>
<span class="nc" id="L508">			plrBean.setPlrCountry(plrCountry);</span>
<span class="nc" id="L509">			plrBean.setPlrPin(Long.parseLong(plrPin));</span>
<span class="nc" id="L510">			plrBean.setBankName(bankName);</span>
<span class="nc" id="L511">			plrBean.setBankBranch(bankBranch);</span>
<span class="nc" id="L512">			plrBean.setLocationCity(locationCity);</span>
<span class="nc" id="L513">			plrBean.setBankAccNbr(bankAccNbr);</span>
<span class="nc" id="L514">			logger.debug(&quot;Inside player registration 11111 &amp; plrBean is &quot;</span>
					+ plrBean);
		}

<span class="nc" id="L518">		HttpSession session = request.getSession();</span>
		//PWTDrawBean pwtDrawBean = (PWTDrawBean) session.getAttribute(&quot;PWT_RES&quot;);
<span class="nc" id="L520">	    MainPWTDrawBean pwtDrawBean = (MainPWTDrawBean) session.getAttribute(&quot;PWT_RES&quot;);</span>
<span class="nc" id="L521">		String rootPath = (String) session.getAttribute(&quot;ROOT_PATH&quot;);</span>
<span class="nc" id="L522">		UserInfoBean userInfoBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc bnc" id="L524" title="All 2 branches missed.">		if (userInfoBean == null) {</span>
<span class="nc" id="L525">			throw new LMSException(&quot;userInfoBean = &quot; + userInfoBean);</span>
		}
		// player registration and approval process
<span class="nc" id="L528">		BOPwtProcessHelper helper = new BOPwtProcessHelper();</span>
<span class="nc" id="L529">		logger.debug(&quot;root path is &quot; + rootPath);</span>

<span class="nc" id="L531">		this.pwtAppMap = helper.plrRegistrationAndApproval(userInfoBean,</span>
				pwtDrawBean, playerType, playerId, plrBean, rootPath, false);

<span class="nc bnc" id="L534" title="All 2 branches missed.">		if (plrBean == null) {</span>
<span class="nc" id="L535">			plrBean = (PlayerBean) session.getAttribute(&quot;playerBean&quot;);</span>
		}
<span class="nc" id="L537">		pwtAppMap.put(&quot;plrBean&quot;, plrBean);</span>
<span class="nc" id="L538">		session.setAttribute(&quot;plrPwtAppDetMap&quot;, pwtAppMap);</span>
<span class="nc" id="L539">		session.setAttribute(&quot;PWT_RES&quot;, pwtAppMap.get(&quot;PWT_RES_BEAN&quot;));</span>
<span class="nc" id="L540">		mainPwtBean = pwtDrawBean;</span>
<span class="nc" id="L541">		return SUCCESS;</span>
	}

	public String registerAnyPlayer() throws LMSException {
<span class="nc" id="L545">		PlayerBean plrBean = null;</span>
<span class="nc" id="L546">		boolean isAnonymous = true;</span>
<span class="nc" id="L547">		HttpSession session = request.getSession();</span>
		//PWTDrawBean pwtDrawBean = (PWTDrawBean) session.getAttribute(&quot;PWT_RES&quot;);
<span class="nc" id="L549">		MainPWTDrawBean pwtDrawBean = (MainPWTDrawBean) session.getAttribute(&quot;PWT_RES&quot;);</span>
<span class="nc" id="L550">		String rootPath = (String) session.getAttribute(&quot;ROOT_PATH&quot;);</span>
<span class="nc" id="L551">		UserInfoBean userInfoBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc bnc" id="L553" title="All 2 branches missed.">		if (userInfoBean == null) {</span>
<span class="nc" id="L554">			throw new LMSException(&quot;userInfoBean = &quot; + userInfoBean);</span>
		}
		// player registration and approval process
<span class="nc" id="L557">		BOPwtProcessHelper helper = new BOPwtProcessHelper();</span>
<span class="nc" id="L558">		logger.debug(&quot;root path is &quot; + rootPath);</span>
<span class="nc" id="L559">		this.pwtAppMap = helper.plrRegistrationAndApproval(userInfoBean,</span>
				pwtDrawBean, playerType, playerId, plrBean, rootPath,
				isAnonymous);
<span class="nc" id="L562">		session.setAttribute(&quot;plrPwtAppDetMap&quot;, pwtAppMap);</span>
<span class="nc" id="L563">		session.setAttribute(&quot;PWT_RES&quot;, pwtAppMap.get(&quot;PWT_RES_BEAN&quot;));</span>
<span class="nc" id="L564">		mainPwtBean = pwtDrawBean;</span>
<span class="nc" id="L565">		return SUCCESS;</span>
	}

	public void setAgentOrgId(int agentOrgId) {
<span class="nc" id="L569">		this.agentOrgId = agentOrgId;</span>
<span class="nc" id="L570">	}</span>

	public void setBankAccNbr(String bankAccNbr) {
<span class="nc" id="L573">		this.bankAccNbr = bankAccNbr;</span>
<span class="nc" id="L574">	}</span>

	public void setBankBranch(String bankBranch) {
<span class="nc" id="L577">		this.bankBranch = bankBranch;</span>
<span class="nc" id="L578">	}</span>

	public void setBankName(String bankName) {
<span class="nc" id="L581">		this.bankName = bankName;</span>
<span class="nc" id="L582">	}</span>

	public void setChequeDate(String chequeDate) {
<span class="nc" id="L585">		this.chequeDate = chequeDate;</span>
<span class="nc" id="L586">	}</span>

	public void setChqNbr(String chqNbr) {
<span class="nc" id="L589">		this.chqNbr = chqNbr;</span>
<span class="nc" id="L590">	}</span>

	public void setCountry(String country) {
<span class="nc" id="L593">		this.country = country;</span>
<span class="nc" id="L594">	}</span>

	public void setDenyPwtStatus(String denyPwtStatus) {
<span class="nc" id="L597">		this.denyPwtStatus = denyPwtStatus;</span>
<span class="nc" id="L598">	}</span>

	public void setDraweeBank(String draweeBank) {
<span class="nc" id="L601">		this.draweeBank = draweeBank;</span>
<span class="nc" id="L602">	}</span>

	public void setDrawId(int drawId) {
<span class="nc" id="L605">		this.drawId = drawId;</span>
<span class="nc" id="L606">	}</span>

	public void setEmailId(String emailId) {
<span class="nc" id="L609">		this.emailId = emailId;</span>
<span class="nc" id="L610">	}</span>

	public void setFirstName(String firstName) {
<span class="nc" id="L613">		this.firstName = firstName;</span>
<span class="nc" id="L614">	}</span>

	public void setGameId(int gameId) {
<span class="nc" id="L617">		this.gameId = gameId;</span>
<span class="nc" id="L618">	}</span>

	public void setGameIdNbrName(String gameIdNbrName) {
<span class="nc" id="L621">		this.gameIdNbrName = gameIdNbrName;</span>
<span class="nc" id="L622">	}</span>

	public void setGameNbr(int gameNbr) {
<span class="nc" id="L625">		this.gameNbr = gameNbr;</span>
<span class="nc" id="L626">	}</span>

	public void setGameType(String gameType) {
<span class="nc" id="L629">		this.gameType = gameType;</span>
<span class="nc" id="L630">	}</span>

	public void setGeneratedReceiptNumber(String generatedReceiptNumber) {
<span class="nc" id="L633">		this.generatedReceiptNumber = generatedReceiptNumber;</span>
<span class="nc" id="L634">	}</span>

	public void setIdNumber(String idNumber) {
<span class="nc" id="L637">		this.idNumber = idNumber;</span>
<span class="nc" id="L638">	}</span>

	public void setIdType(String idType) {
<span class="nc" id="L641">		this.idType = idType;</span>
<span class="nc" id="L642">	}</span>

	public void setIssuiningParty(String issuiningParty) {
<span class="nc" id="L645">		this.issuiningParty = issuiningParty;</span>
<span class="nc" id="L646">	}</span>

	public void setLastName(String lastName) {
<span class="nc" id="L649">		this.lastName = lastName;</span>
<span class="nc" id="L650">	}</span>

	public void setLocationCity(String locationCity) {
<span class="nc" id="L653">		this.locationCity = locationCity;</span>
<span class="nc" id="L654">	}</span>

	public void setNetAmt(double netAmt) {
<span class="nc" id="L657">		this.netAmt = netAmt;</span>
<span class="nc" id="L658">	}</span>

	public void setPanelId(String panelId) {
<span class="nc" id="L661">		this.panelId = panelId;</span>
<span class="nc" id="L662">	}</span>

	public void setPartyId(int partyId) {
<span class="nc" id="L665">		this.partyId = partyId;</span>
<span class="nc" id="L666">	}</span>

	public void setPartyType(String partyType) {
<span class="nc" id="L669">		this.partyType = partyType;</span>
<span class="nc" id="L670">	}</span>

	public void setPaymentPendingAt(String paymentPendingAt) {
<span class="nc" id="L673">		this.paymentPendingAt = paymentPendingAt;</span>
<span class="nc" id="L674">	}</span>

	public void setPaymentType(String paymentType) {
<span class="nc" id="L677">		this.paymentType = paymentType;</span>
<span class="nc" id="L678">	}</span>

	public void setPhone(String phone) {
<span class="nc" id="L681">		this.phone = phone;</span>
<span class="nc" id="L682">	}</span>

	public void setPlayerId(int playerId) {
<span class="nc" id="L685">		this.playerId = playerId;</span>
<span class="nc" id="L686">	}</span>

	public void setPlayerType(String playerType) {
<span class="nc" id="L689">		this.playerType = playerType;</span>
<span class="nc" id="L690">	}</span>

	public void setPlrAddr1(String plrAddr1) {
<span class="nc" id="L693">		this.plrAddr1 = plrAddr1;</span>
<span class="nc" id="L694">	}</span>

	public void setPlrAddr2(String plrAddr2) {
<span class="nc" id="L697">		this.plrAddr2 = plrAddr2;</span>
<span class="nc" id="L698">	}</span>

	public void setPlrAlreadyReg(String plrAlreadyReg) {
<span class="nc" id="L701">		this.plrAlreadyReg = plrAlreadyReg;</span>
<span class="nc" id="L702">	}</span>

	public void setPlrCity(String plrCity) {
<span class="nc" id="L705">		this.plrCity = plrCity;</span>
<span class="nc" id="L706">	}</span>

	public void setPlrCountry(String plrCountry) {
<span class="nc" id="L709">		this.plrCountry = plrCountry;</span>
<span class="nc" id="L710">	}</span>

	public void setPlrPin(String plrPin) {
<span class="nc" id="L713">		this.plrPin = plrPin;</span>
<span class="nc" id="L714">	}</span>

	public void setPlrPwtBean(DrawPwtApproveRequestNPlrBean plrPwtBean) {
<span class="nc" id="L717">		this.plrPwtBean = plrPwtBean;</span>
<span class="nc" id="L718">	}</span>

	public void setPwtAmount(double pwtAmount) {
<span class="nc" id="L721">		this.pwtAmount = pwtAmount;</span>
<span class="nc" id="L722">	}</span>

	public void setPwtAppMap(Map pwtAppMap) {
<span class="nc" id="L725">		this.pwtAppMap = pwtAppMap;</span>
<span class="nc" id="L726">	}</span>

	public void setPwtPayDetailsList(
			List&lt;DrawPwtApproveRequestNPlrBean&gt; pwtPayDetailsList) {
<span class="nc" id="L730">		this.pwtPayDetailsList = pwtPayDetailsList;</span>
<span class="nc" id="L731">	}</span>

	public void setPwtReqDetailsList(
			List&lt;DrawPwtApproveRequestNPlrBean&gt; pwtReqDetailsList) {
<span class="nc" id="L735">		this.pwtReqDetailsList = pwtReqDetailsList;</span>
<span class="nc" id="L736">	}</span>

	public void setRequestedById(int requestedById) {
<span class="nc" id="L739">		this.requestedById = requestedById;</span>
<span class="nc" id="L740">	}</span>

	public void setRequesterType(String requesterType) {
<span class="nc" id="L743">		this.requesterType = requesterType;</span>
<span class="nc" id="L744">	}</span>

	public void setRequestId(String requestId) {
<span class="nc" id="L747">		this.requestId = requestId;</span>
<span class="nc" id="L748">	}</span>

	public void setRetOrgId(int retOrgId) {
<span class="nc" id="L751">		this.retOrgId = retOrgId;</span>
<span class="nc" id="L752">	}</span>

	public void setServletRequest(HttpServletRequest request) {
<span class="nc" id="L755">		this.request = request;</span>
<span class="nc" id="L756">	}</span>

	public void setServletResponse(HttpServletResponse response) {
<span class="nc" id="L759">		this.response = response;</span>
<span class="nc" id="L760">	}</span>

	public void setState(String state) {
<span class="nc" id="L763">		this.state = state;</span>
<span class="nc" id="L764">	}</span>

	public void setStatus(String status) {
<span class="nc" id="L767">		this.status = status;</span>
<span class="nc" id="L768">	}</span>

	public void setTaskId(int taskId) {
<span class="nc" id="L771">		this.taskId = taskId;</span>
<span class="nc" id="L772">	}</span>

	public void setTaxAmt(double taxAmt) {
<span class="nc" id="L775">		this.taxAmt = taxAmt;</span>
<span class="nc" id="L776">	}</span>

	public void setTicketNbr(String ticketNbr) {
<span class="nc" id="L779">		this.ticketNbr = ticketNbr;</span>
<span class="nc" id="L780">	}</span>

	public void setTicketNbrDraw(String ticketNbrDraw) {
<span class="nc" id="L783">		this.ticketNbrDraw = ticketNbrDraw;</span>
<span class="nc" id="L784">	}</span>

	public String verifyDirectPlrTicket() throws LMSException {

		try {
<span class="nc" id="L789">			logger.debug(&quot;verifyDirectPlrTicket():88888&quot;);</span>
<span class="nc" id="L790">			String pwtAmtForMasterApproval = (String) ServletActionContext</span>
					.getServletContext().getAttribute(&quot;PWT_APPROVAL_LIMIT&quot;);
<span class="nc" id="L792">			String highPrizeScheme = (String) ServletActionContext</span>
					.getServletContext().getAttribute(
							&quot;DRAW_GAME_HIGH_PRIZE_SCHEME&quot;);
<span class="nc" id="L795">			PWTDrawBean pwtDarwBean = new PWTDrawBean();</span>
<span class="nc" id="L796">			pwtDarwBean.setTicketNo(ticketNbrDraw);</span>

<span class="nc" id="L798">			String returnType = &quot;input&quot;;</span>
<span class="nc" id="L799">			HttpSession session = getRequest().getSession();</span>
<span class="nc" id="L800">			UserInfoBean userInfoBean = (UserInfoBean) session</span>
					.getAttribute(&quot;USER_INFO&quot;);
			// if HIGH HIGH_PRIZE_CRITERIA or HIGH_PRIZE_AMT is NULL
<span class="nc bnc" id="L803" title="All 4 branches missed.">			if (pwtAmtForMasterApproval == null || userInfoBean == null) {</span>
<span class="nc" id="L804">				pwtDarwBean.setStatus(&quot;ERROR&quot;);</span>
<span class="nc" id="L805">				return returnType;</span>
			}
<span class="nc" id="L807">			pwtDarwBean.setPartyId(userInfoBean.getUserOrgId());</span>
<span class="nc" id="L808">			pwtDarwBean.setPartyType(userInfoBean.getUserType());</span>
<span class="nc" id="L809">			BOPwtProcessHelper helper = new BOPwtProcessHelper();</span>
<span class="nc" id="L810">			returnType = helper.verifyAndSaveTicketDirPlr1(userInfoBean,</span>
					pwtAmtForMasterApproval, pwtDarwBean, highPrizeScheme);
<span class="nc" id="L812">			session.setAttribute(&quot;pwtDrawBean&quot;, pwtDarwBean);// set for</span>
			// player
			// registration

<span class="nc" id="L816">			logger.debug(&quot; return type ********************* &quot; + returnType);</span>
<span class="nc" id="L817">			return returnType;</span>

<span class="nc" id="L819">		} catch (Exception e) {</span>
<span class="nc" id="L820">			e.printStackTrace();</span>
<span class="nc" id="L821">			throw new LMSException(e);</span>
		}
	}
/*
	// this method is added by amit on 20/07/10
	public String verifyDirectPlrTicketNo() throws LMSException {
		HttpSession session = request.getSession();
		ServletContext sc = ServletActionContext.getServletContext();
		String pwtAmtForMasterApproval = (String) sc
				.getAttribute(&quot;PWT_APPROVAL_LIMIT&quot;);
		String highPrizeScheme = (String) sc
				.getAttribute(&quot;DRAW_GAME_HIGH_PRIZE_SCHEME&quot;);
		String refMerchantId = (String) sc.getAttribute(&quot;REF_MERCHANT_ID&quot;);
		UserInfoBean userInfoBean = (UserInfoBean) session
				.getAttribute(&quot;USER_INFO&quot;);
		PWTDrawBean drawScheduleBean = new PWTDrawBean();

		drawScheduleBean.setTicketNo(ticketNbr.trim());
		drawScheduleBean.setPartyId(userInfoBean.getUserOrgId());
		drawScheduleBean.setUserId(userInfoBean.getUserId());
		drawScheduleBean.setPartyType(userInfoBean.getUserType());
		drawScheduleBean.setRefMerchantId(refMerchantId);
        
		logger.debug(&quot;*****ticketNbr***&quot; + ticketNbr);
		BOPwtProcessHelper helper = new BOPwtProcessHelper();
		PWTDrawBean pwtWinningBean = helper.verifyAndSaveTicketNoDirPlr(
				drawScheduleBean, userInfoBean, pwtAmtForMasterApproval,
				highPrizeScheme);
		boolean isMasAppReq = true;
		pwtWinningBean.setGameDispName(Util.getGameDisplayName(pwtWinningBean
				.getGameNo()));
		session.setAttribute(&quot;PWT_RES&quot;, pwtWinningBean);
		if (pwtWinningBean.isValid() &amp;&amp; pwtWinningBean.isHighPrize()) {
			session.setAttribute(&quot;PWT_AMT&quot;, pwtWinningBean.getTotalAmount());
			if (&quot;MAS_APP_REQ&quot;.equalsIgnoreCase(pwtWinningBean.getPwtStatus())) {
				isMasAppReq = false;
			}
			session.setAttribute(&quot;isMasAppReq&quot;, isMasAppReq);
			return &quot;registration&quot;;
		} else if (pwtWinningBean.isValid() &amp;&amp; pwtWinningBean.isWinTkt()) {
			String status = registerAnyPlayer();// register the player as
			// anonymous
			if (status.equals(SUCCESS)) {
				return &quot;paySuccess&quot;;
			} else {
				return &quot;error&quot;;
			}
		} else {
			return SUCCESS;
		}

	}
*/	
	public String verifyDirectPlrTicketNo() throws LMSException {

		
<span class="nc" id="L877">		HttpSession session = request.getSession();</span>
<span class="nc" id="L878">		mainPwtBean = new MainPWTDrawBean();</span>
		//boolean isAuth=false;
<span class="nc bnc" id="L880" title="All 4 branches missed.">		if (ticketNbr != null &amp;&amp; CommonValidation.isNumericWithoutDot(ticketNbr, false)){</span>
<span class="nc" id="L881">			mainPwtBean.setTicketNo(ticketNbr.trim());</span>
		}
		else{
<span class="nc" id="L884">			addActionError(&quot;Please Enter valid ticket number.&quot;);</span>
<span class="nc" id="L885">			return &quot;error&quot;;</span>
		}
		

		/*isUnauth=Util.isBoAuthorizedToClaimTicket(ticketNbr);
		session.setAttribute(&quot;isUnAuthorized&quot;, isUnauth);
		if(isUnauth){
			return SUCCESS;
		}*/

<span class="nc" id="L895">		ServletContext sc = ServletActionContext.getServletContext();</span>
<span class="nc" id="L896">		String pwtAmtForMasterApproval = (String) sc.getAttribute(&quot;PWT_APPROVAL_LIMIT&quot;);</span>
<span class="nc" id="L897">		String highPrizeScheme = (String) sc</span>
				.getAttribute(&quot;DRAW_GAME_HIGH_PRIZE_SCHEME&quot;);
<span class="nc" id="L899">		String refMerchantId = (String) sc.getAttribute(&quot;REF_MERCHANT_ID&quot;);</span>
<span class="nc" id="L900">		String highPrizeAmt = (String) LMSUtility.sc.getAttribute(&quot;HIGH_PRIZE_AMT&quot;);</span>
<span class="nc" id="L901">		UserInfoBean userInfoBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);
<span class="nc" id="L903">		logger.debug(&quot;*****ticketNbr***&quot; + ticketNbr);</span>
<span class="nc" id="L904">		BOPwtProcessHelper helper = new BOPwtProcessHelper();</span>
<span class="nc" id="L905">		MainPWTDrawBean pwtWinningBean = helper.newMethod(mainPwtBean,</span>
				userInfoBean, pwtAmtForMasterApproval, highPrizeScheme,
				refMerchantId,highPrizeAmt);

<span class="nc" id="L909">		boolean isMasAppReq = true;</span>
<span class="nc" id="L910">		session.setAttribute(&quot;PWT_RES&quot;, pwtWinningBean);</span>
<span class="nc bnc" id="L911" title="All 2 branches missed.">		if(pwtWinningBean.getWinningBeanList() != null) {</span>
<span class="nc bnc" id="L912" title="All 2 branches missed.">			for(PWTDrawBean pwtDrawBean : pwtWinningBean.getWinningBeanList()) {</span>
<span class="nc bnc" id="L913" title="All 2 branches missed.">				if(pwtDrawBean.getDrawWinList() != null) {</span>
<span class="nc bnc" id="L914" title="All 2 branches missed.">					for(DrawIdBean drawIdBean : pwtDrawBean.getDrawWinList()) {</span>
<span class="nc bnc" id="L915" title="All 4 branches missed.">						if(drawIdBean.getRankId() == 4 &amp;&amp; &quot;TwelveByTwentyFour&quot;.equals(Util.getGameName(pwtWinningBean.getGameId()))) {</span>
<span class="nc" id="L916">							return &quot;rank4&quot;;</span>
						}
<span class="nc" id="L918">					}</span>
				}
<span class="nc" id="L920">			}</span>
		}
		
<span class="nc bnc" id="L923" title="All 4 branches missed.">		if (pwtWinningBean.isValid() &amp;&amp; pwtWinningBean.isHighPrize()) {</span>
<span class="nc" id="L924">			session.setAttribute(&quot;PWT_AMT&quot;, pwtWinningBean.getTotlticketAmount());</span>
<span class="nc bnc" id="L925" title="All 2 branches missed.">			if (&quot;MAS_APP_REQ&quot;.equalsIgnoreCase(pwtWinningBean.getPwtStatus())) {</span>
<span class="nc" id="L926">				isMasAppReq = false;</span>
			}
<span class="nc" id="L928">			session.setAttribute(&quot;isMasAppReq&quot;, isMasAppReq);</span>
<span class="nc" id="L929">			return &quot;registration&quot;;</span>
<span class="nc bnc" id="L930" title="All 4 branches missed.">		} else if (pwtWinningBean.isValid() &amp;&amp; pwtWinningBean.isWinTkt()) {</span>
<span class="nc" id="L931">			String status = registerAnyPlayer();// register the player as</span>
			// anonymous
<span class="nc bnc" id="L933" title="All 2 branches missed.">			if (status.equals(SUCCESS)) {</span>
<span class="nc" id="L934">				return &quot;paySuccess&quot;;</span>
			} else {
<span class="nc" id="L936">				return &quot;error&quot;;</span>
			}
		} else {
<span class="nc" id="L939">			return SUCCESS;</span>
		}

	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>