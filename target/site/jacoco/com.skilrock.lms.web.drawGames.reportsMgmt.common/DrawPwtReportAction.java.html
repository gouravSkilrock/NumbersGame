<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DrawPwtReportAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.web.drawGames.reportsMgmt.common</a> &gt; <span class="el_source">DrawPwtReportAction.java</span></div><h1>DrawPwtReportAction.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.web.drawGames.reportsMgmt.common;

import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.PrintWriter;
import java.sql.SQLException;
import java.sql.Timestamp;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.TreeMap;

import javax.servlet.ServletContext;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import jxl.Workbook;
import jxl.write.WritableWorkbook;
import net.sf.json.JSONObject;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.struts2.interceptor.ServletRequestAware;
import org.apache.struts2.interceptor.ServletResponseAware;

import com.opensymphony.xwork2.ActionContext;
import com.opensymphony.xwork2.ActionSupport;
import com.skilrock.lms.beans.ReportStatusBean;
import com.skilrock.lms.beans.SalePwtReportsBean;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.filter.LMSFilterDispatcher;
import com.skilrock.lms.common.utility.CommonMethods;
import com.skilrock.lms.coreEngine.drawGames.reportMgmt.DrawPwtReportHelper;
import com.skilrock.lms.coreEngine.drawGames.reportMgmt.DrawPwtReportHelperSP;
import com.skilrock.lms.coreEngine.drawGames.reportMgmt.IDrawPwtReportHelper;
import com.skilrock.lms.web.reportsMgmt.common.ReportUtility;

<span class="nc" id="L44">public class DrawPwtReportAction extends ActionSupport implements</span>
		ServletRequestAware, ServletResponseAware {
	private static final long serialVersionUID = 1L;
	private int agentOrgId;
	private String end_Date;
<span class="nc" id="L49">	Log logger = LogFactory.getLog(DrawPwtReportAction.class);</span>
	private String reportType;
	private HttpServletRequest request;
	private HttpServletResponse response;
	private String start_date;
	private String lastDate;
	private String countryCode;
	private String stateCode;
	private String cityCode;
	private Map&lt;String, String&gt; stateMap;

	public String getCountryCode() {
<span class="nc" id="L61">		return countryCode;</span>
	}

	public void setCountryCode(String countryCode) {
<span class="nc" id="L65">		this.countryCode = countryCode;</span>
<span class="nc" id="L66">	}</span>

	public String getStateCode() {
<span class="nc" id="L69">		return stateCode;</span>
	}

	public void setStateCode(String stateCode) {
<span class="nc" id="L73">		this.stateCode = stateCode;</span>
<span class="nc" id="L74">	}</span>

	public String getCityCode() {
<span class="nc" id="L77">		return cityCode;</span>
	}

	public void setCityCode(String cityCode) {
<span class="nc" id="L81">		this.cityCode = cityCode;</span>
<span class="nc" id="L82">	}</span>

	public Map&lt;String, String&gt; getStateMap() {
<span class="nc" id="L85">		return stateMap;</span>
	}

	public void setStateMap(Map&lt;String, String&gt; stateMap) {
<span class="nc" id="L89">		this.stateMap = stateMap;</span>
<span class="nc" id="L90">	}</span>

	public void fetchStateList() {
<span class="nc" id="L93">		stateMap = CommonMethods.fetchStateList();</span>
<span class="nc" id="L94">	}</span>
	
	@Override
	public String execute() throws Exception {
<span class="nc" id="L98">		String actionName = ActionContext.getContext().getName();</span>
<span class="nc" id="L99">		ReportStatusBean reportStatusBean = ReportUtility.getReportStatus(actionName);</span>

<span class="nc" id="L101">		fetchStateList();</span>

<span class="nc bnc" id="L103" title="All 2 branches missed.">		if(&quot;SUCCESS&quot;.equals(reportStatusBean.getReportStatus())) {</span>
<span class="nc" id="L104">			return SUCCESS;</span>
		} else {
<span class="nc" id="L106">			return &quot;RESULT_TIMING_RESTRICTION&quot;;</span>
		}
	}

	public void getCityList() throws Exception {
<span class="nc" id="L111">		Map&lt;String, String&gt; cityMap = CommonMethods.fetchCityListStateWise(stateCode);</span>

<span class="nc" id="L113">		PrintWriter out = response.getWriter();</span>

<span class="nc" id="L115">		JSONObject jsonObject = new JSONObject();</span>

<span class="nc" id="L117">		jsonObject.put(&quot;isSuccess&quot;, true);</span>
<span class="nc" id="L118">		jsonObject.put(&quot;cityMap&quot;, cityMap);</span>
<span class="nc" id="L119">		out.print(jsonObject);</span>
<span class="nc" id="L120">		out.flush();</span>
<span class="nc" id="L121">		out.close();</span>
<span class="nc" id="L122">	}</span>

	public List&lt;SalePwtReportsBean&gt; fetchReportAgentWise(Timestamp startDate,
			Timestamp endDate, String stateCode, String cityCode, ReportStatusBean reportStatusBean) throws SQLException {
<span class="nc" id="L126">		IDrawPwtReportHelper helper = null;</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">		if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L128">			helper = new DrawPwtReportHelperSP();</span>
		}else{
<span class="nc" id="L130">			helper = new DrawPwtReportHelper();</span>
		}
<span class="nc" id="L132">		List&lt;SalePwtReportsBean&gt; reportList = null;</span>
<span class="nc" id="L133">		reportList = helper.drawPwtAgentWise(startDate, endDate, stateCode, cityCode, reportStatusBean);</span>
<span class="nc" id="L134">		HttpSession session = request.getSession();</span>
<span class="nc" id="L135">		session.setAttribute(&quot;orgName&quot;, ((UserInfoBean)session.getAttribute(&quot;USER_INFO&quot;)).getOrgName());</span>
		try{
<span class="nc" id="L137">			session.setAttribute(&quot;orgAdd&quot;,helper.getOrgAdd(((UserInfoBean)session.getAttribute(&quot;USER_INFO&quot;)).getUserOrgId()));</span>
		}
<span class="nc" id="L139">		catch(LMSException ex){</span>
<span class="nc" id="L140">			ex.printStackTrace();</span>
<span class="nc" id="L141">		}</span>
<span class="nc" id="L142">		logger.info(&quot;---reportList---&quot; + reportList);</span>
<span class="nc" id="L143">		return reportList;</span>
	}

	public List&lt;SalePwtReportsBean&gt; fetchReportAgentWiseExpand(
			Timestamp startDate, Timestamp endDate, ReportStatusBean reportStatusBean) throws SQLException {
<span class="nc" id="L148">		logger.info(&quot;------Agent Org Id---&quot; + agentOrgId);</span>
<span class="nc" id="L149">		IDrawPwtReportHelper helper = null;</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">		if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L151">			helper = new DrawPwtReportHelperSP();</span>
		}else{
<span class="nc" id="L153">			helper = new DrawPwtReportHelper();</span>
		}
<span class="nc" id="L155">		List&lt;SalePwtReportsBean&gt; reportList = null;</span>
<span class="nc" id="L156">		reportList = helper.drawPwtAgentWiseExpand(startDate, endDate, agentOrgId, reportStatusBean);</span>
<span class="nc" id="L157">		HttpSession session = request.getSession();</span>
<span class="nc" id="L158">		session.setAttribute(&quot;orgName&quot;, ((UserInfoBean)session.getAttribute(&quot;USER_INFO&quot;)).getOrgName());</span>
		try{
<span class="nc" id="L160">			session.setAttribute(&quot;orgAdd&quot;,helper.getOrgAdd(((UserInfoBean)session.getAttribute(&quot;USER_INFO&quot;)).getUserOrgId()));</span>
		}
<span class="nc" id="L162">		catch(LMSException ex){</span>
<span class="nc" id="L163">			ex.printStackTrace();</span>
<span class="nc" id="L164">		}</span>
<span class="nc" id="L165">		logger.info(&quot;---reportList---&quot; + reportList);</span>
<span class="nc" id="L166">		return reportList;</span>
	}

	public List&lt;SalePwtReportsBean&gt; fetchReportGameWise(Timestamp startDate,
			Timestamp endDate, ReportStatusBean reportStatusBean, String cityCode, String stateCode) throws SQLException {
<span class="nc" id="L171">		IDrawPwtReportHelper helper = null;</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">		if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L173">			helper = new DrawPwtReportHelperSP();</span>
		}else{
<span class="nc" id="L175">			helper = new DrawPwtReportHelper();</span>
		}
<span class="nc" id="L177">		List&lt;SalePwtReportsBean&gt; reportList = null;</span>
<span class="nc" id="L178">		reportList = helper.drawPwtGameWise(startDate, endDate, reportStatusBean, cityCode, stateCode);</span>
<span class="nc" id="L179">		HttpSession session = request.getSession();</span>
<span class="nc" id="L180">		session.setAttribute(&quot;orgName&quot;, ((UserInfoBean)session.getAttribute(&quot;USER_INFO&quot;)).getOrgName());</span>
		try{
<span class="nc" id="L182">			session.setAttribute(&quot;orgAdd&quot;,helper.getOrgAdd(((UserInfoBean)session.getAttribute(&quot;USER_INFO&quot;)).getUserOrgId()));</span>
		}
<span class="nc" id="L184">		catch(LMSException ex){</span>
<span class="nc" id="L185">			ex.printStackTrace();</span>
<span class="nc" id="L186">		}</span>
<span class="nc" id="L187">		logger.info(&quot;---reportList---&quot; + reportList);</span>
<span class="nc" id="L188">		return reportList;</span>
	}

	public List&lt;SalePwtReportsBean&gt; fetchReportGameWiseExpand(
			Timestamp startDate, Timestamp endDate, ReportStatusBean reportStatusBean) throws SQLException {
<span class="nc" id="L193">		IDrawPwtReportHelper helper = null;</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">		if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L195">			helper = new DrawPwtReportHelperSP();</span>
		}else{
<span class="nc" id="L197">			helper = new DrawPwtReportHelper();</span>
		}
<span class="nc" id="L199">		List&lt;SalePwtReportsBean&gt; reportList = null;</span>
<span class="nc" id="L200">		reportList = helper.drawPwtGameWiseExpand(startDate, endDate, reportStatusBean);</span>
<span class="nc" id="L201">		HttpSession session = request.getSession();</span>
<span class="nc" id="L202">		session.setAttribute(&quot;orgName&quot;, ((UserInfoBean)session.getAttribute(&quot;USER_INFO&quot;)).getOrgName());</span>
		try{
<span class="nc" id="L204">			session.setAttribute(&quot;orgAdd&quot;,helper.getOrgAdd(((UserInfoBean)session.getAttribute(&quot;USER_INFO&quot;)).getUserOrgId()));</span>
		}
<span class="nc" id="L206">		catch(LMSException ex){</span>
<span class="nc" id="L207">			ex.printStackTrace();</span>
<span class="nc" id="L208">		}</span>
<span class="nc" id="L209">		logger.info(&quot;---reportList---&quot; + reportList);</span>
<span class="nc" id="L210">		return reportList;</span>
	}
	
	public List&lt;SalePwtReportsBean&gt; fetchReportGameWiseForAgent(Timestamp startDate,
			Timestamp endDate, ReportStatusBean reportStatusBean) throws SQLException {
<span class="nc" id="L215">		IDrawPwtReportHelper helper = null;</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">		if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L217">			helper =  new DrawPwtReportHelperSP();</span>
		}else{
<span class="nc" id="L219">			helper = new DrawPwtReportHelper();</span>
		}
<span class="nc" id="L221">		List&lt;SalePwtReportsBean&gt; reportList = null;</span>
<span class="nc" id="L222">		reportList = helper.drawPwtGameWiseForAgent(startDate, endDate, agentOrgId, reportStatusBean);</span>
<span class="nc" id="L223">		HttpSession session = request.getSession();</span>
<span class="nc" id="L224">		session.setAttribute(&quot;orgName&quot;, ((UserInfoBean)session.getAttribute(&quot;USER_INFO&quot;)).getOrgName());</span>
		try{
<span class="nc" id="L226">			session.setAttribute(&quot;orgAdd&quot;,helper.getOrgAdd(((UserInfoBean)session.getAttribute(&quot;USER_INFO&quot;)).getUserOrgId()));</span>
		}
<span class="nc" id="L228">		catch(LMSException ex){</span>
<span class="nc" id="L229">			ex.printStackTrace();</span>
<span class="nc" id="L230">		}</span>
<span class="nc" id="L231">		logger.info(&quot;---reportList---&quot; + reportList);</span>
<span class="nc" id="L232">		return reportList;</span>
	}
	
	public List&lt;SalePwtReportsBean&gt; fetchReportGameWiseExpandForAgent(
			Timestamp startDate, Timestamp endDate, ReportStatusBean reportStatusBean) throws SQLException {
<span class="nc" id="L237">		IDrawPwtReportHelper helper = null;</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">		if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L239">			helper = new DrawPwtReportHelperSP();</span>
		}else{
<span class="nc" id="L241">			helper = new DrawPwtReportHelper();</span>
		}
<span class="nc" id="L243">		List&lt;SalePwtReportsBean&gt; reportList = null;</span>
<span class="nc" id="L244">		reportList = helper.drawPwtGameWiseExpandForAgent(startDate, endDate, agentOrgId, reportStatusBean);</span>
<span class="nc" id="L245">		HttpSession session = request.getSession();</span>
<span class="nc" id="L246">		session.setAttribute(&quot;orgName&quot;, ((UserInfoBean)session.getAttribute(&quot;USER_INFO&quot;)).getOrgName());</span>
		try{
<span class="nc" id="L248">			session.setAttribute(&quot;orgAdd&quot;,helper.getOrgAdd(((UserInfoBean)session.getAttribute(&quot;USER_INFO&quot;)).getUserOrgId()));</span>
		}
<span class="nc" id="L250">		catch(LMSException ex){</span>
<span class="nc" id="L251">			ex.printStackTrace();</span>
<span class="nc" id="L252">		}</span>
<span class="nc" id="L253">		logger.info(&quot;---reportList---&quot; + reportList);</span>
<span class="nc" id="L254">		return reportList;</span>
	}
	
	public List&lt;SalePwtReportsBean&gt; fetchReportGameWiseBODirPly(Timestamp startDate,
			Timestamp endDate, ReportStatusBean reportStatusBean) throws SQLException {
<span class="nc" id="L259">		IDrawPwtReportHelper helper = null;</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">		if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L261">			helper = new DrawPwtReportHelperSP();</span>
		}else{
<span class="nc" id="L263">			helper = new DrawPwtReportHelper();</span>
		}
<span class="nc" id="L265">		List&lt;SalePwtReportsBean&gt; reportList = null;</span>
<span class="nc" id="L266">		reportList = helper.drawBODirPlyPwtGameWise(startDate, endDate, reportStatusBean);</span>
<span class="nc" id="L267">		logger.info(&quot;---reportList---&quot; + reportList);</span>
<span class="nc" id="L268">		return reportList;</span>
	}
	
	public List&lt;SalePwtReportsBean&gt; fetchReportGameWiseAgentDirPly(Timestamp startDate,
			Timestamp endDate, ReportStatusBean reportStatusBean) throws SQLException {
<span class="nc" id="L273">		IDrawPwtReportHelper helper = null;</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">		if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L275">			helper = new DrawPwtReportHelperSP();</span>
		}else{
<span class="nc" id="L277">			helper = new DrawPwtReportHelper();</span>
		}
<span class="nc" id="L279">		List&lt;SalePwtReportsBean&gt; reportList = null;</span>
<span class="nc" id="L280">		reportList = helper.drawAgentDirPlyPwtGameWise(startDate, endDate, agentOrgId, reportStatusBean);</span>
<span class="nc" id="L281">		logger.info(&quot;---reportList---&quot; + reportList);</span>
<span class="nc" id="L282">		return reportList;</span>
	}
	
	public List&lt;SalePwtReportsBean&gt; fetchReportGameWiseBODirPlyExpand(Timestamp startDate,
			Timestamp endDate, ReportStatusBean reportStatusBean) throws SQLException {
<span class="nc" id="L287">		IDrawPwtReportHelper helper = null;</span>
<span class="nc bnc" id="L288" title="All 2 branches missed.">		if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L289">			helper = new DrawPwtReportHelperSP();</span>
		}else{
<span class="nc" id="L291">			helper = new DrawPwtReportHelper();</span>
		}
<span class="nc" id="L293">		List&lt;SalePwtReportsBean&gt; reportList = null;</span>
<span class="nc" id="L294">		reportList = helper.drawBODirPlyPwtGameWiseExpand(startDate, endDate, reportStatusBean);</span>
<span class="nc" id="L295">		logger.info(&quot;---reportList---&quot; + reportList);</span>
<span class="nc" id="L296">		return reportList;</span>
	}
	
	public List&lt;SalePwtReportsBean&gt; fetchReportGameWiseAgentDirPlyExpand(Timestamp startDate,
			Timestamp endDate, ReportStatusBean reportStatusBean) throws SQLException {
<span class="nc" id="L301">		IDrawPwtReportHelper helper = null;</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">		if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L303">			helper = new DrawPwtReportHelperSP();</span>
		}else{
<span class="nc" id="L305">			helper = new DrawPwtReportHelper();</span>
		}
<span class="nc" id="L307">		List&lt;SalePwtReportsBean&gt; reportList = null;</span>
<span class="nc" id="L308">		reportList = helper.drawAgentDirPlyPwtGameWiseExpand(startDate, endDate, agentOrgId, reportStatusBean);</span>
<span class="nc" id="L309">		logger.info(&quot;---reportList---&quot; + reportList);</span>
<span class="nc" id="L310">		return reportList;</span>
	}

	public int getAgentOrgId() {
<span class="nc" id="L314">		return agentOrgId;</span>
	}

	public String getEnd_Date() {
<span class="nc" id="L318">		return end_Date;</span>
	}

	public String getReportType() {
<span class="nc" id="L322">		return reportType;</span>
	}

	public HttpServletRequest getRequest() {
<span class="nc" id="L326">		return request;</span>
	}

	public HttpServletResponse getResponse() {
<span class="nc" id="L330">		return response;</span>
	}

	public String getStart_date() {
<span class="nc" id="L334">		return start_date;</span>
	}
	public String getLastDate()
	{
<span class="nc" id="L338">		return lastDate;</span>
	}
	public String search() throws LMSException {
<span class="nc" id="L341">		HttpSession session = request.getSession();</span>
<span class="nc" id="L342">		ServletContext sc = session.getServletContext();</span>
<span class="nc" id="L343">		String dateFormat = (String) sc.getAttribute(&quot;date_format&quot;);</span>
<span class="nc" id="L344">		Timestamp startDate = null;</span>
<span class="nc" id="L345">		Timestamp endDate = null;</span>
		try {
<span class="nc" id="L347">			String actionName = ActionContext.getContext().getName();</span>
<span class="nc" id="L348">			ReportStatusBean reportStatusBean = ReportUtility.getReportStatus(actionName);</span>

<span class="nc bnc" id="L350" title="All 2 branches missed.">			if(&quot;SUCCESS&quot;.equals(reportStatusBean.getReportStatus())) {</span>

<span class="nc bnc" id="L352" title="All 2 branches missed.">				if (stateCode == null)</span>
<span class="nc" id="L353">					stateCode = &quot;ALL&quot;;</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">				if (cityCode == null)</span>
<span class="nc" id="L355">					cityCode = &quot;ALL&quot;;</span>

<span class="nc bnc" id="L357" title="All 4 branches missed.">				if (start_date != null &amp;&amp; end_Date != null) {</span>
<span class="nc" id="L358">					startDate = new Timestamp((new SimpleDateFormat(dateFormat))</span>
							.parse(start_date).getTime());
<span class="nc" id="L360">					endDate = new Timestamp((new SimpleDateFormat(dateFormat))</span>
							.parse(end_Date).getTime()
							+ 24 * 60 * 60 * 1000 - 1000);
<span class="nc" id="L363">					session.setAttribute(&quot;reportList&quot;, null);</span>
<span class="nc bnc" id="L364" title="All 2 branches missed.">					if (&quot;Game Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L365">						session.setAttribute(&quot;reportList&quot;, fetchReportGameWise(</span>
								startDate, endDate, reportStatusBean, cityCode, stateCode));
<span class="nc" id="L367">						session.setAttribute(&quot;excelData&quot;,</span>
								(List&lt;SalePwtReportsBean&gt;) session
										.getAttribute(&quot;reportList&quot;));
<span class="nc" id="L370">						return &quot;GAME_WISE&quot;;</span>
<span class="nc bnc" id="L371" title="All 2 branches missed.">					} else if (&quot;Agent Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L372">						session.setAttribute(&quot;reportList&quot;, fetchReportAgentWise(</span>
								startDate, endDate, stateCode, cityCode, reportStatusBean));
<span class="nc" id="L374">						session.setAttribute(&quot;excelData&quot;,</span>
								(List&lt;SalePwtReportsBean&gt;) session
										.getAttribute(&quot;reportList&quot;));
<span class="nc" id="L377">						session.setAttribute(&quot;reportListBODirPly&quot;,</span>
								fetchReportGameWiseBODirPly(startDate, endDate, reportStatusBean));
<span class="nc" id="L379">						session.setAttribute(&quot;excelDataDirPlr&quot;,</span>
								(List&lt;SalePwtReportsBean&gt;) session
										.getAttribute(&quot;reportListBODirPly&quot;));
<span class="nc" id="L382">						return &quot;AGENT_WISE&quot;;</span>
<span class="nc bnc" id="L383" title="All 2 branches missed.">					} else if (&quot;Retailer Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L384">						session.setAttribute(&quot;reportList&quot;, fetchReportRetailerWise(</span>
								startDate, endDate, stateCode, cityCode, reportStatusBean));
<span class="nc" id="L386">						session.setAttribute(&quot;excelData&quot;,</span>
								(List&lt;SalePwtReportsBean&gt;) session
										.getAttribute(&quot;reportList&quot;));
<span class="nc" id="L389">						session.setAttribute(&quot;reportListBODirPly&quot;,</span>
								fetchReportGameWiseAgentDirPly(startDate, endDate, reportStatusBean));
<span class="nc" id="L391">						session.setAttribute(&quot;excelDataDirPlr&quot;,</span>
								(List&lt;SalePwtReportsBean&gt;) session
										.getAttribute(&quot;reportListBODirPly&quot;));
<span class="nc" id="L394">						return &quot;RETAILER_WISE&quot;;</span>
					}
				}
				else{
<span class="nc" id="L398">					return NONE;</span>
				}
			} else {
<span class="nc" id="L401">				return &quot;RESULT_TIMING_RESTRICTION&quot;;</span>
			}
<span class="nc" id="L403">		} catch (Exception e) {</span>
<span class="nc" id="L404">			e.printStackTrace();</span>
<span class="nc" id="L405">			throw new LMSException(&quot;Date Format Error&quot;);</span>
<span class="nc" id="L406">		}</span>
<span class="nc" id="L407">		return ERROR;</span>
	}
	
	public String searchByAgent() throws LMSException {
<span class="nc" id="L411">		HttpSession session = request.getSession();</span>
<span class="nc" id="L412">		ServletContext sc = session.getServletContext();</span>
<span class="nc" id="L413">		String dateFormat = (String) sc.getAttribute(&quot;date_format&quot;);</span>
<span class="nc" id="L414">		Timestamp startDate = null;</span>
<span class="nc" id="L415">		Timestamp endDate = null;</span>
		try {
<span class="nc" id="L417">			String actionName = ActionContext.getContext().getName();</span>
<span class="nc" id="L418">			ReportStatusBean reportStatusBean = ReportUtility.getReportStatus(actionName);</span>

<span class="nc bnc" id="L420" title="All 2 branches missed.">			if(&quot;SUCCESS&quot;.equals(reportStatusBean.getReportStatus())) {</span>
<span class="nc bnc" id="L421" title="All 4 branches missed.">				if (start_date != null &amp;&amp; end_Date != null) {</span>
<span class="nc" id="L422">				startDate = new Timestamp((new SimpleDateFormat(dateFormat)).parse(</span>
						start_date).getTime());
<span class="nc" id="L424">				endDate = new Timestamp((new SimpleDateFormat(dateFormat)).parse(</span>
						end_Date).getTime()
						+ 24 * 60 * 60 * 1000 - 1000);
<span class="nc" id="L427">				session.setAttribute(&quot;reportList&quot;, null);</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">				if (&quot;Game Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L429">					session.setAttribute(&quot;reportList&quot;, fetchReportGameWiseForAgent(startDate, endDate, reportStatusBean));</span>
<span class="nc" id="L430">					session.setAttribute(&quot;excelData&quot;, (List&lt;SalePwtReportsBean&gt;)session.getAttribute(&quot;reportList&quot;));</span>
<span class="nc" id="L431">					return &quot;GAME_WISE&quot;;</span>
<span class="nc bnc" id="L432" title="All 2 branches missed.">				} else if (&quot;Retailer Wise&quot;.equals(reportType)) {</span>
<span class="nc" id="L433">					session.setAttribute(&quot;reportList&quot;, fetchReportRetailerWise(startDate, endDate, &quot;ALL&quot;, &quot;ALL&quot;, reportStatusBean));</span>
<span class="nc" id="L434">					session.setAttribute(&quot;excelData&quot;, (List&lt;SalePwtReportsBean&gt;)session.getAttribute(&quot;reportList&quot;));</span>
<span class="nc" id="L435">					session.setAttribute(&quot;reportListBODirPly&quot;, fetchReportGameWiseAgentDirPly(startDate, endDate, reportStatusBean));</span>
<span class="nc" id="L436">					session.setAttribute(&quot;excelDataDirPlr&quot;, (List&lt;SalePwtReportsBean&gt;)session.getAttribute(&quot;reportListBODirPly&quot;));</span>
<span class="nc" id="L437">					return &quot;RETAILER_WISE&quot;;</span>
				}
			} else {
<span class="nc" id="L440">				return &quot;RESULT_TIMING_RESTRICTION&quot;;</span>
			}
		}
<span class="nc" id="L443">		} catch (Exception e) {</span>
<span class="nc" id="L444">			e.printStackTrace();</span>
<span class="nc" id="L445">			throw new LMSException(&quot;Date Format Error&quot;);</span>
<span class="nc" id="L446">		}</span>
<span class="nc" id="L447">		return ERROR;</span>
	}

	public String searchExpand() throws LMSException {
<span class="nc" id="L451">		HttpSession session = request.getSession();</span>
<span class="nc" id="L452">		ServletContext sc = session.getServletContext();</span>
<span class="nc" id="L453">		String dateFormat = (String) sc.getAttribute(&quot;date_format&quot;);</span>
<span class="nc" id="L454">		Timestamp startDate = null;</span>
<span class="nc" id="L455">		Timestamp endDate = null;</span>
<span class="nc" id="L456">		boolean isExpand = false;</span>
		try {
<span class="nc" id="L458">			String actionName = ActionContext.getContext().getName();</span>
<span class="nc" id="L459">			ReportStatusBean reportStatusBean = ReportUtility.getReportStatus(actionName);</span>

<span class="nc bnc" id="L461" title="All 2 branches missed.">			if(&quot;SUCCESS&quot;.equals(reportStatusBean.getReportStatus())) {</span>
<span class="nc bnc" id="L462" title="All 2 branches missed.">				if(stateCode == null)</span>
<span class="nc" id="L463">					stateCode = &quot;ALL&quot;;</span>
<span class="nc bnc" id="L464" title="All 2 branches missed.">				if(cityCode == null)</span>
<span class="nc" id="L465">					cityCode = &quot;ALL&quot;;</span>

<span class="nc" id="L467">				startDate = new Timestamp((new SimpleDateFormat(dateFormat)).parse(</span>
						start_date).getTime());
<span class="nc" id="L469">				endDate = new Timestamp((new SimpleDateFormat(dateFormat)).parse(</span>
						end_Date).getTime()
						+ 24 * 60 * 60 * 1000 - 1000);
<span class="nc" id="L472">				session.setAttribute(&quot;reportList&quot;, null);</span>
<span class="nc" id="L473">				lastDate = CommonMethods.getLastArchDate();</span>
<span class="nc" id="L474">				System.out.println(&quot;last archieve date&quot;+lastDate);</span>
<span class="nc" id="L475">				SimpleDateFormat formatOld = new SimpleDateFormat(&quot;dd-MM-yyyy&quot;);</span>
<span class="nc" id="L476">				Date oldDate = formatOld.parse(start_date);</span>
<span class="nc" id="L477">				System.out.println(&quot;last archieve date&quot;+lastDate);</span>
<span class="nc" id="L478">				Calendar calStart = Calendar.getInstance();</span>
<span class="nc" id="L479">				Calendar calLast = Calendar.getInstance();</span>
<span class="nc" id="L480">				SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L481">				Date devLastDate = format.parse(lastDate);</span>
<span class="nc" id="L482">				Date devStartDate = format.parse(format.format(oldDate));</span>
<span class="nc" id="L483">				calStart.setTime(devStartDate);</span>
<span class="nc" id="L484">				calLast.setTime(devLastDate);</span>
<span class="nc bnc" id="L485" title="All 4 branches missed.">				if(calStart.before(calLast) || calStart.equals(calLast))</span>
				{
<span class="nc" id="L487">					isExpand = false;</span>
				}
<span class="nc bnc" id="L489" title="All 2 branches missed.">				else if(calStart.after(calLast))</span>
				{
<span class="nc" id="L491">					isExpand = true;</span>
				}
<span class="nc" id="L493">				session.setAttribute(&quot;isExpand&quot;, isExpand);</span>
<span class="nc bnc" id="L494" title="All 2 branches missed.">				if (&quot;Game Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L495">					session.setAttribute(&quot;reportList&quot;, fetchReportGameWiseExpand(</span>
							startDate, endDate, reportStatusBean));
<span class="nc" id="L497">					return SUCCESS;</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">				} else if (&quot;Agent Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L499">					session.setAttribute(&quot;reportList&quot;, fetchReportAgentWiseExpand(</span>
							startDate, endDate, reportStatusBean));
<span class="nc" id="L501">					return SUCCESS;</span>
<span class="nc bnc" id="L502" title="All 2 branches missed.">				} else if (&quot;BO Wise Expand&quot;.equals(reportType)){</span>
<span class="nc" id="L503">					session.setAttribute(&quot;reportList&quot;, fetchReportGameWiseBODirPlyExpand(</span>
							startDate, endDate, reportStatusBean));
<span class="nc" id="L505">					return SUCCESS;</span>
				}
<span class="nc" id="L507">			} else {</span>
<span class="nc" id="L508">				return &quot;RESULT_TIMING_RESTRICTION&quot;;</span>
			}
<span class="nc" id="L510">		} catch (Exception e) {</span>
<span class="nc" id="L511">			e.printStackTrace();</span>
<span class="nc" id="L512">			throw new LMSException(&quot;Date Format Error&quot;);</span>
<span class="nc" id="L513">		}</span>
<span class="nc" id="L514">		return ERROR;</span>
	}
	
	public String searchExpandByAgent() throws LMSException {
<span class="nc" id="L518">		HttpSession session = request.getSession();</span>
<span class="nc" id="L519">		ServletContext sc = session.getServletContext();</span>
<span class="nc" id="L520">		String dateFormat = (String) sc.getAttribute(&quot;date_format&quot;);</span>
<span class="nc" id="L521">		Timestamp startDate = null;</span>
<span class="nc" id="L522">		Timestamp endDate = null;</span>
<span class="nc" id="L523">		boolean isExpand = false;</span>
		try {
<span class="nc" id="L525">			String actionName = ActionContext.getContext().getName();</span>
<span class="nc" id="L526">			ReportStatusBean reportStatusBean = ReportUtility.getReportStatus(actionName);</span>

<span class="nc bnc" id="L528" title="All 2 branches missed.">			if(&quot;SUCCESS&quot;.equals(reportStatusBean.getReportStatus())) {</span>
				
<span class="nc bnc" id="L530" title="All 4 branches missed.">				if(stateCode == null || stateCode.trim().isEmpty())</span>
<span class="nc" id="L531">					stateCode = &quot;ALL&quot;;</span>
<span class="nc bnc" id="L532" title="All 4 branches missed.">				if(cityCode == null || cityCode.trim().isEmpty())</span>
<span class="nc" id="L533">					cityCode = &quot;ALL&quot;;</span>

<span class="nc" id="L535">				startDate = new Timestamp((new SimpleDateFormat(dateFormat)).parse(</span>
						start_date).getTime());
<span class="nc" id="L537">				endDate = new Timestamp((new SimpleDateFormat(dateFormat)).parse(</span>
						end_Date).getTime()
						+ 24 * 60 * 60 * 1000 - 1000);
<span class="nc" id="L540">				session.setAttribute(&quot;reportList&quot;, null);</span>
<span class="nc" id="L541">				lastDate = CommonMethods.getLastArchDate();</span>
<span class="nc" id="L542">				System.out.println(&quot;last archieve date&quot;+lastDate);</span>
<span class="nc" id="L543">				SimpleDateFormat formatOld = new SimpleDateFormat(&quot;dd-MM-yyyy&quot;);</span>
<span class="nc" id="L544">				Date oldDate = formatOld.parse(start_date);</span>
<span class="nc" id="L545">				System.out.println(&quot;last archieve date&quot;+lastDate);</span>
<span class="nc" id="L546">				Calendar calStart = Calendar.getInstance();</span>
<span class="nc" id="L547">				Calendar calLast = Calendar.getInstance();</span>
<span class="nc" id="L548">				SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L549">				Date devLastDate = format.parse(lastDate);</span>
<span class="nc" id="L550">				Date devStartDate = format.parse(format.format(oldDate));</span>
<span class="nc" id="L551">				calStart.setTime(devStartDate);</span>
<span class="nc" id="L552">				calLast.setTime(devLastDate);</span>
<span class="nc bnc" id="L553" title="All 4 branches missed.">				if(calStart.before(calLast) || calStart.equals(calLast))</span>
				{
<span class="nc" id="L555">					isExpand = true;</span>
				}
<span class="nc bnc" id="L557" title="All 2 branches missed.">				else if(calStart.after(calLast))</span>
				{
<span class="nc" id="L559">					isExpand = false;</span>
				}
<span class="nc" id="L561">				session.setAttribute(&quot;isExpand&quot;, isExpand);</span>
<span class="nc bnc" id="L562" title="All 2 branches missed.">				if (&quot;Game Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L563">					session.setAttribute(&quot;reportList&quot;, fetchReportGameWiseExpandForAgent(startDate, endDate, reportStatusBean));</span>
<span class="nc" id="L564">					return SUCCESS;</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">				} else if (&quot;Retailer Wise Expand&quot;.equals(reportType)) {</span>
<span class="nc" id="L566">					session.setAttribute(&quot;reportList&quot;, fetchReportRetailerWiseExpand(startDate, endDate, reportStatusBean, stateCode, cityCode));</span>
<span class="nc" id="L567">					return SUCCESS;</span>
<span class="nc bnc" id="L568" title="All 2 branches missed.">				} else if (&quot;Agent Wise Expand&quot;.equals(reportType)){</span>
<span class="nc" id="L569">					session.setAttribute(&quot;reportList&quot;, fetchReportGameWiseAgentDirPlyExpand(startDate, endDate, reportStatusBean));</span>
<span class="nc" id="L570">					return SUCCESS;</span>
				}
<span class="nc" id="L572">			} else {</span>
<span class="nc" id="L573">				return &quot;RESULT_TIMING_RESTRICTION&quot;;</span>
			}
<span class="nc" id="L575">		} catch (Exception e) {</span>
<span class="nc" id="L576">			e.printStackTrace();</span>
<span class="nc" id="L577">			throw new LMSException(&quot;Date Format Error&quot;);</span>
<span class="nc" id="L578">		}</span>
<span class="nc" id="L579">		return ERROR;</span>
	}
	
	public void exportExcel(){

<span class="nc" id="L584">		HttpSession session = request.getSession();</span>
<span class="nc" id="L585">		List&lt;SalePwtReportsBean&gt; data = new ArrayList&lt;SalePwtReportsBean&gt;();</span>
<span class="nc" id="L586">		List&lt;SalePwtReportsBean&gt; dataExpended = new ArrayList&lt;SalePwtReportsBean&gt;();</span>
<span class="nc" id="L587">		List&lt;SalePwtReportsBean&gt; dataDirPlr = new ArrayList&lt;SalePwtReportsBean&gt;();</span>
<span class="nc" id="L588">		ServletContext sc = session.getServletContext();</span>
<span class="nc" id="L589">		IDrawPwtReportHelper helper = null;</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">		if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L591">			helper = new DrawPwtReportHelperSP();</span>
		}else{
<span class="nc" id="L593">			helper = new DrawPwtReportHelper();</span>
		}
<span class="nc" id="L595">		String dateFormat = (String) sc.getAttribute(&quot;date_format&quot;);</span>
<span class="nc" id="L596">		data = (ArrayList) session.getAttribute(&quot;excelData&quot;);</span>
<span class="nc" id="L597">		dataDirPlr = (ArrayList) session.getAttribute(&quot;excelDataDirPlr&quot;);</span>

		try {
<span class="nc" id="L600">			String actionName = ActionContext.getContext().getName();</span>
<span class="nc" id="L601">			ReportStatusBean reportStatusBean = ReportUtility.getReportStatus(actionName);</span>

<span class="nc bnc" id="L603" title="All 2 branches missed.">			if(&quot;SUCCESS&quot;.equals(reportStatusBean.getReportStatus())) {</span>
<span class="nc" id="L604">				response.setContentType(&quot;application/vnd.ms-excel&quot;);</span>
<span class="nc" id="L605">				response.setHeader(&quot;Content-disposition&quot;,</span>
						&quot;attachment;filename=DrawPwtReport.xls&quot;);
<span class="nc" id="L607">				WritableWorkbook w = Workbook.createWorkbook(response</span>
						.getOutputStream());
<span class="nc" id="L609">				Timestamp startDate = null;</span>
<span class="nc" id="L610">				Timestamp endDate = null;</span>

<span class="nc bnc" id="L612" title="All 4 branches missed.">				if(stateCode == null || stateCode.trim().isEmpty()) </span>
<span class="nc" id="L613">					stateCode = &quot;ALL&quot;;</span>
<span class="nc bnc" id="L614" title="All 4 branches missed.">				if(cityCode == null || cityCode.trim().isEmpty())</span>
<span class="nc" id="L615">					cityCode = &quot;ALL&quot;;</span>

				try{
<span class="nc" id="L618">					startDate = new Timestamp((new SimpleDateFormat(dateFormat)).parse(</span>
							start_date).getTime());
<span class="nc" id="L620">					endDate = new Timestamp((new SimpleDateFormat(dateFormat)).parse(</span>
							end_Date).getTime()
							+ 24 * 60 * 60 * 1000 - 1000);
<span class="nc" id="L623">					WriteExcelForDrawPwtReport excel = new WriteExcelForDrawPwtReport(</span>
							startDate, endDate, reportType);
<span class="nc bnc" id="L625" title="All 2 branches missed.">					if (&quot;Game Wise&quot;.equalsIgnoreCase(reportType)) {</span>
					
						
					
<span class="nc bnc" id="L629" title="All 2 branches missed.">						if(((UserInfoBean)session.getAttribute(&quot;USER_INFO&quot;)).getUserType().equalsIgnoreCase(&quot;AGENT&quot;)){</span>
<span class="nc bnc" id="L630" title="All 2 branches missed.">							if(!ReportUtility.isArchData(new java.sql.Date(startDate.getTime()))){</span>
<span class="nc" id="L631">								dataExpended = fetchReportGameWiseExpandForAgent(startDate, endDate, reportStatusBean); </span>
							}
							
<span class="nc" id="L634">							excel.writeGameWise(data, dataExpended, w, (String) session.getAttribute(&quot;orgName&quot;),</span>
									(String) session.getAttribute(&quot;orgAdd&quot;), &quot;AGENT&quot;,
									(String) request.getSession().getServletContext()
											.getAttribute(&quot;CURRENCY_SYMBOL&quot;), stateCode, cityCode);
						}else{
<span class="nc bnc" id="L639" title="All 2 branches missed.">							if(!ReportUtility.isArchData(new java.sql.Date(startDate.getTime()))){</span>
<span class="nc" id="L640">								dataExpended = fetchReportGameWiseExpand(startDate, endDate, reportStatusBean);</span>
							}
							
<span class="nc" id="L643">							excel.writeGameWise(data, dataExpended, w, (String) session.getAttribute(&quot;orgName&quot;),</span>
									(String) session.getAttribute(&quot;orgAdd&quot;), &quot;BO&quot;,
									(String) request.getSession().getServletContext()
											.getAttribute(&quot;CURRENCY_SYMBOL&quot;), stateCode, cityCode);
						}
			
<span class="nc bnc" id="L649" title="All 4 branches missed.">					} else if (&quot;Agent Wise&quot;.equalsIgnoreCase(reportType) || &quot;Retailer Wise&quot;.equalsIgnoreCase(reportType)) {</span>
						
<span class="nc" id="L651">						Map&lt;Integer, List&lt;String&gt;&gt; addMap = new TreeMap&lt;Integer, List&lt; String&gt;&gt;();</span>
<span class="nc" id="L652">						addMap = helper.fetchOrgAddMap(reportType.split(&quot; &quot;)[0].toUpperCase(),agentOrgId);</span>
<span class="nc" id="L653">						Iterator&lt;Map.Entry&lt;Integer, List&lt;String&gt;&gt;&gt; it = addMap.entrySet().iterator();</span>
<span class="nc" id="L654">						Map&lt;Integer, List&lt;SalePwtReportsBean&gt;&gt; tempMap = new TreeMap&lt;Integer, List&lt;SalePwtReportsBean&gt;&gt;();</span>
<span class="nc" id="L655">						List&lt;SalePwtReportsBean&gt; DataDirPlrExpnd = new ArrayList&lt;SalePwtReportsBean&gt;(); </span>
<span class="nc bnc" id="L656" title="All 2 branches missed.">						while(it.hasNext()){</span>
<span class="nc" id="L657">							Map.Entry&lt;Integer, List&lt;String&gt;&gt; pair = it.next();</span>
<span class="nc" id="L658">							setAgentOrgId(pair.getKey());</span>
<span class="nc bnc" id="L659" title="All 2 branches missed.">							if(&quot;Agent Wise&quot;.equalsIgnoreCase(reportType)){</span>
<span class="nc" id="L660">								tempMap.put(pair.getKey(), fetchReportAgentWiseExpand(startDate, endDate, reportStatusBean));</span>
<span class="nc bnc" id="L661" title="All 2 branches missed.">							}else if(&quot;Retailer Wise&quot;.equalsIgnoreCase(reportType)){</span>
<span class="nc" id="L662">								tempMap.put(pair.getKey(), fetchReportRetailerWiseExpand(startDate, endDate, reportStatusBean, stateCode, cityCode));</span>
							}
<span class="nc" id="L664">						}</span>
<span class="nc bnc" id="L665" title="All 2 branches missed.">						if(&quot;Agent Wise&quot;.equalsIgnoreCase(reportType)){</span>
<span class="nc" id="L666">							DataDirPlrExpnd = fetchReportGameWiseBODirPlyExpand(startDate, endDate, reportStatusBean);</span>
<span class="nc bnc" id="L667" title="All 2 branches missed.">						}else if(&quot;Retailer Wise&quot;.equalsIgnoreCase(reportType)){</span>
<span class="nc" id="L668">							DataDirPlrExpnd = fetchReportGameWiseAgentDirPlyExpand(startDate, endDate, reportStatusBean);</span>
						}
<span class="nc" id="L670">						excel.writeAgentWise(data, tempMap, dataDirPlr,DataDirPlrExpnd,w, addMap, (String)session.getAttribute(&quot;orgName&quot;),</span>
								(String)session.getAttribute(&quot;orgAdd&quot;),&quot;BO&quot;,
								(String)request.getSession().getServletContext()
										.getAttribute(&quot;CURRENCY_SYMBOL&quot;),reportType, stateCode, cityCode);
					}
<span class="nc" id="L675">				}catch(Exception e){</span>
<span class="nc" id="L676">					e.printStackTrace();</span>
<span class="nc" id="L677">					throw new LMSException(getText(&quot;msg.date.format.error&quot;));</span>
<span class="nc" id="L678">				}</span>
<span class="nc" id="L679">			} else {</span>
<span class="nc" id="L680">				throw new LMSException(getText(&quot;msg.res.timing.restriction&quot;));</span>
			}
<span class="nc" id="L682">		} catch (FileNotFoundException e) {</span>
<span class="nc" id="L683">			e.printStackTrace();</span>
<span class="nc" id="L684">		} catch (IOException e) {</span>
<span class="nc" id="L685">			e.printStackTrace();</span>
<span class="nc" id="L686">		} catch (Exception e) {</span>
<span class="nc" id="L687">			e.printStackTrace();</span>
<span class="nc" id="L688">		}</span>
	
<span class="nc" id="L690">	}</span>
	
	public List&lt;SalePwtReportsBean&gt; fetchReportRetailerWise(Timestamp startDate,
			Timestamp endDate, String stateCode, String cityCode, ReportStatusBean reportStatusBean) throws SQLException {
<span class="nc" id="L694">		IDrawPwtReportHelper helper = null;</span>
<span class="nc bnc" id="L695" title="All 2 branches missed.">		if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L696">			helper = new DrawPwtReportHelperSP();</span>
		}else{
<span class="nc" id="L698">			helper = new DrawPwtReportHelper();</span>
		}
<span class="nc" id="L700">		List&lt;SalePwtReportsBean&gt; reportList = null;</span>
<span class="nc" id="L701">		HttpSession session = request.getSession();</span>
<span class="nc" id="L702">		UserInfoBean userInfoBean=(UserInfoBean)session.getAttribute(&quot;USER_INFO&quot;);</span>
<span class="nc" id="L703">		reportList = helper.drawPwtRetailerWise(startDate, endDate, stateCode, cityCode, agentOrgId, reportStatusBean);</span>
<span class="nc" id="L704">		session.setAttribute(&quot;orgName&quot;, userInfoBean.getOrgName());</span>
		try{
<span class="nc" id="L706">			session.setAttribute(&quot;orgAdd&quot;,helper.getOrgAdd(userInfoBean.getUserOrgId()));</span>
		}
<span class="nc" id="L708">		catch(LMSException ex){</span>
<span class="nc" id="L709">			ex.printStackTrace();</span>
<span class="nc" id="L710">		}</span>
<span class="nc" id="L711">		logger.info(&quot;---reportList---&quot; + reportList);</span>
<span class="nc" id="L712">		return reportList;</span>
	}
	
	public List&lt;SalePwtReportsBean&gt; fetchReportRetailerWiseExpand(Timestamp startDate, Timestamp endDate, ReportStatusBean reportStatusBean, String stateCode, String cityCode) throws SQLException {
<span class="nc" id="L716">		logger.info(&quot;------Agent Org Id---&quot; + agentOrgId);</span>
<span class="nc" id="L717">		IDrawPwtReportHelper helper = null;</span>
<span class="nc bnc" id="L718" title="All 2 branches missed.">		if(LMSFilterDispatcher.isRepFrmSP){</span>
<span class="nc" id="L719">			helper = new DrawPwtReportHelperSP();</span>
		}else{
<span class="nc" id="L721">			helper = new DrawPwtReportHelper();</span>
		}
<span class="nc" id="L723">		List&lt;SalePwtReportsBean&gt; reportList = null;</span>
<span class="nc" id="L724">		reportList = helper.drawPwtRetailerWiseExpand(startDate, endDate, agentOrgId, reportStatusBean, stateCode, cityCode);</span>
<span class="nc" id="L725">		HttpSession session = request.getSession();</span>
<span class="nc" id="L726">		session.setAttribute(&quot;orgName&quot;, ((UserInfoBean)session.getAttribute(&quot;USER_INFO&quot;)).getOrgName());</span>
		try{
<span class="nc" id="L728">			session.setAttribute(&quot;orgAdd&quot;,helper.getOrgAdd(((UserInfoBean)session.getAttribute(&quot;USER_INFO&quot;)).getUserOrgId()));</span>
		}
<span class="nc" id="L730">		catch(LMSException ex){</span>
<span class="nc" id="L731">			ex.printStackTrace();</span>
<span class="nc" id="L732">		}</span>
<span class="nc" id="L733">		logger.info(&quot;---reportList---&quot; + reportList);</span>
<span class="nc" id="L734">		return reportList;</span>
	}
	
	public void setAgentOrgId(int agentOrgId) {
<span class="nc" id="L738">		this.agentOrgId = agentOrgId;</span>
<span class="nc" id="L739">	}</span>

	public void setEnd_Date(String end_Date) {
<span class="nc" id="L742">		this.end_Date = end_Date;</span>
<span class="nc" id="L743">	}</span>

	public void setReportType(String reportType) {
<span class="nc" id="L746">		this.reportType = reportType;</span>
<span class="nc" id="L747">	}</span>

	public void setServletRequest(HttpServletRequest request) {
<span class="nc" id="L750">		this.request = request;</span>
<span class="nc" id="L751">	}</span>

	public void setServletResponse(HttpServletResponse response) {
<span class="nc" id="L754">		this.response = response;</span>
<span class="nc" id="L755">	}</span>

	public void setStart_date(String start_date) {
<span class="nc" id="L758">		this.start_date = start_date;</span>
<span class="nc" id="L759">	}</span>
	public void setLastDate(String lastDate)
	{
<span class="nc" id="L762">		this.lastDate = lastDate;</span>
<span class="nc" id="L763">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>