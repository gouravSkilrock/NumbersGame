<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RecieptSearchActionHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.accMgmt.common</a> &gt; <span class="el_source">RecieptSearchActionHelper.java</span></div><h1>RecieptSearchActionHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.accMgmt.common;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.List;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.beans.DateBeans;
import com.skilrock.lms.beans.OrgBean;
import com.skilrock.lms.beans.RecieptDetail;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.MySqlQueries;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.common.db.TableConstants;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.filter.LMSFilterDispatcher;
import com.skilrock.lms.common.utility.GetDate;

<span class="nc" id="L26">public class RecieptSearchActionHelper {</span>
<span class="nc" id="L27">	static Log logger = LogFactory.getLog(RecieptSearchActionHelper.class);</span>
<span class="nc" id="L28">	Connection conn = null;</span>
<span class="nc" id="L29">	PreparedStatement pstmt = null;</span>
<span class="nc" id="L30">	ResultSet result = null;</span>

	public List&lt;OrgBean&gt; getAgentOrgList() {
<span class="nc" id="L33">		List&lt;OrgBean&gt; list = new ArrayList&lt;OrgBean&gt;(0);</span>
<span class="nc" id="L34">		OrgBean Bean = null;</span>
		try {
<span class="nc" id="L36">			conn = DBConnect.getConnection();</span>
<span class="nc" id="L37">			pstmt = conn.prepareStatement(QueryManager</span>
					.getST_RECEIPT_SEARCH_AGENT_ORGID());
<span class="nc" id="L39">			result = pstmt.executeQuery();</span>
<span class="nc bnc" id="L40" title="All 2 branches missed.">			while (result.next()) {</span>
<span class="nc" id="L41">				Bean = new OrgBean();</span>
<span class="nc" id="L42">				Bean.setOrgId(result.getInt(TableConstants.ORG_ID));</span>
<span class="nc" id="L43">				Bean.setOrgName(result.getString(TableConstants.NAME));</span>
<span class="nc" id="L44">				list.add(Bean);</span>
			}
<span class="nc" id="L46">		} catch (SQLException e) {</span>
<span class="nc" id="L47">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L48">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L50">			try {</span>
<span class="nc" id="L51">				conn.close();</span>
<span class="nc" id="L52">			} catch (SQLException e) {</span>
<span class="nc" id="L53">				logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L54">				e.printStackTrace();</span>
<span class="nc" id="L55">			}</span>
<span class="nc" id="L56">		}</span>

		// logger.debug(&quot;receipt search list : &quot;+list);
<span class="nc" id="L59">		return list;</span>

	}

	private DateBeans getDateBeans(String startDate, String endDate)
			throws LMSException {
<span class="nc" id="L65">		DateBeans dateBeans = new DateBeans();</span>
<span class="nc" id="L66">		SimpleDateFormat utilDateFormat = new SimpleDateFormat(&quot;dd-MM-yyyy&quot;);</span>

		try {
<span class="nc" id="L69">			dateBeans.setStartDate(utilDateFormat.parse(startDate));</span>
<span class="nc" id="L70">			dateBeans.setFirstdate(new java.sql.Date(utilDateFormat.parse(</span>
					startDate).getTime()));
<span class="nc" id="L72">			dateBeans.setEndDate(utilDateFormat.parse(endDate));</span>
<span class="nc" id="L73">			dateBeans.setLastdate(new java.sql.Date(GetDate.getNextDayDate(</span>
					utilDateFormat.parse(endDate)).getTime()));
<span class="nc" id="L75">			dateBeans.setReportType(&quot;&quot;);</span>
<span class="nc" id="L76">		} catch (ParseException e) {</span>
<span class="nc" id="L77">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L78">			e.printStackTrace();</span>
<span class="nc" id="L79">			throw new LMSException(e);</span>
<span class="nc" id="L80">		}</span>
<span class="nc" id="L81">		return dateBeans;</span>
	}

	public String getDlNoteSeacrhQueryForAgtRet(String recieptnumber,
			String receiptstatus, String usertype, String agentOrgId,
			String retOrgId, String VStartDate, String VEndDate, String TStartDate, String TEndDate)
	throws LMSException {
<span class="nc" id="L88">		String startDate = null;</span>
<span class="nc" id="L89">		String endDate = null;</span>
<span class="nc" id="L90">		StringBuilder DNQuery = null;</span>
<span class="nc bnc" id="L91" title="All 8 branches missed.">		if(VStartDate != null &amp;&amp; VEndDate != null &amp;&amp; !&quot;&quot;.equals(VStartDate)</span>
				&amp;&amp; !&quot;&quot;.equals(VEndDate)){
<span class="nc" id="L93">			startDate = VStartDate;</span>
<span class="nc" id="L94">			endDate = VEndDate;</span>
		}
<span class="nc bnc" id="L96" title="All 8 branches missed.">		else if(TStartDate != null &amp;&amp; TEndDate != null &amp;&amp; !&quot;&quot;.equals(TStartDate)</span>
				&amp;&amp; !&quot;&quot;.equals(TEndDate)){
<span class="nc" id="L98">			startDate = TStartDate;</span>
<span class="nc" id="L99">			endDate = TEndDate;</span>
		}

<span class="nc" id="L102">		System.out.println(&quot;Receipt Status is::&quot;+receiptstatus);</span>
		
<span class="nc bnc" id="L104" title="All 2 branches missed.">		if(&quot;AGENT&quot;.equalsIgnoreCase(usertype)){</span>
<span class="nc" id="L105">			DNQuery=new StringBuilder(QueryManager.getST_RECEIPT_SEARCH_DLNOTE());</span>
<span class="nc bnc" id="L106" title="All 4 branches missed.">			if (agentOrgId != null &amp;&amp; !&quot;&quot;.equals(agentOrgId.trim())) {</span>
<span class="nc" id="L107">				DNQuery.append(&quot; and  umas.organization_id =&quot; + agentOrgId);</span>
			}
		}else{
<span class="nc" id="L110">			DNQuery=new StringBuilder(MySqlQueries.ST_RECEIPT_SEARCH_DLNOTE_RETAILER);</span>
		}
			
<span class="nc bnc" id="L113" title="All 8 branches missed.">		if (startDate != null &amp;&amp; endDate != null &amp;&amp; !&quot;&quot;.equals(startDate)</span>
				&amp;&amp; !&quot;&quot;.equals(endDate)) {
<span class="nc" id="L115">			DateBeans dateBeans = getDateBeans(startDate, endDate);</span>
<span class="nc" id="L116">			DNQuery = DNQuery.append(&quot; and ( ind.date&gt;='&quot;</span>
					+ dateBeans.getFirstdate()
					+ &quot;' and ind.date&lt;'&quot;
					+ dateBeans.getLastdate() + &quot;') &quot;);
		}
<span class="nc" id="L121">		DNQuery = DNQuery</span>
		.append(&quot; group by generated_dl_id )aa where aa.parent_id=om.organization_id  and aa.organization_type='&quot;+usertype+&quot;'&quot;);


<span class="nc bnc" id="L125" title="All 4 branches missed.">		if (recieptnumber != null &amp;&amp; !&quot;&quot;.equals(recieptnumber.trim())) {</span>
<span class="nc" id="L126">			DNQuery.append(&quot; and generated_dl_id like '&quot; + recieptnumber + &quot;%' &quot;);</span>
		}


<span class="nc" id="L130">		logger.debug(&quot;Delivery Note search query :   &quot; + DNQuery);</span>
<span class="nc" id="L131">		return DNQuery.toString();</span>
	}
	
	public String getReceiptSeacrhQueryForAgtRet(String recieptnumber,
			String receiptstatus, String usertype, String agentOrgId,
			String retOrgId, String VStartDate, String VEndDate, String TStartDate, String TEndDate)
			throws LMSException {
<span class="nc" id="L138">		String startDate = null;</span>
<span class="nc" id="L139">		String endDate = null;</span>
<span class="nc" id="L140">		StringBuilder query = null;</span>
<span class="nc" id="L141">		String appendQuery =&quot; &quot;;</span>
<span class="nc" id="L142">		String appendQueryForMain =&quot; &quot;;</span>
<span class="nc bnc" id="L143" title="All 8 branches missed.">		if(VStartDate != null &amp;&amp; VEndDate != null &amp;&amp; !&quot;&quot;.equals(VStartDate)</span>
				&amp;&amp; !&quot;&quot;.equals(VEndDate)){
<span class="nc" id="L145">			startDate = VStartDate;</span>
<span class="nc" id="L146">			endDate = VEndDate;</span>
		}
<span class="nc bnc" id="L148" title="All 8 branches missed.">		else if(TStartDate != null &amp;&amp; TEndDate != null &amp;&amp; !&quot;&quot;.equals(TStartDate)</span>
				&amp;&amp; !&quot;&quot;.equals(TEndDate)){
<span class="nc" id="L150">			startDate = TStartDate;</span>
<span class="nc" id="L151">			endDate = TEndDate;</span>
		}
<span class="nc bnc" id="L153" title="All 2 branches missed.">		if((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;CODE&quot;)){</span>
<span class="nc" id="L154">			appendQuery=&quot;,umas.org_code orgCode&quot;;</span>
<span class="nc" id="L155">			appendQueryForMain= &quot; , orgCode &quot;;</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">		}else if((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;CODE_NAME&quot;)){</span>
<span class="nc" id="L157">				appendQuery=&quot;,concat(umas.org_code,'_',umas.name) orgCode&quot;;</span>
<span class="nc" id="L158">				appendQueryForMain= &quot; , orgCode &quot;;</span>
		
<span class="nc bnc" id="L160" title="All 2 branches missed.">		}else if((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;NAME_CODE&quot;)){</span>
<span class="nc" id="L161">			appendQuery=&quot;,concat(umas.name,'_',umas.org_code) orgCode&quot;;</span>
<span class="nc" id="L162">			appendQueryForMain= &quot; , orgCode &quot;;</span>
			
		}
		
<span class="nc bnc" id="L166" title="All 2 branches missed.">			if (&quot;RETAILER&quot;.equalsIgnoreCase(usertype)) {</span>
<span class="nc" id="L167">				query = new StringBuilder(&quot;select aa.receipt_id,aa.transaction_type,  aa.transaction_date, aa.voucher_date, aa.generated_id ,aa.receipt_type,aa.organization_type,aa.name,aa.parent_id,om.name 'owner_name' &quot;+appendQueryForMain+&quot; from st_lms_organization_master om,(select borec.voucher_date, borec.receipt_id, borec.generated_id, btm.transaction_date, borec.receipt_type,umas.organization_type,umas.name &quot;+appendQuery+&quot;,umas.parent_id,btm.transaction_type  from st_lms_agent_receipts borec,st_lms_organization_master umas,st_lms_agent_receipts_trn_mapping brm, st_lms_agent_transaction_master btm where  brm.receipt_id= borec.receipt_id and borec.party_id=umas.organization_id and btm.transaction_id = brm.transaction_id and borec.party_type='RETAILER'&quot;);</span>
<span class="nc bnc" id="L168" title="All 4 branches missed.">				if (retOrgId != null &amp;&amp; !&quot;&quot;.equals(retOrgId.trim())) {</span>
<span class="nc" id="L169">					query.append(&quot; and  umas.organization_id =&quot; + retOrgId);</span>
				}
<span class="nc bnc" id="L171" title="All 8 branches missed.">				if (startDate != null &amp;&amp; endDate != null &amp;&amp; !&quot;&quot;.equals(startDate)</span>
						&amp;&amp; !&quot;&quot;.equals(endDate)) {
<span class="nc" id="L173">					DateBeans dateBeans = getDateBeans(startDate, endDate);</span>
<span class="nc" id="L174">					query = query.append(&quot; and ( borec.voucher_date&gt;='&quot;</span>
							+ dateBeans.getFirstdate()
							+ &quot;' and borec.voucher_date&lt;'&quot;
							+ dateBeans.getLastdate() + &quot;') &quot;);
				}
<span class="nc" id="L179">				query = query</span>
				.append(&quot; group by generated_id )aa where aa.parent_id=om.organization_id &quot;);
<span class="nc bnc" id="L181" title="All 4 branches missed.">				if (agentOrgId != null &amp;&amp; !&quot;&quot;.equals(agentOrgId.trim())) {</span>
<span class="nc" id="L182">					query.append(&quot; and aa.parent_id=&quot; + agentOrgId);</span>
				}
<span class="nc" id="L184">				logger.debug(&quot; inside retailer-----------------------&quot;);</span>
			} else {
<span class="nc" id="L186">				query = new StringBuilder(&quot;select aa.receipt_id,aa.transaction_type,  aa.transaction_date, aa.voucher_date, aa.generated_id, aa.receipt_type,aa.organization_type,aa.name,om.name 'owner_name' &quot;+appendQueryForMain+&quot; from st_lms_organization_master om,( select borec.voucher_date, borec.receipt_id, borec.generated_id,  btm.transaction_date, borec.receipt_type,umas.organization_type,umas.name &quot;+appendQuery+&quot;,umas.parent_id,btm.transaction_type  from  st_lms_bo_receipts borec, st_lms_organization_master umas,st_lms_bo_receipts_trn_mapping brm, st_lms_bo_transaction_master btm where brm.receipt_id= borec.receipt_id and borec.party_id=umas.organization_id and btm.transaction_id = brm.transaction_id  and borec.party_type='AGENT'&quot;);</span>
<span class="nc bnc" id="L187" title="All 4 branches missed.">				if (agentOrgId != null &amp;&amp; !&quot;&quot;.equals(agentOrgId.trim())) {</span>
<span class="nc" id="L188">					query.append(&quot; and  umas.organization_id =&quot; + agentOrgId);</span>
				}
<span class="nc bnc" id="L190" title="All 8 branches missed.">				if (startDate != null &amp;&amp; endDate != null &amp;&amp; !&quot;&quot;.equals(startDate)</span>
						&amp;&amp; !&quot;&quot;.equals(endDate)) {
<span class="nc" id="L192">					DateBeans dateBeans = getDateBeans(startDate, endDate);</span>
<span class="nc" id="L193">					query = query.append(&quot; and ( borec.voucher_date&gt;='&quot;</span>
							+ dateBeans.getFirstdate()
							+ &quot;' and borec.voucher_date&lt;'&quot;
							+ dateBeans.getLastdate() + &quot;') &quot;);
				}
<span class="nc" id="L198">				query = query</span>
				.append(&quot; group by generated_id )aa where aa.parent_id=om.organization_id  and aa.organization_type='AGENT'&quot;);
			}
<span class="nc bnc" id="L201" title="All 4 branches missed.">		if (receiptstatus != null &amp;&amp; !&quot;&quot;.equals(receiptstatus.trim())) {</span>
<span class="nc" id="L202">			query</span>
					.append(&quot;  and aa.receipt_type like '&quot; + receiptstatus
							+ &quot;%' &quot;);
		}
<span class="nc bnc" id="L206" title="All 4 branches missed.">		if (recieptnumber != null &amp;&amp; !&quot;&quot;.equals(recieptnumber.trim())) {</span>
<span class="nc" id="L207">			query.append(&quot; and generated_id like '&quot; + recieptnumber + &quot;%' &quot;);</span>
		}
		// if want to search the reciept of any match case
		// query.append(&quot; and generated_id like '%&quot;+recieptnumber+&quot;%' &quot;)
		
		//Query for OLA_DISTRIBUTOR if the receipt type is OLA_INVOICE
<span class="nc" id="L213">		StringBuilder queryForDistributor=null;</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">		if (&quot;AGENT&quot;.equalsIgnoreCase(usertype)) {</span>
<span class="nc bnc" id="L215" title="All 8 branches missed.">		if ((agentOrgId == null || &quot;&quot;.equals(agentOrgId.trim())) &amp;&amp; (receiptstatus.equalsIgnoreCase(&quot;OLA_INVOICE&quot;) || receiptstatus.equalsIgnoreCase(&quot;&quot;))) {</span>
			
<span class="nc" id="L217">			queryForDistributor	=new StringBuilder(&quot; union select borec.receipt_id,btm.transaction_type,btm.transaction_date,borec.voucher_date, borec.generated_id,   borec.receipt_type,borec.party_type organization_type,dt.distributor as name ,'KhelPlay Rummy' as owner_name &quot;+appendQuery+&quot; from  st_lms_bo_receipts borec,st_lms_organization_master umas, st_lms_bo_receipts_trn_mapping brm, st_lms_bo_transaction_master btm,st_ola_bo_distributor_transaction dt where brm.receipt_id= borec.receipt_id and dt.transaction_id = brm.transaction_id and btm.transaction_id = brm.transaction_id  and borec.party_type='OLA_DISTRIBUTOR' &quot;);</span>
<span class="nc bnc" id="L218" title="All 8 branches missed.">			if (startDate != null &amp;&amp; endDate != null &amp;&amp; !&quot;&quot;.equals(startDate)</span>
					&amp;&amp; !&quot;&quot;.equals(endDate)) {
<span class="nc" id="L220">				DateBeans dateBeans = getDateBeans(startDate, endDate);</span>
<span class="nc" id="L221">				queryForDistributor.append(&quot; and  (borec.voucher_date&gt;= '&quot;+dateBeans.getFirstdate()+&quot;' and borec.voucher_date&lt;='&quot;+dateBeans.getLastdate()+&quot; 23:59:59&quot;+&quot;') &quot;);</span>
			}
			
<span class="nc bnc" id="L224" title="All 4 branches missed.">			if (receiptstatus != null &amp;&amp; !&quot;&quot;.equals(receiptstatus.trim())) {</span>
<span class="nc" id="L225">				queryForDistributor.append(&quot; and receipt_type='&quot;+receiptstatus+&quot;' &quot; );</span>
			}
<span class="nc bnc" id="L227" title="All 4 branches missed.">			if (recieptnumber != null &amp;&amp; !&quot;&quot;.equals(recieptnumber.trim())) {</span>
<span class="nc" id="L228">				queryForDistributor.append(&quot; and generated_id='&quot;+recieptnumber+&quot;' &quot; );</span>
			}
<span class="nc" id="L230">			queryForDistributor.append(&quot; group by generated_id &quot;);</span>
<span class="nc" id="L231">			query.append(queryForDistributor.toString());</span>
			
		}
		
		}
		
<span class="nc" id="L237">		logger.debug(&quot;Reciept search query :   &quot; + query);</span>
<span class="nc" id="L238">		return query.toString();</span>
	}

	public String getReceiptSeacrhQueryForGovPLR(String recieptnumber,
			String receiptstatus, String usertype, String agentOrgId,
			String user, String VStartDate, String VEndDate, String TStartDate, String TEndDate) throws LMSException {
<span class="nc" id="L244">		StringBuilder query = null;</span>

<span class="nc bnc" id="L246" title="All 2 branches missed.">		if (&quot;GOVT&quot;.equalsIgnoreCase(usertype)) {</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">			if (&quot;BO&quot;.equalsIgnoreCase(user)) {</span>
<span class="nc" id="L248">				query = new StringBuilder(</span>
						&quot;select borec.receipt_id, 'GOVERNMENT' as name,  btm.transaction_date, borec.voucher_date, transaction_type, borec.generated_id, btm.party_type,  borec.receipt_type, user_org_id from  st_lms_bo_receipts borec, st_lms_bo_transaction_master btm, st_lms_bo_receipts_trn_mapping brm  where brm.receipt_id= borec.receipt_id and btm.party_type = 'GOVT' and btm.transaction_id = brm.transaction_id &quot;);
			} else {
<span class="nc" id="L251">				query = new StringBuilder(</span>
						&quot;select borec.receipt_id, 'GOVERNMENT' as name, btm.transaction_date, borec.voucher_date, transaction_type, borec.generated_id, btm.party_type,  borec.receipt_type, user_org_id  from  st_lms_agent_receipts borec, st_lms_agent_transaction_master btm, st_lms_agent_receipts_trn_mapping brm  where brm.receipt_id= borec.receipt_id and btm.party_type = 'GOVT' and  btm.user_org_id =&quot;	+ agentOrgId+ &quot; and btm.transaction_id = brm.transaction_id  &quot;);
			}
<span class="nc bnc" id="L254" title="All 2 branches missed.">		} else if (&quot;PLAYER&quot;.equalsIgnoreCase(usertype)) {</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">			if (&quot;BO&quot;.equalsIgnoreCase(user)) {</span>
<span class="nc" id="L256">				query = new StringBuilder(</span>
						&quot;select borec.receipt_id, btm.transaction_date, borec.voucher_date, transaction_type, concat(first_name, ' ', last_name) as name,  borec.generated_id, borec.receipt_type, btm.party_type, user_org_id &quot;
						+ &quot; from  st_lms_bo_receipts borec, st_lms_bo_transaction_master btm, st_lms_player_master pm, st_lms_bo_receipts_trn_mapping brm  &quot;
						+ &quot; where brm.receipt_id= borec.receipt_id and btm.party_type = 'PLAYER' and btm.transaction_id = brm.transaction_id and btm.party_id = pm.player_id&quot;);
			} else {
<span class="nc" id="L261">				query = new StringBuilder(</span>
						&quot;select borec.receipt_id, btm.transaction_date, borec.voucher_date, transaction_type, &quot;
						+ &quot; concat(first_name, ' ', last_name) as name,  borec.generated_id, borec.receipt_type, &quot;
						+ &quot; btm.party_type, user_org_id from  st_lms_agent_receipts borec, st_lms_agent_transaction_master &quot;
						+ &quot; btm, st_lms_player_master pm, st_lms_agent_receipts_trn_mapping brm  where brm.receipt_id = borec.receipt_id &quot;
						+ &quot; and btm.party_type = 'PLAYER' and  btm.user_org_id =&quot;
						+ agentOrgId
						+ &quot; and  btm.transaction_id = brm.transaction_id &quot;
						+ &quot; and btm.party_id = pm.player_id&quot;);

			}
		}
<span class="nc bnc" id="L273" title="All 8 branches missed.">		if(VStartDate != null &amp;&amp; VEndDate != null &amp;&amp; !&quot;&quot;.equals(VStartDate)</span>
				&amp;&amp; !&quot;&quot;.equals(VEndDate)){
<span class="nc" id="L275">			String startDate = VStartDate;</span>
<span class="nc" id="L276">			String endDate = VEndDate;</span>
<span class="nc bnc" id="L277" title="All 8 branches missed.">			if (startDate != null &amp;&amp; endDate != null &amp;&amp; !&quot;&quot;.equals(startDate)</span>
					&amp;&amp; !&quot;&quot;.equals(endDate)) {
<span class="nc" id="L279">				DateBeans dateBeans = getDateBeans(startDate, endDate);</span>
<span class="nc" id="L280">				query = query.append(&quot; and ( borec.voucher_date&gt;='&quot;</span>
						+ dateBeans.getFirstdate()
						+ &quot;' and borec.voucher_date&lt;'&quot;
						+ dateBeans.getLastdate() + &quot;') &quot;);
			}
<span class="nc" id="L285">		}</span>
<span class="nc bnc" id="L286" title="All 8 branches missed.">		else if(TStartDate != null &amp;&amp; TEndDate != null &amp;&amp; !&quot;&quot;.equals(TStartDate)</span>
				&amp;&amp; !&quot;&quot;.equals(TEndDate)){
<span class="nc" id="L288">			String startDate = TStartDate;</span>
<span class="nc" id="L289">			String endDate = TEndDate;</span>
<span class="nc bnc" id="L290" title="All 8 branches missed.">			if (startDate != null &amp;&amp; endDate != null &amp;&amp; !&quot;&quot;.equals(startDate)</span>
					&amp;&amp; !&quot;&quot;.equals(endDate)) {
<span class="nc" id="L292">				DateBeans dateBeans = getDateBeans(startDate, endDate);</span>
<span class="nc" id="L293">				query = query.append(&quot; and ( btm.transaction_date&gt;='&quot;</span>
						+ dateBeans.getFirstdate() + &quot;' and btm.transaction_date&lt;'&quot;
						+ dateBeans.getLastdate() + &quot;') &quot;);
			}
		}
<span class="nc bnc" id="L298" title="All 4 branches missed.">		if (receiptstatus != null &amp;&amp; !&quot;&quot;.equals(receiptstatus.trim())) {</span>
<span class="nc" id="L299">			query.append(&quot;  and transaction_type like '%&quot; + receiptstatus</span>
					+ &quot;%' &quot;);
		}
<span class="nc bnc" id="L302" title="All 4 branches missed.">		if (recieptnumber != null &amp;&amp; !&quot;&quot;.equals(recieptnumber.trim())) {</span>
<span class="nc" id="L303">			query.append(&quot; and generated_id like '&quot; + recieptnumber + &quot;%' &quot;);</span>
		}
<span class="nc" id="L305">		query.append(&quot; group by generated_id &quot;);</span>
<span class="nc" id="L306">		logger.debug(&quot;Reciept search query :   &quot; + query);</span>
<span class="nc" id="L307">		return query.toString();</span>
	}

	public List&lt;RecieptDetail&gt; getRecieptDNList(String query) {
<span class="nc" id="L311">		List&lt;RecieptDetail&gt; recList = new ArrayList&lt;RecieptDetail&gt;(0);</span>
<span class="nc" id="L312">		RecieptDetail recieptBean = null;</span>
		try {
<span class="nc" id="L314">			conn = DBConnect.getConnection();</span>
<span class="nc" id="L315">			pstmt = conn.prepareStatement(query);</span>
<span class="nc" id="L316">			result = pstmt.executeQuery();</span>
<span class="nc" id="L317">			String selectField =&quot; &quot;;</span>
<span class="nc bnc" id="L318" title="All 2 branches missed.">			if((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;NAME&quot;)){</span>
				
<span class="nc" id="L320">				selectField =TableConstants.SOM_ORG_NAME;</span>
							
			}else{
<span class="nc" id="L323">				selectField =&quot;orgCode&quot;;</span>
				
			}
<span class="nc bnc" id="L326" title="All 2 branches missed.">			while (result.next()) {</span>
<span class="nc" id="L327">				recieptBean = new RecieptDetail();</span>
<span class="nc" id="L328">				recieptBean.setReceiptId(result</span>
						.getString(&quot;dl_id&quot;));
<span class="nc" id="L330">				recieptBean.setGenratedId(result.getString(&quot;generated_dl_id&quot;));</span>
				// logger.debug(&quot;generated id ======
				// &quot;+recieptBean.getGenratedId());
<span class="nc" id="L333">				recieptBean.setRecieptType(&quot;DLNOTE&quot;);</span>
<span class="nc" id="L334">				recieptBean.setOrgName(result</span>
						.getString(selectField));
<span class="nc" id="L336">				recieptBean.setTransactionDate(result</span>
						.getDate(&quot;date&quot;));
<span class="nc" id="L338">				recieptBean.setOrgType(result</span>
						.getString(TableConstants.SOM_ORG_TYPE));
<span class="nc" id="L340">				recieptBean.setOwnerName(result.getString(&quot;owner_name&quot;));</span>
<span class="nc" id="L341">				recList.add(recieptBean);</span>
			}
<span class="nc" id="L343">		} catch (SQLException e) {</span>
<span class="nc" id="L344">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L345">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L347">			logger.debug(&quot; closing connection  &quot;);</span>
			try {
<span class="nc" id="L349">				conn.close();</span>
<span class="nc" id="L350">			} catch (SQLException e) {</span>
<span class="nc" id="L351">				logger.error(&quot;Exception: &quot; + e);</span>
				// TODO Auto-generated catch block
<span class="nc" id="L353">				e.printStackTrace();</span>
<span class="nc" id="L354">			}</span>
<span class="nc" id="L355">		}</span>

<span class="nc" id="L357">		logger.debug(&quot;receipt search list : &quot; + recList);</span>
<span class="nc" id="L358">		return recList;</span>
	}
	
	public List&lt;RecieptDetail&gt; getRecieptList(String query,String userType) {
<span class="nc" id="L362">		List&lt;RecieptDetail&gt; recList = new ArrayList&lt;RecieptDetail&gt;(0);</span>
<span class="nc" id="L363">		RecieptDetail recieptBean = null;</span>
		try {
<span class="nc" id="L365">			conn = DBConnect.getConnection();</span>
<span class="nc" id="L366">			String selectField=null;</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">			if((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;NAME&quot;)){</span>
			
<span class="nc" id="L369">				selectField =TableConstants.SOM_ORG_NAME;</span>
							
			}else{
<span class="nc" id="L372">				selectField =&quot;orgCode&quot;;</span>
				
			}
			
<span class="nc" id="L376">			pstmt = conn.prepareStatement(query);</span>
<span class="nc" id="L377">			result = pstmt.executeQuery();</span>
<span class="nc" id="L378">			PreparedStatement pstmt = null;</span>
<span class="nc" id="L379">			String qry = null;</span>
<span class="nc" id="L380">			ResultSet set = null;</span>
<span class="nc" id="L381">			double amt = 0.0;</span>
<span class="nc" id="L382">			List&lt;Long&gt; list = new ArrayList&lt;Long&gt;();</span>
<span class="nc bnc" id="L383" title="All 2 branches missed.">			while (result.next()) {</span>
<span class="nc" id="L384">				list = new ArrayList&lt;Long&gt;();</span>
<span class="nc bnc" id="L385" title="All 8 branches missed.">				if (userType.equalsIgnoreCase(&quot;AGENT&quot;) &amp;&amp; result.getString(&quot;receipt_type&quot;)!=null &amp;&amp; !(result.getString(&quot;receipt_type&quot;).equalsIgnoreCase(&quot;DLCHALLAN&quot;))&amp;&amp; !(result.getString(&quot;receipt_type&quot;).equalsIgnoreCase(&quot;DSRCHALLAN&quot;))) {</span>
<span class="nc" id="L386">					pstmt = conn</span>
							.prepareStatement(&quot;select transaction_id from st_lms_bo_receipts_trn_mapping st_lms_bo_receipts_trn_mapping where receipt_id=&quot;
									+ result
											.getString(TableConstants.BO_RECEIPT_ID)
									+ &quot;&quot;);
<span class="nc" id="L391">					set = pstmt.executeQuery();</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">					while (set.next()) {</span>
<span class="nc" id="L393">						list.add(set.getLong(&quot;transaction_id&quot;));</span>
					}
<span class="nc" id="L395">					qry = getAgentWiseVoucherAmount(list, result</span>
							.getString(TableConstants.BO_RECEIPT_TYPE), result
							.getString(&quot;transaction_type&quot;));
<span class="nc" id="L398">						pstmt = conn.prepareStatement(qry);</span>
<span class="nc" id="L399">					set = pstmt.executeQuery();</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">					if (set.next()) {</span>
<span class="nc" id="L401">						amt = set.getDouble(&quot;amount&quot;);</span>
					}
<span class="nc bnc" id="L403" title="All 8 branches missed.">				} else if (userType.equalsIgnoreCase(&quot;RETAILER&quot;) &amp;&amp; result.getString(&quot;receipt_type&quot;)!=null &amp;&amp; !(result.getString(&quot;receipt_type&quot;).equalsIgnoreCase(&quot;DLCHALLAN&quot;)) &amp;&amp; !(result.getString(&quot;receipt_type&quot;).equalsIgnoreCase(&quot;DSRCHALLAN&quot;))) {</span>
<span class="nc" id="L404">					pstmt = conn</span>
							.prepareStatement(&quot;select transaction_id from st_lms_agent_receipts_trn_mapping where receipt_id=&quot;
									+ result
											.getString(TableConstants.BO_RECEIPT_ID)
									+ &quot;&quot;);
<span class="nc" id="L409">					set = pstmt.executeQuery();</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">					while (set.next()) {</span>
<span class="nc" id="L411">						list.add(set.getLong(&quot;transaction_id&quot;));</span>
					}
<span class="nc" id="L413">					qry = getRetailerWiseVoucherAmount(list, result</span>
							.getString(TableConstants.BO_RECEIPT_TYPE), result
							.getString(&quot;transaction_type&quot;));
					
<span class="nc" id="L417">					pstmt = conn.prepareStatement(qry);</span>
<span class="nc" id="L418">					set = pstmt.executeQuery();</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">					if (set.next()) {</span>
<span class="nc" id="L420">						amt = set.getDouble(&quot;amount&quot;);</span>
					}
				}
				
<span class="nc" id="L424">				recieptBean = new RecieptDetail();</span>
<span class="nc" id="L425">				recieptBean.setAmount(amt);</span>
<span class="nc" id="L426">				recieptBean.setReceiptId(result</span>
			.getString(TableConstants.BO_RECEIPT_ID));
<span class="nc" id="L428">				recieptBean.setGenratedId(result.getString(&quot;generated_id&quot;));</span>
				// logger.debug(&quot;generated id ======
				// &quot;+recieptBean.getGenratedId());
<span class="nc" id="L431">				recieptBean.setRecieptType(result</span>
						.getString(TableConstants.BO_RECEIPT_TYPE));
		/*	recieptBean.setOrgName(result
						.getString(TableConstants.SOM_ORG_NAME));*/
<span class="nc" id="L435">				recieptBean.setOrgName(result.getString(selectField));</span>
<span class="nc" id="L436">				recieptBean.setTransactionDate(result</span>
						.getDate(&quot;voucher_date&quot;));
<span class="nc" id="L438">				recieptBean.setOrgType(result</span>
						.getString(TableConstants.SOM_ORG_TYPE));
<span class="nc" id="L440">				recieptBean.setOwnerName(result.getString(&quot;owner_name&quot;));</span>
<span class="nc" id="L441">				recList.add(recieptBean);</span>
			}

		
			
<span class="nc" id="L446">		} catch (SQLException e) {</span>
<span class="nc" id="L447">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L448">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L450">			logger.debug(&quot; closing connection  &quot;);</span>
			try {
<span class="nc" id="L452">				conn.close();</span>
<span class="nc" id="L453">			} catch (SQLException e) {</span>
<span class="nc" id="L454">				logger.error(&quot;Exception: &quot; + e);</span>
				// TODO Auto-generated catch block
<span class="nc" id="L456">				e.printStackTrace();</span>
<span class="nc" id="L457">			}</span>
<span class="nc" id="L458">		}</span>

<span class="nc" id="L460">		logger.debug(&quot;receipt search list : &quot; + recList);</span>
<span class="nc" id="L461">		return recList;</span>
	}

	public List&lt;RecieptDetail&gt; getRecieptListForGovPLR(String query,String userType) {
<span class="nc" id="L465">		List&lt;RecieptDetail&gt; recList = new ArrayList&lt;RecieptDetail&gt;(0);</span>
<span class="nc" id="L466">		RecieptDetail recieptBean = null;</span>
		try {
<span class="nc" id="L468">			conn = DBConnect.getConnection();</span>
<span class="nc" id="L469">			pstmt = conn.prepareStatement(query);</span>
<span class="nc" id="L470">			result = pstmt.executeQuery();</span>
<span class="nc" id="L471">			PreparedStatement pstmt = null;</span>
<span class="nc" id="L472">			String qry = null;</span>
<span class="nc" id="L473">			ResultSet set = null;</span>
<span class="nc" id="L474">			double amt = 0.0;</span>
<span class="nc" id="L475">			List&lt;Long&gt; list = new ArrayList&lt;Long&gt;();</span>
<span class="nc bnc" id="L476" title="All 2 branches missed.">			while (result.next()) {</span>
<span class="nc" id="L477">				list = new ArrayList&lt;Long&gt;();</span>
<span class="nc bnc" id="L478" title="All 6 branches missed.">				if (userType.equalsIgnoreCase(&quot;BO&quot;) &amp;&amp; result.getString(&quot;receipt_type&quot;)!=null &amp;&amp; !(result.getString(&quot;receipt_type&quot;).equalsIgnoreCase(&quot;DLCHALLAN&quot;))) {</span>
<span class="nc" id="L479">					pstmt = conn</span>
							.prepareStatement(&quot;select transaction_id from st_lms_bo_receipts_trn_mapping where receipt_id=&quot;
									+ result
											.getString(TableConstants.BO_RECEIPT_ID)
									+ &quot;&quot;);
<span class="nc" id="L484">					set = pstmt.executeQuery();</span>
<span class="nc bnc" id="L485" title="All 2 branches missed.">					while (set.next()) {</span>
<span class="nc" id="L486">						list.add(set.getLong(&quot;transaction_id&quot;));</span>
					}
<span class="nc" id="L488">					qry = getAgentWiseVoucherAmount(list, result</span>
							.getString(TableConstants.BO_RECEIPT_TYPE), result
							.getString(&quot;transaction_type&quot;));
<span class="nc bnc" id="L491" title="All 6 branches missed.">				} else if (userType.equalsIgnoreCase(&quot;AGENT&quot;) &amp;&amp; result.getString(&quot;receipt_type&quot;)!=null &amp;&amp; !(result.getString(&quot;receipt_type&quot;).equalsIgnoreCase(&quot;DLCHALLAN&quot;))) {</span>
<span class="nc" id="L492">					pstmt = conn</span>
							.prepareStatement(&quot;select transaction_id from st_lms_agent_receipts_trn_mapping where receipt_id=&quot;
									+ result
											.getString(TableConstants.BO_RECEIPT_ID)
									+ &quot;&quot;);
<span class="nc" id="L497">					set = pstmt.executeQuery();</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">					while (set.next()) {</span>
<span class="nc" id="L499">						list.add(set.getLong(&quot;transaction_id&quot;));</span>
					}
<span class="nc" id="L501">					qry = getRetailerWiseVoucherAmount(list, result</span>
							.getString(TableConstants.BO_RECEIPT_TYPE), result
							.getString(&quot;transaction_type&quot;));
				}
<span class="nc" id="L505">				pstmt = conn.prepareStatement(qry);</span>
<span class="nc" id="L506">				set = pstmt.executeQuery();</span>
<span class="nc bnc" id="L507" title="All 2 branches missed.">				if (set.next()) {</span>
<span class="nc" id="L508">					amt = set.getDouble(&quot;amount&quot;);</span>
				}
<span class="nc" id="L510">				recieptBean = new RecieptDetail();</span>
<span class="nc" id="L511">				recieptBean.setAmount(amt);</span>
<span class="nc" id="L512">				recieptBean.setReceiptId(result</span>
						.getString(TableConstants.BO_RECEIPT_ID));
<span class="nc" id="L514">				recieptBean.setGenratedId(result.getString(&quot;generated_id&quot;));</span>
<span class="nc" id="L515">				recieptBean</span>
						.setRecieptType(result.getString(&quot;transaction_type&quot;));
<span class="nc" id="L517">				recieptBean.setTransactionDate(result</span>
						.getDate(&quot;transaction_date&quot;));
<span class="nc" id="L519">				recieptBean.setOrgName(result.getString(&quot;name&quot;));</span>
<span class="nc" id="L520">				recieptBean.setOrgType(result.getString(&quot;party_type&quot;));</span>
<span class="nc" id="L521">				recList.add(recieptBean);</span>
			}
<span class="nc" id="L523">		} catch (SQLException e) {</span>
<span class="nc" id="L524">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L525">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L527">			try {</span>
<span class="nc" id="L528">				conn.close();</span>
<span class="nc" id="L529">			} catch (SQLException e) {</span>
<span class="nc" id="L530">				logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L531">				e.printStackTrace();</span>
<span class="nc" id="L532">			}</span>
<span class="nc" id="L533">		}</span>
<span class="nc" id="L534">		logger.debug(&quot;receipt search list : &quot; + recList);</span>
<span class="nc" id="L535">		return recList;</span>
	}

	public List&lt;OrgBean&gt; getRetailerOrgList(String agentOrgId) {
<span class="nc" id="L539">		List&lt;OrgBean&gt; list = new ArrayList&lt;OrgBean&gt;(0);</span>
<span class="nc" id="L540">		OrgBean Bean = null;</span>
		try {
<span class="nc" id="L542">			conn = DBConnect.getConnection();</span>
<span class="nc" id="L543">			String query = &quot;select name, organization_id from st_lms_organization_master where organization_type='RETAILER' &quot;;</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">			if (Integer.parseInt(agentOrgId) != -1) {</span>
<span class="nc" id="L545">				query = query + &quot;and parent_id = &quot; + agentOrgId;</span>
			}
<span class="nc" id="L547">			query = query + &quot; order by name&quot;;</span>

<span class="nc" id="L549">			pstmt = conn.prepareStatement(query);</span>
<span class="nc" id="L550">			result = pstmt.executeQuery();</span>
<span class="nc bnc" id="L551" title="All 2 branches missed.">			while (result.next()) {</span>
<span class="nc" id="L552">				Bean = new OrgBean();</span>
<span class="nc" id="L553">				Bean.setOrgId(result.getInt(TableConstants.ORG_ID));</span>
<span class="nc" id="L554">				Bean.setOrgName(result.getString(TableConstants.NAME));</span>
<span class="nc" id="L555">				list.add(Bean);</span>
			}
<span class="nc" id="L557">			logger.debug(query + &quot;\nreceipt search list : &quot; + list);</span>
<span class="nc" id="L558">		} catch (SQLException e) {</span>
<span class="nc" id="L559">			logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L560">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L562">			try {</span>
<span class="nc" id="L563">				conn.close();</span>
<span class="nc" id="L564">			} catch (SQLException e) {</span>
<span class="nc" id="L565">				logger.error(&quot;Exception: &quot; + e);</span>
<span class="nc" id="L566">				e.printStackTrace();</span>
<span class="nc" id="L567">			}</span>
<span class="nc" id="L568">		}</span>

<span class="nc" id="L570">		return list;</span>
	}
	public String getAgentWiseVoucherAmount(List&lt;Long&gt; transIdList, String receiptType, String transactionType)
	{
<span class="nc" id="L574">		String tableName = null;</span>
<span class="nc" id="L575">		String columnName = null;</span>
<span class="nc" id="L576">		String query = null;</span>
<span class="nc bnc" id="L577" title="All 2 branches missed.">		if(receiptType.equalsIgnoreCase(&quot;RECEIPT&quot;))</span>
		{
<span class="nc bnc" id="L579" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;cheque&quot;))</span>
			{
<span class="nc" id="L581">				tableName = &quot;st_lms_bo_sale_chq&quot;;</span>
<span class="nc" id="L582">				columnName = &quot;cheque_amt&quot;;</span>
			}
<span class="nc bnc" id="L584" title="All 2 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;bank_deposit&quot;))</span>
			{
<span class="nc" id="L586">				tableName = &quot;st_lms_bo_bank_deposit_transaction&quot;; </span>
<span class="nc" id="L587">				columnName = &quot;amount&quot;;</span>
			}

<span class="nc bnc" id="L590" title="All 2 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;CASH&quot;))</span>
			{
<span class="nc" id="L592">				tableName = &quot;st_lms_bo_cash_transaction&quot;;</span>
<span class="nc" id="L593">				columnName = &quot;amount&quot;;</span>
			}

<span class="nc bnc" id="L596" title="All 4 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;PWT&quot;)||transactionType.equalsIgnoreCase(&quot;PWT_AUTO&quot;) )</span>
			{
<span class="nc" id="L598">				tableName = &quot;st_se_bo_pwt&quot;;</span>
<span class="nc" id="L599">				columnName = &quot;net_amt&quot;;</span>
			}
			/*else if(transactionType.equalsIgnoreCase(&quot;OLA_COMMISSION&quot;))
			{
				tableName = &quot;st_ola_bo_agt_commission&quot;;
				columnName = &quot;commission_calculated&quot;;
			}*/
<span class="nc bnc" id="L606" title="All 2 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;PWT_PLR&quot;))</span>
			{
<span class="nc" id="L608">				tableName = &quot;st_se_direct_player_pwt&quot;;</span>
<span class="nc" id="L609">				columnName = &quot;net_amt&quot;;</span>
			}
<span class="nc bnc" id="L611" title="All 2 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;DG_PWT_PLR&quot;))</span>
			{
<span class="nc" id="L613">				tableName = &quot;st_dg_bo_direct_plr_pwt&quot;;</span>
<span class="nc" id="L614">				columnName = &quot;net_amt&quot;;</span>
			}
		}

<span class="nc bnc" id="L618" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;DG_INVOICE&quot;)){</span>

<span class="nc bnc" id="L620" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;DG_SALE&quot;))</span>
			{
<span class="nc" id="L622">				tableName = &quot;st_dg_bo_sale&quot;;</span>
<span class="nc" id="L623">				columnName = &quot;net_amt&quot;;</span>
			}

		}
		

<span class="nc bnc" id="L629" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;SLE_INVOICE&quot;)){</span>

<span class="nc bnc" id="L631" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;SLE_SALE&quot;))</span>
			{
<span class="nc" id="L633">				tableName = &quot;st_sle_bo_sale&quot;;</span>
<span class="nc" id="L634">				columnName = &quot;net_amt&quot;;</span>
			}

		}

<span class="nc bnc" id="L639" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;CS_INVOICE&quot;)){</span>

<span class="nc bnc" id="L641" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;CS_SALE&quot;))</span>
			{
<span class="nc" id="L643">				tableName = &quot;st_cs_bo_sale &quot;;</span>
<span class="nc" id="L644">				columnName = &quot;net_amt&quot;;</span>
			}

		}

<span class="nc bnc" id="L649" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;OLA_INVOICE&quot;)){</span>

<span class="nc bnc" id="L651" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;OLA_DEPOSIT&quot;))</span>
			{
<span class="nc" id="L653">				tableName = &quot;st_ola_bo_deposit&quot;;</span>
<span class="nc" id="L654">				columnName = &quot;net_amt&quot;;</span>
			}

			// check the OLA_CASHCARD_SALE transaction type
<span class="nc bnc" id="L658" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;OLA_CASHCARD_SALE&quot;))</span>
			{
<span class="nc" id="L660">				tableName = &quot;st_ola_bo_distributor_transaction&quot;;</span>
<span class="nc" id="L661">				columnName = &quot;amount&quot;;</span>
			}

		}

<span class="nc bnc" id="L666" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;OLA_RECEIPT&quot;)){</span>

<span class="nc bnc" id="L668" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;OLA_WITHDRAWL&quot;))</span>
			{
<span class="nc" id="L670">				tableName = &quot;st_ola_bo_withdrawl&quot;;</span>
<span class="nc" id="L671">				columnName = &quot;net_amt&quot;;</span>
			}
			
<span class="nc bnc" id="L674" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;OLA_COMMISSION&quot;))</span>
			{
<span class="nc" id="L676">				tableName = &quot;st_ola_bo_comm&quot;;</span>
<span class="nc" id="L677">				columnName = &quot;agt_net_claim_comm&quot;;</span>
			}
			
		}


<span class="nc bnc" id="L683" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;INVOICE&quot;)){</span>

<span class="nc bnc" id="L685" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;SALE&quot;))</span>
			{
<span class="nc" id="L687">				tableName = &quot;st_se_bo_agent_transaction &quot;;</span>
<span class="nc" id="L688">				columnName = &quot;net_amt&quot;;</span>
			}
<span class="nc bnc" id="L690" title="All 2 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;LOOSE_SALE&quot;))</span>
			{
<span class="nc" id="L692">				tableName = &quot;st_se_bo_agent_loose_book_transaction&quot;;</span>
<span class="nc" id="L693">				columnName = &quot;net_amt&quot;;</span>
			}
			else
			{
<span class="nc" id="L697">				tableName = &quot;st_dg_bo_sale&quot;;</span>
<span class="nc" id="L698">				columnName = &quot;net_amt&quot;;</span>
			}


		}

<span class="nc bnc" id="L704" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;DG_RECEIPT&quot;)){</span>

<span class="nc bnc" id="L706" title="All 4 branches missed.">			if(transactionType.equalsIgnoreCase(&quot; DG_PWT&quot;)||transactionType.equalsIgnoreCase(&quot;DG_PWT_AUTO&quot;))</span>
			{
<span class="nc" id="L708">				tableName = &quot;st_dg_bo_pwt&quot;;</span>
<span class="nc" id="L709">				columnName = &quot;net_amt&quot;;</span>
			}

		}
		
<span class="nc bnc" id="L714" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;SLE_RECEIPT&quot;)){</span>

<span class="nc bnc" id="L716" title="All 4 branches missed.">			if(transactionType.equalsIgnoreCase(&quot; SLE_PWT&quot;)||transactionType.equalsIgnoreCase(&quot;SLE_PWT_AUTO&quot;))</span>
			{
<span class="nc" id="L718">				tableName = &quot;st_sle_bo_pwt&quot;;</span>
<span class="nc" id="L719">				columnName = &quot;net_amt&quot;;</span>
			}

		}

<span class="nc bnc" id="L724" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;DR_NOTE&quot;)){</span>

<span class="nc" id="L726">			tableName = &quot;st_lms_bo_sale_chq&quot;;</span>
<span class="nc" id="L727">			columnName = &quot;cheque_amt&quot;;</span>

		}	
<span class="nc bnc" id="L730" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;DR_NOTE_CASH&quot;)){</span>

<span class="nc" id="L732">			tableName = &quot;st_lms_bo_debit_note&quot;;</span>
<span class="nc" id="L733">			columnName = &quot;amount&quot;;</span>

		}

<span class="nc bnc" id="L737" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;CR_NOTE&quot;))</span>
		{
<span class="nc bnc" id="L739" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;SALE_RET&quot;))</span>
			{
<span class="nc" id="L741">				tableName = &quot;st_se_bo_agent_transaction&quot;;</span>
<span class="nc" id="L742">				columnName = &quot;net_amt&quot;;</span>
			}
<span class="nc bnc" id="L744" title="All 2 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;LOOSE_SALE_RET&quot;))</span>
			{
<span class="nc" id="L746">				tableName = &quot;st_se_bo_agent_loose_book_transaction&quot;;</span>
<span class="nc" id="L747">				columnName = &quot;net_amt&quot;;</span>
			}

<span class="nc bnc" id="L750" title="All 4 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;DG_REFUND_CANCEL&quot;)||transactionType.equalsIgnoreCase(&quot;DG_REFUND_FAILED&quot;) )</span>
			{
<span class="nc" id="L752">				tableName = &quot;st_dg_bo_sale_refund&quot;;</span>
<span class="nc" id="L753">				columnName = &quot;net_amt&quot;;</span>
			} 

<span class="nc bnc" id="L756" title="All 4 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;CS_CANCEL_SERVER&quot;)||transactionType.equalsIgnoreCase(&quot;CS_CANCEL_RET&quot;) )</span>
			{
<span class="nc" id="L758">				tableName = &quot; st_cs_bo_refund&quot;;</span>
<span class="nc" id="L759">				columnName = &quot;net_amt&quot;;</span>
			}

<span class="nc bnc" id="L762" title="All 2 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;OLA_DEPOSIT_REFUND&quot;))</span>
			{
<span class="nc" id="L764">				tableName = &quot;st_ola_bo_deposit_refund&quot;;</span>
<span class="nc" id="L765">				columnName = &quot;net_amt&quot;;</span>
			}


		}

<span class="nc bnc" id="L771" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;CR_NOTE_CASH&quot;)){</span>

<span class="nc" id="L773">			tableName = &quot;st_lms_bo_credit_note&quot;;</span>
<span class="nc" id="L774">			columnName = &quot;amount&quot;;</span>

		}	

<span class="nc bnc" id="L778" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;GOVT_RCPT&quot;)){</span>

<span class="nc bnc" id="L780" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;VAT&quot;))</span>
			{
<span class="nc" id="L782">				tableName = &quot;st_lms_bo_govt_transaction&quot;;</span>
<span class="nc" id="L783">				columnName = &quot;amount&quot;;</span>
			}
<span class="nc bnc" id="L785" title="All 2 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;GOVT_COMM&quot;))</span>
			{
<span class="nc" id="L787">				tableName = &quot;st_lms_bo_govt_transaction&quot;;</span>
<span class="nc" id="L788">				columnName = &quot;amount&quot;;</span>
			}
<span class="nc bnc" id="L790" title="All 2 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;TDS&quot;))</span>
			{
<span class="nc" id="L792">				tableName = &quot;st_se_direct_player_pwt&quot;;</span>
<span class="nc" id="L793">				columnName = &quot;pwt_amt&quot;;</span>
			}
		}		

<span class="nc" id="L797">		query = &quot;select sum(&quot;+columnName+&quot;) as amount from &quot;+tableName+&quot; where transaction_id in (&quot;+transIdList.toString().replace(&quot;[&quot;, &quot;&quot;).replace(&quot;]&quot;, &quot;&quot;)+&quot;)&quot;;	</span>


<span class="nc" id="L800">		return query;</span>
	}
	public String getRetailerWiseVoucherAmount(List&lt;Long&gt; transIdList, String receiptType, String transactionType)
	{
<span class="nc" id="L804">		String tableName = null;</span>
<span class="nc" id="L805">		String columnName = null;</span>
<span class="nc" id="L806">		String query = null;</span>
<span class="nc bnc" id="L807" title="All 2 branches missed.">		if(receiptType.equalsIgnoreCase(&quot;RECEIPT&quot;))</span>
		{
<span class="nc bnc" id="L809" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;cheque&quot;))</span>
			{
<span class="nc" id="L811">				tableName = &quot;st_lms_agent_sale_chq&quot;;</span>
<span class="nc" id="L812">				columnName = &quot;cheque_amt&quot;;</span>
			}
			
<span class="nc bnc" id="L815" title="All 2 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;CASH&quot;))</span>
			{
<span class="nc" id="L817">				tableName = &quot;st_lms_agent_cash_transaction&quot;;</span>
<span class="nc" id="L818">				columnName = &quot;amount&quot;;</span>
			}

<span class="nc bnc" id="L821" title="All 4 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;PWT&quot;)||transactionType.equalsIgnoreCase(&quot;PWT_AUTO&quot;) )</span>
			{
<span class="nc" id="L823">				tableName = &quot;st_se_agent_pwt&quot;;</span>
<span class="nc" id="L824">				columnName = &quot;net_amt&quot;;</span>
			}
			/*else if(transactionType.equalsIgnoreCase(&quot;OLA_COMMISSION&quot;))
			{
				tableName = &quot;st_ola_agt_ret_commission&quot;;
				columnName = &quot;commission_calculated&quot;;
			}*/

<span class="nc bnc" id="L832" title="All 2 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;PWT_PLR&quot;))</span>
			{
<span class="nc" id="L834">				tableName = &quot;st_se_agt_direct_player_pwt&quot;;</span>
<span class="nc" id="L835">				columnName = &quot;net_amt&quot;;</span>
			}
<span class="nc bnc" id="L837" title="All 2 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;DG_PWT_PLR&quot;))</span>
			{
<span class="nc" id="L839">				tableName = &quot;st_dg_agt_direct_plr_pwdest&quot;;</span>
<span class="nc" id="L840">				columnName = &quot;net_amt&quot;;</span>
			}
		}

<span class="nc bnc" id="L844" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;DG_INVOICE&quot;)){</span>

<span class="nc bnc" id="L846" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;DG_SALE&quot;))</span>
			{
<span class="nc" id="L848">				tableName = &quot;st_dg_agt_sale&quot;;</span>
<span class="nc" id="L849">				columnName = &quot;net_amt&quot;;</span>
			}

		}
<span class="nc bnc" id="L853" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;SLE_INVOICE&quot;)){</span>

<span class="nc bnc" id="L855" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;SLE_SALE&quot;))</span>
			{
<span class="nc" id="L857">				tableName = &quot;st_sle_agt_sale&quot;;</span>
<span class="nc" id="L858">				columnName = &quot;net_amt&quot;;</span>
			}

		}

<span class="nc bnc" id="L863" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;CS_INVOICE&quot;)){</span>

<span class="nc bnc" id="L865" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;CS_SALE&quot;))</span>
			{
<span class="nc" id="L867">				tableName = &quot;st_cs_agt_sale&quot;;</span>
<span class="nc" id="L868">				columnName = &quot;net_amt&quot;;</span>
			}

		}

<span class="nc bnc" id="L873" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;OLA_INVOICE&quot;)){</span>

<span class="nc bnc" id="L875" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;OLA_DEPOSIT&quot;))</span>
			{
<span class="nc" id="L877">				tableName = &quot;st_ola_agt_deposit&quot;;</span>
<span class="nc" id="L878">				columnName = &quot;net_amt&quot;;</span>
			}

		}

<span class="nc bnc" id="L883" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;OLA_RECEIPT&quot;)){</span>

<span class="nc bnc" id="L885" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;OLA_WITHDRAWL&quot;))</span>
			{
<span class="nc" id="L887">				tableName = &quot;st_ola_agt_withdrawl&quot;;</span>
<span class="nc" id="L888">				columnName = &quot;net_amt&quot;;</span>
			}
<span class="nc bnc" id="L890" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;OLA_COMMISSION&quot;))</span>
			{
<span class="nc" id="L892">				tableName = &quot;st_ola_agt_comm&quot;;</span>
<span class="nc" id="L893">				columnName = &quot;ret_claim_comm&quot;;</span>
			}

		}


<span class="nc bnc" id="L899" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;INVOICE&quot;)){</span>

<span class="nc bnc" id="L901" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;SALE&quot;))</span>
			{
<span class="nc" id="L903">				tableName = &quot;st_se_agent_retailer_transaction&quot;;</span>
<span class="nc" id="L904">				columnName = &quot;net_amt&quot;;</span>
			}
<span class="nc bnc" id="L906" title="All 2 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;LOOSE_SALE&quot;))</span>
			{
<span class="nc" id="L908">				tableName = &quot;st_se_agent_ret_loose_book_transaction&quot;;</span>
<span class="nc" id="L909">				columnName = &quot;net_amt&quot;;</span>
			}
			else
			{
<span class="nc" id="L913">				tableName = &quot;st_dg_agt_sale&quot;;</span>
<span class="nc" id="L914">				columnName = &quot;net_amt&quot;;</span>
			}


		}

<span class="nc bnc" id="L920" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;DG_RECEIPT&quot;)){</span>

<span class="nc bnc" id="L922" title="All 4 branches missed.">			if(transactionType.equalsIgnoreCase(&quot; DG_PWT&quot;)||transactionType.equalsIgnoreCase(&quot;DG_PWT_AUTO&quot;))</span>
			{
<span class="nc" id="L924">				tableName = &quot;st_dg_agt_pwt&quot;;</span>
<span class="nc" id="L925">				columnName = &quot;net_amt&quot;;</span>
			}

		}
<span class="nc bnc" id="L929" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;SLE_RECEIPT&quot;)){</span>

<span class="nc bnc" id="L931" title="All 4 branches missed.">			if(transactionType.equalsIgnoreCase(&quot; SLE_PWT&quot;)||transactionType.equalsIgnoreCase(&quot;SLE_PWT_AUTO&quot;))</span>
			{
<span class="nc" id="L933">				tableName = &quot;st_sle_agt_pwt&quot;;</span>
<span class="nc" id="L934">				columnName = &quot;net_amt&quot;;</span>
			}

		}

<span class="nc bnc" id="L939" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;DR_NOTE&quot;)){</span>

<span class="nc" id="L941">			tableName = &quot;st_lms_agent_sale_chq&quot;;</span>
<span class="nc" id="L942">			columnName = &quot;cheque_amt&quot;;</span>

		}	
<span class="nc bnc" id="L945" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;DR_NOTE_CASH&quot;)){</span>

<span class="nc" id="L947">			tableName = &quot;st_lms_agent_debit_note&quot;;</span>
<span class="nc" id="L948">			columnName = &quot;amount&quot;;</span>

		}

<span class="nc bnc" id="L952" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;CR_NOTE&quot;))</span>
		{
<span class="nc bnc" id="L954" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;SALE_RET&quot;))</span>
			{
<span class="nc" id="L956">				tableName = &quot;st_se_agent_retailer_transaction&quot;;</span>
<span class="nc" id="L957">				columnName = &quot;net_amt&quot;;</span>
			}
<span class="nc bnc" id="L959" title="All 2 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;LOOSE_SALE_RET&quot;))</span>
			{
<span class="nc" id="L961">				tableName = &quot;st_se_agent_ret_loose_book_transaction&quot;;</span>
<span class="nc" id="L962">				columnName = &quot;net_amt&quot;;</span>
			}

<span class="nc bnc" id="L965" title="All 4 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;DG_REFUND_CANCEL&quot;)||transactionType.equalsIgnoreCase(&quot;DG_REFUND_FAILED&quot;) )</span>
			{
<span class="nc" id="L967">				tableName = &quot;st_dg_agt_sale_refund&quot;;</span>
<span class="nc" id="L968">				columnName = &quot;bo_net_amt&quot;;</span>
			} 

<span class="nc bnc" id="L971" title="All 4 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;CS_CANCEL_SERVER&quot;)||transactionType.equalsIgnoreCase(&quot;CS_CANCEL_RET&quot;) )</span>
			{
<span class="nc" id="L973">				tableName = &quot; st_cs_agt_refund&quot;;</span>
<span class="nc" id="L974">				columnName = &quot;net_amt&quot;;</span>
			}

<span class="nc bnc" id="L977" title="All 2 branches missed.">			else if(transactionType.equalsIgnoreCase(&quot;OLA_DEPOSIT_REFUND&quot;))</span>
			{
<span class="nc" id="L979">				tableName = &quot;st_ola_agt_deposit_refund&quot;;</span>
<span class="nc" id="L980">				columnName = &quot;net_amt&quot;;</span>
			}


		}

<span class="nc bnc" id="L986" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;CR_NOTE_CASH&quot;)){</span>

<span class="nc" id="L988">			tableName = &quot;st_lms_agent_credit_note&quot;;</span>
<span class="nc" id="L989">			columnName = &quot;amount&quot;;</span>

		}	

<span class="nc bnc" id="L993" title="All 2 branches missed.">		else if(receiptType.equalsIgnoreCase(&quot;GOVT_RCPT&quot;)){</span>

<span class="nc bnc" id="L995" title="All 2 branches missed.">			if(transactionType.equalsIgnoreCase(&quot;VAT&quot;))</span>
			{
<span class="nc" id="L997">				tableName = &quot;st_lms_agent_govt_transaction&quot;;</span>
<span class="nc" id="L998">				columnName = &quot;amount&quot;;</span>
			}
		}		

<span class="nc" id="L1002">		query = &quot;select sum(&quot;+columnName+&quot;) as amount from &quot;+tableName+&quot; where transaction_id in (&quot;+transIdList.toString().replace(&quot;[&quot;, &quot;&quot;).replace(&quot;]&quot;, &quot;&quot;)+&quot;)&quot;;	</span>

		
		
<span class="nc" id="L1006">		return query;</span>
}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>