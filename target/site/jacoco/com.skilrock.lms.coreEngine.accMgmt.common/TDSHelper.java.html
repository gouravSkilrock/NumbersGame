<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TDSHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.accMgmt.common</a> &gt; <span class="el_source">TDSHelper.java</span></div><h1>TDSHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.accMgmt.common;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.text.NumberFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.List;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.beans.TaskBean;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.common.db.TableConstants;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.utility.CommonMethods;

/**
 * This class is used to provide methods for TDS Calculation
 * 
 * @author ABC
 * 
 */
<span class="nc" id="L32">public class TDSHelper {</span>
<span class="nc" id="L33">	static Log logger = LogFactory.getLog(TDSHelper.class);</span>

	public static void main(String[] args) {
<span class="nc" id="L36">		new TDSHelper().getLastDay(new Date());</span>
<span class="nc" id="L37">		new TDSHelper().getFirstDay(new Date());</span>
<span class="nc" id="L38">	}</span>

	private java.util.Date getFirstDay(java.util.Date passDate) {
<span class="nc" id="L41">		Date firstDayDate = null;</span>
<span class="nc" id="L42">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L43">		cal.setTime(passDate);</span>
<span class="nc" id="L44">		cal.set(Calendar.DAY_OF_MONTH, 1);</span>
<span class="nc" id="L45">		firstDayDate = cal.getTime();</span>
<span class="nc" id="L46">		logger.debug(&quot; firstDayDate &quot; + firstDayDate.toString());</span>
<span class="nc" id="L47">		return firstDayDate;</span>
	}

	private java.util.Date getLastDay(java.util.Date passDate) {
<span class="nc" id="L51">		Date lastDayDate = null;</span>
<span class="nc" id="L52">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L53">		cal.setTime(passDate);</span>
<span class="nc" id="L54">		cal.set(Calendar.DAY_OF_MONTH, cal</span>
				.getActualMaximum(Calendar.DAY_OF_MONTH));
<span class="nc" id="L56">		lastDayDate = cal.getTime();</span>
<span class="nc" id="L57">		logger.debug(&quot; lastDayDate &quot; + lastDayDate.toString());</span>
<span class="nc" id="L58">		return lastDayDate;</span>
	}

	public List tdsSearchDG(Integer month, Integer year) throws LMSException {
<span class="nc" id="L62">		logger.debug(&quot; tdsSearchDG called&quot;);</span>
<span class="nc" id="L63">		double taxSum = 0;</span>
<span class="nc" id="L64">		boolean tds = false;</span>
<span class="nc" id="L65">		boolean isEntry = false;</span>
<span class="nc" id="L66">		int yearTable = 0;</span>
<span class="nc" id="L67">		int monthTable = 0;</span>

<span class="nc" id="L69">		int latestyearTaxCal = 0;</span>
<span class="nc" id="L70">		int latestmonthTaxCal = 0;</span>

<span class="nc" id="L72">		NumberFormat nf = NumberFormat.getInstance();</span>
<span class="nc" id="L73">		nf.setMaximumFractionDigits(2);</span>
<span class="nc" id="L74">		nf.setMinimumFractionDigits(2);</span>

<span class="nc" id="L76">		SimpleDateFormat date = new SimpleDateFormat();</span>

<span class="nc" id="L78">		Calendar rightNow = Calendar.getInstance();</span>

<span class="nc" id="L80">		int YR = rightNow.get(Calendar.YEAR);</span>
<span class="nc" id="L81">		int MTH = rightNow.get(Calendar.MONTH) + 1;</span>

<span class="nc" id="L83">		int depYear = year;</span>
<span class="nc" id="L84">		int depMonth = month;</span>
<span class="nc" id="L85">		logger.debug(&quot;inside deploy date changed&quot;);</span>

		// int MTH=11;
<span class="nc" id="L88">		logger.debug(&quot;month from system  &quot; + MTH);</span>

<span class="nc" id="L90">		logger.debug(&quot;not depriceted   &quot; + YR);</span>
<span class="nc" id="L91">		logger.debug(&quot;not depriceted   &quot; + MTH);</span>

<span class="nc" id="L93">		Connection con = null;</span>
<span class="nc" id="L94">		String serviceName = &quot;&quot;;</span>
		try {

			 
<span class="nc" id="L98">			con = DBConnect.getConnection();</span>
<span class="nc" id="L99">			con.setAutoCommit(false);</span>

<span class="nc" id="L101">			Statement stmt1 = con.createStatement();</span>
<span class="nc" id="L102">			Statement stmt2 = con.createStatement();</span>
<span class="nc" id="L103">			Statement stmt3 = con.createStatement();</span>
<span class="nc" id="L104">			Statement stmt4 = con.createStatement();</span>
<span class="nc" id="L105">			Statement stmt5 = con.createStatement();</span>
<span class="nc" id="L106">			Statement stmt6 = con.createStatement();</span>
<span class="nc" id="L107">			ResultSet rs = null;</span>
<span class="nc" id="L108">			ResultSet RSPLR = null;</span>
<span class="nc" id="L109">			logger.debug(&quot;heeeeeee&quot;);</span>
<span class="nc" id="L110">			rs = stmt6</span>
					.executeQuery(&quot;select service_display_name from st_lms_service_master where service_code='DG'and status='ACTIVE'&quot;);
<span class="nc bnc" id="L112" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L113">				serviceName = rs.getString(&quot;service_display_name&quot;);</span>
			}
<span class="nc" id="L115">			ResultSet latestMonth = stmt5.executeQuery(QueryManager</span>
					.getLatestMonthTDSDG());
<span class="nc bnc" id="L117" title="All 2 branches missed.">			while (latestMonth.next()) {</span>
<span class="nc" id="L118">				Calendar rightNow1 = Calendar.getInstance();</span>

<span class="nc" id="L120">				Date dt = latestMonth.getDate(&quot;month&quot;);</span>
<span class="nc" id="L121">				logger.debug(&quot;get date from db &quot; + dt);</span>
<span class="nc" id="L122">				rightNow1.setTime(dt);</span>
<span class="nc" id="L123">				latestyearTaxCal = rightNow1.get(Calendar.YEAR);</span>
<span class="nc" id="L124">				latestmonthTaxCal = rightNow1.get(Calendar.MONTH) + 1;</span>
<span class="nc" id="L125">				logger.debug(&quot; latest year &quot; + latestyearTaxCal);</span>
<span class="nc" id="L126">				logger.debug(&quot; latest month &quot; + latestmonthTaxCal);</span>

				/*
				 * String latestDate=latestMonth.getString(&quot;month&quot;); String
				 * latestyear=latestDate.substring(0,4); String
				 * latestmonth=latestDate.substring(5,7);
				 * latestyearTaxCal=Integer.parseInt(latestyear);
				 * latestmonthTaxCal=Integer.parseInt(latestmonth);
				 * 
				 * logger.debug(&quot;latest year from task table &quot; + latestyear);
				 * logger.debug(&quot;latest month from task table &quot; + latestmonth);
				 */
<span class="nc" id="L138">				isEntry = true;</span>
<span class="nc" id="L139">				break;</span>

			}

<span class="nc bnc" id="L143" title="All 2 branches missed.">			if (isEntry == false) {</span>
<span class="nc" id="L144">				logger.debug(&quot;when no entry for tds&quot;);</span>
<span class="nc" id="L145">				latestyearTaxCal = depYear;</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">				if (depMonth == 01) {</span>
<span class="nc" id="L147">					latestmonthTaxCal = 00;</span>
				} else {
<span class="nc" id="L149">					latestmonthTaxCal = depMonth - 1;</span>
				}

			}

<span class="nc bnc" id="L154" title="All 2 branches missed.">			if (YR == latestyearTaxCal)</span>

			{

<span class="nc" id="L158">				logger.debug(&quot;inside same year&quot;);</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">				for (int i = latestmonthTaxCal + 1; i &lt; MTH; i++) {</span>

<span class="nc" id="L161">					Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L162">					SimpleDateFormat dtfmt = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L163">					Date dd = null;</span>
<span class="nc" id="L164">					Date newdate = null;</span>
<span class="nc" id="L165">					taxSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L168" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L169">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L172">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L176" title="All 2 branches missed.">					if (i &lt; 10)</span>

					{
<span class="nc" id="L179">						int day = 1;</span>
<span class="nc" id="L180">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L181">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L183">						cal.set(latestyearTaxCal, i - 1, totalday);</span>
						try {
<span class="nc" id="L185">							newdate = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L186">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L188">							e.printStackTrace();</span>
<span class="nc" id="L189">						}</span>
<span class="nc" id="L190">						cal.setTime(newdate);</span>
<span class="nc" id="L191">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L192">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L193">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot; +
						// &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L197">					} else {</span>
<span class="nc" id="L198">						int day = 1;</span>
<span class="nc" id="L199">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L200">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L202">						cal.set(latestyearTaxCal, i - 1, totalday);</span>
						try {
<span class="nc" id="L204">							newdate = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L205">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L207">							e.printStackTrace();</span>
<span class="nc" id="L208">						}</span>
<span class="nc" id="L209">						cal.setTime(newdate);</span>
<span class="nc" id="L210">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L211">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L212">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot;+i
						// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}
<span class="nc" id="L217">					logger.debug(&quot;9999999999999999999999&quot;);</span>
<span class="nc" id="L218">					logger.debug(transaction_date_first);</span>
					// logger.debug(transaction_date_last);

<span class="nc" id="L221">					String queryForPlayer = QueryManager</span>
							.getST3LastMonthTransactionDG()
							+ &quot; where  transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime()) + &quot;' &quot;;
<span class="nc" id="L227">					logger.debug(&quot;query----&quot; + queryForPlayer);</span>
<span class="nc" id="L228">					RSPLR = stmt2.executeQuery(queryForPlayer);</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L231">						double taxAmt = RSPLR</span>
								.getDouble(TableConstants.TAX_AMOUNT);
<span class="nc" id="L233">						logger.debug(&quot;tax amount   from table&quot; + taxAmt);</span>
<span class="nc" id="L234">						taxSum = CommonMethods.fmtToTwoDecimal(taxSum + taxAmt);</span>
<span class="nc" id="L235">						logger.debug(&quot;calculated tax  &quot; + taxSum);</span>

<span class="nc" id="L237">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L245" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L246">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L248">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L250">					String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L251">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L253">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L254">					Date taskDate = null;</span>
					try {
<span class="nc" id="L256">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L257">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L259">						e.printStackTrace();</span>
<span class="nc" id="L260">					}</span>
<span class="nc" id="L261">					logger.debug(&quot;date to insert &quot; + taskDate);</span>

<span class="nc" id="L263">					String queryTaskCreate = QueryManager.getST3CreateTask()</span>
							+ &quot;values('&quot;
							+ taxSum
							+ &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','TDS','UNAPPROVED',CURRENT_DATE, '&quot;
							+ new java.sql.Date(getFirstDay(taskDate).getTime())
							+ &quot;' ,'&quot;
							+ new java.sql.Date(getLastDay(taskDate).getTime())
							+ &quot;','DG')&quot;;
<span class="nc" id="L273">					stmt3.executeUpdate(queryTaskCreate);</span>

				}

			}

<span class="nc bnc" id="L279" title="All 2 branches missed.">			if (YR == latestyearTaxCal + 1) {</span>
<span class="nc" id="L280">				logger.debug(&quot;when diff is one&quot;);</span>
<span class="nc" id="L281">				Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L282">				SimpleDateFormat dtfmt = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>

<span class="nc bnc" id="L284" title="All 2 branches missed.">				for (int i = latestmonthTaxCal + 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L285">					Date dd = null;</span>
<span class="nc" id="L286">					Date ddd = null;</span>
<span class="nc" id="L287">					taxSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L290" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L291">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L294">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L298" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L299">						int day = 1;</span>
<span class="nc" id="L300">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L301">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L303">						cal.set(latestyearTaxCal, i - 1, totalday);</span>

						try {
<span class="nc" id="L306">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L307">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L309">							e.printStackTrace();</span>
<span class="nc" id="L310">						}</span>
<span class="nc" id="L311">						cal.setTime(ddd);</span>
<span class="nc" id="L312">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L313">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L314">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot; +
						// &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L319">					} else {</span>
<span class="nc" id="L320">						int day = 1;</span>
<span class="nc" id="L321">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L322">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L324">						cal.set(latestyearTaxCal, i - 1, totalday);</span>

						try {
<span class="nc" id="L327">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L328">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L330">							e.printStackTrace();</span>
<span class="nc" id="L331">						}</span>
<span class="nc" id="L332">						cal.setTime(ddd);</span>
<span class="nc" id="L333">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L334">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L335">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot;+i
						// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}

<span class="nc" id="L341">					String queryForPlayer = QueryManager</span>
							.getST3LastMonthTransactionDG()
							+ &quot; where  transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime()) + &quot;' &quot;;
<span class="nc" id="L347">					logger.debug(&quot;query----&quot; + queryForPlayer);</span>
<span class="nc" id="L348">					RSPLR = stmt3.executeQuery(queryForPlayer);</span>
<span class="nc bnc" id="L349" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L351">						double taxAmt = RSPLR</span>
								.getDouble(TableConstants.TAX_AMOUNT);
<span class="nc" id="L353">						logger.debug(&quot;tax amount   from table&quot; + taxAmt);</span>
<span class="nc" id="L354">						taxSum = CommonMethods.fmtToTwoDecimal(taxSum + taxAmt);</span>
<span class="nc" id="L355">						logger.debug(&quot;calculated tax  &quot; + taxSum);</span>

<span class="nc" id="L357">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L365" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L366">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L368">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L370">					String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L371">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L373">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L374">					Date taskDate = null;</span>
					try {
<span class="nc" id="L376">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L377">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L379">						e.printStackTrace();</span>
<span class="nc" id="L380">					}</span>

<span class="nc" id="L382">					String queryTaskCreate = QueryManager.getST3CreateTask()</span>
							+ &quot;values('&quot;
							+ taxSum
							+ &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','TDS','UNAPPROVED',CURRENT_DATE, '&quot;
							+ new java.sql.Date(getFirstDay(taskDate).getTime())
							+ &quot;' ,'&quot;
							+ new java.sql.Date(getLastDay(taskDate).getTime())
							+ &quot;','DG')&quot;;
<span class="nc" id="L392">					stmt3.executeUpdate(queryTaskCreate);</span>

				}

<span class="nc bnc" id="L396" title="All 2 branches missed.">				for (int i = 1; i &lt; MTH; i++) {</span>
<span class="nc" id="L397">					Date dd = null;</span>
<span class="nc" id="L398">					Date ddd = null;</span>
<span class="nc" id="L399">					taxSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L402" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L403">						transaction_date_first = &quot;&quot; + (latestyearTaxCal + 1)</span>
								+ &quot;-&quot; + &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L406">						transaction_date_first = &quot;&quot; + (latestyearTaxCal + 1)</span>
								+ &quot;-&quot; + i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L410" title="All 2 branches missed.">					if (i &lt; 10)</span>

					{
<span class="nc" id="L413">						int day = 1;</span>
<span class="nc" id="L414">						cal.set(latestyearTaxCal + 1, i - 1, day);</span>
<span class="nc" id="L415">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L417">						cal.set(latestyearTaxCal + 1, i - 1, totalday);</span>
						try {
<span class="nc" id="L419">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L420">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L422">							e.printStackTrace();</span>
<span class="nc" id="L423">						}</span>
<span class="nc" id="L424">						cal.setTime(ddd);</span>
<span class="nc" id="L425">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L426">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L427">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +(latestyearTaxCal+1) + &quot;-&quot;
						// + &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L430">					} else {</span>

<span class="nc" id="L432">						int day = 1;</span>
<span class="nc" id="L433">						cal.set(latestyearTaxCal + 1, i - 1, day);</span>
<span class="nc" id="L434">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L436">						cal.set(latestyearTaxCal + 1, i - 1, totalday);</span>
						try {
<span class="nc" id="L438">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L439">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L441">							e.printStackTrace();</span>
<span class="nc" id="L442">						}</span>
<span class="nc" id="L443">						cal.setTime(ddd);</span>
<span class="nc" id="L444">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L445">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L446">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +(latestyearTaxCal+1) +
						// &quot;-&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}
<span class="nc" id="L450">					logger.debug(&quot;result not  found in task table &quot;);</span>
<span class="nc" id="L451">					String queryForPlayer = QueryManager</span>
							.getST3LastMonthTransactionDG()
							+ &quot; where  transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime()) + &quot;' &quot;;
<span class="nc" id="L457">					logger.debug(&quot;query-----&quot; + queryForPlayer);</span>
<span class="nc" id="L458">					RSPLR = stmt4.executeQuery(queryForPlayer);</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L461">						double taxAmt = RSPLR</span>
								.getDouble(TableConstants.TAX_AMOUNT);
<span class="nc" id="L463">						logger.debug(&quot;tax amount   from table&quot; + taxAmt);</span>
<span class="nc" id="L464">						taxSum = CommonMethods.fmtToTwoDecimal(taxSum + taxAmt);</span>
<span class="nc" id="L465">						logger.debug(&quot;calculated tax  &quot; + taxSum);</span>

<span class="nc" id="L467">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L475" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L476">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L478">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L480">					String yearfortask = &quot;&quot; + (latestyearTaxCal + 1);</span>
<span class="nc" id="L481">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L483">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L484">					Date taskDate = null;</span>
					try {
<span class="nc" id="L486">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L487">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L489">						e.printStackTrace();</span>
<span class="nc" id="L490">					}</span>
<span class="nc" id="L491">					String queryTaskCreate = QueryManager.getST3CreateTask()</span>
							+ &quot;values('&quot;
							+ taxSum
							+ &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','TDS','UNAPPROVED',CURRENT_DATE, '&quot;
							+ new java.sql.Date(getFirstDay(taskDate).getTime())
							+ &quot;' ,'&quot;
							+ new java.sql.Date(getLastDay(taskDate).getTime())
							+ &quot;','DG')&quot;;
<span class="nc" id="L501">					stmt3.executeUpdate(queryTaskCreate);</span>

				}
			}

<span class="nc bnc" id="L506" title="All 2 branches missed.">			if (YR &gt; latestyearTaxCal + 1) {</span>
<span class="nc" id="L507">				logger.debug(&quot;when diff is more than one&quot;);</span>
<span class="nc bnc" id="L508" title="All 2 branches missed.">				for (int j = latestyearTaxCal; j &lt;= YR; j++) {</span>
<span class="nc" id="L509">					logger.debug(&quot;j::&quot; + j + &quot;  latestyearTaxCal::&quot;</span>
							+ latestyearTaxCal);
<span class="nc bnc" id="L511" title="All 2 branches missed.">					if (j == latestyearTaxCal) {</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">						logger.debug(&quot;j == latestyearTaxCal&quot;</span>
								+ (j == latestyearTaxCal));
<span class="nc" id="L514">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L515">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L517">						Date dd = null;</span>
<span class="nc" id="L518">						Date ddd = null;</span>

<span class="nc bnc" id="L520" title="All 2 branches missed.">						for (int i = latestmonthTaxCal + 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L521">							taxSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L524" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L525">								transaction_date_first = &quot;&quot; + latestyearTaxCal</span>
										+ &quot;-&quot; + &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L528">								transaction_date_first = &quot;&quot; + latestyearTaxCal</span>
										+ &quot;-&quot; + i + &quot;-&quot; + &quot;01&quot;;
							}

<span class="nc bnc" id="L532" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L533">								int day = 1;</span>
<span class="nc" id="L534">								cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L535">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L537">								cal.set(latestyearTaxCal, i - 1, totalday);</span>
								try {
<span class="nc" id="L539">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L541">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L543">									e.printStackTrace();</span>
<span class="nc" id="L544">								}</span>
<span class="nc" id="L545">								cal.setTime(ddd);</span>
<span class="nc" id="L546">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L548">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L549">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +latestyearTaxCal +
								// &quot;-&quot; + &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L553">							} else {</span>
<span class="nc" id="L554">								int day = 1;</span>
<span class="nc" id="L555">								cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L556">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L558">								cal.set(latestyearTaxCal, i - 1, totalday);</span>
								try {
<span class="nc" id="L560">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L562">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L564">									e.printStackTrace();</span>
<span class="nc" id="L565">								}</span>
<span class="nc" id="L566">								cal.setTime(ddd);</span>
<span class="nc" id="L567">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L569">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L570">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +latestyearTaxCal +
								// &quot;-&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

							}

<span class="nc" id="L577">							String queryForPlayer = QueryManager</span>
									.getST3LastMonthTransactionDG()
									+ &quot; where  transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' &quot;;
<span class="nc" id="L584">							RSPLR = stmt3.executeQuery(queryForPlayer);</span>
<span class="nc bnc" id="L585" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L587">								double taxAmt = RSPLR</span>
										.getDouble(TableConstants.TAX_AMOUNT);
<span class="nc" id="L589">								logger</span>
										.debug(&quot;tax amount   from table&quot;
												+ taxAmt);
<span class="nc" id="L592">								taxSum = CommonMethods.fmtToTwoDecimal(taxSum</span>
										+ taxAmt);
<span class="nc" id="L594">								logger.debug(&quot;calculated tax  &quot; + taxSum);</span>

<span class="nc" id="L596">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L605" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L606">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L608">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L610">							String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L611">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L613">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L615">							Date taskDate = null;</span>
							try {
<span class="nc" id="L617">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L618">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L620">								e.printStackTrace();</span>
<span class="nc" id="L621">							}</span>

<span class="nc" id="L623">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTask()
									+ &quot;values('&quot;
									+ taxSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','TDS','UNAPPROVED',CURRENT_DATE, '&quot;
									+ new java.sql.Date(getFirstDay(taskDate)
											.getTime())
									+ &quot;' ,'&quot;
									+ new java.sql.Date(getLastDay(taskDate)
											.getTime()) + &quot;','DG')&quot;;
<span class="nc" id="L635">							stmt3.executeUpdate(queryTaskCreate);</span>
						}

					}

<span class="nc bnc" id="L640" title="All 2 branches missed.">					if (j == YR) {</span>
<span class="nc bnc" id="L641" title="All 2 branches missed.">						logger.debug(&quot;j == YR&quot; + (j == YR));</span>
<span class="nc" id="L642">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L643">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L645">						Date dd = null;</span>
<span class="nc" id="L646">						Date ddd = null;</span>
<span class="nc bnc" id="L647" title="All 2 branches missed.">						for (int i = 1; i &lt; MTH; i++) {</span>
<span class="nc" id="L648">							taxSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L651" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L652">								transaction_date_first = &quot;&quot; + YR + &quot;-&quot; + &quot;0&quot;</span>
										+ i + &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L655">								transaction_date_first = &quot;&quot; + YR + &quot;-&quot; + i</span>
										+ &quot;-&quot; + &quot;01&quot;;
							}

<span class="nc bnc" id="L659" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L660">								int day = 1;</span>
<span class="nc" id="L661">								cal.set(YR, i - 1, day);</span>
<span class="nc" id="L662">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L664">								cal.set(YR, i - 1, totalday);</span>
								try {
<span class="nc" id="L666">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L668">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L670">									e.printStackTrace();</span>
<span class="nc" id="L671">								}</span>
<span class="nc" id="L672">								cal.setTime(ddd);</span>
<span class="nc" id="L673">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L675">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L676">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +YR + &quot;-&quot; + &quot;0&quot;+i
								// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L680">							} else {</span>
<span class="nc" id="L681">								int day = 1;</span>
<span class="nc" id="L682">								cal.set(YR, i - 1, day);</span>
<span class="nc" id="L683">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L685">								cal.set(YR, i - 1, totalday);</span>
								try {
<span class="nc" id="L687">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L689">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L691">									e.printStackTrace();</span>
<span class="nc" id="L692">								}</span>
<span class="nc" id="L693">								cal.setTime(ddd);</span>
<span class="nc" id="L694">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L696">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L697">								dd = cal.getTime();</span>
								// transaction_date_last=&quot;&quot; +YR + &quot;-&quot;+i +&quot;-&quot;+
								// &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
							}

<span class="nc" id="L702">							System.out</span>
									.println(&quot;result not  found in task table &quot;);
<span class="nc" id="L704">							String queryForPlayer = QueryManager</span>
									.getST3LastMonthTransactionDG()
									+ &quot; where  transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' &quot;;
<span class="nc" id="L711">							RSPLR = stmt4.executeQuery(queryForPlayer);</span>
<span class="nc bnc" id="L712" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L714">								double taxAmt = RSPLR</span>
										.getDouble(TableConstants.TAX_AMOUNT);
<span class="nc" id="L716">								logger</span>
										.debug(&quot;tax amount   from table&quot;
												+ taxAmt);
<span class="nc" id="L719">								taxSum = CommonMethods.fmtToTwoDecimal(taxSum</span>
										+ taxAmt);
<span class="nc" id="L721">								logger.debug(&quot;calculated tax  &quot; + taxSum);</span>

<span class="nc" id="L723">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L732" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L733">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L735">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L737">							String yearfortask = &quot;&quot; + YR;</span>
<span class="nc" id="L738">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L740">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L742">							Date taskDate = null;</span>
							try {
<span class="nc" id="L744">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L745">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L747">								e.printStackTrace();</span>
<span class="nc" id="L748">							}</span>
<span class="nc" id="L749">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTask()
									+ &quot;values('&quot;
									+ taxSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','TDS','UNAPPROVED',CURRENT_DATE, '&quot;
									+ new java.sql.Date(getFirstDay(taskDate)
											.getTime())
									+ &quot;' ,'&quot;
									+ new java.sql.Date(getLastDay(taskDate)
											.getTime()) + &quot;','DG')&quot;;
<span class="nc" id="L761">							stmt3.executeUpdate(queryTaskCreate);</span>
						}
					}

<span class="nc bnc" id="L765" title="All 4 branches missed.">					if (j != YR &amp;&amp; j != latestyearTaxCal) {</span>
<span class="nc bnc" id="L766" title="All 2 branches missed.">						logger.debug(&quot;j != YR&quot; + (j != YR));</span>
<span class="nc" id="L767">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L768">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L770">						Date dd = null;</span>
<span class="nc" id="L771">						Date ddd = null;</span>
<span class="nc bnc" id="L772" title="All 2 branches missed.">						for (int i = 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L773">							taxSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L776" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L777">								transaction_date_first = &quot;&quot; + j + &quot;-&quot; + &quot;0&quot; + i</span>
										+ &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L780">								transaction_date_first = &quot;&quot; + j + &quot;-&quot; + i + &quot;-&quot;</span>
										+ &quot;01&quot;;
							}

<span class="nc bnc" id="L784" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L785">								int day = 1;</span>
<span class="nc" id="L786">								cal.set(j, i - 1, day);</span>
<span class="nc" id="L787">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L789">								cal.set(j, i - 1, totalday);</span>
								try {
<span class="nc" id="L791">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L793">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L795">									e.printStackTrace();</span>
<span class="nc" id="L796">								}</span>
<span class="nc" id="L797">								cal.setTime(ddd);</span>
<span class="nc" id="L798">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L800">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L801">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +j + &quot;-&quot; + &quot;0&quot;+i
								// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L806">							} else {</span>
<span class="nc" id="L807">								int day = 1;</span>
<span class="nc" id="L808">								cal.set(j, i - 1, day);</span>
<span class="nc" id="L809">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L811">								cal.set(j, i - 1, totalday);</span>
								try {
<span class="nc" id="L813">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L815">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L817">									e.printStackTrace();</span>
<span class="nc" id="L818">								}</span>
<span class="nc" id="L819">								cal.setTime(ddd);</span>
<span class="nc" id="L820">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L822">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L823">								dd = cal.getTime();</span>
								// transaction_date_last=&quot;&quot; +j + &quot;-&quot;+i +&quot;-&quot;+
								// &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
							}
<span class="nc" id="L827">							System.out</span>
									.println(&quot;result not  found in task table &quot;);
<span class="nc" id="L829">							String queryForPlayer = QueryManager</span>
									.getST3LastMonthTransactionDG()
									+ &quot; where  transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' &quot;;
<span class="nc" id="L836">							RSPLR = stmt4.executeQuery(queryForPlayer);</span>
<span class="nc bnc" id="L837" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L839">								double taxAmt = RSPLR</span>
										.getDouble(TableConstants.TAX_AMOUNT);
<span class="nc" id="L841">								logger</span>
										.debug(&quot;tax amount   from table&quot;
												+ taxAmt);
<span class="nc" id="L844">								taxSum = CommonMethods.fmtToTwoDecimal(taxSum</span>
										+ taxAmt);
<span class="nc" id="L846">								logger.debug(&quot;calculated tax  &quot; + taxSum);</span>

<span class="nc" id="L848">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L857" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L858">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L860">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L862">							String yearfortask = &quot;&quot; + j;</span>
<span class="nc" id="L863">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L865">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L867">							Date taskDate = null;</span>
							try {
<span class="nc" id="L869">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L870">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L872">								e.printStackTrace();</span>
<span class="nc" id="L873">							}</span>

<span class="nc" id="L875">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTask()
									+ &quot;values('&quot;
									+ taxSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','TDS','UNAPPROVED',CURRENT_DATE, '&quot;
									+ new java.sql.Date(getFirstDay(taskDate)
											.getTime())
									+ &quot;' ,'&quot;
									+ new java.sql.Date(getLastDay(taskDate)
											.getTime()) + &quot;','DG')&quot;;
<span class="nc" id="L887">							stmt3.executeUpdate(queryTaskCreate);</span>

						}
					}

				}
			}

<span class="nc" id="L895">			TaskBean taskBean = null;</span>

<span class="nc" id="L897">			List&lt;TaskBean&gt; searchResults = new ArrayList&lt;TaskBean&gt;();</span>
<span class="nc" id="L898">			logger.debug(&quot;333333333333333333hhhhhhhhhhh&quot;);</span>
<span class="nc" id="L899">			ResultSet rs3 = stmt4.executeQuery(QueryManager</span>
					.getUnapprovedTDSDG());

<span class="nc bnc" id="L902" title="All 2 branches missed.">			while (rs3.next()) {</span>
<span class="nc" id="L903">				taskBean = new TaskBean();</span>
<span class="nc" id="L904">				taskBean.setAmount(rs3.getDouble(&quot;amount&quot;));</span>

				// SimpleDateFormat date1 = new
				// SimpleDateFormat(&quot;dd-MM-yyyy&quot;);//it would be the format set
				// by Vineet
				// taskBean.setMonth(date1.format(rs3.getDate(&quot;month&quot;)));
				// logger.debug(&quot;heeeeeeeeeeeeellllllll
				// &quot;+date1.format(rs3.getDate(&quot;month&quot;)) );
<span class="nc" id="L912">				taskBean.setMonth(rs3.getString(TableConstants.MONTH_TASK));</span>
<span class="nc" id="L913">				taskBean.setTransactionType(rs3</span>
						.getString(TableConstants.TASK_TYPE));
<span class="nc" id="L915">				taskBean.setStatus(rs3.getString(TableConstants.TASK_STATUS));</span>
<span class="nc" id="L916">				taskBean.setTaskId(rs3.getInt(TableConstants.TASK_ID));</span>
<span class="nc" id="L917">				taskBean.setServiceCode(&quot;DG&quot;);</span>
<span class="nc" id="L918">				taskBean.setServiceName(serviceName);</span>
<span class="nc" id="L919">				logger.debug(&quot;taskid is   &quot; + rs3.getInt(&quot;task_id&quot;));</span>
				// userBean.setRegisterDate(resultSet.getDate(TableConstants.Register_DATE));
<span class="nc" id="L921">				searchResults.add(taskBean);</span>
			}

<span class="nc" id="L924">			con.commit();</span>
			// removed by arun // con.close(); // added by yogesh at the time of
			// self review
<span class="nc" id="L927">			return searchResults;</span>

<span class="nc" id="L929">		} catch (SQLException e) {</span>

			try {
<span class="nc" id="L932">				con.rollback();</span>
<span class="nc" id="L933">			} catch (SQLException se) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L935">				se.printStackTrace();</span>
<span class="nc" id="L936">				throw new LMSException(&quot;Error During Rollback&quot;, se);</span>
<span class="nc" id="L937">			}</span>
<span class="nc" id="L938">			e.printStackTrace();</span>
<span class="nc" id="L939">			throw new LMSException(e);</span>

			// added by arun
		} finally {
<span class="nc bnc" id="L943" title="All 4 branches missed.">			if (con != null) {</span>
				try {
<span class="nc" id="L945">					con.close();</span>
<span class="nc" id="L946">				} catch (SQLException e) {</span>
<span class="nc" id="L947">					e.printStackTrace();</span>
<span class="nc" id="L948">				}</span>
			}
		}
		// return null;

	}

	/**
	 * This method is used to calculate TDS for a particular month
	 * 
	 * @param month
	 * @param year
	 * @returns the List of TaskBean type
	 * @throws LMSException
	 */
	public List tdsSearchSE(Integer month, Integer year) throws LMSException {
<span class="nc" id="L964">		logger.debug(&quot; tdsSearchSE called&quot;);</span>
<span class="nc" id="L965">		double taxSum = 0;</span>
<span class="nc" id="L966">		boolean tds = false;</span>
<span class="nc" id="L967">		boolean isEntry = false;</span>
<span class="nc" id="L968">		int yearTable = 0;</span>
<span class="nc" id="L969">		int monthTable = 0;</span>

<span class="nc" id="L971">		int latestyearTaxCal = 0;</span>
<span class="nc" id="L972">		int latestmonthTaxCal = 0;</span>

<span class="nc" id="L974">		NumberFormat nf = NumberFormat.getInstance();</span>
<span class="nc" id="L975">		nf.setMaximumFractionDigits(2);</span>
<span class="nc" id="L976">		nf.setMinimumFractionDigits(2);</span>

<span class="nc" id="L978">		SimpleDateFormat date = new SimpleDateFormat();</span>

<span class="nc" id="L980">		Calendar rightNow = Calendar.getInstance();</span>

<span class="nc" id="L982">		int YR = rightNow.get(Calendar.YEAR);</span>
<span class="nc" id="L983">		int MTH = rightNow.get(Calendar.MONTH) + 1;</span>

<span class="nc" id="L985">		int depYear = year;</span>
<span class="nc" id="L986">		int depMonth = month;</span>
<span class="nc" id="L987">		logger.debug(&quot;inside deploy date changed&quot;);</span>

		// int MTH=11;
<span class="nc" id="L990">		logger.debug(&quot;month from system  &quot; + MTH);</span>

<span class="nc" id="L992">		logger.debug(&quot;not depriceted   &quot; + YR);</span>
<span class="nc" id="L993">		logger.debug(&quot;not depriceted   &quot; + MTH);</span>

<span class="nc" id="L995">		Connection con = null;</span>
<span class="nc" id="L996">		String serviceName = &quot;&quot;;</span>
		try {

			 
<span class="nc" id="L1000">			con = DBConnect.getConnection();</span>
<span class="nc" id="L1001">			con.setAutoCommit(false);</span>

<span class="nc" id="L1003">			Statement stmt1 = con.createStatement();</span>
<span class="nc" id="L1004">			Statement stmt2 = con.createStatement();</span>
<span class="nc" id="L1005">			Statement stmt3 = con.createStatement();</span>
<span class="nc" id="L1006">			Statement stmt4 = con.createStatement();</span>
<span class="nc" id="L1007">			Statement stmt5 = con.createStatement();</span>
<span class="nc" id="L1008">			Statement stmt6 = con.createStatement();</span>
<span class="nc" id="L1009">			ResultSet rs = null;</span>
<span class="nc" id="L1010">			ResultSet RSPLR = null;</span>
<span class="nc" id="L1011">			logger.debug(&quot;heeeeeee&quot;);</span>
<span class="nc" id="L1012">			rs = stmt6</span>
					.executeQuery(&quot;select service_display_name from st_lms_service_master where service_code='SE' and status='ACTIVE'&quot;);
<span class="nc bnc" id="L1014" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L1015">				serviceName = rs.getString(&quot;service_display_name&quot;);</span>
			}
<span class="nc" id="L1017">			ResultSet latestMonth = stmt5.executeQuery(QueryManager</span>
					.getLatestMonthTDSSE());
<span class="nc bnc" id="L1019" title="All 2 branches missed.">			while (latestMonth.next()) {</span>
<span class="nc" id="L1020">				Calendar rightNow1 = Calendar.getInstance();</span>

<span class="nc" id="L1022">				Date dt = latestMonth.getDate(&quot;month&quot;);</span>
<span class="nc" id="L1023">				logger.debug(&quot;get date from db &quot; + dt);</span>
<span class="nc" id="L1024">				rightNow1.setTime(dt);</span>
<span class="nc" id="L1025">				latestyearTaxCal = rightNow1.get(Calendar.YEAR);</span>
<span class="nc" id="L1026">				latestmonthTaxCal = rightNow1.get(Calendar.MONTH) + 1;</span>
<span class="nc" id="L1027">				logger.debug(&quot; latest year &quot; + latestyearTaxCal);</span>
<span class="nc" id="L1028">				logger.debug(&quot; latest month &quot; + latestmonthTaxCal);</span>

				/*
				 * String latestDate=latestMonth.getString(&quot;month&quot;); String
				 * latestyear=latestDate.substring(0,4); String
				 * latestmonth=latestDate.substring(5,7);
				 * latestyearTaxCal=Integer.parseInt(latestyear);
				 * latestmonthTaxCal=Integer.parseInt(latestmonth);
				 * 
				 * logger.debug(&quot;latest year from task table &quot; + latestyear);
				 * logger.debug(&quot;latest month from task table &quot; + latestmonth);
				 */
<span class="nc" id="L1040">				isEntry = true;</span>
<span class="nc" id="L1041">				break;</span>

			}

<span class="nc bnc" id="L1045" title="All 2 branches missed.">			if (isEntry == false) {</span>
<span class="nc" id="L1046">				logger.debug(&quot;when no entry for tds&quot;);</span>
<span class="nc" id="L1047">				latestyearTaxCal = depYear;</span>
<span class="nc bnc" id="L1048" title="All 2 branches missed.">				if (depMonth == 01) {</span>
<span class="nc" id="L1049">					latestmonthTaxCal = 00;</span>
				} else {
<span class="nc" id="L1051">					latestmonthTaxCal = depMonth - 1;</span>
				}

			}

<span class="nc bnc" id="L1056" title="All 2 branches missed.">			if (YR == latestyearTaxCal)</span>

			{

<span class="nc" id="L1060">				logger.debug(&quot;inside same year&quot;);</span>
<span class="nc bnc" id="L1061" title="All 2 branches missed.">				for (int i = latestmonthTaxCal + 1; i &lt; MTH; i++) {</span>

<span class="nc" id="L1063">					Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L1064">					SimpleDateFormat dtfmt = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L1065">					Date dd = null;</span>
<span class="nc" id="L1066">					Date newdate = null;</span>
<span class="nc" id="L1067">					taxSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L1070" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L1071">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L1074">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L1078" title="All 2 branches missed.">					if (i &lt; 10)</span>

					{
<span class="nc" id="L1081">						int day = 1;</span>
<span class="nc" id="L1082">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L1083">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1085">						cal.set(latestyearTaxCal, i - 1, totalday);</span>
						try {
<span class="nc" id="L1087">							newdate = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L1088">						} catch (ParseException e) {</span>
<span class="nc" id="L1089">							logger.error(&quot;Exception:&quot; + e);</span>
							// TODO Auto-generated catch block
<span class="nc" id="L1091">							e.printStackTrace();</span>
<span class="nc" id="L1092">						}</span>
<span class="nc" id="L1093">						cal.setTime(newdate);</span>
<span class="nc" id="L1094">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L1095">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1096">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot; +
						// &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L1100">					} else {</span>
<span class="nc" id="L1101">						int day = 1;</span>
<span class="nc" id="L1102">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L1103">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1105">						cal.set(latestyearTaxCal, i - 1, totalday);</span>
						try {
<span class="nc" id="L1107">							newdate = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L1108">						} catch (ParseException e) {</span>
<span class="nc" id="L1109">							logger.error(&quot;Exception:&quot; + e);</span>
							// TODO Auto-generated catch block
<span class="nc" id="L1111">							e.printStackTrace();</span>
<span class="nc" id="L1112">						}</span>
<span class="nc" id="L1113">						cal.setTime(newdate);</span>
<span class="nc" id="L1114">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L1115">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1116">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot;+i
						// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}
<span class="nc" id="L1121">					logger.debug(&quot;9999999999999999999999&quot;);</span>
<span class="nc" id="L1122">					logger.debug(transaction_date_first);</span>
					// logger.debug(transaction_date_last);

<span class="nc" id="L1125">					String queryForPlayer = QueryManager</span>
							.getST3LastMonthTransactionSE()
							+ &quot; where  transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime()) + &quot;' &quot;;
<span class="nc" id="L1131">					logger.debug(&quot;query----&quot; + queryForPlayer);</span>
<span class="nc" id="L1132">					RSPLR = stmt2.executeQuery(queryForPlayer);</span>
<span class="nc bnc" id="L1133" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L1135">						double taxAmt = RSPLR</span>
								.getDouble(TableConstants.TAX_AMOUNT);
<span class="nc" id="L1137">						logger.debug(&quot;tax amount   from table&quot; + taxAmt);</span>
<span class="nc" id="L1138">						taxSum = CommonMethods.fmtToTwoDecimal(taxSum + taxAmt);</span>
<span class="nc" id="L1139">						logger.debug(&quot;calculated tax  &quot; + taxSum);</span>

<span class="nc" id="L1141">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L1149" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L1150">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L1152">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L1154">					String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L1155">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L1157">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L1158">					Date taskDate = null;</span>
					try {
<span class="nc" id="L1160">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L1161">					} catch (ParseException e) {</span>
<span class="nc" id="L1162">						logger.error(&quot;Exception:&quot; + e);</span>
						// TODO Auto-generated catch block
<span class="nc" id="L1164">						e.printStackTrace();</span>
<span class="nc" id="L1165">					}</span>
<span class="nc" id="L1166">					logger.debug(&quot;date to insert &quot; + taskDate);</span>

<span class="nc" id="L1168">					String queryTaskCreate = QueryManager.getST3CreateTask()</span>
							+ &quot;values('&quot;
							+ taxSum
							+ &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','TDS','UNAPPROVED',CURRENT_DATE, '&quot;
							+ new java.sql.Date(getFirstDay(taskDate).getTime())
							+ &quot;' ,'&quot;
							+ new java.sql.Date(getLastDay(taskDate).getTime())
							+ &quot;','SE')&quot;;
<span class="nc" id="L1178">					stmt3.executeUpdate(queryTaskCreate);</span>

				}

			}

<span class="nc bnc" id="L1184" title="All 2 branches missed.">			if (YR == latestyearTaxCal + 1) {</span>
<span class="nc" id="L1185">				logger.debug(&quot;when diff is one&quot;);</span>
<span class="nc" id="L1186">				Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L1187">				SimpleDateFormat dtfmt = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>

<span class="nc bnc" id="L1189" title="All 2 branches missed.">				for (int i = latestmonthTaxCal + 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L1190">					Date dd = null;</span>
<span class="nc" id="L1191">					Date ddd = null;</span>
<span class="nc" id="L1192">					taxSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L1195" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L1196">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L1199">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L1203" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L1204">						int day = 1;</span>
<span class="nc" id="L1205">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L1206">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1208">						cal.set(latestyearTaxCal, i - 1, totalday);</span>

						try {
<span class="nc" id="L1211">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L1212">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L1214">							e.printStackTrace();</span>
<span class="nc" id="L1215">							logger.error(&quot;Exception:&quot; + e);</span>
<span class="nc" id="L1216">						}</span>
<span class="nc" id="L1217">						cal.setTime(ddd);</span>
<span class="nc" id="L1218">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L1219">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1220">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot; +
						// &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L1225">					} else {</span>
<span class="nc" id="L1226">						int day = 1;</span>
<span class="nc" id="L1227">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L1228">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1230">						cal.set(latestyearTaxCal, i - 1, totalday);</span>

						try {
<span class="nc" id="L1233">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L1234">						} catch (ParseException e) {</span>
<span class="nc" id="L1235">							logger.error(&quot;Exception:&quot; + e);</span>
							// TODO Auto-generated catch block
<span class="nc" id="L1237">							e.printStackTrace();</span>
<span class="nc" id="L1238">						}</span>
<span class="nc" id="L1239">						cal.setTime(ddd);</span>
<span class="nc" id="L1240">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L1241">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1242">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot;+i
						// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}

<span class="nc" id="L1248">					String queryForPlayer = QueryManager</span>
							.getST3LastMonthTransactionSE()
							+ &quot; where  transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime()) + &quot;' &quot;;
<span class="nc" id="L1254">					logger.debug(&quot;query----&quot; + queryForPlayer);</span>
<span class="nc" id="L1255">					RSPLR = stmt3.executeQuery(queryForPlayer);</span>
<span class="nc bnc" id="L1256" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L1258">						double taxAmt = RSPLR</span>
								.getDouble(TableConstants.TAX_AMOUNT);
<span class="nc" id="L1260">						logger.debug(&quot;tax amount   from table&quot; + taxAmt);</span>
<span class="nc" id="L1261">						taxSum = CommonMethods.fmtToTwoDecimal(taxSum + taxAmt);</span>
<span class="nc" id="L1262">						logger.debug(&quot;calculated tax  &quot; + taxSum);</span>

<span class="nc" id="L1264">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L1272" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L1273">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L1275">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L1277">					String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L1278">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L1280">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L1281">					Date taskDate = null;</span>
					try {
<span class="nc" id="L1283">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L1284">					} catch (ParseException e) {</span>
<span class="nc" id="L1285">						logger.error(&quot;Exception:&quot; + e);</span>
						// TODO Auto-generated catch block
<span class="nc" id="L1287">						e.printStackTrace();</span>
<span class="nc" id="L1288">					}</span>

<span class="nc" id="L1290">					String queryTaskCreate = QueryManager.getST3CreateTask()</span>
							+ &quot;values('&quot;
							+ taxSum
							+ &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','TDS','UNAPPROVED',CURRENT_DATE, '&quot;
							+ new java.sql.Date(getFirstDay(taskDate).getTime())
							+ &quot;' ,'&quot;
							+ new java.sql.Date(getLastDay(taskDate).getTime())
							+ &quot;','SE')&quot;;
<span class="nc" id="L1300">					stmt3.executeUpdate(queryTaskCreate);</span>

				}

<span class="nc bnc" id="L1304" title="All 2 branches missed.">				for (int i = 1; i &lt; MTH; i++) {</span>
<span class="nc" id="L1305">					Date dd = null;</span>
<span class="nc" id="L1306">					Date ddd = null;</span>
<span class="nc" id="L1307">					taxSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L1310" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L1311">						transaction_date_first = &quot;&quot; + (latestyearTaxCal + 1)</span>
								+ &quot;-&quot; + &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L1314">						transaction_date_first = &quot;&quot; + (latestyearTaxCal + 1)</span>
								+ &quot;-&quot; + i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L1318" title="All 2 branches missed.">					if (i &lt; 10)</span>

					{
<span class="nc" id="L1321">						int day = 1;</span>
<span class="nc" id="L1322">						cal.set(latestyearTaxCal + 1, i - 1, day);</span>
<span class="nc" id="L1323">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1325">						cal.set(latestyearTaxCal + 1, i - 1, totalday);</span>
						try {
<span class="nc" id="L1327">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L1328">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L1330">							e.printStackTrace();</span>
<span class="nc" id="L1331">						}</span>
<span class="nc" id="L1332">						cal.setTime(ddd);</span>
<span class="nc" id="L1333">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L1334">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1335">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +(latestyearTaxCal+1) + &quot;-&quot;
						// + &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L1338">					} else {</span>

<span class="nc" id="L1340">						int day = 1;</span>
<span class="nc" id="L1341">						cal.set(latestyearTaxCal + 1, i - 1, day);</span>
<span class="nc" id="L1342">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1344">						cal.set(latestyearTaxCal + 1, i - 1, totalday);</span>
						try {
<span class="nc" id="L1346">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L1347">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L1349">							e.printStackTrace();</span>
<span class="nc" id="L1350">						}</span>
<span class="nc" id="L1351">						cal.setTime(ddd);</span>
<span class="nc" id="L1352">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L1353">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1354">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +(latestyearTaxCal+1) +
						// &quot;-&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}
<span class="nc" id="L1358">					logger.debug(&quot;result not  found in task table &quot;);</span>
<span class="nc" id="L1359">					String queryForPlayer = QueryManager</span>
							.getST3LastMonthTransactionSE()
							+ &quot; where  transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime()) + &quot;' &quot;;
<span class="nc" id="L1365">					logger.debug(&quot;query-----&quot; + queryForPlayer);</span>
<span class="nc" id="L1366">					RSPLR = stmt4.executeQuery(queryForPlayer);</span>
<span class="nc bnc" id="L1367" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L1369">						double taxAmt = RSPLR</span>
								.getDouble(TableConstants.TAX_AMOUNT);
<span class="nc" id="L1371">						logger.debug(&quot;tax amount   from table&quot; + taxAmt);</span>
<span class="nc" id="L1372">						taxSum = CommonMethods.fmtToTwoDecimal(taxSum + taxAmt);</span>
<span class="nc" id="L1373">						logger.debug(&quot;calculated tax  &quot; + taxSum);</span>

<span class="nc" id="L1375">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L1383" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L1384">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L1386">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L1388">					String yearfortask = &quot;&quot; + (latestyearTaxCal + 1);</span>
<span class="nc" id="L1389">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L1391">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L1392">					Date taskDate = null;</span>
					try {
<span class="nc" id="L1394">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L1395">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L1397">						e.printStackTrace();</span>
<span class="nc" id="L1398">					}</span>
<span class="nc" id="L1399">					String queryTaskCreate = QueryManager.getST3CreateTask()</span>
							+ &quot;values('&quot;
							+ taxSum
							+ &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','TDS','UNAPPROVED',CURRENT_DATE, '&quot;
							+ new java.sql.Date(getFirstDay(taskDate).getTime())
							+ &quot;' ,'&quot;
							+ new java.sql.Date(getLastDay(taskDate).getTime())
							+ &quot;','SE')&quot;;
<span class="nc" id="L1409">					stmt3.executeUpdate(queryTaskCreate);</span>

				}
			}

<span class="nc bnc" id="L1414" title="All 2 branches missed.">			if (YR &gt; latestyearTaxCal + 1) {</span>
<span class="nc" id="L1415">				logger.debug(&quot;when diff is more than one&quot;);</span>
<span class="nc bnc" id="L1416" title="All 2 branches missed.">				for (int j = latestyearTaxCal; j &lt;= YR; j++) {</span>
<span class="nc bnc" id="L1417" title="All 2 branches missed.">					if (j == latestyearTaxCal) {</span>
<span class="nc" id="L1418">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L1419">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L1421">						Date dd = null;</span>
<span class="nc" id="L1422">						Date ddd = null;</span>

<span class="nc bnc" id="L1424" title="All 2 branches missed.">						for (int i = latestmonthTaxCal + 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L1425">							taxSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L1428" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L1429">								transaction_date_first = &quot;&quot; + latestyearTaxCal</span>
										+ &quot;-&quot; + &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L1432">								transaction_date_first = &quot;&quot; + latestyearTaxCal</span>
										+ &quot;-&quot; + i + &quot;-&quot; + &quot;01&quot;;
							}

<span class="nc bnc" id="L1436" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L1437">								int day = 1;</span>
<span class="nc" id="L1438">								cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L1439">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1441">								cal.set(latestyearTaxCal, i - 1, totalday);</span>
								try {
<span class="nc" id="L1443">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L1445">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L1447">									e.printStackTrace();</span>
<span class="nc" id="L1448">								}</span>
<span class="nc" id="L1449">								cal.setTime(ddd);</span>
<span class="nc" id="L1450">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L1452">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1453">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +latestyearTaxCal +
								// &quot;-&quot; + &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L1457">							} else {</span>
<span class="nc" id="L1458">								int day = 1;</span>
<span class="nc" id="L1459">								cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L1460">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1462">								cal.set(latestyearTaxCal, i - 1, totalday);</span>
								try {
<span class="nc" id="L1464">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L1466">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L1468">									e.printStackTrace();</span>
<span class="nc" id="L1469">								}</span>
<span class="nc" id="L1470">								cal.setTime(ddd);</span>
<span class="nc" id="L1471">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L1473">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1474">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +latestyearTaxCal +
								// &quot;-&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

							}

<span class="nc" id="L1481">							String queryForPlayer = QueryManager</span>
									.getST3LastMonthTransactionSE()
									+ &quot; where  transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' &quot;;
<span class="nc" id="L1488">							RSPLR = stmt3.executeQuery(queryForPlayer);</span>
<span class="nc bnc" id="L1489" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L1491">								double taxAmt = RSPLR</span>
										.getDouble(TableConstants.TAX_AMOUNT);
<span class="nc" id="L1493">								logger</span>
										.debug(&quot;tax amount   from table&quot;
												+ taxAmt);
<span class="nc" id="L1496">								taxSum = CommonMethods.fmtToTwoDecimal(taxSum</span>
										+ taxAmt);
<span class="nc" id="L1498">								logger.debug(&quot;calculated tax  &quot; + taxSum);</span>

<span class="nc" id="L1500">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L1509" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L1510">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L1512">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L1514">							String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L1515">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L1517">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L1519">							Date taskDate = null;</span>
							try {
<span class="nc" id="L1521">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L1522">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L1524">								e.printStackTrace();</span>
<span class="nc" id="L1525">							}</span>

<span class="nc" id="L1527">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTask()
									+ &quot;values('&quot;
									+ taxSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','TDS','UNAPPROVED',CURRENT_DATE, '&quot;
									+ new java.sql.Date(getFirstDay(taskDate)
											.getTime())
									+ &quot;' ,'&quot;
									+ new java.sql.Date(getLastDay(taskDate)
											.getTime()) + &quot;','SE')&quot;;
<span class="nc" id="L1539">							stmt3.executeUpdate(queryTaskCreate);</span>
						}

					}

<span class="nc bnc" id="L1544" title="All 2 branches missed.">					if (j == YR) {</span>
<span class="nc" id="L1545">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L1546">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L1548">						Date dd = null;</span>
<span class="nc" id="L1549">						Date ddd = null;</span>
<span class="nc bnc" id="L1550" title="All 2 branches missed.">						for (int i = 1; i &lt; MTH; i++) {</span>
<span class="nc" id="L1551">							taxSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L1554" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L1555">								transaction_date_first = &quot;&quot; + YR + &quot;-&quot; + &quot;0&quot;</span>
										+ i + &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L1558">								transaction_date_first = &quot;&quot; + YR + &quot;-&quot; + i</span>
										+ &quot;-&quot; + &quot;01&quot;;
							}

<span class="nc bnc" id="L1562" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L1563">								int day = 1;</span>
<span class="nc" id="L1564">								cal.set(YR, i - 1, day);</span>
<span class="nc" id="L1565">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1567">								cal.set(YR, i - 1, totalday);</span>
								try {
<span class="nc" id="L1569">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L1571">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L1573">									e.printStackTrace();</span>
<span class="nc" id="L1574">								}</span>
<span class="nc" id="L1575">								cal.setTime(ddd);</span>
<span class="nc" id="L1576">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L1578">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1579">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +YR + &quot;-&quot; + &quot;0&quot;+i
								// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L1583">							} else {</span>
<span class="nc" id="L1584">								int day = 1;</span>
<span class="nc" id="L1585">								cal.set(YR, i - 1, day);</span>
<span class="nc" id="L1586">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1588">								cal.set(YR, i - 1, totalday);</span>
								try {
<span class="nc" id="L1590">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L1592">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L1594">									e.printStackTrace();</span>
<span class="nc" id="L1595">								}</span>
<span class="nc" id="L1596">								cal.setTime(ddd);</span>
<span class="nc" id="L1597">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L1599">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1600">								dd = cal.getTime();</span>
								// transaction_date_last=&quot;&quot; +YR + &quot;-&quot;+i +&quot;-&quot;+
								// &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
							}

<span class="nc" id="L1605">							System.out</span>
									.println(&quot;result not  found in task table &quot;);
<span class="nc" id="L1607">							String queryForPlayer = QueryManager</span>
									.getST3LastMonthTransactionSE()
									+ &quot; where  transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' &quot;;
<span class="nc" id="L1614">							RSPLR = stmt4.executeQuery(queryForPlayer);</span>
<span class="nc bnc" id="L1615" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L1617">								double taxAmt = RSPLR</span>
										.getDouble(TableConstants.TAX_AMOUNT);
<span class="nc" id="L1619">								logger</span>
										.debug(&quot;tax amount   from table&quot;
												+ taxAmt);
<span class="nc" id="L1622">								taxSum = CommonMethods.fmtToTwoDecimal(taxSum</span>
										+ taxAmt);
<span class="nc" id="L1624">								logger.debug(&quot;calculated tax  &quot; + taxSum);</span>

<span class="nc" id="L1626">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L1635" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L1636">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L1638">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L1640">							String yearfortask = &quot;&quot; + YR;</span>
<span class="nc" id="L1641">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L1643">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L1645">							Date taskDate = null;</span>
							try {
<span class="nc" id="L1647">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L1648">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L1650">								e.printStackTrace();</span>
<span class="nc" id="L1651">							}</span>
<span class="nc" id="L1652">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTask()
									+ &quot;values('&quot;
									+ taxSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','TDS','UNAPPROVED',CURRENT_DATE, '&quot;
									+ new java.sql.Date(getFirstDay(taskDate)
											.getTime())
									+ &quot;' ,'&quot;
									+ new java.sql.Date(getLastDay(taskDate)
											.getTime()) + &quot;','SE')&quot;;
<span class="nc" id="L1664">							stmt3.executeUpdate(queryTaskCreate);</span>
						}
					}

<span class="nc bnc" id="L1668" title="All 4 branches missed.">					if (j != YR &amp;&amp; j != latestyearTaxCal) {</span>
<span class="nc" id="L1669">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L1670">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L1672">						Date dd = null;</span>
<span class="nc" id="L1673">						Date ddd = null;</span>
<span class="nc bnc" id="L1674" title="All 2 branches missed.">						for (int i = 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L1675">							taxSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L1678" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L1679">								transaction_date_first = &quot;&quot; + j + &quot;-&quot; + &quot;0&quot; + i</span>
										+ &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L1682">								transaction_date_first = &quot;&quot; + j + &quot;-&quot; + i + &quot;-&quot;</span>
										+ &quot;01&quot;;
							}

<span class="nc bnc" id="L1686" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L1687">								int day = 1;</span>
<span class="nc" id="L1688">								cal.set(j, i - 1, day);</span>
<span class="nc" id="L1689">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1691">								cal.set(j, i - 1, totalday);</span>
								try {
<span class="nc" id="L1693">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L1695">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L1697">									e.printStackTrace();</span>
<span class="nc" id="L1698">								}</span>
<span class="nc" id="L1699">								cal.setTime(ddd);</span>
<span class="nc" id="L1700">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L1702">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1703">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +j + &quot;-&quot; + &quot;0&quot;+i
								// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L1708">							} else {</span>
<span class="nc" id="L1709">								int day = 1;</span>
<span class="nc" id="L1710">								cal.set(j, i - 1, day);</span>
<span class="nc" id="L1711">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1713">								cal.set(j, i - 1, totalday);</span>
								try {
<span class="nc" id="L1715">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L1717">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L1719">									e.printStackTrace();</span>
<span class="nc" id="L1720">								}</span>
<span class="nc" id="L1721">								cal.setTime(ddd);</span>
<span class="nc" id="L1722">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L1724">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1725">								dd = cal.getTime();</span>
								// transaction_date_last=&quot;&quot; +j + &quot;-&quot;+i +&quot;-&quot;+
								// &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
							}
<span class="nc" id="L1729">							System.out</span>
									.println(&quot;result not  found in task table &quot;);
<span class="nc" id="L1731">							String queryForPlayer = QueryManager</span>
									.getST3LastMonthTransactionSE()
									+ &quot; where  transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' &quot;;
<span class="nc" id="L1738">							RSPLR = stmt4.executeQuery(queryForPlayer);</span>
<span class="nc bnc" id="L1739" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L1741">								double taxAmt = RSPLR</span>
										.getDouble(TableConstants.TAX_AMOUNT);
<span class="nc" id="L1743">								logger</span>
										.debug(&quot;tax amount   from table&quot;
												+ taxAmt);
<span class="nc" id="L1746">								taxSum = CommonMethods.fmtToTwoDecimal(taxSum</span>
										+ taxAmt);
<span class="nc" id="L1748">								logger.debug(&quot;calculated tax  &quot; + taxSum);</span>

<span class="nc" id="L1750">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L1759" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L1760">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L1762">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L1764">							String yearfortask = &quot;&quot; + j;</span>
<span class="nc" id="L1765">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L1767">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L1769">							Date taskDate = null;</span>
							try {
<span class="nc" id="L1771">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L1772">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L1774">								e.printStackTrace();</span>
<span class="nc" id="L1775">							}</span>

<span class="nc" id="L1777">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTask()
									+ &quot;values('&quot;
									+ taxSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','TDS','UNAPPROVED',CURRENT_DATE, '&quot;
									+ new java.sql.Date(getFirstDay(taskDate)
											.getTime())
									+ &quot;' ,'&quot;
									+ new java.sql.Date(getLastDay(taskDate)
											.getTime()) + &quot;','SE')&quot;;
<span class="nc" id="L1789">							stmt3.executeUpdate(queryTaskCreate);</span>

						}
					}

				}
			}

<span class="nc" id="L1797">			TaskBean taskBean = null;</span>

<span class="nc" id="L1799">			List&lt;TaskBean&gt; searchResults = new ArrayList&lt;TaskBean&gt;();</span>
<span class="nc" id="L1800">			logger.debug(&quot;333333333333333333hhhhhhhhhhh&quot;);</span>
<span class="nc" id="L1801">			ResultSet rs3 = stmt4.executeQuery(QueryManager</span>
					.getUnapprovedTDSSE());

<span class="nc bnc" id="L1804" title="All 2 branches missed.">			while (rs3.next()) {</span>
<span class="nc" id="L1805">				taskBean = new TaskBean();</span>
<span class="nc" id="L1806">				taskBean.setAmount(rs3.getDouble(&quot;amount&quot;));</span>

				// SimpleDateFormat date1 = new
				// SimpleDateFormat(&quot;dd-MM-yyyy&quot;);//it would be the format set
				// by Vineet
				// taskBean.setMonth(date1.format(rs3.getDate(&quot;month&quot;)));
				// logger.debug(&quot;heeeeeeeeeeeeellllllll
				// &quot;+date1.format(rs3.getDate(&quot;month&quot;)) );
<span class="nc" id="L1814">				taskBean.setMonth(rs3.getString(TableConstants.MONTH_TASK));</span>
<span class="nc" id="L1815">				taskBean.setTransactionType(rs3</span>
						.getString(TableConstants.TASK_TYPE));
<span class="nc" id="L1817">				taskBean.setStatus(rs3.getString(TableConstants.TASK_STATUS));</span>
<span class="nc" id="L1818">				taskBean.setTaskId(rs3.getInt(TableConstants.TASK_ID));</span>
<span class="nc" id="L1819">				taskBean.setServiceCode(&quot;SE&quot;);</span>
<span class="nc" id="L1820">				taskBean.setServiceName(serviceName);</span>
<span class="nc" id="L1821">				logger.debug(&quot;taskid is   &quot; + rs3.getInt(&quot;task_id&quot;));</span>
				// userBean.setRegisterDate(resultSet.getDate(TableConstants.Register_DATE));
<span class="nc" id="L1823">				searchResults.add(taskBean);</span>
			}

<span class="nc" id="L1826">			con.commit();</span>
			// removed by arun // con.close(); // added by yogesh at the time of
			// self review
<span class="nc" id="L1829">			return searchResults;</span>

<span class="nc" id="L1831">		} catch (SQLException e) {</span>

			try {
<span class="nc" id="L1834">				con.rollback();</span>
<span class="nc" id="L1835">			} catch (SQLException se) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L1837">				se.printStackTrace();</span>
<span class="nc" id="L1838">				throw new LMSException(&quot;Error During Rollback&quot;, se);</span>
<span class="nc" id="L1839">			}</span>
<span class="nc" id="L1840">			e.printStackTrace();</span>
<span class="nc" id="L1841">			throw new LMSException(e);</span>

			// added by arun
		} finally {
<span class="nc bnc" id="L1845" title="All 4 branches missed.">			if (con != null) {</span>
				try {
<span class="nc" id="L1847">					con.close();</span>
<span class="nc" id="L1848">				} catch (SQLException e) {</span>
<span class="nc" id="L1849">					e.printStackTrace();</span>
<span class="nc" id="L1850">				}</span>
			}
		}
		// return null;

	}

	public List vatSearchDG(Integer month, Integer year) throws LMSException {
<span class="nc" id="L1858">		logger.debug(&quot;vatSearchDG called&quot;);</span>
<span class="nc" id="L1859">		double vatSum = 0;</span>
<span class="nc" id="L1860">		boolean tds = false;</span>
<span class="nc" id="L1861">		boolean isEntry = false;</span>
<span class="nc" id="L1862">		int yearTable = 0;</span>
<span class="nc" id="L1863">		int monthTable = 0;</span>

<span class="nc" id="L1865">		int latestyearTaxCal = 0;</span>
<span class="nc" id="L1866">		int latestmonthTaxCal = 0;</span>

<span class="nc" id="L1868">		NumberFormat nf = NumberFormat.getInstance();</span>
<span class="nc" id="L1869">		nf.setMaximumFractionDigits(2);</span>
<span class="nc" id="L1870">		nf.setMinimumFractionDigits(2);</span>

<span class="nc" id="L1872">		SimpleDateFormat date = new SimpleDateFormat();</span>

<span class="nc" id="L1874">		Calendar rightNow = Calendar.getInstance();</span>

<span class="nc" id="L1876">		int YR = rightNow.get(Calendar.YEAR);</span>
<span class="nc" id="L1877">		int MTH = rightNow.get(Calendar.MONTH) + 1;</span>

<span class="nc" id="L1879">		int depYear = year;</span>
<span class="nc" id="L1880">		int depMonth = month;</span>
<span class="nc" id="L1881">		logger.debug(&quot;inside deploy date changed&quot;);</span>

		// int MTH=11;
<span class="nc" id="L1884">		logger.debug(&quot;month from system  &quot; + MTH);</span>

<span class="nc" id="L1886">		logger.debug(&quot;not depriceted   &quot; + YR);</span>
<span class="nc" id="L1887">		logger.debug(&quot;not depriceted   &quot; + MTH);</span>

<span class="nc" id="L1889">		Connection con = null;</span>
<span class="nc" id="L1890">		String serviceName = &quot;&quot;;</span>
		try {

			 
<span class="nc" id="L1894">			con = DBConnect.getConnection();</span>
<span class="nc" id="L1895">			con.setAutoCommit(false);</span>

<span class="nc" id="L1897">			Statement stmt1 = con.createStatement();</span>
<span class="nc" id="L1898">			Statement stmt2 = con.createStatement();</span>
<span class="nc" id="L1899">			Statement stmt3 = con.createStatement();</span>
<span class="nc" id="L1900">			Statement stmt4 = con.createStatement();</span>
<span class="nc" id="L1901">			Statement stmt5 = con.createStatement();</span>
<span class="nc" id="L1902">			PreparedStatement ps6 = con</span>
					.prepareStatement(&quot;select service_display_name from st_lms_service_master where service_code='DG' and status='ACTIVE'&quot;);

<span class="nc" id="L1905">			ResultSet rs = null, rs6 = null;</span>
<span class="nc" id="L1906">			rs6 = ps6.executeQuery();</span>
<span class="nc bnc" id="L1907" title="All 2 branches missed.">			if (rs6.next()) {</span>
<span class="nc" id="L1908">				serviceName = rs6.getString(&quot;service_display_name&quot;);</span>
			} else {
<span class="nc" id="L1910">				serviceName = &quot;&quot;;</span>
			}

<span class="nc" id="L1913">			ResultSet RSPLR = null;</span>
<span class="nc" id="L1914">			logger.debug(&quot;heeeeeee&quot;);</span>

<span class="nc" id="L1916">			ResultSet latestMonth = stmt5.executeQuery(QueryManager</span>
					.getLatestMonthVATDG());
<span class="nc bnc" id="L1918" title="All 2 branches missed.">			while (latestMonth.next()) {</span>
<span class="nc" id="L1919">				Calendar rightNow1 = Calendar.getInstance();</span>

<span class="nc" id="L1921">				Date dt = latestMonth.getDate(&quot;month&quot;);</span>
<span class="nc" id="L1922">				logger.debug(&quot;get date from db &quot; + dt);</span>
<span class="nc" id="L1923">				rightNow1.setTime(dt);</span>
<span class="nc" id="L1924">				latestyearTaxCal = rightNow1.get(Calendar.YEAR);</span>
<span class="nc" id="L1925">				latestmonthTaxCal = rightNow1.get(Calendar.MONTH) + 1;</span>
<span class="nc" id="L1926">				logger.debug(&quot; latest year &quot; + latestyearTaxCal);</span>
<span class="nc" id="L1927">				logger.debug(&quot; latest month &quot; + latestmonthTaxCal);</span>

				/*
				 * String latestDate=latestMonth.getString(&quot;month&quot;); String
				 * latestyear=latestDate.substring(0,4); String
				 * latestmonth=latestDate.substring(5,7);
				 * latestyearTaxCal=Integer.parseInt(latestyear);
				 * latestmonthTaxCal=Integer.parseInt(latestmonth);
				 * 
				 * logger.debug(&quot;latest year from task table &quot; + latestyear);
				 * logger.debug(&quot;latest month from task table &quot; + latestmonth);
				 */
<span class="nc" id="L1939">				isEntry = true;</span>
<span class="nc" id="L1940">				break;</span>

			}

<span class="nc bnc" id="L1944" title="All 2 branches missed.">			if (isEntry == false) {</span>
<span class="nc" id="L1945">				logger.debug(&quot;when no entry for VAT&quot;);</span>
<span class="nc" id="L1946">				latestyearTaxCal = depYear;</span>
<span class="nc bnc" id="L1947" title="All 2 branches missed.">				if (depMonth == 01) {</span>
<span class="nc" id="L1948">					latestmonthTaxCal = 00;</span>
				} else {
<span class="nc" id="L1950">					latestmonthTaxCal = depMonth - 1;</span>
				}

			}

<span class="nc bnc" id="L1955" title="All 2 branches missed.">			if (YR == latestyearTaxCal)</span>

			{
<span class="nc" id="L1958">				logger.debug(&quot;inside same year&quot;);</span>
<span class="nc bnc" id="L1959" title="All 2 branches missed.">				for (int i = latestmonthTaxCal + 1; i &lt; MTH; i++) {</span>

<span class="nc" id="L1961">					Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L1962">					SimpleDateFormat dtfmt = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L1963">					Date dd = null;</span>
<span class="nc" id="L1964">					Date newdate = null;</span>
<span class="nc" id="L1965">					vatSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L1968" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L1969">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L1972">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L1976" title="All 2 branches missed.">					if (i &lt; 10)</span>

					{
<span class="nc" id="L1979">						int day = 1;</span>
<span class="nc" id="L1980">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L1981">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1983">						cal.set(latestyearTaxCal, i - 1, totalday);</span>
						try {
<span class="nc" id="L1985">							newdate = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L1986">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L1988">							e.printStackTrace();</span>
<span class="nc" id="L1989">						}</span>
<span class="nc" id="L1990">						cal.setTime(newdate);</span>
<span class="nc" id="L1991">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L1992">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1993">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot; +
						// &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L1997">					} else {</span>
<span class="nc" id="L1998">						int day = 1;</span>
<span class="nc" id="L1999">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L2000">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L2002">						cal.set(latestyearTaxCal, i - 1, totalday);</span>
						try {
<span class="nc" id="L2004">							newdate = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L2005">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L2007">							e.printStackTrace();</span>
<span class="nc" id="L2008">						}</span>
<span class="nc" id="L2009">						cal.setTime(newdate);</span>
<span class="nc" id="L2010">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L2011">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L2012">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot;+i
						// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}

<span class="nc" id="L2018">					String queryForBoAgtVat = &quot;select sum(vatAmt) vatAmt from (select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;+ transaction_date_first+ &quot;' and transaction_date &lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('DG_SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_dg_bo_sale_refund sbat where sbtm.transaction_date &gt;= '&quot;+ transaction_date_first+ &quot;' and transaction_date &lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('DG_REFUND_CANCEL','DG_REFUND_FAILED') and sbat.transaction_id=sbtm.transaction_id) sale_ret) union all select (sum(sale_vat-ref_vat)) vatAmt from st_rep_dg_bo where finaldate &gt;= '&quot;+ transaction_date_first+ &quot;' and finaldate&lt; '2012-11-01 00:00:00.0')sd&quot;;</span>
<span class="nc" id="L2019">					System.out</span>
							.println(&quot;query---- for vat calculation ???????????  &quot;
									+ queryForBoAgtVat);
<span class="nc" id="L2022">					RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L2023" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L2025">						double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L2026">						logger.debug(&quot;vat amount   from table&quot; + vatAmt);</span>
<span class="nc" id="L2027">						vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L2028">						System.out</span>
								.println(&quot;calculated vat is    @@  &quot; + vatSum);

<span class="nc" id="L2031">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L2039" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L2040">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L2042">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L2044">					String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L2045">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L2047">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L2048">					Date taskDate = null;</span>
					try {
<span class="nc" id="L2050">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L2051">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L2053">						e.printStackTrace();</span>
<span class="nc" id="L2054">					}</span>
<span class="nc" id="L2055">					logger.debug(&quot;date to insert &quot; + taskDate);</span>

<span class="nc" id="L2057">					String queryTaskCreate = QueryManager.getST3CreateTask()</span>
							+ &quot;values('&quot;
							+ vatSum
							+ &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
							+ new java.sql.Date(getFirstDay(taskDate).getTime())
							+ &quot;' ,'&quot;
							+ new java.sql.Date(getLastDay(taskDate).getTime())
							+ &quot;','DG')&quot;;
<span class="nc" id="L2067">					stmt3.executeUpdate(queryTaskCreate);</span>

				}

			}

<span class="nc bnc" id="L2073" title="All 2 branches missed.">			if (YR == latestyearTaxCal + 1) {</span>
<span class="nc" id="L2074">				logger.debug(&quot;when diff is one&quot;);</span>
<span class="nc" id="L2075">				Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L2076">				SimpleDateFormat dtfmt = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>

<span class="nc bnc" id="L2078" title="All 2 branches missed.">				for (int i = latestmonthTaxCal + 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L2079">					Date dd = null;</span>
<span class="nc" id="L2080">					Date ddd = null;</span>
<span class="nc" id="L2081">					vatSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L2084" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L2085">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L2088">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L2092" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L2093">						int day = 1;</span>
<span class="nc" id="L2094">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L2095">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L2097">						cal.set(latestyearTaxCal, i - 1, totalday);</span>

						try {
<span class="nc" id="L2100">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L2101">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L2103">							e.printStackTrace();</span>
<span class="nc" id="L2104">						}</span>
<span class="nc" id="L2105">						cal.setTime(ddd);</span>
<span class="nc" id="L2106">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L2107">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L2108">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot; +
						// &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L2113">					} else {</span>
<span class="nc" id="L2114">						int day = 1;</span>
<span class="nc" id="L2115">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L2116">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L2118">						cal.set(latestyearTaxCal, i - 1, totalday);</span>

						try {
<span class="nc" id="L2121">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L2122">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L2124">							e.printStackTrace();</span>
<span class="nc" id="L2125">						}</span>
<span class="nc" id="L2126">						cal.setTime(ddd);</span>
<span class="nc" id="L2127">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L2128">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L2129">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot;+i
						// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}

					// String queryForBoAgtVat=&quot;select (sale.vat_amt -
					// sale_ret.vat_amt) vatAmt from ((select sum(sbat.vat_amt)
					// vat_amt from st_lms_bo_transaction_master
					// sbtm,st_se_bo_agent_transaction sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and sbtm.transaction_type in
					// ('SALE') and sbat.transaction_id=sbtm.transaction_id)
					// sale,(select sum(sbat.vat_amt) vat_amt from
					// st_lms_bo_transaction_master
					// sbtm,st_se_bo_agent_transaction sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and sbtm.transaction_type in
					// ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id)
					// sale_ret)&quot;;
<span class="nc" id="L2153">					String queryForBoAgtVat = &quot;select sum(vatAmt) vatAmt from (select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;+ transaction_date_first+ &quot;' and transaction_date &lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('DG_SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_dg_bo_sale_refund sbat where sbtm.transaction_date &gt;= '&quot;+ transaction_date_first+ &quot;' and transaction_date &lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('DG_REFUND_CANCEL','DG_REFUND_FAILED') and sbat.transaction_id=sbtm.transaction_id) sale_ret) union all select (sum(sale_vat)-sum(ref_vat)) vatAmt from st_rep_dg_bo where finaldate &gt;=  '&quot;+ transaction_date_first+ &quot;' and finaldate&lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;')sd&quot;;</span>
					// String
					// queryForPlayer=QueryManager.getST3LastMonthTransaction()
					// + &quot; where transaction_date &gt;=
					// '&quot;+transaction_date_first+&quot;' and transaction_date &lt;
					// '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L2159">					System.out</span>
							.println(&quot;query---- for vat calculation ???????????  &quot;
									+ queryForBoAgtVat);
<span class="nc" id="L2162">					RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L2163" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L2165">						double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L2166">						logger.debug(&quot;vat amount   from table&quot; + vatAmt);</span>
<span class="nc" id="L2167">						vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L2168">						System.out</span>
								.println(&quot;calculated vat is    @@  &quot; + vatSum);

<span class="nc" id="L2171">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L2179" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L2180">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L2182">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L2184">					String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L2185">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L2187">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L2188">					Date taskDate = null;</span>
					try {
<span class="nc" id="L2190">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L2191">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L2193">						e.printStackTrace();</span>
<span class="nc" id="L2194">					}</span>

<span class="nc" id="L2196">					String queryTaskCreate = QueryManager.getST3CreateTask()</span>
							+ &quot;values('&quot;
							+ vatSum
							+ &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
							+ new java.sql.Date(getFirstDay(taskDate).getTime())
							+ &quot;' ,'&quot;
							+ new java.sql.Date(getLastDay(taskDate).getTime())
							+ &quot;','DG')&quot;;
<span class="nc" id="L2206">					stmt3.executeUpdate(queryTaskCreate);</span>

				}

<span class="nc bnc" id="L2210" title="All 2 branches missed.">				for (int i = 1; i &lt; MTH; i++) {</span>
<span class="nc" id="L2211">					Date dd = null;</span>
<span class="nc" id="L2212">					Date ddd = null;</span>
<span class="nc" id="L2213">					vatSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L2216" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L2217">						transaction_date_first = &quot;&quot; + (latestyearTaxCal + 1)</span>
								+ &quot;-&quot; + &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L2220">						transaction_date_first = &quot;&quot; + (latestyearTaxCal + 1)</span>
								+ &quot;-&quot; + i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L2224" title="All 2 branches missed.">					if (i &lt; 10)</span>

					{
<span class="nc" id="L2227">						int day = 1;</span>
<span class="nc" id="L2228">						cal.set(latestyearTaxCal + 1, i - 1, day);</span>
<span class="nc" id="L2229">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L2231">						cal.set(latestyearTaxCal + 1, i - 1, totalday);</span>
						try {
<span class="nc" id="L2233">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L2234">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L2236">							e.printStackTrace();</span>
<span class="nc" id="L2237">						}</span>
<span class="nc" id="L2238">						cal.setTime(ddd);</span>
<span class="nc" id="L2239">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L2240">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L2241">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +(latestyearTaxCal+1) + &quot;-&quot;
						// + &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L2244">					} else {</span>

<span class="nc" id="L2246">						int day = 1;</span>
<span class="nc" id="L2247">						cal.set(latestyearTaxCal + 1, i - 1, day);</span>
<span class="nc" id="L2248">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L2250">						cal.set(latestyearTaxCal + 1, i - 1, totalday);</span>
						try {
<span class="nc" id="L2252">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L2253">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L2255">							e.printStackTrace();</span>
<span class="nc" id="L2256">						}</span>
<span class="nc" id="L2257">						cal.setTime(ddd);</span>
<span class="nc" id="L2258">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L2259">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L2260">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +(latestyearTaxCal+1) +
						// &quot;-&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}
<span class="nc" id="L2264">					logger.debug(&quot;result not  found in task table &quot;);</span>
					// String queryForBoAgtVat=&quot;select (sale.vat_amt -
					// sale_ret.vat_amt) vatAmt from ((select sum(sbat.vat_amt)
					// vat_amt from st_lms_bo_transaction_master
					// sbtm,st_se_bo_agent_transaction sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and sbtm.transaction_type in
					// ('SALE') and sbat.transaction_id=sbtm.transaction_id)
					// sale,(select sum(sbat.vat_amt) vat_amt from
					// st_lms_bo_transaction_master
					// sbtm,st_se_bo_agent_transaction sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and sbtm.transaction_type in
					// ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id)
					// sale_ret)&quot;;
<span class="nc" id="L2283">					String queryForBoAgtVat = &quot;select sum(vatAmt) vatAmt from (select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;+ transaction_date_first+ &quot;' and transaction_date &lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('DG_SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_dg_bo_sale_refund sbat where sbtm.transaction_date &gt;= '&quot;+ transaction_date_first+ &quot;' and transaction_date &lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('DG_REFUND_CANCEL','DG_REFUND_FAILED') and sbat.transaction_id=sbtm.transaction_id) sale_ret) union all select (sum(sale_vat)-sum(ref_vat)) vatAmt from st_rep_dg_bo where finaldate &gt;=  '&quot;+ transaction_date_first+ &quot;' and finaldate&lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;')sd&quot;;</span>
					// String
					// queryForPlayer=QueryManager.getST3LastMonthTransaction()
					// + &quot; where transaction_date &gt;=
					// '&quot;+transaction_date_first+&quot;' and transaction_date &lt;
					// '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L2289">					System.out</span>
							.println(&quot;query---- for vat calculation ???????????  &quot;
									+ queryForBoAgtVat);
<span class="nc" id="L2292">					RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L2293" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L2295">						double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L2296">						logger.debug(&quot;vat amount   from table&quot; + vatAmt);</span>
<span class="nc" id="L2297">						vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L2298">						System.out</span>
								.println(&quot;calculated vat is    @@  &quot; + vatSum);

<span class="nc" id="L2301">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L2309" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L2310">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L2312">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L2314">					String yearfortask = &quot;&quot; + (latestyearTaxCal + 1);</span>
<span class="nc" id="L2315">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L2317">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L2318">					Date taskDate = null;</span>
					try {
<span class="nc" id="L2320">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L2321">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L2323">						e.printStackTrace();</span>
<span class="nc" id="L2324">					}</span>
<span class="nc" id="L2325">					String queryTaskCreate = QueryManager.getST3CreateTask()</span>
							+ &quot;values('&quot;
							+ vatSum
							+ &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
							+ new java.sql.Date(getFirstDay(taskDate).getTime())
							+ &quot;' ,'&quot;
							+ new java.sql.Date(getLastDay(taskDate).getTime())
							+ &quot;','DG')&quot;;
<span class="nc" id="L2335">					stmt3.executeUpdate(queryTaskCreate);</span>

				}
			}

<span class="nc bnc" id="L2340" title="All 2 branches missed.">			if (YR &gt; latestyearTaxCal + 1) {</span>
<span class="nc" id="L2341">				logger.debug(&quot;when diff is more then one&quot;);</span>
<span class="nc bnc" id="L2342" title="All 2 branches missed.">				for (int j = latestyearTaxCal; j &lt;= YR; j++) {</span>
<span class="nc bnc" id="L2343" title="All 2 branches missed.">					if (j == latestyearTaxCal) {</span>
<span class="nc" id="L2344">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L2345">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L2347">						Date dd = null;</span>
<span class="nc" id="L2348">						Date ddd = null;</span>

<span class="nc bnc" id="L2350" title="All 2 branches missed.">						for (int i = latestmonthTaxCal + 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L2351">							vatSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L2354" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L2355">								transaction_date_first = &quot;&quot; + latestyearTaxCal</span>
										+ &quot;-&quot; + &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L2358">								transaction_date_first = &quot;&quot; + latestyearTaxCal</span>
										+ &quot;-&quot; + i + &quot;-&quot; + &quot;01&quot;;
							}

<span class="nc bnc" id="L2362" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L2363">								int day = 1;</span>
<span class="nc" id="L2364">								cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L2365">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L2367">								cal.set(latestyearTaxCal, i - 1, totalday);</span>
								try {
<span class="nc" id="L2369">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L2371">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L2373">									e.printStackTrace();</span>
<span class="nc" id="L2374">								}</span>
<span class="nc" id="L2375">								cal.setTime(ddd);</span>
<span class="nc" id="L2376">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L2378">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L2379">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +latestyearTaxCal +
								// &quot;-&quot; + &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L2383">							} else {</span>
<span class="nc" id="L2384">								int day = 1;</span>
<span class="nc" id="L2385">								cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L2386">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L2388">								cal.set(latestyearTaxCal, i - 1, totalday);</span>
								try {
<span class="nc" id="L2390">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L2392">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L2394">									e.printStackTrace();</span>
<span class="nc" id="L2395">								}</span>
<span class="nc" id="L2396">								cal.setTime(ddd);</span>
<span class="nc" id="L2397">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L2399">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L2400">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +latestyearTaxCal +
								// &quot;-&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

							}
							// String queryForBoAgtVat=&quot;select (sale.vat_amt -
							// sale_ret.vat_amt) vatAmt from ((select
							// sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale,(select sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE_RET') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale_ret)&quot;;
<span class="nc" id="L2427">							String queryForBoAgtVat = &quot;select sum(vatAmt) vatAmt from (select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;+ transaction_date_first+ &quot;' and transaction_date &lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('DG_SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_dg_bo_sale_refund sbat where sbtm.transaction_date &gt;= '&quot;+ transaction_date_first+ &quot;' and transaction_date &lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('DG_REFUND_CANCEL','DG_REFUND_FAILED') and sbat.transaction_id=sbtm.transaction_id) sale_ret) union all select (sum(sale_vat)-sum(ref_vat)) vatAmt from st_rep_dg_bo where finaldate &gt;=  '&quot;+ transaction_date_first+ &quot;' and finaldate&lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;')sd&quot;;</span>
							// String
							// queryForPlayer=QueryManager.getST3LastMonthTransaction()
							// + &quot; where transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L2433">							System.out</span>
									.println(&quot;query---- for vat calculation ???????????  &quot;
											+ queryForBoAgtVat);
<span class="nc" id="L2436">							RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L2437" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L2439">								double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L2440">								logger</span>
										.debug(&quot;vat amount   from table&quot;
												+ vatAmt);
<span class="nc" id="L2443">								vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L2444">								logger.debug(&quot;calculated vat is    @@  &quot;</span>
										+ vatSum);

<span class="nc" id="L2447">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L2456" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L2457">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L2459">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L2461">							String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L2462">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L2464">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L2466">							Date taskDate = null;</span>
							try {
<span class="nc" id="L2468">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L2469">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L2471">								e.printStackTrace();</span>
<span class="nc" id="L2472">							}</span>

<span class="nc" id="L2474">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTask()
									+ &quot;values('&quot;
									+ vatSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
									+ new java.sql.Date(getFirstDay(taskDate)
											.getTime())
									+ &quot;' ,'&quot;
									+ new java.sql.Date(getLastDay(taskDate)
											.getTime()) + &quot;','DG')&quot;;
<span class="nc" id="L2486">							stmt3.executeUpdate(queryTaskCreate);</span>
						}

					}

<span class="nc bnc" id="L2491" title="All 2 branches missed.">					if (j == YR) {</span>
<span class="nc" id="L2492">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L2493">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L2495">						Date dd = null;</span>
<span class="nc" id="L2496">						Date ddd = null;</span>
<span class="nc bnc" id="L2497" title="All 2 branches missed.">						for (int i = 1; i &lt; MTH; i++) {</span>
<span class="nc" id="L2498">							vatSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L2501" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L2502">								transaction_date_first = &quot;&quot; + YR + &quot;-&quot; + &quot;0&quot;</span>
										+ i + &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L2505">								transaction_date_first = &quot;&quot; + YR + &quot;-&quot; + i</span>
										+ &quot;-&quot; + &quot;01&quot;;
							}

<span class="nc bnc" id="L2509" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L2510">								int day = 1;</span>
<span class="nc" id="L2511">								cal.set(YR, i - 1, day);</span>
<span class="nc" id="L2512">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L2514">								cal.set(YR, i - 1, totalday);</span>
								try {
<span class="nc" id="L2516">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L2518">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L2520">									e.printStackTrace();</span>
<span class="nc" id="L2521">								}</span>
<span class="nc" id="L2522">								cal.setTime(ddd);</span>
<span class="nc" id="L2523">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L2525">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L2526">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +YR + &quot;-&quot; + &quot;0&quot;+i
								// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L2530">							} else {</span>
<span class="nc" id="L2531">								int day = 1;</span>
<span class="nc" id="L2532">								cal.set(YR, i - 1, day);</span>
<span class="nc" id="L2533">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L2535">								cal.set(YR, i - 1, totalday);</span>
								try {
<span class="nc" id="L2537">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L2539">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L2541">									e.printStackTrace();</span>
<span class="nc" id="L2542">								}</span>
<span class="nc" id="L2543">								cal.setTime(ddd);</span>
<span class="nc" id="L2544">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L2546">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L2547">								dd = cal.getTime();</span>
								// transaction_date_last=&quot;&quot; +YR + &quot;-&quot;+i +&quot;-&quot;+
								// &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
							}

<span class="nc" id="L2552">							System.out</span>
									.println(&quot;result not  found in task table &quot;);
							// String queryForBoAgtVat=&quot;select (sale.vat_amt -
							// sale_ret.vat_amt) vatAmt from ((select
							// sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale,(select sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE_RET') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale_ret)&quot;;
<span class="nc" id="L2575">							String queryForBoAgtVat = &quot;select sum(vatAmt) vatAmt from (select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;+ transaction_date_first+ &quot;' and transaction_date &lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('DG_SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_dg_bo_sale_refund sbat where sbtm.transaction_date &gt;= '&quot;	+ transaction_date_first+ &quot;' and transaction_date &lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('DG_REFUND_CANCEL','DG_REFUND_FAILED') and sbat.transaction_id=sbtm.transaction_id) sale_ret) union all select (sum(sale_vat)-sum(ref_vat)) vatAmt from st_rep_dg_bo where finaldate &gt;=  '&quot;+ transaction_date_first+ &quot;' and finaldate&lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;')sd&quot;;</span>
							// String
							// queryForPlayer=QueryManager.getST3LastMonthTransaction()
							// + &quot; where transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L2581">							System.out</span>
									.println(&quot;query---- for vat calculation ???????????  &quot;
											+ queryForBoAgtVat);
<span class="nc" id="L2584">							RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L2585" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L2587">								double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L2588">								logger</span>
										.debug(&quot;vat amount   from table&quot;
												+ vatAmt);
<span class="nc" id="L2591">								vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L2592">								logger.debug(&quot;calculated vat is    @@  &quot;</span>
										+ vatSum);

<span class="nc" id="L2595">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L2604" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L2605">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L2607">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L2609">							String yearfortask = &quot;&quot; + YR;</span>
<span class="nc" id="L2610">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L2612">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L2614">							Date taskDate = null;</span>
							try {
<span class="nc" id="L2616">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L2617">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L2619">								e.printStackTrace();</span>
<span class="nc" id="L2620">							}</span>
<span class="nc" id="L2621">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTask()
									+ &quot;values('&quot;
									+ vatSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
									+ new java.sql.Date(getFirstDay(taskDate)
											.getTime())
									+ &quot;' ,'&quot;
									+ new java.sql.Date(getLastDay(taskDate)
											.getTime()) + &quot;','DG')&quot;;
<span class="nc" id="L2633">							stmt3.executeUpdate(queryTaskCreate);</span>
						}
					}

<span class="nc bnc" id="L2637" title="All 4 branches missed.">					if (j != YR &amp;&amp; j != latestyearTaxCal) {</span>
<span class="nc" id="L2638">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L2639">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L2641">						Date dd = null;</span>
<span class="nc" id="L2642">						Date ddd = null;</span>
<span class="nc bnc" id="L2643" title="All 2 branches missed.">						for (int i = 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L2644">							vatSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L2647" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L2648">								transaction_date_first = &quot;&quot; + j + &quot;-&quot; + &quot;0&quot; + i</span>
										+ &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L2651">								transaction_date_first = &quot;&quot; + j + &quot;-&quot; + i + &quot;-&quot;</span>
										+ &quot;01&quot;;
							}

<span class="nc bnc" id="L2655" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L2656">								int day = 1;</span>
<span class="nc" id="L2657">								cal.set(j, i - 1, day);</span>
<span class="nc" id="L2658">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L2660">								cal.set(j, i - 1, totalday);</span>
								try {
<span class="nc" id="L2662">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L2664">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L2666">									e.printStackTrace();</span>
<span class="nc" id="L2667">								}</span>
<span class="nc" id="L2668">								cal.setTime(ddd);</span>
<span class="nc" id="L2669">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L2671">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L2672">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +j + &quot;-&quot; + &quot;0&quot;+i
								// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L2677">							} else {</span>
<span class="nc" id="L2678">								int day = 1;</span>
<span class="nc" id="L2679">								cal.set(j, i - 1, day);</span>
<span class="nc" id="L2680">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L2682">								cal.set(j, i - 1, totalday);</span>
								try {
<span class="nc" id="L2684">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L2686">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L2688">									e.printStackTrace();</span>
<span class="nc" id="L2689">								}</span>
<span class="nc" id="L2690">								cal.setTime(ddd);</span>
<span class="nc" id="L2691">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L2693">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L2694">								dd = cal.getTime();</span>
								// transaction_date_last=&quot;&quot; +j + &quot;-&quot;+i +&quot;-&quot;+
								// &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
							}
<span class="nc" id="L2698">							System.out</span>
									.println(&quot;result not  found in task table &quot;);
							// String queryForBoAgtVat=&quot;select (sale.vat_amt -
							// sale_ret.vat_amt) vatAmt from ((select
							// sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale,(select sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE_RET') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale_ret)&quot;;
<span class="nc" id="L2721">							String queryForBoAgtVat = &quot;select sum(vatAmt) vatAmt from (select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;+ transaction_date_first+ &quot;' and transaction_date &lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('DG_SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_dg_bo_sale_refund sbat where sbtm.transaction_date &gt;= '&quot;	+ transaction_date_first+ &quot;' and transaction_date &lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('DG_REFUND_CANCEL','DG_REFUND_FAILED') and sbat.transaction_id=sbtm.transaction_id) sale_ret) union all select (sum(sale_vat)-sum(ref_vat)) vatAmt from st_rep_dg_bo where finaldate &gt;=  '&quot;+ transaction_date_first+ &quot;' and finaldate&lt; '&quot;+ new java.sql.Timestamp(dd.getTime())+ &quot;')sd&quot;;</span>
							// String
							// queryForPlayer=QueryManager.getST3LastMonthTransaction()
							// + &quot; where transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L2727">							System.out</span>
									.println(&quot;query---- for vat calculation ???????????  &quot;
											+ queryForBoAgtVat);
<span class="nc" id="L2730">							RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L2731" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L2733">								double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L2734">								logger</span>
										.debug(&quot;vat amount   from table&quot;
												+ vatAmt);
<span class="nc" id="L2737">								vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L2738">								logger.debug(&quot;calculated vat is    @@  &quot;</span>
										+ vatSum);

<span class="nc" id="L2741">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L2750" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L2751">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L2753">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L2755">							String yearfortask = &quot;&quot; + j;</span>
<span class="nc" id="L2756">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L2758">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L2760">							Date taskDate = null;</span>
							try {
<span class="nc" id="L2762">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L2763">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L2765">								e.printStackTrace();</span>
<span class="nc" id="L2766">							}</span>

<span class="nc" id="L2768">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTask()
									+ &quot;values('&quot;
									+ vatSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
									+ new java.sql.Date(getFirstDay(taskDate)
											.getTime())
									+ &quot;' ,'&quot;
									+ new java.sql.Date(getLastDay(taskDate)
											.getTime()) + &quot;','DG')&quot;;
<span class="nc" id="L2780">							stmt3.executeUpdate(queryTaskCreate);</span>

						}
					}

				}
			}

<span class="nc" id="L2788">			TaskBean taskBean = null;</span>

<span class="nc" id="L2790">			List&lt;TaskBean&gt; searchResults = new ArrayList&lt;TaskBean&gt;();</span>
<span class="nc" id="L2791">			logger.debug(&quot;333333333333333333hhhhhhhhhhh&quot;);</span>
<span class="nc" id="L2792">			ResultSet rs3 = stmt4.executeQuery(QueryManager</span>
					.getUnapprovedVATDG());

<span class="nc bnc" id="L2795" title="All 2 branches missed.">			while (rs3.next()) {</span>
<span class="nc" id="L2796">				taskBean = new TaskBean();</span>
<span class="nc" id="L2797">				taskBean.setAmount(rs3.getDouble(&quot;amount&quot;));</span>

				// SimpleDateFormat date1 = new
				// SimpleDateFormat(&quot;dd-MM-yyyy&quot;);//it would be the format set
				// by Vineet
				// taskBean.setMonth(date1.format(rs3.getDate(&quot;month&quot;)));
				// logger.debug(&quot;heeeeeeeeeeeeellllllll
				// &quot;+date1.format(rs3.getDate(&quot;month&quot;)) );
<span class="nc" id="L2805">				taskBean.setMonth(rs3.getString(TableConstants.MONTH_TASK));</span>
<span class="nc" id="L2806">				taskBean.setTransactionType(rs3</span>
						.getString(TableConstants.TASK_TYPE));
<span class="nc" id="L2808">				taskBean.setStatus(rs3.getString(TableConstants.TASK_STATUS));</span>
<span class="nc" id="L2809">				taskBean.setTaskId(rs3.getInt(TableConstants.TASK_ID));</span>
<span class="nc" id="L2810">				taskBean.setServiceCode(rs3.getString(&quot;service_code&quot;));</span>
<span class="nc" id="L2811">				taskBean.setServiceName(serviceName);</span>
<span class="nc" id="L2812">				logger.debug(&quot;taskid is   &quot; + rs3.getInt(&quot;task_id&quot;));</span>
				// userBean.setRegisterDate(resultSet.getDate(TableConstants.Register_DATE));
<span class="nc" id="L2814">				searchResults.add(taskBean);</span>
			}

<span class="nc" id="L2817">			con.commit();</span>
<span class="nc" id="L2818">			con.close(); // added by yogesh at the time of self review</span>
<span class="nc" id="L2819">			return searchResults;</span>

<span class="nc" id="L2821">		} catch (SQLException e) {</span>
<span class="nc" id="L2822">			logger.error(&quot;Exception:&quot; + e);</span>
			try {
<span class="nc" id="L2824">				con.rollback();</span>
<span class="nc" id="L2825">			} catch (SQLException se) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L2827">				logger.error(&quot;Exception:&quot; + se);</span>
<span class="nc" id="L2828">				se.printStackTrace();</span>
<span class="nc" id="L2829">				throw new LMSException(&quot;Error During Rollback&quot;, se);</span>
<span class="nc" id="L2830">			}</span>
<span class="nc" id="L2831">			e.printStackTrace();</span>
<span class="nc" id="L2832">			throw new LMSException(e);</span>

		}
		// return null;

	}

	//

	public List vatSearchSE(Integer month, Integer year) throws LMSException,
			ParseException {
<span class="nc" id="L2843">		logger.debug(&quot;vatSearchSE called&quot;);</span>
<span class="nc" id="L2844">		double vatSum = 0;</span>
<span class="nc" id="L2845">		boolean tds = false;</span>
<span class="nc" id="L2846">		boolean isEntry = false;</span>
<span class="nc" id="L2847">		int yearTable = 0;</span>
<span class="nc" id="L2848">		int monthTable = 0;</span>

<span class="nc" id="L2850">		int latestyearTaxCal = 0;</span>
<span class="nc" id="L2851">		int latestmonthTaxCal = 0;</span>

<span class="nc" id="L2853">		NumberFormat nf = NumberFormat.getInstance();</span>
<span class="nc" id="L2854">		nf.setMaximumFractionDigits(2);</span>
<span class="nc" id="L2855">		nf.setMinimumFractionDigits(2);</span>

<span class="nc" id="L2857">		SimpleDateFormat date = new SimpleDateFormat();</span>

<span class="nc" id="L2859">		Calendar rightNow = Calendar.getInstance();</span>

<span class="nc" id="L2861">		int YR = rightNow.get(Calendar.YEAR);</span>
<span class="nc" id="L2862">		int MTH = rightNow.get(Calendar.MONTH) + 1;</span>

<span class="nc" id="L2864">		int depYear = year;</span>
<span class="nc" id="L2865">		int depMonth = month;</span>
<span class="nc" id="L2866">		logger.debug(&quot;inside deploy date changed&quot;);</span>

		// int MTH=11;
<span class="nc" id="L2869">		logger.debug(&quot;month from system  &quot; + MTH);</span>

<span class="nc" id="L2871">		logger.debug(&quot;not depriceted   &quot; + YR);</span>
<span class="nc" id="L2872">		logger.debug(&quot;not depriceted   &quot; + MTH);</span>

<span class="nc" id="L2874">		Connection con = null;</span>
<span class="nc" id="L2875">		String serviceName = &quot;&quot;;</span>
		try {

			 
<span class="nc" id="L2879">			con = DBConnect.getConnection();</span>
<span class="nc" id="L2880">			con.setAutoCommit(false);</span>

<span class="nc" id="L2882">			Statement stmt1 = con.createStatement();</span>
<span class="nc" id="L2883">			Statement stmt2 = con.createStatement();</span>
<span class="nc" id="L2884">			Statement stmt3 = con.createStatement();</span>
<span class="nc" id="L2885">			Statement stmt4 = con.createStatement();</span>
<span class="nc" id="L2886">			Statement stmt5 = con.createStatement();</span>
<span class="nc" id="L2887">			PreparedStatement ps6 = con</span>
					.prepareStatement(&quot;select service_display_name from st_lms_service_master where service_code='SE' and status='ACTIVE'&quot;);
<span class="nc" id="L2889">			ResultSet rs = null, rs6 = null;</span>

<span class="nc" id="L2891">			ResultSet RSPLR = null;</span>
<span class="nc" id="L2892">			logger.debug(&quot;heeeeeee&quot;);</span>

<span class="nc" id="L2894">			rs6 = ps6.executeQuery();</span>
<span class="nc bnc" id="L2895" title="All 2 branches missed.">			if (rs6.next()) {</span>
<span class="nc" id="L2896">				serviceName = rs6.getString(&quot;service_display_name&quot;);</span>
			} else {
<span class="nc" id="L2898">				serviceName = &quot;&quot;;</span>
			}
<span class="nc" id="L2900">			ResultSet latestMonth = stmt5.executeQuery(QueryManager</span>
					.getLatestMonthVATSE());
<span class="nc bnc" id="L2902" title="All 2 branches missed.">			while (latestMonth.next()) {</span>
<span class="nc" id="L2903">				Calendar rightNow1 = Calendar.getInstance();</span>
<span class="nc" id="L2904">				Date dt = latestMonth.getDate(&quot;month&quot;);</span>
<span class="nc" id="L2905">				logger.debug(&quot;get date from db &quot; + dt);</span>
<span class="nc" id="L2906">				rightNow1.setTime(dt);</span>
<span class="nc" id="L2907">				latestyearTaxCal = rightNow1.get(Calendar.YEAR);</span>
<span class="nc" id="L2908">				latestmonthTaxCal = rightNow1.get(Calendar.MONTH) + 1;</span>
<span class="nc" id="L2909">				logger.debug(&quot; latest year &quot; + latestyearTaxCal);</span>
<span class="nc" id="L2910">				logger.debug(&quot; latest month &quot; + latestmonthTaxCal);</span>

				/*
				 * String latestDate=latestMonth.getString(&quot;month&quot;); String
				 * latestyear=latestDate.substring(0,4); String
				 * latestmonth=latestDate.substring(5,7);
				 * latestyearTaxCal=Integer.parseInt(latestyear);
				 * latestmonthTaxCal=Integer.parseInt(latestmonth);
				 * 
				 * logger.debug(&quot;latest year from task table &quot; + latestyear);
				 * logger.debug(&quot;latest month from task table &quot; + latestmonth);
				 */
<span class="nc" id="L2922">				isEntry = true;</span>
<span class="nc" id="L2923">				break;</span>

			}

<span class="nc bnc" id="L2927" title="All 2 branches missed.">			if (isEntry == false) {</span>
<span class="nc" id="L2928">				logger.debug(&quot;when no entry for VAT&quot;);</span>
<span class="nc" id="L2929">				latestyearTaxCal = depYear;</span>
<span class="nc bnc" id="L2930" title="All 2 branches missed.">				if (depMonth == 01) {</span>
<span class="nc" id="L2931">					latestmonthTaxCal = 00;</span>
				} else {
<span class="nc" id="L2933">					latestmonthTaxCal = depMonth - 1;</span>
				}

			}

<span class="nc bnc" id="L2938" title="All 2 branches missed.">			if (YR == latestyearTaxCal)</span>

			{

<span class="nc" id="L2942">				logger.debug(&quot;inside same year&quot;);</span>
<span class="nc bnc" id="L2943" title="All 2 branches missed.">				for (int i = latestmonthTaxCal + 1; i &lt; MTH; i++) {</span>

<span class="nc" id="L2945">					Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L2946">					SimpleDateFormat dtfmt = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L2947">					Date dd = null;</span>
<span class="nc" id="L2948">					Date newdate = null;</span>
<span class="nc" id="L2949">					vatSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L2952" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L2953">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L2956">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L2960" title="All 2 branches missed.">					if (i &lt; 10)</span>

					{
<span class="nc" id="L2963">						int day = 1;</span>
<span class="nc" id="L2964">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L2965">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L2967">						cal.set(latestyearTaxCal, i - 1, totalday);</span>
						try {
<span class="nc" id="L2969">							newdate = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L2970">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L2972">							e.printStackTrace();</span>
<span class="nc" id="L2973">						}</span>
<span class="nc" id="L2974">						cal.setTime(newdate);</span>
<span class="nc" id="L2975">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L2976">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L2977">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot; +
						// &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L2981">					} else {</span>
<span class="nc" id="L2982">						int day = 1;</span>
<span class="nc" id="L2983">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L2984">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L2986">						cal.set(latestyearTaxCal, i - 1, totalday);</span>
						try {
<span class="nc" id="L2988">							newdate = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L2989">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L2991">							e.printStackTrace();</span>
<span class="nc" id="L2992">						}</span>
<span class="nc" id="L2993">						cal.setTime(newdate);</span>
<span class="nc" id="L2994">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L2995">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L2996">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot;+i
						// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}
<span class="nc" id="L3001">					logger.debug(&quot;9999999999999999999999&quot;);</span>
<span class="nc" id="L3002">					logger.debug(transaction_date_first);</span>
					// logger.debug(transaction_date_last);

<span class="nc" id="L3005">					String queryForBoAgtVat = &quot;select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;</span>
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id) sale_ret)&quot;;

					// String
					// queryForPlayer=QueryManager.getST3LastMonthTransaction()
					// + &quot; where transaction_date &gt;=
					// '&quot;+transaction_date_first+&quot;' and transaction_date &lt;
					// '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L3020">					System.out</span>
							.println(&quot;query---- for vat calculation ???????????  &quot;
									+ queryForBoAgtVat);
<span class="nc" id="L3023">					RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L3024" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L3026">						double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L3027">						logger.debug(&quot;vat amount   from table&quot; + vatAmt);</span>
<span class="nc" id="L3028">						vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L3029">						System.out</span>
								.println(&quot;calculated vat is    @@  &quot; + vatSum);

<span class="nc" id="L3032">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L3040" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L3041">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L3043">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L3045">					String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L3046">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L3048">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L3049">					Date taskDate = null;</span>
					try {
<span class="nc" id="L3051">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L3052">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L3054">						e.printStackTrace();</span>
<span class="nc" id="L3055">					}</span>
<span class="nc" id="L3056">					logger.debug(&quot;date to insert &quot; + taskDate);</span>

<span class="nc" id="L3058">					String queryTaskCreate = QueryManager.getST3CreateTask()</span>
							+ &quot;values('&quot;
							+ vatSum
							+ &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
							+ new java.sql.Date(getFirstDay(taskDate).getTime())
							+ &quot;' ,'&quot;
							+ new java.sql.Date(getLastDay(taskDate).getTime())
							+ &quot;','SE')&quot;;
<span class="nc" id="L3068">					stmt3.executeUpdate(queryTaskCreate);</span>

				}

			}

<span class="nc bnc" id="L3074" title="All 2 branches missed.">			if (YR == latestyearTaxCal + 1) {</span>
<span class="nc" id="L3075">				logger.debug(&quot;when diff is one&quot;);</span>
<span class="nc" id="L3076">				Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L3077">				SimpleDateFormat dtfmt = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>

<span class="nc bnc" id="L3079" title="All 2 branches missed.">				for (int i = latestmonthTaxCal + 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L3080">					Date dd = null;</span>
<span class="nc" id="L3081">					Date ddd = null;</span>
<span class="nc" id="L3082">					vatSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L3085" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L3086">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L3089">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L3093" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L3094">						int day = 1;</span>
<span class="nc" id="L3095">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L3096">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L3098">						cal.set(latestyearTaxCal, i - 1, totalday);</span>

						try {
<span class="nc" id="L3101">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L3102">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L3104">							e.printStackTrace();</span>
<span class="nc" id="L3105">						}</span>
<span class="nc" id="L3106">						cal.setTime(ddd);</span>
<span class="nc" id="L3107">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L3108">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L3109">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot; +
						// &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L3114">					} else {</span>
<span class="nc" id="L3115">						int day = 1;</span>
<span class="nc" id="L3116">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L3117">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L3119">						cal.set(latestyearTaxCal, i - 1, totalday);</span>

						try {
<span class="nc" id="L3122">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L3123">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L3125">							e.printStackTrace();</span>
<span class="nc" id="L3126">						}</span>
<span class="nc" id="L3127">						cal.setTime(ddd);</span>
<span class="nc" id="L3128">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L3129">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L3130">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot;+i
						// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}

					// String queryForBoAgtVat=&quot;select (sale.vat_amt -
					// sale_ret.vat_amt) vatAmt from ((select sum(sbat.vat_amt)
					// vat_amt from st_lms_bo_transaction_master
					// sbtm,st_se_bo_agent_transaction sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and sbtm.transaction_type in
					// ('SALE') and sbat.transaction_id=sbtm.transaction_id)
					// sale,(select sum(sbat.vat_amt) vat_amt from
					// st_lms_bo_transaction_master
					// sbtm,st_se_bo_agent_transaction sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and sbtm.transaction_type in
					// ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id)
					// sale_ret)&quot;;
<span class="nc" id="L3154">					String queryForBoAgtVat = &quot;select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;</span>
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id) sale_ret)&quot;;
					// String
					// queryForPlayer=QueryManager.getST3LastMonthTransaction()
					// + &quot; where transaction_date &gt;=
					// '&quot;+transaction_date_first+&quot;' and transaction_date &lt;
					// '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L3168">					System.out</span>
							.println(&quot;query---- for vat calculation ???????????  &quot;
									+ queryForBoAgtVat);
<span class="nc" id="L3171">					RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L3172" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L3174">						double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L3175">						logger.debug(&quot;vat amount   from table&quot; + vatAmt);</span>
<span class="nc" id="L3176">						vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L3177">						System.out</span>
								.println(&quot;calculated vat is    @@  &quot; + vatSum);

<span class="nc" id="L3180">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L3188" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L3189">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L3191">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L3193">					String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L3194">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L3196">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L3197">					Date taskDate = null;</span>
					try {
<span class="nc" id="L3199">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L3200">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L3202">						e.printStackTrace();</span>
<span class="nc" id="L3203">					}</span>

<span class="nc" id="L3205">					String queryTaskCreate = QueryManager.getST3CreateTask()</span>
							+ &quot;values('&quot;
							+ vatSum
							+ &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
							+ new java.sql.Date(getFirstDay(taskDate).getTime())
							+ &quot;' ,'&quot;
							+ new java.sql.Date(getLastDay(taskDate).getTime())
							+ &quot;','SE')&quot;;
<span class="nc" id="L3215">					stmt3.executeUpdate(queryTaskCreate);</span>

				}

<span class="nc bnc" id="L3219" title="All 2 branches missed.">				for (int i = 1; i &lt; MTH; i++) {</span>
<span class="nc" id="L3220">					Date dd = null;</span>
<span class="nc" id="L3221">					Date ddd = null;</span>
<span class="nc" id="L3222">					vatSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L3225" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L3226">						transaction_date_first = &quot;&quot; + (latestyearTaxCal + 1)</span>
								+ &quot;-&quot; + &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L3229">						transaction_date_first = &quot;&quot; + (latestyearTaxCal + 1)</span>
								+ &quot;-&quot; + i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L3233" title="All 2 branches missed.">					if (i &lt; 10)</span>

					{
<span class="nc" id="L3236">						int day = 1;</span>
<span class="nc" id="L3237">						cal.set(latestyearTaxCal + 1, i - 1, day);</span>
<span class="nc" id="L3238">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L3240">						cal.set(latestyearTaxCal + 1, i - 1, totalday);</span>
						try {
<span class="nc" id="L3242">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L3243">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L3245">							e.printStackTrace();</span>
<span class="nc" id="L3246">						}</span>
<span class="nc" id="L3247">						cal.setTime(ddd);</span>
<span class="nc" id="L3248">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L3249">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L3250">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +(latestyearTaxCal+1) + &quot;-&quot;
						// + &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L3253">					} else {</span>

<span class="nc" id="L3255">						int day = 1;</span>
<span class="nc" id="L3256">						cal.set(latestyearTaxCal + 1, i - 1, day);</span>
<span class="nc" id="L3257">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L3259">						cal.set(latestyearTaxCal + 1, i - 1, totalday);</span>
						try {
<span class="nc" id="L3261">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L3262">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L3264">							e.printStackTrace();</span>
<span class="nc" id="L3265">						}</span>
<span class="nc" id="L3266">						cal.setTime(ddd);</span>
<span class="nc" id="L3267">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L3268">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L3269">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +(latestyearTaxCal+1) +
						// &quot;-&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}
<span class="nc" id="L3273">					logger.debug(&quot;result not  found in task table &quot;);</span>
					// String queryForBoAgtVat=&quot;select (sale.vat_amt -
					// sale_ret.vat_amt) vatAmt from ((select sum(sbat.vat_amt)
					// vat_amt from st_lms_bo_transaction_master
					// sbtm,st_se_bo_agent_transaction sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and sbtm.transaction_type in
					// ('SALE') and sbat.transaction_id=sbtm.transaction_id)
					// sale,(select sum(sbat.vat_amt) vat_amt from
					// st_lms_bo_transaction_master
					// sbtm,st_se_bo_agent_transaction sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and sbtm.transaction_type in
					// ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id)
					// sale_ret)&quot;;
<span class="nc" id="L3292">					String queryForBoAgtVat = &quot;select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;</span>
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id) sale_ret)&quot;;
					// String
					// queryForPlayer=QueryManager.getST3LastMonthTransaction()
					// + &quot; where transaction_date &gt;=
					// '&quot;+transaction_date_first+&quot;' and transaction_date &lt;
					// '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L3306">					System.out</span>
							.println(&quot;query---- for vat calculation ???????????  &quot;
									+ queryForBoAgtVat);
<span class="nc" id="L3309">					RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L3310" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L3312">						double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L3313">						logger.debug(&quot;vat amount   from table&quot; + vatAmt);</span>
<span class="nc" id="L3314">						vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L3315">						System.out</span>
								.println(&quot;calculated vat is    @@  &quot; + vatSum);

<span class="nc" id="L3318">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L3326" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L3327">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L3329">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L3331">					String yearfortask = &quot;&quot; + (latestyearTaxCal + 1);</span>
<span class="nc" id="L3332">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L3334">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L3335">					Date taskDate = null;</span>
					try {
<span class="nc" id="L3337">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L3338">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L3340">						e.printStackTrace();</span>
<span class="nc" id="L3341">					}</span>
<span class="nc" id="L3342">					String queryTaskCreate = QueryManager.getST3CreateTask()</span>
							+ &quot;values('&quot;
							+ vatSum
							+ &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
							+ new java.sql.Date(getFirstDay(taskDate).getTime())
							+ &quot;' ,'&quot;
							+ new java.sql.Date(getLastDay(taskDate).getTime())
							+ &quot;','SE')&quot;;
<span class="nc" id="L3352">					stmt3.executeUpdate(queryTaskCreate);</span>

				}
			}

<span class="nc bnc" id="L3357" title="All 2 branches missed.">			if (YR &gt; latestyearTaxCal + 1) {</span>
<span class="nc" id="L3358">				logger.debug(&quot;when diff is more then one&quot;);</span>
<span class="nc bnc" id="L3359" title="All 2 branches missed.">				for (int j = latestyearTaxCal; j &lt;= YR; j++) {</span>
<span class="nc bnc" id="L3360" title="All 2 branches missed.">					if (j == latestyearTaxCal) {</span>
<span class="nc" id="L3361">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L3362">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L3364">						Date dd = null;</span>
<span class="nc" id="L3365">						Date ddd = null;</span>

<span class="nc bnc" id="L3367" title="All 2 branches missed.">						for (int i = latestmonthTaxCal + 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L3368">							vatSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L3371" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L3372">								transaction_date_first = &quot;&quot; + latestyearTaxCal</span>
										+ &quot;-&quot; + &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L3375">								transaction_date_first = &quot;&quot; + latestyearTaxCal</span>
										+ &quot;-&quot; + i + &quot;-&quot; + &quot;01&quot;;
							}

<span class="nc bnc" id="L3379" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L3380">								int day = 1;</span>
<span class="nc" id="L3381">								cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L3382">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L3384">								cal.set(latestyearTaxCal, i - 1, totalday);</span>
								try {
<span class="nc" id="L3386">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L3388">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L3390">									e.printStackTrace();</span>
<span class="nc" id="L3391">								}</span>
<span class="nc" id="L3392">								cal.setTime(ddd);</span>
<span class="nc" id="L3393">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L3395">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L3396">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +latestyearTaxCal +
								// &quot;-&quot; + &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L3400">							} else {</span>
<span class="nc" id="L3401">								int day = 1;</span>
<span class="nc" id="L3402">								cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L3403">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L3405">								cal.set(latestyearTaxCal, i - 1, totalday);</span>
								try {
<span class="nc" id="L3407">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L3409">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L3411">									e.printStackTrace();</span>
<span class="nc" id="L3412">								}</span>
<span class="nc" id="L3413">								cal.setTime(ddd);</span>
<span class="nc" id="L3414">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L3416">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L3417">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +latestyearTaxCal +
								// &quot;-&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

							}
							// String queryForBoAgtVat=&quot;select (sale.vat_amt -
							// sale_ret.vat_amt) vatAmt from ((select
							// sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale,(select sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE_RET') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale_ret)&quot;;
<span class="nc" id="L3444">							String queryForBoAgtVat = &quot;select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;</span>
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id) sale_ret)&quot;;
							// String
							// queryForPlayer=QueryManager.getST3LastMonthTransaction()
							// + &quot; where transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L3458">							System.out</span>
									.println(&quot;query---- for vat calculation ???????????  &quot;
											+ queryForBoAgtVat);
<span class="nc" id="L3461">							RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L3462" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L3464">								double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L3465">								logger</span>
										.debug(&quot;vat amount   from table&quot;
												+ vatAmt);
<span class="nc" id="L3468">								vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L3469">								logger.debug(&quot;calculated vat is    @@  &quot;</span>
										+ vatSum);

<span class="nc" id="L3472">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L3481" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L3482">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L3484">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L3486">							String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L3487">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L3489">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L3491">							Date taskDate = null;</span>
							try {
<span class="nc" id="L3493">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L3494">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L3496">								e.printStackTrace();</span>
<span class="nc" id="L3497">							}</span>

<span class="nc" id="L3499">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTask()
									+ &quot;values('&quot;
									+ vatSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
									+ new java.sql.Date(getFirstDay(taskDate)
											.getTime())
									+ &quot;' ,'&quot;
									+ new java.sql.Date(getLastDay(taskDate)
											.getTime()) + &quot;','SE')&quot;;
<span class="nc" id="L3511">							stmt3.executeUpdate(queryTaskCreate);</span>
						}

					}

<span class="nc bnc" id="L3516" title="All 2 branches missed.">					if (j == YR) {</span>
<span class="nc" id="L3517">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L3518">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L3520">						Date dd = null;</span>
<span class="nc" id="L3521">						Date ddd = null;</span>
<span class="nc bnc" id="L3522" title="All 2 branches missed.">						for (int i = 1; i &lt; MTH; i++) {</span>
<span class="nc" id="L3523">							vatSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L3526" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L3527">								transaction_date_first = &quot;&quot; + YR + &quot;-&quot; + &quot;0&quot;</span>
										+ i + &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L3530">								transaction_date_first = &quot;&quot; + YR + &quot;-&quot; + i</span>
										+ &quot;-&quot; + &quot;01&quot;;
							}

<span class="nc bnc" id="L3534" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L3535">								int day = 1;</span>
<span class="nc" id="L3536">								cal.set(YR, i - 1, day);</span>
<span class="nc" id="L3537">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L3539">								cal.set(YR, i - 1, totalday);</span>
								try {
<span class="nc" id="L3541">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L3543">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L3545">									e.printStackTrace();</span>
<span class="nc" id="L3546">								}</span>
<span class="nc" id="L3547">								cal.setTime(ddd);</span>
<span class="nc" id="L3548">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L3550">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L3551">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +YR + &quot;-&quot; + &quot;0&quot;+i
								// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L3555">							} else {</span>
<span class="nc" id="L3556">								int day = 1;</span>
<span class="nc" id="L3557">								cal.set(YR, i - 1, day);</span>
<span class="nc" id="L3558">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L3560">								cal.set(YR, i - 1, totalday);</span>
								try {
<span class="nc" id="L3562">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L3564">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L3566">									e.printStackTrace();</span>
<span class="nc" id="L3567">								}</span>
<span class="nc" id="L3568">								cal.setTime(ddd);</span>
<span class="nc" id="L3569">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L3571">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L3572">								dd = cal.getTime();</span>
								// transaction_date_last=&quot;&quot; +YR + &quot;-&quot;+i +&quot;-&quot;+
								// &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
							}

<span class="nc" id="L3577">							System.out</span>
									.println(&quot;result not  found in task table &quot;);
							// String queryForBoAgtVat=&quot;select (sale.vat_amt -
							// sale_ret.vat_amt) vatAmt from ((select
							// sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale,(select sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE_RET') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale_ret)&quot;;
<span class="nc" id="L3600">							String queryForBoAgtVat = &quot;select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;</span>
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id) sale_ret)&quot;;
							// String
							// queryForPlayer=QueryManager.getST3LastMonthTransaction()
							// + &quot; where transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L3614">							System.out</span>
									.println(&quot;query---- for vat calculation ???????????  &quot;
											+ queryForBoAgtVat);
<span class="nc" id="L3617">							RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L3618" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L3620">								double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L3621">								logger</span>
										.debug(&quot;vat amount   from table&quot;
												+ vatAmt);
<span class="nc" id="L3624">								vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L3625">								logger.debug(&quot;calculated vat is    @@  &quot;</span>
										+ vatSum);

<span class="nc" id="L3628">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L3637" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L3638">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L3640">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L3642">							String yearfortask = &quot;&quot; + YR;</span>
<span class="nc" id="L3643">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L3645">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L3647">							Date taskDate = null;</span>
							try {
<span class="nc" id="L3649">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L3650">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L3652">								e.printStackTrace();</span>
<span class="nc" id="L3653">							}</span>
<span class="nc" id="L3654">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTask()
									+ &quot;values('&quot;
									+ vatSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
									+ new java.sql.Date(getFirstDay(taskDate)
											.getTime())
									+ &quot;' ,'&quot;
									+ new java.sql.Date(getLastDay(taskDate)
											.getTime()) + &quot;','SE')&quot;;
<span class="nc" id="L3666">							stmt3.executeUpdate(queryTaskCreate);</span>
						}
					}

<span class="nc bnc" id="L3670" title="All 4 branches missed.">					if (j != YR &amp;&amp; j != latestyearTaxCal) {</span>
<span class="nc" id="L3671">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L3672">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L3674">						Date dd = null;</span>
<span class="nc" id="L3675">						Date ddd = null;</span>
<span class="nc bnc" id="L3676" title="All 2 branches missed.">						for (int i = 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L3677">							vatSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L3680" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L3681">								transaction_date_first = &quot;&quot; + j + &quot;-&quot; + &quot;0&quot; + i</span>
										+ &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L3684">								transaction_date_first = &quot;&quot; + j + &quot;-&quot; + i + &quot;-&quot;</span>
										+ &quot;01&quot;;
							}

<span class="nc bnc" id="L3688" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L3689">								int day = 1;</span>
<span class="nc" id="L3690">								cal.set(j, i - 1, day);</span>
<span class="nc" id="L3691">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L3693">								cal.set(j, i - 1, totalday);</span>
								try {
<span class="nc" id="L3695">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L3697">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L3699">									e.printStackTrace();</span>
<span class="nc" id="L3700">								}</span>
<span class="nc" id="L3701">								cal.setTime(ddd);</span>
<span class="nc" id="L3702">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L3704">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L3705">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +j + &quot;-&quot; + &quot;0&quot;+i
								// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L3710">							} else {</span>
<span class="nc" id="L3711">								int day = 1;</span>
<span class="nc" id="L3712">								cal.set(j, i - 1, day);</span>
<span class="nc" id="L3713">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L3715">								cal.set(j, i - 1, totalday);</span>
								try {
<span class="nc" id="L3717">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L3719">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L3721">									e.printStackTrace();</span>
<span class="nc" id="L3722">								}</span>
<span class="nc" id="L3723">								cal.setTime(ddd);</span>
<span class="nc" id="L3724">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L3726">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L3727">								dd = cal.getTime();</span>
								// transaction_date_last=&quot;&quot; +j + &quot;-&quot;+i +&quot;-&quot;+
								// &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
							}
<span class="nc" id="L3731">							System.out</span>
									.println(&quot;result not  found in task table &quot;);
							// String queryForBoAgtVat=&quot;select (sale.vat_amt -
							// sale_ret.vat_amt) vatAmt from ((select
							// sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale,(select sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE_RET') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale_ret)&quot;;
<span class="nc" id="L3754">							String queryForBoAgtVat = &quot;select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;</span>
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id) sale_ret)&quot;;
							// String
							// queryForPlayer=QueryManager.getST3LastMonthTransaction()
							// + &quot; where transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L3768">							System.out</span>
									.println(&quot;query---- for vat calculation ???????????  &quot;
											+ queryForBoAgtVat);
<span class="nc" id="L3771">							RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L3772" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L3774">								double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L3775">								logger</span>
										.debug(&quot;vat amount   from table&quot;
												+ vatAmt);
<span class="nc" id="L3778">								vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L3779">								logger.debug(&quot;calculated vat is    @@  &quot;</span>
										+ vatSum);

<span class="nc" id="L3782">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L3791" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L3792">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L3794">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L3796">							String yearfortask = &quot;&quot; + j;</span>
<span class="nc" id="L3797">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L3799">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L3801">							Date taskDate = null;</span>
							try {
<span class="nc" id="L3803">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L3804">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L3806">								e.printStackTrace();</span>
<span class="nc" id="L3807">							}</span>

<span class="nc" id="L3809">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTask()
									+ &quot;values('&quot;
									+ vatSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
									+ new java.sql.Date(getFirstDay(taskDate)
											.getTime())
									+ &quot;' ,'&quot;
									+ new java.sql.Date(getLastDay(taskDate)
											.getTime()) + &quot;','SE')&quot;;
<span class="nc" id="L3821">							stmt3.executeUpdate(queryTaskCreate);</span>

						}
					}

				}
			}

<span class="nc" id="L3829">			TaskBean taskBean = null;</span>

<span class="nc" id="L3831">			List&lt;TaskBean&gt; searchResults = new ArrayList&lt;TaskBean&gt;();</span>
<span class="nc" id="L3832">			logger.debug(&quot;333333333333333333hhhhhhhhhhh&quot;);</span>
<span class="nc" id="L3833">			ResultSet rs3 = stmt4.executeQuery(QueryManager</span>
					.getUnapprovedVATSE());
<span class="nc" id="L3835">			Calendar cal = Calendar.getInstance();</span>
<span class="nc bnc" id="L3836" title="All 2 branches missed.">			while (rs3.next()) {</span>
<span class="nc" id="L3837">				taskBean = new TaskBean();</span>
<span class="nc" id="L3838">				taskBean.setAmount(rs3.getDouble(&quot;amount&quot;));</span>

				// SimpleDateFormat date1 = new
				// SimpleDateFormat(&quot;dd-MM-yyyy&quot;);//it would be the format set
				// by Vineet
				// taskBean.setMonth(date1.format(rs3.getDate(&quot;month&quot;)));
				// logger.debug(&quot;heeeeeeeeeeeeellllllll
				// &quot;+date1.format(rs3.getDate(&quot;month&quot;)) );

				// cal.setTime(new
				// SimpleDateFormat(&quot;yyyy-MM-dd&quot;).parse(rs3.getString(TableConstants.MONTH_TASK)));
				// taskBean.setMonth(monthArr[cal.get(Calendar.MONTH)]+&quot;,&quot;+cal.get(Calendar.YEAR));

<span class="nc" id="L3851">				taskBean.setMonth(rs3.getString(TableConstants.MONTH_TASK));</span>
<span class="nc" id="L3852">				taskBean.setTransactionType(rs3</span>
						.getString(TableConstants.TASK_TYPE));
<span class="nc" id="L3854">				taskBean.setStatus(rs3.getString(TableConstants.TASK_STATUS));</span>
<span class="nc" id="L3855">				taskBean.setTaskId(rs3.getInt(TableConstants.TASK_ID));</span>
<span class="nc" id="L3856">				taskBean.setServiceCode(rs3.getString(&quot;service_code&quot;));</span>
<span class="nc" id="L3857">				taskBean.setServiceName(serviceName);</span>
<span class="nc" id="L3858">				logger.debug(&quot;taskid is   &quot; + rs3.getInt(&quot;task_id&quot;));</span>
				// userBean.setRegisterDate(resultSet.getDate(TableConstants.Register_DATE));
<span class="nc" id="L3860">				searchResults.add(taskBean);</span>
			}

<span class="nc" id="L3863">			con.commit();</span>
<span class="nc" id="L3864">			con.close(); // added by yogesh at the time of self review</span>
<span class="nc" id="L3865">			return searchResults;</span>

<span class="nc" id="L3867">		} catch (SQLException e) {</span>

			try {
<span class="nc" id="L3870">				con.rollback();</span>
<span class="nc" id="L3871">			} catch (SQLException se) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L3873">				se.printStackTrace();</span>
<span class="nc" id="L3874">				throw new LMSException(&quot;Error During Rollback&quot;, se);</span>
<span class="nc" id="L3875">			}</span>
<span class="nc" id="L3876">			e.printStackTrace();</span>
<span class="nc" id="L3877">			throw new LMSException(e);</span>

		}
		// return null;

	}

	public List vatSearchIW(Integer month, Integer year) throws LMSException,
	ParseException {
<span class="nc" id="L3886">		logger.debug(&quot;vatSearchIW called&quot;);</span>
<span class="nc" id="L3887">		double vatSum = 0;</span>
<span class="nc" id="L3888">		boolean tds = false;</span>
<span class="nc" id="L3889">		boolean isEntry = false;</span>
<span class="nc" id="L3890">		int yearTable = 0;</span>
<span class="nc" id="L3891">		int monthTable = 0;</span>

<span class="nc" id="L3893">		int latestyearTaxCal = 0;</span>
<span class="nc" id="L3894">		int latestmonthTaxCal = 0;</span>

<span class="nc" id="L3896">		NumberFormat nf = NumberFormat.getInstance();</span>
<span class="nc" id="L3897">		nf.setMaximumFractionDigits(2);</span>
<span class="nc" id="L3898">		nf.setMinimumFractionDigits(2);</span>

<span class="nc" id="L3900">		SimpleDateFormat date = new SimpleDateFormat();</span>

<span class="nc" id="L3902">		Calendar rightNow = Calendar.getInstance();</span>

<span class="nc" id="L3904">		int YR = rightNow.get(Calendar.YEAR);</span>
<span class="nc" id="L3905">		int MTH = rightNow.get(Calendar.MONTH) + 1;</span>

<span class="nc" id="L3907">		int depYear = year;</span>
<span class="nc" id="L3908">		int depMonth = month;</span>
<span class="nc" id="L3909">		logger.debug(&quot;inside deploy date changed&quot;);</span>

		// int MTH=11;
<span class="nc" id="L3912">		logger.debug(&quot;month from system  &quot; + MTH);</span>

<span class="nc" id="L3914">		logger.debug(&quot;not depriceted   &quot; + YR);</span>
<span class="nc" id="L3915">		logger.debug(&quot;not depriceted   &quot; + MTH);</span>

<span class="nc" id="L3917">		Connection con = null;</span>
<span class="nc" id="L3918">		String serviceName = &quot;&quot;;</span>
		try {

			 
<span class="nc" id="L3922">			con = DBConnect.getConnection();</span>
<span class="nc" id="L3923">			con.setAutoCommit(false);</span>

<span class="nc" id="L3925">			Statement stmt1 = con.createStatement();</span>
<span class="nc" id="L3926">			Statement stmt2 = con.createStatement();</span>
<span class="nc" id="L3927">			Statement stmt3 = con.createStatement();</span>
<span class="nc" id="L3928">			Statement stmt4 = con.createStatement();</span>
<span class="nc" id="L3929">			Statement stmt5 = con.createStatement();</span>
<span class="nc" id="L3930">			PreparedStatement ps6 = con</span>
					.prepareStatement(&quot;select service_display_name from st_lms_service_master where service_code='IW' and status='ACTIVE'&quot;);
<span class="nc" id="L3932">			ResultSet rs = null, rs6 = null;</span>

<span class="nc" id="L3934">			ResultSet RSPLR = null;</span>
<span class="nc" id="L3935">			logger.debug(&quot;heeeeeee&quot;);</span>

<span class="nc" id="L3937">			rs6 = ps6.executeQuery();</span>
<span class="nc bnc" id="L3938" title="All 2 branches missed.">			if (rs6.next()) {</span>
<span class="nc" id="L3939">				serviceName = rs6.getString(&quot;service_display_name&quot;);</span>
			} else {
<span class="nc" id="L3941">				serviceName = &quot;&quot;;</span>
			}
<span class="nc" id="L3943">			ResultSet latestMonth = stmt5.executeQuery(QueryManager</span>
					.getLatestMonthVATIW());
<span class="nc bnc" id="L3945" title="All 2 branches missed.">			while (latestMonth.next()) {</span>
<span class="nc" id="L3946">				Calendar rightNow1 = Calendar.getInstance();</span>
<span class="nc" id="L3947">				Date dt = latestMonth.getDate(&quot;month&quot;);</span>
<span class="nc" id="L3948">				logger.debug(&quot;get date from db &quot; + dt);</span>
<span class="nc" id="L3949">				rightNow1.setTime(dt);</span>
<span class="nc" id="L3950">				latestyearTaxCal = rightNow1.get(Calendar.YEAR);</span>
<span class="nc" id="L3951">				latestmonthTaxCal = rightNow1.get(Calendar.MONTH) + 1;</span>
<span class="nc" id="L3952">				logger.debug(&quot; latest year &quot; + latestyearTaxCal);</span>
<span class="nc" id="L3953">				logger.debug(&quot; latest month &quot; + latestmonthTaxCal);</span>

				/*
				 * String latestDate=latestMonth.getString(&quot;month&quot;); String
				 * latestyear=latestDate.substring(0,4); String
				 * latestmonth=latestDate.substring(5,7);
				 * latestyearTaxCal=Integer.parseInt(latestyear);
				 * latestmonthTaxCal=Integer.parseInt(latestmonth);
				 * 
				 * logger.debug(&quot;latest year from task table &quot; + latestyear);
				 * logger.debug(&quot;latest month from task table &quot; + latestmonth);
				 */
<span class="nc" id="L3965">				isEntry = true;</span>
<span class="nc" id="L3966">				break;</span>

			}

<span class="nc bnc" id="L3970" title="All 2 branches missed.">			if (isEntry == false) {</span>
<span class="nc" id="L3971">				logger.debug(&quot;when no entry for VAT&quot;);</span>
<span class="nc" id="L3972">				latestyearTaxCal = depYear;</span>
<span class="nc bnc" id="L3973" title="All 2 branches missed.">				if (depMonth == 01) {</span>
<span class="nc" id="L3974">					latestmonthTaxCal = 00;</span>
				} else {
<span class="nc" id="L3976">					latestmonthTaxCal = depMonth - 1;</span>
				}

			}

<span class="nc bnc" id="L3981" title="All 2 branches missed.">			if (YR == latestyearTaxCal)</span>

			{

<span class="nc" id="L3985">				logger.debug(&quot;inside same year&quot;);</span>
<span class="nc bnc" id="L3986" title="All 2 branches missed.">				for (int i = latestmonthTaxCal + 1; i &lt; MTH; i++) {</span>

<span class="nc" id="L3988">					Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L3989">					SimpleDateFormat dtfmt = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L3990">					Date dd = null;</span>
<span class="nc" id="L3991">					Date newdate = null;</span>
<span class="nc" id="L3992">					vatSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L3995" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L3996">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L3999">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L4003" title="All 2 branches missed.">					if (i &lt; 10)</span>

					{
<span class="nc" id="L4006">						int day = 1;</span>
<span class="nc" id="L4007">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L4008">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L4010">						cal.set(latestyearTaxCal, i - 1, totalday);</span>
						try {
<span class="nc" id="L4012">							newdate = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L4013">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L4015">							e.printStackTrace();</span>
<span class="nc" id="L4016">						}</span>
<span class="nc" id="L4017">						cal.setTime(newdate);</span>
<span class="nc" id="L4018">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L4019">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L4020">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot; +
						// &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L4024">					} else {</span>
<span class="nc" id="L4025">						int day = 1;</span>
<span class="nc" id="L4026">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L4027">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L4029">						cal.set(latestyearTaxCal, i - 1, totalday);</span>
						try {
<span class="nc" id="L4031">							newdate = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L4032">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L4034">							e.printStackTrace();</span>
<span class="nc" id="L4035">						}</span>
<span class="nc" id="L4036">						cal.setTime(newdate);</span>
<span class="nc" id="L4037">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L4038">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L4039">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot;+i
						// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}
<span class="nc" id="L4044">					logger.debug(&quot;9999999999999999999999&quot;);</span>
<span class="nc" id="L4045">					logger.debug(transaction_date_first);</span>
					// logger.debug(transaction_date_last);

<span class="nc" id="L4048">					String queryForBoAgtVat = &quot;select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_iw_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;</span>
							+ transaction_date_first
							+ &quot;' and sbtm.transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_iw_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and sbtm.transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id) sale_ret)&quot;;

					// String
					// queryForPlayer=QueryManager.getST3LastMonthTransaction()
					// + &quot; where transaction_date &gt;=
					// '&quot;+transaction_date_first+&quot;' and transaction_date &lt;
					// '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L4063">					System.out</span>
							.println(&quot;query---- for vat calculation ???????????  &quot;
									+ queryForBoAgtVat);
<span class="nc" id="L4066">					RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L4067" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L4069">						double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L4070">						logger.debug(&quot;vat amount   from table&quot; + vatAmt);</span>
<span class="nc" id="L4071">						vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L4072">						System.out</span>
								.println(&quot;calculated vat is    @@  &quot; + vatSum);

<span class="nc" id="L4075">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L4083" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L4084">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L4086">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L4088">					String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L4089">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L4091">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L4092">					Date taskDate = null;</span>
					try {
<span class="nc" id="L4094">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L4095">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L4097">						e.printStackTrace();</span>
<span class="nc" id="L4098">					}</span>
<span class="nc" id="L4099">					logger.debug(&quot;date to insert &quot; + taskDate);</span>

<span class="nc" id="L4101">					String queryTaskCreate = QueryManager.getST3CreateTask()</span>
							+ &quot;values('&quot;
							+ vatSum
							+ &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
							+ new java.sql.Date(getFirstDay(taskDate).getTime())
							+ &quot;' ,'&quot;
							+ new java.sql.Date(getLastDay(taskDate).getTime())
							+ &quot;','IW')&quot;;
<span class="nc" id="L4111">					stmt3.executeUpdate(queryTaskCreate);</span>

				}

			}

<span class="nc bnc" id="L4117" title="All 2 branches missed.">			if (YR == latestyearTaxCal + 1) {</span>
<span class="nc" id="L4118">				logger.debug(&quot;when diff is one&quot;);</span>
<span class="nc" id="L4119">				Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L4120">				SimpleDateFormat dtfmt = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>

<span class="nc bnc" id="L4122" title="All 2 branches missed.">				for (int i = latestmonthTaxCal + 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L4123">					Date dd = null;</span>
<span class="nc" id="L4124">					Date ddd = null;</span>
<span class="nc" id="L4125">					vatSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L4128" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L4129">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L4132">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L4136" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L4137">						int day = 1;</span>
<span class="nc" id="L4138">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L4139">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L4141">						cal.set(latestyearTaxCal, i - 1, totalday);</span>

						try {
<span class="nc" id="L4144">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L4145">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L4147">							e.printStackTrace();</span>
<span class="nc" id="L4148">						}</span>
<span class="nc" id="L4149">						cal.setTime(ddd);</span>
<span class="nc" id="L4150">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L4151">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L4152">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot; +
						// &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L4157">					} else {</span>
<span class="nc" id="L4158">						int day = 1;</span>
<span class="nc" id="L4159">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L4160">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L4162">						cal.set(latestyearTaxCal, i - 1, totalday);</span>

						try {
<span class="nc" id="L4165">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L4166">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L4168">							e.printStackTrace();</span>
<span class="nc" id="L4169">						}</span>
<span class="nc" id="L4170">						cal.setTime(ddd);</span>
<span class="nc" id="L4171">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L4172">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L4173">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot;+i
						// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}

					// String queryForBoAgtVat=&quot;select (sale.vat_amt -
					// sale_ret.vat_amt) vatAmt from ((select sum(sbat.vat_amt)
					// vat_amt from st_lms_bo_transaction_master
					// sbtm,st_iw_bo_sale sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and sbtm.transaction_type in
					// ('SALE') and sbat.transaction_id=sbtm.transaction_id)
					// sale,(select sum(sbat.vat_amt) vat_amt from
					// st_lms_bo_transaction_master
					// sbtm,st_iw_bo_sale sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and sbtm.transaction_type in
					// ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id)
					// sale_ret)&quot;;
<span class="nc" id="L4197">					String queryForBoAgtVat = &quot;select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_iw_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;</span>
							+ transaction_date_first
							+ &quot;' and sbtm.transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_iw_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and sbtm.transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id) sale_ret)&quot;;
					// String
					// queryForPlayer=QueryManager.getST3LastMonthTransaction()
					// + &quot; where transaction_date &gt;=
					// '&quot;+transaction_date_first+&quot;' and transaction_date &lt;
					// '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L4211">					System.out</span>
							.println(&quot;query---- for vat calculation ???????????  &quot;
									+ queryForBoAgtVat);
<span class="nc" id="L4214">					RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L4215" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L4217">						double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L4218">						logger.debug(&quot;vat amount   from table&quot; + vatAmt);</span>
<span class="nc" id="L4219">						vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L4220">						System.out</span>
								.println(&quot;calculated vat is    @@  &quot; + vatSum);

<span class="nc" id="L4223">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L4231" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L4232">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L4234">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L4236">					String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L4237">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L4239">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L4240">					Date taskDate = null;</span>
					try {
<span class="nc" id="L4242">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L4243">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L4245">						e.printStackTrace();</span>
<span class="nc" id="L4246">					}</span>

<span class="nc" id="L4248">					String queryTaskCreate = QueryManager.getST3CreateTask()</span>
							+ &quot;values('&quot;
							+ vatSum
							+ &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
							+ new java.sql.Date(getFirstDay(taskDate).getTime())
							+ &quot;' ,'&quot;
							+ new java.sql.Date(getLastDay(taskDate).getTime())
							+ &quot;','IW')&quot;;
<span class="nc" id="L4258">					stmt3.executeUpdate(queryTaskCreate);</span>

				}

<span class="nc bnc" id="L4262" title="All 2 branches missed.">				for (int i = 1; i &lt; MTH; i++) {</span>
<span class="nc" id="L4263">					Date dd = null;</span>
<span class="nc" id="L4264">					Date ddd = null;</span>
<span class="nc" id="L4265">					vatSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L4268" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L4269">						transaction_date_first = &quot;&quot; + (latestyearTaxCal + 1)</span>
								+ &quot;-&quot; + &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L4272">						transaction_date_first = &quot;&quot; + (latestyearTaxCal + 1)</span>
								+ &quot;-&quot; + i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L4276" title="All 2 branches missed.">					if (i &lt; 10)</span>

					{
<span class="nc" id="L4279">						int day = 1;</span>
<span class="nc" id="L4280">						cal.set(latestyearTaxCal + 1, i - 1, day);</span>
<span class="nc" id="L4281">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L4283">						cal.set(latestyearTaxCal + 1, i - 1, totalday);</span>
						try {
<span class="nc" id="L4285">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L4286">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L4288">							e.printStackTrace();</span>
<span class="nc" id="L4289">						}</span>
<span class="nc" id="L4290">						cal.setTime(ddd);</span>
<span class="nc" id="L4291">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L4292">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L4293">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +(latestyearTaxCal+1) + &quot;-&quot;
						// + &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L4296">					} else {</span>

<span class="nc" id="L4298">						int day = 1;</span>
<span class="nc" id="L4299">						cal.set(latestyearTaxCal + 1, i - 1, day);</span>
<span class="nc" id="L4300">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L4302">						cal.set(latestyearTaxCal + 1, i - 1, totalday);</span>
						try {
<span class="nc" id="L4304">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L4305">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L4307">							e.printStackTrace();</span>
<span class="nc" id="L4308">						}</span>
<span class="nc" id="L4309">						cal.setTime(ddd);</span>
<span class="nc" id="L4310">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L4311">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L4312">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +(latestyearTaxCal+1) +
						// &quot;-&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}
<span class="nc" id="L4316">					logger.debug(&quot;result not  found in task table &quot;);</span>
					// String queryForBoAgtVat=&quot;select (sale.vat_amt -
					// sale_ret.vat_amt) vatAmt from ((select sum(sbat.vat_amt)
					// vat_amt from st_lms_bo_transaction_master
					// sbtm,st_iw_bo_sale sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and sbtm.transaction_type in
					// ('SALE') and sbat.transaction_id=sbtm.transaction_id)
					// sale,(select sum(sbat.vat_amt) vat_amt from
					// st_lms_bo_transaction_master
					// sbtm,st_iw_bo_sale sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and sbtm.transaction_type in
					// ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id)
					// sale_ret)&quot;;
<span class="nc" id="L4335">					String queryForBoAgtVat = &quot;select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_iw_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;</span>
							+ transaction_date_first
							+ &quot;' and sbtm.transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_iw_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id) sale_ret)&quot;;
					// String
					// queryForPlayer=QueryManager.getST3LastMonthTransaction()
					// + &quot; where transaction_date &gt;=
					// '&quot;+transaction_date_first+&quot;' and transaction_date &lt;
					// '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L4349">					System.out</span>
							.println(&quot;query---- for vat calculation ???????????  &quot;
									+ queryForBoAgtVat);
<span class="nc" id="L4352">					RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L4353" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L4355">						double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L4356">						logger.debug(&quot;vat amount   from table&quot; + vatAmt);</span>
<span class="nc" id="L4357">						vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L4358">						System.out</span>
								.println(&quot;calculated vat is    @@  &quot; + vatSum);

<span class="nc" id="L4361">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L4369" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L4370">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L4372">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L4374">					String yearfortask = &quot;&quot; + (latestyearTaxCal + 1);</span>
<span class="nc" id="L4375">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L4377">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L4378">					Date taskDate = null;</span>
					try {
<span class="nc" id="L4380">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L4381">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L4383">						e.printStackTrace();</span>
<span class="nc" id="L4384">					}</span>
<span class="nc" id="L4385">					String queryTaskCreate = QueryManager.getST3CreateTask()</span>
							+ &quot;values('&quot;
							+ vatSum
							+ &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
							+ new java.sql.Date(getFirstDay(taskDate).getTime())
							+ &quot;' ,'&quot;
							+ new java.sql.Date(getLastDay(taskDate).getTime())
							+ &quot;','IW')&quot;;
<span class="nc" id="L4395">					stmt3.executeUpdate(queryTaskCreate);</span>

				}
			}

<span class="nc bnc" id="L4400" title="All 2 branches missed.">			if (YR &gt; latestyearTaxCal + 1) {</span>
<span class="nc" id="L4401">				logger.debug(&quot;when diff is more then one&quot;);</span>
<span class="nc bnc" id="L4402" title="All 2 branches missed.">				for (int j = latestyearTaxCal; j &lt;= YR; j++) {</span>
<span class="nc bnc" id="L4403" title="All 2 branches missed.">					if (j == latestyearTaxCal) {</span>
<span class="nc" id="L4404">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L4405">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L4407">						Date dd = null;</span>
<span class="nc" id="L4408">						Date ddd = null;</span>

<span class="nc bnc" id="L4410" title="All 2 branches missed.">						for (int i = latestmonthTaxCal + 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L4411">							vatSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L4414" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L4415">								transaction_date_first = &quot;&quot; + latestyearTaxCal</span>
										+ &quot;-&quot; + &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L4418">								transaction_date_first = &quot;&quot; + latestyearTaxCal</span>
										+ &quot;-&quot; + i + &quot;-&quot; + &quot;01&quot;;
							}

<span class="nc bnc" id="L4422" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L4423">								int day = 1;</span>
<span class="nc" id="L4424">								cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L4425">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L4427">								cal.set(latestyearTaxCal, i - 1, totalday);</span>
								try {
<span class="nc" id="L4429">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L4431">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L4433">									e.printStackTrace();</span>
<span class="nc" id="L4434">								}</span>
<span class="nc" id="L4435">								cal.setTime(ddd);</span>
<span class="nc" id="L4436">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L4438">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L4439">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +latestyearTaxCal +
								// &quot;-&quot; + &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L4443">							} else {</span>
<span class="nc" id="L4444">								int day = 1;</span>
<span class="nc" id="L4445">								cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L4446">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L4448">								cal.set(latestyearTaxCal, i - 1, totalday);</span>
								try {
<span class="nc" id="L4450">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L4452">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L4454">									e.printStackTrace();</span>
<span class="nc" id="L4455">								}</span>
<span class="nc" id="L4456">								cal.setTime(ddd);</span>
<span class="nc" id="L4457">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L4459">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L4460">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +latestyearTaxCal +
								// &quot;-&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

							}
							// String queryForBoAgtVat=&quot;select (sale.vat_amt -
							// sale_ret.vat_amt) vatAmt from ((select
							// sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_iw_bo_sale sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale,(select sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_iw_bo_sale sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE_RET') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale_ret)&quot;;
<span class="nc" id="L4487">							String queryForBoAgtVat = &quot;select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_iw_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;</span>
									+ transaction_date_first
									+ &quot;' and sbtm.transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_iw_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and sbtm.transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id) sale_ret)&quot;;
							// String
							// queryForPlayer=QueryManager.getST3LastMonthTransaction()
							// + &quot; where transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L4501">							System.out</span>
									.println(&quot;query---- for vat calculation ???????????  &quot;
											+ queryForBoAgtVat);
<span class="nc" id="L4504">							RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L4505" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L4507">								double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L4508">								logger</span>
										.debug(&quot;vat amount   from table&quot;
												+ vatAmt);
<span class="nc" id="L4511">								vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L4512">								logger.debug(&quot;calculated vat is    @@  &quot;</span>
										+ vatSum);

<span class="nc" id="L4515">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L4524" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L4525">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L4527">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L4529">							String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L4530">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L4532">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L4534">							Date taskDate = null;</span>
							try {
<span class="nc" id="L4536">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L4537">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L4539">								e.printStackTrace();</span>
<span class="nc" id="L4540">							}</span>

<span class="nc" id="L4542">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTask()
									+ &quot;values('&quot;
									+ vatSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
									+ new java.sql.Date(getFirstDay(taskDate)
											.getTime())
									+ &quot;' ,'&quot;
									+ new java.sql.Date(getLastDay(taskDate)
											.getTime()) + &quot;','IW')&quot;;
<span class="nc" id="L4554">							stmt3.executeUpdate(queryTaskCreate);</span>
						}

					}

<span class="nc bnc" id="L4559" title="All 2 branches missed.">					if (j == YR) {</span>
<span class="nc" id="L4560">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L4561">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L4563">						Date dd = null;</span>
<span class="nc" id="L4564">						Date ddd = null;</span>
<span class="nc bnc" id="L4565" title="All 2 branches missed.">						for (int i = 1; i &lt; MTH; i++) {</span>
<span class="nc" id="L4566">							vatSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L4569" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L4570">								transaction_date_first = &quot;&quot; + YR + &quot;-&quot; + &quot;0&quot;</span>
										+ i + &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L4573">								transaction_date_first = &quot;&quot; + YR + &quot;-&quot; + i</span>
										+ &quot;-&quot; + &quot;01&quot;;
							}

<span class="nc bnc" id="L4577" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L4578">								int day = 1;</span>
<span class="nc" id="L4579">								cal.set(YR, i - 1, day);</span>
<span class="nc" id="L4580">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L4582">								cal.set(YR, i - 1, totalday);</span>
								try {
<span class="nc" id="L4584">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L4586">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L4588">									e.printStackTrace();</span>
<span class="nc" id="L4589">								}</span>
<span class="nc" id="L4590">								cal.setTime(ddd);</span>
<span class="nc" id="L4591">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L4593">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L4594">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +YR + &quot;-&quot; + &quot;0&quot;+i
								// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L4598">							} else {</span>
<span class="nc" id="L4599">								int day = 1;</span>
<span class="nc" id="L4600">								cal.set(YR, i - 1, day);</span>
<span class="nc" id="L4601">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L4603">								cal.set(YR, i - 1, totalday);</span>
								try {
<span class="nc" id="L4605">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L4607">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L4609">									e.printStackTrace();</span>
<span class="nc" id="L4610">								}</span>
<span class="nc" id="L4611">								cal.setTime(ddd);</span>
<span class="nc" id="L4612">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L4614">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L4615">								dd = cal.getTime();</span>
								// transaction_date_last=&quot;&quot; +YR + &quot;-&quot;+i +&quot;-&quot;+
								// &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
							}

<span class="nc" id="L4620">							System.out</span>
									.println(&quot;result not  found in task table &quot;);
							// String queryForBoAgtVat=&quot;select (sale.vat_amt -
							// sale_ret.vat_amt) vatAmt from ((select
							// sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_iw_bo_sale sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale,(select sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_iw_bo_sale sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE_RET') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale_ret)&quot;;
<span class="nc" id="L4643">							String queryForBoAgtVat = &quot;select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_iw_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;</span>
									+ transaction_date_first
									+ &quot;' and sbtm.transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_iw_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and sbtm.transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id) sale_ret)&quot;;
							// String
							// queryForPlayer=QueryManager.getST3LastMonthTransaction()
							// + &quot; where transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L4657">							System.out</span>
									.println(&quot;query---- for vat calculation ???????????  &quot;
											+ queryForBoAgtVat);
<span class="nc" id="L4660">							RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L4661" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L4663">								double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L4664">								logger</span>
										.debug(&quot;vat amount   from table&quot;
												+ vatAmt);
<span class="nc" id="L4667">								vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L4668">								logger.debug(&quot;calculated vat is    @@  &quot;</span>
										+ vatSum);

<span class="nc" id="L4671">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L4680" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L4681">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L4683">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L4685">							String yearfortask = &quot;&quot; + YR;</span>
<span class="nc" id="L4686">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L4688">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L4690">							Date taskDate = null;</span>
							try {
<span class="nc" id="L4692">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L4693">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L4695">								e.printStackTrace();</span>
<span class="nc" id="L4696">							}</span>
<span class="nc" id="L4697">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTask()
									+ &quot;values('&quot;
									+ vatSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
									+ new java.sql.Date(getFirstDay(taskDate)
											.getTime())
									+ &quot;' ,'&quot;
									+ new java.sql.Date(getLastDay(taskDate)
											.getTime()) + &quot;','IW')&quot;;
<span class="nc" id="L4709">							stmt3.executeUpdate(queryTaskCreate);</span>
						}
					}

<span class="nc bnc" id="L4713" title="All 4 branches missed.">					if (j != YR &amp;&amp; j != latestyearTaxCal) {</span>
<span class="nc" id="L4714">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L4715">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L4717">						Date dd = null;</span>
<span class="nc" id="L4718">						Date ddd = null;</span>
<span class="nc bnc" id="L4719" title="All 2 branches missed.">						for (int i = 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L4720">							vatSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L4723" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L4724">								transaction_date_first = &quot;&quot; + j + &quot;-&quot; + &quot;0&quot; + i</span>
										+ &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L4727">								transaction_date_first = &quot;&quot; + j + &quot;-&quot; + i + &quot;-&quot;</span>
										+ &quot;01&quot;;
							}

<span class="nc bnc" id="L4731" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L4732">								int day = 1;</span>
<span class="nc" id="L4733">								cal.set(j, i - 1, day);</span>
<span class="nc" id="L4734">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L4736">								cal.set(j, i - 1, totalday);</span>
								try {
<span class="nc" id="L4738">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L4740">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L4742">									e.printStackTrace();</span>
<span class="nc" id="L4743">								}</span>
<span class="nc" id="L4744">								cal.setTime(ddd);</span>
<span class="nc" id="L4745">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L4747">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L4748">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +j + &quot;-&quot; + &quot;0&quot;+i
								// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L4753">							} else {</span>
<span class="nc" id="L4754">								int day = 1;</span>
<span class="nc" id="L4755">								cal.set(j, i - 1, day);</span>
<span class="nc" id="L4756">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L4758">								cal.set(j, i - 1, totalday);</span>
								try {
<span class="nc" id="L4760">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L4762">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L4764">									e.printStackTrace();</span>
<span class="nc" id="L4765">								}</span>
<span class="nc" id="L4766">								cal.setTime(ddd);</span>
<span class="nc" id="L4767">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L4769">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L4770">								dd = cal.getTime();</span>
								// transaction_date_last=&quot;&quot; +j + &quot;-&quot;+i +&quot;-&quot;+
								// &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
							}
<span class="nc" id="L4774">							System.out</span>
									.println(&quot;result not  found in task table &quot;);
							// String queryForBoAgtVat=&quot;select (sale.vat_amt -
							// sale_ret.vat_amt) vatAmt from ((select
							// sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_iw_bo_sale sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale,(select sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_iw_bo_sale sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and sbtm.transaction_type
							// in ('SALE_RET') and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale_ret)&quot;;
<span class="nc" id="L4797">							String queryForBoAgtVat = &quot;select (sale.vat_amt - sale_ret.vat_amt) vatAmt from ((select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_iw_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;</span>
									+ transaction_date_first
									+ &quot;' and sbtm.transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;'  and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id) sale,(select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_bo_transaction_master sbtm,st_iw_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and sbtm.transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT' and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id) sale_ret)&quot;;
							// String
							// queryForPlayer=QueryManager.getST3LastMonthTransaction()
							// + &quot; where transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L4811">							System.out</span>
									.println(&quot;query---- for vat calculation ???????????  &quot;
											+ queryForBoAgtVat);
<span class="nc" id="L4814">							RSPLR = stmt2.executeQuery(queryForBoAgtVat);</span>
<span class="nc bnc" id="L4815" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L4817">								double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L4818">								logger</span>
										.debug(&quot;vat amount   from table&quot;
												+ vatAmt);
<span class="nc" id="L4821">								vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L4822">								logger.debug(&quot;calculated vat is    @@  &quot;</span>
										+ vatSum);

<span class="nc" id="L4825">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L4834" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L4835">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L4837">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L4839">							String yearfortask = &quot;&quot; + j;</span>
<span class="nc" id="L4840">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L4842">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L4844">							Date taskDate = null;</span>
							try {
<span class="nc" id="L4846">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L4847">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L4849">								e.printStackTrace();</span>
<span class="nc" id="L4850">							}</span>

<span class="nc" id="L4852">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTask()
									+ &quot;values('&quot;
									+ vatSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','VAT','UNAPPROVED',CURRENT_DATE, '&quot;
									+ new java.sql.Date(getFirstDay(taskDate)
											.getTime())
									+ &quot;' ,'&quot;
									+ new java.sql.Date(getLastDay(taskDate)
											.getTime()) + &quot;','IW')&quot;;
<span class="nc" id="L4864">							stmt3.executeUpdate(queryTaskCreate);</span>

						}
					}

				}
			}

<span class="nc" id="L4872">			TaskBean taskBean = null;</span>

<span class="nc" id="L4874">			List&lt;TaskBean&gt; searchResults = new ArrayList&lt;TaskBean&gt;();</span>
<span class="nc" id="L4875">			logger.debug(&quot;333333333333333333hhhhhhhhhhh&quot;);</span>
<span class="nc" id="L4876">			ResultSet rs3 = stmt4.executeQuery(QueryManager</span>
					.getUnapprovedVATIW());
<span class="nc" id="L4878">			Calendar cal = Calendar.getInstance();</span>
<span class="nc bnc" id="L4879" title="All 2 branches missed.">			while (rs3.next()) {</span>
<span class="nc" id="L4880">				taskBean = new TaskBean();</span>
<span class="nc" id="L4881">				taskBean.setAmount(rs3.getDouble(&quot;amount&quot;));</span>

				// SimpleDateFormat date1 = new
				// SimpleDateFormat(&quot;dd-MM-yyyy&quot;);//it would be the format set
				// by Vineet
				// taskBean.setMonth(date1.format(rs3.getDate(&quot;month&quot;)));
				// logger.debug(&quot;heeeeeeeeeeeeellllllll
				// &quot;+date1.format(rs3.getDate(&quot;month&quot;)) );

				// cal.setTime(new
				// SimpleDateFormat(&quot;yyyy-MM-dd&quot;).parse(rs3.getString(TableConstants.MONTH_TASK)));
				// taskBean.setMonth(monthArr[cal.get(Calendar.MONTH)]+&quot;,&quot;+cal.get(Calendar.YEAR));

<span class="nc" id="L4894">				taskBean.setMonth(rs3.getString(TableConstants.MONTH_TASK));</span>
<span class="nc" id="L4895">				taskBean.setTransactionType(rs3</span>
						.getString(TableConstants.TASK_TYPE));
<span class="nc" id="L4897">				taskBean.setStatus(rs3.getString(TableConstants.TASK_STATUS));</span>
<span class="nc" id="L4898">				taskBean.setTaskId(rs3.getInt(TableConstants.TASK_ID));</span>
<span class="nc" id="L4899">				taskBean.setServiceCode(rs3.getString(&quot;service_code&quot;));</span>
<span class="nc" id="L4900">				taskBean.setServiceName(serviceName);</span>
<span class="nc" id="L4901">				logger.debug(&quot;taskid is   &quot; + rs3.getInt(&quot;task_id&quot;));</span>
				// userBean.setRegisterDate(resultSet.getDate(TableConstants.Register_DATE));
<span class="nc" id="L4903">				searchResults.add(taskBean);</span>
			}

<span class="nc" id="L4906">			con.commit();</span>
<span class="nc" id="L4907">			con.close(); // added by yogesh at the time of self review</span>
<span class="nc" id="L4908">			return searchResults;</span>

<span class="nc" id="L4910">		} catch (SQLException e) {</span>

			try {
<span class="nc" id="L4913">				con.rollback();</span>
<span class="nc" id="L4914">			} catch (SQLException se) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L4916">				se.printStackTrace();</span>
<span class="nc" id="L4917">				throw new LMSException(&quot;Error During Rollback&quot;, se);</span>
<span class="nc" id="L4918">			}</span>
<span class="nc" id="L4919">			e.printStackTrace();</span>
<span class="nc" id="L4920">			throw new LMSException(e);</span>

		}
		// return null;

}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>