<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VatAgentHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.accMgmt.common</a> &gt; <span class="el_source">VatAgentHelper.java</span></div><h1>VatAgentHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.accMgmt.common;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.text.NumberFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.List;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.beans.TaskBean;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.common.db.TableConstants;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.utility.CommonMethods;

/**
 * This class is used to provide methods for TDS Calculation
 * 
 * @author ABC
 * 
 */
<span class="nc" id="L32">public class VatAgentHelper {</span>
	/**
	 * This method is used to calculate VAT for a particular month
	 * 
	 * @param month
	 * @param year
	 * @returns the List of TaskBean type
	 * @throws LMSException
	 */

<span class="nc" id="L42">	static Log logger = LogFactory.getLog(VatAgentHelper.class);</span>

	public List vatSearchDG(Integer month, Integer year, Integer userOrgId,
			Integer agtUserId) throws LMSException {
<span class="nc" id="L46">		logger.debug(&quot;vatSearchDG called &quot;);</span>
<span class="nc" id="L47">		double vatSum = 0;</span>
<span class="nc" id="L48">		boolean tds = false;</span>
<span class="nc" id="L49">		boolean isEntry = false;</span>
<span class="nc" id="L50">		int yearTable = 0;</span>
<span class="nc" id="L51">		int monthTable = 0;</span>

<span class="nc" id="L53">		int latestyearTaxCal = 0;</span>
<span class="nc" id="L54">		int latestmonthTaxCal = 0;</span>
<span class="nc" id="L55">		String serviceName = &quot;&quot;;</span>

<span class="nc" id="L57">		NumberFormat nf = NumberFormat.getInstance();</span>
<span class="nc" id="L58">		nf.setMaximumFractionDigits(2);</span>
<span class="nc" id="L59">		nf.setMinimumFractionDigits(2);</span>

<span class="nc" id="L61">		SimpleDateFormat date = new SimpleDateFormat();</span>

<span class="nc" id="L63">		Calendar rightNow = Calendar.getInstance();</span>

<span class="nc" id="L65">		int YR = rightNow.get(Calendar.YEAR);</span>
<span class="nc" id="L66">		int MTH = rightNow.get(Calendar.MONTH) + 1;</span>

<span class="nc" id="L68">		int depYear = year;</span>
<span class="nc" id="L69">		int depMonth = month;</span>
<span class="nc" id="L70">		logger.debug(&quot;inside deploy date changed&quot;);</span>

		// int MTH=11;
<span class="nc" id="L73">		logger.debug(&quot;month from system  &quot; + MTH);</span>

<span class="nc" id="L75">		logger.debug(&quot;not depriceted   &quot; + YR);</span>
<span class="nc" id="L76">		logger.debug(&quot;not depriceted   &quot; + MTH);</span>

<span class="nc" id="L78">		Connection con = null;</span>

		try {

			 
<span class="nc" id="L83">			con = DBConnect.getConnection();</span>
<span class="nc" id="L84">			con.setAutoCommit(false);</span>

<span class="nc" id="L86">			Statement stmt1 = con.createStatement();</span>
<span class="nc" id="L87">			Statement stmt2 = con.createStatement();</span>
<span class="nc" id="L88">			Statement stmt3 = con.createStatement();</span>
<span class="nc" id="L89">			Statement stmt4 = con.createStatement();</span>
<span class="nc" id="L90">			Statement stmt6 = con.createStatement();</span>
			PreparedStatement stmt5;

<span class="nc" id="L93">			ResultSet rs = null;</span>
<span class="nc" id="L94">			ResultSet RSPLR = null;</span>
<span class="nc" id="L95">			logger.debug(&quot;heeeeeee&quot;);</span>
<span class="nc" id="L96">			rs = stmt6</span>
					.executeQuery(&quot;select service_display_name from st_lms_service_master where service_code='DG' and status='ACTIVE'&quot;);
<span class="nc bnc" id="L98" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L99">				serviceName = rs.getString(&quot;service_display_name&quot;);</span>
			}
<span class="nc" id="L101">			stmt5 = con.prepareStatement(QueryManager.getLatestMonthVATAgtDG());</span>
<span class="nc" id="L102">			stmt5.setInt(1, userOrgId);</span>
<span class="nc" id="L103">			ResultSet latestMonth = stmt5.executeQuery();</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">			while (latestMonth.next()) {</span>
<span class="nc" id="L105">				Calendar rightNow1 = Calendar.getInstance();</span>

<span class="nc" id="L107">				Date dt = latestMonth.getDate(&quot;month&quot;);</span>
<span class="nc" id="L108">				logger.debug(&quot;get date from db &quot; + dt);</span>
<span class="nc" id="L109">				rightNow1.setTime(dt);</span>
<span class="nc" id="L110">				latestyearTaxCal = rightNow1.get(Calendar.YEAR);</span>
<span class="nc" id="L111">				latestmonthTaxCal = rightNow1.get(Calendar.MONTH) + 1;</span>
<span class="nc" id="L112">				logger.debug(&quot; latest year &quot; + latestyearTaxCal);</span>
<span class="nc" id="L113">				logger.debug(&quot; latest month &quot; + latestmonthTaxCal);</span>

				/*
				 * String latestDate=latestMonth.getString(&quot;month&quot;); String
				 * latestyear=latestDate.substring(0,4); String
				 * latestmonth=latestDate.substring(5,7);
				 * latestyearTaxCal=Integer.parseInt(latestyear);
				 * latestmonthTaxCal=Integer.parseInt(latestmonth);
				 * 
				 * logger.debug(&quot;latest year from task table &quot; + latestyear);
				 * logger.debug(&quot;latest month from task table &quot; + latestmonth);
				 */
<span class="nc" id="L125">				isEntry = true;</span>
<span class="nc" id="L126">				break;</span>

			}

<span class="nc bnc" id="L130" title="All 2 branches missed.">			if (isEntry == false) {</span>
<span class="nc" id="L131">				logger.debug(&quot;when no entry for VAT&quot;);</span>
<span class="nc" id="L132">				latestyearTaxCal = depYear;</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">				if (depMonth == 01) {</span>
<span class="nc" id="L134">					latestmonthTaxCal = 00;</span>
				} else {
<span class="nc" id="L136">					latestmonthTaxCal = depMonth - 1;</span>
				}

			}

<span class="nc bnc" id="L141" title="All 2 branches missed.">			if (YR == latestyearTaxCal)</span>

			{

<span class="nc" id="L145">				logger.debug(&quot;inside same year&quot;);</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">				for (int i = latestmonthTaxCal + 1; i &lt; MTH; i++) {</span>

<span class="nc" id="L148">					Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L149">					SimpleDateFormat dtfmt = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L150">					Date dd = null;</span>
<span class="nc" id="L151">					Date newdate = null;</span>
<span class="nc" id="L152">					vatSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L155" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L156">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L159">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L163" title="All 2 branches missed.">					if (i &lt; 10)</span>

					{
<span class="nc" id="L166">						int day = 1;</span>
<span class="nc" id="L167">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L168">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L170">						cal.set(latestyearTaxCal, i - 1, totalday);</span>
						try {
<span class="nc" id="L172">							newdate = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L173">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L175">							e.printStackTrace();</span>
<span class="nc" id="L176">						}</span>
<span class="nc" id="L177">						cal.setTime(newdate);</span>
<span class="nc" id="L178">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L179">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L180">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot; +
						// &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L184">					} else {</span>
<span class="nc" id="L185">						int day = 1;</span>
<span class="nc" id="L186">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L187">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L189">						cal.set(latestyearTaxCal, i - 1, totalday);</span>
						try {
<span class="nc" id="L191">							newdate = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L192">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L194">							e.printStackTrace();</span>
<span class="nc" id="L195">						}</span>
<span class="nc" id="L196">						cal.setTime(newdate);</span>
<span class="nc" id="L197">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L198">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L199">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot;+i
						// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}
<span class="nc" id="L204">					logger.debug(&quot;9999999999999999999999&quot;);</span>
<span class="nc" id="L205">					logger.debug(transaction_date_first);</span>
					// logger.debug(transaction_date_last);

					// String queryForAgtRetVat=&quot;select
					// (sale_retailer.vat_amt-purch.vat_amt) vatAmt from
					// ((select sum(sbat.vat_amt) vat_amt from
					// st_lms_bo_transaction_master
					// sbtm,st_se_bo_agent_transaction sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and
					// sbat.agent_org_id=&quot;+userOrgId+&quot; and sbtm.transaction_type
					// in ('SALE') and sbat.transaction_id=sbtm.transaction_id)
					// purch,(select sum(sbat.vat_amt) vat_amt from
					// st_lms_agent_transaction_master
					// sbtm,st_se_agent_retailer_transaction sbat where
					// sbtm.transaction_date &gt;='&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.transaction_type in ('SALE') and
					// sbat.agent_id=&quot;+agtUserId+&quot; and
					// sbat.transaction_id=sbtm.transaction_id) sale_retailer)&quot;;

<span class="nc" id="L229">					String queryForAgtRetVat = &quot;select (sale_retailer.vatAmt-purchvat.vatAmt) vatAmt from  (( select (purchSalevat.vat_amt-purchSaleretvat.vat_amt) vatAmt from ( select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;</span>
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT'  and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbtm.transaction_type in ('DG_SALE') and sbat.transaction_id=sbtm.transaction_id)purchSalevat,(select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and            transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT' and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbtm.transaction_type in ('DG_SALE_RET') and sbat.transaction_id=sbtm.transaction_id)purchSaleretvat) purchvat, (select (saleVat.vat_amt-saleRetVat.vat_amt) vatAmt from (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_dg_agt_sale sbat where sbtm.transaction_date &gt;='&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;'and sbtm.transaction_type in ('DG_SALE') and   sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleVat, (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_dg_agt_sale sbat where sbtm.transaction_date &gt;='&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.transaction_type in ('DG_SALE_RET') and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleRetVat) sale_retailer)&quot;;

					// String
					// queryForPlayer=QueryManager.getST3LastMonthTransaction()
					// + &quot; where transaction_date &gt;=
					// '&quot;+transaction_date_first+&quot;' and transaction_date &lt;
					// '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L260">					logger.debug(&quot;query---- for vat calculation ???????????  &quot;</span>
							+ queryForAgtRetVat);
<span class="nc" id="L262">					RSPLR = stmt2.executeQuery(queryForAgtRetVat);</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L265">						double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L266">						logger.debug(&quot;vat amount   from table&quot; + vatAmt);</span>
<span class="nc" id="L267">						vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L268">						logger.debug(&quot;calculated vat is    @@  &quot; + vatSum);</span>

<span class="nc" id="L270">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L278" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L279">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L281">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L283">					String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L284">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L286">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L287">					Date taskDate = null;</span>
					try {
<span class="nc" id="L289">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L290">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L292">						e.printStackTrace();</span>
<span class="nc" id="L293">					}</span>
<span class="nc" id="L294">					logger.debug(&quot;date to insert &quot; + taskDate);</span>

<span class="nc" id="L296">					String queryTaskCreate = QueryManager.getST3CreateTaskAgt()</span>
							+ &quot;values('&quot; + vatSum + &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','VAT','UNAPPROVED',CURRENT_DATE,&quot; + userOrgId
							+ &quot;,'DG')&quot;;
<span class="nc" id="L301">					stmt3.executeUpdate(queryTaskCreate);</span>

				}

			}

<span class="nc bnc" id="L307" title="All 2 branches missed.">			if (YR == latestyearTaxCal + 1) {</span>
<span class="nc" id="L308">				logger.debug(&quot;when diff is one&quot;);</span>
<span class="nc" id="L309">				Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L310">				SimpleDateFormat dtfmt = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>

<span class="nc bnc" id="L312" title="All 2 branches missed.">				for (int i = latestmonthTaxCal + 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L313">					Date dd = null;</span>
<span class="nc" id="L314">					Date ddd = null;</span>
<span class="nc" id="L315">					vatSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L318" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L319">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L322">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L326" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L327">						int day = 1;</span>
<span class="nc" id="L328">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L329">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L331">						cal.set(latestyearTaxCal, i - 1, totalday);</span>

						try {
<span class="nc" id="L334">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L335">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L337">							e.printStackTrace();</span>
<span class="nc" id="L338">						}</span>
<span class="nc" id="L339">						cal.setTime(ddd);</span>
<span class="nc" id="L340">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L341">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L342">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot; +
						// &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L347">					} else {</span>
<span class="nc" id="L348">						int day = 1;</span>
<span class="nc" id="L349">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L350">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L352">						cal.set(latestyearTaxCal, i - 1, totalday);</span>

						try {
<span class="nc" id="L355">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L356">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L358">							e.printStackTrace();</span>
<span class="nc" id="L359">						}</span>
<span class="nc" id="L360">						cal.setTime(ddd);</span>
<span class="nc" id="L361">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L362">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L363">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot;+i
						// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}

					// String queryForAgtRetVat=&quot;select
					// (sale_retailer.vat_amt-purch.vat_amt) vatAmt from
					// ((select sum(sbat.vat_amt) vat_amt from
					// st_lms_bo_transaction_master
					// sbtm,st_se_bo_agent_transaction sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and
					// sbat.agent_org_id=&quot;+userOrgId+&quot; and sbtm.transaction_type
					// in ('SALE') and sbat.transaction_id=sbtm.transaction_id)
					// purch,(select sum(sbat.vat_amt) vat_amt from
					// st_lms_agent_transaction_master
					// sbtm,st_se_agent_retailer_transaction sbat where
					// sbtm.transaction_date &gt;='&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.transaction_type in ('SALE') and
					// sbat.agent_id=&quot;+agtUserId+&quot; and
					// sbat.transaction_id=sbtm.transaction_id) sale_retailer)&quot;;
<span class="nc" id="L389">					String queryForAgtRetVat = &quot;select (sale_retailer.vatAmt-purchvat.vatAmt) vatAmt from  (( select (purchSalevat.vat_amt-purchSaleretvat.vat_amt) vatAmt from ( select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;</span>
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT'  and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbtm.transaction_type in ('DG_SALE') and sbat.transaction_id=sbtm.transaction_id)purchSalevat,(select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and            transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT' and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbtm.transaction_type in ('DG_SALE_RET') and sbat.transaction_id=sbtm.transaction_id)purchSaleretvat) purchvat, (select (saleVat.vat_amt-saleRetVat.vat_amt) vatAmt from (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_dg_agt_sale sbat where sbtm.transaction_date &gt;='&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;'and sbtm.transaction_type in ('DG_SALE') and   sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleVat, (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_dg_agt_sale sbat where sbtm.transaction_date &gt;='&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.transaction_type in ('DG_SALE_RET') and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleRetVat) sale_retailer)&quot;;
					// String
					// queryForPlayer=QueryManager.getST3LastMonthTransaction()
					// + &quot; where transaction_date &gt;=
					// '&quot;+transaction_date_first+&quot;' and transaction_date &lt;
					// '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L419">					logger.debug(&quot;query---- for vat calculation ???????????  &quot;</span>
							+ queryForAgtRetVat);
<span class="nc" id="L421">					RSPLR = stmt2.executeQuery(queryForAgtRetVat);</span>
<span class="nc bnc" id="L422" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L424">						double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L425">						logger.debug(&quot;vat amount   from table&quot; + vatAmt);</span>
<span class="nc" id="L426">						vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L427">						logger.debug(&quot;calculated vat is    @@  &quot; + vatSum);</span>

<span class="nc" id="L429">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L437" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L438">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L440">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L442">					String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L443">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L445">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L446">					Date taskDate = null;</span>
					try {
<span class="nc" id="L448">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L449">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L451">						e.printStackTrace();</span>
<span class="nc" id="L452">					}</span>

<span class="nc" id="L454">					String queryTaskCreate = QueryManager.getST3CreateTaskAgt()</span>
							+ &quot;values('&quot; + vatSum + &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','VAT','UNAPPROVED',CURRENT_DATE,&quot; + userOrgId
							+ &quot;,'DG')&quot;;
<span class="nc" id="L459">					stmt3.executeUpdate(queryTaskCreate);</span>

				}

<span class="nc bnc" id="L463" title="All 2 branches missed.">				for (int i = 1; i &lt; MTH; i++) {</span>
<span class="nc" id="L464">					Date dd = null;</span>
<span class="nc" id="L465">					Date ddd = null;</span>
<span class="nc" id="L466">					vatSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L469" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L470">						transaction_date_first = &quot;&quot; + (latestyearTaxCal + 1)</span>
								+ &quot;-&quot; + &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L473">						transaction_date_first = &quot;&quot; + (latestyearTaxCal + 1)</span>
								+ &quot;-&quot; + i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L477" title="All 2 branches missed.">					if (i &lt; 10)</span>

					{
<span class="nc" id="L480">						int day = 1;</span>
<span class="nc" id="L481">						cal.set(latestyearTaxCal + 1, i - 1, day);</span>
<span class="nc" id="L482">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L484">						cal.set(latestyearTaxCal + 1, i - 1, totalday);</span>
						try {
<span class="nc" id="L486">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L487">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L489">							e.printStackTrace();</span>
<span class="nc" id="L490">						}</span>
<span class="nc" id="L491">						cal.setTime(ddd);</span>
<span class="nc" id="L492">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L493">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L494">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +(latestyearTaxCal+1) + &quot;-&quot;
						// + &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L497">					} else {</span>

<span class="nc" id="L499">						int day = 1;</span>
<span class="nc" id="L500">						cal.set(latestyearTaxCal + 1, i - 1, day);</span>
<span class="nc" id="L501">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L503">						cal.set(latestyearTaxCal + 1, i - 1, totalday);</span>
						try {
<span class="nc" id="L505">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L506">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L508">							e.printStackTrace();</span>
<span class="nc" id="L509">						}</span>
<span class="nc" id="L510">						cal.setTime(ddd);</span>
<span class="nc" id="L511">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L512">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L513">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +(latestyearTaxCal+1) +
						// &quot;-&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}
<span class="nc" id="L517">					logger.debug(&quot;result not  found in task table &quot;);</span>
					// String queryForAgtRetVat=&quot;select
					// (sale_retailer.vat_amt-purch.vat_amt) vatAmt from
					// ((select sum(sbat.vat_amt) vat_amt from
					// st_lms_bo_transaction_master
					// sbtm,st_se_bo_agent_transaction sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and
					// sbat.agent_org_id=&quot;+userOrgId+&quot; and sbtm.transaction_type
					// in ('SALE') and sbat.transaction_id=sbtm.transaction_id)
					// purch,(select sum(sbat.vat_amt) vat_amt from
					// st_lms_agent_transaction_master
					// sbtm,st_se_agent_retailer_transaction sbat where
					// sbtm.transaction_date &gt;='&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.transaction_type in ('SALE') and
					// sbat.agent_id=&quot;+agtUserId+&quot; and
					// sbat.transaction_id=sbtm.transaction_id) sale_retailer)&quot;;
<span class="nc" id="L538">					String queryForAgtRetVat = &quot;select (sale_retailer.vatAmt-purchvat.vatAmt) vatAmt from  (( select (purchSalevat.vat_amt-purchSaleretvat.vat_amt) vatAmt from ( select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;</span>
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT'  and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbtm.transaction_type in ('DG_SALE') and sbat.transaction_id=sbtm.transaction_id)purchSalevat,(select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and            transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT' and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbtm.transaction_type in ('DG_SALE_RET') and sbat.transaction_id=sbtm.transaction_id)purchSaleretvat) purchvat, (select (saleVat.vat_amt-saleRetVat.vat_amt) vatAmt from (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_dg_agt_sale sbat where sbtm.transaction_date &gt;='&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;'and sbtm.transaction_type in ('DG_SALE') and   sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleVat, (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_dg_agt_sale sbat where sbtm.transaction_date &gt;='&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.transaction_type in ('DG_SALE_RET') and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleRetVat) sale_retailer)&quot;;
					// String
					// queryForPlayer=QueryManager.getST3LastMonthTransaction()
					// + &quot; where transaction_date &gt;=
					// '&quot;+transaction_date_first+&quot;' and transaction_date &lt;
					// '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L568">					logger.debug(&quot;query---- for vat calculation ???????????  &quot;</span>
							+ queryForAgtRetVat);
<span class="nc" id="L570">					RSPLR = stmt2.executeQuery(queryForAgtRetVat);</span>
<span class="nc bnc" id="L571" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L573">						double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L574">						logger.debug(&quot;vat amount   from table&quot; + vatAmt);</span>
<span class="nc" id="L575">						vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L576">						logger.debug(&quot;calculated vat is    @@  &quot; + vatSum);</span>

<span class="nc" id="L578">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L586" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L587">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L589">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L591">					String yearfortask = &quot;&quot; + (latestyearTaxCal + 1);</span>
<span class="nc" id="L592">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L594">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L595">					Date taskDate = null;</span>
					try {
<span class="nc" id="L597">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L598">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L600">						e.printStackTrace();</span>
<span class="nc" id="L601">					}</span>
<span class="nc" id="L602">					String queryTaskCreate = QueryManager.getST3CreateTaskAgt()</span>
							+ &quot;values('&quot; + vatSum + &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','VAT','UNAPPROVED',CURRENT_DATE,&quot; + userOrgId
							+ &quot;,'DG')&quot;;
<span class="nc" id="L607">					stmt3.executeUpdate(queryTaskCreate);</span>

				}
			}

<span class="nc bnc" id="L612" title="All 2 branches missed.">			if (YR &gt; latestyearTaxCal + 1) {</span>
<span class="nc" id="L613">				logger.debug(&quot;when diff is more then one&quot;);</span>
<span class="nc bnc" id="L614" title="All 2 branches missed.">				for (int j = latestyearTaxCal; j &lt;= YR; j++) {</span>
<span class="nc bnc" id="L615" title="All 2 branches missed.">					if (j == latestyearTaxCal) {</span>
<span class="nc" id="L616">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L617">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L619">						Date dd = null;</span>
<span class="nc" id="L620">						Date ddd = null;</span>

<span class="nc bnc" id="L622" title="All 2 branches missed.">						for (int i = latestmonthTaxCal + 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L623">							vatSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L626" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L627">								transaction_date_first = &quot;&quot; + latestyearTaxCal</span>
										+ &quot;-&quot; + &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L630">								transaction_date_first = &quot;&quot; + latestyearTaxCal</span>
										+ &quot;-&quot; + i + &quot;-&quot; + &quot;01&quot;;
							}

<span class="nc bnc" id="L634" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L635">								int day = 1;</span>
<span class="nc" id="L636">								cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L637">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L639">								cal.set(latestyearTaxCal, i - 1, totalday);</span>
								try {
<span class="nc" id="L641">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L643">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L645">									e.printStackTrace();</span>
<span class="nc" id="L646">								}</span>
<span class="nc" id="L647">								cal.setTime(ddd);</span>
<span class="nc" id="L648">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L650">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L651">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +latestyearTaxCal +
								// &quot;-&quot; + &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L655">							} else {</span>
<span class="nc" id="L656">								int day = 1;</span>
<span class="nc" id="L657">								cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L658">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L660">								cal.set(latestyearTaxCal, i - 1, totalday);</span>
								try {
<span class="nc" id="L662">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L664">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L666">									e.printStackTrace();</span>
<span class="nc" id="L667">								}</span>
<span class="nc" id="L668">								cal.setTime(ddd);</span>
<span class="nc" id="L669">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L671">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L672">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +latestyearTaxCal +
								// &quot;-&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

							}
							// String queryForAgtRetVat=&quot;select
							// (sale_retailer.vat_amt-purch.vat_amt) vatAmt from
							// ((select sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and
							// sbat.agent_org_id=&quot;+userOrgId+&quot; and
							// sbtm.transaction_type in ('SALE') and
							// sbat.transaction_id=sbtm.transaction_id)
							// purch,(select sum(sbat.vat_amt) vat_amt from
							// st_lms_agent_transaction_master
							// sbtm,st_se_agent_retailer_transaction sbat where
							// sbtm.transaction_date
							// &gt;='&quot;+transaction_date_first+&quot;' and
							// transaction_date &lt; '&quot;+new
							// java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.transaction_type in ('SALE') and
							// sbat.agent_id=&quot;+agtUserId+&quot; and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale_retailer)&quot;;
<span class="nc" id="L701">							String queryForAgtRetVat = &quot;select (sale_retailer.vatAmt-purchvat.vatAmt) vatAmt from  (( select (purchSalevat.vat_amt-purchSaleretvat.vat_amt) vatAmt from ( select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;</span>
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT'  and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbtm.transaction_type in ('DG_SALE') and sbat.transaction_id=sbtm.transaction_id)purchSalevat,(select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and            transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT' and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbtm.transaction_type in ('DG_SALE_RET') and sbat.transaction_id=sbtm.transaction_id)purchSaleretvat) purchvat, (select (saleVat.vat_amt-saleRetVat.vat_amt) vatAmt from (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_dg_agt_sale sbat where sbtm.transaction_date &gt;='&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;'and sbtm.transaction_type in ('DG_SALE') and   sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleVat, (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_dg_agt_sale sbat where sbtm.transaction_date &gt;='&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.transaction_type in ('DG_SALE_RET') and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleRetVat) sale_retailer)&quot;;
							// String
							// queryForPlayer=QueryManager.getST3LastMonthTransaction()
							// + &quot; where transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L731">							logger</span>
									.debug(&quot;query---- for vat calculation ???????????  &quot;
											+ queryForAgtRetVat);
<span class="nc" id="L734">							RSPLR = stmt2.executeQuery(queryForAgtRetVat);</span>
<span class="nc bnc" id="L735" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L737">								double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L738">								logger</span>
										.debug(&quot;vat amount   from table&quot;
												+ vatAmt);
<span class="nc" id="L741">								vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L742">								logger.debug(&quot;calculated vat is    @@  &quot;</span>
										+ vatSum);

<span class="nc" id="L745">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L754" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L755">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L757">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L759">							String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L760">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L762">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L764">							Date taskDate = null;</span>
							try {
<span class="nc" id="L766">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L767">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L769">								e.printStackTrace();</span>
<span class="nc" id="L770">							}</span>

<span class="nc" id="L772">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTaskAgt()
									+ &quot;values('&quot;
									+ vatSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','VAT','UNAPPROVED',CURRENT_DATE,&quot;
									+ userOrgId + &quot;,'DG')&quot;;
<span class="nc" id="L780">							stmt3.executeUpdate(queryTaskCreate);</span>
						}

					}

<span class="nc bnc" id="L785" title="All 2 branches missed.">					if (j == YR) {</span>
<span class="nc" id="L786">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L787">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L789">						Date dd = null;</span>
<span class="nc" id="L790">						Date ddd = null;</span>
<span class="nc bnc" id="L791" title="All 2 branches missed.">						for (int i = 1; i &lt; MTH; i++) {</span>
<span class="nc" id="L792">							vatSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L795" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L796">								transaction_date_first = &quot;&quot; + YR + &quot;-&quot; + &quot;0&quot;</span>
										+ i + &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L799">								transaction_date_first = &quot;&quot; + YR + &quot;-&quot; + i</span>
										+ &quot;-&quot; + &quot;01&quot;;
							}

<span class="nc bnc" id="L803" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L804">								int day = 1;</span>
<span class="nc" id="L805">								cal.set(YR, i - 1, day);</span>
<span class="nc" id="L806">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L808">								cal.set(YR, i - 1, totalday);</span>
								try {
<span class="nc" id="L810">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L812">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L814">									e.printStackTrace();</span>
<span class="nc" id="L815">								}</span>
<span class="nc" id="L816">								cal.setTime(ddd);</span>
<span class="nc" id="L817">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L819">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L820">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +YR + &quot;-&quot; + &quot;0&quot;+i
								// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L824">							} else {</span>
<span class="nc" id="L825">								int day = 1;</span>
<span class="nc" id="L826">								cal.set(YR, i - 1, day);</span>
<span class="nc" id="L827">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L829">								cal.set(YR, i - 1, totalday);</span>
								try {
<span class="nc" id="L831">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L833">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L835">									e.printStackTrace();</span>
<span class="nc" id="L836">								}</span>
<span class="nc" id="L837">								cal.setTime(ddd);</span>
<span class="nc" id="L838">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L840">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L841">								dd = cal.getTime();</span>
								// transaction_date_last=&quot;&quot; +YR + &quot;-&quot;+i +&quot;-&quot;+
								// &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
							}

<span class="nc" id="L846">							logger.debug(&quot;result not  found in task table &quot;);</span>
							// String queryForAgtRetVat=&quot;select
							// (sale_retailer.vat_amt-purch.vat_amt) vatAmt from
							// ((select sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and
							// sbat.agent_org_id=&quot;+userOrgId+&quot; and
							// sbtm.transaction_type in ('SALE') and
							// sbat.transaction_id=sbtm.transaction_id)
							// purch,(select sum(sbat.vat_amt) vat_amt from
							// st_lms_agent_transaction_master
							// sbtm,st_se_agent_retailer_transaction sbat where
							// sbtm.transaction_date
							// &gt;='&quot;+transaction_date_first+&quot;' and
							// transaction_date &lt; '&quot;+new
							// java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.transaction_type in ('SALE') and
							// sbat.agent_id=&quot;+agtUserId+&quot; and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale_retailer)&quot;;
<span class="nc" id="L870">							String queryForAgtRetVat = &quot;select (sale_retailer.vatAmt-purchvat.vatAmt) vatAmt from  (( select (purchSalevat.vat_amt-purchSaleretvat.vat_amt) vatAmt from ( select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;</span>
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT'  and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbtm.transaction_type in ('DG_SALE') and sbat.transaction_id=sbtm.transaction_id)purchSalevat,(select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and            transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT' and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbtm.transaction_type in ('DG_SALE_RET') and sbat.transaction_id=sbtm.transaction_id)purchSaleretvat) purchvat, (select (saleVat.vat_amt-saleRetVat.vat_amt) vatAmt from (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_dg_agt_sale sbat where sbtm.transaction_date &gt;='&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;'and sbtm.transaction_type in ('DG_SALE') and   sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleVat, (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_dg_agt_sale sbat where sbtm.transaction_date &gt;='&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.transaction_type in ('DG_SALE_RET') and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleRetVat) sale_retailer)&quot;;
							// String
							// queryForPlayer=QueryManager.getST3LastMonthTransaction()
							// + &quot; where transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L900">							logger</span>
									.debug(&quot;query---- for vat calculation ???????????  &quot;
											+ queryForAgtRetVat);
<span class="nc" id="L903">							RSPLR = stmt2.executeQuery(queryForAgtRetVat);</span>
<span class="nc bnc" id="L904" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L906">								double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L907">								logger</span>
										.debug(&quot;vat amount   from table&quot;
												+ vatAmt);
<span class="nc" id="L910">								vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L911">								logger.debug(&quot;calculated vat is    @@  &quot;</span>
										+ vatSum);

<span class="nc" id="L914">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L923" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L924">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L926">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L928">							String yearfortask = &quot;&quot; + YR;</span>
<span class="nc" id="L929">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L931">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L933">							Date taskDate = null;</span>
							try {
<span class="nc" id="L935">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L936">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L938">								e.printStackTrace();</span>
<span class="nc" id="L939">							}</span>
<span class="nc" id="L940">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTaskAgt()
									+ &quot;values('&quot;
									+ vatSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','VAT','UNAPPROVED',CURRENT_DATE,&quot;
									+ userOrgId + &quot;,'DG')&quot;;
<span class="nc" id="L948">							stmt3.executeUpdate(queryTaskCreate);</span>
						}
					}

<span class="nc bnc" id="L952" title="All 2 branches missed.">					if (j != YR) {</span>
<span class="nc" id="L953">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L954">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L956">						Date dd = null;</span>
<span class="nc" id="L957">						Date ddd = null;</span>
<span class="nc bnc" id="L958" title="All 2 branches missed.">						for (int i = 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L959">							vatSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L962" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L963">								transaction_date_first = &quot;&quot; + j + &quot;-&quot; + &quot;0&quot; + i</span>
										+ &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L966">								transaction_date_first = &quot;&quot; + j + &quot;-&quot; + i + &quot;-&quot;</span>
										+ &quot;01&quot;;
							}

<span class="nc bnc" id="L970" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L971">								int day = 1;</span>
<span class="nc" id="L972">								cal.set(j, i - 1, day);</span>
<span class="nc" id="L973">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L975">								cal.set(j, i - 1, totalday);</span>
								try {
<span class="nc" id="L977">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L979">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L981">									e.printStackTrace();</span>
<span class="nc" id="L982">								}</span>
<span class="nc" id="L983">								cal.setTime(ddd);</span>
<span class="nc" id="L984">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L986">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L987">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +j + &quot;-&quot; + &quot;0&quot;+i
								// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L992">							} else {</span>
<span class="nc" id="L993">								int day = 1;</span>
<span class="nc" id="L994">								cal.set(j, i - 1, day);</span>
<span class="nc" id="L995">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L997">								cal.set(j, i - 1, totalday);</span>
								try {
<span class="nc" id="L999">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L1001">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L1003">									e.printStackTrace();</span>
<span class="nc" id="L1004">								}</span>
<span class="nc" id="L1005">								cal.setTime(ddd);</span>
<span class="nc" id="L1006">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L1008">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1009">								dd = cal.getTime();</span>
								// transaction_date_last=&quot;&quot; +j + &quot;-&quot;+i +&quot;-&quot;+
								// &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
							}
<span class="nc" id="L1013">							logger.debug(&quot;result not  found in task table &quot;);</span>
							// String queryForAgtRetVat=&quot;select
							// (sale_retailer.vat_amt-purch.vat_amt) vatAmt from
							// ((select sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and
							// sbat.agent_org_id=&quot;+userOrgId+&quot; and
							// sbtm.transaction_type in ('SALE') and
							// sbat.transaction_id=sbtm.transaction_id)
							// purch,(select sum(sbat.vat_amt) vat_amt from
							// st_lms_agent_transaction_master
							// sbtm,st_se_agent_retailer_transaction sbat where
							// sbtm.transaction_date
							// &gt;='&quot;+transaction_date_first+&quot;' and
							// transaction_date &lt; '&quot;+new
							// java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.transaction_type in ('SALE') and
							// sbat.agent_id=&quot;+agtUserId+&quot; and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale_retailer)&quot;;
<span class="nc" id="L1037">							String queryForAgtRetVat = &quot;select (sale_retailer.vatAmt-purchvat.vatAmt) vatAmt from  (( select (purchSalevat.vat_amt-purchSaleretvat.vat_amt) vatAmt from ( select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;</span>
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT'  and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbtm.transaction_type in ('DG_SALE') and sbat.transaction_id=sbtm.transaction_id)purchSalevat,(select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_dg_bo_sale sbat where sbtm.transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and            transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT' and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbtm.transaction_type in ('DG_SALE_RET') and sbat.transaction_id=sbtm.transaction_id)purchSaleretvat) purchvat, (select (saleVat.vat_amt-saleRetVat.vat_amt) vatAmt from (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_dg_agt_sale sbat where sbtm.transaction_date &gt;='&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;'and sbtm.transaction_type in ('DG_SALE') and   sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleVat, (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_dg_agt_sale sbat where sbtm.transaction_date &gt;='&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.transaction_type in ('DG_SALE_RET') and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleRetVat) sale_retailer)&quot;;
							// String
							// queryForPlayer=QueryManager.getST3LastMonthTransaction()
							// + &quot; where transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L1067">							logger</span>
									.debug(&quot;query---- for vat calculation ???????????  &quot;
											+ queryForAgtRetVat);
<span class="nc" id="L1070">							RSPLR = stmt2.executeQuery(queryForAgtRetVat);</span>
<span class="nc bnc" id="L1071" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L1073">								double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L1074">								logger</span>
										.debug(&quot;vat amount   from table&quot;
												+ vatAmt);
<span class="nc" id="L1077">								vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L1078">								logger.debug(&quot;calculated vat is    @@  &quot;</span>
										+ vatSum);

<span class="nc" id="L1081">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L1090" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L1091">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L1093">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L1095">							String yearfortask = &quot;&quot; + j;</span>
<span class="nc" id="L1096">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L1098">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L1100">							Date taskDate = null;</span>
							try {
<span class="nc" id="L1102">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L1103">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L1105">								e.printStackTrace();</span>
<span class="nc" id="L1106">							}</span>

<span class="nc" id="L1108">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTaskAgt()
									+ &quot;values('&quot;
									+ vatSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','VAT','UNAPPROVED',CURRENT_DATE,&quot;
									+ userOrgId + &quot;,'DG')&quot;;
<span class="nc" id="L1116">							stmt3.executeUpdate(queryTaskCreate);</span>

						}
					}

				}
			}

<span class="nc" id="L1124">			TaskBean taskBean = null;</span>

<span class="nc" id="L1126">			List&lt;TaskBean&gt; searchResults = new ArrayList&lt;TaskBean&gt;();</span>
<span class="nc" id="L1127">			logger.debug(&quot;333333333333333333hhhhhhhhhhh&quot;);</span>
<span class="nc" id="L1128">			ResultSet rs3 = stmt4.executeQuery(QueryManager</span>
					.getUnapprovedVATAgtDG()
					+ userOrgId);

<span class="nc bnc" id="L1132" title="All 2 branches missed.">			while (rs3.next()) {</span>
<span class="nc" id="L1133">				taskBean = new TaskBean();</span>
<span class="nc" id="L1134">				taskBean.setAmount(rs3.getDouble(&quot;amount&quot;));</span>

				// SimpleDateFormat date1 = new
				// SimpleDateFormat(&quot;dd-MM-yyyy&quot;);//it would be the format set
				// by Vineet
				// taskBean.setMonth(date1.format(rs3.getDate(&quot;month&quot;)));
				// logger.debug(&quot;heeeeeeeeeeeeellllllll
				// &quot;+date1.format(rs3.getDate(&quot;month&quot;)) );
<span class="nc" id="L1142">				taskBean.setMonth(rs3.getString(TableConstants.MONTH_TASK));</span>
<span class="nc" id="L1143">				taskBean.setTransactionType(rs3</span>
						.getString(TableConstants.TASK_TYPE));
<span class="nc" id="L1145">				taskBean.setStatus(rs3.getString(TableConstants.TASK_STATUS));</span>
<span class="nc" id="L1146">				taskBean.setTaskId(rs3.getInt(TableConstants.TASK_ID));</span>
<span class="nc" id="L1147">				taskBean.setServiceCode(&quot;DG&quot;);</span>
<span class="nc" id="L1148">				taskBean.setServiceName(serviceName);</span>
<span class="nc" id="L1149">				logger.debug(&quot;taskid is   &quot; + rs3.getInt(&quot;task_id&quot;));</span>
				// userBean.setRegisterDate(resultSet.getDate(TableConstants.Register_DATE));
<span class="nc" id="L1151">				searchResults.add(taskBean);</span>
			}

<span class="nc" id="L1154">			con.commit();</span>
<span class="nc" id="L1155">			con.close(); // added by yogesh at the time of self review</span>
<span class="nc" id="L1156">			return searchResults;</span>

<span class="nc" id="L1158">		} catch (SQLException e) {</span>

			try {
<span class="nc" id="L1161">				con.rollback();</span>
<span class="nc" id="L1162">			} catch (SQLException se) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L1164">				se.printStackTrace();</span>
<span class="nc" id="L1165">				throw new LMSException(&quot;Error During Rollback&quot;, se);</span>
<span class="nc" id="L1166">			}</span>
<span class="nc" id="L1167">			e.printStackTrace();</span>
<span class="nc" id="L1168">			throw new LMSException(e);</span>

		}
		// return null;

	}

	public List vatSearchSE(Integer month, Integer year, Integer userOrgId,
			Integer agtUserId) throws LMSException {
<span class="nc" id="L1177">		logger.debug(&quot;vatSearchSE called &quot;);</span>
<span class="nc" id="L1178">		double vatSum = 0;</span>
<span class="nc" id="L1179">		boolean tds = false;</span>
<span class="nc" id="L1180">		boolean isEntry = false;</span>
<span class="nc" id="L1181">		int yearTable = 0;</span>
<span class="nc" id="L1182">		int monthTable = 0;</span>

<span class="nc" id="L1184">		int latestyearTaxCal = 0;</span>
<span class="nc" id="L1185">		int latestmonthTaxCal = 0;</span>
<span class="nc" id="L1186">		String serviceName = &quot;&quot;;</span>

<span class="nc" id="L1188">		NumberFormat nf = NumberFormat.getInstance();</span>
<span class="nc" id="L1189">		nf.setMaximumFractionDigits(2);</span>
<span class="nc" id="L1190">		nf.setMinimumFractionDigits(2);</span>

<span class="nc" id="L1192">		SimpleDateFormat date = new SimpleDateFormat();</span>

<span class="nc" id="L1194">		Calendar rightNow = Calendar.getInstance();</span>

<span class="nc" id="L1196">		int YR = rightNow.get(Calendar.YEAR);</span>
<span class="nc" id="L1197">		int MTH = rightNow.get(Calendar.MONTH) + 1;</span>

<span class="nc" id="L1199">		int depYear = year;</span>
<span class="nc" id="L1200">		int depMonth = month;</span>
<span class="nc" id="L1201">		logger.debug(&quot;inside deploy date changed&quot;);</span>

		// int MTH=11;
<span class="nc" id="L1204">		logger.debug(&quot;month from system  &quot; + MTH);</span>

<span class="nc" id="L1206">		logger.debug(&quot;not depriceted   &quot; + YR);</span>
<span class="nc" id="L1207">		logger.debug(&quot;not depriceted   &quot; + MTH);</span>

<span class="nc" id="L1209">		Connection con = null;</span>

		try {

			 
<span class="nc" id="L1214">			con = DBConnect.getConnection();</span>
<span class="nc" id="L1215">			con.setAutoCommit(false);</span>

<span class="nc" id="L1217">			Statement stmt1 = con.createStatement();</span>
<span class="nc" id="L1218">			Statement stmt2 = con.createStatement();</span>
<span class="nc" id="L1219">			Statement stmt3 = con.createStatement();</span>
<span class="nc" id="L1220">			Statement stmt4 = con.createStatement();</span>
<span class="nc" id="L1221">			Statement stmt6 = con.createStatement();</span>
			PreparedStatement stmt5;

<span class="nc" id="L1224">			ResultSet rs = null;</span>
<span class="nc" id="L1225">			ResultSet RSPLR = null;</span>
<span class="nc" id="L1226">			logger.debug(&quot;heeeeeee&quot;);</span>
<span class="nc" id="L1227">			rs = stmt6</span>
					.executeQuery(&quot;select service_display_name from st_lms_service_master where service_code='SE' and status='ACTIVE'&quot;);
<span class="nc bnc" id="L1229" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L1230">				serviceName = rs.getString(&quot;service_display_name&quot;);</span>
			}
<span class="nc" id="L1232">			stmt5 = con.prepareStatement(QueryManager.getLatestMonthVATAgtSE());</span>
<span class="nc" id="L1233">			stmt5.setInt(1, userOrgId);</span>
<span class="nc" id="L1234">			ResultSet latestMonth = stmt5.executeQuery();</span>
<span class="nc bnc" id="L1235" title="All 2 branches missed.">			while (latestMonth.next()) {</span>
<span class="nc" id="L1236">				Calendar rightNow1 = Calendar.getInstance();</span>

<span class="nc" id="L1238">				Date dt = latestMonth.getDate(&quot;month&quot;);</span>
<span class="nc" id="L1239">				logger.debug(&quot;get date from db &quot; + dt);</span>
<span class="nc" id="L1240">				rightNow1.setTime(dt);</span>
<span class="nc" id="L1241">				latestyearTaxCal = rightNow1.get(Calendar.YEAR);</span>
<span class="nc" id="L1242">				latestmonthTaxCal = rightNow1.get(Calendar.MONTH) + 1;</span>
<span class="nc" id="L1243">				logger.debug(&quot; latest year &quot; + latestyearTaxCal);</span>
<span class="nc" id="L1244">				logger.debug(&quot; latest month &quot; + latestmonthTaxCal);</span>

				/*
				 * String latestDate=latestMonth.getString(&quot;month&quot;); String
				 * latestyear=latestDate.substring(0,4); String
				 * latestmonth=latestDate.substring(5,7);
				 * latestyearTaxCal=Integer.parseInt(latestyear);
				 * latestmonthTaxCal=Integer.parseInt(latestmonth);
				 * 
				 * logger.debug(&quot;latest year from task table &quot; + latestyear);
				 * logger.debug(&quot;latest month from task table &quot; + latestmonth);
				 */
<span class="nc" id="L1256">				isEntry = true;</span>
<span class="nc" id="L1257">				break;</span>

			}

<span class="nc bnc" id="L1261" title="All 2 branches missed.">			if (isEntry == false) {</span>
<span class="nc" id="L1262">				logger.debug(&quot;when no entry for VAT&quot;);</span>
<span class="nc" id="L1263">				latestyearTaxCal = depYear;</span>
<span class="nc bnc" id="L1264" title="All 2 branches missed.">				if (depMonth == 01) {</span>
<span class="nc" id="L1265">					latestmonthTaxCal = 00;</span>
				} else {
<span class="nc" id="L1267">					latestmonthTaxCal = depMonth - 1;</span>
				}

			}

<span class="nc bnc" id="L1272" title="All 2 branches missed.">			if (YR == latestyearTaxCal)</span>

			{

<span class="nc" id="L1276">				logger.debug(&quot;inside same year&quot;);</span>
<span class="nc bnc" id="L1277" title="All 2 branches missed.">				for (int i = latestmonthTaxCal + 1; i &lt; MTH; i++) {</span>

<span class="nc" id="L1279">					Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L1280">					SimpleDateFormat dtfmt = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L1281">					Date dd = null;</span>
<span class="nc" id="L1282">					Date newdate = null;</span>
<span class="nc" id="L1283">					vatSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L1286" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L1287">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L1290">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L1294" title="All 2 branches missed.">					if (i &lt; 10)</span>

					{
<span class="nc" id="L1297">						int day = 1;</span>
<span class="nc" id="L1298">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L1299">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1301">						cal.set(latestyearTaxCal, i - 1, totalday);</span>
						try {
<span class="nc" id="L1303">							newdate = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L1304">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L1306">							e.printStackTrace();</span>
<span class="nc" id="L1307">						}</span>
<span class="nc" id="L1308">						cal.setTime(newdate);</span>
<span class="nc" id="L1309">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L1310">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1311">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot; +
						// &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L1315">					} else {</span>
<span class="nc" id="L1316">						int day = 1;</span>
<span class="nc" id="L1317">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L1318">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1320">						cal.set(latestyearTaxCal, i - 1, totalday);</span>
						try {
<span class="nc" id="L1322">							newdate = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L1323">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L1325">							e.printStackTrace();</span>
<span class="nc" id="L1326">						}</span>
<span class="nc" id="L1327">						cal.setTime(newdate);</span>
<span class="nc" id="L1328">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L1329">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1330">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot;+i
						// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}
<span class="nc" id="L1335">					logger.debug(&quot;9999999999999999999999&quot;);</span>
<span class="nc" id="L1336">					logger.debug(transaction_date_first);</span>
					// logger.debug(transaction_date_last);

					// String queryForAgtRetVat=&quot;select
					// (sale_retailer.vat_amt-purch.vat_amt) vatAmt from
					// ((select sum(sbat.vat_amt) vat_amt from
					// st_lms_bo_transaction_master
					// sbtm,st_se_bo_agent_transaction sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and
					// sbat.agent_org_id=&quot;+userOrgId+&quot; and sbtm.transaction_type
					// in ('SALE') and sbat.transaction_id=sbtm.transaction_id)
					// purch,(select sum(sbat.vat_amt) vat_amt from
					// st_lms_agent_transaction_master
					// sbtm,st_se_agent_retailer_transaction sbat where
					// sbtm.transaction_date &gt;='&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.transaction_type in ('SALE') and
					// sbat.agent_id=&quot;+agtUserId+&quot; and
					// sbat.transaction_id=sbtm.transaction_id) sale_retailer)&quot;;

<span class="nc" id="L1360">					String queryForAgtRetVat = &quot;select (sale_retailer.vatAmt-purchvat.vatAmt) vatAmt from  (( select (purchSalevat.vat_amt-purchSaleretvat.vat_amt) vatAmt from ( select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;</span>
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT'  and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id)purchSalevat,(select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and            transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT' and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id)purchSaleretvat) purchvat, (select (saleVat.vat_amt-saleRetVat.vat_amt) vatAmt from (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_se_agent_retailer_transaction sbat where sbtm.transaction_date &gt;='&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;'and sbtm.transaction_type in ('SALE') and   sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleVat, (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_se_agent_retailer_transaction sbat where sbtm.transaction_date &gt;='&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.transaction_type in ('SALE_RET') and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleRetVat) sale_retailer)&quot;;

					// String
					// queryForPlayer=QueryManager.getST3LastMonthTransaction()
					// + &quot; where transaction_date &gt;=
					// '&quot;+transaction_date_first+&quot;' and transaction_date &lt;
					// '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L1391">					logger.debug(&quot;query---- for vat calculation ???????????  &quot;</span>
							+ queryForAgtRetVat);
<span class="nc" id="L1393">					RSPLR = stmt2.executeQuery(queryForAgtRetVat);</span>
<span class="nc bnc" id="L1394" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L1396">						double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L1397">						logger.debug(&quot;vat amount   from table&quot; + vatAmt);</span>
<span class="nc" id="L1398">						vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L1399">						logger.debug(&quot;calculated vat is    @@  &quot; + vatSum);</span>

<span class="nc" id="L1401">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L1409" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L1410">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L1412">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L1414">					String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L1415">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L1417">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L1418">					Date taskDate = null;</span>
					try {
<span class="nc" id="L1420">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L1421">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L1423">						e.printStackTrace();</span>
<span class="nc" id="L1424">					}</span>
<span class="nc" id="L1425">					logger.debug(&quot;date to insert &quot; + taskDate);</span>

<span class="nc" id="L1427">					String queryTaskCreate = QueryManager.getST3CreateTaskAgt()</span>
							+ &quot;values('&quot; + vatSum + &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','VAT','UNAPPROVED',CURRENT_DATE,&quot; + userOrgId
							+ &quot;,'SE')&quot;;
<span class="nc" id="L1432">					stmt3.executeUpdate(queryTaskCreate);</span>

				}

			}

<span class="nc bnc" id="L1438" title="All 2 branches missed.">			if (YR == latestyearTaxCal + 1) {</span>
<span class="nc" id="L1439">				logger.debug(&quot;when diff is one&quot;);</span>
<span class="nc" id="L1440">				Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L1441">				SimpleDateFormat dtfmt = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>

<span class="nc bnc" id="L1443" title="All 2 branches missed.">				for (int i = latestmonthTaxCal + 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L1444">					Date dd = null;</span>
<span class="nc" id="L1445">					Date ddd = null;</span>
<span class="nc" id="L1446">					vatSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L1449" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L1450">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L1453">						transaction_date_first = &quot;&quot; + latestyearTaxCal + &quot;-&quot;</span>
								+ i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L1457" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L1458">						int day = 1;</span>
<span class="nc" id="L1459">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L1460">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1462">						cal.set(latestyearTaxCal, i - 1, totalday);</span>

						try {
<span class="nc" id="L1465">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L1466">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L1468">							e.printStackTrace();</span>
<span class="nc" id="L1469">						}</span>
<span class="nc" id="L1470">						cal.setTime(ddd);</span>
<span class="nc" id="L1471">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L1472">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1473">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot; +
						// &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L1478">					} else {</span>
<span class="nc" id="L1479">						int day = 1;</span>
<span class="nc" id="L1480">						cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L1481">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1483">						cal.set(latestyearTaxCal, i - 1, totalday);</span>

						try {
<span class="nc" id="L1486">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L1487">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L1489">							e.printStackTrace();</span>
<span class="nc" id="L1490">						}</span>
<span class="nc" id="L1491">						cal.setTime(ddd);</span>
<span class="nc" id="L1492">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L1493">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1494">						dd = cal.getTime();</span>

						// transaction_date_last=&quot;&quot; +latestyearTaxCal + &quot;-&quot;+i
						// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}

					// String queryForAgtRetVat=&quot;select
					// (sale_retailer.vat_amt-purch.vat_amt) vatAmt from
					// ((select sum(sbat.vat_amt) vat_amt from
					// st_lms_bo_transaction_master
					// sbtm,st_se_bo_agent_transaction sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and
					// sbat.agent_org_id=&quot;+userOrgId+&quot; and sbtm.transaction_type
					// in ('SALE') and sbat.transaction_id=sbtm.transaction_id)
					// purch,(select sum(sbat.vat_amt) vat_amt from
					// st_lms_agent_transaction_master
					// sbtm,st_se_agent_retailer_transaction sbat where
					// sbtm.transaction_date &gt;='&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.transaction_type in ('SALE') and
					// sbat.agent_id=&quot;+agtUserId+&quot; and
					// sbat.transaction_id=sbtm.transaction_id) sale_retailer)&quot;;
<span class="nc" id="L1520">					String queryForAgtRetVat = &quot;select (sale_retailer.vatAmt-purchvat.vatAmt) vatAmt from  (( select (purchSalevat.vat_amt-purchSaleretvat.vat_amt) vatAmt from ( select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;</span>
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT'  and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id)purchSalevat,(select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and            transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT' and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id)purchSaleretvat) purchvat, (select (saleVat.vat_amt-saleRetVat.vat_amt) vatAmt from (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_se_agent_retailer_transaction sbat where sbtm.transaction_date &gt;='&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;'and sbtm.transaction_type in ('SALE') and   sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleVat, (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_se_agent_retailer_transaction sbat where sbtm.transaction_date &gt;='&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.transaction_type in ('SALE_RET') and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleRetVat) sale_retailer)&quot;;
					// String
					// queryForPlayer=QueryManager.getST3LastMonthTransaction()
					// + &quot; where transaction_date &gt;=
					// '&quot;+transaction_date_first+&quot;' and transaction_date &lt;
					// '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L1550">					logger.debug(&quot;query---- for vat calculation ???????????  &quot;</span>
							+ queryForAgtRetVat);
<span class="nc" id="L1552">					RSPLR = stmt2.executeQuery(queryForAgtRetVat);</span>
<span class="nc bnc" id="L1553" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L1555">						double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L1556">						logger.debug(&quot;vat amount   from table&quot; + vatAmt);</span>
<span class="nc" id="L1557">						vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L1558">						logger.debug(&quot;calculated vat is    @@  &quot; + vatSum);</span>

<span class="nc" id="L1560">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L1568" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L1569">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L1571">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L1573">					String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L1574">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L1576">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L1577">					Date taskDate = null;</span>
					try {
<span class="nc" id="L1579">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L1580">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L1582">						e.printStackTrace();</span>
<span class="nc" id="L1583">					}</span>

<span class="nc" id="L1585">					String queryTaskCreate = QueryManager.getST3CreateTaskAgt()</span>
							+ &quot;values('&quot; + vatSum + &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','VAT','UNAPPROVED',CURRENT_DATE,&quot; + userOrgId
							+ &quot;,'SE')&quot;;
<span class="nc" id="L1590">					stmt3.executeUpdate(queryTaskCreate);</span>

				}

<span class="nc bnc" id="L1594" title="All 2 branches missed.">				for (int i = 1; i &lt; MTH; i++) {</span>
<span class="nc" id="L1595">					Date dd = null;</span>
<span class="nc" id="L1596">					Date ddd = null;</span>
<span class="nc" id="L1597">					vatSum = 0.0;</span>
					String transaction_date_first;
					String transaction_date_last;
<span class="nc bnc" id="L1600" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L1601">						transaction_date_first = &quot;&quot; + (latestyearTaxCal + 1)</span>
								+ &quot;-&quot; + &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
					} else {
<span class="nc" id="L1604">						transaction_date_first = &quot;&quot; + (latestyearTaxCal + 1)</span>
								+ &quot;-&quot; + i + &quot;-&quot; + &quot;01&quot;;
					}

<span class="nc bnc" id="L1608" title="All 2 branches missed.">					if (i &lt; 10)</span>

					{
<span class="nc" id="L1611">						int day = 1;</span>
<span class="nc" id="L1612">						cal.set(latestyearTaxCal + 1, i - 1, day);</span>
<span class="nc" id="L1613">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1615">						cal.set(latestyearTaxCal + 1, i - 1, totalday);</span>
						try {
<span class="nc" id="L1617">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L1618">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L1620">							e.printStackTrace();</span>
<span class="nc" id="L1621">						}</span>
<span class="nc" id="L1622">						cal.setTime(ddd);</span>
<span class="nc" id="L1623">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L1624">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1625">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +(latestyearTaxCal+1) + &quot;-&quot;
						// + &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L1628">					} else {</span>

<span class="nc" id="L1630">						int day = 1;</span>
<span class="nc" id="L1631">						cal.set(latestyearTaxCal + 1, i - 1, day);</span>
<span class="nc" id="L1632">						int totalday = cal</span>
								.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1634">						cal.set(latestyearTaxCal + 1, i - 1, totalday);</span>
						try {
<span class="nc" id="L1636">							ddd = dtfmt.parse(dtfmt.format(cal.getTime()));</span>
<span class="nc" id="L1637">						} catch (ParseException e) {</span>
							// TODO Auto-generated catch block
<span class="nc" id="L1639">							e.printStackTrace();</span>
<span class="nc" id="L1640">						}</span>
<span class="nc" id="L1641">						cal.setTime(ddd);</span>
<span class="nc" id="L1642">						long ms = cal.getTimeInMillis() + 1000 * 24 * 60 * 60;</span>
<span class="nc" id="L1643">						cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1644">						dd = cal.getTime();</span>
						// transaction_date_last=&quot;&quot; +(latestyearTaxCal+1) +
						// &quot;-&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
					}
<span class="nc" id="L1648">					logger.debug(&quot;result not  found in task table &quot;);</span>
					// String queryForAgtRetVat=&quot;select
					// (sale_retailer.vat_amt-purch.vat_amt) vatAmt from
					// ((select sum(sbat.vat_amt) vat_amt from
					// st_lms_bo_transaction_master
					// sbtm,st_se_bo_agent_transaction sbat where
					// sbtm.transaction_date &gt;= '&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.party_type='AGENT' and
					// sbat.agent_org_id=&quot;+userOrgId+&quot; and sbtm.transaction_type
					// in ('SALE') and sbat.transaction_id=sbtm.transaction_id)
					// purch,(select sum(sbat.vat_amt) vat_amt from
					// st_lms_agent_transaction_master
					// sbtm,st_se_agent_retailer_transaction sbat where
					// sbtm.transaction_date &gt;='&quot;+transaction_date_first+&quot;' and
					// transaction_date &lt; '&quot;+new
					// java.sql.Timestamp(dd.getTime())+&quot;' and
					// sbtm.transaction_type in ('SALE') and
					// sbat.agent_id=&quot;+agtUserId+&quot; and
					// sbat.transaction_id=sbtm.transaction_id) sale_retailer)&quot;;
<span class="nc" id="L1669">					String queryForAgtRetVat = &quot;select (sale_retailer.vatAmt-purchvat.vatAmt) vatAmt from  (( select (purchSalevat.vat_amt-purchSaleretvat.vat_amt) vatAmt from ( select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;</span>
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT'  and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id)purchSalevat,(select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;
							+ transaction_date_first
							+ &quot;' and            transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.party_type='AGENT' and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id)purchSaleretvat) purchvat, (select (saleVat.vat_amt-saleRetVat.vat_amt) vatAmt from (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_se_agent_retailer_transaction sbat where sbtm.transaction_date &gt;='&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;'and sbtm.transaction_type in ('SALE') and   sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleVat, (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_se_agent_retailer_transaction sbat where sbtm.transaction_date &gt;='&quot;
							+ transaction_date_first
							+ &quot;' and transaction_date &lt; '&quot;
							+ new java.sql.Timestamp(dd.getTime())
							+ &quot;' and sbtm.transaction_type in ('SALE_RET') and sbat.agent_org_id=&quot;
							+ userOrgId
							+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleRetVat) sale_retailer)&quot;;
					// String
					// queryForPlayer=QueryManager.getST3LastMonthTransaction()
					// + &quot; where transaction_date &gt;=
					// '&quot;+transaction_date_first+&quot;' and transaction_date &lt;
					// '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L1699">					logger.debug(&quot;query---- for vat calculation ???????????  &quot;</span>
							+ queryForAgtRetVat);
<span class="nc" id="L1701">					RSPLR = stmt2.executeQuery(queryForAgtRetVat);</span>
<span class="nc bnc" id="L1702" title="All 2 branches missed.">					while (RSPLR.next()) {</span>

<span class="nc" id="L1704">						double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L1705">						logger.debug(&quot;vat amount   from table&quot; + vatAmt);</span>
<span class="nc" id="L1706">						vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L1707">						logger.debug(&quot;calculated vat is    @@  &quot; + vatSum);</span>

<span class="nc" id="L1709">					}</span>

					/*
					 * try{ taxSum=Double.parseDouble(nf.format(taxSum)); }
					 * catch(NumberFormatException e) {}
					 */

					String monthfortask;
<span class="nc bnc" id="L1717" title="All 2 branches missed.">					if (i &lt; 10) {</span>
<span class="nc" id="L1718">						monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
					} else {
<span class="nc" id="L1720">						monthfortask = &quot;-&quot; + i;</span>
					}
<span class="nc" id="L1722">					String yearfortask = &quot;&quot; + (latestyearTaxCal + 1);</span>
<span class="nc" id="L1723">					String taskDate1 = yearfortask.concat(monthfortask).concat(</span>
							&quot;-01&quot;);
<span class="nc" id="L1725">					SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L1726">					Date taskDate = null;</span>
					try {
<span class="nc" id="L1728">						taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L1729">					} catch (ParseException e) {</span>
						// TODO Auto-generated catch block
<span class="nc" id="L1731">						e.printStackTrace();</span>
<span class="nc" id="L1732">					}</span>
<span class="nc" id="L1733">					String queryTaskCreate = QueryManager.getST3CreateTaskAgt()</span>
							+ &quot;values('&quot; + vatSum + &quot;','&quot;
							+ new java.sql.Date(taskDate.getTime())
							+ &quot;','VAT','UNAPPROVED',CURRENT_DATE,&quot; + userOrgId
							+ &quot;,'SE')&quot;;
<span class="nc" id="L1738">					stmt3.executeUpdate(queryTaskCreate);</span>

				}
			}

<span class="nc bnc" id="L1743" title="All 2 branches missed.">			if (YR &gt; latestyearTaxCal + 1) {</span>
<span class="nc" id="L1744">				logger.debug(&quot;when diff is more then one&quot;);</span>
<span class="nc bnc" id="L1745" title="All 2 branches missed.">				for (int j = latestyearTaxCal; j &lt;= YR; j++) {</span>
<span class="nc bnc" id="L1746" title="All 2 branches missed.">					if (j == latestyearTaxCal) {</span>
<span class="nc" id="L1747">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L1748">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L1750">						Date dd = null;</span>
<span class="nc" id="L1751">						Date ddd = null;</span>

<span class="nc bnc" id="L1753" title="All 2 branches missed.">						for (int i = latestmonthTaxCal + 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L1754">							vatSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L1757" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L1758">								transaction_date_first = &quot;&quot; + latestyearTaxCal</span>
										+ &quot;-&quot; + &quot;0&quot; + i + &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L1761">								transaction_date_first = &quot;&quot; + latestyearTaxCal</span>
										+ &quot;-&quot; + i + &quot;-&quot; + &quot;01&quot;;
							}

<span class="nc bnc" id="L1765" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L1766">								int day = 1;</span>
<span class="nc" id="L1767">								cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L1768">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1770">								cal.set(latestyearTaxCal, i - 1, totalday);</span>
								try {
<span class="nc" id="L1772">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L1774">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L1776">									e.printStackTrace();</span>
<span class="nc" id="L1777">								}</span>
<span class="nc" id="L1778">								cal.setTime(ddd);</span>
<span class="nc" id="L1779">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L1781">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1782">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +latestyearTaxCal +
								// &quot;-&quot; + &quot;0&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L1786">							} else {</span>
<span class="nc" id="L1787">								int day = 1;</span>
<span class="nc" id="L1788">								cal.set(latestyearTaxCal, i - 1, day);</span>
<span class="nc" id="L1789">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1791">								cal.set(latestyearTaxCal, i - 1, totalday);</span>
								try {
<span class="nc" id="L1793">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L1795">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L1797">									e.printStackTrace();</span>
<span class="nc" id="L1798">								}</span>
<span class="nc" id="L1799">								cal.setTime(ddd);</span>
<span class="nc" id="L1800">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L1802">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1803">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +latestyearTaxCal +
								// &quot;-&quot;+i +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

							}
							// String queryForAgtRetVat=&quot;select
							// (sale_retailer.vat_amt-purch.vat_amt) vatAmt from
							// ((select sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and
							// sbat.agent_org_id=&quot;+userOrgId+&quot; and
							// sbtm.transaction_type in ('SALE') and
							// sbat.transaction_id=sbtm.transaction_id)
							// purch,(select sum(sbat.vat_amt) vat_amt from
							// st_lms_agent_transaction_master
							// sbtm,st_se_agent_retailer_transaction sbat where
							// sbtm.transaction_date
							// &gt;='&quot;+transaction_date_first+&quot;' and
							// transaction_date &lt; '&quot;+new
							// java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.transaction_type in ('SALE') and
							// sbat.agent_id=&quot;+agtUserId+&quot; and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale_retailer)&quot;;
<span class="nc" id="L1832">							String queryForAgtRetVat = &quot;select (sale_retailer.vatAmt-purchvat.vatAmt) vatAmt from  (( select (purchSalevat.vat_amt-purchSaleretvat.vat_amt) vatAmt from ( select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;</span>
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT'  and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id)purchSalevat,(select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and            transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT' and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id)purchSaleretvat) purchvat, (select (saleVat.vat_amt-saleRetVat.vat_amt) vatAmt from (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_se_agent_retailer_transaction sbat where sbtm.transaction_date &gt;='&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;'and sbtm.transaction_type in ('SALE') and   sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleVat, (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_se_agent_retailer_transaction sbat where sbtm.transaction_date &gt;='&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.transaction_type in ('SALE_RET') and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleRetVat) sale_retailer)&quot;;
							// String
							// queryForPlayer=QueryManager.getST3LastMonthTransaction()
							// + &quot; where transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L1862">							logger</span>
									.debug(&quot;query---- for vat calculation ???????????  &quot;
											+ queryForAgtRetVat);
<span class="nc" id="L1865">							RSPLR = stmt2.executeQuery(queryForAgtRetVat);</span>
<span class="nc bnc" id="L1866" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L1868">								double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L1869">								logger</span>
										.debug(&quot;vat amount   from table&quot;
												+ vatAmt);
<span class="nc" id="L1872">								vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L1873">								logger.debug(&quot;calculated vat is    @@  &quot;</span>
										+ vatSum);

<span class="nc" id="L1876">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L1885" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L1886">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L1888">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L1890">							String yearfortask = &quot;&quot; + latestyearTaxCal;</span>
<span class="nc" id="L1891">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L1893">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L1895">							Date taskDate = null;</span>
							try {
<span class="nc" id="L1897">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L1898">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L1900">								e.printStackTrace();</span>
<span class="nc" id="L1901">							}</span>

<span class="nc" id="L1903">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTaskAgt()
									+ &quot;values('&quot;
									+ vatSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','VAT','UNAPPROVED',CURRENT_DATE,&quot;
									+ userOrgId + &quot;,'SE')&quot;;
<span class="nc" id="L1911">							stmt3.executeUpdate(queryTaskCreate);</span>
						}

					}

<span class="nc bnc" id="L1916" title="All 2 branches missed.">					if (j == YR) {</span>
<span class="nc" id="L1917">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L1918">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L1920">						Date dd = null;</span>
<span class="nc" id="L1921">						Date ddd = null;</span>
<span class="nc bnc" id="L1922" title="All 2 branches missed.">						for (int i = 1; i &lt; MTH; i++) {</span>
<span class="nc" id="L1923">							vatSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L1926" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L1927">								transaction_date_first = &quot;&quot; + YR + &quot;-&quot; + &quot;0&quot;</span>
										+ i + &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L1930">								transaction_date_first = &quot;&quot; + YR + &quot;-&quot; + i</span>
										+ &quot;-&quot; + &quot;01&quot;;
							}

<span class="nc bnc" id="L1934" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L1935">								int day = 1;</span>
<span class="nc" id="L1936">								cal.set(YR, i - 1, day);</span>
<span class="nc" id="L1937">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1939">								cal.set(YR, i - 1, totalday);</span>
								try {
<span class="nc" id="L1941">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L1943">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L1945">									e.printStackTrace();</span>
<span class="nc" id="L1946">								}</span>
<span class="nc" id="L1947">								cal.setTime(ddd);</span>
<span class="nc" id="L1948">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L1950">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1951">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +YR + &quot;-&quot; + &quot;0&quot;+i
								// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
<span class="nc" id="L1955">							} else {</span>
<span class="nc" id="L1956">								int day = 1;</span>
<span class="nc" id="L1957">								cal.set(YR, i - 1, day);</span>
<span class="nc" id="L1958">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L1960">								cal.set(YR, i - 1, totalday);</span>
								try {
<span class="nc" id="L1962">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L1964">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L1966">									e.printStackTrace();</span>
<span class="nc" id="L1967">								}</span>
<span class="nc" id="L1968">								cal.setTime(ddd);</span>
<span class="nc" id="L1969">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L1971">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L1972">								dd = cal.getTime();</span>
								// transaction_date_last=&quot;&quot; +YR + &quot;-&quot;+i +&quot;-&quot;+
								// &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
							}

<span class="nc" id="L1977">							logger.debug(&quot;result not  found in task table &quot;);</span>
							// String queryForAgtRetVat=&quot;select
							// (sale_retailer.vat_amt-purch.vat_amt) vatAmt from
							// ((select sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and
							// sbat.agent_org_id=&quot;+userOrgId+&quot; and
							// sbtm.transaction_type in ('SALE') and
							// sbat.transaction_id=sbtm.transaction_id)
							// purch,(select sum(sbat.vat_amt) vat_amt from
							// st_lms_agent_transaction_master
							// sbtm,st_se_agent_retailer_transaction sbat where
							// sbtm.transaction_date
							// &gt;='&quot;+transaction_date_first+&quot;' and
							// transaction_date &lt; '&quot;+new
							// java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.transaction_type in ('SALE') and
							// sbat.agent_id=&quot;+agtUserId+&quot; and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale_retailer)&quot;;
<span class="nc" id="L2001">							String queryForAgtRetVat = &quot;select (sale_retailer.vatAmt-purchvat.vatAmt) vatAmt from  (( select (purchSalevat.vat_amt-purchSaleretvat.vat_amt) vatAmt from ( select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;</span>
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT'  and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id)purchSalevat,(select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and            transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT' and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id)purchSaleretvat) purchvat, (select (saleVat.vat_amt-saleRetVat.vat_amt) vatAmt from (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_se_agent_retailer_transaction sbat where sbtm.transaction_date &gt;='&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;'and sbtm.transaction_type in ('SALE') and   sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleVat, (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_se_agent_retailer_transaction sbat where sbtm.transaction_date &gt;='&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.transaction_type in ('SALE_RET') and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleRetVat) sale_retailer)&quot;;
							// String
							// queryForPlayer=QueryManager.getST3LastMonthTransaction()
							// + &quot; where transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L2031">							logger</span>
									.debug(&quot;query---- for vat calculation ???????????  &quot;
											+ queryForAgtRetVat);
<span class="nc" id="L2034">							RSPLR = stmt2.executeQuery(queryForAgtRetVat);</span>
<span class="nc bnc" id="L2035" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L2037">								double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L2038">								logger</span>
										.debug(&quot;vat amount   from table&quot;
												+ vatAmt);
<span class="nc" id="L2041">								vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L2042">								logger.debug(&quot;calculated vat is    @@  &quot;</span>
										+ vatSum);

<span class="nc" id="L2045">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L2054" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L2055">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L2057">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L2059">							String yearfortask = &quot;&quot; + YR;</span>
<span class="nc" id="L2060">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L2062">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L2064">							Date taskDate = null;</span>
							try {
<span class="nc" id="L2066">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L2067">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L2069">								e.printStackTrace();</span>
<span class="nc" id="L2070">							}</span>
<span class="nc" id="L2071">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTaskAgt()
									+ &quot;values('&quot;
									+ vatSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','VAT','UNAPPROVED',CURRENT_DATE,&quot;
									+ userOrgId + &quot;,'SE')&quot;;
<span class="nc" id="L2079">							stmt3.executeUpdate(queryTaskCreate);</span>
						}
					}

<span class="nc bnc" id="L2083" title="All 2 branches missed.">					if (j != YR) {</span>
<span class="nc" id="L2084">						Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L2085">						SimpleDateFormat dtfmt = new SimpleDateFormat(</span>
								&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L2087">						Date dd = null;</span>
<span class="nc" id="L2088">						Date ddd = null;</span>
<span class="nc bnc" id="L2089" title="All 2 branches missed.">						for (int i = 1; i &lt;= 12; i++) {</span>
<span class="nc" id="L2090">							vatSum = 0;</span>
							String transaction_date_first;
							String transaction_date_last;
<span class="nc bnc" id="L2093" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L2094">								transaction_date_first = &quot;&quot; + j + &quot;-&quot; + &quot;0&quot; + i</span>
										+ &quot;-&quot; + &quot;01&quot;;
							} else {
<span class="nc" id="L2097">								transaction_date_first = &quot;&quot; + j + &quot;-&quot; + i + &quot;-&quot;</span>
										+ &quot;01&quot;;
							}

<span class="nc bnc" id="L2101" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L2102">								int day = 1;</span>
<span class="nc" id="L2103">								cal.set(j, i - 1, day);</span>
<span class="nc" id="L2104">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L2106">								cal.set(j, i - 1, totalday);</span>
								try {
<span class="nc" id="L2108">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L2110">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L2112">									e.printStackTrace();</span>
<span class="nc" id="L2113">								}</span>
<span class="nc" id="L2114">								cal.setTime(ddd);</span>
<span class="nc" id="L2115">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L2117">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L2118">								dd = cal.getTime();</span>

								// transaction_date_last=&quot;&quot; +j + &quot;-&quot; + &quot;0&quot;+i
								// +&quot;-&quot;+ &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;

<span class="nc" id="L2123">							} else {</span>
<span class="nc" id="L2124">								int day = 1;</span>
<span class="nc" id="L2125">								cal.set(j, i - 1, day);</span>
<span class="nc" id="L2126">								int totalday = cal</span>
										.getActualMaximum(Calendar.DAY_OF_MONTH);
<span class="nc" id="L2128">								cal.set(j, i - 1, totalday);</span>
								try {
<span class="nc" id="L2130">									ddd = dtfmt.parse(dtfmt.format(cal</span>
											.getTime()));
<span class="nc" id="L2132">								} catch (ParseException e) {</span>
									// TODO Auto-generated catch block
<span class="nc" id="L2134">									e.printStackTrace();</span>
<span class="nc" id="L2135">								}</span>
<span class="nc" id="L2136">								cal.setTime(ddd);</span>
<span class="nc" id="L2137">								long ms = cal.getTimeInMillis() + 1000 * 24</span>
										* 60 * 60;
<span class="nc" id="L2139">								cal.setTimeInMillis(ms);</span>
<span class="nc" id="L2140">								dd = cal.getTime();</span>
								// transaction_date_last=&quot;&quot; +j + &quot;-&quot;+i +&quot;-&quot;+
								// &quot;31&quot;+&quot;&quot;+&quot;23:&quot;+&quot;59:&quot;+&quot;59&quot;;
							}
<span class="nc" id="L2144">							logger.debug(&quot;result not  found in task table &quot;);</span>
							// String queryForAgtRetVat=&quot;select
							// (sale_retailer.vat_amt-purch.vat_amt) vatAmt from
							// ((select sum(sbat.vat_amt) vat_amt from
							// st_lms_bo_transaction_master
							// sbtm,st_se_bo_agent_transaction sbat where
							// sbtm.transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.party_type='AGENT' and
							// sbat.agent_org_id=&quot;+userOrgId+&quot; and
							// sbtm.transaction_type in ('SALE') and
							// sbat.transaction_id=sbtm.transaction_id)
							// purch,(select sum(sbat.vat_amt) vat_amt from
							// st_lms_agent_transaction_master
							// sbtm,st_se_agent_retailer_transaction sbat where
							// sbtm.transaction_date
							// &gt;='&quot;+transaction_date_first+&quot;' and
							// transaction_date &lt; '&quot;+new
							// java.sql.Timestamp(dd.getTime())+&quot;' and
							// sbtm.transaction_type in ('SALE') and
							// sbat.agent_id=&quot;+agtUserId+&quot; and
							// sbat.transaction_id=sbtm.transaction_id)
							// sale_retailer)&quot;;
<span class="nc" id="L2168">							String queryForAgtRetVat = &quot;select (sale_retailer.vatAmt-purchvat.vatAmt) vatAmt from  (( select (purchSalevat.vat_amt-purchSaleretvat.vat_amt) vatAmt from ( select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;</span>
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT'  and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbtm.transaction_type in ('SALE') and sbat.transaction_id=sbtm.transaction_id)purchSalevat,(select ifnull(sum(sbat.vat_amt),0) vat_amt from  st_lms_bo_transaction_master sbtm,st_se_bo_agent_transaction sbat where sbtm.transaction_date &gt;= '&quot;
									+ transaction_date_first
									+ &quot;' and            transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.party_type='AGENT' and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbtm.transaction_type in ('SALE_RET') and sbat.transaction_id=sbtm.transaction_id)purchSaleretvat) purchvat, (select (saleVat.vat_amt-saleRetVat.vat_amt) vatAmt from (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_se_agent_retailer_transaction sbat where sbtm.transaction_date &gt;='&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;'and sbtm.transaction_type in ('SALE') and   sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleVat, (select ifnull(sum(sbat.vat_amt),0) vat_amt from st_lms_agent_transaction_master sbtm,st_se_agent_retailer_transaction sbat where sbtm.transaction_date &gt;='&quot;
									+ transaction_date_first
									+ &quot;' and transaction_date &lt; '&quot;
									+ new java.sql.Timestamp(dd.getTime())
									+ &quot;' and sbtm.transaction_type in ('SALE_RET') and sbat.agent_org_id=&quot;
									+ userOrgId
									+ &quot; and sbat.transaction_id=sbtm.transaction_id)saleRetVat) sale_retailer)&quot;;
							// String
							// queryForPlayer=QueryManager.getST3LastMonthTransaction()
							// + &quot; where transaction_date &gt;=
							// '&quot;+transaction_date_first+&quot;' and transaction_date
							// &lt; '&quot;+new java.sql.Timestamp(dd.getTime())+&quot;' &quot;;
<span class="nc" id="L2198">							logger</span>
									.debug(&quot;query---- for vat calculation ???????????  &quot;
											+ queryForAgtRetVat);
<span class="nc" id="L2201">							RSPLR = stmt2.executeQuery(queryForAgtRetVat);</span>
<span class="nc bnc" id="L2202" title="All 2 branches missed.">							while (RSPLR.next()) {</span>

<span class="nc" id="L2204">								double vatAmt = RSPLR.getDouble(&quot;vatAmt&quot;);</span>
<span class="nc" id="L2205">								logger</span>
										.debug(&quot;vat amount   from table&quot;
												+ vatAmt);
<span class="nc" id="L2208">								vatSum = CommonMethods.fmtToTwoDecimal(vatAmt);</span>
<span class="nc" id="L2209">								logger.debug(&quot;calculated vat is    @@  &quot;</span>
										+ vatSum);

<span class="nc" id="L2212">							}</span>

							/*
							 * try{
							 * taxSum=Double.parseDouble(nf.format(taxSum)); }
							 * catch(NumberFormatException e) {}
							 */

							String monthfortask;
<span class="nc bnc" id="L2221" title="All 2 branches missed.">							if (i &lt; 10) {</span>
<span class="nc" id="L2222">								monthfortask = &quot;-&quot; + &quot;0&quot; + i;</span>
							} else {
<span class="nc" id="L2224">								monthfortask = &quot;-&quot; + i;</span>
							}
<span class="nc" id="L2226">							String yearfortask = &quot;&quot; + j;</span>
<span class="nc" id="L2227">							String taskDate1 = yearfortask.concat(monthfortask)</span>
									.concat(&quot;-01&quot;);
<span class="nc" id="L2229">							SimpleDateFormat d = new SimpleDateFormat(</span>
									&quot;yyyy-MM-dd&quot;);
<span class="nc" id="L2231">							Date taskDate = null;</span>
							try {
<span class="nc" id="L2233">								taskDate = d.parse(taskDate1);</span>
<span class="nc" id="L2234">							} catch (ParseException e) {</span>
								// TODO Auto-generated catch block
<span class="nc" id="L2236">								e.printStackTrace();</span>
<span class="nc" id="L2237">							}</span>

<span class="nc" id="L2239">							String queryTaskCreate = QueryManager</span>
									.getST3CreateTaskAgt()
									+ &quot;values('&quot;
									+ vatSum
									+ &quot;','&quot;
									+ new java.sql.Date(taskDate.getTime())
									+ &quot;','VAT','UNAPPROVED',CURRENT_DATE,&quot;
									+ userOrgId + &quot;,'SE')&quot;;
<span class="nc" id="L2247">							stmt3.executeUpdate(queryTaskCreate);</span>

						}
					}

				}
			}

<span class="nc" id="L2255">			TaskBean taskBean = null;</span>

<span class="nc" id="L2257">			List&lt;TaskBean&gt; searchResults = new ArrayList&lt;TaskBean&gt;();</span>
<span class="nc" id="L2258">			logger.debug(&quot;333333333333333333hhhhhhhhhhh&quot;);</span>
<span class="nc" id="L2259">			ResultSet rs3 = stmt4.executeQuery(QueryManager</span>
					.getUnapprovedVATAgtSE()
					+ userOrgId);

<span class="nc bnc" id="L2263" title="All 2 branches missed.">			while (rs3.next()) {</span>
<span class="nc" id="L2264">				taskBean = new TaskBean();</span>
<span class="nc" id="L2265">				taskBean.setAmount(rs3.getDouble(&quot;amount&quot;));</span>

				// SimpleDateFormat date1 = new
				// SimpleDateFormat(&quot;dd-MM-yyyy&quot;);//it would be the format set
				// by Vineet
				// taskBean.setMonth(date1.format(rs3.getDate(&quot;month&quot;)));
				// logger.debug(&quot;heeeeeeeeeeeeellllllll
				// &quot;+date1.format(rs3.getDate(&quot;month&quot;)) );
<span class="nc" id="L2273">				taskBean.setMonth(rs3.getString(TableConstants.MONTH_TASK));</span>
<span class="nc" id="L2274">				taskBean.setTransactionType(rs3</span>
						.getString(TableConstants.TASK_TYPE));
<span class="nc" id="L2276">				taskBean.setStatus(rs3.getString(TableConstants.TASK_STATUS));</span>
<span class="nc" id="L2277">				taskBean.setTaskId(rs3.getInt(TableConstants.TASK_ID));</span>
<span class="nc" id="L2278">				taskBean.setServiceCode(&quot;SE&quot;);</span>
<span class="nc" id="L2279">				taskBean.setServiceName(serviceName);</span>
<span class="nc" id="L2280">				logger.debug(&quot;taskid is   &quot; + rs3.getInt(&quot;task_id&quot;));</span>
				// userBean.setRegisterDate(resultSet.getDate(TableConstants.Register_DATE));
<span class="nc" id="L2282">				searchResults.add(taskBean);</span>
			}

<span class="nc" id="L2285">			con.commit();</span>
<span class="nc" id="L2286">			con.close(); // added by yogesh at the time of self review</span>
<span class="nc" id="L2287">			return searchResults;</span>

<span class="nc" id="L2289">		} catch (SQLException e) {</span>

			try {
<span class="nc" id="L2292">				con.rollback();</span>
<span class="nc" id="L2293">			} catch (SQLException se) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L2295">				se.printStackTrace();</span>
<span class="nc" id="L2296">				throw new LMSException(&quot;Error During Rollback&quot;, se);</span>
<span class="nc" id="L2297">			}</span>
<span class="nc" id="L2298">			e.printStackTrace();</span>
<span class="nc" id="L2299">			throw new LMSException(e);</span>

		}
		// return null;

	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>