<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TDSSubmitHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.coreEngine.accMgmt.common</a> &gt; <span class="el_source">TDSSubmitHelper.java</span></div><h1>TDSSubmitHelper.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.coreEngine.accMgmt.common;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.beans.OpenGameBean;
import com.skilrock.lms.beans.PrizeStatusBean;
import com.skilrock.lms.beans.TaskBean;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.common.db.TableConstants;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.utility.GameUtilityHelper;
import com.skilrock.lms.common.utility.GenerateRecieptNo;
import com.skilrock.lms.coreEngine.reportsMgmt.common.GraphReportHelper;
import com.skilrock.lms.web.drawGames.common.Util;

/**
 * This helper class provides methods to submit Unclaim Pwt,Govt comm and
 * methods to get game details
 * 
 * @author ABC
 * 
 */
<span class="nc" id="L36">public class TDSSubmitHelper {</span>
<span class="nc" id="L37">	static Log logger = LogFactory.getLog(TDSSubmitHelper.class);</span>

	/**
	 * This method is used to get the list of TDS Approved
	 * 
	 * @return List of TDS Approved
	 * @throws LMSException
	 */
<span class="nc" id="L45">	int receiptId = 0;</span>

	/**
	 * This method is used to get the list of remaining prizes
	 * 
	 * @param gameId
	 *            is game's Id
	 * @return List of remaining prizes
	 * @throws LMSException
	 */
	public List&lt;PrizeStatusBean&gt; fetchRemainingPrizeList(int gameId)
			throws LMSException {

<span class="nc" id="L58">		return new GameUtilityHelper().fetchRemainingPrizeList(gameId);</span>

		/*
		 * Connection connection = null;
		 * 
		 * PreparedStatement pstmt = null; PreparedStatement prizePstmt = null;
		 * 
		 * ResultSet resultSet = null; ResultSet prizeRSet = null;
		 * 
		 * 
		 * List&lt;PrizeStatusBean&gt; prizeStatusList = new ArrayList&lt;PrizeStatusBean&gt;();
		 * 
		 * 
		 * double pwtAmt = 0.0; int nbrOfPrizeLeft = 0;
		 * 
		 * 
		 * try {
		 * 
		 * PrizeStatusBean bean = null;  
		 * connection = DBConnect.getConnection();
		 * 
		 * String prizeQuery = QueryManager.getST1DistinctPrizeQuery();
		 * prizePstmt = connection.prepareStatement(prizeQuery);
		 * prizePstmt.setInt(1,gameId);
		 * 
		 * prizeRSet = prizePstmt.executeQuery();
		 * 
		 * while(prizeRSet.next()){
		 * 
		 * bean = new PrizeStatusBean();
		 * bean.setPrizeAmt(prizeRSet.getDouble(TableConstants.SPI_PWT_AMT));
		 * //bean.setNbrOfPrizeLeft(0);
		 * 
		 * prizeStatusList.add(bean); }
		 * 
		 * 
		 * String query = QueryManager.getST1PrizeListQuery(); pstmt =
		 * connection.prepareStatement(query); pstmt.setInt(1, gameId);
		 * 
		 * resultSet = pstmt.executeQuery();
		 * 
		 * 
		 * while(resultSet.next()){ //isPrizeRemaining = true;
		 * 
		 * pwtAmt = resultSet.getDouble(TableConstants.SPI_PWT_AMT);
		 * nbrOfPrizeLeft = resultSet.getInt(TableConstants.PRIZES_REMAINING);
		 * 
		 * for(int i=0; i&lt; prizeStatusList.size(); i++){ bean =
		 * prizeStatusList.get(i); if (pwtAmt == bean.getPrizeAmt()){
		 * bean.setNbrOfPrizeLeft(nbrOfPrizeLeft); break; } } }
		 * 
		 * 
		 * 
		 * 
		 * return prizeStatusList; } catch (SQLException e) {
		 * 
		 * e.printStackTrace(); throw new LMSException(e); }finally {
		 * 
		 * try {
		 * 
		 * if (pstmt != null) { pstmt.close(); } if (connection != null) {
		 * connection.close(); } } catch (SQLException se) {
		 * se.printStackTrace(); } }
		 * 
		 * 
		 * //return null;
		 * 
		 */
	}

	public List&lt;PrizeStatusBean&gt; fetchRemainingPrizeListUnclm(int gameId)
			throws LMSException {
<span class="nc" id="L130">		return new GameUtilityHelper().fetchRemainingPrizeList(gameId);</span>

		/*
		 * Connection connection = null;
		 * 
		 * PreparedStatement pstmt = null; PreparedStatement prizePstmt = null;
		 * 
		 * ResultSet resultSet = null; ResultSet prizeRSet = null;
		 * 
		 * 
		 * List&lt;PrizeStatusBean&gt; prizeStatusList = new ArrayList&lt;PrizeStatusBean&gt;();
		 * 
		 * 
		 * double pwtAmt = 0.0; int nbrOfPrizeLeft = 0;
		 * 
		 * 
		 * try {
		 * 
		 * PrizeStatusBean bean = null;  
		 * connection = DBConnect.getConnection();
		 * 
		 * String prizeQuery = QueryManager.getST1DistinctPrizeQuery();
		 * prizePstmt = connection.prepareStatement(prizeQuery);
		 * prizePstmt.setInt(1,gameId);
		 * 
		 * prizeRSet = prizePstmt.executeQuery();
		 * 
		 * while(prizeRSet.next()){
		 * 
		 * bean = new PrizeStatusBean();
		 * bean.setPrizeAmt(prizeRSet.getDouble(TableConstants.SPI_PWT_AMT));
		 * //bean.setNbrOfPrizeLeft(0);
		 * 
		 * prizeStatusList.add(bean); }
		 * 
		 * 
		 * String query = QueryManager.getST3PrizeListQuery(); pstmt =
		 * connection.prepareStatement(query); pstmt.setInt(1, gameId);
		 * 
		 * resultSet = pstmt.executeQuery();
		 * 
		 * 
		 * while(resultSet.next()){ //isPrizeRemaining = true;
		 * 
		 * pwtAmt = resultSet.getDouble(TableConstants.SPI_PWT_AMT);
		 * nbrOfPrizeLeft = resultSet.getInt(TableConstants.PRIZES_REMAINING);
		 * 
		 * for(int i=0; i&lt; prizeStatusList.size(); i++){ bean =
		 * prizeStatusList.get(i); if (pwtAmt == bean.getPrizeAmt()){
		 * bean.setNbrOfPrizeLeft(nbrOfPrizeLeft); break; } } }
		 * 
		 * 
		 * 
		 * 
		 * return prizeStatusList; } catch (SQLException e) {
		 * 
		 * e.printStackTrace(); throw new LMSException(e); }finally {
		 * 
		 * try {
		 * 
		 * if (pstmt != null) { pstmt.close(); } if (connection != null) {
		 * connection.close(); } } catch (SQLException se) {
		 * se.printStackTrace(); } }
		 * 
		 * 
		 * //return null;
		 * 
		 */
	}

	// this method is commented to remove code duplicity at the time of self
	// review
	/*
	 * public void submitGovtComm(int id,String transType,int gameid,double
	 * Amount) throws LMSException{ int taskId=id; String
	 * transactionType=transType; int gameId=gameid; double amount=Amount; int
	 * transId=0;   Connection con= null;
	 * try {
	 * 
	 * con=dbConnect.getConnection(); con.setAutoCommit(false); Statement
	 * stmt5=con.createStatement(); Statement stmt6=con.createStatement();
	 * Statement stmt7=con.createStatement();
	 * 
	 * logger.debug(&quot;task id is &quot; + taskId); String queryForGovtCommtSubmit =
	 * QueryManager.submitST3UnclmPwtApproved()+ &quot;where task_id='&quot;+taskId+&quot;' &quot;;
	 * stmt5.executeUpdate(queryForGovtCommtSubmit); String
	 * insertTransMaster=QueryManager.insertST3TransactionMaster() + &quot;
	 * values('GOVT',CURRENT_TIMESTAMP,'&quot;+transactionType+&quot;') &quot; ;
	 * stmt6.executeUpdate(insertTransMaster); ResultSet
	 * rs=stmt6.getGeneratedKeys(); while(rs.next()) { transId=rs.getInt(1);
	 * logger.debug(&quot;trans id is &quot;+transId); }
	 * 
	 * 
	 * String insertGovtTrans=QueryManager.insertST3GovtTransaction() + &quot;
	 * values(&quot;+transId+&quot;,&quot;+amount+&quot;,&quot;+gameId+&quot;,'&quot;+transactionType+&quot;') &quot; ;
	 * stmt7.executeUpdate(insertGovtTrans); logger.debug( &quot;okkkkkkkkk...&quot;);
	 * logger.debug(&quot;gameid is &quot; + gameId ); con.commit(); } catch (SQLException
	 * e) {
	 * 
	 * 
	 * try { con.rollback(); } catch (SQLException se) { // TODO Auto-generated
	 * catch block se.printStackTrace(); throw new LMSException(&quot;Error During
	 * Rollback&quot;,se); } e.printStackTrace(); throw new LMSException(e); } }
	 * 
	 */
	/**
	 * This method is used to get the game details for a given game Id
	 * 
	 * @param gameid
	 *            is game's Id
	 * @return List of game details
	 * @throws LMSException
	 */
	public List getGameDetails(int gameid, String serviceCode)
			throws LMSException {

<span class="nc" id="L246">		int gameId = gameid;</span>

		 
<span class="nc" id="L249">		Connection con = null;</span>
<span class="nc" id="L250">		OpenGameBean gameBean = null;</span>
<span class="nc" id="L251">		List&lt;OpenGameBean&gt; gameDetailsResults = new ArrayList&lt;OpenGameBean&gt;();</span>
		try {

<span class="nc" id="L254">			con = DBConnect.getConnection();</span>
<span class="nc" id="L255">			Statement stmt = con.createStatement();</span>
<span class="nc" id="L256">			logger.debug(&quot;Game id is  &quot; + gameId);</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">			if (serviceCode.equalsIgnoreCase(&quot;SE&quot;)) {</span>
<span class="nc" id="L258">				String gameDetails = QueryManager.getST3GamesDetails()</span>
						+ &quot; where game_id= &quot; + gameId + &quot; &quot;;
<span class="nc" id="L260">				ResultSet rs = stmt.executeQuery(gameDetails);</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L262">					gameBean = new OpenGameBean();</span>
<span class="nc" id="L263">					logger.debug(rs.getString(&quot;game_name&quot;));</span>
<span class="nc" id="L264">					logger.debug(rs.getString(TableConstants.GAME_NAME));</span>

<span class="nc" id="L266">					gameBean</span>
							.setGameName(rs.getString(TableConstants.GAME_NAME));
<span class="nc" id="L268">					gameBean.setGameNbr(rs.getInt(TableConstants.GAME_NBR));</span>
<span class="nc" id="L269">					gameBean.setGameStartDate(rs</span>
							.getString(TableConstants.START_DATE));
<span class="nc" id="L271">					gameBean.setGameStatus(rs</span>
							.getString(TableConstants.GAME_STATUS));
<span class="nc" id="L273">					gameBean.setSaleEndDate(rs</span>
							.getString(TableConstants.SALE_END_DATE));
<span class="nc" id="L275">					gameBean.setTicketPrice(rs</span>
							.getDouble(TableConstants.TICKET_PRICE));
<span class="nc" id="L277">					gameBean.setPwt_end_date(rs</span>
							.getString(TableConstants.PWT_END_DATE));
<span class="nc" id="L279">					gameDetailsResults.add(gameBean);</span>
				}

<span class="nc" id="L282">				con.close();</span>
<span class="nc" id="L283">				return gameDetailsResults;</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">			} else if (serviceCode.equalsIgnoreCase(&quot;DG&quot;)) {</span>
<span class="nc" id="L285">				String gameDetails = &quot;select * from st_dg_game_master where game_id= &quot;</span>
						+ gameId + &quot; &quot;;
<span class="nc" id="L287">				ResultSet rs = stmt.executeQuery(gameDetails);</span>
<span class="nc bnc" id="L288" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L289">					gameBean = new OpenGameBean();</span>
<span class="nc" id="L290">					gameBean.setGameName(rs.getString(&quot;game_name&quot;));</span>
<span class="nc" id="L291">					gameBean.setGameNbr(rs.getInt(&quot;game_nbr&quot;));</span>
<span class="nc" id="L292">					gameBean.setGameStatus(rs.getString(&quot;game_status&quot;));</span>
<span class="nc" id="L293">					gameDetailsResults.add(gameBean);</span>
				}

<span class="nc" id="L296">				con.close();</span>
<span class="nc" id="L297">				return gameDetailsResults;</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">			} else if (serviceCode.equalsIgnoreCase(&quot;SLE&quot;)) {</span>
<span class="nc" id="L299">				String gameDetails = &quot;SELECT * FROM st_sle_game_type_master WHERE game_type_id=&quot;+gameId+&quot;;&quot;;</span>
<span class="nc" id="L300">				ResultSet rs = stmt.executeQuery(gameDetails);</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L302">					gameBean = new OpenGameBean();</span>
<span class="nc" id="L303">					gameBean.setGameName(rs.getString(&quot;type_disp_name&quot;));</span>
<span class="nc" id="L304">					gameBean.setGameNbr(rs.getInt(&quot;game_type_id&quot;));</span>
<span class="nc" id="L305">					gameBean.setGameStatus(rs.getString(&quot;type_status&quot;));</span>
<span class="nc" id="L306">					gameDetailsResults.add(gameBean);</span>
				}
<span class="nc" id="L308">				con.close();</span>
<span class="nc" id="L309">				return gameDetailsResults;</span>
			}

<span class="nc" id="L312">		} catch (SQLException e) {</span>
<span class="nc" id="L313">			e.printStackTrace();</span>
<span class="nc" id="L314">			throw new LMSException(e);</span>
<span class="nc" id="L315">		}</span>
		// return null;
<span class="nc" id="L317">		return gameDetailsResults;</span>
	}

	private int insertRcptMapping(Connection con, long transId, int id)
			throws SQLException {

		// START INSERTION OF RECEIPT ID FOR GOVERNMENT RECEIPTS

<span class="nc" id="L325">		String insBoRcpt = QueryManager.insertInBOReceipts();</span>
<span class="nc" id="L326">		String insRcpTrMap = QueryManager.insertBOReceiptTrnMapping();</span>

<span class="nc" id="L328">		PreparedStatement preBoRcpt = null;</span>
<span class="nc" id="L329">		PreparedStatement preRcpTrMap = null;</span>
		// PreparedStatement preRcpGenMap = null;

<span class="nc" id="L332">		PreparedStatement autoGenPstmt = null;</span>
		// String getLatestRecieptNumber=&quot;SELECT * from
		// st_bo_receipt_gen_mapping where receipt_type=? ORDER BY generated_id
		// DESC LIMIT 1 &quot;;
<span class="nc" id="L336">		autoGenPstmt = con</span>
				.prepareStatement(QueryManager.getBOLatestReceiptNb());
<span class="nc" id="L338">		autoGenPstmt.setString(1, &quot;GOVT_RCPT&quot;);</span>
<span class="nc" id="L339">		ResultSet recieptRs = autoGenPstmt.executeQuery();</span>
<span class="nc" id="L340">		String lastRecieptNoGenerated = null;</span>

<span class="nc bnc" id="L342" title="All 2 branches missed.">		while (recieptRs.next()) {</span>
<span class="nc" id="L343">			lastRecieptNoGenerated = recieptRs.getString(&quot;generated_id&quot;);</span>
		}

<span class="nc" id="L346">		String autoGeneRecieptNo = GenerateRecieptNo.getRecieptNo(&quot;GOVT_RCPT&quot;,</span>
				lastRecieptNoGenerated, &quot;BO&quot;);

		// insert receipt master

<span class="nc" id="L351">		preBoRcpt = con.prepareStatement(QueryManager.insertInReceiptMaster());</span>
<span class="nc" id="L352">		preBoRcpt.setString(1, &quot;BO&quot;);</span>
<span class="nc" id="L353">		preBoRcpt.executeUpdate();</span>

<span class="nc" id="L355">		ResultSet rss = preBoRcpt.getGeneratedKeys();</span>
<span class="nc" id="L356">		rss.next();</span>
<span class="nc" id="L357">		id = rss.getInt(1);</span>

		// insert into bo receipts

<span class="nc" id="L361">		preBoRcpt = con.prepareStatement(insBoRcpt);</span>
<span class="nc" id="L362">		preBoRcpt.setInt(1, id);</span>
<span class="nc" id="L363">		preBoRcpt.setString(2, &quot;GOVT_RCPT&quot;);</span>
<span class="nc" id="L364">		preBoRcpt.setObject(3, null);</span>
<span class="nc" id="L365">		preBoRcpt.setString(4, &quot;GOVT&quot;);</span>
<span class="nc" id="L366">		preBoRcpt.setString(5, autoGeneRecieptNo);</span>
<span class="nc" id="L367">		preBoRcpt.setTimestamp(6, Util.getCurrentTimeStamp());</span>
		/*
		 * //prepare4.setString(1, autoGeneRecieptNo); preBoRcpt.setString(1,
		 * &quot;GOVT_RCPT&quot;); preBoRcpt.setString(2, null);
		 */

<span class="nc" id="L373">		preBoRcpt.executeUpdate();</span>

<span class="nc" id="L375">		preRcpTrMap = con.prepareStatement(insRcpTrMap);</span>
<span class="nc" id="L376">		preRcpTrMap.setInt(1, id);</span>
<span class="nc" id="L377">		preRcpTrMap.setLong(2, transId);</span>
<span class="nc" id="L378">		preRcpTrMap.executeUpdate();</span>

		/*
		 * //insert into recipt gen reciept mapping String
		 * updateBoRecieptGenMapping=QueryManager.updateST5BOReceiptGenMapping();
		 * preRcpGenMap=con.prepareStatement(updateBoRecieptGenMapping);
		 * preRcpGenMap.setInt(1,id);
		 * preRcpGenMap.setString(2,autoGeneRecieptNo);
		 * preRcpGenMap.setString(3,&quot;GOVT_RCPT&quot;); preRcpGenMap.executeUpdate();
		 */

		// END INSERTION OF RECEIPT ID FOR GOVERNMENT RECEIPTS
<span class="nc" id="L390">		return id;</span>
	}

	private int insertRcptMappingAgt(Connection con, long  transId, int id,
			int agtOrgId) throws SQLException {

		// START INSERTION OF RECEIPT ID FOR GOVERNMENT RECEIPTS For AGENTS

		// String insAgtRcpt = QueryManager.getST4InsertAgentReceipts();
		// String insRcpTrMap =
		// QueryManager.getST4InsertAgentReceiptsTrnMapping();

<span class="nc" id="L402">		PreparedStatement preAgtRcpt = null;</span>
<span class="nc" id="L403">		PreparedStatement preRcpTrMap = null;</span>
		// PreparedStatement preRcpGenMap = null;

<span class="nc" id="L406">		PreparedStatement autoGenPstmt = null;</span>
		// String getLatestRecieptNumber=&quot;SELECT * from
		// st_lms_agent_receipts_gen_mapping where receipt_type=? ORDER BY
		// generated_id DESC LIMIT 1 &quot;;
<span class="nc" id="L410">		autoGenPstmt = con.prepareStatement(QueryManager</span>
				.getAGENTLatestReceiptNb());
<span class="nc" id="L412">		autoGenPstmt.setString(1, &quot;GOVT_RCPT&quot;);</span>
<span class="nc" id="L413">		autoGenPstmt.setInt(2, agtOrgId);</span>
<span class="nc" id="L414">		ResultSet recieptRs = autoGenPstmt.executeQuery();</span>
<span class="nc" id="L415">		String lastRecieptNoGenerated = null;</span>

<span class="nc bnc" id="L417" title="All 2 branches missed.">		while (recieptRs.next()) {</span>
<span class="nc" id="L418">			lastRecieptNoGenerated = recieptRs.getString(&quot;generated_id&quot;);</span>
		}

<span class="nc" id="L421">		String autoGeneRecieptNo = GenerateRecieptNo.getRecieptNoAgt(</span>
				&quot;GOVT_RCPT&quot;, lastRecieptNoGenerated, &quot;AGENT&quot;, agtOrgId);

		// insert in receipt master
<span class="nc" id="L425">		preAgtRcpt = con.prepareStatement(QueryManager.insertInReceiptMaster());</span>
<span class="nc" id="L426">		preAgtRcpt.setString(1, &quot;AGENT&quot;);</span>
<span class="nc" id="L427">		preAgtRcpt.executeUpdate();</span>

<span class="nc" id="L429">		ResultSet rss = preAgtRcpt.getGeneratedKeys();</span>
<span class="nc" id="L430">		rss.next();</span>
<span class="nc" id="L431">		id = rss.getInt(1);</span>

		// insert in agent receipts
<span class="nc" id="L434">		preAgtRcpt = con.prepareStatement(QueryManager.insertInAgentReceipts());</span>

<span class="nc" id="L436">		preAgtRcpt.setInt(1, id);</span>
<span class="nc" id="L437">		preAgtRcpt.setString(2, &quot;GOVT_RCPT&quot;);</span>
<span class="nc" id="L438">		preAgtRcpt.setInt(3, agtOrgId);</span>
<span class="nc" id="L439">		preAgtRcpt.setObject(4, null);</span>
<span class="nc" id="L440">		preAgtRcpt.setString(5, &quot;GOVT&quot;);</span>
<span class="nc" id="L441">		preAgtRcpt.setString(6, autoGeneRecieptNo);</span>
<span class="nc" id="L442">		preAgtRcpt.setTimestamp(7, Util.getCurrentTimeStamp());</span>

		/*
		 * //prepare4.setString(1, autoGeneRecieptNo); preAgtRcpt.setString(1,
		 * &quot;GOVT_RCPT&quot;); preAgtRcpt.setInt(2, agtOrgId); preAgtRcpt.setString(3,
		 * null);
		 */

<span class="nc" id="L450">		preAgtRcpt.executeUpdate();</span>

		// insert in agent trn mapping

<span class="nc" id="L454">		preRcpTrMap = con.prepareStatement(QueryManager</span>
				.insertAgentReceiptTrnMapping());
<span class="nc" id="L456">		preRcpTrMap.setInt(1, id);</span>
<span class="nc" id="L457">		preRcpTrMap.setLong(2, transId);</span>
<span class="nc" id="L458">		preRcpTrMap.executeUpdate();</span>

		/*
		 * //insert into recipt gen reciept mapping String
		 * updateBoRecieptGenMapping=QueryManager.updateST5AGENTReceiptGenMappimg();
		 * preRcpGenMap=con.prepareStatement(updateBoRecieptGenMapping);
		 * preRcpGenMap.setInt(1,id);
		 * preRcpGenMap.setString(2,autoGeneRecieptNo);
		 * preRcpGenMap.setString(3,&quot;GOVT_RCPT&quot;);
		 * preRcpGenMap.setInt(4,agtOrgId); preRcpGenMap.executeUpdate();
		 */

		// END INSERTION OF RECEIPT ID FOR GOVERNMENT RECEIPTS For AGENTS
<span class="nc" id="L471">		return id;</span>
	}

	public void submitTdsDG(Integer id, String transType, String Month,
			Double Amount, Integer userOrgId, Integer userId, String rootPath,
			String userOrgName) throws LMSException {
<span class="nc" id="L477">		int taskId = id;</span>
<span class="nc" id="L478">		String transactionType = transType;</span>
<span class="nc" id="L479">		String monthTds = Month;</span>
<span class="nc" id="L480">		SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L481">		Date month = null;</span>

		try {
<span class="nc" id="L484">			month = d.parse(monthTds);</span>
<span class="nc" id="L485">		} catch (ParseException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L487">			e.printStackTrace();</span>
<span class="nc" id="L488">		}</span>
<span class="nc" id="L489">		double amount = Amount;</span>
		//int transId = 0;
<span class="nc" id="L491">		long transId=0;</span>
<span class="nc" id="L492">		logger.debug(&quot;month is   &quot; + month);</span>
		 
<span class="nc" id="L494">		Connection con = null;</span>
		try {

<span class="nc" id="L497">			con = DBConnect.getConnection();</span>
<span class="nc" id="L498">			con.setAutoCommit(false);</span>
<span class="nc" id="L499">			Statement stmt4 = con.createStatement();</span>
<span class="nc" id="L500">			Statement stmt11 = con.createStatement();</span>

<span class="nc" id="L502">			logger.debug(&quot;task id is  &quot; + taskId);</span>

			// set the status as done in st_bo_task table
<span class="nc" id="L505">			String queryForTdstSubmit = QueryManager</span>
					.submitST3UnclmPwtApproved()
					+ &quot;where task_id='&quot; + taskId + &quot;' &quot;;
<span class="nc" id="L508">			stmt4.executeUpdate(queryForTdstSubmit);</span>

			// insert in LMS Transaction Master
			/*String insertLMSTrans = QueryManager.insertInLMSTransactionMaster();
			PreparedStatement LMSMasPstmt = con
					.prepareStatement(insertLMSTrans);
			LMSMasPstmt.setString(1, &quot;BO&quot;);
			LMSMasPstmt.executeUpdate();*/
<span class="nc" id="L516">			PreparedStatement LMSMasPstmt = con.prepareStatement(&quot;insert into st_lms_transaction_master (user_type, service_code, interface) values('BO','DG','WEB')&quot;);</span>
<span class="nc" id="L517">			LMSMasPstmt.executeUpdate();</span>
<span class="nc" id="L518">			ResultSet rs = LMSMasPstmt.getGeneratedKeys();</span>
<span class="nc bnc" id="L519" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L520">				transId = rs.getLong(1);</span>
<span class="nc" id="L521">				logger.debug(&quot;trans id is &quot; + transId);</span>

			}

			// String
			// insertTransMaster=QueryManager.insertST3TransactionMaster() + &quot;
			// values('GOVT','&quot;+new java.sql.Timestamp( new
			// Date().getTime())+&quot;','&quot;+transactionType+&quot;') &quot; ;
<span class="nc" id="L529">			String insertTransMaster = QueryManager</span>
					.insertInBOTransactionMaster();
<span class="nc" id="L531">			PreparedStatement BOMasPstmt = con</span>
					.prepareStatement(insertTransMaster);
<span class="nc" id="L533">			BOMasPstmt.setLong(1, transId);</span>
<span class="nc" id="L534">			BOMasPstmt.setInt(2, userId);</span>
<span class="nc" id="L535">			BOMasPstmt.setInt(3, userOrgId);</span>
<span class="nc" id="L536">			BOMasPstmt.setString(4, &quot;GOVT&quot;);</span>
<span class="nc" id="L537">			BOMasPstmt.setObject(5, null);</span>
<span class="nc" id="L538">			BOMasPstmt.setTimestamp(6, new java.sql.Timestamp(new Date()</span>
					.getTime()));
<span class="nc" id="L540">			BOMasPstmt.setString(7, transactionType);</span>

<span class="nc" id="L542">			BOMasPstmt.executeUpdate();</span>

			// done by arun
			// String
			// insertGovtTrans=QueryManager.insertST3GovtTransactionForTDS() + &quot;
			// values(&quot;+transId+&quot;,&quot;+amount+&quot;,'&quot;+new
			// java.sql.Date(month.getTime())+&quot;','&quot;+transactionType+&quot;') &quot; ;
<span class="nc" id="L549">			String insertGovtTrans = QueryManager</span>
					.insertST3GovtTransactionForTDS()
					+ &quot;   select &quot;
					+ transId
					+ &quot;, 'DG', amount, month, transaction_type, start_date, end_date from st_lms_bo_tasks where task_id=&quot;
					+ taskId;
<span class="nc" id="L555">			stmt11.executeUpdate(insertGovtTrans);</span>
<span class="nc" id="L556">			logger.debug(&quot;executed query is &quot; + insertGovtTrans);</span>
			// logger.debug(&quot;month is &quot; + month );

<span class="nc" id="L559">			receiptId = insertRcptMapping(con, transId, id);</span>

<span class="nc" id="L561">			con.commit();</span>

<span class="nc" id="L563">			GraphReportHelper reportHelper = new GraphReportHelper();</span>
<span class="nc" id="L564">			reportHelper.createTextReportBO(receiptId, userOrgName, userOrgId,</span>
					rootPath);

<span class="nc" id="L567">		} catch (SQLException e) {</span>

			try {
<span class="nc bnc" id="L570" title="All 2 branches missed.">				if (con != null) {</span>
<span class="nc" id="L571">					con.rollback();</span>
				}
<span class="nc" id="L573">			} catch (SQLException se) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L575">				se.printStackTrace();</span>
<span class="nc" id="L576">				throw new LMSException(&quot;Error During Rollback&quot;, se);</span>

<span class="nc" id="L578">			}</span>
<span class="nc" id="L579">			e.printStackTrace();</span>
<span class="nc" id="L580">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L582">			try {</span>
<span class="nc bnc" id="L583" title="All 4 branches missed.">				if (con != null) {</span>
<span class="nc" id="L584">					con.close();</span>
				}
<span class="nc" id="L586">			} catch (SQLException see) {</span>
<span class="nc" id="L587">				see.printStackTrace();</span>
<span class="nc" id="L588">				throw new LMSException(&quot;Error During closing connection&quot;, see);</span>
<span class="nc" id="L589">			}</span>
		}

<span class="nc" id="L592">	}</span>

	public void submitTdsSE(Integer id, String transType, String Month,
			Double Amount, Integer userOrgId, Integer userId, String rootPath,
			String userOrgName) throws LMSException {
<span class="nc" id="L597">		int taskId = id;</span>
<span class="nc" id="L598">		String transactionType = transType;</span>
<span class="nc" id="L599">		String monthTds = Month;</span>
<span class="nc" id="L600">		SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L601">		Date month = null;</span>

		try {
<span class="nc" id="L604">			month = d.parse(monthTds);</span>
<span class="nc" id="L605">		} catch (ParseException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L607">			e.printStackTrace();</span>
<span class="nc" id="L608">		}</span>
<span class="nc" id="L609">		double amount = Amount;</span>
<span class="nc" id="L610">		int transId = 0;</span>
<span class="nc" id="L611">		logger.debug(&quot;month is   &quot; + month);</span>
		 
<span class="nc" id="L613">		Connection con = null;</span>
		try {

<span class="nc" id="L616">			con = DBConnect.getConnection();</span>
<span class="nc" id="L617">			con.setAutoCommit(false);</span>
<span class="nc" id="L618">			Statement stmt4 = con.createStatement();</span>
<span class="nc" id="L619">			Statement stmt11 = con.createStatement();</span>

<span class="nc" id="L621">			logger.debug(&quot;task id is  &quot; + taskId);</span>

			// set the status as done in st_bo_task table
<span class="nc" id="L624">			String queryForTdstSubmit = QueryManager</span>
					.submitST3UnclmPwtApproved()
					+ &quot;where task_id='&quot; + taskId + &quot;' &quot;;
<span class="nc" id="L627">			stmt4.executeUpdate(queryForTdstSubmit);</span>

			// insert in LMS Transaction Master
			/*String insertLMSTrans = QueryManager.insertInLMSTransactionMaster();
			PreparedStatement LMSMasPstmt = con
					.prepareStatement(insertLMSTrans);
			LMSMasPstmt.setString(1, &quot;BO&quot;);
			LMSMasPstmt.executeUpdate();*/
<span class="nc" id="L635">			PreparedStatement LMSMasPstmt = con.prepareStatement(&quot;insert into st_lms_transaction_master (user_type, service_code, interface) values('BO','SE','WEB')&quot;);</span>
<span class="nc" id="L636">			LMSMasPstmt.executeUpdate();</span>
<span class="nc" id="L637">			ResultSet rs = LMSMasPstmt.getGeneratedKeys();</span>
<span class="nc bnc" id="L638" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L639">				transId = rs.getInt(1);</span>
<span class="nc" id="L640">				logger.debug(&quot;trans id is &quot; + transId);</span>

			}

			// String
			// insertTransMaster=QueryManager.insertST3TransactionMaster() + &quot;
			// values('GOVT','&quot;+new java.sql.Timestamp( new
			// Date().getTime())+&quot;','&quot;+transactionType+&quot;') &quot; ;
<span class="nc" id="L648">			String insertTransMaster = QueryManager</span>
					.insertInBOTransactionMaster();
<span class="nc" id="L650">			PreparedStatement BOMasPstmt = con</span>
					.prepareStatement(insertTransMaster);
<span class="nc" id="L652">			BOMasPstmt.setInt(1, transId);</span>
<span class="nc" id="L653">			BOMasPstmt.setInt(2, userId);</span>
<span class="nc" id="L654">			BOMasPstmt.setInt(3, userOrgId);</span>
<span class="nc" id="L655">			BOMasPstmt.setString(4, &quot;GOVT&quot;);</span>
<span class="nc" id="L656">			BOMasPstmt.setObject(5, null);</span>
<span class="nc" id="L657">			BOMasPstmt.setTimestamp(6, new java.sql.Timestamp(new Date()</span>
					.getTime()));
<span class="nc" id="L659">			BOMasPstmt.setString(7, transactionType);</span>

<span class="nc" id="L661">			BOMasPstmt.executeUpdate();</span>

			// done by arun
			// String
			// insertGovtTrans=QueryManager.insertST3GovtTransactionForTDS() + &quot;
			// values(&quot;+transId+&quot;,&quot;+amount+&quot;,'&quot;+new
			// java.sql.Date(month.getTime())+&quot;','&quot;+transactionType+&quot;') &quot; ;
<span class="nc" id="L668">			String insertGovtTrans = QueryManager</span>
					.insertST3GovtTransactionForTDS()
					+ &quot;   select &quot;
					+ transId
					+ &quot;, 'SE', amount, month, transaction_type, start_date, end_date from st_lms_bo_tasks where task_id=&quot;
					+ taskId;
<span class="nc" id="L674">			stmt11.executeUpdate(insertGovtTrans);</span>
<span class="nc" id="L675">			logger.debug(&quot;executed query is &quot; + insertGovtTrans);</span>
			// logger.debug(&quot;month is &quot; + month );

<span class="nc" id="L678">			receiptId = insertRcptMapping(con, transId, id);</span>

<span class="nc" id="L680">			con.commit();</span>

<span class="nc" id="L682">			GraphReportHelper reportHelper = new GraphReportHelper();</span>
<span class="nc" id="L683">			reportHelper.createTextReportBO(receiptId, userOrgName, userOrgId,</span>
					rootPath);

<span class="nc" id="L686">		} catch (SQLException e) {</span>

			try {
<span class="nc bnc" id="L689" title="All 2 branches missed.">				if (con != null) {</span>
<span class="nc" id="L690">					con.rollback();</span>
				}
<span class="nc" id="L692">			} catch (SQLException se) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L694">				se.printStackTrace();</span>
<span class="nc" id="L695">				throw new LMSException(&quot;Error During Rollback&quot;, se);</span>

<span class="nc" id="L697">			}</span>
<span class="nc" id="L698">			e.printStackTrace();</span>
<span class="nc" id="L699">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L701">			try {</span>
<span class="nc bnc" id="L702" title="All 4 branches missed.">				if (con != null) {</span>
<span class="nc" id="L703">					con.close();</span>
				}
<span class="nc" id="L705">			} catch (SQLException see) {</span>
<span class="nc" id="L706">				see.printStackTrace();</span>
<span class="nc" id="L707">				throw new LMSException(&quot;Error During closing connection&quot;, see);</span>
<span class="nc" id="L708">			}</span>
		}

<span class="nc" id="L711">	}</span>
	
	public void submitTdsIW(Integer id, String transType, String Month,
			Double Amount, Integer userOrgId, Integer userId, String rootPath,
			String userOrgName) throws LMSException {
<span class="nc" id="L716">		int taskId = id;</span>
<span class="nc" id="L717">		String transactionType = transType;</span>
<span class="nc" id="L718">		String monthTds = Month;</span>
<span class="nc" id="L719">		SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L720">		Date month = null;</span>

		try {
<span class="nc" id="L723">			month = d.parse(monthTds);</span>
<span class="nc" id="L724">		} catch (ParseException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L726">			e.printStackTrace();</span>
<span class="nc" id="L727">		}</span>
<span class="nc" id="L728">		double amount = Amount;</span>
<span class="nc" id="L729">		int transId = 0;</span>
<span class="nc" id="L730">		logger.debug(&quot;month is   &quot; + month);</span>
		 
<span class="nc" id="L732">		Connection con = null;</span>
		try {

<span class="nc" id="L735">			con = DBConnect.getConnection();</span>
<span class="nc" id="L736">			con.setAutoCommit(false);</span>
<span class="nc" id="L737">			Statement stmt4 = con.createStatement();</span>
<span class="nc" id="L738">			Statement stmt11 = con.createStatement();</span>

<span class="nc" id="L740">			logger.debug(&quot;task id is  &quot; + taskId);</span>

			// set the status as done in st_bo_task table
<span class="nc" id="L743">			String queryForTdstSubmit = QueryManager</span>
					.submitST3UnclmPwtApproved()
					+ &quot;where task_id='&quot; + taskId + &quot;' &quot;;
<span class="nc" id="L746">			stmt4.executeUpdate(queryForTdstSubmit);</span>

			// insert in LMS Transaction Master
			/*String insertLMSTrans = QueryManager.insertInLMSTransactionMaster();
			PreparedStatement LMSMasPstmt = con
					.prepareStatement(insertLMSTrans);
			LMSMasPstmt.setString(1, &quot;BO&quot;);
			LMSMasPstmt.executeUpdate();*/
<span class="nc" id="L754">			PreparedStatement LMSMasPstmt = con.prepareStatement(&quot;insert into st_lms_transaction_master (user_type, service_code, interface) values('BO','IW','WEB')&quot;);</span>
<span class="nc" id="L755">			LMSMasPstmt.executeUpdate();</span>
<span class="nc" id="L756">			ResultSet rs = LMSMasPstmt.getGeneratedKeys();</span>
<span class="nc bnc" id="L757" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L758">				transId = rs.getInt(1);</span>
<span class="nc" id="L759">				logger.debug(&quot;trans id is &quot; + transId);</span>

			}

			// String
			// insertTransMaster=QueryManager.insertST3TransactionMaster() + &quot;
			// values('GOVT','&quot;+new java.sql.Timestamp( new
			// Date().getTime())+&quot;','&quot;+transactionType+&quot;') &quot; ;
<span class="nc" id="L767">			String insertTransMaster = QueryManager</span>
					.insertInBOTransactionMaster();
<span class="nc" id="L769">			PreparedStatement BOMasPstmt = con</span>
					.prepareStatement(insertTransMaster);
<span class="nc" id="L771">			BOMasPstmt.setInt(1, transId);</span>
<span class="nc" id="L772">			BOMasPstmt.setInt(2, userId);</span>
<span class="nc" id="L773">			BOMasPstmt.setInt(3, userOrgId);</span>
<span class="nc" id="L774">			BOMasPstmt.setString(4, &quot;GOVT&quot;);</span>
<span class="nc" id="L775">			BOMasPstmt.setObject(5, null);</span>
<span class="nc" id="L776">			BOMasPstmt.setTimestamp(6, new java.sql.Timestamp(new Date()</span>
					.getTime()));
<span class="nc" id="L778">			BOMasPstmt.setString(7, transactionType);</span>

<span class="nc" id="L780">			BOMasPstmt.executeUpdate();</span>

			// done by arun
			// String
			// insertGovtTrans=QueryManager.insertST3GovtTransactionForTDS() + &quot;
			// values(&quot;+transId+&quot;,&quot;+amount+&quot;,'&quot;+new
			// java.sql.Date(month.getTime())+&quot;','&quot;+transactionType+&quot;') &quot; ;
<span class="nc" id="L787">			String insertGovtTrans = QueryManager</span>
					.insertST3GovtTransactionForTDS()
					+ &quot;   select &quot;
					+ transId
					+ &quot;, 'IW', amount, month, transaction_type, start_date, end_date from st_lms_bo_tasks where task_id=&quot;
					+ taskId;
<span class="nc" id="L793">			stmt11.executeUpdate(insertGovtTrans);</span>
<span class="nc" id="L794">			logger.debug(&quot;executed query is &quot; + insertGovtTrans);</span>
			// logger.debug(&quot;month is &quot; + month );

<span class="nc" id="L797">			receiptId = insertRcptMapping(con, transId, id);</span>

<span class="nc" id="L799">			con.commit();</span>

<span class="nc" id="L801">			GraphReportHelper reportHelper = new GraphReportHelper();</span>
<span class="nc" id="L802">			reportHelper.createTextReportBO(receiptId, userOrgName, userOrgId,</span>
					rootPath);

<span class="nc" id="L805">		} catch (SQLException e) {</span>

			try {
<span class="nc bnc" id="L808" title="All 2 branches missed.">				if (con != null) {</span>
<span class="nc" id="L809">					con.rollback();</span>
				}
<span class="nc" id="L811">			} catch (SQLException se) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L813">				se.printStackTrace();</span>
<span class="nc" id="L814">				throw new LMSException(&quot;Error During Rollback&quot;, se);</span>

<span class="nc" id="L816">			}</span>
<span class="nc" id="L817">			e.printStackTrace();</span>
<span class="nc" id="L818">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L820">			try {</span>
<span class="nc bnc" id="L821" title="All 4 branches missed.">				if (con != null) {</span>
<span class="nc" id="L822">					con.close();</span>
				}
<span class="nc" id="L824">			} catch (SQLException see) {</span>
<span class="nc" id="L825">				see.printStackTrace();</span>
<span class="nc" id="L826">				throw new LMSException(&quot;Error During closing connection&quot;, see);</span>
<span class="nc" id="L827">			}</span>
		}

<span class="nc" id="L830">	}</span>

	/**
	 * This method inside helper class is used to submit unclaimed pwt for game
	 * 
	 * @param id
	 *            is the task id from task table
	 * @param transType
	 *            is the transaction type
	 * @param gameid
	 *            is game's Id
	 * @param Amount
	 * @param userOrgName
	 * @param rootPath
	 * @throws LMSException
	 */
	public void submitUnclmPwt(int id, String transType, int gameid,
			double Amount, int userOrgId, int userId, String rootPath,
			String userOrgName, String serviceCode) throws LMSException {
<span class="nc" id="L849">		int taskId = id;</span>
<span class="nc" id="L850">		String transactionType = transType;</span>
<span class="nc" id="L851">		int gameId = gameid;</span>
<span class="nc" id="L852">		double amount = Amount;</span>
		//int transId = 0;
<span class="nc" id="L854">		 long transId =0;</span>
<span class="nc" id="L855">		Connection con = null;</span>

		try {

<span class="nc" id="L859">			con = DBConnect.getConnection();</span>
<span class="nc" id="L860">			con.setAutoCommit(false);</span>

<span class="nc" id="L862">			Statement stmt3 = con.createStatement();</span>
			// Statement stmt8=con.createStatement();
			// Statement stmt9=con.createStatement();

			// update bo_task table
<span class="nc" id="L867">			logger.debug(&quot;task id is  &quot; + taskId);</span>
<span class="nc" id="L868">			String queryForUnclmPwtSubmit = QueryManager</span>
					.submitST3UnclmPwtApproved()
					+ &quot;where task_id='&quot; + taskId + &quot;' &quot;;
<span class="nc" id="L871">			stmt3.executeUpdate(queryForUnclmPwtSubmit);</span>

			// insert in LMS transaction master
			/*PreparedStatement LMSMasPstmt = con.prepareStatement(QueryManager
					.insertInLMSTransactionMaster());
			LMSMasPstmt.setString(1, &quot;BO&quot;);
			LMSMasPstmt.executeUpdate();*/
<span class="nc" id="L878">			PreparedStatement LMSMasPstmt = con.prepareStatement(&quot;insert into st_lms_transaction_master (user_type, service_code, interface) values('BO','&quot;+ serviceCode +&quot;','WEB')&quot;);</span>
<span class="nc" id="L879">			System.out.println(&quot;serviceCode: &quot;+serviceCode + &quot;***  sewfw: &quot;+LMSMasPstmt);</span>
<span class="nc" id="L880">			LMSMasPstmt.executeUpdate();</span>
<span class="nc" id="L881">			ResultSet rs = LMSMasPstmt.getGeneratedKeys();</span>
			
<span class="nc bnc" id="L883" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L884">				transId = rs.getLong(1);</span>
			}

			// insert details into transaction master

			/*
			 * String
			 * insertTransMaster=QueryManager.insertST3TransactionMaster() + &quot;
			 * values('GOVT','&quot;+new java.sql.Timestamp( new
			 * Date().getTime())+&quot;','&quot;+transactionType+&quot;') &quot; ;
			 * stmt8.executeUpdate(insertTransMaster);
			 */

<span class="nc" id="L897">			PreparedStatement BOMasPstmt = con.prepareStatement(QueryManager</span>
					.insertInBOTransactionMaster());
<span class="nc" id="L899">			BOMasPstmt.setLong(1, transId);</span>
<span class="nc" id="L900">			BOMasPstmt.setInt(2, userId);</span>
<span class="nc" id="L901">			BOMasPstmt.setInt(3, userOrgId);</span>
<span class="nc" id="L902">			BOMasPstmt.setString(4, &quot;GOVT&quot;);</span>
<span class="nc" id="L903">			BOMasPstmt.setObject(5, null);</span>
<span class="nc" id="L904">			BOMasPstmt.setTimestamp(6, new java.sql.Timestamp(new Date()</span>
					.getTime()));
<span class="nc" id="L906">			BOMasPstmt.setString(7, transactionType);</span>

<span class="nc" id="L908">			BOMasPstmt.executeUpdate();</span>

			// insert details into bo_gov_transaction
			// String insertGovtTrans=QueryManager.insertST3GovtTransaction() +
			// &quot; values(&quot;+transId+&quot;,&quot;+amount+&quot;,&quot;+gameId+&quot;,'&quot;+transactionType+&quot;')
			// &quot; ;
			// stmt9.executeUpdate(insertGovtTrans);

<span class="nc" id="L916">			PreparedStatement pstmt = con</span>
					.prepareStatement(&quot;insert into st_lms_bo_govt_transaction (transaction_id, amount, game_id, transaction_type, start_date, end_date, service_code)  select ?, amount, game_id, transaction_type, start_date, end_date, service_code from  st_lms_bo_tasks where task_id = ?&quot;);
<span class="nc" id="L918">			pstmt.setLong(1, transId);</span>
<span class="nc" id="L919">			pstmt.setInt(2, taskId);</span>
<span class="nc" id="L920">			int updateRow = pstmt.executeUpdate();</span>
<span class="nc" id="L921">			logger.debug(&quot;gov comm  insertion  query &quot; + pstmt);</span>
<span class="nc" id="L922">			logger.debug(&quot;okkkkkkkkk...&quot; + updateRow);</span>
<span class="nc" id="L923">			logger.debug(&quot;gameid is &quot; + gameId);</span>

<span class="nc" id="L925">			receiptId = insertRcptMapping(con, transId, id);</span>

<span class="nc" id="L927">			con.commit();</span>

<span class="nc" id="L929">			GraphReportHelper reportHelper = new GraphReportHelper();</span>
<span class="nc" id="L930">			reportHelper.createTextReportBO(receiptId, userOrgName, userOrgId,</span>
					rootPath);

<span class="nc" id="L933">		} catch (SQLException e) {</span>

			try {
<span class="nc" id="L936">				con.rollback();</span>
<span class="nc" id="L937">			} catch (SQLException se) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L939">				se.printStackTrace();</span>
<span class="nc" id="L940">				throw new LMSException(&quot;Error During Rollback&quot;, se);</span>
<span class="nc" id="L941">			}</span>

<span class="nc" id="L943">			e.printStackTrace();</span>
<span class="nc" id="L944">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L946">			try {</span>
<span class="nc bnc" id="L947" title="All 8 branches missed.">				if (con != null &amp;&amp; !con.isClosed()) {</span>
<span class="nc" id="L948">					con.close();</span>
				}
<span class="nc" id="L950">			} catch (SQLException e1) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L952">				e1.printStackTrace();</span>
<span class="nc" id="L953">			}</span>
<span class="nc" id="L954">		}</span>

<span class="nc" id="L956">	}</span>

	public void submitVatAgtDG(Integer id, String transType, String Month,
			Double Amount, Integer agtId, Integer agtOrgId, String rootPath,
			String userOrgName) throws LMSException {
<span class="nc" id="L961">		logger.debug(&quot;submitVatAgtDG called&quot;);</span>
<span class="nc" id="L962">		int taskId = id;</span>
<span class="nc" id="L963">		String transactionType = transType;</span>
<span class="nc" id="L964">		String monthTds = Month;</span>
<span class="nc" id="L965">		SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L966">		Date month = null;</span>
		try {
<span class="nc" id="L968">			month = d.parse(monthTds);</span>
<span class="nc" id="L969">		} catch (ParseException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L971">			e.printStackTrace();</span>
<span class="nc" id="L972">		}</span>
<span class="nc" id="L973">		double amount = Amount;</span>
<span class="nc" id="L974">		long  transId = 0;</span>
<span class="nc" id="L975">		logger.debug(&quot;month is   &quot; + month);</span>
		 
<span class="nc" id="L977">		Connection con = null;</span>
		try {

<span class="nc" id="L980">			con = DBConnect.getConnection();</span>
<span class="nc" id="L981">			con.setAutoCommit(false);</span>
<span class="nc" id="L982">			Statement stmt4 = con.createStatement();</span>
<span class="nc" id="L983">			Statement stmt11 = con.createStatement();</span>

<span class="nc" id="L985">			logger.debug(&quot;task id is  &quot; + taskId);</span>
<span class="nc" id="L986">			String queryForTdstSubmit = QueryManager</span>
					.submitST3UnclmPwtApprovedAgt()
					+ &quot;where task_id='&quot; + taskId + &quot;' &quot;;
<span class="nc" id="L989">			stmt4.executeUpdate(queryForTdstSubmit);</span>

			// insert in LMS transaction master
<span class="nc" id="L992">			String insertLMSTransMas = QueryManager</span>
					.insertInLMSTransactionMaster();
<span class="nc" id="L994">			PreparedStatement LMSMaspstmt = con</span>
					.prepareStatement(insertLMSTransMas);
<span class="nc" id="L996">			LMSMaspstmt.setString(1, &quot;AGENT&quot;);</span>
<span class="nc" id="L997">			LMSMaspstmt.executeUpdate();</span>
<span class="nc" id="L998">			ResultSet rs = LMSMaspstmt.getGeneratedKeys();</span>
<span class="nc bnc" id="L999" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1000">				transId = rs.getLong(1);</span>
<span class="nc" id="L1001">				logger.debug(&quot;trans id is &quot; + transId);</span>
			}

			// insert into agent transaction master
			// String
			// insertTransMaster=QueryManager.insertST3TransactionMasterAgt() +
			// &quot; values(&quot;+agtId+&quot;,'&quot;+transactionType+&quot;','&quot;+new
			// java.sql.Timestamp( new Date().getTime())+&quot;') &quot; ;
<span class="nc" id="L1009">			String insertTransMaster = QueryManager</span>
					.insertInAgentTransactionMaster();
<span class="nc" id="L1011">			PreparedStatement AgtTransMaspstmt = con</span>
					.prepareStatement(insertTransMaster);

<span class="nc" id="L1014">			AgtTransMaspstmt.setLong(1, transId);</span>
<span class="nc" id="L1015">			AgtTransMaspstmt.setInt(2, agtId);</span>
<span class="nc" id="L1016">			AgtTransMaspstmt.setInt(3, agtOrgId);</span>
<span class="nc" id="L1017">			AgtTransMaspstmt.setString(4, &quot;GOVT&quot;);</span>
<span class="nc" id="L1018">			AgtTransMaspstmt.setObject(5, null);</span>
<span class="nc" id="L1019">			AgtTransMaspstmt.setString(6, transactionType);</span>
<span class="nc" id="L1020">			AgtTransMaspstmt.setTimestamp(7, new java.sql.Timestamp(new Date()</span>
					.getTime()));

<span class="nc" id="L1023">			AgtTransMaspstmt.executeUpdate();</span>

<span class="nc" id="L1025">			String insertGovtTrans = QueryManager</span>
					.insertST3GovtTransactionForTDSAgt()
					+ &quot; values(&quot;
					+ transId
					+ &quot;,&quot;
					+ amount
					+ &quot;,'&quot;
					+ new java.sql.Date(month.getTime())
					+ &quot;','&quot;
					+ transactionType + &quot;','DG') &quot;;
<span class="nc" id="L1035">			stmt11.executeUpdate(insertGovtTrans);</span>
<span class="nc" id="L1036">			receiptId = insertRcptMappingAgt(con, transId, id, agtOrgId);</span>
<span class="nc" id="L1037">			con.commit();</span>

<span class="nc" id="L1039">			GraphReportHelper reportHelper = new GraphReportHelper();</span>
<span class="nc" id="L1040">			reportHelper.createTextReportAgent(receiptId, rootPath, agtOrgId,</span>
					userOrgName);

<span class="nc" id="L1043">		} catch (SQLException e) {</span>

			try {
<span class="nc" id="L1046">				con.rollback();</span>
<span class="nc" id="L1047">			} catch (SQLException se) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L1049">				se.printStackTrace();</span>
<span class="nc" id="L1050">				throw new LMSException(&quot;Error During Rollback&quot;, se);</span>

<span class="nc" id="L1052">			}</span>
<span class="nc" id="L1053">			e.printStackTrace();</span>
<span class="nc" id="L1054">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L1056">			try {</span>
<span class="nc" id="L1057">				con.close();</span>
<span class="nc" id="L1058">			} catch (SQLException see) {</span>

<span class="nc" id="L1060">				see.printStackTrace();</span>
<span class="nc" id="L1061">				throw new LMSException(&quot;Error During Rollback&quot;, see);</span>

<span class="nc" id="L1063">			}</span>
		}

<span class="nc" id="L1066">	}</span>

	public void submitVatAgtSE(Integer id, String transType, String Month,
			Double Amount, Integer agtId, Integer agtOrgId, String rootPath,
			String userOrgName) throws LMSException {
<span class="nc" id="L1071">		logger.debug(&quot;submitVatAgtSE called&quot;);</span>
<span class="nc" id="L1072">		int taskId = id;</span>
<span class="nc" id="L1073">		String transactionType = transType;</span>
<span class="nc" id="L1074">		String monthTds = Month;</span>
<span class="nc" id="L1075">		SimpleDateFormat d = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L1076">		Date month = null;</span>
		try {
<span class="nc" id="L1078">			month = d.parse(monthTds);</span>
<span class="nc" id="L1079">		} catch (ParseException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L1081">			e.printStackTrace();</span>
<span class="nc" id="L1082">		}</span>
<span class="nc" id="L1083">		double amount = Amount;</span>
<span class="nc" id="L1084">		int transId = 0;</span>
<span class="nc" id="L1085">		logger.debug(&quot;month is   &quot; + month);</span>
		 
<span class="nc" id="L1087">		Connection con = null;</span>
		try {

<span class="nc" id="L1090">			con = DBConnect.getConnection();</span>
<span class="nc" id="L1091">			con.setAutoCommit(false);</span>
<span class="nc" id="L1092">			Statement stmt4 = con.createStatement();</span>
<span class="nc" id="L1093">			Statement stmt11 = con.createStatement();</span>

<span class="nc" id="L1095">			logger.debug(&quot;task id is  &quot; + taskId);</span>
<span class="nc" id="L1096">			String queryForTdstSubmit = QueryManager</span>
					.submitST3UnclmPwtApprovedAgt()
					+ &quot;where task_id='&quot; + taskId + &quot;' &quot;;
<span class="nc" id="L1099">			stmt4.executeUpdate(queryForTdstSubmit);</span>

			// insert in LMS transaction master
<span class="nc" id="L1102">			String insertLMSTransMas = QueryManager</span>
					.insertInLMSTransactionMaster();
<span class="nc" id="L1104">			PreparedStatement LMSMaspstmt = con</span>
					.prepareStatement(insertLMSTransMas);
<span class="nc" id="L1106">			LMSMaspstmt.setString(1, &quot;AGENT&quot;);</span>
<span class="nc" id="L1107">			LMSMaspstmt.executeUpdate();</span>
<span class="nc" id="L1108">			ResultSet rs = LMSMaspstmt.getGeneratedKeys();</span>
<span class="nc bnc" id="L1109" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1110">				transId = rs.getInt(1);</span>
<span class="nc" id="L1111">				logger.debug(&quot;trans id is &quot; + transId);</span>
			}

			// insert into agent transaction master
			// String
			// insertTransMaster=QueryManager.insertST3TransactionMasterAgt() +
			// &quot; values(&quot;+agtId+&quot;,'&quot;+transactionType+&quot;','&quot;+new
			// java.sql.Timestamp( new Date().getTime())+&quot;') &quot; ;
<span class="nc" id="L1119">			String insertTransMaster = QueryManager</span>
					.insertInAgentTransactionMaster();
<span class="nc" id="L1121">			PreparedStatement AgtTransMaspstmt = con</span>
					.prepareStatement(insertTransMaster);

<span class="nc" id="L1124">			AgtTransMaspstmt.setInt(1, transId);</span>
<span class="nc" id="L1125">			AgtTransMaspstmt.setInt(2, agtId);</span>
<span class="nc" id="L1126">			AgtTransMaspstmt.setInt(3, agtOrgId);</span>
<span class="nc" id="L1127">			AgtTransMaspstmt.setString(4, &quot;GOVT&quot;);</span>
<span class="nc" id="L1128">			AgtTransMaspstmt.setObject(5, null);</span>
<span class="nc" id="L1129">			AgtTransMaspstmt.setString(6, transactionType);</span>
<span class="nc" id="L1130">			AgtTransMaspstmt.setTimestamp(7, new java.sql.Timestamp(new Date()</span>
					.getTime()));

<span class="nc" id="L1133">			AgtTransMaspstmt.executeUpdate();</span>

<span class="nc" id="L1135">			String insertGovtTrans = QueryManager</span>
					.insertST3GovtTransactionForTDSAgt()
					+ &quot; values(&quot;
					+ transId
					+ &quot;,&quot;
					+ amount
					+ &quot;,'&quot;
					+ new java.sql.Date(month.getTime())
					+ &quot;','&quot;
					+ transactionType + &quot;','SE') &quot;;
<span class="nc" id="L1145">			stmt11.executeUpdate(insertGovtTrans);</span>
<span class="nc" id="L1146">			receiptId = insertRcptMappingAgt(con, transId, id, agtOrgId);</span>
<span class="nc" id="L1147">			con.commit();</span>

<span class="nc" id="L1149">			GraphReportHelper reportHelper = new GraphReportHelper();</span>
<span class="nc" id="L1150">			reportHelper.createTextReportAgent(receiptId, rootPath, agtOrgId,</span>
					userOrgName);

<span class="nc" id="L1153">		} catch (SQLException e) {</span>

			try {
<span class="nc" id="L1156">				con.rollback();</span>
<span class="nc" id="L1157">			} catch (SQLException se) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L1159">				se.printStackTrace();</span>
<span class="nc" id="L1160">				throw new LMSException(&quot;Error During Rollback&quot;, se);</span>

<span class="nc" id="L1162">			}</span>
<span class="nc" id="L1163">			e.printStackTrace();</span>
<span class="nc" id="L1164">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L1166">			try {</span>
<span class="nc" id="L1167">				con.close();</span>
<span class="nc" id="L1168">			} catch (SQLException see) {</span>

<span class="nc" id="L1170">				see.printStackTrace();</span>
<span class="nc" id="L1171">				throw new LMSException(&quot;Error During Rollback&quot;, see);</span>

<span class="nc" id="L1173">			}</span>
		}

<span class="nc" id="L1176">	}</span>

	/**
	 * This method inside helper class is used to get the list of govt comm
	 * Approved for the games
	 * 
	 * @return List of govt comm
	 * @throws LMSException
	 */
	public List taskGovtCommSearch() throws LMSException {

		 
<span class="nc" id="L1188">		Connection con = DBConnect.getConnection();</span>
		try {

<span class="nc" id="L1191">			Statement stmt2 = con.createStatement();</span>
<span class="nc" id="L1192">			Statement stmt4 = con.createStatement();</span>
<span class="nc" id="L1193">			TaskBean taskBean = null;</span>
<span class="nc" id="L1194">			List&lt;TaskBean&gt; GovtCommSearchResults = new ArrayList&lt;TaskBean&gt;();</span>
<span class="nc" id="L1195">			ResultSet rs = null;</span>

<span class="nc" id="L1197">			String queryForGovtComm = QueryManager.getST3GovtCommApprovedSE();</span>
<span class="nc" id="L1198">			rs = stmt2.executeQuery(queryForGovtComm);</span>
<span class="nc" id="L1199">			logger.debug(&quot;query to search approved Gov Comm  == &quot;</span>
					+ queryForGovtComm);
<span class="nc bnc" id="L1201" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1202">				taskBean = new TaskBean();</span>
<span class="nc" id="L1203">				taskBean.setAmount(rs.getDouble(TableConstants.TASK_AMOUNT));</span>

<span class="nc" id="L1205">				taskBean.setMonth(rs.getString(TableConstants.MONTH_TASK));</span>
<span class="nc" id="L1206">				taskBean.setTransactionType(rs</span>
						.getString(TableConstants.TASK_TYPE));
<span class="nc" id="L1208">				taskBean.setStatus(rs.getString(TableConstants.TASK_STATUS));</span>
<span class="nc" id="L1209">				taskBean.setTaskId(rs.getInt(TableConstants.TASK_ID));</span>
<span class="nc" id="L1210">				taskBean.setGameId(rs.getInt(TableConstants.GAME_ID));</span>
				// add game nbr into task bean here
<span class="nc" id="L1212">				logger.debug(&quot;after optimizing queries&quot;);</span>
<span class="nc" id="L1213">				taskBean.setGameNbr(rs.getInt(TableConstants.GAME_NBR));</span>

				// added by arun
<span class="nc" id="L1216">				taskBean.setGameName(rs.getString(&quot;game_name&quot;));</span>
<span class="nc" id="L1217">				taskBean.setStartDate(rs.getDate(&quot;start_date&quot;).toString());</span>
<span class="nc" id="L1218">				taskBean.setEndDate(rs.getDate(&quot;end_date&quot;).toString());</span>
				// join the queries to select data from task table and from
				// st_se_game_master

				/*
				 * String gameDet=QueryManager.getST3GamesDetails() + &quot; where
				 * game_id=&quot;+rs.getInt(TableConstants.GAME_ID)+&quot; &quot; ; ResultSet
				 * gameDetails=stmt4.executeQuery(gameDet);
				 * while(gameDetails.next()) {
				 * taskBean.setGameNbr(gameDetails.getInt(TableConstants.GAME_NBR)); }
				 */

<span class="nc" id="L1230">				logger.debug(&quot;task id is   &quot;</span>
						+ rs.getInt(TableConstants.TASK_ID));

<span class="nc" id="L1233">				GovtCommSearchResults.add(taskBean);</span>
			}

<span class="nc" id="L1236">			return GovtCommSearchResults;</span>

<span class="nc" id="L1238">		} catch (SQLException e) {</span>

<span class="nc" id="L1240">			e.printStackTrace();</span>
<span class="nc" id="L1241">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L1243">			try {</span>
<span class="nc bnc" id="L1244" title="All 4 branches missed.">				if (con != null) {</span>
<span class="nc" id="L1245">					con.close();</span>
				}
<span class="nc" id="L1247">			} catch (SQLException se) {</span>
<span class="nc" id="L1248">				se.printStackTrace();</span>
<span class="nc" id="L1249">			}</span>
		}
		// return null;

	}

	public List taskTDSSearchDG() throws LMSException {
<span class="nc" id="L1256">		logger.debug(&quot; taskTDSSearchDG() called&quot;);</span>
		 
<span class="nc" id="L1258">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L1259">		logger</span>
				.debug(&quot;1234567896543214569875463214785963.........................&quot;);
<span class="nc" id="L1261">		String serviceName = &quot;&quot;;</span>
		try {

<span class="nc" id="L1264">			Statement stmt1 = con.createStatement();</span>
<span class="nc" id="L1265">			TaskBean taskBean = null;</span>

<span class="nc" id="L1267">			List&lt;TaskBean&gt; searchResults = new ArrayList&lt;TaskBean&gt;();</span>

<span class="nc" id="L1269">			ResultSet rs = null;</span>
<span class="nc" id="L1270">			rs = stmt1</span>
					.executeQuery(&quot;select service_display_name from st_lms_service_master where service_code='DG' and status='ACTIVE'&quot;);
<span class="nc bnc" id="L1272" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L1273">				serviceName = rs.getString(&quot;service_display_name&quot;);</span>
			}
<span class="nc" id="L1275">			logger.debug(&quot;hello      &quot;);</span>
<span class="nc" id="L1276">			String queryForTDS = QueryManager.getST3TDSApprovedDG();</span>
<span class="nc" id="L1277">			rs = stmt1.executeQuery(queryForTDS);</span>

<span class="nc bnc" id="L1279" title="All 2 branches missed.">			while (rs.next()) {</span>

<span class="nc" id="L1281">				taskBean = new TaskBean();</span>
<span class="nc" id="L1282">				taskBean.setAmount(rs.getDouble(TableConstants.TASK_AMOUNT));</span>
				// SimpleDateFormat dateFormat=new
				// SimpleDateFormat(&quot;dd-MM-yyyy&quot;);
				// taskBean.setMonth(dateFormat.format(rs.getDate(TableConstants.MONTH_TASK)));
<span class="nc" id="L1286">				logger.debug(&quot;haaaaaaaannnnnnnnnnnnnn &quot;</span>
						+ rs.getString(TableConstants.MONTH_TASK));
<span class="nc" id="L1288">				taskBean.setMonth(rs.getString(TableConstants.MONTH_TASK));</span>
<span class="nc" id="L1289">				taskBean.setTransactionType(rs</span>
						.getString(TableConstants.TASK_TYPE));
<span class="nc" id="L1291">				taskBean.setStatus(rs.getString(TableConstants.TASK_STATUS));</span>
<span class="nc" id="L1292">				taskBean.setTaskId(rs.getInt(TableConstants.TASK_ID));</span>
<span class="nc" id="L1293">				taskBean.setGameId(rs.getInt(TableConstants.GAME_ID));</span>
<span class="nc" id="L1294">				taskBean.setServiceCode(&quot;DG&quot;);</span>
<span class="nc" id="L1295">				taskBean.setServiceName(serviceName);</span>
<span class="nc" id="L1296">				logger.debug(&quot;task id id   &quot;</span>
						+ rs.getInt(TableConstants.TASK_ID));
<span class="nc" id="L1298">				searchResults.add(taskBean);</span>

			}

<span class="nc" id="L1302">			return searchResults;</span>

<span class="nc" id="L1304">		} catch (SQLException e) {</span>

<span class="nc" id="L1306">			e.printStackTrace();</span>
<span class="nc" id="L1307">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L1309">			try {</span>
<span class="nc bnc" id="L1310" title="All 4 branches missed.">				if (con != null) {</span>
<span class="nc" id="L1311">					con.close();</span>
				}
<span class="nc" id="L1313">			} catch (SQLException se) {</span>
<span class="nc" id="L1314">				se.printStackTrace();</span>
<span class="nc" id="L1315">			}</span>
		}
		// return null;

	}

	public List taskTDSSearchSE() throws LMSException {
<span class="nc" id="L1322">		logger.debug(&quot; taskTDSSearchSE() called&quot;);</span>
		 
<span class="nc" id="L1324">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L1325">		logger</span>
				.debug(&quot;1234567896543214569875463214785963.........................&quot;);
<span class="nc" id="L1327">		String serviceName = &quot;&quot;;</span>
		try {

<span class="nc" id="L1330">			Statement stmt1 = con.createStatement();</span>
<span class="nc" id="L1331">			TaskBean taskBean = null;</span>

<span class="nc" id="L1333">			List&lt;TaskBean&gt; searchResults = new ArrayList&lt;TaskBean&gt;();</span>

<span class="nc" id="L1335">			ResultSet rs = null;</span>
<span class="nc" id="L1336">			rs = stmt1</span>
					.executeQuery(&quot;select service_display_name from st_lms_service_master where service_code='SE' and status='ACTIVE'&quot;);
<span class="nc bnc" id="L1338" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L1339">				serviceName = rs.getString(&quot;service_display_name&quot;);</span>
			}
<span class="nc" id="L1341">			logger.debug(&quot;hello      &quot;);</span>
<span class="nc" id="L1342">			String queryForTDS = QueryManager.getST3TDSApprovedSE();</span>
<span class="nc" id="L1343">			rs = stmt1.executeQuery(queryForTDS);</span>

<span class="nc bnc" id="L1345" title="All 2 branches missed.">			while (rs.next()) {</span>

<span class="nc" id="L1347">				taskBean = new TaskBean();</span>
<span class="nc" id="L1348">				taskBean.setAmount(rs.getDouble(TableConstants.TASK_AMOUNT));</span>
				// SimpleDateFormat dateFormat=new
				// SimpleDateFormat(&quot;dd-MM-yyyy&quot;);
				// taskBean.setMonth(dateFormat.format(rs.getDate(TableConstants.MONTH_TASK)));
<span class="nc" id="L1352">				logger.debug(&quot;haaaaaaaannnnnnnnnnnnnn &quot;</span>
						+ rs.getString(TableConstants.MONTH_TASK));
<span class="nc" id="L1354">				taskBean.setMonth(rs.getString(TableConstants.MONTH_TASK));</span>
<span class="nc" id="L1355">				taskBean.setTransactionType(rs</span>
						.getString(TableConstants.TASK_TYPE));
<span class="nc" id="L1357">				taskBean.setStatus(rs.getString(TableConstants.TASK_STATUS));</span>
<span class="nc" id="L1358">				taskBean.setTaskId(rs.getInt(TableConstants.TASK_ID));</span>
<span class="nc" id="L1359">				taskBean.setGameId(rs.getInt(TableConstants.GAME_ID));</span>
<span class="nc" id="L1360">				taskBean.setServiceCode(&quot;SE&quot;);</span>
<span class="nc" id="L1361">				taskBean.setServiceName(serviceName);</span>
<span class="nc" id="L1362">				logger.debug(&quot;task id id   &quot;</span>
						+ rs.getInt(TableConstants.TASK_ID));
<span class="nc" id="L1364">				searchResults.add(taskBean);</span>

			}

<span class="nc" id="L1368">			return searchResults;</span>

<span class="nc" id="L1370">		} catch (SQLException e) {</span>

<span class="nc" id="L1372">			e.printStackTrace();</span>
<span class="nc" id="L1373">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L1375">			try {</span>
<span class="nc bnc" id="L1376" title="All 4 branches missed.">				if (con != null) {</span>
<span class="nc" id="L1377">					con.close();</span>
				}
<span class="nc" id="L1379">			} catch (SQLException se) {</span>
<span class="nc" id="L1380">				se.printStackTrace();</span>
<span class="nc" id="L1381">			}</span>
		}
		// return null;

	}

	/**
	 * This method is used to get the list of unclaimed Pwt for the games
	 * 
	 * @return List of Unclaimed Pwt
	 * @throws LMSException
	 */
	public List taskUnclmPwtSearch() throws LMSException {

		 
<span class="nc" id="L1396">		Connection con = DBConnect.getConnection();</span>
		try {

<span class="nc" id="L1399">			Statement stmt3 = con.createStatement();</span>
<span class="nc" id="L1400">			Statement stmt4 = con.createStatement();</span>
<span class="nc" id="L1401">			TaskBean taskBean = null;</span>
<span class="nc" id="L1402">			List&lt;TaskBean&gt; UnclmPwtSearchResults = new ArrayList&lt;TaskBean&gt;();</span>
<span class="nc" id="L1403">			ResultSet rs = null;</span>

<span class="nc" id="L1405">			String queryForUnclmPwt = QueryManager.getST3UnclmPwtApproved();</span>
<span class="nc" id="L1406">			rs = stmt3.executeQuery(queryForUnclmPwt);</span>

<span class="nc bnc" id="L1408" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1409">				taskBean = new TaskBean();</span>
<span class="nc" id="L1410">				taskBean.setAmount(rs.getDouble(TableConstants.TASK_AMOUNT));</span>

<span class="nc" id="L1412">				taskBean.setMonth(rs.getString(TableConstants.MONTH_TASK));</span>
<span class="nc" id="L1413">				taskBean.setTransactionType(rs</span>
						.getString(TableConstants.TASK_TYPE));
<span class="nc" id="L1415">				taskBean.setStatus(rs.getString(TableConstants.TASK_STATUS));</span>
<span class="nc" id="L1416">				taskBean.setTaskId(rs.getInt(TableConstants.TASK_ID));</span>
<span class="nc" id="L1417">				taskBean.setApprovedate(rs</span>
						.getString(TableConstants.TASK_APPROVE_DATE));
<span class="nc" id="L1419">				taskBean.setGameId(rs.getInt(TableConstants.GAME_ID));</span>
<span class="nc" id="L1420">				taskBean.setGameNbr(rs.getInt(TableConstants.GAME_NBR));</span>
				// it is commented to optimize the queries
				/*
				 * String gameDet=QueryManager.getST3GamesDetails() + &quot; where
				 * game_id=&quot;+rs.getInt(TableConstants.GAME_ID)+&quot; &quot; ; ResultSet
				 * gameDetails=stmt4.executeQuery(gameDet);
				 * while(gameDetails.next()) {
				 * taskBean.setGameNbr(gameDetails.getInt(TableConstants.GAME_NBR)); }
				 */
<span class="nc" id="L1429">				logger.debug(&quot;task id is   &quot;</span>
						+ rs.getInt(TableConstants.TASK_ID));

<span class="nc" id="L1432">				UnclmPwtSearchResults.add(taskBean);</span>
			}

<span class="nc" id="L1435">			return UnclmPwtSearchResults;</span>

<span class="nc" id="L1437">		} catch (SQLException e) {</span>

<span class="nc" id="L1439">			e.printStackTrace();</span>
<span class="nc" id="L1440">			throw new LMSException(e);</span>
		}
		// return null;

	}

	public List taskVATSearchDG(String userType, Integer userOrgid)
			throws LMSException {
<span class="nc" id="L1448">		logger.debug(&quot;taskVATSearchDG called&quot;);</span>
		 
<span class="nc" id="L1450">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L1451">		logger</span>
				.debug(&quot;1234567896543214569875463214785963.........................&quot;);
<span class="nc" id="L1453">		String serviceName = &quot;&quot;;</span>
		try {

<span class="nc" id="L1456">			Statement stmt1 = con.createStatement();</span>
<span class="nc" id="L1457">			TaskBean taskBean = null;</span>

<span class="nc" id="L1459">			List&lt;TaskBean&gt; searchResults = new ArrayList&lt;TaskBean&gt;();</span>

<span class="nc" id="L1461">			ResultSet rs = null;</span>
<span class="nc" id="L1462">			rs = stmt1</span>
					.executeQuery(&quot;select service_display_name from st_lms_service_master where service_code='DG' and status='ACTIVE'&quot;);
<span class="nc bnc" id="L1464" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L1465">				serviceName = rs.getString(&quot;service_display_name&quot;);</span>
			}

<span class="nc" id="L1468">			logger.debug(&quot;hello      &quot;);</span>
<span class="nc" id="L1469">			String queryForVAT = null;</span>
<span class="nc bnc" id="L1470" title="All 2 branches missed.">			if (userType.equals(&quot;BO&quot;)) {</span>
<span class="nc" id="L1471">				queryForVAT = QueryManager.getST3VATApprovedDG();</span>
<span class="nc bnc" id="L1472" title="All 2 branches missed.">			} else if (userType.equals(&quot;AGENT&quot;)) {</span>
<span class="nc" id="L1473">				queryForVAT = QueryManager.getST3VATApprovedAgtDG() + userOrgid;</span>
			}

<span class="nc" id="L1476">			logger.debug(&quot;aaaa &quot; + queryForVAT);</span>
<span class="nc" id="L1477">			rs = stmt1.executeQuery(queryForVAT);</span>

<span class="nc bnc" id="L1479" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1480">				taskBean = new TaskBean();</span>
<span class="nc" id="L1481">				taskBean.setAmount(rs.getDouble(TableConstants.TASK_AMOUNT));</span>
				// SimpleDateFormat dateFormat=new
				// SimpleDateFormat(&quot;dd-MM-yyyy&quot;);
				// taskBean.setMonth(dateFormat.format(rs.getDate(TableConstants.MONTH_TASK)));
<span class="nc" id="L1485">				logger.debug(&quot;haaaaaaaannnnnnnnnnnnnn &quot;</span>
						+ rs.getString(TableConstants.MONTH_TASK));
<span class="nc" id="L1487">				taskBean.setMonth(rs.getString(TableConstants.MONTH_TASK));</span>
<span class="nc" id="L1488">				taskBean.setTransactionType(rs</span>
						.getString(TableConstants.TASK_TYPE));
<span class="nc" id="L1490">				taskBean.setStatus(rs.getString(TableConstants.TASK_STATUS));</span>
<span class="nc" id="L1491">				taskBean.setTaskId(rs.getInt(TableConstants.TASK_ID));</span>
<span class="nc" id="L1492">				taskBean.setServiceCode(&quot;DG&quot;);</span>
<span class="nc" id="L1493">				taskBean.setServiceName(serviceName);</span>
				// taskBean.setGameId(rs.getInt(TableConstants.GAME_ID));
<span class="nc" id="L1495">				logger.debug(&quot;task id id   &quot;</span>
						+ rs.getInt(TableConstants.TASK_ID));
<span class="nc" id="L1497">				searchResults.add(taskBean);</span>

			}

<span class="nc" id="L1501">			return searchResults;</span>

<span class="nc" id="L1503">		} catch (SQLException e) {</span>

<span class="nc" id="L1505">			e.printStackTrace();</span>
<span class="nc" id="L1506">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L1508">			try {</span>
<span class="nc bnc" id="L1509" title="All 4 branches missed.">				if (con != null) {</span>
<span class="nc" id="L1510">					con.close();</span>
				}
<span class="nc" id="L1512">			} catch (SQLException se) {</span>
<span class="nc" id="L1513">				se.printStackTrace();</span>
<span class="nc" id="L1514">			}</span>
		}
		// return null;

	}

	public List taskVATSearchSE(String userType, Integer userOrgid)
			throws LMSException {
<span class="nc" id="L1522">		logger.debug(&quot;taskVATSearchSE called&quot;);</span>
		 
<span class="nc" id="L1524">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L1525">		logger</span>
				.debug(&quot;1234567896543214569875463214785963.........................&quot;);
<span class="nc" id="L1527">		String serviceName = &quot;&quot;;</span>
		try {

<span class="nc" id="L1530">			Statement stmt1 = con.createStatement();</span>
<span class="nc" id="L1531">			TaskBean taskBean = null;</span>

<span class="nc" id="L1533">			List&lt;TaskBean&gt; searchResults = new ArrayList&lt;TaskBean&gt;();</span>

<span class="nc" id="L1535">			ResultSet rs = null;</span>
<span class="nc" id="L1536">			rs = stmt1</span>
					.executeQuery(&quot;select service_display_name from st_lms_service_master where service_code='SE' and status='ACTIVE'&quot;);
<span class="nc bnc" id="L1538" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L1539">				serviceName = rs.getString(&quot;service_display_name&quot;);</span>
			}

<span class="nc" id="L1542">			logger.debug(&quot;hello      &quot;);</span>
<span class="nc" id="L1543">			String queryForVAT = null;</span>
<span class="nc bnc" id="L1544" title="All 2 branches missed.">			if (userType.equals(&quot;BO&quot;)) {</span>
<span class="nc" id="L1545">				queryForVAT = QueryManager.getST3VATApprovedSE();</span>
<span class="nc bnc" id="L1546" title="All 2 branches missed.">			} else if (userType.equals(&quot;AGENT&quot;)) {</span>
<span class="nc" id="L1547">				queryForVAT = QueryManager.getST3VATApprovedAgtSE() + userOrgid;</span>
			}

<span class="nc" id="L1550">			logger.debug(&quot;aaaa &quot; + queryForVAT);</span>
<span class="nc" id="L1551">			rs = stmt1.executeQuery(queryForVAT);</span>

<span class="nc bnc" id="L1553" title="All 2 branches missed.">			while (rs.next()) {</span>

<span class="nc" id="L1555">				taskBean = new TaskBean();</span>
<span class="nc" id="L1556">				taskBean.setAmount(rs.getDouble(TableConstants.TASK_AMOUNT));</span>
				// SimpleDateFormat dateFormat=new
				// SimpleDateFormat(&quot;dd-MM-yyyy&quot;);
				// taskBean.setMonth(dateFormat.format(rs.getDate(TableConstants.MONTH_TASK)));
<span class="nc" id="L1560">				logger.debug(&quot;haaaaaaaannnnnnnnnnnnnn &quot;</span>
						+ rs.getString(TableConstants.MONTH_TASK));
<span class="nc" id="L1562">				taskBean.setMonth(rs.getString(TableConstants.MONTH_TASK));</span>
<span class="nc" id="L1563">				taskBean.setTransactionType(rs</span>
						.getString(TableConstants.TASK_TYPE));
<span class="nc" id="L1565">				taskBean.setStatus(rs.getString(TableConstants.TASK_STATUS));</span>
<span class="nc" id="L1566">				taskBean.setTaskId(rs.getInt(TableConstants.TASK_ID));</span>
<span class="nc" id="L1567">				taskBean.setServiceCode(&quot;SE&quot;);</span>
<span class="nc" id="L1568">				taskBean.setServiceName(serviceName);</span>
				// taskBean.setGameId(rs.getInt(TableConstants.GAME_ID));
<span class="nc" id="L1570">				logger.debug(&quot;task id id   &quot;</span>
						+ rs.getInt(TableConstants.TASK_ID));
<span class="nc" id="L1572">				searchResults.add(taskBean);</span>

			}

<span class="nc" id="L1576">			return searchResults;</span>

<span class="nc" id="L1578">		} catch (SQLException e) {</span>

<span class="nc" id="L1580">			e.printStackTrace();</span>
<span class="nc" id="L1581">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L1583">			try {</span>
<span class="nc bnc" id="L1584" title="All 4 branches missed.">				if (con != null) {</span>
<span class="nc" id="L1585">					con.close();</span>
				}
<span class="nc" id="L1587">			} catch (SQLException se) {</span>
<span class="nc" id="L1588">				se.printStackTrace();</span>
<span class="nc" id="L1589">			}</span>
		}
		// return null;

	}
	
	public List taskVATSearchIW(String userType, Integer userOrgid)
	throws LMSException {
<span class="nc" id="L1597">logger.debug(&quot;taskVATSearchIW called&quot;);</span>
 
<span class="nc" id="L1599">Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L1600">logger</span>
		.debug(&quot;1234567896543214569875463214785963.........................&quot;);
<span class="nc" id="L1602">String serviceName = &quot;&quot;;</span>
try {

<span class="nc" id="L1605">	Statement stmt1 = con.createStatement();</span>
<span class="nc" id="L1606">	TaskBean taskBean = null;</span>

<span class="nc" id="L1608">	List&lt;TaskBean&gt; searchResults = new ArrayList&lt;TaskBean&gt;();</span>

<span class="nc" id="L1610">	ResultSet rs = null;</span>
<span class="nc" id="L1611">	rs = stmt1</span>
			.executeQuery(&quot;select service_display_name from st_lms_service_master where service_code='IW' and status='ACTIVE'&quot;);
<span class="nc bnc" id="L1613" title="All 2 branches missed.">	if (rs.next()) {</span>
<span class="nc" id="L1614">		serviceName = rs.getString(&quot;service_display_name&quot;);</span>
	}

<span class="nc" id="L1617">	logger.debug(&quot;hello      &quot;);</span>
<span class="nc" id="L1618">	String queryForVAT = null;</span>
<span class="nc bnc" id="L1619" title="All 2 branches missed.">	if (userType.equals(&quot;BO&quot;)) {</span>
<span class="nc" id="L1620">		queryForVAT = QueryManager.getST3VATApprovedIW();</span>
<span class="nc bnc" id="L1621" title="All 2 branches missed.">	} else if (userType.equals(&quot;AGENT&quot;)) {</span>
<span class="nc" id="L1622">		queryForVAT = QueryManager.getST3VATApprovedAgtIW() + userOrgid;</span>
	}

<span class="nc" id="L1625">	logger.debug(&quot;aaaa &quot; + queryForVAT);</span>
<span class="nc" id="L1626">	rs = stmt1.executeQuery(queryForVAT);</span>

<span class="nc bnc" id="L1628" title="All 2 branches missed.">	while (rs.next()) {</span>

<span class="nc" id="L1630">		taskBean = new TaskBean();</span>
<span class="nc" id="L1631">		taskBean.setAmount(rs.getDouble(TableConstants.TASK_AMOUNT));</span>
		// SimpleDateFormat dateFormat=new
		// SimpleDateFormat(&quot;dd-MM-yyyy&quot;);
		// taskBean.setMonth(dateFormat.format(rs.getDate(TableConstants.MONTH_TASK)));
<span class="nc" id="L1635">		logger.debug(&quot;haaaaaaaannnnnnnnnnnnnn &quot;</span>
				+ rs.getString(TableConstants.MONTH_TASK));
<span class="nc" id="L1637">		taskBean.setMonth(rs.getString(TableConstants.MONTH_TASK));</span>
<span class="nc" id="L1638">		taskBean.setTransactionType(rs</span>
				.getString(TableConstants.TASK_TYPE));
<span class="nc" id="L1640">		taskBean.setStatus(rs.getString(TableConstants.TASK_STATUS));</span>
<span class="nc" id="L1641">		taskBean.setTaskId(rs.getInt(TableConstants.TASK_ID));</span>
<span class="nc" id="L1642">		taskBean.setServiceCode(&quot;IW&quot;);</span>
<span class="nc" id="L1643">		taskBean.setServiceName(serviceName);</span>
		// taskBean.setGameId(rs.getInt(TableConstants.GAME_ID));
<span class="nc" id="L1645">		logger.debug(&quot;task id id   &quot;</span>
				+ rs.getInt(TableConstants.TASK_ID));
<span class="nc" id="L1647">		searchResults.add(taskBean);</span>

	}

<span class="nc" id="L1651">	return searchResults;</span>

<span class="nc" id="L1653">} catch (SQLException e) {</span>

<span class="nc" id="L1655">	e.printStackTrace();</span>
<span class="nc" id="L1656">	throw new LMSException(e);</span>
} finally {
<span class="nc" id="L1658">	try {</span>
<span class="nc bnc" id="L1659" title="All 4 branches missed.">		if (con != null) {</span>
<span class="nc" id="L1660">			con.close();</span>
		}
<span class="nc" id="L1662">	} catch (SQLException se) {</span>
<span class="nc" id="L1663">		se.printStackTrace();</span>
<span class="nc" id="L1664">	}</span>
}
// return null;

}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>