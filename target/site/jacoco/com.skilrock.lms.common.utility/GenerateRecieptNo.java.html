<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GenerateRecieptNo.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.common.utility</a> &gt; <span class="el_source">GenerateRecieptNo.java</span></div><h1>GenerateRecieptNo.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.common.utility;

import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Calendar;
import java.util.List;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.exception.LMSErrors;
import com.skilrock.lms.common.exception.LMSException;

<span class="nc" id="L17">public class GenerateRecieptNo {</span>
<span class="nc" id="L18">	static Log logger = LogFactory.getLog(GenerateRecieptNo.class);</span>

	public synchronized static String generateRequestId(String recieptType)
			throws LMSException {
<span class="nc" id="L22">		String autoGeneratedNo = null;</span>

<span class="nc" id="L24">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L25">		int year = cal.get(Calendar.YEAR);</span>
<span class="nc" id="L26">		int month = cal.get(Calendar.MONTH) + 1;</span>
<span class="nc" id="L27">		String monthString = null;</span>
<span class="nc bnc" id="L28" title="All 2 branches missed.">		if (month &lt; 10) {</span>
<span class="nc" id="L29">			monthString = &quot;0&quot; + month;</span>
		} else {
<span class="nc" id="L31">			monthString = &quot;&quot; + month;</span>
		}
<span class="nc" id="L33">		String lastRecieptGenerated = null;</span>
		// get the last request number generated
		 
<span class="nc" id="L36">		Connection con = null;</span>
<span class="nc" id="L37">		Statement stmt = null;</span>
		try {
<span class="nc" id="L39">			con = DBConnect.getConnection();</span>
<span class="nc" id="L40">			stmt = con.createStatement();</span>
<span class="nc" id="L41">			String getLastReqNo = &quot;select request_id from st_se_pwt_approval_request_master order by request_id desc limit 1 &quot;;</span>
<span class="nc" id="L42">			ResultSet rs = stmt.executeQuery(getLastReqNo);</span>
<span class="nc bnc" id="L43" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L44">				lastRecieptGenerated = rs.getString(&quot;request_id&quot;);</span>
			}
<span class="nc" id="L46">		} catch (SQLException e) {</span>
<span class="nc" id="L47">			e.printStackTrace();</span>
<span class="nc" id="L48">		}</span>

<span class="nc" id="L50">		String lastTwoDigitsYr = (&quot;&quot; + year).substring(2, 4);</span>
		// String oneCharOfUserType=userType.substring(0, 1);
		// get initial two digits for starting two digits of reciept type

<span class="nc" id="L54">		String startThreeDigitsForType = recieptType.substring(0, 3);</span>
<span class="nc" id="L55">		int monthForLastRecieptNo = 0;</span>
<span class="nc bnc" id="L56" title="All 2 branches missed.">		if (lastRecieptGenerated != null) {</span>
<span class="nc" id="L57">			monthForLastRecieptNo = Integer.parseInt(lastRecieptGenerated</span>
					.substring(5, 7));
		}

		// get last generated number

<span class="nc bnc" id="L63" title="All 2 branches missed.">		if (lastRecieptGenerated == null) {</span>

<span class="nc" id="L65">			autoGeneratedNo = startThreeDigitsForType + lastTwoDigitsYr</span>
					+ monthString + &quot;000001&quot;;
<span class="nc" id="L67">			return autoGeneratedNo;</span>

<span class="nc bnc" id="L69" title="All 2 branches missed.">		} else if (monthForLastRecieptNo != month) {</span>
<span class="nc" id="L70">			autoGeneratedNo = startThreeDigitsForType + lastTwoDigitsYr</span>
					+ monthString + &quot;000001&quot;;
<span class="nc" id="L72">			return autoGeneratedNo;</span>

		}

<span class="nc" id="L76">		String lastGeneratedNumber = lastRecieptGenerated.substring(7);</span>
<span class="nc" id="L77">		int nextGeneratedNumber = Integer.parseInt(lastGeneratedNumber) + 1;</span>
<span class="nc" id="L78">		String nextGeneratedNumberString = &quot;&quot; + nextGeneratedNumber;</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">		while (nextGeneratedNumberString.length() &lt; lastGeneratedNumber</span>
				.length()) {
<span class="nc" id="L81">			nextGeneratedNumberString = &quot;0&quot; + nextGeneratedNumberString;</span>
<span class="nc" id="L82">			logger.debug(nextGeneratedNumberString);</span>
		}

		// make the whole reciept number

<span class="nc" id="L87">		autoGeneratedNo = startThreeDigitsForType + lastTwoDigitsYr</span>
				+ monthString + nextGeneratedNumberString;
<span class="nc" id="L89">		return autoGeneratedNo;</span>

	}

	public synchronized static String generateRequestIdSLE(String recieptType, Connection connection) throws LMSException {
<span class="nc" id="L94">		String autoGeneratedNo = null;</span>

<span class="nc" id="L96">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L97">		int month = cal.get(Calendar.MONTH) + 1;</span>
<span class="nc" id="L98">		int year = cal.get(Calendar.YEAR);</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">		String monthString = (month &lt; 10) ? (&quot;0&quot;+month) : String.valueOf(month);</span>

<span class="nc" id="L101">		String lastRecieptGenerated = null;</span>

<span class="nc" id="L103">		Statement stmt = null;</span>
<span class="nc" id="L104">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L106">			stmt = connection.createStatement();</span>
<span class="nc" id="L107">			String getLastReqNo = &quot;SELECT request_id FROM st_sle_approval_req_master ORDER BY request_id DESC LIMIT 1;&quot;;</span>
<span class="nc" id="L108">			rs = stmt.executeQuery(getLastReqNo);</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L110">				lastRecieptGenerated = rs.getString(&quot;request_id&quot;);</span>
			}
<span class="nc" id="L112">		} catch (SQLException se) {</span>
<span class="nc" id="L113">			se.printStackTrace();</span>
<span class="nc" id="L114">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE);</span>
<span class="nc" id="L115">		}</span>

<span class="nc" id="L117">		String lastTwoDigitsYr = String.valueOf(year).substring(2, 4);</span>
<span class="nc" id="L118">		String startThreeDigitsForType = recieptType.substring(0, 3);</span>

<span class="nc bnc" id="L120" title="All 2 branches missed.">		int monthForLastRecieptNo = (lastRecieptGenerated != null) ? Integer.parseInt(lastRecieptGenerated.substring(5, 7)) : 0;</span>

<span class="nc bnc" id="L122" title="All 2 branches missed.">		if (lastRecieptGenerated == null) {</span>
<span class="nc" id="L123">			autoGeneratedNo = startThreeDigitsForType + lastTwoDigitsYr + monthString + &quot;000001&quot;;</span>
<span class="nc" id="L124">			return autoGeneratedNo;</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">		} else if (monthForLastRecieptNo != month) {</span>
<span class="nc" id="L126">			autoGeneratedNo = startThreeDigitsForType + lastTwoDigitsYr + monthString + &quot;000001&quot;;</span>
<span class="nc" id="L127">			return autoGeneratedNo;</span>
		}

<span class="nc" id="L130">		String lastGeneratedNumber = lastRecieptGenerated.substring(7);</span>
<span class="nc" id="L131">		String nextGeneratedNumberString = String.valueOf(Integer.parseInt(lastGeneratedNumber) + 1);</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">		while (nextGeneratedNumberString.length() &lt; lastGeneratedNumber.length()) {</span>
<span class="nc" id="L133">			nextGeneratedNumberString = &quot;0&quot; + nextGeneratedNumberString;</span>
		}

<span class="nc" id="L136">		autoGeneratedNo = startThreeDigitsForType + lastTwoDigitsYr + monthString + nextGeneratedNumberString;</span>

<span class="nc" id="L138">		return autoGeneratedNo;</span>
	}

	public synchronized static String generateRequestIdDraw(String recieptType)
			throws LMSException {
<span class="nc" id="L143">		String autoGeneratedNo = null;</span>

<span class="nc" id="L145">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L146">		int year = cal.get(Calendar.YEAR);</span>
<span class="nc" id="L147">		int month = cal.get(Calendar.MONTH) + 1;</span>
<span class="nc" id="L148">		String monthString = null;</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">		if (month &lt; 10) {</span>
<span class="nc" id="L150">			monthString = &quot;0&quot; + month;</span>
		} else {
<span class="nc" id="L152">			monthString = &quot;&quot; + month;</span>
		}
<span class="nc" id="L154">		String lastRecieptGenerated = null;</span>
		// get the last request number generated
<span class="nc" id="L156">		Connection con = null;</span>
<span class="nc" id="L157">		Statement stmt = null;</span>
		try {
<span class="nc" id="L159">			con = DBConnect.getConnection();</span>
<span class="nc" id="L160">			stmt = con.createStatement();</span>
<span class="nc" id="L161">			String getLastReqNo = &quot;select request_id from st_dg_approval_req_master order by request_id desc limit 1 &quot;;</span>
<span class="nc" id="L162">			ResultSet rs = stmt.executeQuery(getLastReqNo);</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L164">				lastRecieptGenerated = rs.getString(&quot;request_id&quot;);</span>
			}
<span class="nc" id="L166">			DBConnect.closeCon(con);</span>
<span class="nc" id="L167">		} catch (SQLException e) {</span>
<span class="nc" id="L168">			e.printStackTrace();</span>
<span class="nc" id="L169">		}</span>

<span class="nc" id="L171">		String lastTwoDigitsYr = (&quot;&quot; + year).substring(2, 4);</span>
		// String oneCharOfUserType=userType.substring(0, 1);
		// get initial two digits for starting two digits of reciept type

<span class="nc" id="L175">		String startThreeDigitsForType = recieptType.substring(0, 3);</span>
<span class="nc" id="L176">		int monthForLastRecieptNo = 0;</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">		if (lastRecieptGenerated != null) {</span>
<span class="nc" id="L178">			monthForLastRecieptNo = Integer.parseInt(lastRecieptGenerated</span>
					.substring(5, 7));
		}

		// get last generated number

<span class="nc bnc" id="L184" title="All 2 branches missed.">		if (lastRecieptGenerated == null) {</span>

<span class="nc" id="L186">			autoGeneratedNo = startThreeDigitsForType + lastTwoDigitsYr</span>
					+ monthString + &quot;000001&quot;;
<span class="nc" id="L188">			return autoGeneratedNo;</span>

<span class="nc bnc" id="L190" title="All 2 branches missed.">		} else if (monthForLastRecieptNo != month) {</span>
<span class="nc" id="L191">			autoGeneratedNo = startThreeDigitsForType + lastTwoDigitsYr</span>
					+ monthString + &quot;000001&quot;;
<span class="nc" id="L193">			return autoGeneratedNo;</span>

		}

<span class="nc" id="L197">		String lastGeneratedNumber = lastRecieptGenerated.substring(7);</span>
<span class="nc" id="L198">		int nextGeneratedNumber = Integer.parseInt(lastGeneratedNumber) + 1;</span>
<span class="nc" id="L199">		String nextGeneratedNumberString = &quot;&quot; + nextGeneratedNumber;</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">		while (nextGeneratedNumberString.length() &lt; lastGeneratedNumber</span>
				.length()) {
<span class="nc" id="L202">			nextGeneratedNumberString = &quot;0&quot; + nextGeneratedNumberString;</span>
<span class="nc" id="L203">			logger.debug(nextGeneratedNumberString);</span>
		}

		// make the whole reciept number

<span class="nc" id="L208">		autoGeneratedNo = startThreeDigitsForType + lastTwoDigitsYr</span>
				+ monthString + nextGeneratedNumberString;
<span class="nc" id="L210">		return autoGeneratedNo;</span>

	}

	/*
	 * public synchronized static String getRecieptNoRet(String recieptType,
	 * String lastRecieptGenerated,String userType,int retOrgId) {
	 * 
	 * String autoGeneratedNo = null;
	 * 
	 * Calendar cal = Calendar.getInstance(); int year = cal.get(Calendar.YEAR);
	 * int month = cal.get(Calendar.MONTH) + 1; String monthString=null;
	 * if(month&lt;10){ monthString=&quot;0&quot;+month; } else monthString=&quot;&quot;+month;
	 * 
	 * 
	 * String lastTwoDigitsYr = (&quot;&quot; + year).substring(2, 4); String
	 * oneCharOfUserType=userType.substring(0, 1);
	 * 
	 * int digitsOfretOrgId=(&quot;&quot;+retOrgId).length();
	 * 
	 * //get initial two digits for starting two digits of reciept type
	 * 
	 * String startTwoDigitsForType = recieptType.substring(0, 2); int
	 * monthForLastRecieptNo=0; if(lastRecieptGenerated != null){
	 * monthForLastRecieptNo=Integer.parseInt(lastRecieptGenerated.substring(5+digitsOfretOrgId,
	 * 7+digitsOfretOrgId)); } logger.debug(&quot;cvxc &quot; +monthForLastRecieptNo); //
	 * get last generated number
	 * 
	 * if ((lastRecieptGenerated == null)) {
	 * 
	 * autoGeneratedNo = startTwoDigitsForType
	 * +oneCharOfUserType+retOrgId+lastTwoDigitsYr + monthString + &quot;00000001&quot;;
	 * return autoGeneratedNo; } else if(monthForLastRecieptNo != month){
	 * autoGeneratedNo = startTwoDigitsForType +oneCharOfUserType+retOrgId+
	 * lastTwoDigitsYr + monthString + &quot;00000001&quot;; return autoGeneratedNo; }
	 * 
	 * 
	 * 
	 * String lastGeneratedNumber =
	 * lastRecieptGenerated.substring(7+digitsOfretOrgId); int
	 * nextGeneratedNumber = Integer.parseInt(lastGeneratedNumber) + 1; String
	 * nextGeneratedNumberString = &quot;&quot; + nextGeneratedNumber; while
	 * (nextGeneratedNumberString.length() &lt; lastGeneratedNumber .length()) {
	 * nextGeneratedNumberString = &quot;0&quot; + nextGeneratedNumberString;
	 * logger.debug(nextGeneratedNumberString); }
	 * 
	 * //make the whole reciept number
	 * 
	 * autoGeneratedNo = startTwoDigitsForType +oneCharOfUserType+retOrgId+
	 * lastTwoDigitsYr + monthString + nextGeneratedNumberString;
	 * //logger.debug(&quot;generated reciept number is &quot; + autoGeneratedNo);
	 * 
	 * return autoGeneratedNo; }
	 */

	public synchronized static String getRecieptNo(String recieptType,
			String lastRecieptGenerated, String userType) {

<span class="nc" id="L268">		String autoGeneratedNo = null;</span>

<span class="nc" id="L270">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L271">		int year = cal.get(Calendar.YEAR);</span>
<span class="nc" id="L272">		int month = cal.get(Calendar.MONTH) + 1;</span>
<span class="nc" id="L273">		String monthString = null;</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">		if (month &lt; 10) {</span>
<span class="nc" id="L275">			monthString = &quot;0&quot; + month;</span>
		} else {
<span class="nc" id="L277">			monthString = &quot;&quot; + month;</span>
		}

<span class="nc" id="L280">		String lastTwoDigitsYr = (&quot;&quot; + year).substring(2, 4);</span>
<span class="nc" id="L281">		String oneCharOfUserType = userType.substring(0, 1);</span>
		// get initial two digits for starting two digits of reciept type

<span class="nc" id="L284">		String startTwoDigitsForType = recieptType.substring(0, 2);</span>
<span class="nc" id="L285">		int monthForLastRecieptNo = 0;</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">		if (lastRecieptGenerated != null) {</span>
<span class="nc" id="L287">			monthForLastRecieptNo = Integer.parseInt(lastRecieptGenerated</span>
					.substring(5, 7));

		}

		// get last generated number

<span class="nc bnc" id="L294" title="All 2 branches missed.">		if (lastRecieptGenerated == null) {</span>

<span class="nc" id="L296">			autoGeneratedNo = startTwoDigitsForType + oneCharOfUserType</span>
					+ lastTwoDigitsYr + monthString + &quot;000001&quot;;
<span class="nc" id="L298">			return autoGeneratedNo;</span>

<span class="nc bnc" id="L300" title="All 2 branches missed.">		} else if (monthForLastRecieptNo != month) {</span>
<span class="nc" id="L301">			autoGeneratedNo = startTwoDigitsForType + oneCharOfUserType</span>
					+ lastTwoDigitsYr + monthString + &quot;000001&quot;;
<span class="nc" id="L303">			return autoGeneratedNo;</span>

		}

<span class="nc" id="L307">		String lastGeneratedNumber = lastRecieptGenerated.substring(7);</span>
<span class="nc" id="L308">		int nextGeneratedNumber = Integer.parseInt(lastGeneratedNumber) + 1;</span>
<span class="nc" id="L309">		String nextGeneratedNumberString = &quot;&quot; + nextGeneratedNumber;</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">		while (nextGeneratedNumberString.length() &lt; lastGeneratedNumber</span>
				.length()) {
<span class="nc" id="L312">			nextGeneratedNumberString = &quot;0&quot; + nextGeneratedNumberString;</span>
<span class="nc" id="L313">			logger.debug(nextGeneratedNumberString);</span>
		}

		// make the whole reciept number

<span class="nc" id="L318">		autoGeneratedNo = startTwoDigitsForType + oneCharOfUserType</span>
				+ lastTwoDigitsYr + monthString + nextGeneratedNumberString;
		// logger.debug(&quot;generated reciept number is &quot; + autoGeneratedNo);

<span class="nc" id="L322">		return autoGeneratedNo;</span>

	}

	public synchronized static String getRecieptNoAgt(String recieptType,
			String lastRecieptGenerated, String userType, int agtOrgId) {

<span class="nc" id="L329">		String autoGeneratedNo = null;</span>

<span class="nc" id="L331">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L332">		int year = cal.get(Calendar.YEAR);</span>
<span class="nc" id="L333">		int month = cal.get(Calendar.MONTH) + 1;</span>
<span class="nc" id="L334">		String monthString = null;</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">		if (month &lt; 10) {</span>
<span class="nc" id="L336">			monthString = &quot;0&quot; + month;</span>
		} else {
<span class="nc" id="L338">			monthString = &quot;&quot; + month;</span>
		}

<span class="nc" id="L341">		String lastTwoDigitsYr = (&quot;&quot; + year).substring(2, 4);</span>
<span class="nc" id="L342">		String oneCharOfUserType = userType.substring(0, 1);</span>

<span class="nc" id="L344">		int digitsOfAgtOrgId = (&quot;&quot; + agtOrgId).length();</span>

		// get initial two digits for starting two digits of reciept type

<span class="nc" id="L348">		String startTwoDigitsForType = recieptType.substring(0, 2);</span>
<span class="nc" id="L349">		int monthForLastRecieptNo = 0;</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">		if (lastRecieptGenerated != null) {</span>
<span class="nc" id="L351">			monthForLastRecieptNo = Integer.parseInt(lastRecieptGenerated</span>
					.substring(5 + digitsOfAgtOrgId, 7 + digitsOfAgtOrgId));

		}
<span class="nc" id="L355">		logger.debug(lastRecieptGenerated + &quot;*last receipt gen**&quot; + month</span>
				+ &quot; Current Month cvxc &quot; + monthForLastRecieptNo + &quot;agent&quot;
				+ digitsOfAgtOrgId + &quot;orgid&quot; + agtOrgId);

		// get last generated number

<span class="nc bnc" id="L361" title="All 2 branches missed.">		if (lastRecieptGenerated == null) {</span>

<span class="nc" id="L363">			autoGeneratedNo = startTwoDigitsForType + oneCharOfUserType</span>
					+ agtOrgId + lastTwoDigitsYr + monthString + &quot;000001&quot;;
<span class="nc" id="L365">			return autoGeneratedNo;</span>

<span class="nc bnc" id="L367" title="All 2 branches missed.">		} else if (monthForLastRecieptNo != month) {</span>
<span class="nc" id="L368">			autoGeneratedNo = startTwoDigitsForType + oneCharOfUserType</span>
					+ agtOrgId + lastTwoDigitsYr + monthString + &quot;000001&quot;;
<span class="nc" id="L370">			return autoGeneratedNo;</span>

		}

<span class="nc" id="L374">		String lastGeneratedNumber = lastRecieptGenerated</span>
				.substring(7 + digitsOfAgtOrgId);
<span class="nc" id="L376">		int nextGeneratedNumber = Integer.parseInt(lastGeneratedNumber) + 1;</span>
<span class="nc" id="L377">		String nextGeneratedNumberString = &quot;&quot; + nextGeneratedNumber;</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">		while (nextGeneratedNumberString.length() &lt; lastGeneratedNumber</span>
				.length()) {
<span class="nc" id="L380">			nextGeneratedNumberString = &quot;0&quot; + nextGeneratedNumberString;</span>
<span class="nc" id="L381">			logger.debug(nextGeneratedNumberString);</span>
		}

		// make the whole reciept number

<span class="nc" id="L386">		autoGeneratedNo = startTwoDigitsForType + oneCharOfUserType + agtOrgId</span>
				+ lastTwoDigitsYr + monthString + nextGeneratedNumberString;
		// logger.debug(&quot;generated reciept number is &quot; + autoGeneratedNo);

<span class="nc" id="L390">		return autoGeneratedNo;</span>

	}

	public static void main(String args[]) {
<span class="nc" id="L395">		GenerateRecieptNo x = new GenerateRecieptNo();</span>
<span class="nc" id="L396">		logger.debug(GenerateRecieptNo.getRecieptNoAgt(&quot;INVOICE&quot;,</span>
				&quot;INA20901000001&quot;, &quot;AGENT&quot;, 288));

<span class="nc" id="L399">	}</span>

	public String generateReceipt(String receiptType, String receiptAtType,
			List&lt;Integer&gt; transIdList, int receiptAtOrgId,
			String lastRecieptGenerated, Connection connection) {

<span class="nc" id="L405">		String autoGeneratedNo = null;</span>

<span class="nc" id="L407">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L408">		int year = cal.get(Calendar.YEAR);</span>
<span class="nc" id="L409">		int month = cal.get(Calendar.MONTH) + 1;</span>
<span class="nc" id="L410">		String monthString = null;</span>
<span class="nc bnc" id="L411" title="All 2 branches missed.">		if (month &lt; 10) {</span>
<span class="nc" id="L412">			monthString = &quot;0&quot; + month;</span>
		} else {
<span class="nc" id="L414">			monthString = &quot;&quot; + month;</span>
		}

<span class="nc" id="L417">		String lastTwoDigitsYr = (&quot;&quot; + year).substring(2, 4);</span>
<span class="nc" id="L418">		String oneCharOfUserType = receiptAtType.substring(0, 1);</span>

<span class="nc" id="L420">		int digitsOfOrgId = (&quot;&quot; + receiptAtOrgId).length();</span>

		// get initial two digits for starting two digits of reciept type

<span class="nc" id="L424">		String startTwoDigitsForType = receiptType.substring(0, 2);</span>

<span class="nc" id="L426">		int monthForLastRecieptNo = 0;</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">		if (lastRecieptGenerated != null) {</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">			if (receiptAtType.equals(&quot;AGENT&quot;)) {</span>
<span class="nc" id="L429">				monthForLastRecieptNo = Integer.parseInt(lastRecieptGenerated</span>
						.substring(5 + digitsOfOrgId, 7 + digitsOfOrgId));
<span class="nc bnc" id="L431" title="All 2 branches missed.">			} else if (receiptAtType.equals(&quot;BO&quot;)) {</span>
<span class="nc" id="L432">				monthForLastRecieptNo = Integer.parseInt(lastRecieptGenerated</span>
						.substring(5, 7));
			}
		}
<span class="nc" id="L436">		logger.debug(&quot;month for which last receipt generated: &quot;</span>
				+ monthForLastRecieptNo);

		// get last generated number

<span class="nc bnc" id="L441" title="All 2 branches missed.">		if (lastRecieptGenerated == null) {</span>
<span class="nc bnc" id="L442" title="All 2 branches missed.">			if (receiptAtType.equals(&quot;AGENT&quot;)) {</span>
<span class="nc" id="L443">				autoGeneratedNo = startTwoDigitsForType + oneCharOfUserType</span>
						+ receiptAtOrgId + lastTwoDigitsYr + monthString
						+ &quot;000001&quot;;
<span class="nc bnc" id="L446" title="All 2 branches missed.">			} else if (receiptAtType.equals(&quot;BO&quot;)) {</span>
<span class="nc" id="L447">				autoGeneratedNo = startTwoDigitsForType + oneCharOfUserType</span>
						+ lastTwoDigitsYr + monthString + &quot;000001&quot;;
			}

<span class="nc" id="L451">			return autoGeneratedNo;</span>

<span class="nc bnc" id="L453" title="All 2 branches missed.">		} else if (monthForLastRecieptNo != month) {</span>
<span class="nc bnc" id="L454" title="All 2 branches missed.">			if (receiptAtType.equals(&quot;AGENT&quot;)) {</span>
<span class="nc" id="L455">				autoGeneratedNo = startTwoDigitsForType + oneCharOfUserType</span>
						+ digitsOfOrgId + lastTwoDigitsYr + monthString
						+ &quot;000001&quot;;
<span class="nc bnc" id="L458" title="All 2 branches missed.">			} else if (receiptAtType.equals(&quot;BO&quot;)) {</span>
<span class="nc" id="L459">				autoGeneratedNo = startTwoDigitsForType + oneCharOfUserType</span>
						+ lastTwoDigitsYr + monthString + &quot;000001&quot;;
			}

<span class="nc" id="L463">			return autoGeneratedNo;</span>

		}
<span class="nc" id="L466">		String lastGeneratedNumber = null;</span>
<span class="nc" id="L467">		String nextGeneratedNumberString = null;</span>

<span class="nc bnc" id="L469" title="All 2 branches missed.">		if (receiptAtType.equals(&quot;AGENT&quot;)) {</span>
<span class="nc" id="L470">			lastGeneratedNumber = lastRecieptGenerated</span>
					.substring(7 + digitsOfOrgId);
<span class="nc bnc" id="L472" title="All 2 branches missed.">		} else if (receiptAtType.equals(&quot;BO&quot;)) {</span>
<span class="nc" id="L473">			lastGeneratedNumber = lastRecieptGenerated.substring(7);</span>
		}

<span class="nc" id="L476">		int nextGeneratedNumber = Integer.parseInt(lastGeneratedNumber) + 1;</span>
<span class="nc" id="L477">		nextGeneratedNumberString = &quot;&quot; + nextGeneratedNumber;</span>

<span class="nc bnc" id="L479" title="All 2 branches missed.">		while (nextGeneratedNumberString.length() &lt; lastGeneratedNumber</span>
				.length()) {
<span class="nc" id="L481">			nextGeneratedNumberString = &quot;0&quot; + nextGeneratedNumberString;</span>
<span class="nc" id="L482">			logger.debug(nextGeneratedNumberString);</span>
		}

		// make the whole reciept number
<span class="nc bnc" id="L486" title="All 2 branches missed.">		if (receiptAtType.equals(&quot;AGENT&quot;)) {</span>
<span class="nc" id="L487">			autoGeneratedNo = startTwoDigitsForType + oneCharOfUserType</span>
					+ digitsOfOrgId + lastTwoDigitsYr + monthString
					+ nextGeneratedNumberString;
<span class="nc bnc" id="L490" title="All 2 branches missed.">		} else if (receiptAtType.equals(&quot;BO&quot;)) {</span>
<span class="nc" id="L491">			autoGeneratedNo = startTwoDigitsForType + oneCharOfUserType</span>
					+ lastTwoDigitsYr + monthString + nextGeneratedNumberString;
		}
		// logger.debug(&quot;generated reciept number is &quot; + autoGeneratedNo);
<span class="nc" id="L495">		return autoGeneratedNo;</span>
	}
	
	public synchronized static String generateRequestIdIW(String recieptType, Connection connection) throws LMSException {
<span class="nc" id="L499">		String autoGeneratedNo = null;</span>

<span class="nc" id="L501">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L502">		int month = cal.get(Calendar.MONTH) + 1;</span>
<span class="nc" id="L503">		int year = cal.get(Calendar.YEAR);</span>
<span class="nc bnc" id="L504" title="All 2 branches missed.">		String monthString = (month &lt; 10) ? (&quot;0&quot;+month) : String.valueOf(month);</span>

<span class="nc" id="L506">		String lastRecieptGenerated = null;</span>

<span class="nc" id="L508">		Statement stmt = null;</span>
<span class="nc" id="L509">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L511">			stmt = connection.createStatement();</span>
<span class="nc" id="L512">			String getLastReqNo = &quot;SELECT request_id FROM st_iw_approval_req_master ORDER BY request_id DESC LIMIT 1;&quot;;</span>
<span class="nc" id="L513">			rs = stmt.executeQuery(getLastReqNo);</span>
<span class="nc bnc" id="L514" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L515">				lastRecieptGenerated = rs.getString(&quot;request_id&quot;);</span>
			}
<span class="nc" id="L517">		} catch (SQLException se) {</span>
<span class="nc" id="L518">			se.printStackTrace();</span>
<span class="nc" id="L519">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE);</span>
<span class="nc" id="L520">		}</span>

<span class="nc" id="L522">		String lastTwoDigitsYr = String.valueOf(year).substring(2, 4);</span>
<span class="nc" id="L523">		String startThreeDigitsForType = recieptType.substring(0, 3);</span>

<span class="nc bnc" id="L525" title="All 2 branches missed.">		int monthForLastRecieptNo = (lastRecieptGenerated != null) ? Integer.parseInt(lastRecieptGenerated.substring(5, 7)) : 0;</span>

<span class="nc bnc" id="L527" title="All 2 branches missed.">		if (lastRecieptGenerated == null) {</span>
<span class="nc" id="L528">			autoGeneratedNo = startThreeDigitsForType + lastTwoDigitsYr + monthString + &quot;000001&quot;;</span>
<span class="nc" id="L529">			return autoGeneratedNo;</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">		} else if (monthForLastRecieptNo != month) {</span>
<span class="nc" id="L531">			autoGeneratedNo = startThreeDigitsForType + lastTwoDigitsYr + monthString + &quot;000001&quot;;</span>
<span class="nc" id="L532">			return autoGeneratedNo;</span>
		}

<span class="nc" id="L535">		String lastGeneratedNumber = lastRecieptGenerated.substring(7);</span>
<span class="nc" id="L536">		String nextGeneratedNumberString = String.valueOf(Integer.parseInt(lastGeneratedNumber) + 1);</span>
<span class="nc bnc" id="L537" title="All 2 branches missed.">		while (nextGeneratedNumberString.length() &lt; lastGeneratedNumber.length()) {</span>
<span class="nc" id="L538">			nextGeneratedNumberString = &quot;0&quot; + nextGeneratedNumberString;</span>
		}

<span class="nc" id="L541">		autoGeneratedNo = startThreeDigitsForType + lastTwoDigitsYr + monthString + nextGeneratedNumberString;</span>

<span class="nc" id="L543">		return autoGeneratedNo;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>