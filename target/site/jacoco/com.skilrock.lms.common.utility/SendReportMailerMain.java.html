<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SendReportMailerMain.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.common.utility</a> &gt; <span class="el_source">SendReportMailerMain.java</span></div><h1>SendReportMailerMain.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.common.utility;

import java.io.File;
import java.io.IOException;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Timestamp;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;
import java.util.TreeMap;

import javax.servlet.ServletContext;

import jxl.write.WriteException;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.struts2.ServletActionContext;

import com.skilrock.lms.beans.AgentCollectionReportOverAllBean;
import com.skilrock.lms.beans.BodyText;
import com.skilrock.lms.beans.CSSaleReportBean;
import com.skilrock.lms.beans.CashChqReportBean;
import com.skilrock.lms.beans.CollectionReportBean;
import com.skilrock.lms.beans.CollectionReportOverAllBean;
import com.skilrock.lms.beans.CompleteCollectionBean;
import com.skilrock.lms.beans.DateBeans;
import com.skilrock.lms.beans.EmailReportBean;
import com.skilrock.lms.beans.ReportStatusBean;
import com.skilrock.lms.beans.SalePwtReportsBean;
import com.skilrock.lms.beans.SaleReportBean;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.Utility;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.filter.LMSFilterDispatcher;
import com.skilrock.lms.coreEngine.commercialService.reportMgmt.CSSaleReportHelper;
import com.skilrock.lms.coreEngine.commercialService.reportMgmt.CSSaleReportHelperSP;
import com.skilrock.lms.coreEngine.commercialService.reportMgmt.CSSaleReportIF;
import com.skilrock.lms.coreEngine.drawGames.drawMgmt.DrawGameMgmtHelper;
import com.skilrock.lms.coreEngine.drawGames.reportMgmt.DrawPwtReportHelper;
import com.skilrock.lms.coreEngine.drawGames.reportMgmt.DrawPwtReportHelperSP;
import com.skilrock.lms.coreEngine.drawGames.reportMgmt.DrawSaleReportHelper;
import com.skilrock.lms.coreEngine.drawGames.reportMgmt.DrawSaleReportHelperSP;
import com.skilrock.lms.coreEngine.drawGames.reportMgmt.IDrawPwtReportHelper;
import com.skilrock.lms.coreEngine.drawGames.reportMgmt.IDrawSaleReportHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.AgentCollectionReportOverAllHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.CashChqReportsAgentHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.CashChqReportsAgentHelperSP;
import com.skilrock.lms.coreEngine.reportsMgmt.common.CashChqReportsHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.CashChqReportsHelperSP;
import com.skilrock.lms.coreEngine.reportsMgmt.common.CollectionReportAgentHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.CollectionReportHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.CollectionReportOverAllHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.CollectionReportOverAllHelperSP;
import com.skilrock.lms.coreEngine.reportsMgmt.common.CompleteCollectionReportHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.CompleteCollectionReportHelperSP;
import com.skilrock.lms.coreEngine.reportsMgmt.common.ICashChqReportsAgentHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.ICashChqReportsHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.ICollectionReportOverAllHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.ICompleteCollectionReportHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.OrganizationTerminateReportHelper;
import com.skilrock.lms.coreEngine.reportsMgmt.common.RetActivityReportHelper;
import com.skilrock.lms.coreEngine.scratchService.reportsMgmt.common.ISaleReportsAgentHelper;
import com.skilrock.lms.coreEngine.scratchService.reportsMgmt.common.IScratchPwtReportHelper;
import com.skilrock.lms.coreEngine.scratchService.reportsMgmt.common.IScratchSaleReportHelper;
import com.skilrock.lms.coreEngine.scratchService.reportsMgmt.common.SaleReportsAgentHelper;
import com.skilrock.lms.coreEngine.scratchService.reportsMgmt.common.SaleReportsAgentHelperSP;
import com.skilrock.lms.coreEngine.scratchService.reportsMgmt.common.ScratchPwtReportHelper;
import com.skilrock.lms.coreEngine.scratchService.reportsMgmt.common.ScratchPwtReportHelperSP;
import com.skilrock.lms.coreEngine.scratchService.reportsMgmt.common.ScratchSaleReportHelper;
import com.skilrock.lms.coreEngine.scratchService.reportsMgmt.common.ScratchSaleReportHelperSP;
import com.skilrock.lms.dge.beans.DrawDataBean;
import com.skilrock.lms.dge.beans.ReportBeanDrawModule;
import com.skilrock.lms.dge.beans.ReportDrawBean;
import com.skilrock.lms.scheduler.MailBean;
import com.skilrock.lms.web.drawGames.common.Util;

public class SendReportMailerMain {

<span class="nc" id="L91">	static Log logger = LogFactory.getLog(SendReportMailerMain.class);</span>

	public static void main(String args[]) throws SQLException {
		// dailySaleReport();
<span class="nc" id="L95">	}</span>

<span class="nc" id="L97">	private List&lt;CollectionReportBean&gt; agtList = null;</span>
<span class="nc" id="L98">	private Map&lt;Integer, List&lt;CollectionReportBean&gt;&gt; bigMap = new TreeMap&lt;Integer, List&lt;CollectionReportBean&gt;&gt;();</span>
<span class="nc" id="L99">	private Connection con = null;</span>
<span class="nc" id="L100">	private DateBeans dateBeans = null;</span>
<span class="nc" id="L101">	private boolean isDraw = false;</span>
<span class="nc" id="L102">	private boolean isScratch = true;</span>
<span class="nc" id="L103">	private boolean isCS = false;</span>
<span class="nc" id="L104">	private boolean isOLA = false;</span>

<span class="nc" id="L106">	public SendReportMailerMain(DateBeans datebean) {</span>
<span class="nc" id="L107">		this.dateBeans = datebean;</span>

<span class="nc" id="L109">	}</span>

<span class="nc" id="L111">	public SendReportMailerMain() {</span>
<span class="nc" id="L112">	}</span>

	/**
	 * this method added the list of BO recipients into the list
	 * 
	 * @param bean
	 * @throws LMSException
	 */
	private void addBORecipient(MailBean bean, String type) throws LMSException {
		try {
			// PreparedStatement
			// pstmtt=con.prepareStatement(QueryManager.getST_REPORT_MAIL_SCHEDULER_GET_BO_EMAILID());
<span class="nc" id="L124">			PreparedStatement pstmtt = con</span>
					.prepareStatement(&quot;select distinct(aa.user_id),ref_user_id, email_id, &quot;
							+ &quot;first_name, last_name from st_lms_report_email_priv_master aa, st_lms_report_email_priviledge_rep bb, &quot;
							+ &quot;st_lms_report_email_user_master cc where cc.user_id = aa.user_id and aa.email_pid = bb.email_pid&quot;
							+ &quot; and cc.organization_type='BO' and  (aa.status='ACTIVE' and bb.status='ACTIVE' and &quot;
							+ &quot;cc.status ='ACTIVE') and bb.priv_title like '%&quot;
							+ type + &quot;%'&quot;);
<span class="nc" id="L131">			System.out</span>
					.println(&quot;query to get recipient email list == &quot; + pstmtt);
<span class="nc" id="L133">			ResultSet results = pstmtt.executeQuery();</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">			while (results.next()) {</span>
<span class="nc" id="L135">				bean.to.add(results.getString(&quot;email_id&quot;).trim());</span>
			}
<span class="nc" id="L137">			System.out.println(&quot;back office email list == &quot; + bean.to);</span>
<span class="nc" id="L138">		} catch (SQLException e) {</span>
<span class="nc" id="L139">			e.printStackTrace();</span>
<span class="nc" id="L140">			throw new LMSException(e);</span>
<span class="nc" id="L141">		}</span>
<span class="nc" id="L142">	}</span>

	/**
	 * This method call the helpers ( sale Report Helper ,Cash Chq Report Helper
	 * and PWT Report Helper ) , get the data and created the excel file. mail
	 * 
	 * @param fileName
	 * @throws LMSException
	 * @throws SQLException
	 */
	private void createXLSSheet(String fileName, double boDirPlrPwtForScratch,
			double boDirPlrPwtForDraw, Timestamp startDate, Timestamp endDate)
			throws LMSException, SQLException {
		try {

<span class="nc" id="L157">			ICompleteCollectionReportHelper helper = null;</span>
<span class="nc" id="L158">			IDrawSaleReportHelper drawSalehelper = null;</span>
<span class="nc" id="L159">			IDrawPwtReportHelper drawPwthelper = null;</span>
<span class="nc" id="L160">			IScratchSaleReportHelper scratchSalehelper = null;</span>
<span class="nc" id="L161">			IScratchPwtReportHelper scratchPwthelper = null;</span>
<span class="nc" id="L162">			CSSaleReportIF csSaleHelper = null;</span>
<span class="nc" id="L163">			List&lt;SalePwtReportsBean&gt; drawSaleReportList = null;</span>
<span class="nc" id="L164">			List&lt;SalePwtReportsBean&gt; drawPwtReportList = null;</span>
<span class="nc" id="L165">			List&lt;SalePwtReportsBean&gt; scratchSaleReportList = null;</span>
<span class="nc" id="L166">			List&lt;SalePwtReportsBean&gt; scratchPwtReportList = null;</span>
<span class="nc" id="L167">			List&lt;CSSaleReportBean&gt; csSaleReportList = null;</span>

<span class="nc bnc" id="L169" title="All 2 branches missed.">			if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L170">				helper = new CompleteCollectionReportHelperSP();</span>
<span class="nc" id="L171">				drawSalehelper = new DrawSaleReportHelperSP();</span>
<span class="nc" id="L172">				drawPwthelper = new DrawPwtReportHelperSP();</span>
<span class="nc" id="L173">				scratchSalehelper = new ScratchSaleReportHelperSP();</span>
<span class="nc" id="L174">				scratchPwthelper = new ScratchPwtReportHelperSP();</span>
<span class="nc" id="L175">				csSaleHelper = new CSSaleReportHelperSP();</span>
			} else {
<span class="nc" id="L177">				helper = new CompleteCollectionReportHelper();</span>
<span class="nc" id="L178">				drawSalehelper = new DrawSaleReportHelper();</span>
<span class="nc" id="L179">				drawPwthelper = new DrawPwtReportHelper();</span>
<span class="nc" id="L180">				scratchSalehelper = new ScratchSaleReportHelper();</span>
<span class="nc" id="L181">				scratchPwthelper = new ScratchPwtReportHelper();</span>
<span class="nc" id="L182">				csSaleHelper = new CSSaleReportHelper();</span>
			}

<span class="nc bnc" id="L185" title="All 2 branches missed.">			boolean isDraw = LMSFilterDispatcher.getIsDraw().equalsIgnoreCase(</span>
					&quot;yes&quot;) ? true : false;
<span class="nc bnc" id="L187" title="All 2 branches missed.">			boolean isScratch = LMSFilterDispatcher.getIsScratch()</span>
					.equalsIgnoreCase(&quot;yes&quot;) ? true : false;
<span class="nc bnc" id="L189" title="All 2 branches missed.">			boolean isCS = LMSFilterDispatcher.getIsCS()</span>
					.equalsIgnoreCase(&quot;yes&quot;) ? true : false;
<span class="nc bnc" id="L191" title="All 2 branches missed.">			boolean isOLA = LMSFilterDispatcher.getIsOLA().equalsIgnoreCase(</span>
					&quot;yes&quot;) ? true : false;
			// for GAME WISE/PRODUCT WISE/WALLET WISE

<span class="nc bnc" id="L195" title="All 2 branches missed.">			if (isDraw) {</span>
<span class="nc" id="L196">				drawSaleReportList = drawSalehelper.drawSaleGameWise(startDate,</span>
						endDate);
<span class="nc" id="L198">				drawPwtReportList = drawPwthelper.drawPwtGameWise(startDate,</span>
						endDate);
			}
<span class="nc bnc" id="L201" title="All 2 branches missed.">			if (isScratch) {</span>
<span class="nc" id="L202">				scratchSaleReportList = scratchSalehelper.scratchSaleGameWise(</span>
						startDate, endDate);
<span class="nc" id="L204">				scratchPwtReportList = scratchPwthelper.scratchPwtGameWise(</span>
						startDate, endDate);
			}
<span class="nc bnc" id="L207" title="All 2 branches missed.">			if (isCS) {</span>
<span class="nc" id="L208">				csSaleReportList = csSaleHelper.CSSaleCategoryWise(startDate,</span>
						endDate);
			}
<span class="nc bnc" id="L211" title="All 2 branches missed.">			if (isOLA) {</span>
				// Code For OLA
			}

<span class="nc" id="L215">			dateBeans.setLastdate(new java.sql.Date(GetDate.getNextDayDate(</span>
					dateBeans.getLastdate()).getTime()));
<span class="nc" id="L217">			CashChqReportsHelper cashChqHelper = new CashChqReportsHelper(</span>
					dateBeans);
<span class="nc" id="L219">			List&lt;Integer&gt; agtOrgIdList = cashChqHelper.getAgentOrgList();</span>
<span class="nc" id="L220">			List&lt;CashChqReportBean&gt; cashChqList = null;</span>
<span class="nc" id="L221">			OrganizationTerminateReportHelper.getTerminateAgentListForRep(</span>
					new Timestamp(dateBeans.getStartDate().getTime()),
					new Timestamp(dateBeans.getEndDate().getTime()));
<span class="nc" id="L224">			List&lt;Integer&gt; terminateAgentList = OrganizationTerminateReportHelper.AgentOrgIdIntTypeList;</span>
<span class="nc" id="L225">			System.out.println(&quot;Terminate agent List::&quot; + terminateAgentList);</span>
<span class="nc" id="L226">			agtOrgIdList.removeAll(terminateAgentList);</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">			if (!agtOrgIdList.isEmpty()) {</span>
<span class="nc" id="L228">				cashChqList = cashChqHelper.getCashChqDetail(agtOrgIdList, -1,</span>
						true);
			}
<span class="nc" id="L231">			dateBeans.setLastdate(new java.sql.Date(dateBeans.getLastdate()</span>
					.getTime()
					- 24 * 60 * 60 * 1000));
<span class="nc" id="L234">			Map&lt;String, CompleteCollectionBean&gt; reportMapAgentWise = helper</span>
					.collectionReport(startDate, endDate, &quot;Agent Wise&quot;);

<span class="nc" id="L237">			ReportMailExl exl = new ReportMailExl(fileName, dateBeans);</span>
<span class="nc" id="L238">			exl.CreateXLSFile(reportMapAgentWise, drawSaleReportList,</span>
					drawPwtReportList, scratchSaleReportList,
					scratchPwtReportList, csSaleReportList, cashChqList,
					boDirPlrPwtForDraw, boDirPlrPwtForScratch);

<span class="nc" id="L243">		} catch (WriteException e) {</span>
<span class="nc" id="L244">			e.printStackTrace();</span>
<span class="nc" id="L245">			throw new LMSException(e);</span>
<span class="nc" id="L246">		} catch (IOException e) {</span>
<span class="nc" id="L247">			e.printStackTrace();</span>
<span class="nc" id="L248">			throw new LMSException(e);</span>
<span class="nc" id="L249">		} catch (ParseException e) {</span>
<span class="nc" id="L250">			e.printStackTrace();</span>
<span class="nc" id="L251">		}</span>

<span class="nc" id="L253">	}</span>

	private int getActiveAgentCount() {
<span class="nc" id="L256">		int agtCount = 0;</span>
<span class="nc" id="L257">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L259">			this.con = DBConnect.getConnection();</span>
<span class="nc" id="L260">			PreparedStatement pstmt = con</span>
					.prepareStatement(&quot;select count(*) as agt_count from st_lms_organization_master where organization_status = 'ACTIVE' and organization_type = 'AGENT'&quot;);
<span class="nc" id="L262">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L264">				agtCount = rs.getInt(&quot;agt_count&quot;);</span>
			}
<span class="nc" id="L266">		} catch (SQLException e) {</span>
<span class="nc" id="L267">			e.printStackTrace();</span>
<span class="nc" id="L268">		}</span>
<span class="nc" id="L269">		return agtCount;</span>
	}

	private int getActiveAgtCount() {
<span class="nc" id="L273">		int AgtCount = 0;</span>
<span class="nc" id="L274">		return AgtCount;</span>
	}

	private int getActiveRetailerCount(int agtOrgId) {
<span class="nc" id="L278">		int retCount = 0;</span>
<span class="nc" id="L279">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L281">			this.con = DBConnect.getConnection();</span>
<span class="nc" id="L282">			PreparedStatement pstmt = con</span>
					.prepareStatement(&quot;select count(*) as ret_count from st_lms_organization_master where organization_status = 'ACTIVE' and organization_type = 'RETAILER' and parent_id=?&quot;);
<span class="nc" id="L284">			pstmt.setInt(1, agtOrgId);</span>
<span class="nc" id="L285">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L287">				retCount = rs.getInt(&quot;ret_count&quot;);</span>
			}
<span class="nc" id="L289">		} catch (SQLException e) {</span>
<span class="nc" id="L290">			e.printStackTrace();</span>
<span class="nc" id="L291">		}</span>
<span class="nc" id="L292">		return retCount;</span>
	}

	public void getDailyCollections(String orgType, Timestamp deplDate,
			String Type) {

<span class="nc" id="L298">		Map&lt;String, String&gt; lastRowMap = null;</span>
<span class="nc" id="L299">		Map&lt;Integer, Double&gt; mapForOpenBal = null;</span>
		// get the list of BO details from database using helper
<span class="nc bnc" id="L301" title="All 2 branches missed.">		if (&quot;BO&quot;.equalsIgnoreCase(orgType)) {</span>
<span class="nc" id="L302">			logger.debug(&quot;start date is this:&quot; + dateBeans.getFirstdate()</span>
					+ &quot;end date is this:&quot; + dateBeans.getLastdate());
<span class="nc" id="L304">			CollectionReportHelper boHelper = new CollectionReportHelper(</span>
					dateBeans);
<span class="nc" id="L306">			mapForOpenBal = boHelper.getAgentOpeningBalance(boHelper</span>
					.getAgentOrgId(), this.isDraw, this.isScratch, this.isCS,
					deplDate);
<span class="nc" id="L309">			this.agtList = boHelper.getBOCollectionDetail(boHelper</span>
					.getAgentOrgId(), this.isDraw, this.isScratch, this.isCS,
					false);
<span class="nc" id="L312">			this.agtList = boHelper.MergeOpenBal(this.agtList, mapForOpenBal);</span>
			// logger.debug(mapForOpenBal);
<span class="nc" id="L314">		}</span>
		// get the list of AGENT details from database using helper
		else {
			try {
<span class="nc" id="L318">				this.con = DBConnect.getConnection();</span>
<span class="nc" id="L319">				PreparedStatement pstmt = con</span>
						.prepareStatement(&quot;select organization_id, name from st_lms_organization_master where organization_type='AGENT'&quot;);
<span class="nc" id="L321">				ResultSet rs = pstmt.executeQuery();</span>
<span class="nc" id="L322">				List&lt;CollectionReportBean&gt; retList = null;</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L324">					UserInfoBean infoBean = new UserInfoBean();</span>
<span class="nc" id="L325">					infoBean.setOrgName(rs.getString(&quot;name&quot;));</span>
<span class="nc" id="L326">					infoBean.setUserOrgId(rs.getInt(&quot;organization_id&quot;));</span>
<span class="nc" id="L327">					CollectionReportAgentHelper boHelper = new CollectionReportAgentHelper(</span>
							infoBean, dateBeans);
<span class="nc" id="L329">					mapForOpenBal = boHelper.getRetailerOpeningBalance(boHelper</span>
							.getRetailerOrgId(), this.isDraw, this.isScratch,
							this.isOLA, this.isCS, deplDate);
<span class="nc" id="L332">					retList = boHelper.getAgentCollectionDetail(boHelper</span>
							.getRetailerOrgId(), this.isOLA, this.isCS,
							this.isDraw, this.isScratch, false);
<span class="nc" id="L335">					retList = boHelper.MergeOpenBal(retList, mapForOpenBal);</span>
<span class="nc" id="L336">					bigMap.put(infoBean.getUserOrgId(), retList);</span>
<span class="nc" id="L337">				}</span>
<span class="nc" id="L338">			} catch (Exception e) {</span>
<span class="nc" id="L339">				e.printStackTrace();</span>
<span class="nc" id="L340">			}</span>
		}

<span class="nc" id="L343">	}</span>

	private synchronized MailBean mailToAgent(Connection con,
			String reportType, String emailId, int agentUserId, int agentOrgId,
			CollectionReportOverAllBean collectionReportOverAllBean)
			throws LMSException {

<span class="nc" id="L350">		MailBean mail = new MailBean();</span>
<span class="nc" id="L351">		mail.boTextBody = &quot;LMS Report from   &quot;</span>
				+ dateBeans.getFirstdate().toString().substring(8, 10) + '-'
				+ dateBeans.getFirstdate().toString().substring(5, 7) + '-'
				+ dateBeans.getFirstdate().toString().substring(0, 4) + &quot; TO &quot;
				+ dateBeans.getLastdate().toString().substring(8, 10) + '-'
				+ dateBeans.getLastdate().toString().substring(5, 7) + '-'
				+ dateBeans.getLastdate().toString().substring(0, 4);
<span class="nc bnc" id="L358" title="All 2 branches missed.">		if (&quot;Current Day&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc" id="L359">			mail.subject = BodyText.DAILY_SUBJECT;</span>
<span class="nc" id="L360">			mail.AGENT_FILE_NAME = mail.AGENT_FILE_NAME + &quot;AGENT_&quot;</span>
					+ agentUserId + BodyText.DAILY_FILE;
<span class="nc bnc" id="L362" title="All 2 branches missed.">		} else if (&quot;Current Week&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc" id="L363">			mail.subject = BodyText.WEEKLY_SUBJECT;</span>
<span class="nc" id="L364">			mail.AGENT_FILE_NAME = mail.AGENT_FILE_NAME + &quot;AGENT_&quot;</span>
					+ agentUserId + BodyText.WEEKLY_FILE;
<span class="nc bnc" id="L366" title="All 2 branches missed.">		} else if (&quot;Current Month&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc" id="L367">			mail.subject = BodyText.MONTHLY_SUBJECT;</span>
<span class="nc" id="L368">			mail.AGENT_FILE_NAME = mail.AGENT_FILE_NAME + &quot;AGENT_&quot;</span>
					+ agentUserId + BodyText.MONTHLY_FILE;
		} else {
<span class="nc" id="L371">			mail.subject = &quot;LMS Report From &quot; + this.dateBeans.getFirstdate()</span>
					+ &quot; To &quot; + this.dateBeans.getLastdate();
<span class="nc" id="L373">			mail.AGENT_FILE_NAME = mail.AGENT_FILE_NAME + &quot;AGENT_&quot;</span>
					+ agentUserId + &quot;_&quot; + dateBeans.getLastdate() + &quot;_&quot;
					+ BodyText.DATE_WISE_FILE;
		}
<span class="nc" id="L377">		System.out.println(&quot;File Name----------------------------------------&quot;</span>
				+ mail.AGENT_FILE_NAME);

		try {
<span class="nc" id="L381">			UserInfoBean userbean = new UserInfoBean();</span>
<span class="nc" id="L382">			userbean.setUserId(agentUserId);</span>
<span class="nc" id="L383">			userbean.setUserOrgId(agentOrgId);</span>
<span class="nc" id="L384">			SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L385">			Timestamp startDate = new Timestamp(sdf.parse(</span>
					sdf.format(dateBeans.getFirstdate())).getTime());
<span class="nc" id="L387">			Timestamp endDate = new Timestamp(sdf.parse(</span>
					sdf.format(dateBeans.getLastdate())).getTime());
<span class="nc" id="L389">			SimpleDateFormat depDateFormat = new SimpleDateFormat(</span>
					(String) ServletActionContext.getServletContext()
							.getAttribute(&quot;date_format&quot;));
<span class="nc" id="L392">			Timestamp deplDate = new Timestamp(depDateFormat.parse(</span>
					(String) ServletActionContext.getServletContext()
							.getAttribute(&quot;DEPLOYMENT_DATE&quot;)).getTime());

<span class="nc" id="L396">			Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L397">			cal.setTime(endDate);</span>
<span class="nc" id="L398">			cal.add(Calendar.HOUR, 23);</span>
<span class="nc" id="L399">			cal.add(Calendar.MINUTE, 59);</span>
<span class="nc" id="L400">			cal.add(Calendar.SECOND, 59);</span>
<span class="nc" id="L401">			endDate = new Timestamp(cal.getTime().getTime());</span>

			/*
			 * or For End Date endDate = new Timestamp((new
			 * SimpleDateFormat(dateFormat)).parse( end_Date).getTime() + 24 *
			 * 60 * 60 * 1000 - 1000);
			 */

<span class="nc" id="L409">			this.con = DBConnect.getConnection();</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">			boolean isDraw = LMSFilterDispatcher.getIsDraw().equalsIgnoreCase(</span>
					&quot;yes&quot;) ? true : false;
<span class="nc bnc" id="L412" title="All 2 branches missed.">			boolean isScratch = LMSFilterDispatcher.getIsScratch()</span>
					.equalsIgnoreCase(&quot;yes&quot;) ? true : false;
<span class="nc bnc" id="L414" title="All 2 branches missed.">			boolean isCS = LMSFilterDispatcher.getIsCS()</span>
					.equalsIgnoreCase(&quot;yes&quot;) ? true : false;
<span class="nc bnc" id="L416" title="All 2 branches missed.">			boolean isOLA = LMSFilterDispatcher.getIsOLA().equalsIgnoreCase(</span>
					&quot;yes&quot;) ? true : false;
<span class="nc" id="L418">			Double totalDrawSale = 0.0;</span>
<span class="nc" id="L419">			Double totalScratchSale = 0.0;</span>
<span class="nc" id="L420">			Double totalDrawPwt = 0.0;</span>
<span class="nc" id="L421">			Double totalScratchPwt = 0.0;</span>
<span class="nc" id="L422">			Double netPayment = 0.0;</span>
<span class="nc" id="L423">			Double totalCSSale = 0.0;</span>
<span class="nc" id="L424">			Double totalOLAWithdraw = 0.0;</span>
<span class="nc" id="L425">			Double totalOLADeposit = 0.0;</span>
<span class="nc" id="L426">			Double totalOLANetGamming = 0.0;</span>
<span class="nc" id="L427">			Double totalExpenseForRetailer = 0.0;</span>
<span class="nc" id="L428">			Double totalExpenseAtBo = 0.0;</span>
<span class="nc" id="L429">			double netPaymentsAtBo = 0.0;</span>
<span class="nc" id="L430">			double netDgSaleAtBo = 0.0;</span>
<span class="nc" id="L431">			double netDgPwtAtBo = 0.0;</span>
<span class="nc" id="L432">			double netSeSaleAtBo = 0.0;</span>
<span class="nc" id="L433">			double netSePwtAtBo = 0.0;</span>
<span class="nc" id="L434">			double netCsSaleAtBo = 0.0;</span>
<span class="nc" id="L435">			double netOlaDepAtBo = 0.0;</span>
<span class="nc" id="L436">			double netOlaWithAtBo = 0.0;</span>
<span class="nc" id="L437">			double netOlaNetGameAtBo = 0.0;</span>
<span class="nc" id="L438">			PreparedStatement pstmt1 = null;</span>
<span class="nc" id="L439">			ResultSet rs1 = null;</span>

<span class="nc bnc" id="L441" title="All 2 branches missed.">			if (&quot;Current Day&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc" id="L442">				pstmt1 = con</span>
						.prepareStatement(&quot;select count(*)as logged_users from st_lms_user_master where organization_type='RETAILER' and parent_user_id = ? and date(last_login_date) =?&quot;);
<span class="nc" id="L444">				pstmt1.setInt(1, agentUserId);</span>
<span class="nc" id="L445">				pstmt1.setDate(2, dateBeans.getFirstdate());</span>
<span class="nc" id="L446">				rs1 = pstmt1.executeQuery();</span>
			}

<span class="nc" id="L449">			ICompleteCollectionReportHelper dgScSalePwtRetWiseHelper = null;</span>
<span class="nc" id="L450">			CSSaleReportIF csSaleRetWiseHelper = null;</span>

<span class="nc" id="L452">			IDrawSaleReportHelper drawSaleGameWiseHelperForAgent = null;</span>
<span class="nc" id="L453">			IDrawPwtReportHelper drawPwtGameWiseHelperForAgent = null;</span>

<span class="nc" id="L455">			IScratchSaleReportHelper scratchSaleGameWiseForAgent = null;</span>
<span class="nc" id="L456">			IScratchPwtReportHelper scratchPwtGameWiseForAgent = null;</span>

<span class="nc" id="L458">			ISaleReportsAgentHelper scratchPurchaseDetailsWithBo = null;</span>

<span class="nc" id="L460">			ICashChqReportsAgentHelper agentCashChqHelper = null;</span>

<span class="nc" id="L462">			UserInfoBean infoBean = new UserInfoBean();</span>
<span class="nc" id="L463">			infoBean.setUserId(agentUserId);</span>
<span class="nc" id="L464">			infoBean.setUserOrgId(agentOrgId);</span>

<span class="nc bnc" id="L466" title="All 2 branches missed.">			if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L467">				dgScSalePwtRetWiseHelper = new CompleteCollectionReportHelperSP();</span>
<span class="nc" id="L468">				csSaleRetWiseHelper = new CSSaleReportHelperSP();</span>
<span class="nc" id="L469">				scratchSaleGameWiseForAgent = new ScratchSaleReportHelperSP();</span>
<span class="nc" id="L470">				drawSaleGameWiseHelperForAgent = new DrawSaleReportHelperSP();</span>
<span class="nc" id="L471">				drawPwtGameWiseHelperForAgent = new DrawPwtReportHelperSP();</span>
<span class="nc" id="L472">				scratchPwtGameWiseForAgent = new ScratchPwtReportHelperSP();</span>
<span class="nc" id="L473">				scratchPurchaseDetailsWithBo = new SaleReportsAgentHelperSP(</span>
						infoBean, dateBeans);
<span class="nc" id="L475">				dateBeans.setLastdate(new java.sql.Date(GetDate.getNextDayDate(</span>
						dateBeans.getLastdate()).getTime()));
<span class="nc" id="L477">				agentCashChqHelper = new CashChqReportsAgentHelperSP(infoBean,</span>
						dateBeans);
<span class="nc" id="L479">				dateBeans.setLastdate(new java.sql.Date(dateBeans.getLastdate()</span>
						.getTime()
						- 24 * 60 * 60 * 1000));
			} else {
<span class="nc" id="L483">				dgScSalePwtRetWiseHelper = new CompleteCollectionReportHelper();</span>
<span class="nc" id="L484">				csSaleRetWiseHelper = new CSSaleReportHelper();</span>
<span class="nc" id="L485">				scratchSaleGameWiseForAgent = new ScratchSaleReportHelper();</span>
<span class="nc" id="L486">				drawSaleGameWiseHelperForAgent = new DrawSaleReportHelper();</span>
<span class="nc" id="L487">				drawPwtGameWiseHelperForAgent = new DrawPwtReportHelper();</span>
<span class="nc" id="L488">				scratchPwtGameWiseForAgent = new ScratchPwtReportHelper();</span>
<span class="nc" id="L489">				scratchPurchaseDetailsWithBo = new SaleReportsAgentHelper(</span>
						infoBean, dateBeans);
<span class="nc" id="L491">				dateBeans.setLastdate(new java.sql.Date(GetDate.getNextDayDate(</span>
						dateBeans.getLastdate()).getTime()));
<span class="nc" id="L493">				agentCashChqHelper = new CashChqReportsAgentHelper(infoBean,</span>
						dateBeans);
<span class="nc" id="L495">				dateBeans.setLastdate(new java.sql.Date(dateBeans.getLastdate()</span>
						.getTime()
						- 24 * 60 * 60 * 1000));
			}
			// FOR Reatiler Wise
<span class="nc" id="L500">			Map&lt;String, CompleteCollectionBean&gt; dgScSalePwtRetWiseMap = dgScSalePwtRetWiseHelper</span>
					.collectionReportForAgent(startDate, endDate, agentOrgId,
							&quot;Retailer Wise&quot;);
<span class="nc" id="L503">			List&lt;CSSaleReportBean&gt; csSaleRetWiseList = null;</span>
<span class="nc" id="L504">			List&lt;CSSaleReportBean&gt; csSaleProductWiseForAgentList = null;</span>
<span class="nc" id="L505">			List&lt;SalePwtReportsBean&gt; drawSaleGameWiseListForAgent = null;</span>
<span class="nc" id="L506">			List&lt;SalePwtReportsBean&gt; drawPwtGameWiseListForAgent = null;</span>
<span class="nc" id="L507">			List&lt;SalePwtReportsBean&gt; scratchSaleGameWiseForAgentList = null;</span>
<span class="nc" id="L508">			List&lt;SalePwtReportsBean&gt; scratchPwtGameWiseForAgentList = null;</span>
<span class="nc" id="L509">			List&lt;SaleReportBean&gt; purchWithBOGameWise = null;</span>
<span class="nc" id="L510">			SaleReportBean purchWithBO = null;</span>
<span class="nc bnc" id="L511" title="All 2 branches missed.">			if (isCS) {</span>
				// Retailer Wise
<span class="nc" id="L513">				csSaleRetWiseList = csSaleRetWiseHelper.CSSaleRetailerWise(</span>
						startDate, endDate, agentOrgId);
				// Product Wise
<span class="nc" id="L516">				csSaleProductWiseForAgentList = csSaleRetWiseHelper</span>
						.CSSaleProductWiseAgentWise(startDate, endDate,
								agentOrgId);
			}

<span class="nc bnc" id="L521" title="All 2 branches missed.">			if (isDraw) {</span>
				// Game Wise
<span class="nc" id="L523">				ReportStatusBean reportStatusBean = new ReportStatusBean();</span>
<span class="nc" id="L524">				reportStatusBean.setReportingFrom(&quot;MAIN_DB&quot;);</span>
<span class="nc" id="L525">				drawSaleGameWiseListForAgent = drawSaleGameWiseHelperForAgent</span>
						.drawSaleGameWiseForAgent(startDate, endDate,
								agentOrgId, reportStatusBean);
<span class="nc" id="L528">				drawPwtGameWiseListForAgent = drawPwtGameWiseHelperForAgent</span>
						.drawPwtGameWiseForAgent(startDate, endDate, agentOrgId);
			}

<span class="nc bnc" id="L532" title="All 2 branches missed.">			if (isScratch) {</span>
				// Game Wise
<span class="nc" id="L534">				scratchSaleGameWiseForAgentList = scratchSaleGameWiseForAgent</span>
						.scratchSaleAgentWiseExpand(startDate, endDate,
								agentOrgId);
<span class="nc" id="L537">				scratchPwtGameWiseForAgentList = scratchPwtGameWiseForAgent</span>
						.scratchPwtAgentWiseExpand(startDate, endDate,
								agentOrgId);
				// purchanse details with BO
<span class="nc" id="L541">				purchWithBO = scratchPurchaseDetailsWithBo</span>
						.getPurchaseDetailWithBo();
<span class="nc" id="L543">				purchWithBOGameWise = scratchPurchaseDetailsWithBo</span>
						.getSaleDetailGameWise(scratchPurchaseDetailsWithBo
								.getGameId());
			}
<span class="nc" id="L547">			dateBeans.setLastdate(new java.sql.Date(GetDate.getNextDayDate(</span>
					dateBeans.getLastdate()).getTime()));
<span class="nc" id="L549">			List&lt;CashChqReportBean&gt; cashChqWithRetlist = agentCashChqHelper</span>
					.getCashChqDetail();
<span class="nc" id="L551">			CashChqReportBean cashChqWithBoBean = agentCashChqHelper</span>
					.getCashChqDetailWithBO();
<span class="nc" id="L553">			dateBeans.setLastdate(new java.sql.Date(dateBeans.getLastdate()</span>
					.getTime()
					- 24 * 60 * 60 * 1000));
<span class="nc" id="L556">			EmailReportBean emailRepBeanAgt = new EmailReportBean();</span>
<span class="nc" id="L557">			netPaymentsAtBo = collectionReportOverAllBean.getCash()</span>
					+ collectionReportOverAllBean.getCheque()
					+ collectionReportOverAllBean.getCredit()
					+ collectionReportOverAllBean.getBankDep()
					- collectionReportOverAllBean.getDebit()
					- collectionReportOverAllBean.getChequeReturn();

<span class="nc" id="L564">			netDgSaleAtBo = collectionReportOverAllBean.getDgSale()</span>
					- collectionReportOverAllBean.getDgCancel();
<span class="nc" id="L566">			netDgPwtAtBo = collectionReportOverAllBean.getDgPwt()</span>
					+ collectionReportOverAllBean.getDgDirPlyPwt();
<span class="nc" id="L568">			netSeSaleAtBo = collectionReportOverAllBean.getSeSale()</span>
					- collectionReportOverAllBean.getSeCancel();
<span class="nc" id="L570">			netSePwtAtBo = collectionReportOverAllBean.getSePwt()</span>
					+ collectionReportOverAllBean.getSeDirPlyPwt();
<span class="nc" id="L572">			netCsSaleAtBo = collectionReportOverAllBean.getCSSale()</span>
					- collectionReportOverAllBean.getCSCancel();
<span class="nc" id="L574">			netOlaDepAtBo = collectionReportOverAllBean.getDeposit()</span>
					- collectionReportOverAllBean.getDepositRefund();
<span class="nc" id="L576">			netOlaWithAtBo = collectionReportOverAllBean.getWithdrawal()</span>
					- collectionReportOverAllBean.getWithdrawalRefund();
<span class="nc" id="L578">			netOlaNetGameAtBo = collectionReportOverAllBean.getNetGamingComm();</span>

			// START FROM HERE
<span class="nc" id="L581">			totalExpenseAtBo = netDgSaleAtBo - netDgPwtAtBo - netPaymentsAtBo</span>
					+ netSeSaleAtBo - netSePwtAtBo + netCsSaleAtBo
					+ netOlaDepAtBo - netOlaWithAtBo - netOlaNetGameAtBo;
<span class="nc" id="L584">			mail.boTextBody += &quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;b&gt;Details of Transaction With BO&lt;/b&gt;&quot;;</span>
<span class="nc" id="L585">			mail.boTextBody += &quot;&lt;br&gt;&lt;br&gt; &lt;table cellpadding='8' border='2' bordercolor='red' cellspacing='0'&gt;&quot;;</span>
<span class="nc bnc" id="L586" title="All 2 branches missed.">			if (isDraw) {</span>
<span class="nc" id="L587">				mail.boTextBody += &quot;&lt;tr&gt;&lt;td align='left' width='200'&gt;&lt;B&gt;Draw Game&lt;/B&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Purchase&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(netDgSaleAtBo)
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Pwt&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(netDgPwtAtBo)
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;;
			}
<span class="nc bnc" id="L603" title="All 2 branches missed.">			if (isScratch) {</span>
<span class="nc" id="L604">				mail.boTextBody += &quot;&lt;tr&gt;&lt;td align='left' width='200'&gt;&lt;B&gt;Scratch Game&lt;/B&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Purchase&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(netSeSaleAtBo)
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Pwt&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(netSePwtAtBo)
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;;
			}
<span class="nc bnc" id="L620" title="All 2 branches missed.">			if (isCS) {</span>
<span class="nc" id="L621">				mail.boTextBody += &quot;&lt;tr&gt;&lt;td align='left' width='200'&gt;&lt;B&gt;Commercial Services&lt;/B&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Sale&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(netCsSaleAtBo)
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;;
			}
<span class="nc bnc" id="L630" title="All 2 branches missed.">			if (isOLA) {</span>
<span class="nc" id="L631">				mail.boTextBody += &quot;&lt;tr&gt;&lt;td align='left' width='200'&gt;&lt;B&gt;OLA Service&lt;/B&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Total Deposit&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(netOlaDepAtBo)
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Total Withdraw&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(netOlaWithAtBo)
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Total Net Gaming&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(netOlaNetGameAtBo)
						+ &quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot;;
			}
<span class="nc" id="L653">			mail.boTextBody += &quot;&lt;tr&gt;&quot;</span>
					+ &quot;&lt;td width='200'&gt;&lt;B&gt;Net Payment&lt;/B&gt;&lt;/td&gt;&quot;
					+ &quot;&lt;td align='right' width='150'&gt;&quot; + BodyText.INR
					+ FormatNumber.formatNumber(netPaymentsAtBo) + &quot;&lt;/td&gt;&quot;
					+ &quot;&lt;/tr&gt;&quot; + &quot;&lt;tr&gt;&quot;
					+ &quot;&lt;td width='200'&gt;&lt;B&gt;Total Expense&lt;/B&gt;&lt;/td&gt;&quot;
					+ &quot;&lt;td align='right' width='150'&gt;&quot; + BodyText.INR
					+ FormatNumber.formatNumber(totalExpenseAtBo) + &quot;&lt;/td&gt;&quot;
					+ &quot;&lt;/tr&gt;&quot; + &quot;&lt;/table&gt;&quot;;

			// Details With Retailer
<span class="nc" id="L664">			AgentCollectionReportOverAllHelper agentHelper = new AgentCollectionReportOverAllHelper();</span>
<span class="nc" id="L665">			Map&lt;String, AgentCollectionReportOverAllBean&gt; resultMapForAgent = agentHelper</span>
					.collectionRetailerWiseWithOpeningBal(agentOrgId, deplDate,
							startDate, endDate);

<span class="nc" id="L669">			logger</span>
					.debug(&quot;The size of bean Map is: &quot;
							+ resultMapForAgent.size());

<span class="nc" id="L673">			Set&lt;Map.Entry&lt;String, AgentCollectionReportOverAllBean&gt;&gt; set = resultMapForAgent</span>
					.entrySet();
<span class="nc" id="L675">			Iterator&lt;Entry&lt;String, AgentCollectionReportOverAllBean&gt;&gt; it = set</span>
					.iterator();
<span class="nc" id="L677">			System.out.println(set.size());</span>
<span class="nc bnc" id="L678" title="All 2 branches missed.">			while (it.hasNext()) {</span>
<span class="nc" id="L679">				Map.Entry&lt;String, AgentCollectionReportOverAllBean&gt; entry = (Map.Entry&lt;String, AgentCollectionReportOverAllBean&gt;) it</span>
						.next();
<span class="nc" id="L681">				AgentCollectionReportOverAllBean bean = entry.getValue();</span>
<span class="nc" id="L682">				netPayment += bean.getCash() + bean.getBankDep()</span>
						+ bean.getCheque() - bean.getChequeReturn()
						+ bean.getCredit() - bean.getDebit();
<span class="nc" id="L685">				System.out.println(netPayment);</span>
<span class="nc" id="L686">				System.out.println(entry.getKey());</span>
<span class="nc bnc" id="L687" title="All 2 branches missed.">				if (isDraw) {</span>
<span class="nc" id="L688">					totalDrawSale += bean.getDgSale() - bean.getDgCancel();</span>
<span class="nc" id="L689">					totalDrawPwt += bean.getDgPwt() + bean.getDgDirPlyPwt();</span>
				}
<span class="nc bnc" id="L691" title="All 2 branches missed.">				if (isScratch) {</span>
<span class="nc" id="L692">					totalScratchSale += bean.getSeSale() - bean.getSeCancel();</span>
<span class="nc" id="L693">					totalScratchPwt += bean.getSePwt() + bean.getSeDirPlyPwt();</span>
				}
<span class="nc bnc" id="L695" title="All 2 branches missed.">				if (isCS) {</span>
<span class="nc" id="L696">					totalCSSale += bean.getCSSale() - bean.getCSCancel();</span>
<span class="nc" id="L697">					System.out.println(&quot;CS SALE &quot; + totalCSSale);</span>
				}
<span class="nc bnc" id="L699" title="All 2 branches missed.">				if (isOLA) {</span>
<span class="nc" id="L700">					totalOLADeposit += bean.getDeposit()</span>
							- bean.getDepositRefund();
<span class="nc" id="L702">					totalOLAWithdraw += bean.getWithdrawal()</span>
							- bean.getWithdrawalRefund();
<span class="nc" id="L704">					totalOLANetGamming += bean.getNetGamingComm();</span>
				}
<span class="nc" id="L706">			}</span>
<span class="nc" id="L707">			emailRepBeanAgt.setTotalDrawPurchase(totalDrawSale);</span>
<span class="nc" id="L708">			emailRepBeanAgt.setTotalDrawPwt(totalDrawPwt);</span>
<span class="nc" id="L709">			emailRepBeanAgt.setTotalScratchPurchase(totalScratchSale);</span>
<span class="nc" id="L710">			emailRepBeanAgt.setTotalScratchPwt(totalScratchPwt);</span>
<span class="nc" id="L711">			emailRepBeanAgt.setTotalCSsale(totalCSSale);</span>
<span class="nc" id="L712">			emailRepBeanAgt.setNetPayment(netPayment);</span>
<span class="nc" id="L713">			emailRepBeanAgt.setTotalOLADeposit(totalOLADeposit);</span>
<span class="nc" id="L714">			emailRepBeanAgt.setTotalOLAWithdraw(totalOLAWithdraw);</span>
<span class="nc" id="L715">			emailRepBeanAgt.setTotalOLANetGamming(totalOLANetGamming);</span>

<span class="nc" id="L717">			totalExpenseForRetailer = totalDrawSale - totalDrawPwt - netPayment</span>
					+ totalScratchSale - totalScratchPwt + totalCSSale
					+ totalOLADeposit - totalOLAWithdraw - totalOLANetGamming;

<span class="nc bnc" id="L721" title="All 2 branches missed.">			if (&quot;Current Day&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc bnc" id="L722" title="All 2 branches missed.">				if (rs1.next()) {</span>
<span class="nc" id="L723">					emailRepBeanAgt</span>
							.setLoggedInUsers(rs1.getInt(&quot;logged_users&quot;));
				} else {
<span class="nc" id="L726">					emailRepBeanAgt.setLoggedInUsers(0);</span>
				}
			}
<span class="nc" id="L729">			mail.boTextBody += &quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;Details of Transaction With Retailer&quot;;</span>
<span class="nc" id="L730">			mail.boTextBody += &quot;&lt;br&gt;&lt;br&gt; &lt;table cellpadding='8' border='2' bordercolor='red' cellspacing='0'&gt;&quot;;</span>
<span class="nc bnc" id="L731" title="All 2 branches missed.">			if (isDraw) {</span>
<span class="nc" id="L732">				mail.boTextBody += &quot;&lt;tr&gt;&lt;td align='left' width='200'&gt;&lt;B&gt;Draw Game&lt;/B&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Sale&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(emailRepBeanAgt
								.getTotalDrawPurchase())
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Pwt&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(emailRepBeanAgt
								.getTotalDrawPwt()) + &quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot;;
			}
<span class="nc bnc" id="L748" title="All 2 branches missed.">			if (isScratch) {</span>
<span class="nc" id="L749">				mail.boTextBody += &quot;&lt;tr&gt;&lt;td align='left' width='200'&gt;&lt;B&gt;Scratch Game&lt;/B&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Sale&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(emailRepBeanAgt
								.getTotalScratchPurchase())
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Pwt&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(emailRepBeanAgt
								.getTotalScratchPwt()) + &quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot;;
			}
<span class="nc bnc" id="L765" title="All 2 branches missed.">			if (isCS) {</span>
<span class="nc" id="L766">				mail.boTextBody += &quot;&lt;tr&gt;&lt;td align='left' width='200'&gt;&lt;B&gt;Commercial Services&lt;/B&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Sale&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(emailRepBeanAgt
								.getTotalCSsale()) + &quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot;;

			}
<span class="nc bnc" id="L775" title="All 2 branches missed.">			if (isOLA) {</span>
<span class="nc" id="L776">				mail.boTextBody += &quot;&lt;tr&gt;&lt;td align='left' width='200'&gt;&lt;B&gt;OLA Service&lt;/B&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Total Deposit&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(emailRepBeanAgt
								.getTotalOLADeposit())
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Total Withdraw&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(emailRepBeanAgt
								.getTotalScratchPwt())
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Total Net Gaming&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(emailRepBeanAgt
								.getTotalOLANetGamming()) + &quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot;;
			}
<span class="nc" id="L800">			mail.boTextBody += &quot;&lt;tr&gt;&quot;</span>
					+ &quot;&lt;td width='200'&gt;&lt;B&gt;Net Received&lt;/B&gt;&lt;/td&gt;&quot;
					+ &quot;&lt;td align='right' width='150'&gt;&quot;
					+ BodyText.INR
					+ FormatNumber
							.formatNumber(emailRepBeanAgt.getNetPayment())
					+ &quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot; + &quot;&lt;tr&gt;&quot;
					+ &quot;&lt;td width='200'&gt;&lt;B&gt;Total Collections&lt;/B&gt;&lt;/td&gt;&quot;
					+ &quot;&lt;td align='right' width='150'&gt;&quot; + BodyText.INR
					+ FormatNumber.formatNumber(totalExpenseForRetailer)
					+ &quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot;;
<span class="nc bnc" id="L811" title="All 2 branches missed.">			if (&quot;Current Day&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc" id="L812">				mail.boTextBody += &quot;&lt;tr&gt;&quot;</span>
						+ &quot;&lt;td width='200'&gt;&lt;B&gt;Active Retailers&lt;/B&gt;&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ FormatNumber.formatNumber(this
								.getActiveRetailerCount(agentOrgId))
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;&lt;B&gt;Yesterday Logged in Retailers&lt;/B&gt;&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ FormatNumber.formatNumber(emailRepBeanAgt
								.getLoggedInUsers()) + &quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot;;
			}
<span class="nc" id="L825">			mail.boTextBody += &quot;&lt;/table&gt;&quot;;</span>
<span class="nc bnc" id="L826" title="All 2 branches missed.">			if (&quot;Current Day&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc" id="L827">				mail.boTextBody += &quot;&lt;br&gt;&lt;br&gt;&lt;b&gt; Last Day Collections &lt;/b&gt;&quot;;</span>
<span class="nc" id="L828">				mail.boTextBody += &quot;&lt;br&gt;&lt;br&gt; &lt;table cellpadding='8' border='2' bordercolor='red' cellspacing='0'&gt;&quot;;</span>
<span class="nc" id="L829">				mail.boTextBody += &quot;&lt;tr&gt;&quot; + &quot;&lt;th&gt; Retailer Name &lt;/th&gt;&quot;</span>
						+ &quot;&lt;th&gt;Total Collections&lt;/th&gt;&quot; + &quot;&lt;/tr&gt;&quot;;
<span class="nc bnc" id="L831" title="All 2 branches missed.">				if (resultMapForAgent != null) {</span>
<span class="nc bnc" id="L832" title="All 2 branches missed.">					for (Map.Entry&lt;String, AgentCollectionReportOverAllBean&gt; temp : resultMapForAgent</span>
							.entrySet()) {
<span class="nc" id="L834">						mail.boTextBody += &quot;&lt;tr&gt;&quot; + &quot;&lt;td&gt;&quot;</span>
								+ temp.getValue().getRetailerName() + &quot;&lt;/td&gt;&quot;
								+ &quot;&lt;td&gt;&quot; + temp.getValue().getOpeningBal()
								+ &quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot;;
<span class="nc" id="L838">					}</span>
				}
<span class="nc" id="L840">				mail.boTextBody += &quot;&lt;/table&gt;&quot;;</span>
			}
<span class="nc" id="L842">			logger.debug(&quot;\n&quot; + mail.boTextBody);</span>
			// create the excel
<span class="nc" id="L844">			AgentReportMailExl mailExl = new AgentReportMailExl(</span>
					mail.AGENT_FILE_NAME, dateBeans);
<span class="nc" id="L846">			mailExl.CreateXLSFile(dgScSalePwtRetWiseMap, csSaleRetWiseList,</span>
					drawSaleGameWiseListForAgent, drawPwtGameWiseListForAgent,
					scratchSaleGameWiseForAgentList,
					scratchPwtGameWiseForAgentList,
					csSaleProductWiseForAgentList, purchWithBO,
					purchWithBOGameWise, cashChqWithRetlist, cashChqWithBoBean,
					isDraw, isScratch, isCS, isOLA);

			// add reciepient
<span class="nc" id="L855">			mail.reciepient = emailId;</span>
<span class="nc" id="L856">			return mail;</span>
<span class="nc" id="L857">		} catch (Exception e) {</span>
<span class="nc" id="L858">			e.printStackTrace();</span>
<span class="nc" id="L859">			throw new LMSException(e);</span>
		}
	}

	public boolean sendMailToAgent(String reportType) throws LMSException,
			ParseException, SQLException {

<span class="nc bnc" id="L866" title="All 2 branches missed.">		boolean isDraw = LMSFilterDispatcher.getIsDraw()</span>
				.equalsIgnoreCase(&quot;yes&quot;) ? true : false;
<span class="nc bnc" id="L868" title="All 2 branches missed.">		boolean isScratch = LMSFilterDispatcher.getIsScratch()</span>
				.equalsIgnoreCase(&quot;yes&quot;) ? true : false;
<span class="nc bnc" id="L870" title="All 2 branches missed.">		boolean isCS = LMSFilterDispatcher.getIsCS().equalsIgnoreCase(&quot;yes&quot;) ? true</span>
				: false;
<span class="nc bnc" id="L872" title="All 2 branches missed.">		boolean isOLA = LMSFilterDispatcher.getIsOLA().equalsIgnoreCase(&quot;yes&quot;) ? true</span>
				: false;

<span class="nc" id="L875">		Connection con = null;</span>
<span class="nc" id="L876">		String FROM = &quot;&quot;, PASSWORD = &quot;&quot;, type = &quot;&quot;;</span>
<span class="nc" id="L877">		ICollectionReportOverAllHelper helper = null;</span>
<span class="nc" id="L878">		SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc bnc" id="L879" title="All 2 branches missed.">		if (&quot;Current Day&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc" id="L880">			FROM = MailBean.DAILY_MAIL_FROM;</span>
<span class="nc" id="L881">			PASSWORD = MailBean.PASSWORD;</span>
<span class="nc" id="L882">			type = &quot;Daily&quot;;</span>
<span class="nc bnc" id="L883" title="All 2 branches missed.">		} else if (&quot;Current Week&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc" id="L884">			PASSWORD = MailBean.PASSWORD;</span>
<span class="nc" id="L885">			FROM = MailBean.WEEKLY_MAIL_FROM;</span>
<span class="nc" id="L886">			type = &quot;Weekly&quot;;</span>
<span class="nc bnc" id="L887" title="All 2 branches missed.">		} else if (&quot;Current Month&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc" id="L888">			FROM = MailBean.MONTHLY_MAIL_FROM;</span>
<span class="nc" id="L889">			PASSWORD = MailBean.PASSWORD;</span>
<span class="nc" id="L890">			type = &quot;Monthly&quot;;</span>
		} else {
<span class="nc" id="L892">			FROM = MailBean.MONTHLY_MAIL_FROM;</span>
<span class="nc" id="L893">			PASSWORD = MailBean.PASSWORD;</span>
<span class="nc" id="L894">			type = &quot;Daily&quot;;</span>
		}

		try {
<span class="nc" id="L898">			List&lt;MailBean&gt; mailbeanlist = new ArrayList&lt;MailBean&gt;();</span>
<span class="nc" id="L899">			con = DBConnect.getConnection();</span>
<span class="nc" id="L900">			PreparedStatement pstmt = con</span>
					.prepareStatement(&quot;select distinct(aa.user_id),ref_user_id, organization_id, email_id, &quot;
							+ &quot;first_name, last_name from st_lms_report_email_priv_master aa, st_lms_report_email_priviledge_rep bb, &quot;
							+ &quot;st_lms_report_email_user_master cc where cc.user_id = aa.user_id and  aa.email_pid = &quot;
							+ &quot;bb.email_pid and cc.organization_type = 'AGENT' and (aa.status='ACTIVE' and bb.status = &quot;
							+ &quot;'ACTIVE' and cc.status ='ACTIVE') and bb.priv_title like '%&quot;
							+ type + &quot;%'&quot;);
<span class="nc" id="L907">			ResultSet rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L909" title="All 2 branches missed.">			if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L910">				helper = new CollectionReportOverAllHelperSP();</span>
			} else {
<span class="nc" id="L912">				helper = new CollectionReportOverAllHelper();</span>
			}
<span class="nc" id="L914">			Map&lt;String, CollectionReportOverAllBean&gt; resultMap = helper</span>
					.collectionAgentWiseWithOpeningBal(new Timestamp(sdf.parse(
							sdf.format(dateBeans.getFirstdate())).getTime()),
							new Timestamp(sdf.parse(
									sdf.format(dateBeans.getFirstdate()))
									.getTime()), new Timestamp(sdf.parse(
									sdf.format(dateBeans.getLastdate()))
									.getTime()
									+ 24 * 60 * 60 * 1000 - 1000), &quot;ALL&quot;, &quot;ALL&quot;);

<span class="nc" id="L924">			logger.debug(&quot;The size of bean Map is: &quot; + resultMap.size());</span>

<span class="nc bnc" id="L926" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L927">				MailBean bean = null;</span>
<span class="nc" id="L928">				String emailId = rs.getString(&quot;email_id&quot;).trim();</span>
<span class="nc" id="L929">				int agentUserId = rs.getInt(&quot;ref_user_id&quot;);</span>
<span class="nc" id="L930">				int agentOrgId = rs.getInt(&quot;organization_id&quot;);</span>
<span class="nc" id="L931">				CollectionReportOverAllBean collectionReportOverAllBean = resultMap</span>
						.get(String.valueOf(agentOrgId));
<span class="nc" id="L933">				bean = mailToAgent(con, reportType, emailId, agentUserId,</span>
						agentOrgId, collectionReportOverAllBean);
<span class="nc bnc" id="L935" title="All 2 branches missed.">				if (bean != null) {</span>
<span class="nc" id="L936">					mailbeanlist.add(bean);</span>
				}
<span class="nc" id="L938">			}</span>

<span class="nc" id="L940">			MailSender mailSender = new MailSender(FROM, PASSWORD, mailbeanlist); // sending</span>
			// the
			// mail
<span class="nc" id="L943">			mailSender.setDaemon(true);</span>
<span class="nc" id="L944">			mailSender.start();</span>

<span class="nc" id="L946">		}catch (SQLException e) {</span>
<span class="nc" id="L947">			logger.info(&quot;SQL Exception &quot;,e);</span>
<span class="nc" id="L948">			throw new LMSException(&quot;SQL Exception &quot;+e.getMessage());</span>
<span class="nc" id="L949">		}catch (Exception e) {</span>
<span class="nc" id="L950">			logger.info(&quot;Exception &quot;,e);</span>
<span class="nc" id="L951">			throw new LMSException(&quot;Exception&quot;+e.getMessage());</span>
		} finally {
<span class="nc" id="L953">			DBConnect.closeCon(con);</span>
<span class="nc" id="L954">		}</span>
<span class="nc" id="L955">		return true;</span>
	}

	/**
	 * this method send mail to Back Office regarding the Sale Report, PWT
	 * Report, and Cash Cheque Reports
	 * 
	 * @param reportType
	 *            , String i.e.('Daily','Weekly', 'Monthly')
	 * @return true if no exception occurred.
	 * @throws LMSException
	 * @throws SQLException
	 * @throws ParseException
	 */
	public boolean sendMailToBO(String reportType) throws LMSException,
			SQLException, ParseException {

<span class="nc" id="L972">		MailBean mail = new MailBean();</span>
<span class="nc" id="L973">		String FROM = null;</span>
<span class="nc" id="L974">		String PASSWORD = MailBean.PASSWORD;</span>
<span class="nc" id="L975">		String type = &quot;&quot;;</span>
<span class="nc" id="L976">		SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L977">		SimpleDateFormat depDateFormat = new SimpleDateFormat(</span>
				(String) ServletActionContext.getServletContext().getAttribute(
						&quot;date_format&quot;));
<span class="nc" id="L980">		Timestamp deplDate = new Timestamp(depDateFormat.parse(</span>
				(String) ServletActionContext.getServletContext().getAttribute(
						&quot;DEPLOYMENT_DATE&quot;)).getTime());
<span class="nc" id="L983">		Timestamp startDate = new Timestamp(sdf.parse(</span>
				sdf.format(dateBeans.getFirstdate())).getTime());
<span class="nc" id="L985">		Timestamp endDate = new Timestamp(sdf.parse(</span>
				sdf.format(dateBeans.getLastdate())).getTime());
<span class="nc" id="L987">		mail.boTextBody = &quot;LMS Report from   &quot;</span>
				+ dateBeans.getFirstdate().toString().substring(8, 10) + '-'
				+ dateBeans.getFirstdate().toString().substring(5, 7) + '-'
				+ dateBeans.getFirstdate().toString().substring(0, 4) + &quot; TO &quot;
				+ dateBeans.getLastdate().toString().substring(8, 10) + '-'
				+ dateBeans.getLastdate().toString().substring(5, 7) + '-'
				+ dateBeans.getLastdate().toString().substring(0, 4);
<span class="nc bnc" id="L994" title="All 2 branches missed.">		if (&quot;Current Day&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc" id="L995">			mail.subject = BodyText.DAILY_SUBJECT;</span>
<span class="nc" id="L996">			mail.BO_FILE_NAME = mail.BO_FILE_NAME + &quot;BO_&quot; + BodyText.DAILY_FILE;</span>
<span class="nc" id="L997">			FROM = MailBean.DAILY_MAIL_FROM;</span>
<span class="nc" id="L998">			type = &quot;Daily&quot;;</span>
<span class="nc bnc" id="L999" title="All 2 branches missed.">		} else if (&quot;Current Week&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc" id="L1000">			mail.subject = BodyText.WEEKLY_SUBJECT;</span>
<span class="nc" id="L1001">			mail.BO_FILE_NAME = mail.BO_FILE_NAME + &quot;BO_&quot;</span>
					+ BodyText.WEEKLY_FILE;
			// System.out.println(&quot;Weakly condition executed :
			// =========================================== &quot;);
<span class="nc" id="L1005">			FROM = MailBean.WEEKLY_MAIL_FROM;</span>
<span class="nc" id="L1006">			type = &quot;Weekly&quot;;</span>
<span class="nc bnc" id="L1007" title="All 2 branches missed.">		} else if (&quot;Current Month&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc" id="L1008">			mail.subject = BodyText.MONTHLY_SUBJECT;</span>
<span class="nc" id="L1009">			mail.BO_FILE_NAME = mail.BO_FILE_NAME + &quot;BO_&quot;</span>
					+ BodyText.MONTHLY_FILE;
<span class="nc" id="L1011">			FROM = MailBean.MONTHLY_MAIL_FROM;</span>
<span class="nc" id="L1012">			type = &quot;Monthly&quot;;</span>
<span class="nc bnc" id="L1013" title="All 2 branches missed.">		} else if (&quot;Current Month&quot;.equalsIgnoreCase(reportType)) {</span>
			// FOR NEW TYPE
<span class="nc" id="L1015">			mail.subject = &quot;Performed Draw Details&quot;;</span>
<span class="nc" id="L1016">			mail.boTextBody = &quot;&quot;;</span>
<span class="nc" id="L1017">			FROM = MailBean.DAILY_MAIL_FROM;</span>
<span class="nc" id="L1018">			type = &quot;Draw Wise&quot;;</span>
		} else {
<span class="nc" id="L1020">			mail.subject = &quot;LMS Report From &quot; + this.dateBeans.getFirstdate()</span>
					+ &quot; To &quot; + this.dateBeans.getLastdate();
<span class="nc" id="L1022">			mail.BO_FILE_NAME = mail.BO_FILE_NAME + &quot;BO_&quot;</span>
					+ dateBeans.getLastdate() + &quot;_&quot; + BodyText.DATE_WISE_FILE;
<span class="nc" id="L1024">			FROM = MailBean.MONTHLY_MAIL_FROM;</span>
<span class="nc" id="L1025">			type = &quot;Daily&quot;;</span>
		}
<span class="nc" id="L1027">		System.out.println(&quot;File Name----------------------------------------&quot;</span>
				+ mail.BO_FILE_NAME); // created excel sheet file Name

<span class="nc" id="L1030">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L1031">		cal.setTime(endDate);</span>
<span class="nc" id="L1032">		cal.add(Calendar.HOUR, 23);</span>
<span class="nc" id="L1033">		cal.add(Calendar.MINUTE, 59);</span>
<span class="nc" id="L1034">		cal.add(Calendar.SECOND, 59);</span>
<span class="nc" id="L1035">		endDate = new Timestamp(cal.getTime().getTime());</span>

<span class="nc" id="L1037">		IDrawPwtReportHelper boDirPlrPwtHelperForDraw = null;</span>
<span class="nc" id="L1038">		IScratchPwtReportHelper boDirPlrPwtHelperForScratch = null;</span>
<span class="nc bnc" id="L1039" title="All 2 branches missed.">		if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1040">			boDirPlrPwtHelperForDraw = new DrawPwtReportHelperSP();</span>
<span class="nc" id="L1041">			boDirPlrPwtHelperForScratch = new ScratchPwtReportHelperSP();</span>
		} else {
<span class="nc" id="L1043">			boDirPlrPwtHelperForDraw = new DrawPwtReportHelper();</span>
<span class="nc" id="L1044">			boDirPlrPwtHelperForScratch = new ScratchPwtReportHelper();</span>
		}

		// Dir Pwt At BO For Draw
<span class="nc" id="L1048">		List&lt;SalePwtReportsBean&gt; reportListForDraw = boDirPlrPwtHelperForDraw</span>
				.drawBODirPlyPwtGameWise(startDate, endDate);

<span class="nc" id="L1051">		Iterator&lt;SalePwtReportsBean&gt; boDirPwtIteratorForDraw = reportListForDraw</span>
				.iterator();
<span class="nc" id="L1053">		double boDirPlrPwtForDraw = 0.0;</span>
<span class="nc bnc" id="L1054" title="All 2 branches missed.">		while (boDirPwtIteratorForDraw.hasNext()) {</span>
<span class="nc" id="L1055">			boDirPlrPwtForDraw += boDirPwtIteratorForDraw.next().getPwtMrpAmt();</span>
		}

		// Dir Pwt At BO For Scratch
<span class="nc" id="L1059">		List&lt;SalePwtReportsBean&gt; reportListForScratch = null;</span>
<span class="nc" id="L1060">		reportListForScratch = boDirPlrPwtHelperForScratch</span>
				.scratchBODirPlyPwtGameWise(startDate, endDate);

<span class="nc" id="L1063">		Iterator&lt;SalePwtReportsBean&gt; boDirPwtIteratorForScratch = reportListForScratch</span>
				.iterator();
<span class="nc" id="L1065">		double boDirPlrPwtForScratch = 0.0;</span>
<span class="nc bnc" id="L1066" title="All 2 branches missed.">		while (boDirPwtIteratorForScratch.hasNext()) {</span>
<span class="nc" id="L1067">			boDirPlrPwtForScratch += boDirPwtIteratorForScratch.next()</span>
					.getPwtMrpAmt();
		}

<span class="nc" id="L1071">		createXLSSheet(mail.BO_FILE_NAME, boDirPlrPwtForScratch,</span>
				boDirPlrPwtForDraw, startDate, endDate);

		try {
<span class="nc" id="L1075">			this.con = DBConnect.getConnection();</span>
<span class="nc" id="L1076">			Double totalDrawSale = 0.0;</span>
<span class="nc" id="L1077">			Double totalScratchSale = 0.0;</span>
<span class="nc" id="L1078">			Double totalDrawPwt = 0.0;</span>
<span class="nc" id="L1079">			Double totalScratchPwt = 0.0;</span>
<span class="nc" id="L1080">			Double netPayment = 0.0;</span>
<span class="nc" id="L1081">			Double totalCSSale = 0.0;</span>
<span class="nc" id="L1082">			Double totalOLAWithdraw = 0.0;</span>
<span class="nc" id="L1083">			Double totalOLADeposit = 0.0;</span>
<span class="nc" id="L1084">			Double totalOLANetGamming = 0.0;</span>

<span class="nc" id="L1086">			PreparedStatement pstmt1 = null;</span>
<span class="nc" id="L1087">			ResultSet rs1 = null;</span>
<span class="nc bnc" id="L1088" title="All 2 branches missed.">			boolean isDraw = LMSFilterDispatcher.getIsDraw().equalsIgnoreCase(</span>
					&quot;yes&quot;) ? true : false;
<span class="nc bnc" id="L1090" title="All 2 branches missed.">			boolean isScratch = LMSFilterDispatcher.getIsScratch()</span>
					.equalsIgnoreCase(&quot;yes&quot;) ? true : false;
<span class="nc bnc" id="L1092" title="All 2 branches missed.">			boolean isCS = LMSFilterDispatcher.getIsCS()</span>
					.equalsIgnoreCase(&quot;yes&quot;) ? true : false;
<span class="nc bnc" id="L1094" title="All 2 branches missed.">			boolean isOLA = LMSFilterDispatcher.getIsOLA().equalsIgnoreCase(</span>
					&quot;yes&quot;) ? true : false;

<span class="nc bnc" id="L1097" title="All 2 branches missed.">			if (&quot;Current Day&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc" id="L1098">				pstmt1 = con</span>
						.prepareStatement(&quot;select count(*)as logged_users from st_lms_user_master where organization_type='AGENT' and date(last_login_date) =?&quot;);
<span class="nc" id="L1100">				pstmt1.setDate(1, dateBeans.getFirstdate());</span>
<span class="nc" id="L1101">				rs1 = pstmt1.executeQuery();</span>
			}
<span class="nc" id="L1103">			ICollectionReportOverAllHelper helper = null;</span>

<span class="nc bnc" id="L1105" title="All 2 branches missed.">			if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1106">				helper = new CollectionReportOverAllHelperSP();</span>
			} else {
<span class="nc" id="L1108">				helper = new CollectionReportOverAllHelper();</span>
			}
<span class="nc" id="L1110">			EmailReportBean emailRepBean = new EmailReportBean();</span>
<span class="nc" id="L1111">			Map&lt;String, CollectionReportOverAllBean&gt; resultMap = helper</span>
					.collectionAgentWiseWithOpeningBal(deplDate, startDate,
							endDate, &quot;ALL&quot;, &quot;ALL&quot;);

<span class="nc" id="L1115">			logger.debug(&quot;The size of bean Map is: &quot; + resultMap.size());</span>

<span class="nc" id="L1117">			Set&lt;Map.Entry&lt;String, CollectionReportOverAllBean&gt;&gt; set = resultMap</span>
					.entrySet();
<span class="nc" id="L1119">			Iterator&lt;Entry&lt;String, CollectionReportOverAllBean&gt;&gt; it = set</span>
					.iterator();
<span class="nc bnc" id="L1121" title="All 2 branches missed.">			while (it.hasNext()) {</span>

<span class="nc" id="L1123">				Map.Entry&lt;String, CollectionReportOverAllBean&gt; entry = (Map.Entry&lt;String, CollectionReportOverAllBean&gt;) it</span>
						.next();
<span class="nc" id="L1125">				CollectionReportOverAllBean bean = entry.getValue();</span>
<span class="nc" id="L1126">				netPayment += bean.getCash() + bean.getBankDep()</span>
						+ bean.getCheque() - bean.getChequeReturn()
						+ bean.getCredit() - bean.getDebit();

<span class="nc bnc" id="L1130" title="All 2 branches missed.">				if (isDraw) {</span>
<span class="nc" id="L1131">					totalDrawSale += bean.getDgSale() - bean.getDgCancel();</span>
<span class="nc" id="L1132">					totalDrawPwt += bean.getDgPwt() + bean.getDgDirPlyPwt();</span>
				}
<span class="nc bnc" id="L1134" title="All 2 branches missed.">				if (isScratch) {</span>
<span class="nc" id="L1135">					totalScratchSale += bean.getSeSale() - bean.getSeCancel();</span>
<span class="nc" id="L1136">					totalScratchPwt += bean.getSePwt() + bean.getSeDirPlyPwt();</span>
				}
<span class="nc bnc" id="L1138" title="All 2 branches missed.">				if (isCS) {</span>
<span class="nc" id="L1139">					totalCSSale += bean.getCSSale() - bean.getCSCancel();</span>

				}
<span class="nc bnc" id="L1142" title="All 2 branches missed.">				if (isOLA) {</span>
<span class="nc" id="L1143">					totalOLADeposit += bean.getDeposit()</span>
							- bean.getDepositRefund();
<span class="nc" id="L1145">					totalOLAWithdraw += bean.getWithdrawal()</span>
							- bean.getWithdrawalRefund();
<span class="nc" id="L1147">					totalOLANetGamming += bean.getNetGamingComm();</span>
				}
<span class="nc" id="L1149">			}</span>

<span class="nc" id="L1151">			emailRepBean.setTotalDrawPurchase(totalDrawSale);</span>
<span class="nc" id="L1152">			emailRepBean.setTotalDrawPwt(totalDrawPwt);</span>
<span class="nc" id="L1153">			emailRepBean.setTotalScratchPurchase(totalScratchSale);</span>
<span class="nc" id="L1154">			emailRepBean.setTotalScratchPwt(totalScratchPwt);</span>
<span class="nc" id="L1155">			emailRepBean.setTotalCSsale(totalCSSale);</span>
<span class="nc" id="L1156">			emailRepBean.setNetPayment(netPayment);</span>
<span class="nc" id="L1157">			emailRepBean.setTotalOLADeposit(totalOLADeposit);</span>
<span class="nc" id="L1158">			emailRepBean.setTotalOLAWithdraw(totalOLAWithdraw);</span>
<span class="nc" id="L1159">			emailRepBean.setTotalOLANetGamming(totalOLANetGamming);</span>

<span class="nc" id="L1161">			Double totalCollection = totalDrawSale - totalDrawPwt</span>
					+ totalScratchSale - totalScratchPwt + totalOLADeposit
					- totalOLAWithdraw - totalOLANetGamming - netPayment;
<span class="nc bnc" id="L1164" title="All 2 branches missed.">			if (&quot;Current Day&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc bnc" id="L1165" title="All 2 branches missed.">				if (rs1.next()) {</span>
<span class="nc" id="L1166">					emailRepBean.setLoggedInUsers(rs1.getInt(&quot;logged_users&quot;));</span>
				} else {
<span class="nc" id="L1168">					emailRepBean.setLoggedInUsers(0);</span>
				}
			}

<span class="nc" id="L1172">			mail.boTextBody += &quot;&lt;br&gt;&lt;br&gt; &lt;table cellpadding='8' border='2' bordercolor='red' cellspacing='0'&gt;&quot;;</span>
<span class="nc bnc" id="L1173" title="All 2 branches missed.">			if (isDraw) {</span>
<span class="nc" id="L1174">				mail.boTextBody += &quot;&lt;tr&gt;&lt;td align='left' width='200'&gt;&lt;B&gt;Draw Game&lt;/B&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Sale&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(emailRepBean
								.getTotalDrawPurchase())
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Pwt&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(emailRepBean
								.getTotalDrawPwt())
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Driect Player Pwt For Draw&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(boDirPlrPwtForDraw)
						+ &quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot;;
			}
<span class="nc bnc" id="L1198" title="All 2 branches missed.">			if (isScratch) {</span>
<span class="nc" id="L1199">				mail.boTextBody += &quot;&lt;tr&gt;&lt;td align='left' width='200'&gt;&lt;B&gt;Scratch Game&lt;/B&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Sale&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(emailRepBean
								.getTotalScratchPurchase())
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Pwt&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(emailRepBean
								.getTotalScratchPwt())
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Driect Player Pwt For Scratch&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(boDirPlrPwtForScratch)
						+ &quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot;;
			}
<span class="nc bnc" id="L1223" title="All 2 branches missed.">			if (isCS) {</span>
<span class="nc" id="L1224">				mail.boTextBody += &quot;&lt;tr&gt;&lt;td align='left' width='200'&gt;&lt;B&gt;Commercial Services&lt;/B&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Sale&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(emailRepBean
								.getTotalCSsale()) + &quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot;;
			}
<span class="nc bnc" id="L1232" title="All 2 branches missed.">			if (isOLA) {</span>
<span class="nc" id="L1233">				mail.boTextBody += &quot;&lt;tr&gt;&lt;td align='left' width='200'&gt;&lt;B&gt;Scratch Game&lt;/B&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Deposit&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(emailRepBean
								.getTotalOLADeposit())
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Withdrawal&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(emailRepBean
								.getTotalOLAWithdraw())
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;Net Gamming&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ BodyText.INR
						+ FormatNumber.formatNumber(emailRepBean
								.getTotalOLANetGamming()) + &quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot;;
			}
<span class="nc" id="L1258">			mail.boTextBody += &quot;&lt;tr&gt;&quot;</span>
					+ &quot;&lt;td width='200'&gt;&lt;B&gt;Net Payment&lt;/B&gt;&lt;/td&gt;&quot;
					+ &quot;&lt;td align='right' width='150'&gt;&quot; + BodyText.INR
					+ FormatNumber.formatNumber(emailRepBean.getNetPayment())
					+ &quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot; + &quot;&lt;tr&gt;&quot;
					+ &quot;&lt;td width='200'&gt;&lt;B&gt;Total Collections&lt;/B&gt;&lt;/td&gt;&quot;
					+ &quot;&lt;td align='right' width='150'&gt;&quot; + BodyText.INR
					+ FormatNumber.formatNumber(totalCollection) + &quot;&lt;/td&gt;&quot;
					+ &quot;&lt;/tr&gt;&quot;;
<span class="nc bnc" id="L1267" title="All 2 branches missed.">			if (&quot;Current Day&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc" id="L1268">				mail.boTextBody += &quot;&lt;tr&gt;&quot;</span>
						+ &quot;&lt;td width='200'&gt;&lt;B&gt;Active Agents&lt;/B&gt;&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ FormatNumber.formatNumber(this.getActiveAgentCount())
						+ &quot;&lt;/td&gt;&quot;
						+ &quot;&lt;/tr&gt;&quot;
						+ &quot;&lt;tr&gt;&quot;
						+ &quot;&lt;td width='200'&gt;&lt;B&gt;Agents logged in yesterday&lt;/B&gt;&lt;/td&gt;&quot;
						+ &quot;&lt;td align='right' width='150'&gt;&quot;
						+ FormatNumber.formatNumber(emailRepBean
								.getLoggedInUsers()) + &quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot;;
			}
<span class="nc" id="L1280">			mail.boTextBody += &quot;&lt;/table&gt;&quot;;</span>

			// Section for table of last day collections from each Agent
<span class="nc bnc" id="L1283" title="All 2 branches missed.">			if (&quot;Current Day&quot;.equalsIgnoreCase(reportType)) {</span>
<span class="nc" id="L1284">				mail.boTextBody += &quot;&lt;br&gt;&lt;br&gt;&lt;b&gt; Last Day Collections &lt;/b&gt;&quot;;</span>
<span class="nc" id="L1285">				mail.boTextBody += &quot;&lt;br&gt;&lt;br&gt; &lt;table cellpadding='8' border='2' bordercolor='red' cellspacing='0'&gt;&quot;;</span>
<span class="nc" id="L1286">				mail.boTextBody += &quot;&lt;tr&gt;&quot; + &quot;&lt;th&gt; Agent Name &lt;/th&gt;&quot;</span>
						+ &quot;&lt;th&gt;Total Collections&lt;/th&gt;&quot;;
<span class="nc bnc" id="L1288" title="All 2 branches missed.">				if (resultMap != null) {</span>
<span class="nc bnc" id="L1289" title="All 2 branches missed.">					for (Map.Entry&lt;String, CollectionReportOverAllBean&gt; temp : resultMap</span>
							.entrySet()) {
<span class="nc" id="L1291">						mail.boTextBody += &quot;&lt;tr&gt;&quot; + &quot;&lt;td&gt;&quot;</span>
								+ temp.getValue().getAgentName() + &quot;&lt;/td&gt;&quot;
								+ &quot;&lt;td&gt;&quot; + temp.getValue().getOpeningBal()
								+ &quot;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot;;
<span class="nc" id="L1295">					}</span>
				}
<span class="nc" id="L1297">				mail.boTextBody += &quot;&lt;/table&gt;&quot;;</span>
			}
<span class="nc" id="L1299">			logger.debug(mail.boTextBody);</span>
<span class="nc" id="L1300">			addBORecipient(mail, type); // add the recipient's mail id into list</span>
<span class="nc" id="L1301">			MailSender mailSender = new MailSender(FROM, PASSWORD, mail.to,</span>
					mail.subject, mail.boTextBody, mail.BO_FILE_NAME); // sending
			// the
			// mail
<span class="nc" id="L1305">			mailSender.setDaemon(true);</span>
<span class="nc" id="L1306">			mailSender.start();</span>

<span class="nc" id="L1308">			return true;</span>
<span class="nc" id="L1309">		} catch (Exception e) {</span>
<span class="nc" id="L1310">			e.printStackTrace();</span>
<span class="nc" id="L1311">			throw new LMSException(e);</span>
		} finally {
<span class="nc" id="L1313">			try {</span>
<span class="nc" id="L1314">				con.close();</span>
<span class="nc" id="L1315">			} catch (SQLException e) {</span>
<span class="nc" id="L1316">				e.printStackTrace();</span>
<span class="nc" id="L1317">				throw new LMSException(e);</span>
<span class="nc" id="L1318">			}</span>
		}

	}

	public MailBean sendDrawReportMail(Timestamp startDate, Timestamp endDate)
			throws LMSException, Exception {
<span class="nc" id="L1325">		MailBean mail = new MailBean();</span>
<span class="nc" id="L1326">		mail.subject = &quot;Daily Draw Report Of &quot;</span>
				+ startDate.toString().substring(8, 10) + '-'
				+ dateBeans.getFirstdate().toString().substring(5, 7) + '-'
				+ dateBeans.getFirstdate().toString().substring(0, 4);
<span class="nc" id="L1330">		mail.boTextBody = &quot;&quot;;</span>
<span class="nc" id="L1331">		mail.BO_FILE_NAME = BodyText.DAILY_FILE;</span>
<span class="nc" id="L1332">		List&lt;Integer&gt; gameNoList = Util.getGameNumberList();</span>
<span class="nc" id="L1333">		DrawGameMgmtHelper dgMgmtHelper = new DrawGameMgmtHelper();</span>
<span class="nc" id="L1334">		this.con = new DBConnect().getConnection();</span>
<span class="nc" id="L1335">		mail.boTextBody += &quot;&lt;table cellpadding='2' border='2' bordercolor='black' cellspacing='0'&gt;&quot;;</span>
<span class="nc" id="L1336">		mail.boTextBody += &quot;&lt;tr&gt;&lt;th colspan=\&quot;11\&quot;&gt;&quot; + mail.subject</span>
				+ &quot;&lt;/th&gt;&lt;/tr&gt;&quot;;
<span class="nc" id="L1338">		mail.boTextBody += &quot;&lt;tr&gt;&quot;;</span>
<span class="nc" id="L1339">		mail.boTextBody += &quot;&lt;th&gt;Game&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1340">		mail.boTextBody += &quot;&lt;th&gt;Draw Date-Time&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1341">		mail.boTextBody += &quot;&lt;th&gt;Status&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1342">		mail.boTextBody += &quot;&lt;th&gt;Winning Result&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1343">		mail.boTextBody += &quot;&lt;th&gt;No. OF Tickets&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1344">		mail.boTextBody += &quot;&lt;th&gt;Sale Value&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1345">		mail.boTextBody += &quot;&lt;th&gt;No. of Winning Tickets&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1346">		mail.boTextBody += &quot;&lt;th&gt;Winning Amount&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1347">		mail.boTextBody += &quot;&lt;/tr&gt;&quot;;</span>
<span class="nc bnc" id="L1348" title="All 2 branches missed.">		for (Integer gameNo : gameNoList) {</span>
<span class="nc" id="L1349">			DrawDataBean drawBean = new DrawDataBean();</span>
<span class="nc" id="L1350">			drawBean.setFromDate(startDate.toString());</span>
<span class="nc" id="L1351">			drawBean.setToDate(endDate.toString());</span>
<span class="nc" id="L1352">			drawBean.setGameNo(gameNo);</span>
<span class="nc" id="L1353">			drawBean.setGameName(Util.getGameDisplayName(gameNo));</span>
<span class="nc" id="L1354">			ReportBeanDrawModule repData = dgMgmtHelper.fetchDrawData(drawBean,</span>
					(String) LMSUtility.sc.getAttribute(&quot;raffle_ticket_type&quot;));
<span class="nc" id="L1356">			List&lt;ReportDrawBean&gt; drawList = repData.getRepGameBean()</span>
					.getRepDrawBean();
<span class="nc bnc" id="L1358" title="All 2 branches missed.">			for (ReportDrawBean drwBean : drawList) {</span>
<span class="nc" id="L1359">				mail.boTextBody += &quot;&lt;tr&gt;&quot;;</span>
<span class="nc" id="L1360">				mail.boTextBody += &quot;&lt;td&gt;&quot; + drawBean.getGameName() + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1361">				mail.boTextBody += &quot;&lt;td&gt;&quot; + drwBean.getDrawDateTime() + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1362">				mail.boTextBody += &quot;&lt;td&gt;&quot; + drwBean.getDrawStatus() + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc bnc" id="L1363" title="All 2 branches missed.">				mail.boTextBody += &quot;&lt;td&gt;&quot;</span>
						+ (drwBean.getWinningResult() == null ? &quot;N.A.&quot;
								: drwBean.getWinningResult()) + &quot;&lt;/td&gt;&quot;;
<span class="nc" id="L1366">				mail.boTextBody += &quot;&lt;td&gt;&quot; + drwBean.getTotalNoTickets()</span>
						+ &quot;&lt;/td&gt;&quot;;
<span class="nc" id="L1368">				mail.boTextBody += &quot;&lt;td&gt;&quot; + drwBean.getTotalSaleValue()</span>
						+ &quot;&lt;/td&gt;&quot;;
<span class="nc" id="L1370">				mail.boTextBody += &quot;&lt;td&gt;&quot; + drwBean.getTotalWinningTickets()</span>
						+ &quot;&lt;/td&gt;&quot;;
<span class="nc" id="L1372">				mail.boTextBody += &quot;&lt;td&gt;&quot; + drwBean.getTotalWinningAmount()</span>
						+ &quot;&lt;/td&gt;&quot;;
<span class="nc" id="L1374">				mail.boTextBody += &quot;&lt;/tr&gt;&quot;;</span>
<span class="nc" id="L1375">			}</span>
<span class="nc" id="L1376">		}</span>
<span class="nc" id="L1377">		mail.boTextBody += &quot;&lt;/table&gt;&quot;;</span>
<span class="nc" id="L1378">		return mail;</span>
	}

	public MailBean sendScratchSalePwtReport(Timestamp startDate,
			Timestamp endDate) throws LMSException, Exception {
<span class="nc" id="L1383">		MailBean mail = new MailBean();</span>
<span class="nc" id="L1384">		mail.subject = &quot;Daily Scratch Sale Pwt Report Of &quot;</span>
				+ startDate.toString().substring(8, 10) + '-'
				+ dateBeans.getFirstdate().toString().substring(5, 7) + '-'
				+ dateBeans.getFirstdate().toString().substring(0, 4);
<span class="nc" id="L1388">		mail.boTextBody = &quot;&quot;;</span>
<span class="nc" id="L1389">		mail.BO_FILE_NAME = BodyText.DAILY_FILE;</span>
<span class="nc" id="L1390">		this.con = new DBConnect().getConnection();</span>
<span class="nc" id="L1391">		IScratchSaleReportHelper scrSale = null;</span>
<span class="nc" id="L1392">		IScratchPwtReportHelper scrPwt = null;</span>
<span class="nc bnc" id="L1393" title="All 2 branches missed.">		if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1394">			scrSale = new ScratchSaleReportHelperSP();</span>
<span class="nc" id="L1395">			scrPwt = new ScratchPwtReportHelperSP();</span>
		} else {
<span class="nc" id="L1397">			scrSale = new ScratchSaleReportHelper();</span>
<span class="nc" id="L1398">			scrPwt = new ScratchPwtReportHelper();</span>

		}
<span class="nc" id="L1401">		List&lt;SalePwtReportsBean&gt; scrSaleList = scrSale.scratchSaleGameWise(</span>
				startDate, endDate);
<span class="nc" id="L1403">		List&lt;SalePwtReportsBean&gt; scrPwtList = scrPwt.scratchPwtGameWise(</span>
				startDate, endDate);
<span class="nc" id="L1405">		Map&lt;Integer, String&gt; gameMap = Util.fetchActiveScratchGameList();</span>
<span class="nc" id="L1406">		mail.boTextBody += &quot;&lt;table cellpadding='2' border='2' bordercolor='black' cellspacing='0'&gt;&quot;;</span>
<span class="nc" id="L1407">		mail.boTextBody += &quot;&lt;tr&gt;&lt;th colspan=\&quot;3\&quot;&gt;&quot; + mail.subject</span>
				+ &quot;&lt;/th&gt;&lt;/tr&gt;&quot;;
<span class="nc" id="L1409">		mail.boTextBody += &quot;&lt;tr&gt;&quot;;</span>
<span class="nc" id="L1410">		mail.boTextBody += &quot;&lt;th&gt;Game&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1411">		mail.boTextBody += &quot;&lt;th&gt;Sale&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1412">		mail.boTextBody += &quot;&lt;th&gt;Pwt&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1413">		mail.boTextBody += &quot;&lt;/tr&gt;&quot;;</span>
<span class="nc bnc" id="L1414" title="All 2 branches missed.">		for (int gameNo : gameMap.keySet()) {</span>
<span class="nc" id="L1415">			boolean sFlag = false;</span>
<span class="nc" id="L1416">			boolean pFlag = false;</span>
<span class="nc" id="L1417">			mail.boTextBody += &quot;&lt;tr&gt;&quot;;</span>
<span class="nc" id="L1418">			mail.boTextBody += &quot;&lt;td&gt;&quot; + gameMap.get(gameNo) + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc bnc" id="L1419" title="All 2 branches missed.">			if (scrSaleList.size() == 0) {</span>
<span class="nc" id="L1420">				mail.boTextBody += &quot;&lt;td&gt;0.00&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1421">				sFlag = true;</span>
			}
<span class="nc bnc" id="L1423" title="All 2 branches missed.">			if (scrPwtList.size() == 0) {</span>
<span class="nc" id="L1424">				mail.boTextBody += &quot;&lt;td&gt;0.00&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1425">				pFlag = true;</span>
			}
<span class="nc bnc" id="L1427" title="All 2 branches missed.">			for (SalePwtReportsBean sBean : scrSaleList) {</span>
<span class="nc bnc" id="L1428" title="All 2 branches missed.">				if (sBean.getGameNo() == gameNo) {</span>
<span class="nc" id="L1429">					mail.boTextBody += &quot;&lt;td&gt;&quot; + sBean.getSaleMrpAmt() + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1430">					sFlag = true;</span>
				}
<span class="nc" id="L1432">			}</span>
<span class="nc bnc" id="L1433" title="All 2 branches missed.">			for (SalePwtReportsBean pBean : scrPwtList) {</span>
<span class="nc bnc" id="L1434" title="All 2 branches missed.">				if (pBean.getGameNo() == gameNo) {</span>
<span class="nc" id="L1435">					mail.boTextBody += &quot;&lt;td&gt;&quot; + pBean.getPwtMrpAmt() + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1436">					pFlag = true;</span>
				}
<span class="nc" id="L1438">			}</span>
<span class="nc bnc" id="L1439" title="All 2 branches missed.">			if (!sFlag) {</span>
<span class="nc" id="L1440">				mail.boTextBody += &quot;&lt;td&gt;0.00&lt;/td&gt;&quot;;</span>
			}
<span class="nc bnc" id="L1442" title="All 2 branches missed.">			if (!pFlag) {</span>
<span class="nc" id="L1443">				mail.boTextBody += &quot;&lt;td&gt;0.00&lt;/td&gt;&quot;;</span>
			}
<span class="nc" id="L1445">			mail.boTextBody += &quot;&lt;/tr&gt;&quot;;</span>
<span class="nc" id="L1446">		}</span>
<span class="nc" id="L1447">		mail.boTextBody += &quot;&lt;/table&gt;&quot;;</span>
<span class="nc" id="L1448">		return mail;</span>
	}

	public MailBean sendDrawSalePwtReport(Timestamp startDate, Timestamp endDate)
			throws LMSException, Exception {
<span class="nc" id="L1453">		MailBean mail = new MailBean();</span>

<span class="nc" id="L1455">		mail.subject = &quot;Daily Draw Sale Pwt Report Of &quot;</span>
				+ startDate.toString().substring(8, 10) + '-'
				+ dateBeans.getFirstdate().toString().substring(5, 7) + '-'
				+ dateBeans.getFirstdate().toString().substring(0, 4);
<span class="nc" id="L1459">		mail.boTextBody = &quot;&quot;;</span>
<span class="nc" id="L1460">		mail.BO_FILE_NAME = BodyText.DAILY_FILE;</span>
<span class="nc" id="L1461">		this.con = DBConnect.getConnection();</span>
<span class="nc" id="L1462">		IDrawSaleReportHelper drwSale = null;</span>
<span class="nc" id="L1463">		IDrawPwtReportHelper drwPwt = null;</span>

<span class="nc bnc" id="L1465" title="All 2 branches missed.">		if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1466">			drwSale = new DrawSaleReportHelperSP();</span>
<span class="nc" id="L1467">			drwPwt = new DrawPwtReportHelperSP();</span>
		} else {
<span class="nc" id="L1469">			drwSale = new DrawSaleReportHelper();</span>
<span class="nc" id="L1470">			drwPwt = new DrawPwtReportHelper();</span>
		}
<span class="nc" id="L1472">		List&lt;SalePwtReportsBean&gt; drwSaleList = drwSale.drawSaleGameWise(</span>
				startDate, endDate);
<span class="nc" id="L1474">		List&lt;SalePwtReportsBean&gt; drwPwtList = drwPwt.drawPwtGameWise(startDate,</span>
				endDate);
<span class="nc" id="L1476">		Map&lt;Integer, SalePwtReportsBean&gt; map = new TreeMap&lt;Integer, SalePwtReportsBean&gt;();</span>
<span class="nc" id="L1477">		List&lt;Integer&gt; gameNoList = Util.getGameNumberList();</span>
<span class="nc bnc" id="L1478" title="All 2 branches missed.">		for (int gno : gameNoList) {</span>
<span class="nc" id="L1479">			SalePwtReportsBean tempBean = new SalePwtReportsBean();</span>
<span class="nc" id="L1480">			map.put(gno, tempBean);</span>
<span class="nc" id="L1481">		}</span>
<span class="nc bnc" id="L1482" title="All 2 branches missed.">		for (SalePwtReportsBean sBean : drwSaleList) {</span>
<span class="nc" id="L1483">			map.get(sBean.getGameNo()).setSaleMrpAmt(sBean.getSaleMrpAmt());</span>
<span class="nc" id="L1484">		}</span>
<span class="nc bnc" id="L1485" title="All 2 branches missed.">		for (SalePwtReportsBean pBean : drwPwtList) {</span>
<span class="nc" id="L1486">			map.get(pBean.getGameNo()).setPwtMrpAmt(pBean.getPwtMrpAmt());</span>
<span class="nc" id="L1487">		}</span>
<span class="nc" id="L1488">		mail.boTextBody += &quot;&lt;table cellpadding='2' border='2' bordercolor='black' cellspacing='0'&gt;&quot;;</span>
<span class="nc" id="L1489">		mail.boTextBody += &quot;&lt;tr&gt;&lt;th colspan=\&quot;3\&quot;&gt;&quot; + mail.subject</span>
				+ &quot;&lt;/th&gt;&lt;/tr&gt;&quot;;
<span class="nc" id="L1491">		mail.boTextBody += &quot;&lt;tr&gt;&quot;;</span>
<span class="nc" id="L1492">		mail.boTextBody += &quot;&lt;th&gt;Game&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1493">		mail.boTextBody += &quot;&lt;th&gt;Sale&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1494">		mail.boTextBody += &quot;&lt;th&gt;Pwt&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1495">		mail.boTextBody += &quot;&lt;/tr&gt;&quot;;</span>
<span class="nc bnc" id="L1496" title="All 2 branches missed.">		for (int gameNo : gameNoList) {</span>
<span class="nc" id="L1497">			mail.boTextBody += &quot;&lt;tr&gt;&quot;;</span>
<span class="nc" id="L1498">			mail.boTextBody += &quot;&lt;td&gt;&quot; + Util.getGameDisplayName(gameNo)</span>
					+ &quot;&lt;/td&gt;&quot;;
<span class="nc" id="L1500">			mail.boTextBody += &quot;&lt;td&gt;&quot; + map.get(gameNo).getSaleMrpAmt()</span>
					+ &quot;&lt;/td&gt;&quot;;
<span class="nc" id="L1502">			mail.boTextBody += &quot;&lt;td&gt;&quot; + map.get(gameNo).getPwtMrpAmt()</span>
					+ &quot;&lt;/td&gt;&quot;;
<span class="nc" id="L1504">			mail.boTextBody += &quot;&lt;/tr&gt;&quot;;</span>
<span class="nc" id="L1505">		}</span>
<span class="nc" id="L1506">		mail.boTextBody += &quot;&lt;/table&gt;&quot;;</span>
<span class="nc" id="L1507">		return mail;</span>
	}

	public MailBean sendRetActivityReport(Timestamp startDate, Timestamp endDate)
			throws LMSException, Exception {
<span class="nc" id="L1512">		MailBean mail = new MailBean();</span>
<span class="nc" id="L1513">		mail.subject = &quot;Retailer Activity Report Of &quot;</span>
				+ startDate.toString().substring(8, 10) + '-'
				+ dateBeans.getFirstdate().toString().substring(5, 7) + '-'
				+ dateBeans.getFirstdate().toString().substring(0, 4);
<span class="nc" id="L1517">		mail.boTextBody = &quot;&quot;;</span>
<span class="nc" id="L1518">		mail.BO_FILE_NAME = BodyText.DAILY_FILE;</span>
<span class="nc" id="L1519">		DateBeans dBean = new DateBeans();</span>
<span class="nc" id="L1520">		dBean.setFirstdate(new java.sql.Date(startDate.getTime()));</span>
<span class="nc" id="L1521">		dBean.setLastdate(new java.sql.Date(endDate.getTime()));</span>
<span class="nc" id="L1522">		RetActivityReportHelper retHelper = new RetActivityReportHelper();</span>
<span class="nc" id="L1523">		List&lt;String&gt; histList = retHelper.fetchActRepHistoryForDrawGame(dBean);</span>
<span class="nc" id="L1524">		this.con = new DBConnect().getConnection();</span>
<span class="nc" id="L1525">		mail.boTextBody += &quot;&lt;table cellpadding='2' border='2' bordercolor='black' cellspacing='0'&gt;&quot;;</span>
<span class="nc" id="L1526">		mail.boTextBody += &quot;&lt;tr&gt;&lt;th colspan=\&quot;4\&quot;&gt;&quot; + mail.subject</span>
				+ &quot;&lt;/th&gt;&lt;/tr&gt;&quot;;
<span class="nc" id="L1528">		mail.boTextBody += &quot;&lt;tr&gt;&quot;;</span>
<span class="nc" id="L1529">		mail.boTextBody += &quot;&lt;th&gt;Live Retailers&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1530">		mail.boTextBody += &quot;&lt;th&gt;No Sale Retailers&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1531">		mail.boTextBody += &quot;&lt;th&gt;Inactive Retailers&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1532">		mail.boTextBody += &quot;&lt;th&gt;Terminated Retailers&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1533">		mail.boTextBody += &quot;&lt;/tr&gt;&quot;;</span>
<span class="nc bnc" id="L1534" title="All 2 branches missed.">		if (histList.size() &gt; 0) {</span>
<span class="nc" id="L1535">			String[] histData = histList.get(0).split(&quot;,&quot;);</span>
<span class="nc" id="L1536">			mail.boTextBody += &quot;&lt;tr&gt;&quot;;</span>
<span class="nc" id="L1537">			mail.boTextBody += &quot;&lt;td&gt;&quot; + histData[2] + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1538">			mail.boTextBody += &quot;&lt;td&gt;&quot; + histData[3] + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1539">			mail.boTextBody += &quot;&lt;td&gt;&quot; + histData[4] + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1540">			mail.boTextBody += &quot;&lt;td&gt;&quot; + histData[5] + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1541">			mail.boTextBody += &quot;&lt;/tr&gt;&quot;;</span>
<span class="nc" id="L1542">		} else {</span>
<span class="nc" id="L1543">			mail.boTextBody += &quot;&lt;tr&gt;&quot;;</span>
<span class="nc" id="L1544">			mail.boTextBody += &quot;&lt;td colspan=\&quot;4\&quot;&gt;no records found for tha day&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1545">			mail.boTextBody += &quot;&lt;/tr&gt;&quot;;</span>
		}
<span class="nc" id="L1547">		mail.boTextBody += &quot;&lt;/table&gt;&quot;;</span>
<span class="nc" id="L1548">		return mail;</span>
	}

	public MailBean sendCashCollectionReport() throws LMSException, Exception {
<span class="nc" id="L1552">		MailBean mail = new MailBean();</span>
<span class="nc" id="L1553">		Calendar cd = Calendar.getInstance();</span>
<span class="nc" id="L1554">		cd.setTime(new java.util.Date());</span>
<span class="nc" id="L1555">		String dd = cd.get(Calendar.DAY_OF_MONTH) + &quot;&quot;;</span>
<span class="nc" id="L1556">		String mm = cd.get(Calendar.MONTH) + &quot;&quot;;</span>
<span class="nc" id="L1557">		String yy = cd.get(Calendar.YEAR) + &quot;&quot;;</span>
<span class="nc bnc" id="L1558" title="All 2 branches missed.">		if (dd.length() &lt;= 1) {</span>
<span class="nc" id="L1559">			dd = &quot;0&quot; + dd;</span>
		}
<span class="nc bnc" id="L1561" title="All 2 branches missed.">		if (mm.length() &lt;= 1) {</span>
<span class="nc" id="L1562">			mm = &quot;0&quot; + mm;</span>
		}
<span class="nc" id="L1564">		mail.subject = &quot;Cash Collection Report Of &quot; + dd + &quot;-&quot; + mm + &quot;-&quot; + yy;</span>
<span class="nc" id="L1565">		mail.boTextBody = &quot;&quot;;</span>
<span class="nc" id="L1566">		mail.BO_FILE_NAME = BodyText.DAILY_FILE;</span>
<span class="nc" id="L1567">		DateBeans dBean = new DateBeans();</span>
<span class="nc" id="L1568">		dBean.setFirstdate(new java.sql.Date(new Date().getTime()));</span>
<span class="nc" id="L1569">		dBean.setLastdate(new java.sql.Date(new Date().getTime() + 24 * 60 * 60</span>
				* 1000));

<span class="nc" id="L1572">		ICashChqReportsHelper cashChqHelper = null;</span>

<span class="nc bnc" id="L1574" title="All 2 branches missed.">		if (LMSFilterDispatcher.isRepFrmSP) {</span>
<span class="nc" id="L1575">			cashChqHelper = new CashChqReportsHelperSP(dBean);</span>
		} else {
<span class="nc" id="L1577">			cashChqHelper = new CashChqReportsHelper(dBean);</span>
		}

<span class="nc" id="L1580">		List&lt;Integer&gt; agtOrgIdList = cashChqHelper.getAgentOrgList();</span>
<span class="nc" id="L1581">		List&lt;CashChqReportBean&gt; cashChqData = cashChqHelper.getCashChqDetail(</span>
				agtOrgIdList, -1, false);
<span class="nc" id="L1583">		mail.boTextBody += &quot;&lt;table cellpadding='2' border='2' bordercolor='black' cellspacing='0'&gt;&quot;;</span>
<span class="nc" id="L1584">		mail.boTextBody += &quot;&lt;tr&gt;&lt;th colspan=\&quot;6\&quot;&gt;&quot; + mail.subject</span>
				+ &quot;&lt;/th&gt;&lt;/tr&gt;&quot;;
<span class="nc" id="L1586">		mail.boTextBody += &quot;&lt;tr&gt;&quot;;</span>
<span class="nc" id="L1587">		mail.boTextBody += &quot;&lt;th&gt;Name&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1588">		mail.boTextBody += &quot;&lt;th&gt;Cash&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1589">		mail.boTextBody += &quot;&lt;th&gt;Cheque&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1590">		mail.boTextBody += &quot;&lt;th&gt;Cheque bounce&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1591">		mail.boTextBody += &quot;&lt;th&gt;Credit&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1592">		mail.boTextBody += &quot;&lt;th&gt;Debit&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1593">		mail.boTextBody += &quot;&lt;th&gt;Bank Deposit&lt;/th&gt;&quot;;</span>
<span class="nc" id="L1594">		mail.boTextBody += &quot;&lt;/tr&gt;&quot;;</span>
<span class="nc bnc" id="L1595" title="All 2 branches missed.">		if (cashChqData.size() &gt; 0) {</span>
<span class="nc bnc" id="L1596" title="All 2 branches missed.">			for (CashChqReportBean cbean : cashChqData) {</span>
<span class="nc" id="L1597">				mail.boTextBody += &quot;&lt;tr&gt;&quot;;</span>
<span class="nc" id="L1598">				mail.boTextBody += &quot;&lt;td&gt;&quot; + cbean.getName() + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1599">				mail.boTextBody += &quot;&lt;td&gt;&quot; + cbean.getTotalCash() + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1600">				mail.boTextBody += &quot;&lt;td&gt;&quot; + cbean.getTotalChq() + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1601">				mail.boTextBody += &quot;&lt;td&gt;&quot; + cbean.getCheqBounce() + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1602">				mail.boTextBody += &quot;&lt;td&gt;&quot; + cbean.getCredit() + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1603">				mail.boTextBody += &quot;&lt;td&gt;&quot; + cbean.getDebit() + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1604">				mail.boTextBody += &quot;&lt;td&gt;&quot; + cbean.getBankDeposit() + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L1605">				mail.boTextBody += &quot;&lt;/tr&gt;&quot;;</span>
<span class="nc" id="L1606">			}</span>
		} else {
<span class="nc" id="L1608">			mail.boTextBody = &quot;&lt;tr&gt;&lt;td&gt;no records found for tha day&lt;td&gt;&lt;/tr&gt;&quot;;</span>
		}
<span class="nc" id="L1610">		mail.boTextBody += &quot;&lt;/table&gt;&quot;;</span>
<span class="nc" id="L1611">		return mail;</span>
	}

	public void allDailyReportsCombined() throws LMSException, Exception {
<span class="nc" id="L1615">		SendReportMailerMain srm = new SendReportMailerMain(new DateBeans());</span>
<span class="nc" id="L1616">		MailBean jointMail = new MailBean();</span>
<span class="nc" id="L1617">		SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L1618">		Timestamp startDate = new Timestamp(sdf.parse(</span>
				sdf.format(dateBeans.getFirstdate())).getTime());
<span class="nc" id="L1620">		Timestamp endDate = new Timestamp(sdf.parse(</span>
				sdf.format(dateBeans.getLastdate())).getTime()
				- 24 * 60 * 60 * 1000);
<span class="nc" id="L1623">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L1624">		cal.setTime(endDate);</span>
<span class="nc" id="L1625">		cal.add(Calendar.HOUR, 23);</span>
<span class="nc" id="L1626">		cal.add(Calendar.MINUTE, 59);</span>
<span class="nc" id="L1627">		cal.add(Calendar.SECOND, 59);</span>
<span class="nc" id="L1628">		endDate = new Timestamp(cal.getTime().getTime());</span>
<span class="nc" id="L1629">		String PASSWORD = MailBean.PASSWORD;</span>
<span class="nc" id="L1630">		String FROM = MailBean.DAILY_MAIL_FROM;</span>
<span class="nc" id="L1631">		this.con = new DBConnect().getConnection();</span>
<span class="nc" id="L1632">		jointMail.subject = &quot;Daily Reports Of &quot;</span>
				+ startDate.toString().substring(8, 10) + '-'
				+ dateBeans.getFirstdate().toString().substring(5, 7) + '-'
				+ dateBeans.getFirstdate().toString().substring(0, 4);
<span class="nc" id="L1636">		jointMail.boTextBody += &quot;&lt;table width=\&quot;100%\&quot;&gt;&lt;tr&gt;&lt;th align=\&quot;center\&quot;&gt;&quot;</span>
				+ jointMail.subject + &quot;&lt;/th&gt;&lt;tr&gt;&lt;/table&gt;&quot;;
<span class="nc" id="L1638">		jointMail.boTextBody += srm.sendDrawReportMail(startDate, endDate).boTextBody</span>
				+ &quot;&lt;br/&gt;&quot;
				+ srm.sendDrawSalePwtReport(startDate, endDate).boTextBody
				+ &quot;&lt;br/&gt;&quot;
				+ srm.sendScratchSalePwtReport(startDate, endDate).boTextBody
				+ &quot;&lt;br/&gt;&quot;
				+ srm.sendRetActivityReport(startDate, endDate).boTextBody
				+ &quot;&lt;br/&gt;&quot; + srm.sendCashCollectionReport().boTextBody + &quot;&lt;br/&gt;&quot;;
<span class="nc" id="L1646">		addBORecipient(jointMail, &quot;Daily&quot;);</span>
<span class="nc" id="L1647">		MailSender mailSender = new MailSender(FROM, PASSWORD, jointMail.to,</span>
				jointMail.subject, jointMail.boTextBody, &quot;&quot;);
<span class="nc" id="L1649">		mailSender.setDaemon(true);</span>
<span class="nc" id="L1650">		mailSender.start();</span>

<span class="nc" id="L1652">	}</span>

	public void dailyReport() throws LMSException {

<span class="nc" id="L1656">		TreeMap&lt;Integer, ArrayList&lt;Double&gt;&gt; gameDataMap = new TreeMap&lt;Integer, ArrayList&lt;Double&gt;&gt;();</span>

<span class="nc" id="L1658">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L1659">		DrawGameMgmtHelper helper = new DrawGameMgmtHelper();</span>
<span class="nc" id="L1660">		DrawDataBean drawDataBean = new DrawDataBean();</span>

<span class="nc" id="L1662">		ServletContext sc = ServletActionContext.getServletContext();</span>
<span class="nc" id="L1663">		String raffleTktType = (String) sc.getAttribute(&quot;raffle_ticket_type&quot;);</span>

<span class="nc" id="L1665">		ResultSet rs = null;</span>
<span class="nc" id="L1666">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1667">		ArrayList&lt;Double&gt; totAmt = null;</span>
<span class="nc" id="L1668">		int gameNum = 0;</span>
<span class="nc" id="L1669">		List&lt;Integer&gt; gameNumList = Util.getGameNumberList();</span>
<span class="nc" id="L1670">		int totalRet = 0;</span>
<span class="nc" id="L1671">		double totSale = 0;</span>
<span class="nc" id="L1672">		double totPwt = 0;</span>
<span class="nc" id="L1673">		int count = 0;</span>

<span class="nc" id="L1675">		String date = new java.sql.Date(new Date().getTime()) + &quot;&quot;;</span>

<span class="nc" id="L1677">		String fromDate = date + &quot; 00:00:00&quot;;</span>
<span class="nc" id="L1678">		String toDate = date + &quot; 23:59:59&quot;;</span>
<span class="nc" id="L1679">		drawDataBean.setFromDate(fromDate);</span>
<span class="nc" id="L1680">		drawDataBean.setToDate(toDate);</span>
<span class="nc" id="L1681">		String trxDate = &quot;transaction_date&gt;'&quot; + fromDate</span>
				+ &quot;' and transaction_date&lt;'&quot; + toDate + &quot;'&quot;;
<span class="nc" id="L1683">		String trxQry = &quot;select transaction_id from st_lms_retailer_transaction_master where &quot;</span>
				+ trxDate;

<span class="nc" id="L1686">		String retQry = &quot;select count(distinct(retailer_org_id)) retCount from st_lms_retailer_transaction_master where transaction_date&gt;'&quot;</span>
				+ fromDate + &quot;' and transaction_date&lt;'&quot; + toDate + &quot;' &quot;;
<span class="nc" id="L1688">		StringBuilder retActiveRep = new StringBuilder(</span>
				&quot;&lt;br/&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;b&gt;Total Active Retailers of the Day&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&quot;);
		try {
<span class="nc" id="L1691">			pstmt = con.prepareStatement(retQry);</span>
<span class="nc" id="L1692">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1693" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L1694">				totalRet = rs.getInt(&quot;retCount&quot;);</span>
			}
<span class="nc" id="L1696">			retActiveRep.append(totalRet + &quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;);</span>

<span class="nc" id="L1698">			String combinedQry = &quot;select if(sale.res is null ,0,sale.res)+if(saleref.res is null ,0,saleref.res) as res from (select sum(mrp_amt) res from st_dg_ret_sale_? where transaction_id in (&quot;</span>
					+ trxQry
					+ &quot;)) sale,(select sum(mrp_amt) res  from st_dg_ret_sale_refund_? where transaction_id in (&quot;
					+ trxQry
					+ &quot;)) saleref union all select if(pwt.res is null ,0,pwt.res)+pwtdir.dirPwt as res from (select sum(pwt_amt) res from st_dg_ret_pwt_? where transaction_id in (&quot;
					+ trxQry
					+ &quot;) ) pwt,( select if(a.pwt_amt is null ,0,a.pwt_amt)+if(b.pwt_amt is null ,0,b.pwt_amt) dirPwt from (select sum(pwt_amt) pwt_amt from st_dg_bo_direct_plr_pwt where &quot;
					+ trxDate
					+ &quot; and game_id=?) a,(select sum(pwt_amt) pwt_amt from st_dg_agt_direct_plr_pwt where &quot;
					+ trxDate + &quot;  and game_id=?) b) pwtdir&quot;;
<span class="nc" id="L1708">			StringBuilder gamewiseRep = new StringBuilder(</span>
					&quot;&lt;table width=\&quot;50%\&quot; border=\&quot;1\&quot; cellpadding=\&quot;2\&quot; cellspacing=\&quot;0\&quot;	bordercolor=\&quot;#CCCCCC\&quot; align=\&quot;center\&quot;&gt;&lt;tr align=\&quot;center\&quot; style=\&quot;font-weight:bold\&quot;&gt;&lt;td&gt;Game Name&lt;/td&gt;&lt;td&gt;Sale&lt;/td&gt;&lt;td&gt;PWT&lt;/td&gt;&lt;/tr&gt;&quot;);

<span class="nc bnc" id="L1711" title="All 2 branches missed.">			for (int i = 0; i &lt; gameNumList.size(); i++) {</span>
<span class="nc" id="L1712">				gameNum = gameNumList.get(i);</span>
<span class="nc" id="L1713">				totAmt = new ArrayList&lt;Double&gt;();</span>
<span class="nc" id="L1714">				pstmt = con.prepareStatement(combinedQry);</span>
<span class="nc" id="L1715">				pstmt.setInt(1, gameNum);</span>
<span class="nc" id="L1716">				pstmt.setInt(2, gameNum);</span>
<span class="nc" id="L1717">				pstmt.setInt(3, gameNum);</span>
<span class="nc" id="L1718">				pstmt.setInt(4, gameNum);</span>
<span class="nc" id="L1719">				pstmt.setInt(5, gameNum);</span>
<span class="nc" id="L1720">				System.out.println(combinedQry);</span>
<span class="nc" id="L1721">				rs = pstmt.executeQuery();</span>
<span class="nc" id="L1722">				gamewiseRep.append(&quot;&lt;tr  align=\&quot;right\&quot;&gt;&lt;td&gt;&quot;</span>
						+ Util.getGameDisplayName(gameNum) + &quot;&lt;/td&gt;&quot;);
<span class="nc" id="L1724">				count = 0;</span>
<span class="nc bnc" id="L1725" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L1726">					gamewiseRep.append(&quot;&lt;td&gt;&quot; + rs.getDouble(&quot;res&quot;) + &quot;&lt;/td&gt;&quot;);</span>
<span class="nc" id="L1727">					totAmt.add(rs.getDouble(&quot;res&quot;));</span>
<span class="nc bnc" id="L1728" title="All 2 branches missed.">					if (count == 0) {</span>
<span class="nc" id="L1729">						totSale = totSale + rs.getDouble(&quot;res&quot;);</span>
					} else {
<span class="nc" id="L1731">						totPwt = totPwt + rs.getDouble(&quot;res&quot;);</span>
					}
				}
<span class="nc" id="L1734">				gamewiseRep.append(&quot;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L1735">				gameDataMap.put(gameNum, totAmt);</span>
			}
<span class="nc" id="L1737">			gamewiseRep</span>
					.append(&quot;&lt;tr align=\&quot;right\&quot; style=\&quot;font-weight:bold\&quot;&gt;&lt;td&gt;Total&lt;/td&gt;&lt;td&gt;&quot;
							+ totSale + &quot;&lt;/td&gt;&lt;td&gt;&quot; + totPwt + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
<span class="nc" id="L1740">			gamewiseRep.append(&quot;&lt;/table&gt;&lt;br/&gt;&quot;);</span>
<span class="nc" id="L1741">			StringBuilder gameRep = new StringBuilder(</span>
					&quot;&lt;table border=\&quot;1\&quot; bordercolor=\&quot;black\&quot;&gt;&quot;);
<span class="nc" id="L1743">			gameRep</span>
					.append(&quot;&lt;tr&gt;&lt;td width=\&quot;80%\&quot; align=\&quot;center\&quot;&gt;&lt;b&gt;Draw Report of &quot;
							+ date + &quot;&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);
<span class="nc" id="L1746">			System.out.println(&quot;***************&quot; + gameNumList);</span>
<span class="nc" id="L1747">			gameRep.append(&quot;&lt;tr&gt;&lt;td&gt;&quot; + gamewiseRep + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc bnc" id="L1748" title="All 2 branches missed.">			for (int i = 0; i &lt; gameNumList.size(); i++) {</span>
<span class="nc" id="L1749">				gameRep.append(&quot;&lt;tr&gt;&lt;td width=\&quot;80%\&quot;&gt;&quot;);</span>
<span class="nc" id="L1750">				gameNum = gameNumList.get(i);</span>
<span class="nc" id="L1751">				gameRep</span>
						.append(&quot;&lt;table width=\&quot;100%\&quot; border=\&quot;1\&quot; cellpadding=\&quot;2\&quot; cellspacing=\&quot;0\&quot;	bordercolor=\&quot;#CCCCCC\&quot; align=\&quot;center\&quot;&gt;&lt;tr align=\&quot;center\&quot; style=\&quot;font-weight:bold\&quot;&gt;&lt;td colspan=7&gt;&quot;
								+ Util.getGameDisplayName(gameNum)
								+ &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
<span class="nc" id="L1755">				gameRep</span>
						.append(&quot;&lt;tr align=\&quot;center\&quot; style=\&quot;font-weight:bold\&quot;&gt;&lt;td&gt;Draw Date&lt;/td&gt;&lt;td&gt;Draw Status&lt;/td&gt;&lt;td&gt;Total Tickets&lt;/td&gt;&lt;td&gt;Total Sale&lt;/td&gt;&lt;td&gt;Total Winning&lt;/td&gt;&lt;td&gt;Avg. Per Tkt Cost&lt;/td&gt;&lt;td&gt;Avg. Sale Per Ret&lt;/td&gt;&lt;/tr&gt;&quot;);
<span class="nc" id="L1757">				drawDataBean.setGameNo(gameNum);</span>
<span class="nc" id="L1758">				List&lt;ReportDrawBean&gt; l = helper.fetchDrawData(drawDataBean,</span>
						raffleTktType).getRepGameBean().getRepDrawBean();
<span class="nc" id="L1760">				System.out.println(&quot;***************&quot; + l);</span>
<span class="nc bnc" id="L1761" title="All 2 branches missed.">				for (int j = 0; j &lt; l.size(); j++) {</span>
<span class="nc" id="L1762">					ReportDrawBean rdb = l.get(j);</span>
<span class="nc bnc" id="L1763" title="All 4 branches missed.">					gameRep</span>
							.append(&quot;&lt;tr align=\&quot;right\&quot;&gt;&lt;td&gt;&quot;
									+ rdb.getDrawDateTime()
									+ &quot;&lt;/td&gt;&lt;td&gt;&quot;
									+ rdb.getDrawStatus()
									+ &quot;&lt;/td&gt;&lt;td&gt;&quot;
									+ rdb.getTotalNoTickets()
									+ &quot;&lt;/td&gt;&lt;td&gt;&quot;
									+ rdb.getTotalSaleValue()
									+ &quot;&lt;/td&gt;&lt;td&gt;&quot;
									+ rdb.getTotalWinningAmount()
									+ &quot;&lt;/td&gt;&lt;td&gt;&quot;
									+ (rdb.getTotalSaleValue() &gt; 0 ? (rdb
											.getTotalSaleValue() / rdb
											.getTotalNoTickets()) : rdb
											.getTotalSaleValue())
									+ &quot;&lt;/td&gt;&lt;td&gt;&quot;
									+ (totalRet &gt; 0 ? (rdb.getTotalSaleValue() / totalRet)
											: &quot;N.A.&quot;) + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
				}
<span class="nc" id="L1783">				gameRep.append(&quot;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
			}
<span class="nc" id="L1785">			gameRep.append(&quot;&lt;tr align=\&quot;center\&quot;&gt;&lt;td&gt;&quot; + retActiveRep</span>
					+ &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
<span class="nc" id="L1787">			gameRep.append(&quot;&lt;/table&gt;&lt;br/&gt;&quot;);</span>

<span class="nc" id="L1789">			System.out.println(gameRep);</span>
<span class="nc" id="L1790">			MailBean mail = new MailBean();</span>
			// SimpleDateFormat dateFormat=new SimpleDateFormat(&quot;dd-MMM-yyyy&quot;);
<span class="nc" id="L1792">			String FROM = null;</span>
<span class="nc" id="L1793">			String PASSWORD = MailBean.PASSWORD;</span>
<span class="nc" id="L1794">			String type = &quot;&quot;;</span>

<span class="nc" id="L1796">			mail.subject = BodyText.DAILY_SUBJECT;</span>
<span class="nc" id="L1797">			FROM = MailBean.DAILY_MAIL_FROM;</span>
<span class="nc" id="L1798">			type = &quot;Daily&quot;;</span>

<span class="nc" id="L1800">			addBORecipient(mail, type);</span>

			// sending the mail
<span class="nc" id="L1803">			MailSender mailSender = new MailSender(FROM, PASSWORD, mail.to,</span>
					mail.subject, gameRep.toString(), mail.BO_FILE_NAME);
<span class="nc" id="L1805">			mailSender.setDaemon(true);</span>
<span class="nc" id="L1806">			mailSender.start();</span>
<span class="nc" id="L1807">		} catch (Exception e) {</span>
<span class="nc" id="L1808">			e.printStackTrace();</span>
<span class="nc" id="L1809">			throw new LMSException(&quot;Daily Draw Report Not Send&quot;);</span>
<span class="nc" id="L1810">		}</span>
<span class="nc" id="L1811">	}</span>

	public String sendMailAfterDrawPerform(
			List&lt;ReportDrawBean&gt; mailPerformedDraw) throws LMSException {
<span class="nc" id="L1815">		MailBean mail = new MailBean();</span>
<span class="nc" id="L1816">		mail.subject = &quot;Draw Details&quot;;</span>
<span class="nc" id="L1817">		mail.boTextBody = &quot;Details Of Recently Performed Draws&quot;;</span>
<span class="nc" id="L1818">		String FROM = MailBean.DAILY_MAIL_FROM;</span>
<span class="nc" id="L1819">		String PASSWORD = MailBean.PASSWORD;</span>
<span class="nc" id="L1820">		String type = &quot;Performed&quot;;</span>
<span class="nc" id="L1821">		String status = &quot;Mail Sent&quot;;</span>
<span class="nc" id="L1822">		File fileObj = null;</span>

<span class="nc" id="L1824">		Iterator&lt;ReportDrawBean&gt; mailPerformedDrawListIterator = mailPerformedDraw</span>
				.iterator();

<span class="nc" id="L1827">		mail.boTextBody += &quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;b&gt;Details of Performed Draws &lt;/b&gt;&quot;;</span>
<span class="nc" id="L1828">		mail.boTextBody += &quot;&lt;br&gt;&lt;br&gt; &lt;table cellpadding='8' border='2' bordercolor='red' cellspacing='0'&gt;&quot;;</span>

<span class="nc" id="L1830">		int count = 0;</span>
<span class="nc" id="L1831">		ReportDrawBean bean = null;</span>
<span class="nc bnc" id="L1832" title="All 2 branches missed.">		while (mailPerformedDrawListIterator.hasNext()) {</span>
<span class="nc" id="L1833">			bean = mailPerformedDrawListIterator.next();</span>
<span class="nc" id="L1834">			count++;</span>

<span class="nc" id="L1836">			mail.boTextBody += &quot;&lt;tr&gt;&lt;td align='left' width='200'&gt;&lt;B&gt;&quot; + count</span>
					+ &quot;&lt;/B&gt;&lt;/td&gt;&lt;/tr&gt;&quot; + &quot;&lt;tr&gt;&quot;
					+ &quot;&lt;td width='200'&gt;Draw Id&lt;/td&gt;&quot;
					+ &quot;&lt;td width='200'&gt;Draw Name&lt;/td&gt;&quot;
					+ &quot;&lt;td width='200'&gt;Date Time&lt;/td&gt;&quot;
					+ &quot;&lt;td width='200'&gt;Draw Day&lt;/td&gt;&quot;
					+ &quot;&lt;td width='200'&gt;Winning Result&lt;/td&gt;&quot;
					+ &quot;&lt;td width='200'&gt;Draw Status&lt;/td&gt;&quot;
					+ &quot;&lt;td width='200'&gt;Sold Tickets&lt;/td&gt;&quot;
					+ &quot;&lt;td width='200'&gt;Sale Amount&lt;/td&gt;&quot;
					+ &quot;&lt;td width='200'&gt;Winning Tickets&lt;/td&gt;&quot;
					+ &quot;&lt;td width='200'&gt;Winning Amount&lt;/td&gt;&lt;/tr&gt;&quot;
					+ &quot;&lt;tr&gt;&lt;td align='right' width='150'&gt;&quot; + bean.getDrawId()
					+ &quot;&lt;/td&gt;&lt;td align='right' width='150'&gt;&quot;
					+ bean.getDrawName()
					+ &quot;&lt;/td&gt;&lt;td align='right' width='150'&gt;&quot;
					+ bean.getDrawDateTime()
					+ &quot;&lt;/td&gt;&lt;td align='right' width='150'&gt;&quot; + bean.getDrawDay()
					+ &quot;&lt;/td&gt;&lt;td align='right' width='150'&gt;&quot;
					+ bean.getWinningResult()
					+ &quot;&lt;/td&gt;&lt;td align='right' width='150'&gt;&quot;
					+ bean.getDrawStatus()
					+ &quot;&lt;/td&gt;&lt;td align='right' width='150'&gt;&quot;
					+ bean.getTotalNoTickets()
					+ &quot;&lt;/td&gt;&lt;td align='right' width='150'&gt;&quot;
					+ bean.getTotalSaleValue()
					+ &quot;&lt;/td&gt;&lt;td align='right' width='150'&gt;&quot;
					+ bean.getTotalWinningTickets()
					+ &quot;&lt;/td&gt;&lt;td align='right' width='150'&gt;&quot;
					+ bean.getTotalWinningAmount() + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;;
		}
		
<span class="nc" id="L1868">		fileObj = new PPRSheetHelper().preparePPRSheet(mailPerformedDraw, Utility.getPropertyValue(&quot;COUNTRY_DEPLOYED&quot;) + &quot;.xls&quot;);</span>
		
<span class="nc" id="L1870">		this.con = DBConnect.getConnection();</span>
<span class="nc" id="L1871">		addBORecipient(mail, type);</span>
//		mail.to.add(&quot;dushyant.sapra@skilrock.com&quot;);
		try {
<span class="nc" id="L1874">			MailSender mailSender = new MailSender(FROM, PASSWORD, mail.to,</span>
					mail.subject, mail.boTextBody, fileObj, &quot;PPR_&quot; + Utility.getPropertyValue(&quot;COUNTRY_DEPLOYED&quot;) + &quot;.xls&quot;);
<span class="nc" id="L1876">			mailSender.setDaemon(true);</span>
<span class="nc" id="L1877">			mailSender.start();</span>
<span class="nc" id="L1878">			return status;</span>
<span class="nc" id="L1879">		} catch (Exception e) {</span>
<span class="nc" id="L1880">			e.printStackTrace();</span>
<span class="nc" id="L1881">			status = &quot;Not Sent&quot;;</span>
		}
<span class="nc" id="L1883">		return status;</span>
	}

	public String sendMailAfterTrackTicketLimitReached(String userOrgName) throws LMSException {
<span class="nc" id="L1887">		MailBean mail = new MailBean();</span>
<span class="nc" id="L1888">		mail.subject = &quot;Track Ticket Limit Reached&quot;;</span>
<span class="nc" id="L1889">		mail.boTextBody = &quot;User &quot;+userOrgName+&quot; Reached Maximum Attempt Limit for Tracking Tickets.&quot;;</span>
		//String FROM = MailBean.DAILY_MAIL_FROM;
<span class="nc" id="L1891">		String FROM = &quot;lms.user@skilrock.com&quot;;</span>
<span class="nc" id="L1892">		String PASSWORD = MailBean.PASSWORD;</span>
<span class="nc" id="L1893">		String type = &quot;TrackTicketLimit&quot;;</span>
<span class="nc" id="L1894">		String status = null;</span>
<span class="nc" id="L1895">		MailSender mailSender = null;</span>
		try {
<span class="nc" id="L1897">			status = &quot;Mail Sent&quot;;</span>
<span class="nc" id="L1898">			con = DBConnect.getConnection();</span>
<span class="nc" id="L1899">			addBORecipient(mail, type);</span>
<span class="nc" id="L1900">			mailSender = new MailSender(FROM, PASSWORD, mail.to, mail.subject, mail.boTextBody, &quot;&quot;);</span>
<span class="nc" id="L1901">			mailSender.setDaemon(true);</span>
<span class="nc" id="L1902">			mailSender.start();</span>
<span class="nc" id="L1903">		} catch (Exception e) {</span>
<span class="nc" id="L1904">			e.printStackTrace();</span>
<span class="nc" id="L1905">			status = &quot;Not Sent&quot;;</span>
		} finally {
<span class="nc" id="L1907">			DBConnect.closeCon(con);</span>
<span class="nc" id="L1908">		}</span>

<span class="nc" id="L1910">		return status;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>