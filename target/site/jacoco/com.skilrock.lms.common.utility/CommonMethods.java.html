<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CommonMethods.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lms</a> &gt; <a href="index.source.html" class="el_package">com.skilrock.lms.common.utility</a> &gt; <span class="el_source">CommonMethods.java</span></div><h1>CommonMethods.java</h1><pre class="source lang-java linenums">package com.skilrock.lms.common.utility;

import java.io.IOException;
import java.lang.reflect.Type;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.Timestamp;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.Set;
import java.util.TreeMap;

import javax.servlet.ServletContext;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.struts2.ServletActionContext;

import rng.RNGUtilities;

import com.google.gson.Gson;
import com.google.gson.reflect.TypeToken;
import com.skilrock.lms.admin.SetResetUserPasswordAction;
import com.skilrock.lms.api.lms.AnyType2AnyTypeMap;
import com.skilrock.lms.beans.HistoryBean;
import com.skilrock.lms.beans.ServiceRequest;
import com.skilrock.lms.beans.ServiceResponse;
import com.skilrock.lms.beans.UserIdMappingBean;
import com.skilrock.lms.beans.UserInfoBean;
import com.skilrock.lms.common.MyTextProvider;
import com.skilrock.lms.common.Utility;
import com.skilrock.lms.common.db.DBConnect;
import com.skilrock.lms.common.db.QueryManager;
import com.skilrock.lms.common.exception.LMSErrors;
import com.skilrock.lms.common.exception.LMSException;
import com.skilrock.lms.common.filter.LMSFilterDispatcher;
import com.skilrock.lms.coreEngine.ola.SendSMS;
import com.skilrock.lms.coreEngine.service.IServiceDelegate;
import com.skilrock.lms.coreEngine.service.ServiceDelegate;
import com.skilrock.lms.coreEngine.service.dge.ServiceMethodName;
import com.skilrock.lms.coreEngine.service.dge.ServiceName;
import com.skilrock.lms.dge.beans.DrawIdBean;
import com.skilrock.lms.dge.beans.PWTDrawBean;
import com.skilrock.lms.dge.beans.PanelIdBean;
import com.skilrock.lms.web.drawGames.common.Util;

<span class="nc" id="L62">public class CommonMethods{</span>
	
<span class="fc" id="L64">	static MyTextProvider textProvider = new MyTextProvider();  </span>

	public static CommonMethods instance;

	public static CommonMethods getSingleInstance() {
<span class="nc bnc" id="L69" title="All 2 branches missed.">	    if (instance == null) {</span>
<span class="nc" id="L70">	      synchronized (CommonMethods.class) {</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">	        if (instance == null) {</span>
<span class="nc" id="L72">	        	instance = new CommonMethods();</span>
	        }
<span class="nc" id="L74">	      }</span>
	    }
<span class="nc" id="L76">	    return instance;</span>
	  }

	final static long oneDay = 1 * 24 * 60 * 60 * 1000;
<span class="fc" id="L80">	static Log logger = LogFactory.getLog(CommonMethods.class);</span>

	public static double calculateDrawGameVatAgt(double mrpAmt,
			double agtSaleCommRate, double prizePayOutRatio, double govtComm,
			double vat) throws LMSException {
<span class="nc" id="L85">		String countryDeployed =Utility.getPropertyValue(&quot;COUNTRY_DEPLOYED&quot;);</span>
<span class="nc" id="L86">		double vatAmt = 0.0;</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">		if (&quot;ZIMBABWE&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L88">			vatAmt = (mrpAmt - mrpAmt * (prizePayOutRatio + govtComm) / 100)</span>
					* vat * 0.01 / (1 + vat * 0.01);

<span class="nc bnc" id="L91" title="All 2 branches missed.">		} else if (&quot;KENYA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
			// NO VAT
<span class="nc bnc" id="L93" title="All 2 branches missed.">		} else if (&quot;NIGERIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L94">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">		} else if (&quot;TANZANIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L96">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">		}else if(&quot;GHANA&quot;.equalsIgnoreCase(countryDeployed)){</span>
<span class="nc" id="L98">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">		} else if(&quot;SAFARIBET&quot;.equalsIgnoreCase(countryDeployed)){</span>
<span class="nc" id="L100">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">		} else if (&quot;BENIN&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L102">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">		} else if (&quot;SIKKIM&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L104">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">		}else if (&quot;PHILIP&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L106">			vatAmt = mrpAmt * vat * 0.01;</span>
		} else {
<span class="nc" id="L108">			throw new LMSException();</span>
		}
<span class="nc" id="L110">		return vatAmt;</span>
	}

	public static double roundDrawTktAmt(double mrp) {
<span class="pc bpc" id="L114" title="1 of 2 branches missed.">		if(mrp&lt;=10.0){</span>
<span class="fc" id="L115">		return (double)(long)(mrp * 2 + 0.5) / 2;</span>
		}else{
<span class="nc" id="L117">		return (double)(long)mrp;	</span>
		}
	}

	public static double calculateDrawGameVatPlr(double mrpAmt,
			double plrSaleCommRate, double prizePayOutRatio, double govtComm,
			double vat) throws LMSException {
<span class="nc" id="L124">		double vatAmt = 0.0;</span>
<span class="nc" id="L125">		String countryDeployed =Utility.getPropertyValue(&quot;COUNTRY_DEPLOYED&quot;);</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">		if (&quot;ZIMBABWE&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L127">			vatAmt = (mrpAmt - mrpAmt * (prizePayOutRatio + govtComm) / 100)</span>
					* vat * 0.01 / (1 + vat * 0.01);

<span class="nc bnc" id="L130" title="All 2 branches missed.">		} else if (&quot;KENYA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
			// NO VAT
<span class="nc bnc" id="L132" title="All 2 branches missed.">		} else if (&quot;NIGERIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L133">			vatAmt = mrpAmt * vat * 0.01;</span>
		}
<span class="nc bnc" id="L135" title="All 2 branches missed.">		else if (&quot;TANZANIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L136">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">		}else if(&quot;GHANA&quot;.equalsIgnoreCase(countryDeployed)){</span>
<span class="nc" id="L138">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">		}else if(&quot;SAFARIBET&quot;.equalsIgnoreCase(countryDeployed)){</span>
<span class="nc" id="L140">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">		}else if (&quot;BENIN&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L142">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">		}else if (&quot;SIKKIM&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L144">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">		}else if (&quot;PHILIP&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L146">			vatAmt = mrpAmt * vat * 0.01;</span>
		}else {		
<span class="nc" id="L148">			throw new LMSException();</span>
		}
<span class="nc" id="L150">		return vatAmt;</span>
	}

	public static double calculateDrawGameVatRet(double mrpAmt,
			double retailerSaleCommRate, double prizePayOutRatio,
			double govtComm, double vat) throws LMSException {
<span class="nc" id="L156">		double vatAmt = 0.0;</span>
<span class="nc" id="L157">		String countryDeployed =Utility.getPropertyValue(&quot;COUNTRY_DEPLOYED&quot;);</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">		if (&quot;ZIMBABWE&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L159">			vatAmt = (mrpAmt - mrpAmt * (prizePayOutRatio + govtComm) / 100)</span>
					* vat * 0.01 / (1 + vat * 0.01);

<span class="nc bnc" id="L162" title="All 2 branches missed.">		} else if (&quot;KENYA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
			// NO VAT
<span class="nc bnc" id="L164" title="All 2 branches missed.">		} else if (&quot;NIGERIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L165">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">		} else if (&quot;TANZANIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L167">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">		}else if(&quot;GHANA&quot;.equalsIgnoreCase(countryDeployed)){</span>
<span class="nc" id="L169">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">		}else if(&quot;SAFARIBET&quot;.equalsIgnoreCase(countryDeployed)){</span>
<span class="nc" id="L171">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">		}else if (&quot;BENIN&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L173">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">		}else if (&quot;SIKKIM&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L175">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">		}else if (&quot;PHILIP&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L177">			vatAmt = mrpAmt * vat * 0.01;</span>
		} else {
<span class="nc" id="L179">			throw new LMSException();</span>
		}
<span class="nc" id="L181">		return vatAmt;</span>
	}

	public static double calculateVat(double mrpAmt, double agentSaleCommRate,
			double prizePayOutRatio, double govtComm, double vat,
			String govtCommRule, double fixedAmt, Long ticketsInScheme)
			throws LMSException {
<span class="nc" id="L188">		double vatAmt = 0.0;</span>
<span class="nc" id="L189">		String countryDeployed =Utility.getPropertyValue(&quot;COUNTRY_DEPLOYED&quot;);</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">		if (&quot;ZIMBABWE&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">			if (govtCommRule.equals(&quot;FIXED_PER&quot;)) {</span>
<span class="nc" id="L192">				vatAmt = (mrpAmt - mrpAmt * (prizePayOutRatio + govtComm) / 100)</span>
						* vat * 0.01 / (1 + vat * 0.01);
<span class="nc bnc" id="L194" title="All 2 branches missed.">			} else if (govtCommRule.equals(&quot;MIN_PROFIT&quot;)) {</span>
<span class="nc" id="L195">				vatAmt = fixedAmt / mrpAmt * ticketsInScheme;</span>
			}

<span class="nc bnc" id="L198" title="All 2 branches missed.">		} else if (&quot;KENYA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
			// No VAT
<span class="nc bnc" id="L200" title="All 2 branches missed.">		} else if (&quot;NIGERIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L201">			vatAmt = mrpAmt * vat * 0.01;</span>

<span class="nc bnc" id="L203" title="All 2 branches missed.">		} else if (&quot;TANZANIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L204">			vatAmt = mrpAmt * vat * 0.01;</span>

<span class="nc bnc" id="L206" title="All 2 branches missed.">		}else if(&quot;GHANA&quot;.equalsIgnoreCase(countryDeployed)){</span>
<span class="nc" id="L207">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">		}else if(&quot;SAFARIBET&quot;.equalsIgnoreCase(countryDeployed)){</span>
<span class="nc" id="L209">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">		}else if (&quot;BENIN&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L211">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">		}else if (&quot;SIKKIM&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L213">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">		}else if (&quot;PHILIP&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L215">			vatAmt = mrpAmt * vat * 0.01;</span>
		}else {
<span class="nc" id="L217">			throw new LMSException();</span>
		}
<span class="nc" id="L219">		return vatAmt;</span>
	}

	public static double calculateVatAgent(double mrpAmt,
			double retailerSaleCommRate, double prizePayOutRatio,
			double govtComm, double vat, String govtCommRule, double fixedAmt,
			Long ticketsInScheme) throws LMSException {
<span class="nc" id="L226">		double vatAmt = 0.0;</span>
<span class="nc" id="L227">		String countryDeployed =Utility.getPropertyValue(&quot;COUNTRY_DEPLOYED&quot;);</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">		if (&quot;ZIMBABWE&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">			if (govtCommRule.equals(&quot;FIXED_PER&quot;)) {</span>
<span class="nc" id="L230">				vatAmt = (mrpAmt - mrpAmt * (prizePayOutRatio + govtComm) / 100)</span>
						* vat * 0.01 / (1 + vat * 0.01);
<span class="nc bnc" id="L232" title="All 2 branches missed.">			} else if (govtCommRule.equals(&quot;MIN_PROFIT&quot;)) {</span>
<span class="nc" id="L233">				vatAmt = fixedAmt / mrpAmt * ticketsInScheme;</span>
			}

<span class="nc bnc" id="L236" title="All 2 branches missed.">		} else if (&quot;KENYA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
			// No VAT
<span class="nc bnc" id="L238" title="All 2 branches missed.">		} else if (&quot;NIGERIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L239">			vatAmt = mrpAmt * vat * 0.01;</span>

<span class="nc bnc" id="L241" title="All 2 branches missed.">		}else if (&quot;TANZANIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L242">			vatAmt = mrpAmt * vat * 0.01;</span>

<span class="nc bnc" id="L244" title="All 2 branches missed.">		}else if(&quot;GHANA&quot;.equalsIgnoreCase(countryDeployed)){</span>
<span class="nc" id="L245">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">		}else if(&quot;SAFARIBET&quot;.equalsIgnoreCase(countryDeployed)){</span>
<span class="nc" id="L247">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">		}else if (&quot;BENIN&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L249">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">		}else if (&quot;SIKKIM&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L251">			vatAmt = mrpAmt * vat * 0.01;</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">		}else if (&quot;PHILIP&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L253">			vatAmt = mrpAmt * vat * 0.01;</span>
		} else {
<span class="nc" id="L255">			throw new LMSException();</span>
		}

<span class="nc" id="L258">		return vatAmt;</span>
	}

	public static double calDrawGameTaxableSale(double ticketMrp,
			double saleCommRate, double prizePayOutRatio, double govtComm,
			double vat) throws LMSException {
<span class="nc" id="L264">		double taxableSale = 0.0;</span>
<span class="nc" id="L265">		String countryDeployed =Utility.getPropertyValue(&quot;COUNTRY_DEPLOYED&quot;);</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">		if (&quot;ZIMBABWE&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L267">			taxableSale = ticketMrp * (100 - (prizePayOutRatio + govtComm))</span>
					/ 100 * 100 / (100 + vat);
<span class="nc bnc" id="L269" title="All 2 branches missed.">		} else if (&quot;KENYA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L270">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">		} else if (&quot;NIGERIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>

<span class="nc" id="L273">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">		}else if (&quot;TANZANIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>

<span class="nc" id="L276">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">		}else if(&quot;GHANA&quot;.equalsIgnoreCase(countryDeployed)){</span>
<span class="nc" id="L278">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">		}else if(&quot;SAFARIBET&quot;.equalsIgnoreCase(countryDeployed)){</span>
<span class="nc" id="L280">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">		}else if (&quot;BENIN&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L282">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">		}else if (&quot;SIKKIM&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L284">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">		}else if (&quot;PHILIP&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L286">			taxableSale = ticketMrp;</span>
		}  else {
<span class="nc" id="L288">			throw new LMSException();</span>
		}
<span class="nc" id="L290">		return taxableSale;</span>
	}

	public static double calScratchTaxableSale(double ticketMrp,
			double saleCommRate, double prizePayOutRatio, double govtComm,
			double vat) throws LMSException {
<span class="nc" id="L296">		double taxableSale = 0.0;</span>
<span class="nc" id="L297">		String countryDeployed =Utility.getPropertyValue(&quot;COUNTRY_DEPLOYED&quot;);</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">		if (&quot;ZIMBABWE&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L299">			taxableSale = ticketMrp * (100 - (prizePayOutRatio + govtComm))</span>
					/ 100 * 100 / (100 + vat);
<span class="nc bnc" id="L301" title="All 2 branches missed.">		} else if (&quot;KENYA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L302">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">		} else if (&quot;NIGERIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>

<span class="nc" id="L305">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">		}else if (&quot;TANZANIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>

<span class="nc" id="L308">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">		}else if(&quot;GHANA&quot;.equalsIgnoreCase(countryDeployed)){</span>
<span class="nc" id="L310">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">		}else if(&quot;SAFARIBET&quot;.equalsIgnoreCase(countryDeployed)){</span>
<span class="nc" id="L312">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">		}else if (&quot;BENIN&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L314">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">		}else if (&quot;SIKKIM&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L316">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">		}else if (&quot;PHILIP&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L318">			taxableSale = ticketMrp;</span>
		} else {
<span class="nc" id="L320">			throw new LMSException();</span>
		}
<span class="nc" id="L322">		return taxableSale;</span>
	}

	public static double calTaxableSale(double ticketMrp, double saleCommRate,
			double prizePayOutRatio, double govtComm, double vat)
			throws LMSException {
<span class="nc" id="L328">		double taxableSale = 0.0;</span>
<span class="nc" id="L329">		String countryDeployed =Utility.getPropertyValue(&quot;COUNTRY_DEPLOYED&quot;);</span>
<span class="nc bnc" id="L330" title="All 2 branches missed.">		if (&quot;ZIMBABWE&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L331">			taxableSale = ticketMrp * (100 - (prizePayOutRatio + govtComm))</span>
					/ 100 * 100 / (100 + vat);
<span class="nc bnc" id="L333" title="All 2 branches missed.">		} else if (&quot;KENYA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L334">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">		} else if (&quot;NIGERIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L336">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">		}else if (&quot;TANZANIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>

<span class="nc" id="L339">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L340" title="All 2 branches missed.">		}else if (&quot;GHANA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L341">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L342" title="All 2 branches missed.">		}else if (&quot;SAFARIBET&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L343">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">		}else if (&quot;BENIN&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L345">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L346" title="All 2 branches missed.">		}else if (&quot;SIKKIM&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L347">			taxableSale = ticketMrp;</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">		}else if (&quot;PHILIP&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L349">			taxableSale = ticketMrp;</span>
		} else {
<span class="nc" id="L351">			throw new LMSException();</span>
		}
<span class="nc" id="L353">		return taxableSale;</span>
	}
//@ amit : added for credit note
	
	public static String changeCrNoteBalRet(double creAmt,int agtOrgId) {
<span class="nc" id="L358">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L359">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L360">		ResultSet rs = null;</span>
<span class="nc" id="L361">		String selectQuery = null;</span>
<span class="nc" id="L362">		double retMaxBalLimit = 0.0;</span>
<span class="nc" id="L363">		String errMsg = &quot;&quot;;</span>
		try {
<span class="nc" id="L365">				selectQuery = &quot;select ifnull(slom.available_credit-slom.claimable_bal,0)-ifnull(retbal.bal,0) as totalbal from st_lms_organization_master slom,(select ifnull(sum(if(available_credit-claimable_bal&gt;0,available_credit-claimable_bal,0)),0) as bal from st_lms_organization_master where parent_id=&quot;</span>
						+ agtOrgId
						+ &quot;) as retbal where slom.organization_id=&quot;
						+ agtOrgId;
<span class="nc" id="L369">				pstmt = con.prepareStatement(selectQuery);</span>

<span class="nc" id="L371">				System.out.println(&quot;Bal Query::&quot; + pstmt);</span>
<span class="nc" id="L372">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L373" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L374">					retMaxBalLimit = rs.getDouble(&quot;totalbal&quot;);</span>
				}

<span class="nc bnc" id="L377" title="All 2 branches missed.">				if (creAmt &lt;= retMaxBalLimit) {</span>
<span class="nc" id="L378">					errMsg = &quot;TRUE&quot;;</span>
<span class="nc bnc" id="L379" title="All 2 branches missed.">				} else if (retMaxBalLimit &lt;= 0) {</span>
<span class="nc" id="L380">					errMsg = &quot;Agent of this Retailer have insufficient Credit Amount&quot;;</span>
				} else {
<span class="nc" id="L382">					errMsg = &quot;You Can Increase Only &quot;</span>
							+ FormatNumber.formatNumberForJSP(retMaxBalLimit)
							+ &quot; Amount &quot;;
				}
		

<span class="nc" id="L388">		} catch (Exception e) {</span>
<span class="nc" id="L389">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L391">			try {</span>
<span class="nc" id="L392">				con.close();</span>
<span class="nc" id="L393">			} catch (SQLException e) {</span>
<span class="nc" id="L394">				e.printStackTrace();</span>
<span class="nc" id="L395">			}</span>
<span class="nc" id="L396">		}</span>
<span class="nc" id="L397">		return errMsg;</span>
	}
	public static String changeCreditLimitRet(int retOrgId, double crLimit,
			String type) {
<span class="nc" id="L401">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L402">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L403">		ResultSet rs = null;</span>
<span class="nc" id="L404">		String selectQuery = null;</span>
<span class="nc" id="L405">		double retMaxBalLimit = 0.0;</span>
<span class="nc" id="L406">		String errMsg = &quot;&quot;;</span>
<span class="nc" id="L407">		double retCrLimit = 0;</span>
<span class="nc" id="L408">		int agtOrgId = 0;</span>
<span class="nc" id="L409">		boolean checkType = &quot;XCL&quot;.equals(type);</span>
		try {
<span class="nc" id="L411">			selectQuery = &quot;select credit_limit,parent_id,extended_credit_limit from st_lms_organization_master where organization_id=&quot;</span>
					+ retOrgId;
<span class="nc" id="L413">			pstmt = con.prepareStatement(selectQuery);</span>
<span class="nc" id="L414">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">				retCrLimit = checkType ? rs.getDouble(&quot;extended_credit_limit&quot;)</span>
						: rs.getDouble(&quot;credit_limit&quot;);
<span class="nc" id="L418">				agtOrgId = rs.getInt(&quot;parent_id&quot;);</span>
			}
<span class="nc" id="L420">			System.out.println(&quot;--------retCrLimit&quot; + retCrLimit</span>
					+ &quot;--------crLimit&quot; + crLimit);
<span class="nc bnc" id="L422" title="All 2 branches missed.">			if(crLimit&lt;0.0){</span>
<span class="nc" id="L423">				errMsg = &quot;Can't  Decrease More than Retailer's limit&quot;;</span>
<span class="nc" id="L424">				return errMsg;</span>
			}
<span class="nc bnc" id="L426" title="All 2 branches missed.">			if (crLimit &gt; retCrLimit) {</span>
<span class="nc" id="L427">				selectQuery = &quot;select ifnull(slom.available_credit-slom.claimable_bal,0)-ifnull(retbal.bal,0) as totalbal from st_lms_organization_master slom,(select ifnull(sum(if(available_credit-claimable_bal&gt;0,available_credit-claimable_bal,0)),0) as bal from st_lms_organization_master where parent_id=&quot;</span>
						+ agtOrgId
						+ &quot;) as retbal where slom.organization_id=&quot;
						+ agtOrgId;
<span class="nc" id="L431">				pstmt = con.prepareStatement(selectQuery);</span>

<span class="nc" id="L433">				System.out.println(&quot;Bal Query::&quot; + pstmt);</span>
<span class="nc" id="L434">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">				if (rs.next()) {</span>
<span class="nc" id="L436">					retMaxBalLimit = rs.getDouble(&quot;totalbal&quot;);</span>
				}

<span class="nc bnc" id="L439" title="All 2 branches missed.">				if (crLimit - retCrLimit &lt;= retMaxBalLimit) {</span>
<span class="nc" id="L440">					errMsg = &quot;TRUE&quot;;</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">				} else if (retMaxBalLimit &lt;= 0) {</span>
<span class="nc" id="L442">					errMsg = &quot;Agent of this Retailer have insufficient Credit Amount&quot;;</span>
				} else {
<span class="nc" id="L444">					errMsg = &quot;You Can Increase Only &quot;</span>
							+ FormatNumber.formatNumberForJSP(retMaxBalLimit)
							+ &quot; Amount &quot;;
				}
			} else {
<span class="nc" id="L449">				errMsg = &quot;TRUE&quot;;</span>
			}

<span class="nc" id="L452">		} catch (Exception e) {</span>
<span class="nc" id="L453">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L455">			try {</span>
<span class="nc" id="L456">				con.close();</span>
<span class="nc" id="L457">			} catch (SQLException e) {</span>
<span class="nc" id="L458">				e.printStackTrace();</span>
<span class="nc" id="L459">			}</span>
<span class="nc" id="L460">		}</span>
<span class="nc" id="L461">		return errMsg;</span>
	}

	public static String chkCreditLimitAgt(int agtOrgId, double bal,Connection con)throws LMSException {
		//Connection con = DBConnect.getConnection();
<span class="nc" id="L466">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L467">		ResultSet rs = null;</span>
<span class="nc" id="L468">		String selectQuery = null;</span>
<span class="nc" id="L469">		double retMaxBalLimit = 0.0;</span>
<span class="nc" id="L470">		String errMsg = &quot;&quot;;</span>
		try {
<span class="nc" id="L472">			selectQuery = &quot;select ifnull(slom.available_credit-slom.claimable_bal,0)-ifnull(retbal.bal,0) as totalbal from st_lms_organization_master slom,(select sum(retBal.retBal) as bal from (select if(available_credit-claimable_bal&gt;0,available_credit-claimable_bal,0) as retBal from st_lms_organization_master where parent_id=&quot;</span>
					+ agtOrgId
					+ &quot;) as retBal) as retbal where slom.organization_id=&quot;
					+ agtOrgId;
<span class="nc" id="L476">			pstmt = con.prepareStatement(selectQuery);</span>

<span class="nc" id="L478">			logger.info(&quot;Bal Query::&quot; + pstmt);</span>
<span class="nc" id="L479">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L480" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L481">				retMaxBalLimit = rs.getDouble(&quot;totalbal&quot;);</span>
			}
<span class="nc" id="L483">			logger.info(&quot;bal&quot; + bal + &quot;   retMaxBalLimit&quot; + retMaxBalLimit);</span>
<span class="nc bnc" id="L484" title="All 2 branches missed.">			if (bal &lt;= retMaxBalLimit) {</span>
<span class="nc" id="L485">				errMsg = &quot;TRUE&quot;;</span>
<span class="nc bnc" id="L486" title="All 2 branches missed.">			} else if (retMaxBalLimit &lt;= 0) {</span>
<span class="nc" id="L487">				errMsg = textProvider.getText(&quot;msg.u.cannot.acpt.anyAmt&quot;);</span>
			} else {
<span class="nc" id="L489">				errMsg = textProvider.getText(&quot;msg.u.can.acpt&quot;)+&quot; &quot;</span>
						+ FormatNumber.formatPDFNumbers(retMaxBalLimit)
						+ textProvider.getText(&quot;msg.amt.only&quot;);
			}
<span class="nc" id="L493">		} catch (SQLException se) {</span>
<span class="nc" id="L494">			se.printStackTrace();</span>
<span class="nc" id="L495">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE,LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
		}
<span class="nc" id="L497">		catch (Exception e) {</span>
<span class="nc" id="L498">			e.printStackTrace();</span>
<span class="nc" id="L499">			throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE,LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L500">		}</span>
<span class="nc" id="L501">		return errMsg;</span>
	}
	
	public static String chkCreditLimitAgt(int agtOrgId, double bal) {
<span class="nc" id="L505">		Connection con = DBConnect.getConnection();</span>
		/*PreparedStatement pstmt = null;
		ResultSet rs = null;
		String selectQuery = null;
		double retMaxBalLimit = 0.0;*/
<span class="nc" id="L510">		String errMsg = &quot;&quot;;</span>
		try {/*
			selectQuery = &quot;select ifnull(slom.available_credit-slom.claimable_bal,0)-ifnull(retbal.bal,0) as totalbal from st_lms_organization_master slom,(select sum(retBal.retBal) as bal from (select if(available_credit-claimable_bal&gt;0,available_credit-claimable_bal,0) as retBal from st_lms_organization_master where parent_id=&quot;
					+ agtOrgId
					+ &quot;) as retBal) as retbal where slom.organization_id=&quot;
					+ agtOrgId;
			pstmt = con.prepareStatement(selectQuery);

			logger.info(&quot;Bal Query::&quot; + pstmt);
			rs = pstmt.executeQuery();
			if (rs.next()) {
				retMaxBalLimit = rs.getDouble(&quot;totalbal&quot;);
			}
			logger.info(&quot;bal&quot; + bal + &quot;   retMaxBalLimit&quot; + retMaxBalLimit);
			if (bal &lt;= retMaxBalLimit) {
				errMsg = &quot;TRUE&quot;;
			} else if (retMaxBalLimit &lt;= 0) {
				errMsg = &quot;You Cannot Accept Any Amount&quot;;
			} else {
				errMsg = &quot;You Can Accept &quot;
						+ FormatNumber.formatPDFNumbers(retMaxBalLimit)
						+ &quot; Amount Only&quot;;
			}
		*/
<span class="nc" id="L534">			errMsg=chkCreditLimitAgt(agtOrgId, bal, con);</span>
			
		
<span class="nc" id="L537">		} catch (Exception e) {</span>
<span class="nc" id="L538">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L540">			try {</span>
<span class="nc" id="L541">				con.close();</span>
<span class="nc" id="L542">			} catch (SQLException e) {</span>
<span class="nc" id="L543">				e.printStackTrace();</span>
<span class="nc" id="L544">			}</span>
<span class="nc" id="L545">		}</span>
<span class="nc" id="L546">		return errMsg;</span>
	}

	public synchronized static String convertDateInGlobalFormat(String date,
			String format, String returnFormat) {
<span class="nc" id="L551">		String formatParser = findParserString(format);</span>
<span class="nc" id="L552">		String[] formatArr = format.split(formatParser);</span>
<span class="nc" id="L553">		logger.debug(formatArr[0] + formatParser + formatArr[1] + formatParser</span>
				+ formatArr[2]);
<span class="nc" id="L555">		String[] dateArr = date.split(formatParser);</span>
<span class="nc" id="L556">		logger.debug(dateArr[0] + formatParser + dateArr[1] + formatParser</span>
				+ dateArr[2]);
<span class="nc" id="L558">		String returnFormatParser = findParserString(returnFormat);</span>
<span class="nc" id="L559">		String[] returnFormatArr = returnFormat.split(returnFormatParser);</span>
<span class="nc" id="L560">		logger.debug(returnFormatArr[0] + returnFormatParser</span>
				+ returnFormatArr[1] + returnFormatParser + returnFormatArr[2]);
<span class="nc" id="L562">		String finalDate[] = new String[3];</span>

<span class="nc" id="L564">		String arr[] = new String[] { &quot;dd&quot;, &quot;mm&quot;, &quot;yy&quot; };</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">		if (formatArr.length == dateArr.length) {</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">			for (String element : arr) {</span>
<span class="nc" id="L567">				int formatArrIndex = -1;</span>
<span class="nc" id="L568">				int returnFormatArrIndex = -1;</span>

<span class="nc bnc" id="L570" title="All 2 branches missed.">				for (int i = 0; formatArr.length &gt; i; i++) {</span>
<span class="nc bnc" id="L571" title="All 2 branches missed.">					if (formatArr[i].toLowerCase().indexOf(element) != -1) {</span>
<span class="nc" id="L572">						formatArrIndex = i;</span>
<span class="nc" id="L573">						break;</span>
					}
				}
<span class="nc bnc" id="L576" title="All 2 branches missed.">				for (int i = 0; returnFormatArr.length &gt; i; i++) {</span>
<span class="nc bnc" id="L577" title="All 2 branches missed.">					if (returnFormatArr[i].toLowerCase().indexOf(element) != -1) {</span>
<span class="nc" id="L578">						returnFormatArrIndex = i;</span>
<span class="nc" id="L579">						break;</span>
					}
				}

<span class="nc" id="L583">				finalDate[returnFormatArrIndex] = dateArr[formatArrIndex];</span>
				// logger.debug(returnFormatArrIndex+&quot;
				// &quot;+finalDate[returnFormatArrIndex]);
			}
		}
<span class="nc" id="L588">		logger.debug(&quot;date converted in  === &quot;</span>
				+ (finalDate[0] + returnFormatParser + finalDate[1]
						+ returnFormatParser + finalDate[2]));
<span class="nc" id="L591">		return finalDate[0] + returnFormatParser + finalDate[1]</span>
				+ returnFormatParser + finalDate[2];
	}

	public static String fetchReprintCount(int gameNo, String ticketNo) {
<span class="nc" id="L596">		System.out.println(&quot;inside the fetchReprintCount() method...&quot;);</span>
<span class="nc" id="L597">		ServiceResponse sRes = new ServiceResponse();</span>
<span class="nc" id="L598">		ServiceRequest sReq = new ServiceRequest();</span>
<span class="nc" id="L599">		sReq.setServiceName(ServiceName.DRAWGAME);</span>
<span class="nc" id="L600">		sReq.setServiceMethod(ServiceMethodName.DRAWGAME_FETCH_REPRINT_COUNT);</span>
<span class="nc" id="L601">		sReq.setServiceData(gameNo + &quot;,&quot; + ticketNo);</span>
<span class="nc" id="L602">		IServiceDelegate delegate = ServiceDelegate.getInstance();</span>
<span class="nc" id="L603">		sRes = delegate.getResponse(sReq);</span>
<span class="nc" id="L604">		String reprintCount = (String) sRes.getResponseData();</span>
<span class="nc" id="L605">		System.out.println(&quot;gameNo:&quot; + gameNo + &quot;ticketNo:&quot; + ticketNo</span>
				+ &quot;reprintCount:&quot; + reprintCount);
<span class="nc" id="L607">		return reprintCount;</span>
	}
	
	
	public static LinkedHashMap&lt;String, ArrayList&lt;Object&gt;&gt; fetchTicketToCancel(String ticketList) {
<span class="nc" id="L612">		System.out.println(&quot;inside the fetchTicketsToCancel() method...&quot;);</span>
<span class="nc" id="L613">		ServiceResponse sRes = new ServiceResponse();</span>
<span class="nc" id="L614">		ServiceRequest sReq = new ServiceRequest();</span>
<span class="nc" id="L615">		sReq.setServiceName(ServiceName.PLAYGAME);</span>
<span class="nc" id="L616">		sReq.setServiceMethod(ServiceMethodName.FETCH_TICKETS_TO_CANCEL);</span>
<span class="nc" id="L617">		sReq.setServiceData(ticketList);</span>
<span class="nc" id="L618">		IServiceDelegate delegate = ServiceDelegate.getInstance();</span>
<span class="nc" id="L619">		sRes = delegate.getResponse(sReq);		</span>
<span class="nc" id="L620">		String responseString = sRes.getResponseData().toString();</span>
<span class="nc" id="L621">		Type elementType = new TypeToken&lt;LinkedHashMap&lt;String, ArrayList&lt;Object&gt;&gt;&gt;() {}.getType();</span>
<span class="nc" id="L622">		LinkedHashMap ticketInfoMap = new Gson().fromJson(responseString, elementType);</span>
<span class="nc" id="L623">		return ticketInfoMap;</span>
	}
	
	
	
	
	public static String fetchUpdatedReprintCount(int gameId, String ticketNo, int count) {
		//count is -ve or +ve depending on decrease or increase.
		
<span class="nc" id="L632">		System.out.println(&quot;inside the fetchReprintCount() method...&quot;);</span>
<span class="nc" id="L633">		ServiceResponse sRes = new ServiceResponse();</span>
<span class="nc" id="L634">		ServiceRequest sReq = new ServiceRequest();</span>
<span class="nc" id="L635">		sReq.setServiceName(ServiceName.DRAWGAME);</span>
<span class="nc" id="L636">		sReq.setServiceMethod(ServiceMethodName.DRAWGAME_FETCH_REPRINT_COUNT);</span>
<span class="nc" id="L637">		sReq.setServiceData(gameId + &quot;,&quot; + ticketNo + &quot;,&quot; + count);</span>
<span class="nc" id="L638">		IServiceDelegate delegate = ServiceDelegate.getInstance();</span>
<span class="nc" id="L639">		sRes = delegate.getResponse(sReq);</span>
<span class="nc" id="L640">		String reprintCount = (String) sRes.getResponseData();</span>
<span class="nc" id="L641">		System.out.println(&quot;gameId:&quot; + gameId + &quot;ticketNo:&quot; + ticketNo</span>
				+ &quot;reprintCount:&quot; + reprintCount);
<span class="nc" id="L643">		return reprintCount;</span>
	}

	public static String findParserString(String type) {
<span class="nc" id="L647">		String parser = &quot;&quot;;</span>
<span class="nc" id="L648">		String parserArr[] = new String[] { &quot;/&quot;, &quot;-&quot;, &quot;.&quot; };</span>
<span class="nc bnc" id="L649" title="All 2 branches missed.">		for (String element : parserArr) {</span>
<span class="nc bnc" id="L650" title="All 2 branches missed.">			if (type.indexOf(element) &gt;= 0) {</span>
<span class="nc" id="L651">				parser = element;</span>
<span class="nc" id="L652">				break;</span>
			}
		}

<span class="nc" id="L656">		return parser;</span>
	}

	public static double fmtToTwoDecimal(double number) {
<span class="fc" id="L660">		return Math.round((number * 100)) / 100.0;</span>

	}

	public static List&lt;Integer&gt; getAgentOrgIdList() {
<span class="nc" id="L665">		ArrayList&lt;Integer&gt; orgIdList = new ArrayList&lt;Integer&gt;();</span>
<span class="nc" id="L666">		Connection con = DBConnect.getConnection();</span>
		try {
<span class="nc" id="L668">			PreparedStatement pstmt = con</span>
					.prepareStatement(&quot;select organization_id, organization_type, name from st_lms_organization_master where organization_type = 'AGENT'&quot;);
<span class="nc" id="L670">			ResultSet rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L671" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L672">				orgIdList.add(rs.getInt(&quot;organization_id&quot;));</span>
			}
<span class="nc" id="L674">		} catch (SQLException e) {</span>
<span class="nc" id="L675">			e.printStackTrace();</span>
<span class="nc" id="L676">			return null;</span>
<span class="nc" id="L677">		}</span>
<span class="nc" id="L678">		return orgIdList;</span>
	}

	public synchronized static int getGameNbr(int gameId) {
<span class="nc" id="L682">		int gameNbr = -1;</span>
<span class="nc" id="L683">		Connection con = DBConnect.getConnection();</span>
		try {
<span class="nc" id="L685">			PreparedStatement pstmt = con</span>
					.prepareStatement(&quot;select game_nbr from st_se_game_master where game_id = ?&quot;);
<span class="nc" id="L687">			pstmt.setInt(1, gameId);</span>
<span class="nc" id="L688">			ResultSet rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L689" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L690">				gameNbr = rs.getInt(&quot;game_nbr&quot;);</span>
			}
<span class="nc" id="L692">		} catch (SQLException e) {</span>
<span class="nc" id="L693">			e.printStackTrace();</span>
<span class="nc" id="L694">			return -1;</span>
<span class="nc" id="L695">		}</span>
<span class="nc" id="L696">		return gameNbr;</span>
	}

	public static void main(String[] args) {
<span class="nc" id="L700">		System.out</span>
				.println(convertDateInGlobalFormat(&quot;09/05/02&quot;, &quot;&quot;, &quot;mm-dd-yy&quot;));

<span class="nc" id="L703">	}</span>

	public static void sendMail(String errMsg) {
<span class="nc" id="L706">		HttpServletRequest request = ServletActionContext.getRequest();</span>
<span class="nc" id="L707">		String errTime = &quot;&quot; + new Date().getTime();</span>
<span class="nc" id="L708">		String local = request.getLocalAddr() + &quot;/&quot; + request.getLocalName();</span>

<span class="nc" id="L710">		HttpSession session = request.getSession();</span>
<span class="nc" id="L711">		UserInfoBean userBean = (UserInfoBean) session</span>
				.getAttribute(&quot;USER_INFO&quot;);

<span class="nc" id="L714">		String remote = request.getRemoteAddr() + &quot; UserName &quot;</span>
				+ userBean.getUserName() + &quot; OrgName &quot; + userBean.getOrgName();

<span class="nc" id="L717">		ServletContext sc = ServletActionContext.getServletContext();</span>

<span class="nc" id="L719">		logger.debug(local + &quot;-------*****************-----------&quot; + remote);</span>
<span class="nc" id="L720">		sc.setAttribute(&quot;ERROR_TIME&quot;, errTime);</span>
<span class="nc" id="L721">		List to = new ArrayList();</span>
<span class="nc" id="L722">		to.add(&quot;lms.error@skilrock.com&quot;);</span>
<span class="nc" id="L723">		MailSender ms = new MailSender(&quot;lms.error@skilrock.com&quot;, &quot;skilrock&quot;,</span>
				to, &quot;ServerError at &quot; + local + &quot; &quot; + errTime, remote + &quot; &quot;
						+ errMsg, &quot;&quot;);
<span class="nc" id="L726">		ms.setDaemon(true);</span>
<span class="nc" id="L727">		ms.start();</span>
<span class="nc" id="L728">	}</span>

	//added by gaurav
	//retrieving the last date from temp history table for report expand
	public static String getLastArchDate() {
<span class="nc" id="L733">		 Connection con = null;</span>
<span class="nc" id="L734">		 PreparedStatement pstmt = null;</span>
<span class="nc" id="L735">		 ResultSet rs = null;</span>
<span class="nc" id="L736">		String lastDate=&quot;&quot;;</span>
<span class="nc" id="L737">		String oldLastDate = &quot;&quot;;</span>
<span class="nc" id="L738">		con = DBConnect.getConnection();</span>
		try {
<span class="nc" id="L740">			pstmt = con.prepareStatement(&quot;select last_date from tempdate_history order by id desc limit 1&quot;);</span>
<span class="nc" id="L741">			rs=pstmt.executeQuery();</span>
<span class="nc bnc" id="L742" title="All 2 branches missed.">			if(rs.next()){</span>
<span class="nc" id="L743">				lastDate=rs.getDate(&quot;last_date&quot;).toString();	</span>
			}else{
<span class="nc" id="L745">				pstmt = con.prepareStatement(&quot;select value last_date from st_lms_property_master where property_code='deployment_date'&quot;);</span>
<span class="nc" id="L746">				rs=pstmt.executeQuery();</span>
<span class="nc bnc" id="L747" title="All 2 branches missed.">				if(rs.next()){</span>
<span class="nc" id="L748">					oldLastDate=rs.getString(&quot;last_date&quot;);</span>
<span class="nc" id="L749">					SimpleDateFormat formatOld = new SimpleDateFormat(&quot;dd-MM-yyyy&quot;);</span>
<span class="nc" id="L750">					SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L751">					Date oldDate = formatOld.parse(oldLastDate);</span>
<span class="nc" id="L752">					Calendar cal1 = Calendar.getInstance();</span>
<span class="nc" id="L753">					cal1.setTime(oldDate);</span>
<span class="nc" id="L754">					cal1.add(Calendar.DAY_OF_MONTH, -1);</span>
<span class="nc" id="L755">					lastDate = format.format(cal1.getTime());</span>
				}
			}
<span class="nc" id="L758">		}catch (Exception e) {</span>
<span class="nc" id="L759">			e.printStackTrace();</span>
		}finally{
<span class="nc" id="L761">			DBConnect.closeCon(con);</span>
<span class="nc" id="L762">		}</span>
<span class="nc" id="L763">		return lastDate;</span>
	}
	public static String getArchDate() {
<span class="nc" id="L766">		 Connection con = null;</span>
<span class="nc" id="L767">		 PreparedStatement pstmt = null;</span>
<span class="nc" id="L768">		 ResultSet rs = null;</span>
<span class="nc" id="L769">		String lastDate=&quot;&quot;;</span>
<span class="nc" id="L770">		con = DBConnect.getConnection();</span>
		try {
<span class="nc" id="L772">			pstmt = con.prepareStatement(&quot;select last_date from tempdate_history order by id desc limit 1&quot;);</span>
<span class="nc" id="L773">			rs=pstmt.executeQuery();</span>
<span class="nc bnc" id="L774" title="All 2 branches missed.">			if(rs.next()){</span>
<span class="nc" id="L775">				lastDate=rs.getDate(&quot;last_date&quot;).toString();	</span>
			}
			else
			{
<span class="nc" id="L779">				return null;</span>
			}
<span class="nc" id="L781">		}catch (Exception e) {</span>
<span class="nc" id="L782">			e.printStackTrace();</span>
		}finally{
<span class="nc" id="L784">			DBConnect.closeCon(con);</span>
<span class="nc" id="L785">		}</span>
<span class="nc" id="L786">		return lastDate;</span>
	}
	
	public static String getXclOrClDetails(int orgId,String type){
<span class="nc" id="L790">		Connection con =null;</span>
<span class="nc" id="L791">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L792">		ResultSet rs = null;</span>
<span class="nc" id="L793">		String selectQuery = null;</span>
<span class="nc" id="L794">		String result=&quot;&quot;;</span>
<span class="nc" id="L795">		double retCrLimit =0.0;</span>
		try{
<span class="nc bnc" id="L797" title="All 2 branches missed.">			if(&quot;BENIN&quot;.equalsIgnoreCase(Utility.getPropertyValue(&quot;COUNTRY_DEPLOYED&quot;))){</span>
<span class="nc" id="L798">				selectQuery = &quot;select credit_limit,extended_credit_limit,extends_credit_limit_upto,collected_security_deposit security_deposit from st_lms_organization_master om INNER JOIN st_lms_organization_security_levy_master slm ON om.organization_id=slm.organization_id where om.organization_id=?&quot;;</span>
			}else{
<span class="nc" id="L800">				selectQuery = &quot;select credit_limit,extended_credit_limit,extends_credit_limit_upto,security_deposit from st_lms_organization_master where organization_id=?&quot;;</span>
			}
			
						
<span class="nc" id="L804">			con=DBConnect.getConnection();</span>
<span class="nc" id="L805">			pstmt = con.prepareStatement(selectQuery);</span>
<span class="nc" id="L806">			pstmt.setInt(1, orgId);</span>
<span class="nc" id="L807">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L808" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc bnc" id="L809" title="All 2 branches missed.">				retCrLimit = (type.equalsIgnoreCase(&quot;XCL&quot;))? rs.getDouble(&quot;extended_credit_limit&quot;)</span>
						: rs.getDouble(&quot;credit_limit&quot;);
<span class="nc" id="L811">				int days= calculateExtendsCreditLimitUpto(rs</span>
						.getDate(&quot;extends_credit_limit_upto&quot;));
<span class="nc" id="L813">				double secDep=rs.getDouble(&quot;security_deposit&quot;);</span>
<span class="nc" id="L814">				result=result.concat(String.valueOf(retCrLimit)).concat(&quot;:&quot;).concat(String.valueOf(days).concat(&quot;:&quot;).concat(String.valueOf(secDep)));</span>
			}
<span class="nc" id="L816">		}catch (Exception e) {</span>
<span class="nc" id="L817">		}</span>
<span class="nc" id="L818">		return result;</span>
	}

	
	private static int calculateExtendsCreditLimitUpto(java.sql.Date date) {
<span class="nc bnc" id="L823" title="All 2 branches missed.">		if (date == null) {</span>
<span class="nc" id="L824">			return 0;</span>
		}
<span class="nc" id="L826">		long days = 0;</span>

<span class="nc" id="L828">		Calendar today = Calendar.getInstance();</span>
<span class="nc" id="L829">		today.set(today.get(Calendar.YEAR), today.get(Calendar.MONTH), today</span>
				.get(Calendar.DAY_OF_MONTH), 0, 0, 0);

<span class="nc" id="L832">		Calendar extendedDate = Calendar.getInstance();</span>
<span class="nc" id="L833">		extendedDate.setTimeInMillis(date.getTime());</span>
<span class="nc" id="L834">		extendedDate.set(extendedDate.get(Calendar.YEAR), extendedDate</span>
				.get(Calendar.MONTH), extendedDate.get(Calendar.DAY_OF_MONTH),
				0, 0, 1);

<span class="nc" id="L838">		long timeDiff = extendedDate.getTimeInMillis()</span>
				- today.getTimeInMillis();
<span class="nc bnc" id="L840" title="All 2 branches missed.">		if (timeDiff &gt; 0) {</span>
<span class="nc" id="L841">			days = timeDiff / (1000 * 60 * 60 * 24);</span>
		}
		// System.out.println(&quot; dd days : &quot;+days +&quot; hours = &quot;+hours);
		// System.out.println(date +&quot;, extendedDate = &quot;+extendedDate.getTime()
		// +&quot; ,today : &quot;+today.getTime());
<span class="nc" id="L846">		return (int) days;</span>
	}
	
	public static String getOrgAddress(String orgId){
<span class="nc" id="L850">		String address=&quot;&quot;;</span>
<span class="nc" id="L851">		String addSeprator=&quot;, &quot;;</span>
<span class="nc" id="L852">		Connection con = null;</span>
<span class="nc" id="L853">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L854">		ResultSet rs = null;</span>
<span class="nc bnc" id="L855" title="All 4 branches missed.">		if(orgId==null || orgId.equalsIgnoreCase(&quot;&quot;)){</span>
<span class="nc" id="L856">			return address;</span>
		}
			try {
<span class="nc" id="L859">				con = DBConnect.getConnection();</span>
<span class="nc" id="L860">				pstmt = con.prepareStatement(QueryManager.getST6AddressQuery());</span>
<span class="nc" id="L861">				pstmt.setString(1, orgId);</span>
<span class="nc" id="L862">				rs=pstmt.executeQuery();</span>
<span class="nc bnc" id="L863" title="All 2 branches missed.">				while (rs.next()) {</span>
<span class="nc" id="L864">					address = address.concat(rs.getString(1)).concat(addSeprator).concat(rs.getString(2)).concat(addSeprator).concat(rs.getString(3)).concat(addSeprator).concat(rs.getString(4)).concat(addSeprator).concat(rs.getString(5));</span>
				}
			}
<span class="nc" id="L867">			catch (Exception e) {</span>
<span class="nc" id="L868">				address=&quot;&quot;;</span>
<span class="nc" id="L869">				e.printStackTrace();</span>
			}
			finally{
<span class="nc" id="L872">				try {</span>
<span class="nc" id="L873">					pstmt.close();</span>
<span class="nc" id="L874">					rs.close();</span>
<span class="nc" id="L875">				} catch (SQLException e) {</span>
<span class="nc" id="L876">					e.printStackTrace();</span>
<span class="nc" id="L877">				}</span>
<span class="nc bnc" id="L878" title="All 6 branches missed.">				if(con!=null){</span>
<span class="nc" id="L879">					DBConnect.closeCon(con);</span>
				}
			}
		
<span class="nc" id="L883">		return address;</span>
	}
	
/*	public static Map&lt;Integer, String&gt; getAgentInfoMap()	throws LMSException {
			
			Connection con = DBConnect.getConnection();
			PreparedStatement pstmt =null;
			ResultSet rs = null;
			String query=null;
			Map&lt;Integer,String&gt; agentInfoMap=null;
			
			try {
					String appendOrder =QueryManager.getAppendOrgOrder();
						if((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;CODE&quot;) ){
							query =&quot;select org_code orgCode,organization_id from st_lms_organization_master where organization_type=? order by  &quot;+appendOrder;
	
					}else if((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;CODE_NAME&quot;)){
		
		
						query =&quot;select concat(org_code,'_',name) orgCode,organization_id from st_lms_organization_master where organization_type=? order by &quot;+appendOrder;
	
			
	
					}else if((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;NAME_CODE&quot;)){
		
	
						query =&quot;select concat(name,'_',org_code) orgCode,organization_id from st_lms_organization_master where organization_type=?  order by  &quot;+appendOrder;
	
		
		
					}else {
					
						query =&quot;select name orgCode,organization_id from st_lms_organization_master where organization_type=?   order by  &quot;+appendOrder;
			
		
					}
			
				pstmt = con.prepareStatement(query);
				pstmt.setString(1,&quot;AGENT&quot;);
				
				rs = pstmt.executeQuery();
				agentInfoMap=new LinkedHashMap&lt;Integer, String&gt;();
			while (rs.next()) {
				agentInfoMap.put(rs.getInt(&quot;organization_id&quot;), rs.getString(&quot;orgCode&quot;));
			}
			
		} catch (Exception e) {
			e.printStackTrace();
			throw new LMSException(e);
		} finally {
			try {
				if (con != null &amp;&amp; !con.isClosed()) {
					con.close();
				}
			} catch (Exception e) {
				e.printStackTrace();
			}
		}
		
		return agentInfoMap;
		}*/
	
	public static Map&lt;Integer, String&gt; getOrgInfoMap(int userOrgId, String orgType)	throws LMSException {
		
<span class="nc" id="L947">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L948">		PreparedStatement pstmt =null;</span>
<span class="nc" id="L949">		ResultSet rs = null;</span>
<span class="nc" id="L950">		String query=null;</span>
<span class="nc" id="L951">		Map&lt;Integer,String&gt; retInfoMap=null;</span>
		
		try {
<span class="nc" id="L954">			String appendOrder =QueryManager.getAppendOrgOrder();</span>
			
<span class="nc bnc" id="L956" title="All 2 branches missed.">			if((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;CODE&quot;) ){</span>
				
				
<span class="nc" id="L959">				query =&quot;select org_code orgCode,organization_id from st_lms_organization_master where organization_type=? and parent_id=?  and organization_status &lt;&gt; 'TERMINATE' order by  &quot;+appendOrder;</span>
			
<span class="nc bnc" id="L961" title="All 2 branches missed.">			}else if((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;CODE_NAME&quot;)){</span>
				
				
<span class="nc" id="L964">			query =&quot;select concat(org_code,'_',name) orgCode,organization_id from st_lms_organization_master where organization_type=? and parent_id=? and organization_status &lt;&gt; 'TERMINATE' order by &quot;+appendOrder;</span>
			
					
			
<span class="nc bnc" id="L968" title="All 2 branches missed.">			}else if((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;NAME_CODE&quot;)){</span>
				
			
<span class="nc" id="L971">				query =&quot;select concat(name,'_',org_code) orgCode,organization_id from st_lms_organization_master where organization_type=? and parent_id=? and organization_status &lt;&gt; 'TERMINATE' order by  &quot;+appendOrder;</span>
			
				
				
			}else {
							
<span class="nc" id="L977">				query =&quot;select name orgCode,organization_id from st_lms_organization_master where organization_type=? and parent_id=?  and organization_status &lt;&gt; 'TERMINATE' order by  &quot;+appendOrder;</span>
					
				
			}
					
<span class="nc" id="L982">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L983">			pstmt.setString(1,orgType);</span>
<span class="nc" id="L984">			pstmt.setInt(2,userOrgId);</span>
<span class="nc" id="L985">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L986">			retInfoMap=new LinkedHashMap&lt;Integer, String&gt;();</span>
<span class="nc bnc" id="L987" title="All 2 branches missed.">		while (rs.next()) {</span>
<span class="nc" id="L988">			retInfoMap.put(rs.getInt(&quot;organization_id&quot;), rs.getString(&quot;orgCode&quot;));</span>
		}
		
<span class="nc" id="L991">			} catch (SQLException se) {</span>
<span class="nc" id="L992">				logger.error(&quot;Exception&quot;,se);</span>
<span class="nc" id="L993">				throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE,LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
			}
<span class="nc" id="L995">			catch (Exception e) {</span>
<span class="nc" id="L996">				logger.error(&quot;Exception&quot;,e);</span>
<span class="nc" id="L997">				throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE,LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
			}
			finally {
<span class="nc" id="L1000">				try {</span>
<span class="nc" id="L1001">					DBConnect.closeCon(con);</span>
					}
<span class="nc" id="L1003">				 catch (Exception ee) {</span>
<span class="nc" id="L1004">					logger.error(&quot;Exception&quot;,ee);</span>
<span class="nc" id="L1005">					throw new LMSException(LMSErrors.CONNECTION_CLOSE_ERROR_CODE,LMSErrors.CONNECTION_CLOSE_ERROR_MESSAGE);</span>
					

<span class="nc" id="L1008">				}</span>
			}
<span class="nc" id="L1010">			return retInfoMap;</span>
			}

	public static final boolean checkPriviledgeActiveForUser(int userId, String priviledgeTitle, String interfaceType, String serviceName, Connection connection) throws LMSException {
<span class="nc" id="L1014">		String serviceTableName = null;</span>
<span class="nc bnc" id="L1015" title="All 2 branches missed.">		if(&quot;HOME&quot;.equals(serviceName)) {</span>
<span class="nc" id="L1016">			serviceTableName = &quot;st_lms_priviledge_rep&quot;;</span>
<span class="nc bnc" id="L1017" title="All 2 branches missed.">		} else if(&quot;DG&quot;.equals(serviceName)) {</span>
<span class="nc" id="L1018">			serviceTableName = &quot;st_dg_priviledge_rep&quot;;</span>
<span class="nc bnc" id="L1019" title="All 2 branches missed.">		} else if(&quot;CS&quot;.equals(serviceName)) {</span>
<span class="nc" id="L1020">			serviceTableName = &quot;st_cs_priviledge_rep&quot;;</span>
<span class="nc bnc" id="L1021" title="All 2 branches missed.">		} else if(&quot;SE&quot;.equals(serviceName)) {</span>
<span class="nc" id="L1022">			serviceTableName = &quot;st_se_priviledge_rep&quot;;</span>
<span class="nc bnc" id="L1023" title="All 2 branches missed.">		} else if(&quot;SLE&quot;.equals(serviceName)) {</span>
<span class="nc" id="L1024">			serviceTableName = &quot;st_sle_priviledge_rep&quot;;</span>
<span class="nc bnc" id="L1025" title="All 2 branches missed.">		} else if(&quot;OLA&quot;.equals(serviceName)) {</span>
<span class="nc" id="L1026">			serviceTableName = &quot;st_ola_priviledge_rep&quot;;</span>
<span class="nc bnc" id="L1027" title="All 2 branches missed.">		} else if(&quot;IW&quot;.equals(serviceName)) {</span>
<span class="nc" id="L1028">			serviceTableName = &quot;st_iw_priviledge_rep&quot;;</span>
		} else {
<span class="nc" id="L1030">			throw new LMSException(&quot;Invalid Service Name&quot;);</span>
		}

<span class="nc" id="L1033">		boolean flag = false;</span>
<span class="nc" id="L1034">		Statement stmt = null;</span>
<span class="nc" id="L1035">		ResultSet rs = null;</span>
<span class="nc" id="L1036">		String query = &quot;SELECT upm.priv_id FROM st_lms_user_priv_mapping upm INNER JOIN &quot;+serviceTableName+&quot; lpr ON lpr.priv_id=upm.priv_id &quot; +</span>
						&quot;AND upm.user_id=&quot;+userId+&quot; AND lpr.priv_title='&quot;+priviledgeTitle+&quot;' AND lpr.channel='&quot;+interfaceType+&quot;' AND lpr.status='ACTIVE' AND upm.status='ACTIVE';&quot;;
		try {
<span class="nc" id="L1039">			stmt = connection.createStatement();</span>
<span class="nc" id="L1040">			logger.info(&quot;checkPriviledgeActiveForUser Query - &quot;+query);</span>
<span class="nc" id="L1041">			rs = stmt.executeQuery(query);</span>
<span class="nc bnc" id="L1042" title="All 2 branches missed.">			if(rs.next()) {</span>
<span class="nc" id="L1043">				flag = true;</span>
			}
<span class="nc" id="L1045">		} catch (Exception ex) {</span>
<span class="nc" id="L1046">			ex.printStackTrace();</span>
<span class="nc" id="L1047">		}</span>

<span class="nc" id="L1049">		return flag;</span>
	}

	public static final List&lt;String&gt; getTierWiseInterfaceList(String tierType) {
<span class="nc" id="L1053">		List&lt;String&gt; interfaceList = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L1054">		Connection connection = null;</span>
<span class="nc" id="L1055">		Statement stmt = null;</span>
<span class="nc" id="L1056">		ResultSet rs = null;</span>
		try {
<span class="nc" id="L1058">			String query = &quot;SELECT DISTINCT(interface) FROM st_lms_service_delivery_master sdm INNER JOIN st_lms_tier_master ltm ON sdm.tier_id=ltm.tier_id &quot; +</span>
					&quot;AND ltm.tier_code='&quot;+tierType+&quot;' AND ltm.tier_status='ACTIVE' AND sdm.channel='RETAIL';&quot;;
<span class="nc" id="L1060">			connection = DBConnect.getConnection();</span>
<span class="nc" id="L1061">			stmt = connection.createStatement();</span>
<span class="nc" id="L1062">			logger.info(&quot;getTypeWiseInterfaceList Query - &quot;+query);</span>
<span class="nc" id="L1063">			rs = stmt.executeQuery(query);</span>
<span class="nc bnc" id="L1064" title="All 2 branches missed.">			while(rs.next()) {</span>
<span class="nc" id="L1065">				interfaceList.add(rs.getString(&quot;interface&quot;));</span>
			}
<span class="nc" id="L1067">		} catch (Exception ex) {</span>
<span class="nc" id="L1068">			ex.printStackTrace();</span>
<span class="nc" id="L1069">		}</span>

<span class="nc" id="L1071">		return interfaceList;</span>
	}
	public static void doRoundingForPwtAmt(PWTDrawBean winningBean){
		// Rounding Done Based On the Requirement. Initially we used to do it in DGE.
<span class="nc" id="L1075">		List&lt;DrawIdBean&gt; drawWinList = null;</span>
<span class="nc" id="L1076">		drawWinList=winningBean.getDrawWinList();</span>
<span class="nc" id="L1077">		Iterator&lt;DrawIdBean&gt; drawWiseiterator = drawWinList.iterator();</span>
<span class="nc bnc" id="L1078" title="All 2 branches missed.">		while(drawWiseiterator.hasNext()){</span>
<span class="nc" id="L1079">			DrawIdBean drawIdBean = drawWiseiterator.next();</span>
			//Draw Wise Rounding
<span class="nc bnc" id="L1081" title="All 2 branches missed.">			if(drawIdBean.getPanelWinList()!=null){</span>
<span class="nc" id="L1082">			drawIdBean.setWinningAmt(Math.round(Double.parseDouble(drawIdBean.getWinningAmt()))+&quot;&quot;);</span>
<span class="nc" id="L1083">			Iterator&lt;PanelIdBean&gt; panelWiseiterator = drawIdBean.getPanelWinList().iterator();</span>
<span class="nc bnc" id="L1084" title="All 2 branches missed.">				while(panelWiseiterator.hasNext()){</span>
<span class="nc" id="L1085">					PanelIdBean panelIdBean = panelWiseiterator.next();</span>
					//Panel Wise Rounding
<span class="nc" id="L1087">					panelIdBean.setWinningAmt(Math.round(panelIdBean.getWinningAmt()));</span>
<span class="nc" id="L1088">				}</span>
			}		
<span class="nc" id="L1090">		}</span>
<span class="nc" id="L1091">	}</span>
	
	
	private static boolean isNewRangeReq(Timestamp lastGenDate , int curStrtRange , int curEndRange) throws LMSException{
		try {
<span class="nc" id="L1096">			Calendar cal =  Calendar.getInstance();</span>
<span class="nc" id="L1097">			int curYear = cal.get(Calendar.YEAR);</span>
<span class="nc" id="L1098">			cal.setTimeInMillis(lastGenDate.getTime());</span>
<span class="nc" id="L1099">			int lastYear = cal.get(Calendar.YEAR);</span>
		
<span class="nc bnc" id="L1101" title="All 2 branches missed.">			if(lastYear == curYear){</span>
<span class="nc" id="L1102">				return false;</span>
<span class="nc bnc" id="L1103" title="All 2 branches missed.">			}else if(lastYear&lt;curYear){</span>
<span class="nc" id="L1104">				return true;</span>
			}else{
<span class="nc" id="L1106">				throw new LMSException();</span>
			}
<span class="nc" id="L1108">		} catch (LMSException e) {</span>
<span class="nc" id="L1109">			throw new LMSException();</span>
<span class="nc" id="L1110">		}catch (Exception e) {</span>
<span class="nc" id="L1111">			throw new LMSException();</span>
		}
	} 
	
	/** @author  Mandeep 

     * @param  userIdMappingBean
     *         Bean that Contains the information of generation process 
     *
     * @param  con
     *         Data Base connection.
     *
     * @throws  LMSException 
     */
	public static synchronized void getUserIdToGenMappindId(UserIdMappingBean userIdMappingBean, Connection con) throws LMSException{

<span class="nc" id="L1127">		String updateQuery = null;</span>
<span class="nc" id="L1128">		int lastCodeExpiryDays = 0;</span>
<span class="nc" id="L1129">		int curStrtRange = 0;</span>
<span class="nc" id="L1130">		int curEndRange = 0;</span>
		
<span class="nc" id="L1132">		ResultSet rs=null;</span>
<span class="nc" id="L1133">		Statement stmt = null;</span>
<span class="nc" id="L1134">		PreparedStatement pstmt=null;</span>
		
<span class="nc" id="L1136">		Timestamp lastExpDate = null;</span>
<span class="nc" id="L1137">		Timestamp lastSuccDate = null;</span>
		
<span class="nc" id="L1139">		boolean isSameDay = false;</span>
<span class="nc" id="L1140">		boolean isFirstTimeGen = false;</span>
<span class="nc" id="L1141">		boolean retailersBlocked =false;</span>
<span class="nc" id="L1142">		boolean newRangeReq = false;</span>
<span class="nc" id="L1143">		SetResetUserPasswordAction setResetUserPasswordAction = null;</span>
		try {
<span class="nc" id="L1145">			checkMappingIdDup(con);</span>
<span class="nc" id="L1146">			pstmt = con.prepareStatement(&quot;select gen_date ,code_expiry_days ,last_exp_date , if(date(gen_date) = date(now()) , true,false) same_day , start_range, end_range  from st_lms_user_random_id_generation_status order by gen_date DESC limit 1&quot;);</span>
<span class="nc" id="L1147">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1148" title="All 2 branches missed.">				if(rs.next()){</span>
<span class="nc" id="L1149">					isSameDay = rs.getBoolean(&quot;same_day&quot;);</span>
					
					// NEWLY ADDEDD
<span class="nc" id="L1152">					curEndRange = rs.getInt(&quot;end_range&quot;);</span>
<span class="nc" id="L1153">					curStrtRange = rs.getInt(&quot;start_range&quot;);</span>
					
<span class="nc" id="L1155">					lastSuccDate = rs.getTimestamp(&quot;gen_date&quot;);</span>
<span class="nc" id="L1156">					lastExpDate = rs.getTimestamp(&quot;last_exp_date&quot;);</span>
<span class="nc" id="L1157">					lastCodeExpiryDays = rs.getInt(&quot;code_expiry_days&quot;);</span>
<span class="nc" id="L1158">					newRangeReq = isNewRangeReq(lastSuccDate , curStrtRange , curEndRange);</span>
<span class="nc" id="L1159">					updateQuery = &quot;update st_lms_user_random_id_mapping set user_mapping_id = ? , mapping_id_gen_date = ? , code_expiry = ? , adv_user_mapping_id = ? , adv_mapping_id_gen_date = ? , adv_code_expiry =? where user_id =? &quot;;</span>
				}else {
<span class="nc" id="L1161">					newRangeReq = true;</span>
<span class="nc" id="L1162">					isFirstTimeGen = true;</span>
<span class="nc" id="L1163">					updateQuery = &quot;insert into st_lms_user_random_id_mapping values (?,?,?,?,?,?,?)&quot;;</span>
				}
				
<span class="nc" id="L1166">				userIdMappingBean.setLastExpDate(lastExpDate);</span>
<span class="nc" id="L1167">				userIdMappingBean.setLastSuccDate(lastSuccDate);</span>
<span class="nc" id="L1168">				userIdMappingBean.setFirstGeneration(isFirstTimeGen);</span>
<span class="nc" id="L1169">				userIdMappingBean.setLastCodeExpiryDays(lastCodeExpiryDays);</span>
				
				// NEWLY ADDEDD
<span class="nc" id="L1172">				userIdMappingBean.setCurEndRange(curEndRange);</span>
<span class="nc" id="L1173">				userIdMappingBean.setCurStrtRange(curStrtRange);</span>
<span class="nc" id="L1174">				userIdMappingBean.setNewRangeReq(newRangeReq);</span>
				
<span class="nc" id="L1176">				setResetUserPasswordAction = new SetResetUserPasswordAction();</span>
<span class="nc bnc" id="L1177" title="All 2 branches missed.">				if(userIdMappingBean.isAll()){</span>
					//check if the retailer has done any transaction today if No , then make sure to logout that retailer
<span class="nc bnc" id="L1179" title="All 2 branches missed.">					if(isSameDay){</span>
<span class="nc" id="L1180">						throw new LMSException(LMSErrors.RAMDOM_ID_GENERATION_ERROR_CODE , LMSErrors.RAMDOM_ID_GENERATION_ERROR_MESSAGE);</span>
					}
					/*check user Transaction for today*/
<span class="nc" id="L1183">					checkUserTransaction(userIdMappingBean.isAll() ,userIdMappingBean.getUserId() ,userIdMappingBean.getRequesInitiateTime(), con);</span>
					/*logout all retailers*/
<span class="nc" id="L1185">					setResetUserPasswordAction.logOutAllRets();</span>
					/*stop all retailers from login */
<span class="nc" id="L1187">					setResetUserPasswordAction.stopLoginAllUsers();</span>
<span class="nc" id="L1188">					retailersBlocked = true;</span>
					
<span class="nc bnc" id="L1190" title="All 2 branches missed.">					if(!userIdMappingBean.isThirdPartyGeneration()){</span>
						/*Generate Only if Not Third */
<span class="nc" id="L1192">						generateNewMappingForAll(userIdMappingBean ,con);</span>
					}
					/*update/insert random ids into the data base*/
<span class="nc" id="L1195">					updateUserMappingId(userIdMappingBean ,updateQuery ,con);</span>
<span class="nc bnc" id="L1196" title="All 2 branches missed.">				}else if(userIdMappingBean.isSpecific()){</span>
					//check if the retailer has done any transaction today if No , then make sure to logout that retailer 
<span class="nc" id="L1198">						checkUserTransaction(userIdMappingBean.isAll() ,userIdMappingBean.getUserId() ,userIdMappingBean.getRequesInitiateTime(), con);</span>
<span class="nc bnc" id="L1199" title="All 2 branches missed.">					if(!userIdMappingBean.isThirdPartyGeneration()){</span>
						/*Generate Only if Not Third */
<span class="nc" id="L1201">						generateNewMappingForIndividual(userIdMappingBean ,con);</span>
					}
					/*update/insert random ids into the data base*/
<span class="nc" id="L1204">					updateUserMappingId(userIdMappingBean ,updateQuery ,con);</span>
				}else{
<span class="nc" id="L1206">					throw new LMSException(LMSErrors.SECURITY_BREACH_ERROR_CODE , LMSErrors.SECURITY_BREACH_ERROR_MESSAGE);</span>
				}
<span class="nc" id="L1208">		}catch (LMSException e) {</span>
<span class="nc" id="L1209">			e.printStackTrace();</span>
<span class="nc" id="L1210">			throw e;</span>
<span class="nc" id="L1211">		} catch (SQLException e) {</span>
<span class="nc" id="L1212">			logger.error(&quot;SQLException : - &quot;, e);</span>
<span class="nc" id="L1213">			e.printStackTrace();</span>
<span class="nc" id="L1214">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE , LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1215">		} catch (Exception e) {</span>
<span class="nc" id="L1216">			logger.error(&quot;Exception : - &quot;, e);</span>
<span class="nc" id="L1217">			e.printStackTrace();</span>
<span class="nc" id="L1218">			throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE , LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
		}finally{
<span class="nc bnc" id="L1220" title="All 4 branches missed.">			if(retailersBlocked){</span>
				try {
					/*resume all retailers only if they are blocked*/
<span class="nc" id="L1223">					setResetUserPasswordAction.stopLoginAllUsers();</span>
<span class="nc" id="L1224">					retailersBlocked = false;</span>
<span class="nc" id="L1225">				} catch (IOException e) {</span>
<span class="nc" id="L1226">					logger.error(&quot;PROBLEM WITH ENABLING RETAILERS : - &quot;, e);</span>
<span class="nc" id="L1227">					e.printStackTrace();</span>
<span class="nc" id="L1228">					throw new LMSException(LMSErrors.IO_EXCEPTION_ERROR_CODE , LMSErrors.IO_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1229">				}</span>
			}
<span class="nc" id="L1231">			DBConnect.closeStmt(stmt);</span>
<span class="nc" id="L1232">			DBConnect.closePstmt(pstmt);</span>
			
<span class="nc" id="L1234">		}</span>
<span class="nc" id="L1235">	}</span>
	
	
	private static void generateNewMappingForIndividual(UserIdMappingBean userIdMappingBean , Connection con) throws LMSException{

		boolean isExists;
<span class="nc" id="L1241">		ResultSet rs=null;</span>
<span class="nc" id="L1242">		long currentTimeInMilis = 0;</span>
<span class="nc" id="L1243">		PreparedStatement pstmt=null;</span>
<span class="nc" id="L1244">		LinkedHashMap&lt;Integer, Integer&gt; userMappingIdMap = null;</span>
<span class="nc" id="L1245">		LinkedHashMap&lt;Integer, Integer&gt; advUserMappingIdMap = null;</span>
		try {
<span class="nc bnc" id="L1247" title="All 2 branches missed.">			if(userIdMappingBean.getUserId() == 0){</span>
<span class="nc" id="L1248">				throw new LMSException(LMSErrors.INVALIDATE_RETAILER_ERROR_CODE , LMSErrors.INVALIDATE_RETAILER_ERROR_MESSAGE);</span>
			}

<span class="nc" id="L1251">			pstmt = con.prepareStatement(&quot;select * from st_lms_user_random_id_mapping where user_id = ?&quot;);</span>
<span class="nc" id="L1252">			pstmt.setInt(1, userIdMappingBean.getUserId());</span>
<span class="nc" id="L1253">			rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1254" title="All 2 branches missed.">			if(rs.next()){</span>
<span class="nc" id="L1255">				isExists = true; </span>
			}else{
<span class="nc" id="L1257">				isExists = false;</span>
			}

<span class="nc" id="L1260">			userIdMappingBean.setExists(isExists);</span>
<span class="nc" id="L1261">			pstmt = con.prepareStatement(&quot;select user_id, user_mapping_id, adv_user_mapping_id  from st_lms_user_random_id_mapping&quot;);</span>
<span class="nc" id="L1262">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L1263">			userMappingIdMap =  new LinkedHashMap&lt;Integer, Integer&gt;();</span>
<span class="nc" id="L1264">			advUserMappingIdMap =  new LinkedHashMap&lt;Integer, Integer&gt;();</span>
<span class="nc bnc" id="L1265" title="All 2 branches missed.">			while(rs.next()){</span>
<span class="nc" id="L1266">				int userId = rs.getInt(&quot;user_id&quot;);</span>
<span class="nc" id="L1267">				userMappingIdMap.put(userId, rs.getInt(&quot;user_mapping_id&quot;));</span>
<span class="nc" id="L1268">				advUserMappingIdMap.put(userId, rs.getInt(&quot;adv_user_mapping_id&quot;));</span>
<span class="nc" id="L1269">			}</span>
			
<span class="nc" id="L1271">			currentTimeInMilis = System.currentTimeMillis();		</span>
<span class="nc bnc" id="L1272" title="All 2 branches missed.">			if(userIdMappingBean.isFirstGeneration()){</span>
<span class="nc" id="L1273">				userIdMappingBean.setNewGenerationDateTime(getCodeGenAndExpDates(0 ,currentTimeInMilis ,true));</span>
<span class="nc" id="L1274">				userIdMappingBean.setNewCodeExpiryDateTime(getCodeGenAndExpDates(userIdMappingBean.getExpiryDays() ,currentTimeInMilis ,false));</span>
				
<span class="nc" id="L1276">				userIdMappingBean.setAdvGenerationDateTime(getCodeGenAndExpDates(userIdMappingBean.getExpiryDays() ,currentTimeInMilis+oneDay ,true));</span>
<span class="nc" id="L1277">				userIdMappingBean.setAdvCodeExpiryDateTime(getCodeGenAndExpDates(userIdMappingBean.getExpiryDays()*2 ,currentTimeInMilis+oneDay ,false));</span>
<span class="nc" id="L1278">				generateRandomIds(userIdMappingBean.getUserId() , 1 ,new HashSet&lt;Integer&gt;() , userMappingIdMap ,userIdMappingBean.isAll() ,userIdMappingBean.isNewRangeReq() , userIdMappingBean.getCurStrtRange() , userIdMappingBean.getCurEndRange());</span>
<span class="nc bnc" id="L1279" title="All 2 branches missed.">			}else if(!isExists){</span>
<span class="nc" id="L1280">				userIdMappingBean.setNewGenerationDateTime(getCodeGenAndExpDates(0 ,currentTimeInMilis ,true));</span>
<span class="nc" id="L1281">				userIdMappingBean.setNewCodeExpiryDateTime(getCodeGenAndExpDates(userIdMappingBean.getExpiryDays() ,currentTimeInMilis ,false));</span>
				
<span class="nc" id="L1283">				userIdMappingBean.setAdvGenerationDateTime(getCodeGenAndExpDates((userIdMappingBean.getLastCodeExpiryDays()*-1) ,userIdMappingBean.getLastExpDate().getTime() ,true));</span>
<span class="nc" id="L1284">				userIdMappingBean.setAdvCodeExpiryDateTime(getCodeGenAndExpDates(0 ,userIdMappingBean.getLastExpDate().getTime() ,false));</span>
<span class="nc" id="L1285">				generateRandomIds(userIdMappingBean.getUserId() , 1 ,new HashSet&lt;Integer&gt;(userMappingIdMap.values()) , userMappingIdMap ,userIdMappingBean.isAll() ,userIdMappingBean.isNewRangeReq() , userIdMappingBean.getCurStrtRange() , userIdMappingBean.getCurEndRange());</span>
			}else{/*// NOT DECIDED YET
				userMappingIdMap =  null;
				userIdMappingBean.setNewGenerationDateTime(getCodeGenAndExpDates(0 ,currentTimeInMilis ,true));
				userIdMappingBean.setNewCodeExpiryDateTime(getCodeGenAndExpDates(userIdMappingBean.getExpiryDays() ,userIdMappingBean.getLastExpDate().getTime() ,false));
				
				userIdMappingBean.setAdvGenerationDateTime(getCodeGenAndExpDates(0 ,userIdMappingBean.getLastExpDate().getTime()+oneDay ,true));
				userIdMappingBean.setAdvCodeExpiryDateTime(getCodeGenAndExpDates(userIdMappingBean.getExpiryDays() ,userIdMappingBean.getLastExpDate().getTime()+oneDay ,false));
				userMappingIdMap = new LinkedHashMap&lt;Integer, Integer&gt;();
				userMappingIdMap.put(userIdMappingBean.getUserId(), advUserMappingIdMap.get(userIdMappingBean.getUserId()));
			*/}
			
			// ADVANCE GEN IN BOTH THE CASES;
<span class="nc" id="L1298">			generateRandomIds(userIdMappingBean.getUserId() , 1, new HashSet&lt;Integer&gt;(advUserMappingIdMap.values())  , advUserMappingIdMap ,userIdMappingBean.isAll() ,userIdMappingBean.isNewRangeReq() , userIdMappingBean.getCurStrtRange() , userIdMappingBean.getCurEndRange());</span>
<span class="nc" id="L1299">			userIdMappingBean.setUserMappingIdMap(userMappingIdMap);</span>
<span class="nc" id="L1300">			userIdMappingBean.setAdvUserMappingIdMap(advUserMappingIdMap);</span>
			//updateUserMappingId(userIdMappingBean ,isExists ,con);
<span class="nc" id="L1302">	}catch (LMSException e) {</span>
<span class="nc" id="L1303">		throw e;</span>
<span class="nc" id="L1304">	} catch (SQLException e) {</span>
<span class="nc" id="L1305">		logger.error(&quot;SQLException : - &quot;, e);</span>
<span class="nc" id="L1306">		e.printStackTrace();</span>
<span class="nc" id="L1307">		throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE , LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1308">	} catch (Exception e) {</span>
<span class="nc" id="L1309">		logger.error(&quot;Exception : - &quot;, e);</span>
<span class="nc" id="L1310">		e.printStackTrace();</span>
<span class="nc" id="L1311">		throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE , LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1312">	}</span>
<span class="nc" id="L1313">	}</span>
	
	private static void generateNewMappingForAll(UserIdMappingBean userIdMappingBean , Connection con) throws LMSException{

<span class="nc" id="L1317">		ResultSet rs=null;</span>
<span class="nc" id="L1318">		Statement stmt = null;</span>
<span class="nc" id="L1319">		String selectQuery = null;</span>
<span class="nc" id="L1320">		long currentTimeInMilis = 0;</span>
<span class="nc" id="L1321">		LinkedHashMap&lt;Integer, Integer&gt; userMappingIdMap = null;</span>
<span class="nc" id="L1322">		LinkedHashMap&lt;Integer, Integer&gt; advUserMappingIdMap = null;</span>
		
		try {
<span class="nc bnc" id="L1325" title="All 4 branches missed.">			if(!userIdMappingBean.isFirstGeneration() &amp;&amp; !userIdMappingBean.isNewRangeReq()){</span>
<span class="nc" id="L1326">				selectQuery = &quot;select user_id, user_mapping_id, adv_user_mapping_id  from st_lms_user_random_id_mapping&quot;;</span>
			}else{
<span class="nc" id="L1328">				selectQuery = &quot;select user_id, 0 user_mapping_id, 0 adv_user_mapping_id   from st_lms_user_master where organization_type = 'RETAILER'&quot;;</span>
			}
<span class="nc" id="L1330">			stmt = con.createStatement();</span>
<span class="nc" id="L1331">			rs = stmt.executeQuery(selectQuery);</span>
<span class="nc" id="L1332">			userMappingIdMap =  new LinkedHashMap&lt;Integer, Integer&gt;();</span>
<span class="nc" id="L1333">			advUserMappingIdMap =  new LinkedHashMap&lt;Integer, Integer&gt;();</span>
<span class="nc bnc" id="L1334" title="All 2 branches missed.">			while(rs.next()){</span>
<span class="nc" id="L1335">				int userId = rs.getInt(&quot;user_id&quot;);</span>
<span class="nc" id="L1336">				userMappingIdMap.put(userId, rs.getInt(&quot;user_mapping_id&quot;));</span>
<span class="nc" id="L1337">				advUserMappingIdMap.put(userId, rs.getInt(&quot;adv_user_mapping_id&quot;));</span>
<span class="nc" id="L1338">			}</span>
<span class="nc" id="L1339">			currentTimeInMilis = System.currentTimeMillis();</span>
<span class="nc bnc" id="L1340" title="All 4 branches missed.">			if(userIdMappingBean.isFirstGeneration() || userIdMappingBean.isNewRangeReq()){</span>
<span class="nc" id="L1341">				userIdMappingBean.setNewGenerationDateTime(getCodeGenAndExpDates(0 ,currentTimeInMilis ,true));</span>
<span class="nc" id="L1342">				userIdMappingBean.setNewCodeExpiryDateTime(getCodeGenAndExpDates(userIdMappingBean.getExpiryDays() ,currentTimeInMilis ,false));</span>
				
<span class="nc" id="L1344">				userIdMappingBean.setAdvGenerationDateTime(getCodeGenAndExpDates(userIdMappingBean.getExpiryDays() ,currentTimeInMilis+oneDay ,true));</span>
<span class="nc" id="L1345">				userIdMappingBean.setAdvCodeExpiryDateTime(getCodeGenAndExpDates(userIdMappingBean.getExpiryDays()*2 ,currentTimeInMilis+oneDay ,false));</span>
<span class="nc" id="L1346">				generateRandomIds(userIdMappingBean.getUserId() , userMappingIdMap.size() ,new HashSet&lt;Integer&gt;() , userMappingIdMap ,userIdMappingBean.isAll() ,userIdMappingBean.isNewRangeReq() , userIdMappingBean.getCurStrtRange() , userIdMappingBean.getCurEndRange());</span>
			}else{
<span class="nc" id="L1348">				userMappingIdMap =  null;</span>
<span class="nc" id="L1349">				userIdMappingBean.setNewGenerationDateTime(getCodeGenAndExpDatesForAll(userIdMappingBean.getRequesInitiateTime() , userIdMappingBean.getLastSuccDate().toString() , userIdMappingBean.getLastCodeExpiryDays() , true , false));</span>
<span class="nc" id="L1350">				userIdMappingBean.setNewCodeExpiryDateTime(getCodeGenAndExpDatesForAll(&quot;&quot; , userIdMappingBean.getNewGenerationDateTime() , userIdMappingBean.getLastCodeExpiryDays() , false ,true));</span>
				
<span class="nc" id="L1352">				userIdMappingBean.setAdvGenerationDateTime(getCodeGenAndExpDatesForAll(&quot;&quot; ,userIdMappingBean.getNewCodeExpiryDateTime() , 1 , true ,true));</span>
<span class="nc" id="L1353">				userIdMappingBean.setAdvCodeExpiryDateTime(getCodeGenAndExpDatesForAll(&quot;&quot; ,userIdMappingBean.getAdvGenerationDateTime() ,userIdMappingBean.getExpiryDays() , false ,true));</span>
<span class="nc" id="L1354">				userMappingIdMap = new LinkedHashMap&lt;Integer, Integer&gt;(advUserMappingIdMap);</span>
				/*userMappingIdMap =  null;
				userIdMappingBean.setNewGenerationDateTime(getCodeGenAndExpDates((userIdMappingBean.getLastCodeExpiryDays()*-1) ,userIdMappingBean.getLastExpDate().getTime() ,true));
				userIdMappingBean.setNewCodeExpiryDateTime(getCodeGenAndExpDates(0 ,userIdMappingBean.getLastExpDate().getTime() ,false));
				
				userIdMappingBean.setAdvGenerationDateTime(getCodeGenAndExpDates(0 ,userIdMappingBean.getLastExpDate().getTime()+oneDay ,true));
				userIdMappingBean.setAdvCodeExpiryDateTime(getCodeGenAndExpDates(userIdMappingBean.getExpiryDays() ,userIdMappingBean.getLastExpDate().getTime()+oneDay ,false));
				userMappingIdMap = new LinkedHashMap&lt;Integer, Integer&gt;(advUserMappingIdMap);*/
			}
			// ADVANCE GEN IN BOTH THE CASES;
<span class="nc" id="L1364">			generateRandomIds(userIdMappingBean.getUserId() , advUserMappingIdMap.size() ,new HashSet&lt;Integer&gt;() , advUserMappingIdMap ,userIdMappingBean.isAll() ,userIdMappingBean.isNewRangeReq() , userIdMappingBean.getCurStrtRange() , userIdMappingBean.getCurEndRange());</span>
			
<span class="nc bnc" id="L1366" title="All 2 branches missed.">			if(userMappingIdMap.size() != advUserMappingIdMap.size()){</span>
<span class="nc" id="L1367">				throw new LMSException(LMSErrors.RAMDOM_ID_GENERATION_PROCESS_ERROR_CODE , LMSErrors.RAMDOM_ID_GENERATION_PROCESS_ERROR_MESSAGE);</span>
			}
<span class="nc" id="L1369">			userIdMappingBean.setUserMappingIdMap(userMappingIdMap);</span>
<span class="nc" id="L1370">			userIdMappingBean.setAdvUserMappingIdMap(advUserMappingIdMap);</span>
			//updateUserMappingId(userIdMappingBean ,false ,con);
<span class="nc" id="L1372">	}catch (LMSException e) {</span>
<span class="nc" id="L1373">		throw e;</span>
<span class="nc" id="L1374">	} catch (SQLException e) {</span>
<span class="nc" id="L1375">		logger.error(&quot;SQLException : - &quot;, e);</span>
<span class="nc" id="L1376">		e.printStackTrace();</span>
<span class="nc" id="L1377">		throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE , LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1378">	} catch (Exception e) {</span>
<span class="nc" id="L1379">		logger.error(&quot;Exception : - &quot;, e);</span>
<span class="nc" id="L1380">		e.printStackTrace();</span>
<span class="nc" id="L1381">		throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE , LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1382">	}</span>
<span class="nc" id="L1383">	}</span>

	private static void updateUserMappingId(UserIdMappingBean userIdMappingBean ,String updateQuery ,Connection con) throws LMSException, IOException{
		
<span class="nc" id="L1387">		int size = 0;</span>
<span class="nc" id="L1388">		int check = 0;</span>
<span class="nc" id="L1389">		int count = 0;</span>
<span class="nc" id="L1390">		boolean batchExecuted = false;</span>
<span class="nc" id="L1391">		PreparedStatement pstmt = null;</span>
		try {
<span class="nc" id="L1393">			con.setAutoCommit(false);</span>
<span class="nc bnc" id="L1394" title="All 2 branches missed.">		if (userIdMappingBean.isSpecific()) {</span>
<span class="nc" id="L1395">			int userId = userIdMappingBean.getUserId();</span>
<span class="nc bnc" id="L1396" title="All 2 branches missed.">			if(!userIdMappingBean.isExists()){</span>
<span class="nc" id="L1397">				pstmt = con.prepareStatement(&quot;insert into st_lms_user_random_id_mapping values (?,?,?,?,?,?,?)&quot;);</span>
<span class="nc" id="L1398">				pstmt.setInt(1, userIdMappingBean.getUserId());</span>
<span class="nc" id="L1399">				pstmt.setInt(2, userIdMappingBean.getUserMappingIdMap().get(userId));</span>
<span class="nc" id="L1400">				pstmt.setString(3, userIdMappingBean.getNewGenerationDateTime());</span>
<span class="nc" id="L1401">				pstmt.setString(4, userIdMappingBean.getNewCodeExpiryDateTime());</span>
<span class="nc" id="L1402">				pstmt.setInt(5, userIdMappingBean.getAdvUserMappingIdMap().get(userId));</span>
<span class="nc" id="L1403">				pstmt.setString(6, userIdMappingBean.getAdvGenerationDateTime());</span>
<span class="nc" id="L1404">				pstmt.setString(7, userIdMappingBean.getAdvCodeExpiryDateTime());</span>
<span class="nc" id="L1405">				pstmt.executeUpdate();</span>
<span class="nc" id="L1406">				pstmt.clearParameters();</span>
			}else{/* NO DECIDED
				new SetResetUserPasswordAction().logOutRetFromUserId(userIdMappingBean.getUserId(), con);
				pstmt = con.prepareStatement(&quot;update st_lms_user_random_id_mapping set user_mapping_id = ? , mapping_id_gen_date = ? , code_expiry = ? , adv_user_mapping_id = ? , adv_mapping_id_gen_date = ? , adv_code_expiry =? where user_id =? &quot;);
				pstmt.setInt(1, userIdMappingBean.getUserMappingIdMap().get(userId));
				pstmt.setString(2, userIdMappingBean.getNewGenerationDateTime());
				pstmt.setString(3, userIdMappingBean.getNewCodeExpiryDateTime());
				pstmt.setInt(4, userIdMappingBean.getAdvUserMappingIdMap().get(userId));
				pstmt.setString(5, userIdMappingBean.getAdvGenerationDateTime());
				pstmt.setString(6, userIdMappingBean.getAdvCodeExpiryDateTime());
				pstmt.setInt(7, userIdMappingBean.getUserId());
				pstmt.executeUpdate();
				pstmt.clearParameters();
			*/}
<span class="nc" id="L1420">			pstmt = con.prepareStatement(&quot;insert into st_lms_user_random_id_mapping_history select user_id ,user_mapping_id ,mapping_id_gen_date, code_expiry , ? , ? from st_lms_user_random_id_mapping where user_id = ?&quot;); // Mapping history</span>
<span class="nc" id="L1421">			pstmt.setString(1, userIdMappingBean.getActivity());</span>
<span class="nc" id="L1422">			pstmt.setInt(2, userIdMappingBean.getDoneByUserId());</span>
<span class="nc" id="L1423">			pstmt.setInt(3, userIdMappingBean.getUserId());</span>
<span class="nc" id="L1424">			pstmt.executeUpdate();</span>
<span class="nc" id="L1425">			pstmt.clearParameters();</span>
<span class="nc" id="L1426">			checkUserTransaction(userIdMappingBean.isAll() ,userIdMappingBean.getUserId() ,userIdMappingBean.getRequesInitiateTime(), con);</span>
<span class="nc bnc" id="L1427" title="All 2 branches missed.">		} else if(userIdMappingBean.isAll()){</span>
<span class="nc" id="L1428">			LinkedHashMap&lt;Integer, Integer&gt; newMap = userIdMappingBean.getUserMappingIdMap(); </span>
<span class="nc" id="L1429">			LinkedHashMap&lt;Integer, Integer&gt; advMap = userIdMappingBean.getAdvUserMappingIdMap();</span>
<span class="nc" id="L1430">			size = newMap.size();</span>
<span class="nc" id="L1431">			pstmt = con.prepareStatement(updateQuery);</span>

<span class="nc bnc" id="L1433" title="All 2 branches missed.">			if(!userIdMappingBean.isFirstGeneration()){</span>
<span class="nc bnc" id="L1434" title="All 2 branches missed.">			for(Map.Entry&lt;Integer, Integer&gt; entry : newMap.entrySet()){</span>
<span class="nc" id="L1435">				int userId = entry.getKey();</span>
<span class="nc" id="L1436">				count++;</span>
<span class="nc bnc" id="L1437" title="All 2 branches missed.">			if (batchExecuted) {</span>
<span class="nc" id="L1438">				pstmt = con.prepareStatement(updateQuery);</span>
<span class="nc" id="L1439">				batchExecuted = false;</span>
			}
<span class="nc" id="L1441">			pstmt.setInt(1, entry.getValue());</span>
<span class="nc" id="L1442">			pstmt.setString(2, userIdMappingBean.getNewGenerationDateTime());</span>
<span class="nc" id="L1443">			pstmt.setString(3, userIdMappingBean.getNewCodeExpiryDateTime());</span>
<span class="nc" id="L1444">			pstmt.setInt(4,    advMap.get(userId));</span>
<span class="nc" id="L1445">			pstmt.setString(5, userIdMappingBean.getAdvGenerationDateTime());</span>
<span class="nc" id="L1446">			pstmt.setString(6, userIdMappingBean.getAdvCodeExpiryDateTime());</span>
<span class="nc" id="L1447">			pstmt.setInt(7, userId);</span>

<span class="nc" id="L1449">			pstmt.addBatch();</span>
<span class="nc" id="L1450">			pstmt.clearParameters();</span>
<span class="nc bnc" id="L1451" title="All 4 branches missed.">			if (count != 0 &amp;&amp; count % 100 == 0) {</span>
<span class="nc" id="L1452">				check += pstmt.executeBatch().length;</span>
<span class="nc" id="L1453">				batchExecuted = true;</span>
					}
<span class="nc" id="L1455">				}</span>
			}else{
<span class="nc bnc" id="L1457" title="All 2 branches missed.">				for(Map.Entry&lt;Integer, Integer&gt; entry : newMap.entrySet()){</span>
<span class="nc" id="L1458">					int userId = entry.getKey();</span>
<span class="nc" id="L1459">					count++;</span>
<span class="nc bnc" id="L1460" title="All 2 branches missed.">					if (batchExecuted) {</span>
<span class="nc" id="L1461">						pstmt = con.prepareStatement(updateQuery);</span>
<span class="nc" id="L1462">						batchExecuted = false;</span>
					}
<span class="nc" id="L1464">			pstmt.setInt(1, userId);</span>
<span class="nc" id="L1465">			pstmt.setInt(2, entry.getValue());</span>
<span class="nc" id="L1466">			pstmt.setString(3, userIdMappingBean.getNewGenerationDateTime());</span>
<span class="nc" id="L1467">			pstmt.setString(4, userIdMappingBean.getNewCodeExpiryDateTime());</span>
<span class="nc" id="L1468">			pstmt.setInt(5,    advMap.get(userId));</span>
<span class="nc" id="L1469">			pstmt.setString(6, userIdMappingBean.getAdvGenerationDateTime());</span>
<span class="nc" id="L1470">			pstmt.setString(7, userIdMappingBean.getAdvCodeExpiryDateTime());</span>
<span class="nc" id="L1471">			logger.info(&quot;pstmt &quot;+pstmt);</span>
<span class="nc" id="L1472">			pstmt.addBatch();</span>
<span class="nc" id="L1473">			pstmt.clearParameters();</span>
<span class="nc bnc" id="L1474" title="All 4 branches missed.">			if (count != 0 &amp;&amp; count % 100 == 0) {</span>
<span class="nc" id="L1475">				check += pstmt.executeBatch().length;</span>
<span class="nc" id="L1476">				batchExecuted = true;</span>
					}
<span class="nc" id="L1478">				}</span>
			}
<span class="nc bnc" id="L1480" title="All 2 branches missed.">		if (check &lt;= size - 1) {</span>
<span class="nc" id="L1481">			pstmt.executeBatch();</span>
		}
<span class="nc" id="L1483">			pstmt.clearParameters();</span>
<span class="nc" id="L1484">			pstmt = con.prepareStatement(&quot;insert into st_lms_user_random_id_mapping_history select user_id ,user_mapping_id ,mapping_id_gen_date, code_expiry , ? , ? from st_lms_user_random_id_mapping &quot;);</span>
<span class="nc" id="L1485">			pstmt.setString(1, userIdMappingBean.getActivity());</span>
<span class="nc" id="L1486">			pstmt.setInt(2, userIdMappingBean.getDoneByUserId());</span>
<span class="nc" id="L1487">			int result = pstmt.executeUpdate();</span>
<span class="nc" id="L1488">			logger.info(result +&quot; HISTORY UPDATED&quot;);</span>
			
<span class="nc" id="L1490">			pstmt = con.prepareStatement(&quot;insert into st_lms_user_random_id_generation_status (gen_date , code_expiry_days , last_exp_date, status , start_range , end_range)  values (?,?,?,?,?,?)&quot;);</span>
<span class="nc" id="L1491">			pstmt.setString(1, userIdMappingBean.getRequesInitiateTime());</span>
<span class="nc" id="L1492">			pstmt.setInt(2, userIdMappingBean.getExpiryDays());</span>
<span class="nc" id="L1493">			pstmt.setString(3, userIdMappingBean.getAdvCodeExpiryDateTime());</span>
<span class="nc" id="L1494">			pstmt.setString(4, &quot;SUCCESS&quot;);</span>
<span class="nc bnc" id="L1495" title="All 2 branches missed.">			pstmt.setInt(5, (userIdMappingBean.isNewRangeReq())?Integer.parseInt(Utility.getPropertyValue(&quot;RANDOM_RET_ID_START_RANGE&quot;)):userIdMappingBean.getCurStrtRange());</span>
<span class="nc bnc" id="L1496" title="All 2 branches missed.">			pstmt.setInt(6, (userIdMappingBean.isNewRangeReq())?Integer.parseInt(Utility.getPropertyValue(&quot;RANDOM_RET_ID_END_RANGE&quot;)):userIdMappingBean.getCurEndRange());</span>
<span class="nc" id="L1497">			result = pstmt.executeUpdate();</span>
<span class="nc" id="L1498">			logger.info(result +&quot; STATUS UPDATED&quot;);</span>
<span class="nc" id="L1499">			checkUserTransaction(userIdMappingBean.isAll() ,userIdMappingBean.getUserId() ,userIdMappingBean.getRequesInitiateTime(), con);</span>
<span class="nc" id="L1500">		}else{</span>
<span class="nc" id="L1501">			throw new LMSException(LMSErrors.SECURITY_BREACH_ERROR_CODE , LMSErrors.SECURITY_BREACH_ERROR_MESSAGE);</span>
		}
		
		// DOUBLE VERIFY 
<span class="nc" id="L1505">		checkMappingIdDup(con);</span>
<span class="nc" id="L1506">		con.commit();</span>

<span class="nc" id="L1508">	}catch (LMSException e) {</span>
<span class="nc" id="L1509">		e.printStackTrace();</span>
<span class="nc" id="L1510">		throw e;</span>
<span class="nc" id="L1511">	} catch (SQLException e) {</span>
<span class="nc bnc" id="L1512" title="All 2 branches missed.">		if(e.getMessage().contains(&quot;Duplicate entry&quot;)){</span>
<span class="nc" id="L1513">			throw new LMSException(LMSErrors.RAMDOM_ID_GENERATION_ERROR_CODE , LMSErrors.RAMDOM_ID_GENERATION_ERROR_MESSAGE);</span>
		}else{
<span class="nc" id="L1515">			e.printStackTrace();</span>
<span class="nc" id="L1516">			logger.error(&quot;SQLException : - &quot;, e);</span>
<span class="nc" id="L1517">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE , LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
		}
<span class="nc" id="L1519">	} catch (Exception e) {</span>
<span class="nc" id="L1520">		e.printStackTrace();</span>
<span class="nc" id="L1521">		logger.error(&quot;Exception : - &quot;, e);</span>
<span class="nc" id="L1522">		throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE , LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
	}finally{
<span class="nc" id="L1524">		DBConnect.closePstmt(pstmt);</span>
<span class="nc" id="L1525">		}</span>
<span class="nc" id="L1526">	}</span>
	
	
	private static String getCodeGenAndExpDates(int noOfDays , long currentTimeInMilis , boolean isFirstDate) throws LMSException{
<span class="nc" id="L1530">		Calendar cal = null;</span>
<span class="nc" id="L1531">		SimpleDateFormat sdf = null;</span>
<span class="nc" id="L1532">		String newGenExpDateTime = null;</span>
		try{
<span class="nc" id="L1534">			cal = Calendar.getInstance();</span>
<span class="nc" id="L1535">			sdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span>
<span class="nc" id="L1536">			cal.setTimeInMillis(currentTimeInMilis);</span>
<span class="nc bnc" id="L1537" title="All 2 branches missed.">			if(isFirstDate){</span>
<span class="nc" id="L1538">				cal.set(Calendar.HOUR_OF_DAY, 00);</span>
<span class="nc" id="L1539">				cal.set(Calendar.MINUTE, 00);</span>
<span class="nc" id="L1540">				cal.set(Calendar.SECOND, 00);</span>
			}else{
<span class="nc" id="L1542">				cal.set(Calendar.HOUR_OF_DAY, 23);</span>
<span class="nc" id="L1543">				cal.set(Calendar.MINUTE, 59);</span>
<span class="nc" id="L1544">				cal.set(Calendar.SECOND, 59);</span>
			}
<span class="nc" id="L1546">			cal.add(Calendar.DATE,noOfDays);</span>
<span class="nc" id="L1547">			newGenExpDateTime = sdf.format(new Timestamp(cal.getTime().getTime()));</span>
<span class="nc" id="L1548">		}catch (Exception e) {</span>
<span class="nc" id="L1549">			e.printStackTrace();</span>
<span class="nc" id="L1550">			logger.error(&quot;Exception&quot; , e);</span>
<span class="nc" id="L1551">			throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE, LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1552">		}</span>
<span class="nc" id="L1553">		return newGenExpDateTime;</span>
	}
	
	private static String getCodeGenAndExpDatesForAll(String reqInitTime , String startDate , int days , boolean isFirstDate , boolean codeExpiry) throws LMSException {
<span class="nc" id="L1557">		Calendar cal = null;</span>
<span class="nc" id="L1558">		SimpleDateFormat sdf = null;</span>
<span class="nc" id="L1559">		Timestamp startDateTime = null;</span>
<span class="nc" id="L1560">		Timestamp decidedTime = null;</span>
<span class="nc" id="L1561">		Timestamp initiatedTime = null;</span>
<span class="nc" id="L1562">		Timestamp generatedTimestamp = null;</span>
		try {
<span class="nc" id="L1564">			sdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span>
<span class="nc" id="L1565">			cal = Calendar.getInstance();</span>
<span class="nc" id="L1566">			startDateTime = new Timestamp(sdf.parse(startDate).getTime());</span>
<span class="nc bnc" id="L1567" title="All 2 branches missed.">			if (!codeExpiry) {</span>
<span class="nc" id="L1568">				initiatedTime = new Timestamp(sdf.parse(reqInitTime).getTime());</span>
<span class="nc" id="L1569">				generatedTimestamp = new Timestamp(startDateTime.getTime());</span>
<span class="nc" id="L1570">				cal.setTimeInMillis(generatedTimestamp.getTime());</span>
<span class="nc" id="L1571">				cal.add(Calendar.DATE, days + 1);</span>
<span class="nc" id="L1572">				cal.setTimeInMillis(initiatedTime.getTime());</span>
				/*if (initiatedTime.after(new Timestamp(cal.getTimeInMillis()))) {
					// does nothing
				} else {
					cal.setTimeInMillis(initiatedTime.getTime());
				}*/
			}else{
<span class="nc" id="L1579">				generatedTimestamp = new Timestamp(startDateTime.getTime());</span>
<span class="nc" id="L1580">				cal.setTimeInMillis(generatedTimestamp.getTime());</span>
<span class="nc" id="L1581">				cal.add(Calendar.DATE, days);</span>
			}
<span class="nc bnc" id="L1583" title="All 2 branches missed.">			if(isFirstDate){</span>
<span class="nc" id="L1584">				cal.set(Calendar.HOUR_OF_DAY, 00);</span>
<span class="nc" id="L1585">				cal.set(Calendar.MINUTE, 00);</span>
<span class="nc" id="L1586">				cal.set(Calendar.SECOND, 00);</span>
			}else{
<span class="nc" id="L1588">				cal.set(Calendar.HOUR_OF_DAY, 23);</span>
<span class="nc" id="L1589">				cal.set(Calendar.MINUTE, 59);</span>
<span class="nc" id="L1590">				cal.set(Calendar.SECOND, 59);</span>
			}
<span class="nc" id="L1592">			decidedTime = new Timestamp(cal.getTimeInMillis());</span>
<span class="nc" id="L1593">		} catch (Exception e) {</span>
<span class="nc" id="L1594">			logger.error(&quot;Exception&quot;, e);</span>
<span class="nc" id="L1595">			throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE,LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1596">		}</span>
<span class="nc" id="L1597">		return decidedTime.toString();</span>
	}
	
	private static void generateRandomIds(int userId , int genWeight , Set&lt;Integer&gt; checkSet , LinkedHashMap&lt;Integer, Integer&gt; newGenUserMappingIdMap ,boolean isAll , boolean isNewGenReq , int stRng , int endRng) throws LMSException{
		
<span class="nc" id="L1602">		int count =0;</span>
<span class="nc" id="L1603">		int randEndRange = 0;</span>
<span class="nc" id="L1604">		int randStartRange = 0;</span>
<span class="nc" id="L1605">		List&lt;Integer&gt; userIdList =  null;</span>
<span class="nc" id="L1606">		HashSet&lt;Integer&gt; newMappingSet = null;</span>
		try {
<span class="nc" id="L1608">			newMappingSet = new HashSet&lt;Integer&gt;();</span>
			//randStartRange = ConfigurationVariables.RANDOM_RET_ID_B_START_RANGE;
			//randEndRange = ConfigurationVariables.RANDOM_RET_ID_B_END_RANGE;
<span class="nc bnc" id="L1611" title="All 2 branches missed.">			if(!isNewGenReq){</span>
<span class="nc" id="L1612">				randStartRange = stRng;</span>
<span class="nc" id="L1613">				randEndRange = endRng;</span>
			}else{
<span class="nc" id="L1615">				randStartRange = Integer.parseInt(Utility.getPropertyValue(&quot;RANDOM_RET_ID_START_RANGE&quot;));</span>
<span class="nc" id="L1616">				randEndRange = Integer.parseInt(Utility.getPropertyValue(&quot;RANDOM_RET_ID_END_RANGE&quot;));	</span>
			}
<span class="nc bnc" id="L1618" title="All 2 branches missed.">			if(!isAll){</span>
<span class="nc" id="L1619">				userIdList = new ArrayList&lt;Integer&gt;();</span>
<span class="nc" id="L1620">				userIdList.add(userId);</span>
<span class="nc" id="L1621">				newGenUserMappingIdMap.clear();</span>
			}else{
<span class="nc" id="L1623">				userIdList = new ArrayList&lt;Integer&gt;(newGenUserMappingIdMap.keySet());</span>
			}
<span class="nc bnc" id="L1625" title="All 2 branches missed.">			while (newMappingSet.size() != genWeight) {</span>
<span class="nc" id="L1626">				int randStr = RNGUtilities.generateRandomNumber(randStartRange, randEndRange);</span>
				// CHECK DUP ONLY IN CASE OF NEW REG/UPDATION 
<span class="nc bnc" id="L1628" title="All 2 branches missed.">				if(checkSet.add(randStr)){</span>
<span class="nc" id="L1629">					newMappingSet.add(randStr);</span>
<span class="nc" id="L1630">					newGenUserMappingIdMap.put(userIdList.get(count), randStr);</span>
<span class="nc" id="L1631">					count++;</span>
				}
<span class="nc" id="L1633">			}</span>
<span class="nc" id="L1634">		} catch (Exception e) {</span>
<span class="nc" id="L1635">			e.printStackTrace();</span>
<span class="nc" id="L1636">			logger.error(&quot;Exception&quot; , e);</span>
<span class="nc" id="L1637">			throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE, LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1638">		}</span>
<span class="nc" id="L1639">	}</span>
	
	private static void checkMappingIdDup(Connection con) throws LMSException{
		
<span class="nc" id="L1643">		ResultSet rs=null;</span>
<span class="nc" id="L1644">		Statement stmt = null;</span>
		try{
<span class="nc" id="L1646">				stmt =  con.createStatement();</span>
<span class="nc" id="L1647">				rs = stmt.executeQuery(&quot;select user_mapping_id from st_lms_user_random_id_mapping group by user_mapping_id having count(user_mapping_id) &gt;1 union all select adv_user_mapping_id  from st_lms_user_random_id_mapping group by  adv_user_mapping_id having count(adv_user_mapping_id) &gt;1&quot;);</span>
<span class="nc bnc" id="L1648" title="All 2 branches missed.">				if(rs.next()){</span>
<span class="nc" id="L1649">					throw new LMSException(LMSErrors.SECURITY_BREACH_ERROR_CODE , LMSErrors.SECURITY_BREACH_ERROR_MESSAGE);</span>
				}
<span class="nc" id="L1651">		}catch (LMSException e) {</span>
<span class="nc" id="L1652">			logger.error(&quot;Exception&quot; , e);</span>
<span class="nc" id="L1653">			throw e;</span>
<span class="nc" id="L1654">		} catch (SQLException e) {</span>
<span class="nc" id="L1655">			e.printStackTrace();</span>
<span class="nc" id="L1656">			logger.error(&quot;SQLException : - &quot;, e);</span>
<span class="nc" id="L1657">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE , LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1658">		} catch (Exception e) {</span>
<span class="nc" id="L1659">			e.printStackTrace();</span>
<span class="nc" id="L1660">			logger.error(&quot;Exception : - &quot;, e);</span>
<span class="nc" id="L1661">			throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE , LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
		}finally{
<span class="nc" id="L1663">			DBConnect.closeRs(rs);</span>
<span class="nc" id="L1664">			DBConnect.closeStmt(stmt);</span>
			
<span class="nc" id="L1666">		}</span>
<span class="nc" id="L1667">	}</span>
	
	public static void checkUserTransaction(boolean isAll ,int userId ,String transactionDateTime ,Connection con) throws LMSException{
		
<span class="nc" id="L1671">		ResultSet rs=null;</span>
<span class="nc" id="L1672">		PreparedStatement pstmt = null;</span>
		try{
<span class="nc bnc" id="L1674" title="All 2 branches missed.">				if(isAll){</span>
<span class="nc" id="L1675">					pstmt =  con.prepareStatement(&quot;select transaction_id from st_lms_retailer_transaction_master where date(transaction_date)  = date(?) and transaction_type in ('DG_SALE','DG_REFUND_CANCEL','DG_REFUND_FAILED','SALE','SALE_RET','DG_SALE_OFFLINE','CS_SALE','CS_CANCEL_SERVER')&quot;);</span>
				}else{
<span class="nc" id="L1677">					pstmt =  con.prepareStatement(&quot;select * from st_lms_retailer_transaction_master where date(transaction_date) = date(?) and retailer_user_id  = ? and transaction_type in ('DG_SALE','DG_REFUND_CANCEL','DG_REFUND_FAILED','SALE','SALE_RET','DG_SALE_OFFLINE','CS_SALE','CS_CANCEL_SERVER')&quot;);</span>
<span class="nc" id="L1678">					pstmt.setInt(2, userId);</span>
				}
<span class="nc" id="L1680">				pstmt.setString(1, transactionDateTime);</span>
<span class="nc" id="L1681">				rs = pstmt.executeQuery();</span>
<span class="nc bnc" id="L1682" title="All 2 branches missed.">				if(rs.next()){</span>
<span class="nc" id="L1683">					throw new LMSException(LMSErrors.RAMDOM_ID_GENERATION_ERROR_CODE , LMSErrors.RAMDOM_ID_GENERATION_ERROR_MESSAGE);</span>
				}
<span class="nc" id="L1685">		}catch (LMSException e) {</span>
<span class="nc" id="L1686">			e.printStackTrace();</span>
<span class="nc" id="L1687">			throw e;</span>
<span class="nc" id="L1688">		} catch (SQLException e) {</span>
<span class="nc" id="L1689">			e.printStackTrace();</span>
<span class="nc" id="L1690">			logger.error(&quot;SQLException : - &quot;, e);</span>
<span class="nc" id="L1691">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE , LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1692">		} catch (Exception e) {</span>
<span class="nc" id="L1693">			e.printStackTrace();</span>
<span class="nc" id="L1694">			logger.error(&quot;Exception : - &quot;, e);</span>
<span class="nc" id="L1695">			throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE , LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
		}finally{
<span class="nc" id="L1697">			DBConnect.closeRs(rs);</span>
<span class="nc" id="L1698">			DBConnect.closeStmt(pstmt);</span>
<span class="nc" id="L1699">		}</span>
<span class="nc" id="L1700">	}</span>
	
	public static void insertUpdateOrganizationHistory(HistoryBean historyBean, Connection connection) throws LMSException {
<span class="nc" id="L1703">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1704">		String fieldName = null;</span>
		try {
<span class="nc" id="L1706">			pstmt = connection.prepareStatement(&quot;INSERT INTO st_lms_organization_master_history (organization_id, change_type, change_value, change_time, done_by_user_id, comments, request_ip) VALUES (?,?,?,?,?,?,?);&quot;);</span>
<span class="nc" id="L1707">			pstmt.setInt(1, historyBean.getOrganizationId());</span>
<span class="nc" id="L1708">			pstmt.setString(2, historyBean.getChangeType());</span>
<span class="nc" id="L1709">			pstmt.setString(3, historyBean.getChangeValue());</span>
<span class="nc" id="L1710">			pstmt.setTimestamp(4, Util.getCurrentTimeStamp());</span>
<span class="nc" id="L1711">			pstmt.setInt(5, historyBean.getDoneByUserId());</span>
<span class="nc" id="L1712">			pstmt.setString(6, historyBean.getComments());</span>
<span class="nc" id="L1713">			pstmt.setString(7, historyBean.getRequestIp());</span>
<span class="nc" id="L1714">			logger.info(&quot;Insert st_lms_organization_master_history History : &quot;+pstmt);</span>
<span class="nc" id="L1715">			pstmt.executeUpdate();</span>

<span class="nc bnc" id="L1717" title="All 2 branches missed.">			if(&quot;ADDRESS_1&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1718">				fieldName = &quot;addr_line1&quot;;</span>
<span class="nc bnc" id="L1719" title="All 2 branches missed.">			} else if(&quot;ADDRESS_2&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1720">				fieldName = &quot;addr_line2&quot;;</span>
<span class="nc bnc" id="L1721" title="All 2 branches missed.">			} else if(&quot;CITY&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1722">				fieldName = &quot;city&quot;;</span>
<span class="nc bnc" id="L1723" title="All 2 branches missed.">			} else if(&quot;ORGANIZATION_STATUS&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1724">				fieldName = &quot;organization_status&quot;;</span>
<span class="nc bnc" id="L1725" title="All 2 branches missed.">			} else if(&quot;DIVISION_CODE&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1726">				fieldName = &quot;division_code&quot;;</span>
<span class="nc bnc" id="L1727" title="All 2 branches missed.">			} else if(&quot;AREA_CODE&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1728">				fieldName = &quot;area_code&quot;;</span>
<span class="nc bnc" id="L1729" title="All 2 branches missed.">			} else if(&quot;PIN_CODE&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1730">				fieldName = &quot;pin_code&quot;;</span>
<span class="nc bnc" id="L1731" title="All 2 branches missed.">			} else if(&quot;PWT_SCRAP&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1732">				fieldName = &quot;pwt_scrap&quot;;</span>
<span class="nc bnc" id="L1733" title="All 2 branches missed.">			} else if(&quot;SECURITY_DEPOSIT&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1734">				fieldName = &quot;security_deposit&quot;;</span>
			}

			// CHANGE ORG CODE , ORG NAME 
<span class="nc" id="L1738">			pstmt = connection.prepareStatement(&quot;UPDATE st_lms_organization_master SET &quot;+fieldName+&quot;=? WHERE organization_id=?;&quot;);</span>
<span class="nc" id="L1739">			pstmt.setString(1, historyBean.getUpdatedValue());</span>
<span class="nc" id="L1740">			pstmt.setInt(2, historyBean.getOrganizationId());</span>
<span class="nc" id="L1741">			logger.info(&quot;Update Organization Information : &quot;+pstmt);</span>
<span class="nc" id="L1742">			pstmt.executeUpdate();</span>
<span class="nc" id="L1743">		} catch (SQLException se) {</span>
<span class="nc" id="L1744">			se.printStackTrace();</span>
<span class="nc" id="L1745">			throw new LMSException(&quot;SQL Exception&quot;, se);</span>
<span class="nc" id="L1746">		} catch (Exception e) {</span>
<span class="nc" id="L1747">			e.printStackTrace();</span>
<span class="nc" id="L1748">			throw new LMSException(&quot;Exception&quot;, e);</span>
<span class="nc" id="L1749">		}</span>
<span class="nc" id="L1750">	}</span>

	public static void insertUpdateOrganizationHistoryForAGTShift(HistoryBean historyBean, Connection connection) throws LMSException {
<span class="nc" id="L1753">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1754">		String fieldName = null;</span>
		try {
<span class="nc" id="L1756">			pstmt = connection.prepareStatement(&quot;INSERT INTO st_lms_organization_master_history (organization_id, change_type, change_value, change_time, done_by_user_id, comments, request_ip) VALUES (?,?,?,?,?,?,?);&quot;);</span>
<span class="nc" id="L1757">			pstmt.setInt(1, historyBean.getOrganizationId());</span>
<span class="nc" id="L1758">			pstmt.setString(2, historyBean.getChangeType());</span>
<span class="nc" id="L1759">			pstmt.setString(3, historyBean.getChangeValue());</span>
<span class="nc" id="L1760">			pstmt.setTimestamp(4, Util.getCurrentTimeStamp());</span>
<span class="nc" id="L1761">			pstmt.setInt(5, historyBean.getDoneByUserId());</span>
<span class="nc" id="L1762">			pstmt.setString(6, historyBean.getComments());</span>
<span class="nc" id="L1763">			pstmt.setString(7, historyBean.getRequestIp());</span>
<span class="nc" id="L1764">			logger.info(&quot;Insert st_lms_organization_master_history History : &quot;+pstmt);</span>
<span class="nc" id="L1765">			pstmt.executeUpdate();</span>

<span class="nc bnc" id="L1767" title="All 2 branches missed.">			if(&quot;ADDRESS_1&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1768">				fieldName = &quot;addr_line1&quot;;</span>
<span class="nc bnc" id="L1769" title="All 2 branches missed.">			} else if(&quot;ADDRESS_2&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1770">				fieldName = &quot;addr_line2&quot;;</span>
<span class="nc bnc" id="L1771" title="All 2 branches missed.">			} else if(&quot;CITY&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1772">				fieldName = &quot;city&quot;;</span>
<span class="nc bnc" id="L1773" title="All 2 branches missed.">			} else if(&quot;ORGANIZATION_STATUS&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1774">				fieldName = &quot;organization_status&quot;;</span>
<span class="nc bnc" id="L1775" title="All 2 branches missed.">			} else if(&quot;DIVISION_CODE&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1776">				fieldName = &quot;division_code&quot;;</span>
<span class="nc bnc" id="L1777" title="All 2 branches missed.">			} else if(&quot;AREA_CODE&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1778">				fieldName = &quot;area_code&quot;;</span>
<span class="nc bnc" id="L1779" title="All 2 branches missed.">			} else if(&quot;PIN_CODE&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1780">				fieldName = &quot;pin_code&quot;;</span>
<span class="nc bnc" id="L1781" title="All 2 branches missed.">			} else if(&quot;PWT_SCRAP&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1782">				fieldName = &quot;pwt_scrap&quot;;</span>
<span class="nc bnc" id="L1783" title="All 2 branches missed.">			} else if(&quot;SECURITY_DEPOSIT&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1784">				fieldName = &quot;security_deposit&quot;;</span>
			}

			// CHANGED ORG CODE , ORG NAME 
<span class="nc" id="L1788">			pstmt = connection.prepareStatement(&quot;UPDATE st_lms_organization_master SET &quot;</span>
							+ fieldName + &quot;=? , name = concat(name,'&quot;
							+ historyBean.getDateAppender()
							+ &quot;') , org_code = concat(org_code,'&quot;
							+ historyBean.getDateAppender()
							+ &quot;') WHERE organization_id=?;&quot;);
			
<span class="nc" id="L1795">			pstmt.setString(1, historyBean.getUpdatedValue());</span>
<span class="nc" id="L1796">			pstmt.setInt(2, historyBean.getOrganizationId());</span>
<span class="nc" id="L1797">			logger.info(&quot;Update Organization Information : &quot;+pstmt);</span>
<span class="nc" id="L1798">			pstmt.executeUpdate();</span>
<span class="nc" id="L1799">		} catch (SQLException se) {</span>
<span class="nc" id="L1800">			se.printStackTrace();</span>
<span class="nc" id="L1801">			throw new LMSException(&quot;SQL Exception&quot;, se);</span>
<span class="nc" id="L1802">		} catch (Exception e) {</span>
<span class="nc" id="L1803">			e.printStackTrace();</span>
<span class="nc" id="L1804">			throw new LMSException(&quot;Exception&quot;, e);</span>
<span class="nc" id="L1805">		}</span>
<span class="nc" id="L1806">	}</span>
	
	public static void insertUpdateUserHistory(HistoryBean historyBean, Connection connection) throws LMSException {
<span class="nc" id="L1809">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1810">		String tableName = null;</span>
<span class="nc" id="L1811">		String fieldName = null;</span>
<span class="nc" id="L1812">		boolean isStatusUpdate = false;</span>
		try {
<span class="nc" id="L1814">			pstmt = connection.prepareStatement(&quot;INSERT INTO st_lms_user_master_history (user_id, change_type, change_value, change_time, done_by_user_id, comments, request_ip) VALUES (?,?,?,?,?,?,?);&quot;);</span>
<span class="nc" id="L1815">			pstmt.setInt(1, historyBean.getOrganizationId());</span>
<span class="nc" id="L1816">			pstmt.setString(2, historyBean.getChangeType());</span>
<span class="nc" id="L1817">			pstmt.setString(3, historyBean.getChangeValue());</span>
<span class="nc" id="L1818">			pstmt.setTimestamp(4, Util.getCurrentTimeStamp());</span>
<span class="nc" id="L1819">			pstmt.setInt(5, historyBean.getDoneByUserId());</span>
<span class="nc" id="L1820">			pstmt.setString(6, historyBean.getComments());</span>
<span class="nc" id="L1821">			pstmt.setString(7, historyBean.getRequestIp());</span>
<span class="nc" id="L1822">			logger.info(&quot;Insert st_lms_user_master_history History : &quot;+pstmt);</span>
<span class="nc" id="L1823">			pstmt.executeUpdate();</span>

<span class="nc bnc" id="L1825" title="All 2 branches missed.">			if(&quot;EMAIL_ID&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1826">				tableName = &quot;st_lms_user_contact_details&quot;;</span>
<span class="nc" id="L1827">				fieldName = &quot;email_id&quot;;</span>
<span class="nc bnc" id="L1828" title="All 2 branches missed.">			} else if(&quot;PHONE_NUMBER&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1829">				tableName = &quot;st_lms_user_contact_details&quot;;</span>
<span class="nc" id="L1830">				fieldName = &quot;phone_nbr&quot;;</span>
<span class="nc bnc" id="L1831" title="All 2 branches missed.">			} else if(&quot;MOBILE_NUMBER&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1832">				tableName = &quot;st_lms_user_contact_details&quot;;</span>
<span class="nc" id="L1833">				fieldName = &quot;mobile_nbr&quot;;</span>
<span class="nc bnc" id="L1834" title="All 2 branches missed.">			} else if(&quot;PASSWORD&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1835">				tableName = &quot;st_lms_user_master&quot;;</span>
<span class="nc" id="L1836">				fieldName = &quot;password&quot;;</span>
<span class="nc bnc" id="L1837" title="All 2 branches missed.">			} else if(&quot;USER_STATUS&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1838">				tableName = &quot;st_lms_user_master&quot;;</span>
<span class="nc" id="L1839">				fieldName = &quot;status&quot;;</span>
<span class="nc bnc" id="L1840" title="All 2 branches missed.">				if(&quot;TERMINATE&quot;.equals(historyBean.getUpdatedValue())) {</span>
<span class="nc" id="L1841">					isStatusUpdate = true;</span>
				}
			}

<span class="nc" id="L1845">			pstmt = connection.prepareStatement(&quot;UPDATE &quot;+tableName+&quot; SET &quot;+fieldName+&quot;=? WHERE user_id=?;&quot;);</span>
<span class="nc" id="L1846">			pstmt.setString(1, historyBean.getUpdatedValue());</span>
<span class="nc" id="L1847">			pstmt.setInt(2, historyBean.getOrganizationId());</span>
<span class="nc" id="L1848">			logger.info(&quot;Update User Information : &quot;+pstmt);</span>
<span class="nc" id="L1849">			pstmt.executeUpdate();</span>

<span class="nc bnc" id="L1851" title="All 2 branches missed.">			if(isStatusUpdate) {</span>
<span class="nc" id="L1852">				pstmt = connection.prepareStatement(&quot;UPDATE st_lms_user_master SET termination_date=? WHERE user_id=?;&quot;);</span>
<span class="nc" id="L1853">				pstmt.setString(1, Util.getCurrentTimeString());</span>
<span class="nc" id="L1854">				pstmt.setInt(2, historyBean.getOrganizationId());</span>
<span class="nc" id="L1855">				logger.info(&quot;Update User Termination Date : &quot;+pstmt);</span>
<span class="nc" id="L1856">				pstmt.executeUpdate();</span>
			}
<span class="nc" id="L1858">		} catch (SQLException se) {</span>
<span class="nc" id="L1859">			se.printStackTrace();</span>
<span class="nc" id="L1860">			throw new LMSException(&quot;SQL Exception&quot;, se);</span>
<span class="nc" id="L1861">		} catch (Exception e) {</span>
<span class="nc" id="L1862">			e.printStackTrace();</span>
<span class="nc" id="L1863">			throw new LMSException(&quot;Exception&quot;, e);</span>
<span class="nc" id="L1864">		}</span>
<span class="nc" id="L1865">	}</span>

	public static void insertUpdateUserHistoryForAGTShift(HistoryBean historyBean, Connection connection) throws LMSException {
<span class="nc" id="L1868">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1869">		String tableName = null;</span>
<span class="nc" id="L1870">		String fieldName = null;</span>
<span class="nc" id="L1871">		boolean isStatusUpdate = false;</span>
		try {
<span class="nc" id="L1873">			pstmt = connection.prepareStatement(&quot;INSERT INTO st_lms_user_master_history (user_id, change_type, change_value, change_time, done_by_user_id, comments, request_ip) VALUES (?,?,?,?,?,?,?);&quot;);</span>
<span class="nc" id="L1874">			pstmt.setInt(1, historyBean.getOrganizationId());</span>
<span class="nc" id="L1875">			pstmt.setString(2, historyBean.getChangeType());</span>
<span class="nc" id="L1876">			pstmt.setString(3, historyBean.getChangeValue());</span>
<span class="nc" id="L1877">			pstmt.setTimestamp(4, Util.getCurrentTimeStamp());</span>
<span class="nc" id="L1878">			pstmt.setInt(5, historyBean.getDoneByUserId());</span>
<span class="nc" id="L1879">			pstmt.setString(6, historyBean.getComments());</span>
<span class="nc" id="L1880">			pstmt.setString(7, historyBean.getRequestIp());</span>
<span class="nc" id="L1881">			logger.info(&quot;Insert st_lms_user_master_history History : &quot;+pstmt);</span>
<span class="nc" id="L1882">			pstmt.executeUpdate();</span>

<span class="nc bnc" id="L1884" title="All 2 branches missed.">			if(&quot;EMAIL_ID&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1885">				tableName = &quot;st_lms_user_contact_details&quot;;</span>
<span class="nc" id="L1886">				fieldName = &quot;email_id&quot;;</span>
<span class="nc bnc" id="L1887" title="All 2 branches missed.">			} else if(&quot;PHONE_NUMBER&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1888">				tableName = &quot;st_lms_user_contact_details&quot;;</span>
<span class="nc" id="L1889">				fieldName = &quot;phone_nbr&quot;;</span>
<span class="nc bnc" id="L1890" title="All 2 branches missed.">			} else if(&quot;MOBILE_NUMBER&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1891">				tableName = &quot;st_lms_user_contact_details&quot;;</span>
<span class="nc" id="L1892">				fieldName = &quot;mobile_nbr&quot;;</span>
<span class="nc bnc" id="L1893" title="All 2 branches missed.">			} else if(&quot;PASSWORD&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1894">				tableName = &quot;st_lms_user_master&quot;;</span>
<span class="nc" id="L1895">				fieldName = &quot;password&quot;;</span>
<span class="nc bnc" id="L1896" title="All 2 branches missed.">			} else if(&quot;USER_STATUS&quot;.equals(historyBean.getChangeType())) {</span>
<span class="nc" id="L1897">				tableName = &quot;st_lms_user_master&quot;;</span>
<span class="nc" id="L1898">				fieldName = &quot;status&quot;;</span>
<span class="nc bnc" id="L1899" title="All 2 branches missed.">				if(&quot;TERMINATE&quot;.equals(historyBean.getUpdatedValue())) {</span>
<span class="nc" id="L1900">					isStatusUpdate = true;</span>
				}
			}

			// Changed user name
<span class="nc" id="L1905">			pstmt = connection.prepareStatement(&quot;UPDATE &quot;+tableName+&quot; SET &quot;+fieldName+&quot;=? , user_name = concat(user_name,'&quot;+historyBean.getDateAppender()+&quot;') WHERE user_id=?;&quot;);</span>
<span class="nc" id="L1906">			pstmt.setString(1, historyBean.getUpdatedValue());</span>
<span class="nc" id="L1907">			pstmt.setInt(2, historyBean.getOrganizationId());</span>
<span class="nc" id="L1908">			logger.info(&quot;Update User Information : &quot;+pstmt);</span>
<span class="nc" id="L1909">			pstmt.executeUpdate();</span>

<span class="nc bnc" id="L1911" title="All 2 branches missed.">			if(isStatusUpdate) {</span>
<span class="nc" id="L1912">				pstmt = connection.prepareStatement(&quot;UPDATE st_lms_user_master SET termination_date=? WHERE user_id=?;&quot;);</span>
<span class="nc" id="L1913">				pstmt.setString(1, Util.getCurrentTimeString());</span>
<span class="nc" id="L1914">				pstmt.setInt(2, historyBean.getOrganizationId());</span>
<span class="nc" id="L1915">				logger.info(&quot;Update User Termination Date : &quot;+pstmt);</span>
<span class="nc" id="L1916">				pstmt.executeUpdate();</span>
			}
<span class="nc" id="L1918">		} catch (SQLException se) {</span>
<span class="nc" id="L1919">			se.printStackTrace();</span>
<span class="nc" id="L1920">			throw new LMSException(&quot;SQL Exception&quot;, se);</span>
<span class="nc" id="L1921">		} catch (Exception e) {</span>
<span class="nc" id="L1922">			e.printStackTrace();</span>
<span class="nc" id="L1923">			throw new LMSException(&quot;Exception&quot;, e);</span>
<span class="nc" id="L1924">		}</span>
<span class="nc" id="L1925">	}</span>
	
	public static LinkedHashMap&lt;Integer, Integer&gt; prepareHashMapFromAnyTypeMap(AnyType2AnyTypeMap anyMap ){
<span class="nc" id="L1928">		LinkedHashMap&lt;Integer, Integer&gt; hashMap = new LinkedHashMap&lt;Integer, Integer&gt;();</span>
<span class="nc bnc" id="L1929" title="All 2 branches missed.">		for(AnyType2AnyTypeMap.Entry entry : anyMap.getEntries()){</span>
<span class="nc" id="L1930">			hashMap.put((Integer)entry.getKey(), (Integer)entry.getValue());</span>
<span class="nc" id="L1931">		}</span>
<span class="nc" id="L1932">		return hashMap;</span>
	}
	
	public static UserInfoBean fetchUserData(int orgId)
			throws LMSException {
<span class="nc" id="L1937">		Connection connection = null;</span>
<span class="nc" id="L1938">		PreparedStatement pstmt = null;</span>
<span class="nc" id="L1939">		ResultSet rs = null;</span>
<span class="nc" id="L1940">		UserInfoBean userBean = null;</span>
		try {
<span class="nc" id="L1942">			connection = DBConnect.getConnection();</span>
<span class="nc" id="L1943">			userBean = new UserInfoBean();</span>
<span class="nc" id="L1944">			pstmt = connection</span>
					.prepareStatement(&quot;select um.user_id, om.name from st_lms_user_master um inner join st_lms_organization_master om on um.organization_id = om.organization_id where om.organization_id = &quot;
							+ orgId);
<span class="nc" id="L1947">			rs = pstmt.executeQuery();</span>

<span class="nc bnc" id="L1949" title="All 2 branches missed.">			if (rs.next()) {</span>
<span class="nc" id="L1950">				userBean.setOrgName(rs.getString(&quot;name&quot;));</span>
<span class="nc" id="L1951">				userBean.setUserId(rs.getInt(&quot;user_id&quot;));</span>
			}
<span class="nc" id="L1953">		} catch (SQLException se) {</span>
<span class="nc" id="L1954">			se.printStackTrace();</span>
<span class="nc" id="L1955">			throw new LMSException(LMSErrors.SQL_EXCEPTION_ERROR_CODE, LMSErrors.SQL_EXCEPTION_ERROR_MESSAGE);</span>
<span class="nc" id="L1956">		} catch (Exception e) {</span>
<span class="nc" id="L1957">			e.printStackTrace();</span>
<span class="nc" id="L1958">			throw new LMSException(LMSErrors.GENERAL_EXCEPTION_ERROR_CODE, LMSErrors.GENERAL_EXCEPTION_ERROR_MESSAGE);</span>
		}
		finally	{
<span class="nc" id="L1961">			DBConnect.closeCon(connection);</span>
<span class="nc" id="L1962">		}</span>
<span class="nc" id="L1963">		return userBean;</span>
	}
	
	public static Map&lt;String, String&gt; fetchStateList() {
<span class="nc" id="L1967">		Connection con = null;</span>
<span class="nc" id="L1968">		Statement stmt = null;</span>
<span class="nc" id="L1969">		ResultSet rs = null;</span>
<span class="nc" id="L1970">		Map&lt;String, String&gt; stateMap = new TreeMap&lt;String, String&gt;();</span>
		try {
<span class="nc" id="L1972">			con = DBConnect.getConnection();</span>
<span class="nc" id="L1973">			stmt = con.createStatement();</span>
<span class="nc" id="L1974">			rs = stmt</span>
					.executeQuery(&quot;select state_code, name from st_lms_state_master where status = 'ACTIVE'&quot;);
<span class="nc bnc" id="L1976" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L1977">				stateMap.put(rs.getString(&quot;state_code&quot;), rs.getString(&quot;name&quot;));</span>
			}
<span class="nc" id="L1979">		} catch (SQLException e) {</span>
<span class="nc" id="L1980">			e.printStackTrace();</span>
<span class="nc" id="L1981">		} catch (Exception e) {</span>
<span class="nc" id="L1982">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L1984">			DBConnect.closeCon(con);</span>
<span class="nc" id="L1985">		}</span>
<span class="nc" id="L1986">		return stateMap;</span>
	}
	
	public static Map&lt;String, String&gt; fetchCityListStateWise(String stateCode) {
<span class="nc" id="L1990">		Connection con = null;</span>
<span class="nc" id="L1991">		Statement stmt = null;</span>
<span class="nc" id="L1992">		ResultSet rs = null;</span>
<span class="nc" id="L1993">		Map&lt;String, String&gt; cityMap = new TreeMap&lt;String, String&gt;();</span>
<span class="nc" id="L1994">		String qyery = &quot;SELECT city_name FROM st_lms_city_master &quot;;</span>
		try {
<span class="nc" id="L1996">			con = DBConnect.getConnection();</span>
<span class="nc" id="L1997">			stmt = con.createStatement();</span>
<span class="nc bnc" id="L1998" title="All 2 branches missed.">			if(!&quot;ALL&quot;.equals(stateCode)) {</span>
<span class="nc" id="L1999">				qyery += &quot;WHERE state_code = '&quot;+stateCode+&quot;' AND status = 'ACTIVE'&quot;;</span>
			} else {
<span class="nc" id="L2001">				qyery += &quot;WHERE status = 'ACTIVE'&quot;;</span>
			}
			
<span class="nc" id="L2004">			rs = stmt</span>
					.executeQuery(qyery);
<span class="nc bnc" id="L2006" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L2007">				cityMap.put(rs.getString(&quot;city_name&quot;), rs.getString(&quot;city_name&quot;));</span>
			}
<span class="nc" id="L2009">		} catch (SQLException e) {</span>
<span class="nc" id="L2010">			e.printStackTrace();</span>
<span class="nc" id="L2011">		} catch (Exception e) {</span>
<span class="nc" id="L2012">			e.printStackTrace();</span>
		} finally {
<span class="nc" id="L2014">			DBConnect.closeCon(con);</span>
<span class="nc" id="L2015">		}</span>
<span class="nc" id="L2016">		return cityMap;</span>
	}
	public static String getSelectedLocale(){
<span class="nc" id="L2019">		Cookie userLocale = null;</span>
<span class="nc" id="L2020">		HttpServletRequest request = ServletActionContext.getRequest();</span>
<span class="nc" id="L2021">		String requestedLocale = &quot;&quot;;</span>
<span class="nc bnc" id="L2022" title="All 2 branches missed.">		if(request != null){</span>
<span class="nc" id="L2023">			Cookie[] cookies = request.getCookies();</span>
<span class="nc bnc" id="L2024" title="All 2 branches missed.">			if(cookies != null){</span>
<span class="nc bnc" id="L2025" title="All 2 branches missed.">				for (Cookie element : cookies) {</span>
<span class="nc" id="L2026">					userLocale = element;</span>
<span class="nc bnc" id="L2027" title="All 2 branches missed.">					if (userLocale.getName().equals(&quot;LMSLocale&quot;)) {</span>
<span class="nc" id="L2028">						requestedLocale = userLocale.getValue();</span>
<span class="nc" id="L2029">						break;</span>
					}
		
				}
			}
		}
<span class="nc bnc" id="L2035" title="All 2 branches missed.">		if(requestedLocale == &quot;&quot;){</span>
<span class="nc" id="L2036">			requestedLocale = Locale.getDefault().getLanguage();</span>
		}
<span class="nc" id="L2038">		return requestedLocale;</span>
	}

	public static double calTaxablePwt(Double fmtPwtAmt, double govtCommPwt) throws LMSException {
<span class="nc" id="L2042">		double taxableSale = 0.0;</span>
<span class="nc" id="L2043">		String countryDeployed =Utility.getPropertyValue(&quot;COUNTRY_DEPLOYED&quot;);</span>
<span class="nc bnc" id="L2044" title="All 2 branches missed.">		if (&quot;ZIMBABWE&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L2045">			taxableSale = fmtPwtAmt;</span>
<span class="nc bnc" id="L2046" title="All 2 branches missed.">		} else if (&quot;KENYA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L2047">			taxableSale = fmtPwtAmt;</span>
<span class="nc bnc" id="L2048" title="All 2 branches missed.">		} else if (&quot;NIGERIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L2049">			taxableSale = fmtPwtAmt;</span>
<span class="nc bnc" id="L2050" title="All 2 branches missed.">		}else if (&quot;TANZANIA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L2051">			taxableSale = fmtPwtAmt;</span>
<span class="nc bnc" id="L2052" title="All 2 branches missed.">		}else if (&quot;GHANA&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L2053">			taxableSale = fmtPwtAmt-(govtCommPwt * fmtPwtAmt *0.01);</span>
<span class="nc bnc" id="L2054" title="All 2 branches missed.">		}else if (&quot;SAFARIBET&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L2055">			taxableSale = fmtPwtAmt-(govtCommPwt * fmtPwtAmt *0.01);</span>
<span class="nc bnc" id="L2056" title="All 2 branches missed.">		}else if (&quot;BENIN&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L2057">			taxableSale = fmtPwtAmt;</span>
<span class="nc bnc" id="L2058" title="All 2 branches missed.">		}else if (&quot;SIKKIM&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L2059">			taxableSale = fmtPwtAmt;</span>
<span class="nc bnc" id="L2060" title="All 2 branches missed.">		}else if (&quot;PHILIP&quot;.equalsIgnoreCase(countryDeployed)) {</span>
<span class="nc" id="L2061">			taxableSale = fmtPwtAmt;</span>
		} else {
<span class="nc" id="L2063">			throw new LMSException();</span>
		}
<span class="nc" id="L2065">		return taxableSale;</span>
	}
	
	public static String prepareSMSData(String[] pickedData, String[] playType, StringBuilder cost, StringBuilder ticket, List&lt;String&gt; drawDateTime){
<span class="nc" id="L2069">		StringBuilder finalData = new StringBuilder();</span>
		try{
<span class="nc" id="L2071">			Map&lt;String, String&gt; betNameMap = prepareBetShortNamesMap();</span>
			
<span class="nc" id="L2073">			finalData.append(&quot;Ticket No : &quot;).append(ticket).append(&quot;\n&quot;);</span>
<span class="nc" id="L2074">			finalData.append(&quot;Ticket Amt : &quot;).append(cost).append(&quot;\n&quot;);</span>
			
<span class="nc bnc" id="L2076" title="All 2 branches missed.">			for(String str : drawDateTime)</span>
<span class="nc" id="L2077">				finalData.append(&quot;Draw Time:&quot;).append(str.split(&quot;\\&amp;&quot;)[0]).append(&quot;\n&quot;);</span>
			
<span class="nc bnc" id="L2079" title="All 2 branches missed.">			for(int i = 0; i &lt; pickedData.length; i++)</span>
<span class="nc bnc" id="L2080" title="All 2 branches missed.">				finalData.append(betNameMap.get(playType[i]) == null ? playType[i].toUpperCase() : betNameMap.get(playType[i]).toUpperCase()).append(&quot;:&quot;).append(pickedData[i]).append(&quot;\n&quot;);</span>
<span class="nc" id="L2081">		} catch(Exception e) {</span>
<span class="nc" id="L2082">			logger.info(&quot;Some error occurred in Sending SMS : &quot; + e.getMessage());</span>
<span class="nc" id="L2083">		}</span>
<span class="nc" id="L2084">		return finalData.toString();</span>
	}
	
	private static Map&lt;String, String&gt; prepareBetShortNamesMap() {
<span class="nc" id="L2088">		Map&lt;String, String&gt; betNameMap = new HashMap&lt;String, String&gt;();</span>
<span class="nc" id="L2089">		betNameMap.put(&quot;Direct1&quot;, &quot;D1&quot;);</span>
<span class="nc" id="L2090">		betNameMap.put(&quot;Direct2&quot;, &quot;D2&quot;);</span>
<span class="nc" id="L2091">		betNameMap.put(&quot;Direct3&quot;, &quot;D3&quot;);</span>
<span class="nc" id="L2092">		betNameMap.put(&quot;Direct4&quot;, &quot;D4&quot;);</span>
<span class="nc" id="L2093">		betNameMap.put(&quot;Direct5&quot;, &quot;D5&quot;);</span>
<span class="nc" id="L2094">		betNameMap.put(&quot;Direct6&quot;, &quot;D6&quot;);</span>
<span class="nc" id="L2095">		betNameMap.put(&quot;Direct7&quot;, &quot;D7&quot;);</span>
<span class="nc" id="L2096">		betNameMap.put(&quot;Direct8&quot;, &quot;D8&quot;);</span>
<span class="nc" id="L2097">		betNameMap.put(&quot;Direct9&quot;, &quot;D9&quot;);</span>
<span class="nc" id="L2098">		betNameMap.put(&quot;Direct10&quot;, &quot;D10&quot;);</span>
<span class="nc" id="L2099">		betNameMap.put(&quot;Direct12&quot;, &quot;D12&quot;);</span>
<span class="nc" id="L2100">		betNameMap.put(&quot;Perm1&quot;, &quot;P1&quot;);</span>
<span class="nc" id="L2101">		betNameMap.put(&quot;Perm2&quot;, &quot;P2&quot;);</span>
<span class="nc" id="L2102">		betNameMap.put(&quot;Perm3&quot;, &quot;P3&quot;);</span>
<span class="nc" id="L2103">		betNameMap.put(&quot;Perm4&quot;, &quot;P4&quot;);</span>
<span class="nc" id="L2104">		betNameMap.put(&quot;Perm5&quot;, &quot;P5&quot;);</span>
<span class="nc" id="L2105">		betNameMap.put(&quot;Perm6&quot;, &quot;P6&quot;);</span>
<span class="nc" id="L2106">		betNameMap.put(&quot;Perm7&quot;, &quot;P7&quot;);</span>
<span class="nc" id="L2107">		betNameMap.put(&quot;Perm8&quot;, &quot;P8&quot;);</span>
<span class="nc" id="L2108">		betNameMap.put(&quot;Perm9&quot;, &quot;P9&quot;);</span>
<span class="nc" id="L2109">		betNameMap.put(&quot;Perm10&quot;, &quot;P10&quot;);</span>
<span class="nc" id="L2110">		betNameMap.put(&quot;Perm11&quot;, &quot;P11&quot;);</span>
<span class="nc" id="L2111">		betNameMap.put(&quot;Perm12&quot;, &quot;P12&quot;);</span>
<span class="nc" id="L2112">		betNameMap.put(&quot;First12&quot;, &quot;F12&quot;);</span>
<span class="nc" id="L2113">		betNameMap.put(&quot;Last12&quot;, &quot;L12&quot;);</span>
		
<span class="nc" id="L2115">		return betNameMap ;</span>
	}

	public static String sendSMS(String smsData){
<span class="nc" id="L2119">		logger.info(&quot;SMS Data : &quot; + smsData);</span>
<span class="nc" id="L2120">		logger.info(&quot;SMS Data Length : &quot; + smsData.length());</span>
<span class="nc" id="L2121">		String [] numbers = Utility.getPropertyValue(&quot;MOBILE_NO_WLS&quot;).split(&quot;,&quot;);</span>
<span class="nc bnc" id="L2122" title="All 2 branches missed.">		for(String num : numbers){</span>
<span class="nc" id="L2123">			SendSMS smsSend = new SendSMS(smsData,num);</span>
<span class="nc" id="L2124">			smsSend.setDaemon(true);</span>
<span class="nc" id="L2125">			smsSend.start();</span>
		}
<span class="nc" id="L2127">		return null;</span>
	}
	
	public static String appendRoleAgentMappingQuery(String query,String columnName,int roleId){
<span class="nc" id="L2131">		logger.info(&quot;appendRoleAgentMappingQuery method &quot;);</span>
<span class="nc" id="L2132">		StringBuilder builder = new StringBuilder(query);</span>
<span class="nc" id="L2133">		builder.append(&quot; and &quot;+columnName+&quot; in (select agent_id from st_lms_role_agent_mapping  where role_id = &quot;+roleId+&quot; ) &quot;);</span>
<span class="nc" id="L2134">		return builder.toString();</span>
	}
	
	public static String appendRoleAgentMappingQueryForJoin(int roleId){
<span class="nc" id="L2138">		logger.info(&quot;appendRoleAgentMappingQuery for join method &quot;);</span>
<span class="nc" id="L2139">		String builder=&quot;(select agent_id from st_lms_role_agent_mapping  where role_id = &quot;+roleId+&quot; ) &quot;;</span>
<span class="nc" id="L2140">		return builder;</span>
	}
	
	
	public static Map&lt;Integer, String&gt; getOrgInfoMap(int userOrgId, String orgType,int roleId)	throws LMSException {
<span class="nc" id="L2145">		Connection con = DBConnect.getConnection();</span>
<span class="nc" id="L2146">		PreparedStatement pstmt =null;</span>
<span class="nc" id="L2147">		ResultSet rs = null;</span>
<span class="nc" id="L2148">		String query=null;</span>
<span class="nc" id="L2149">		Map&lt;Integer,String&gt; retInfoMap=null;</span>
<span class="nc" id="L2150">		String appendOrder = &quot;&quot;;</span>
		try {
<span class="nc" id="L2152">			appendOrder =QueryManager.getAppendOrgOrder();</span>
			
<span class="nc bnc" id="L2154" title="All 2 branches missed.">			if((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;CODE&quot;) ){</span>
<span class="nc" id="L2155">				query =&quot;select org_code orgCode,organization_id from st_lms_organization_master where organization_type=? and parent_id=?  and organization_status &lt;&gt; 'TERMINATE'&quot;;</span>
<span class="nc bnc" id="L2156" title="All 2 branches missed.">			}else if((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;CODE_NAME&quot;)){</span>
<span class="nc" id="L2157">				query =&quot;select concat(org_code,'_',name) orgCode,organization_id from st_lms_organization_master where organization_type=? and parent_id=? and organization_status &lt;&gt; 'TERMINATE'&quot;;</span>
<span class="nc bnc" id="L2158" title="All 2 branches missed.">			}else if((LMSFilterDispatcher.orgFieldType).equalsIgnoreCase(&quot;NAME_CODE&quot;)){</span>
<span class="nc" id="L2159">				query =&quot;select concat(name,'_',org_code) orgCode,organization_id from st_lms_organization_master where organization_type=? and parent_id=? and organization_status &lt;&gt; 'TERMINATE' &quot;;</span>
			}else {
<span class="nc" id="L2161">				query =&quot;select name orgCode,organization_id from st_lms_organization_master where organization_type=? and parent_id=?  and organization_status &lt;&gt; 'TERMINATE'&quot;;</span>
			}
<span class="nc" id="L2163">			query = appendRoleAgentMappingQuery(query, &quot;organization_id&quot;, roleId)+ &quot; order by  &quot;+appendOrder;</span>
<span class="nc" id="L2164">			pstmt = con.prepareStatement(query);</span>
<span class="nc" id="L2165">			pstmt.setString(1,orgType);</span>
<span class="nc" id="L2166">			pstmt.setInt(2,userOrgId);</span>
<span class="nc" id="L2167">			logger.info(&quot;getOrgInfoMap method &quot;+ pstmt);</span>
<span class="nc" id="L2168">			rs = pstmt.executeQuery();</span>
<span class="nc" id="L2169">			retInfoMap=new LinkedHashMap&lt;Integer, String&gt;();</span>
<span class="nc bnc" id="L2170" title="All 2 branches missed.">			while (rs.next()) {</span>
<span class="nc" id="L2171">				retInfoMap.put(rs.getInt(&quot;organization_id&quot;), rs.getString(&quot;orgCode&quot;));</span>
			}
<span class="nc" id="L2173">		} catch (SQLException se) {</span>
<span class="nc" id="L2174">			logger.error(&quot;Exception&quot;,se);</span>
		}
<span class="nc" id="L2176">		catch (Exception e) {</span>
<span class="nc" id="L2177">			logger.error(&quot;Exception&quot;,e);</span>
		}
		finally {
<span class="nc" id="L2180">			DBConnect.closeResource(con,pstmt,rs);</span>
<span class="nc" id="L2181">		}</span>
<span class="nc" id="L2182">		return retInfoMap;</span>
		}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>